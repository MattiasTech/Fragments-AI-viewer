import{V as F,L as qt,M as xt,B as Tt,U as Nd,a as Lr,S as Us,F as Si,b as s3,c as Ut,P as Wt,R as $o,Q as Pe,C as Dt,I as ja,d as ri,e as i3,T as ns,f as No,g as Ce,h as ht,i as ze,O as Oi,j as nd,k as Md,l as el,m as Z_,G as Fn,n as oC,o as Dd,p as jy,q as So,W as aC,r as un,s as kd,t as Wy,u as Ic,v as Yy,D as Pi,w as sl,x as lC,y as qr,z as cC,A as re,E as Zc,H as hC,J as uC,K as dC,N as dg,X as ee,Y as xo,Z as fs,_ as ar,$ as pC,a0 as fC,a1 as mC,a2 as n3,a3 as r3,a4 as wm,a5 as gC,a6 as Em,a7 as Gy,a8 as o3,a9 as a3,aa as l3}from"./three-vendor-BFJjymLZ.js";import{I as c3,a as h3,b as u3,c as d3,d as X_,e as gw,f as bw,g as Q_,h as p3,i as f3,j as m3,k as g3,l as b3,m as _3,n as y3,o as v3,p as w3,q as E3,r as x3,s as I3,t as C3,u as T3,v as A3,w as S3,x as O3,y as P3,z as R3,A as F3,B as L3,C as $3,D as N3,E as M3,F as D3,G as k3,H as z3,J as B3,K as U3,L as V3,M as H3,N as j3,O as W3,P as Y3,Q as G3,R as bC,S as q3,T as Z3,U as X3,V as Q3,W as K3,X as J3,Y as tR,Z as eR,_ as sR,$ as iR,a0 as nR,a1 as rR,a2 as oR,a3 as aR,a4 as lR,a5 as cR,a6 as hR,a7 as uR,a8 as dR,a9 as pR,aa as fR,ab as mR,ac as gR,ad as bR,ae as _R,af as yR,ag as vR,ah as wR,ai as ER,aj as xR,ak as IR,al as CR,am as TR,an as AR,ao as SR,ap as OR,aq as PR,ar as RR,as as FR,at as LR,au as $R,av as NR,aw as MR,ax as DR,ay as kR,az as zR,aA as BR,aB as UR,aC as VR,aD as HR,aE as jR,aF as WR,aG as YR,aH as GR,aI as qR,aJ as ZR,aK as XR,aL as QR,aM as KR,aN as JR,aO as tF,aP as eF,aQ as sF,aR as iF,aS as nF,aT as rF,aU as oF,aV as aF,aW as lF,aX as cF,aY as hF,aZ as uF,a_ as dF,a$ as pF,b0 as fF,b1 as mF,b2 as gF,b3 as bF,b4 as _F,b5 as yF,b6 as vF,b7 as wF,b8 as EF,b9 as xF,ba as IF,bb as CF,bc as TF,bd as AF,be as SF,bf as OF,bg as PF,bh as RF,bi as FF,bj as LF,bk as $F,bl as NF,bm as MF,bn as DF,bo as _C,bp as yC,bq as kF,br as zF,bs as BF,bt as UF,bu as VF,bv as HF,bw as jF,bx as WF,by as YF,bz as GF,bA as qF,bB as ZF,bC as XF,bD as QF,bE as KF,bF as JF,bG as tL,bH as eL,bI as sL,bJ as iL,bK as nL,bL as rL,bM as oL,bN as aL,bO as lL,bP as Wa,bQ as pg,bR as cL,bS as hL,bT as uL,bU as dL,bV as pL,bW as fL,bX as mL,bY as gL,bZ as bL,b_ as _L,b$ as yL,c0 as vL,c1 as wL,c2 as EL,c3 as xL,c4 as IL,c5 as CL,c6 as TL,c7 as AL,c8 as SL,c9 as OL,ca as PL,cb as RL,cc as FL,cd as LL,ce as $L,cf as NL,cg as ML,ch as DL,ci as kL,cj as zL}from"./vendor-DcICA_3z.js";var _w,Au,sr,Di,ir,ql,tr,Su,lu,ps,ki,is,Oe,zt,si,zi,js,Ss,lr,Os,nr,rr,Bi,or,Ta,ii,cu,Yf,K_,cc,ho,xm,Ui,J_,vC,hc,Ou,Im,Ir,io,Pr,uo,Gf,lb,wC,Pu,Cm,hu,qf,ye,we,Zf,cb,Zl,uu,Fr,Io,Tm,t0,BL=Object.defineProperty,O=(n,t,e)=>(((s,i,r)=>{i in s?BL(s,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[i]=r})(n,typeof t!="symbol"?t+"":t,e),e),qy=(n,t,e)=>{if(!t.has(n))throw TypeError("Cannot "+e)},q=(n,t,e)=>(qy(n,t,"read from private field"),e?e.call(n):t.get(n)),kt=(n,t,e)=>{if(t.has(n))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(n):t.set(n,e)},Ot=(n,t,e,s)=>(qy(n,t,"write to private field"),t.set(n,e),e),e0=(n,t,e,s)=>({set _(i){Ot(n,t,i)},get _(){return q(n,t,s)}}),Ct=(n,t,e)=>(qy(n,t,"access private method"),e);function s0(n,t){const e=Object.getPrototypeOf(n),s=Object.getOwnPropertyNames(e);for(const i of s){if(i==="constructor"||i==="__init"||i.includes("mutate_")||i.match(/.*Array$/))continue;const r=e[i];if(typeof r=="function"){const o=n[`${i}Length`]!==void 0&&n[`${i}Array`]!==void 0;if(r.length===2||o){const l=n[`${i}Length`](),c=[];t[i]=c;for(let h=0;h<l;h++){const u=n[i](h);if(typeof u=="object"&&u!==null&&"bb"in u){const p={};s0(u,p),c.push(p)}else c.push(u)}continue}const a=n[i]();if(typeof a!="object"||a===null){t[i]=a;continue}t[i]={},s0(a,t[i])}else t[i]=r}}const bc={950732822:"IFCURIREFERENCE",4075327185:"IFCTIME",1209108979:"IFCTEMPERATURERATEOFCHANGEMEASURE",3457685358:"IFCSOUNDPRESSURELEVELMEASURE",4157543285:"IFCSOUNDPOWERLEVELMEASURE",2798247006:"IFCPROPERTYSETDEFINITIONSET",1790229001:"IFCPOSITIVEINTEGER",525895558:"IFCNONNEGATIVELENGTHMEASURE",1774176899:"IFCLINEINDEX",1275358634:"IFCLANGUAGEID",2541165894:"IFCDURATION",3701338814:"IFCDAYINWEEKNUMBER",2195413836:"IFCDATETIME",937566702:"IFCDATE",1683019596:"IFCCARDINALPOINTREFERENCE",2314439260:"IFCBINARY",1500781891:"IFCAREADENSITYMEASURE",3683503648:"IFCARCINDEX",4065007721:"IFCYEARNUMBER",1718600412:"IFCWARPINGMOMENTMEASURE",51269191:"IFCWARPINGCONSTANTMEASURE",2593997549:"IFCVOLUMETRICFLOWRATEMEASURE",3458127941:"IFCVOLUMEMEASURE",3345633955:"IFCVAPORPERMEABILITYMEASURE",1278329552:"IFCTORQUEMEASURE",2591213694:"IFCTIMESTAMP",2726807636:"IFCTIMEMEASURE",743184107:"IFCTHERMODYNAMICTEMPERATUREMEASURE",2016195849:"IFCTHERMALTRANSMITTANCEMEASURE",857959152:"IFCTHERMALRESISTANCEMEASURE",2281867870:"IFCTHERMALEXPANSIONCOEFFICIENTMEASURE",2645777649:"IFCTHERMALCONDUCTIVITYMEASURE",232962298:"IFCTHERMALADMITTANCEMEASURE",296282323:"IFCTEXTTRANSFORMATION",603696268:"IFCTEXTFONTNAME",3490877962:"IFCTEXTDECORATION",1460886941:"IFCTEXTALIGNMENT",2801250643:"IFCTEXT",58845555:"IFCTEMPERATUREGRADIENTMEASURE",361837227:"IFCSPECULARROUGHNESS",2757832317:"IFCSPECULAREXPONENT",3477203348:"IFCSPECIFICHEATCAPACITYMEASURE",993287707:"IFCSOUNDPRESSUREMEASURE",846465480:"IFCSOUNDPOWERMEASURE",3471399674:"IFCSOLIDANGLEMEASURE",408310005:"IFCSHEARMODULUSMEASURE",2190458107:"IFCSECTIONALAREAINTEGRALMEASURE",3467162246:"IFCSECTIONMODULUSMEASURE",2766185779:"IFCSECONDINMINUTE",3211557302:"IFCROTATIONALSTIFFNESSMEASURE",1755127002:"IFCROTATIONALMASSMEASURE",2133746277:"IFCROTATIONALFREQUENCYMEASURE",200335297:"IFCREAL",96294661:"IFCRATIOMEASURE",3972513137:"IFCRADIOACTIVITYMEASURE",3665567075:"IFCPRESSUREMEASURE",2169031380:"IFCPRESENTABLETEXT",1364037233:"IFCPOWERMEASURE",1245737093:"IFCPOSITIVERATIOMEASURE",3054510233:"IFCPOSITIVEPLANEANGLEMEASURE",2815919920:"IFCPOSITIVELENGTHMEASURE",4042175685:"IFCPLANEANGLEMEASURE",2642773653:"IFCPLANARFORCEMEASURE",2260317790:"IFCPARAMETERVALUE",929793134:"IFCPHMEASURE",2395907400:"IFCNUMERICMEASURE",2095195183:"IFCNORMALISEDRATIOMEASURE",765770214:"IFCMONTHINYEARNUMBER",2615040989:"IFCMONETARYMEASURE",3114022597:"IFCMOMENTOFINERTIAMEASURE",1648970520:"IFCMOLECULARWEIGHTMEASURE",3177669450:"IFCMOISTUREDIFFUSIVITYMEASURE",1753493141:"IFCMODULUSOFSUBGRADEREACTIONMEASURE",1052454078:"IFCMODULUSOFROTATIONALSUBGRADEREACTIONMEASURE",2173214787:"IFCMODULUSOFLINEARSUBGRADEREACTIONMEASURE",3341486342:"IFCMODULUSOFELASTICITYMEASURE",102610177:"IFCMINUTEINHOUR",3531705166:"IFCMASSPERLENGTHMEASURE",3124614049:"IFCMASSMEASURE",4017473158:"IFCMASSFLOWRATEMEASURE",1477762836:"IFCMASSDENSITYMEASURE",2486716878:"IFCMAGNETICFLUXMEASURE",286949696:"IFCMAGNETICFLUXDENSITYMEASURE",151039812:"IFCLUMINOUSINTENSITYMEASURE",2755797622:"IFCLUMINOUSINTENSITYDISTRIBUTIONMEASURE",2095003142:"IFCLUMINOUSFLUXMEASURE",503418787:"IFCLOGICAL",3086160713:"IFCLINEARVELOCITYMEASURE",1307019551:"IFCLINEARSTIFFNESSMEASURE",2128979029:"IFCLINEARMOMENTMEASURE",191860431:"IFCLINEARFORCEMEASURE",1243674935:"IFCLENGTHMEASURE",3258342251:"IFCLABEL",2054016361:"IFCKINEMATICVISCOSITYMEASURE",3192672207:"IFCISOTHERMALMOISTURECAPACITYMEASURE",3686016028:"IFCIONCONCENTRATIONMEASURE",3809634241:"IFCINTEGERCOUNTRATEMEASURE",1939436016:"IFCINTEGER",2679005408:"IFCINDUCTANCEMEASURE",3358199106:"IFCILLUMINANCEMEASURE",983778844:"IFCIDENTIFIER",2589826445:"IFCHOURINDAY",1158859006:"IFCHEATINGVALUEMEASURE",3113092358:"IFCHEATFLUXDENSITYMEASURE",3064340077:"IFCGLOBALLYUNIQUEID",3044325142:"IFCFREQUENCYMEASURE",1361398929:"IFCFORCEMEASURE",2590844177:"IFCFONTWEIGHT",2715512545:"IFCFONTVARIANT",1102727119:"IFCFONTSTYLE",2078135608:"IFCENERGYMEASURE",2506197118:"IFCELECTRICVOLTAGEMEASURE",2951915441:"IFCELECTRICRESISTANCEMEASURE",3790457270:"IFCELECTRICCURRENTMEASURE",2093906313:"IFCELECTRICCONDUCTANCEMEASURE",3818826038:"IFCELECTRICCHARGEMEASURE",1827137117:"IFCELECTRICCAPACITANCEMEASURE",69416015:"IFCDYNAMICVISCOSITYMEASURE",524656162:"IFCDOSEEQUIVALENTMEASURE",4134073009:"IFCDIMENSIONCOUNT",1514641115:"IFCDESCRIPTIVEMEASURE",300323983:"IFCDAYLIGHTSAVINGHOUR",86635668:"IFCDAYINMONTHNUMBER",94842927:"IFCCURVATUREMEASURE",1778710042:"IFCCOUNTMEASURE",3238673880:"IFCCONTEXTDEPENDENTMEASURE",3812528620:"IFCCOMPOUNDPLANEANGLEMEASURE",2991860651:"IFCCOMPLEXNUMBER",1867003952:"IFCBOXALIGNMENT",2735952531:"IFCBOOLEAN",2650437152:"IFCAREAMEASURE",632304761:"IFCANGULARVELOCITYMEASURE",360377573:"IFCAMOUNTOFSUBSTANCEMEASURE",4182062534:"IFCACCELERATIONMEASURE",3699917729:"IFCABSORBEDDOSEMEASURE",1971632696:"IFCGEOSLICE",2680139844:"IFCGEOMODEL",24726584:"IFCELECTRICFLOWTREATMENTDEVICE",3693000487:"IFCDISTRIBUTIONBOARD",3460952963:"IFCCONVEYORSEGMENT",3999819293:"IFCCAISSONFOUNDATION",3314249567:"IFCBOREHOLE",4196446775:"IFCBEARING",325726236:"IFCALIGNMENT",3425753595:"IFCTRACKELEMENT",991950508:"IFCSIGNAL",3798194928:"IFCREINFORCEDSOIL",3290496277:"IFCRAIL",1383356374:"IFCPAVEMENT",2182337498:"IFCNAVIGATIONELEMENT",234836483:"IFCMOORINGDEVICE",2078563270:"IFCMOBILETELECOMMUNICATIONSAPPLIANCE",1638804497:"IFCLIQUIDTERMINAL",1154579445:"IFCLINEARPOSITIONINGELEMENT",2696325953:"IFCKERB",2713699986:"IFCGEOTECHNICALASSEMBLY",2142170206:"IFCELECTRICFLOWTREATMENTDEVICETYPE",3376911765:"IFCEARTHWORKSFILL",1077100507:"IFCEARTHWORKSELEMENT",3071239417:"IFCEARTHWORKSCUT",479945903:"IFCDISTRIBUTIONBOARDTYPE",3426335179:"IFCDEEPFOUNDATION",1502416096:"IFCCOURSE",2940368186:"IFCCONVEYORSEGMENTTYPE",3203706013:"IFCCAISSONFOUNDATIONTYPE",3862327254:"IFCBUILTSYSTEM",1876633798:"IFCBUILTELEMENT",963979645:"IFCBRIDGEPART",644574406:"IFCBRIDGE",3649138523:"IFCBEARINGTYPE",1662888072:"IFCALIGNMENTVERTICAL",317615605:"IFCALIGNMENTSEGMENT",1545765605:"IFCALIGNMENTHORIZONTAL",4266260250:"IFCALIGNMENTCANT",3956297820:"IFCVIBRATIONDAMPERTYPE",1530820697:"IFCVIBRATIONDAMPER",840318589:"IFCVEHICLE",1953115116:"IFCTRANSPORTATIONDEVICE",618700268:"IFCTRACKELEMENTTYPE",2281632017:"IFCTENDONCONDUITTYPE",3663046924:"IFCTENDONCONDUIT",42703149:"IFCSINESPIRAL",1894708472:"IFCSIGNALTYPE",3599934289:"IFCSIGNTYPE",33720170:"IFCSIGN",1027922057:"IFCSEVENTHORDERPOLYNOMIALSPIRAL",544395925:"IFCSEGMENTEDREFERENCECURVE",3649235739:"IFCSECONDORDERPOLYNOMIALSPIRAL",550521510:"IFCROADPART",146592293:"IFCROAD",3818125796:"IFCRELADHERESTOELEMENT",4021432810:"IFCREFERENT",1891881377:"IFCRAILWAYPART",3992365140:"IFCRAILWAY",1763565496:"IFCRAILTYPE",1946335990:"IFCPOSITIONINGELEMENT",514975943:"IFCPAVEMENTTYPE",506776471:"IFCNAVIGATIONELEMENTTYPE",710110818:"IFCMOORINGDEVICETYPE",1950438474:"IFCMOBILETELECOMMUNICATIONSAPPLIANCETYPE",976884017:"IFCMARINEPART",525669439:"IFCMARINEFACILITY",1770583370:"IFCLIQUIDTERMINALTYPE",2176059722:"IFCLINEARELEMENT",679976338:"IFCKERBTYPE",3948183225:"IFCIMPACTPROTECTIONDEVICETYPE",2568555532:"IFCIMPACTPROTECTIONDEVICE",2898700619:"IFCGRADIENTCURVE",1594536857:"IFCGEOTECHNICALSTRATUM",4230923436:"IFCGEOTECHNICALELEMENT",4228831410:"IFCFACILITYPARTCOMMON",1310830890:"IFCFACILITYPART",24185140:"IFCFACILITY",4234616927:"IFCDIRECTRIXDERIVEDREFERENCESWEPTAREASOLID",1306400036:"IFCDEEPFOUNDATIONTYPE",4189326743:"IFCCOURSETYPE",2000195564:"IFCCOSINESPIRAL",3497074424:"IFCCLOTHOID",1626504194:"IFCBUILTELEMENTTYPE",3651464721:"IFCVEHICLETYPE",1229763772:"IFCTRIANGULATEDIRREGULARNETWORK",3665877780:"IFCTRANSPORTATIONDEVICETYPE",782932809:"IFCTHIRDORDERPOLYNOMIALSPIRAL",2735484536:"IFCSPIRAL",1356537516:"IFCSECTIONEDSURFACE",1290935644:"IFCSECTIONEDSOLIDHORIZONTAL",1862484736:"IFCSECTIONEDSOLID",1441486842:"IFCRELPOSITIONS",1033248425:"IFCRELASSOCIATESPROFILEDEF",3381221214:"IFCPOLYNOMIALCURVE",2485787929:"IFCOFFSETCURVEBYDISTANCES",590820931:"IFCOFFSETCURVE",3465909080:"IFCINDEXEDPOLYGONALTEXTUREMAP",593015953:"IFCDIRECTRIXCURVESWEPTAREASOLID",4212018352:"IFCCURVESEGMENT",3425423356:"IFCAXIS2PLACEMENTLINEAR",823603102:"IFCSEGMENT",2165702409:"IFCPOINTBYDISTANCEEXPRESSION",182550632:"IFCOPENCROSSPROFILEDEF",388784114:"IFCLINEARPLACEMENT",536804194:"IFCALIGNMENTHORIZONTALSEGMENT",3752311538:"IFCALIGNMENTCANTSEGMENT",1010789467:"IFCTEXTURECOORDINATEINDICESWITHVOIDS",222769930:"IFCTEXTURECOORDINATEINDICES",2691318326:"IFCQUANTITYNUMBER",3633395639:"IFCALIGNMENTVERTICALSEGMENT",2879124712:"IFCALIGNMENTPARAMETERSEGMENT",25142252:"IFCCONTROLLER",3087945054:"IFCALARM",4288193352:"IFCACTUATOR",630975310:"IFCUNITARYCONTROLELEMENT",4086658281:"IFCSENSOR",2295281155:"IFCPROTECTIVEDEVICETRIPPINGUNIT",182646315:"IFCFLOWINSTRUMENT",1426591983:"IFCFIRESUPPRESSIONTERMINAL",819412036:"IFCFILTER",3415622556:"IFCFAN",1003880860:"IFCELECTRICTIMECONTROL",402227799:"IFCELECTRICMOTOR",264262732:"IFCELECTRICGENERATOR",3310460725:"IFCELECTRICFLOWSTORAGEDEVICE",862014818:"IFCELECTRICDISTRIBUTIONBOARD",1904799276:"IFCELECTRICAPPLIANCE",1360408905:"IFCDUCTSILENCER",3518393246:"IFCDUCTSEGMENT",342316401:"IFCDUCTFITTING",562808652:"IFCDISTRIBUTIONCIRCUIT",4074379575:"IFCDAMPER",3640358203:"IFCCOOLINGTOWER",4136498852:"IFCCOOLEDBEAM",2272882330:"IFCCONDENSER",3571504051:"IFCCOMPRESSOR",3221913625:"IFCCOMMUNICATIONSAPPLIANCE",639361253:"IFCCOIL",3902619387:"IFCCHILLER",4217484030:"IFCCABLESEGMENT",1051757585:"IFCCABLEFITTING",3758799889:"IFCCABLECARRIERSEGMENT",635142910:"IFCCABLECARRIERFITTING",2938176219:"IFCBURNER",32344328:"IFCBOILER",2906023776:"IFCBEAMSTANDARDCASE",277319702:"IFCAUDIOVISUALAPPLIANCE",2056796094:"IFCAIRTOAIRHEATRECOVERY",177149247:"IFCAIRTERMINALBOX",1634111441:"IFCAIRTERMINAL",486154966:"IFCWINDOWSTANDARDCASE",4237592921:"IFCWASTETERMINAL",4156078855:"IFCWALLELEMENTEDCASE",4207607924:"IFCVALVE",4292641817:"IFCUNITARYEQUIPMENT",3179687236:"IFCUNITARYCONTROLELEMENTTYPE",3026737570:"IFCTUBEBUNDLE",3825984169:"IFCTRANSFORMER",812556717:"IFCTANK",1162798199:"IFCSWITCHINGDEVICE",385403989:"IFCSTRUCTURALLOADCASE",1404847402:"IFCSTACKTERMINAL",1999602285:"IFCSPACEHEATER",3420628829:"IFCSOLARDEVICE",3027962421:"IFCSLABSTANDARDCASE",3127900445:"IFCSLABELEMENTEDCASE",1329646415:"IFCSHADINGDEVICE",3053780830:"IFCSANITARYTERMINAL",2572171363:"IFCREINFORCINGBARTYPE",1232101972:"IFCRATIONALBSPLINECURVEWITHKNOTS",90941305:"IFCPUMP",655969474:"IFCPROTECTIVEDEVICETRIPPINGUNITTYPE",738039164:"IFCPROTECTIVEDEVICE",1156407060:"IFCPLATESTANDARDCASE",3612865200:"IFCPIPESEGMENT",310824031:"IFCPIPEFITTING",3694346114:"IFCOUTLET",144952367:"IFCOUTERBOUNDARYCURVE",2474470126:"IFCMOTORCONNECTION",1911478936:"IFCMEMBERSTANDARDCASE",1437502449:"IFCMEDICALDEVICE",629592764:"IFCLIGHTFIXTURE",76236018:"IFCLAMP",2176052936:"IFCJUNCTIONBOX",4175244083:"IFCINTERCEPTOR",2068733104:"IFCHUMIDIFIER",3319311131:"IFCHEATEXCHANGER",2188021234:"IFCFLOWMETER",1209101575:"IFCEXTERNALSPATIALELEMENT",484807127:"IFCEVAPORATOR",3747195512:"IFCEVAPORATIVECOOLER",2814081492:"IFCENGINE",2417008758:"IFCELECTRICDISTRIBUTIONBOARDTYPE",3242481149:"IFCDOORSTANDARDCASE",3205830791:"IFCDISTRIBUTIONSYSTEM",400855858:"IFCCOMMUNICATIONSAPPLIANCETYPE",905975707:"IFCCOLUMNSTANDARDCASE",1677625105:"IFCCIVILELEMENT",3296154744:"IFCCHIMNEY",2674252688:"IFCCABLEFITTINGTYPE",2188180465:"IFCBURNERTYPE",1177604601:"IFCBUILDINGSYSTEM",39481116:"IFCBUILDINGELEMENTPARTTYPE",1136057603:"IFCBOUNDARYCURVE",2461110595:"IFCBSPLINECURVEWITHKNOTS",1532957894:"IFCAUDIOVISUALAPPLIANCETYPE",4088093105:"IFCWORKCALENDAR",4009809668:"IFCWINDOWTYPE",926996030:"IFCVOIDINGFEATURE",2391383451:"IFCVIBRATIONISOLATOR",2415094496:"IFCTENDONTYPE",3081323446:"IFCTENDONANCHORTYPE",413509423:"IFCSYSTEMFURNITUREELEMENT",3101698114:"IFCSURFACEFEATURE",3657597509:"IFCSTRUCTURALSURFACEACTION",2757150158:"IFCSTRUCTURALCURVEREACTION",1004757350:"IFCSTRUCTURALCURVEACTION",338393293:"IFCSTAIRTYPE",1072016465:"IFCSOLARDEVICETYPE",4074543187:"IFCSHADINGDEVICETYPE",2157484638:"IFCSEAMCURVE",2781568857:"IFCROOFTYPE",2310774935:"IFCREINFORCINGMESHTYPE",964333572:"IFCREINFORCINGELEMENTTYPE",683857671:"IFCRATIONALBSPLINESURFACEWITHKNOTS",1469900589:"IFCRAMPTYPE",2839578677:"IFCPOLYGONALFACESET",1158309216:"IFCPILETYPE",3079942009:"IFCOPENINGSTANDARDCASE",1114901282:"IFCMEDICALDEVICETYPE",3113134337:"IFCINTERSECTIONCURVE",3946677679:"IFCINTERCEPTORTYPE",2571569899:"IFCINDEXEDPOLYCURVE",3493046030:"IFCGEOGRAPHICELEMENT",1509553395:"IFCFURNITURE",1893162501:"IFCFOOTINGTYPE",2853485674:"IFCEXTERNALSPATIALSTRUCTUREELEMENT",4148101412:"IFCEVENT",132023988:"IFCENGINETYPE",2397081782:"IFCELEMENTASSEMBLYTYPE",2323601079:"IFCDOORTYPE",1213902940:"IFCCYLINDRICALSURFACE",1525564444:"IFCCONSTRUCTIONPRODUCTRESOURCETYPE",4105962743:"IFCCONSTRUCTIONMATERIALRESOURCETYPE",2185764099:"IFCCONSTRUCTIONEQUIPMENTRESOURCETYPE",15328376:"IFCCOMPOSITECURVEONSURFACE",3875453745:"IFCCOMPLEXPROPERTYTEMPLATE",3893394355:"IFCCIVILELEMENTTYPE",2197970202:"IFCCHIMNEYTYPE",167062518:"IFCBSPLINESURFACEWITHKNOTS",2887950389:"IFCBSPLINESURFACE",2603310189:"IFCADVANCEDBREPWITHVOIDS",1635779807:"IFCADVANCEDBREP",2916149573:"IFCTRIANGULATEDFACESET",1935646853:"IFCTOROIDALSURFACE",2387106220:"IFCTESSELLATEDFACESET",3206491090:"IFCTASKTYPE",699246055:"IFCSURFACECURVE",4095615324:"IFCSUBCONTRACTRESOURCETYPE",603775116:"IFCSTRUCTURALSURFACEREACTION",4015995234:"IFCSPHERICALSURFACE",2481509218:"IFCSPATIALZONETYPE",463610769:"IFCSPATIALZONE",710998568:"IFCSPATIALELEMENTTYPE",1412071761:"IFCSPATIALELEMENT",3663146110:"IFCSIMPLEPROPERTYTEMPLATE",3243963512:"IFCREVOLVEDAREASOLIDTAPERED",816062949:"IFCREPARAMETRISEDCOMPOSITECURVESEGMENT",1521410863:"IFCRELSPACEBOUNDARY2NDLEVEL",3523091289:"IFCRELSPACEBOUNDARY1STLEVEL",427948657:"IFCRELINTERFERESELEMENTS",307848117:"IFCRELDEFINESBYTEMPLATE",1462361463:"IFCRELDEFINESBYOBJECT",2565941209:"IFCRELDECLARES",1027710054:"IFCRELASSIGNSTOGROUPBYFACTOR",3521284610:"IFCPROPERTYTEMPLATE",492091185:"IFCPROPERTYSETTEMPLATE",653396225:"IFCPROJECTLIBRARY",569719735:"IFCPROCEDURETYPE",3967405729:"IFCPREDEFINEDPROPERTYSET",1682466193:"IFCPCURVE",428585644:"IFCLABORRESOURCETYPE",2294589976:"IFCINDEXEDPOLYGONALFACEWITHVOIDS",178912537:"IFCINDEXEDPOLYGONALFACE",4095422895:"IFCGEOGRAPHICELEMENTTYPE",2652556860:"IFCFIXEDREFERENCESWEPTAREASOLID",2804161546:"IFCEXTRUDEDAREASOLIDTAPERED",4024345920:"IFCEVENTTYPE",2629017746:"IFCCURVEBOUNDEDSURFACE",1815067380:"IFCCREWRESOURCETYPE",3419103109:"IFCCONTEXT",2574617495:"IFCCONSTRUCTIONRESOURCETYPE",2059837836:"IFCCARTESIANPOINTLIST3D",1675464909:"IFCCARTESIANPOINTLIST2D",574549367:"IFCCARTESIANPOINTLIST",3406155212:"IFCADVANCEDFACE",3698973494:"IFCTYPERESOURCE",3736923433:"IFCTYPEPROCESS",901063453:"IFCTESSELLATEDITEM",1096409881:"IFCSWEPTDISKSOLIDPOLYGONAL",1042787934:"IFCRESOURCETIME",1608871552:"IFCRESOURCECONSTRAINTRELATIONSHIP",2943643501:"IFCRESOURCEAPPROVALRELATIONSHIP",2090586900:"IFCQUANTITYSET",1482703590:"IFCPROPERTYTEMPLATEDEFINITION",3778827333:"IFCPREDEFINEDPROPERTIES",2998442950:"IFCMIRROREDPROFILEDEF",853536259:"IFCMATERIALRELATIONSHIP",3404854881:"IFCMATERIALPROFILESETUSAGETAPERING",3079605661:"IFCMATERIALPROFILESETUSAGE",2852063980:"IFCMATERIALCONSTITUENTSET",3708119e3:"IFCMATERIALCONSTITUENT",1585845231:"IFCLAGTIME",2133299955:"IFCINDEXEDTRIANGLETEXTUREMAP",1437953363:"IFCINDEXEDTEXTUREMAP",3570813810:"IFCINDEXEDCOLOURMAP",1437805879:"IFCEXTERNALREFERENCERELATIONSHIP",297599258:"IFCEXTENDEDPROPERTIES",211053100:"IFCEVENTTIME",2713554722:"IFCCONVERSIONBASEDUNITWITHOFFSET",3285139300:"IFCCOLOURRGBLIST",1236880293:"IFCWORKTIME",1199560280:"IFCTIMEPERIOD",3611470254:"IFCTEXTUREVERTEXLIST",2771591690:"IFCTASKTIMERECURRING",1549132990:"IFCTASKTIME",2043862942:"IFCTABLECOLUMN",2934153892:"IFCSURFACEREINFORCEMENTAREA",609421318:"IFCSTRUCTURALLOADORRESULT",3478079324:"IFCSTRUCTURALLOADCONFIGURATION",1054537805:"IFCSCHEDULINGTIME",2439245199:"IFCRESOURCELEVELRELATIONSHIP",2433181523:"IFCREFERENCE",3915482550:"IFCRECURRENCEPATTERN",986844984:"IFCPROPERTYABSTRACTION",3843373140:"IFCPROJECTEDCRS",677532197:"IFCPRESENTATIONITEM",1507914824:"IFCMATERIALUSAGEDEFINITION",552965576:"IFCMATERIALPROFILEWITHOFFSETS",164193824:"IFCMATERIALPROFILESET",2235152071:"IFCMATERIALPROFILE",1847252529:"IFCMATERIALLAYERWITHOFFSETS",760658860:"IFCMATERIALDEFINITION",3057273783:"IFCMAPCONVERSION",4294318154:"IFCEXTERNALINFORMATION",1466758467:"IFCCOORDINATEREFERENCESYSTEM",1785450214:"IFCCOORDINATEOPERATION",775493141:"IFCCONNECTIONVOLUMEGEOMETRY",979691226:"IFCREINFORCINGBAR",3700593921:"IFCELECTRICDISTRIBUTIONPOINT",1062813311:"IFCDISTRIBUTIONCONTROLELEMENT",1052013943:"IFCDISTRIBUTIONCHAMBERELEMENT",578613899:"IFCCONTROLLERTYPE",2454782716:"IFCCHAMFEREDGEFEATURE",753842376:"IFCBEAM",3001207471:"IFCALARMTYPE",2874132201:"IFCACTUATORTYPE",3304561284:"IFCWINDOW",3512223829:"IFCWALLSTANDARDCASE",2391406946:"IFCWALL",3313531582:"IFCVIBRATIONISOLATORTYPE",2347447852:"IFCTENDONANCHOR",3824725483:"IFCTENDON",2515109513:"IFCSTRUCTURALANALYSISMODEL",4252922144:"IFCSTAIRFLIGHT",331165859:"IFCSTAIR",1529196076:"IFCSLAB",1783015770:"IFCSENSORTYPE",1376911519:"IFCROUNDEDEDGEFEATURE",2016517767:"IFCROOF",2320036040:"IFCREINFORCINGMESH",3027567501:"IFCREINFORCINGELEMENT",3055160366:"IFCRATIONALBEZIERCURVE",3283111854:"IFCRAMPFLIGHT",3024970846:"IFCRAMP",2262370178:"IFCRAILING",3171933400:"IFCPLATE",1687234759:"IFCPILE",1073191201:"IFCMEMBER",900683007:"IFCFOOTING",3508470533:"IFCFLOWTREATMENTDEVICE",2223149337:"IFCFLOWTERMINAL",707683696:"IFCFLOWSTORAGEDEVICE",987401354:"IFCFLOWSEGMENT",3132237377:"IFCFLOWMOVINGDEVICE",4037862832:"IFCFLOWINSTRUMENTTYPE",4278956645:"IFCFLOWFITTING",2058353004:"IFCFLOWCONTROLLER",4222183408:"IFCFIRESUPPRESSIONTERMINALTYPE",1810631287:"IFCFILTERTYPE",346874300:"IFCFANTYPE",1658829314:"IFCENERGYCONVERSIONDEVICE",857184966:"IFCELECTRICALELEMENT",1634875225:"IFCELECTRICALCIRCUIT",712377611:"IFCELECTRICTIMECONTROLTYPE",1217240411:"IFCELECTRICMOTORTYPE",1365060375:"IFCELECTRICHEATERTYPE",1534661035:"IFCELECTRICGENERATORTYPE",3277789161:"IFCELECTRICFLOWSTORAGEDEVICETYPE",663422040:"IFCELECTRICAPPLIANCETYPE",855621170:"IFCEDGEFEATURE",2030761528:"IFCDUCTSILENCERTYPE",3760055223:"IFCDUCTSEGMENTTYPE",869906466:"IFCDUCTFITTINGTYPE",395920057:"IFCDOOR",3041715199:"IFCDISTRIBUTIONPORT",3040386961:"IFCDISTRIBUTIONFLOWELEMENT",1945004755:"IFCDISTRIBUTIONELEMENT",2063403501:"IFCDISTRIBUTIONCONTROLELEMENTTYPE",1599208980:"IFCDISTRIBUTIONCHAMBERELEMENTTYPE",2635815018:"IFCDISCRETEACCESSORYTYPE",1335981549:"IFCDISCRETEACCESSORY",4147604152:"IFCDIAMETERDIMENSION",3961806047:"IFCDAMPERTYPE",3495092785:"IFCCURTAINWALL",1973544240:"IFCCOVERING",2954562838:"IFCCOOLINGTOWERTYPE",335055490:"IFCCOOLEDBEAMTYPE",488727124:"IFCCONSTRUCTIONPRODUCTRESOURCE",1060000209:"IFCCONSTRUCTIONMATERIALRESOURCE",3898045240:"IFCCONSTRUCTIONEQUIPMENTRESOURCE",1163958913:"IFCCONDITIONCRITERION",2188551683:"IFCCONDITION",2816379211:"IFCCONDENSERTYPE",3850581409:"IFCCOMPRESSORTYPE",843113511:"IFCCOLUMN",2301859152:"IFCCOILTYPE",2611217952:"IFCCIRCLE",2951183804:"IFCCHILLERTYPE",1285652485:"IFCCABLESEGMENTTYPE",3293546465:"IFCCABLECARRIERSEGMENTTYPE",395041908:"IFCCABLECARRIERFITTINGTYPE",1909888760:"IFCBUILDINGELEMENTPROXYTYPE",1095909175:"IFCBUILDINGELEMENTPROXY",2979338954:"IFCBUILDINGELEMENTPART",52481810:"IFCBUILDINGELEMENTCOMPONENT",3299480353:"IFCBUILDINGELEMENT",231477066:"IFCBOILERTYPE",1916977116:"IFCBEZIERCURVE",819618141:"IFCBEAMTYPE",1967976161:"IFCBSPLINECURVE",3460190687:"IFCASSET",2470393545:"IFCANGULARDIMENSION",1871374353:"IFCAIRTOAIRHEATRECOVERYTYPE",3352864051:"IFCAIRTERMINALTYPE",1411407467:"IFCAIRTERMINALBOXTYPE",3821786052:"IFCACTIONREQUEST",1213861670:"IFC2DCOMPOSITECURVE",1033361043:"IFCZONE",3342526732:"IFCWORKSCHEDULE",4218914973:"IFCWORKPLAN",1028945134:"IFCWORKCONTROL",1133259667:"IFCWASTETERMINALTYPE",1898987631:"IFCWALLTYPE",2769231204:"IFCVIRTUALELEMENT",728799441:"IFCVALVETYPE",1911125066:"IFCUNITARYEQUIPMENTTYPE",1600972822:"IFCTUBEBUNDLETYPE",3593883385:"IFCTRIMMEDCURVE",1620046519:"IFCTRANSPORTELEMENT",1692211062:"IFCTRANSFORMERTYPE",1637806684:"IFCTIMESERIESSCHEDULE",5716631:"IFCTANKTYPE",2254336722:"IFCSYSTEM",2315554128:"IFCSWITCHINGDEVICETYPE",148013059:"IFCSUBCONTRACTRESOURCE",1975003073:"IFCSTRUCTURALSURFACECONNECTION",2986769608:"IFCSTRUCTURALRESULTGROUP",1235345126:"IFCSTRUCTURALPOINTREACTION",734778138:"IFCSTRUCTURALPOINTCONNECTION",2082059205:"IFCSTRUCTURALPOINTACTION",3987759626:"IFCSTRUCTURALPLANARACTIONVARYING",1621171031:"IFCSTRUCTURALPLANARACTION",1252848954:"IFCSTRUCTURALLOADGROUP",1721250024:"IFCSTRUCTURALLINEARACTIONVARYING",1807405624:"IFCSTRUCTURALLINEARACTION",2445595289:"IFCSTRUCTURALCURVEMEMBERVARYING",214636428:"IFCSTRUCTURALCURVEMEMBER",4243806635:"IFCSTRUCTURALCURVECONNECTION",1179482911:"IFCSTRUCTURALCONNECTION",682877961:"IFCSTRUCTURALACTION",1039846685:"IFCSTAIRFLIGHTTYPE",3112655638:"IFCSTACKTERMINALTYPE",3812236995:"IFCSPACETYPE",652456506:"IFCSPACEPROGRAM",1305183839:"IFCSPACEHEATERTYPE",3856911033:"IFCSPACE",2533589738:"IFCSLABTYPE",4097777520:"IFCSITE",4105383287:"IFCSERVICELIFE",3517283431:"IFCSCHEDULETIMECONTROL",1768891740:"IFCSANITARYTERMINALTYPE",2863920197:"IFCRELASSIGNSTASKS",160246688:"IFCRELAGGREGATES",2324767716:"IFCRAMPFLIGHTTYPE",2893384427:"IFCRAILINGTYPE",3248260540:"IFCRADIUSDIMENSION",2250791053:"IFCPUMPTYPE",1842657554:"IFCPROTECTIVEDEVICETYPE",3651124850:"IFCPROJECTIONELEMENT",3642467123:"IFCPROJECTORDERRECORD",2904328755:"IFCPROJECTORDER",2744685151:"IFCPROCEDURE",3740093272:"IFCPORT",3724593414:"IFCPOLYLINE",4017108033:"IFCPLATETYPE",4231323485:"IFCPIPESEGMENTTYPE",804291784:"IFCPIPEFITTINGTYPE",3327091369:"IFCPERMIT",2382730787:"IFCPERFORMANCEHISTORY",2837617999:"IFCOUTLETTYPE",3425660407:"IFCORDERACTION",3588315303:"IFCOPENINGELEMENT",4143007308:"IFCOCCUPANT",1916936684:"IFCMOVE",977012517:"IFCMOTORCONNECTIONTYPE",3181161470:"IFCMEMBERTYPE",2108223431:"IFCMECHANICALFASTENERTYPE",377706215:"IFCMECHANICALFASTENER",2506943328:"IFCLINEARDIMENSION",1161773419:"IFCLIGHTFIXTURETYPE",1051575348:"IFCLAMPTYPE",3827777499:"IFCLABORRESOURCE",4288270099:"IFCJUNCTIONBOXTYPE",2391368822:"IFCINVENTORY",1806887404:"IFCHUMIDIFIERTYPE",1251058090:"IFCHEATEXCHANGERTYPE",2706460486:"IFCGROUP",3009204131:"IFCGRID",200128114:"IFCGASTERMINALTYPE",814719939:"IFCFURNITURESTANDARD",263784265:"IFCFURNISHINGELEMENT",3009222698:"IFCFLOWTREATMENTDEVICETYPE",2297155007:"IFCFLOWTERMINALTYPE",1339347760:"IFCFLOWSTORAGEDEVICETYPE",1834744321:"IFCFLOWSEGMENTTYPE",1482959167:"IFCFLOWMOVINGDEVICETYPE",3815607619:"IFCFLOWMETERTYPE",3198132628:"IFCFLOWFITTINGTYPE",3907093117:"IFCFLOWCONTROLLERTYPE",1287392070:"IFCFEATUREELEMENTSUBTRACTION",2143335405:"IFCFEATUREELEMENTADDITION",2827207264:"IFCFEATUREELEMENT",2489546625:"IFCFASTENERTYPE",647756555:"IFCFASTENER",3737207727:"IFCFACETEDBREPWITHVOIDS",807026263:"IFCFACETEDBREP",3390157468:"IFCEVAPORATORTYPE",3174744832:"IFCEVAPORATIVECOOLERTYPE",3272907226:"IFCEQUIPMENTSTANDARD",1962604670:"IFCEQUIPMENTELEMENT",2107101300:"IFCENERGYCONVERSIONDEVICETYPE",1704287377:"IFCELLIPSE",2590856083:"IFCELEMENTCOMPONENTTYPE",1623761950:"IFCELEMENTCOMPONENT",4123344466:"IFCELEMENTASSEMBLY",1758889154:"IFCELEMENT",360485395:"IFCELECTRICALBASEPROPERTIES",3849074793:"IFCDISTRIBUTIONFLOWELEMENTTYPE",3256556792:"IFCDISTRIBUTIONELEMENTTYPE",681481545:"IFCDIMENSIONCURVEDIRECTEDCALLOUT",1457835157:"IFCCURTAINWALLTYPE",3295246426:"IFCCREWRESOURCE",1916426348:"IFCCOVERINGTYPE",1419761937:"IFCCOSTSCHEDULE",3895139033:"IFCCOSTITEM",3293443760:"IFCCONTROL",2559216714:"IFCCONSTRUCTIONRESOURCE",2510884976:"IFCCONIC",3732776249:"IFCCOMPOSITECURVE",300633059:"IFCCOLUMNTYPE",2937912522:"IFCCIRCLEHOLLOWPROFILEDEF",3124254112:"IFCBUILDINGSTOREY",1950629157:"IFCBUILDINGELEMENTTYPE",4031249490:"IFCBUILDING",1260505505:"IFCBOUNDEDCURVE",3649129432:"IFCBOOLEANCLIPPINGRESULT",1334484129:"IFCBLOCK",3207858831:"IFCASYMMETRICISHAPEPROFILEDEF",1674181508:"IFCANNOTATION",2296667514:"IFCACTOR",2097647324:"IFCTRANSPORTELEMENTTYPE",3473067441:"IFCTASK",1580310250:"IFCSYSTEMFURNITUREELEMENTTYPE",4124788165:"IFCSURFACEOFREVOLUTION",2809605785:"IFCSURFACEOFLINEAREXTRUSION",2028607225:"IFCSURFACECURVESWEPTAREASOLID",4070609034:"IFCSTRUCTUREDDIMENSIONCALLOUT",2218152070:"IFCSTRUCTURALSURFACEMEMBERVARYING",3979015343:"IFCSTRUCTURALSURFACEMEMBER",3689010777:"IFCSTRUCTURALREACTION",530289379:"IFCSTRUCTURALMEMBER",3136571912:"IFCSTRUCTURALITEM",3544373492:"IFCSTRUCTURALACTIVITY",451544542:"IFCSPHERE",3893378262:"IFCSPATIALSTRUCTUREELEMENTTYPE",2706606064:"IFCSPATIALSTRUCTUREELEMENT",3626867408:"IFCRIGHTCIRCULARCYLINDER",4158566097:"IFCRIGHTCIRCULARCONE",1856042241:"IFCREVOLVEDAREASOLID",2914609552:"IFCRESOURCE",1401173127:"IFCRELVOIDSELEMENT",3451746338:"IFCRELSPACEBOUNDARY",366585022:"IFCRELSERVICESBUILDINGS",4122056220:"IFCRELSEQUENCE",1058617721:"IFCRELSCHEDULESCOSTITEMS",1245217292:"IFCRELREFERENCEDINSPATIALSTRUCTURE",750771296:"IFCRELPROJECTSELEMENT",202636808:"IFCRELOVERRIDESPROPERTIES",2051452291:"IFCRELOCCUPIESSPACES",3268803585:"IFCRELNESTS",4189434867:"IFCRELINTERACTIONREQUIREMENTS",279856033:"IFCRELFLOWCONTROLELEMENTS",3940055652:"IFCRELFILLSELEMENT",781010003:"IFCRELDEFINESBYTYPE",4186316022:"IFCRELDEFINESBYPROPERTIES",693640335:"IFCRELDEFINES",2551354335:"IFCRELDECOMPOSES",2802773753:"IFCRELCOVERSSPACES",886880790:"IFCRELCOVERSBLDGELEMENTS",3242617779:"IFCRELCONTAINEDINSPATIALSTRUCTURE",3678494232:"IFCRELCONNECTSWITHREALIZINGELEMENTS",504942748:"IFCRELCONNECTSWITHECCENTRICITY",1638771189:"IFCRELCONNECTSSTRUCTURALMEMBER",3912681535:"IFCRELCONNECTSSTRUCTURALELEMENT",2127690289:"IFCRELCONNECTSSTRUCTURALACTIVITY",3190031847:"IFCRELCONNECTSPORTS",4201705270:"IFCRELCONNECTSPORTTOELEMENT",3945020480:"IFCRELCONNECTSPATHELEMENTS",1204542856:"IFCRELCONNECTSELEMENTS",826625072:"IFCRELCONNECTS",2851387026:"IFCRELASSOCIATESPROFILEPROPERTIES",2655215786:"IFCRELASSOCIATESMATERIAL",3840914261:"IFCRELASSOCIATESLIBRARY",982818633:"IFCRELASSOCIATESDOCUMENT",2728634034:"IFCRELASSOCIATESCONSTRAINT",919958153:"IFCRELASSOCIATESCLASSIFICATION",4095574036:"IFCRELASSOCIATESAPPROVAL",1327628568:"IFCRELASSOCIATESAPPLIEDVALUE",1865459582:"IFCRELASSOCIATES",205026976:"IFCRELASSIGNSTORESOURCE",3372526763:"IFCRELASSIGNSTOPROJECTORDER",2857406711:"IFCRELASSIGNSTOPRODUCT",4278684876:"IFCRELASSIGNSTOPROCESS",1307041759:"IFCRELASSIGNSTOGROUP",2495723537:"IFCRELASSIGNSTOCONTROL",1683148259:"IFCRELASSIGNSTOACTOR",3939117080:"IFCRELASSIGNS",3454111270:"IFCRECTANGULARTRIMMEDSURFACE",2798486643:"IFCRECTANGULARPYRAMID",2770003689:"IFCRECTANGLEHOLLOWPROFILEDEF",3219374653:"IFCPROXY",1451395588:"IFCPROPERTYSET",4194566429:"IFCPROJECTIONCURVE",103090709:"IFCPROJECT",4208778838:"IFCPRODUCT",2945172077:"IFCPROCESS",220341763:"IFCPLANE",603570806:"IFCPLANARBOX",3566463478:"IFCPERMEABLECOVERINGPROPERTIES",3505215534:"IFCOFFSETCURVE3D",3388369263:"IFCOFFSETCURVE2D",3888040117:"IFCOBJECT",1425443689:"IFCMANIFOLDSOLIDBREP",1281925730:"IFCLINE",572779678:"IFCLSHAPEPROFILEDEF",1484403080:"IFCISHAPEPROFILEDEF",987898635:"IFCGEOMETRICCURVESET",1268542332:"IFCFURNITURETYPE",4238390223:"IFCFURNISHINGELEMENTTYPE",3455213021:"IFCFLUIDFLOWPROPERTIES",315944413:"IFCFILLAREASTYLETILES",4203026998:"IFCFILLAREASTYLETILESYMBOLWITHSTYLE",374418227:"IFCFILLAREASTYLEHATCHING",2047409740:"IFCFACEBASEDSURFACEMODEL",477187591:"IFCEXTRUDEDAREASOLID",80994333:"IFCENERGYPROPERTIES",2835456948:"IFCELLIPSEPROFILEDEF",2777663545:"IFCELEMENTARYSURFACE",339256511:"IFCELEMENTTYPE",1883228015:"IFCELEMENTQUANTITY",1472233963:"IFCEDGELOOP",4006246654:"IFCDRAUGHTINGPREDEFINEDCURVEFONT",445594917:"IFCDRAUGHTINGPREDEFINEDCOLOUR",3073041342:"IFCDRAUGHTINGCALLOUT",526551008:"IFCDOORSTYLE",1714330368:"IFCDOORPANELPROPERTIES",2963535650:"IFCDOORLININGPROPERTIES",32440307:"IFCDIRECTION",4054601972:"IFCDIMENSIONCURVETERMINATOR",606661476:"IFCDIMENSIONCURVE",693772133:"IFCDEFINEDSYMBOL",2827736869:"IFCCURVEBOUNDEDPLANE",2601014836:"IFCCURVE",2147822146:"IFCCSGSOLID",2506170314:"IFCCSGPRIMITIVE3D",194851669:"IFCCRANERAILFSHAPEPROFILEDEF",4133800736:"IFCCRANERAILASHAPEPROFILEDEF",2485617015:"IFCCOMPOSITECURVESEGMENT",2205249479:"IFCCLOSEDSHELL",1383045692:"IFCCIRCLEPROFILEDEF",1416205885:"IFCCARTESIANTRANSFORMATIONOPERATOR3DNONUNIFORM",3331915920:"IFCCARTESIANTRANSFORMATIONOPERATOR3D",3486308946:"IFCCARTESIANTRANSFORMATIONOPERATOR2DNONUNIFORM",3749851601:"IFCCARTESIANTRANSFORMATIONOPERATOR2D",59481748:"IFCCARTESIANTRANSFORMATIONOPERATOR",1123145078:"IFCCARTESIANPOINT",2898889636:"IFCCSHAPEPROFILEDEF",2713105998:"IFCBOXEDHALFSPACE",2581212453:"IFCBOUNDINGBOX",4182860854:"IFCBOUNDEDSURFACE",2736907675:"IFCBOOLEANRESULT",2740243338:"IFCAXIS2PLACEMENT3D",3125803723:"IFCAXIS2PLACEMENT2D",4261334040:"IFCAXIS1PLACEMENT",1302238472:"IFCANNOTATIONSURFACE",2265737646:"IFCANNOTATIONFILLAREAOCCURRENCE",669184980:"IFCANNOTATIONFILLAREA",3288037868:"IFCANNOTATIONCURVEOCCURRENCE",2543172580:"IFCZSHAPEPROFILEDEF",1299126871:"IFCWINDOWSTYLE",512836454:"IFCWINDOWPANELPROPERTIES",336235671:"IFCWINDOWLININGPROPERTIES",2759199220:"IFCVERTEXLOOP",1417489154:"IFCVECTOR",427810014:"IFCUSHAPEPROFILEDEF",2347495698:"IFCTYPEPRODUCT",1628702193:"IFCTYPEOBJECT",1345879162:"IFCTWODIRECTIONREPEATFACTOR",2715220739:"IFCTRAPEZIUMPROFILEDEF",3124975700:"IFCTEXTLITERALWITHEXTENT",4282788508:"IFCTEXTLITERAL",3028897424:"IFCTERMINATORSYMBOL",3071757647:"IFCTSHAPEPROFILEDEF",230924584:"IFCSWEPTSURFACE",1260650574:"IFCSWEPTDISKSOLID",2247615214:"IFCSWEPTAREASOLID",1878645084:"IFCSURFACESTYLERENDERING",2513912981:"IFCSURFACE",2233826070:"IFCSUBEDGE",3653947884:"IFCSTRUCTURALSTEELPROFILEPROPERTIES",3843319758:"IFCSTRUCTURALPROFILEPROPERTIES",1190533807:"IFCSTRUCTURALLOADSINGLEFORCEWARPING",1597423693:"IFCSTRUCTURALLOADSINGLEFORCE",1973038258:"IFCSTRUCTURALLOADSINGLEDISPLACEMENTDISTORTION",2473145415:"IFCSTRUCTURALLOADSINGLEDISPLACEMENT",2668620305:"IFCSTRUCTURALLOADPLANARFORCE",1595516126:"IFCSTRUCTURALLOADLINEARFORCE",390701378:"IFCSPACETHERMALLOADPROPERTIES",1202362311:"IFCSOUNDVALUE",2485662743:"IFCSOUNDPROPERTIES",723233188:"IFCSOLIDMODEL",2609359061:"IFCSLIPPAGECONNECTIONCONDITION",4124623270:"IFCSHELLBASEDSURFACEMODEL",2411513650:"IFCSERVICELIFEFACTOR",1509187699:"IFCSECTIONEDSPINE",2778083089:"IFCROUNDEDRECTANGLEPROFILEDEF",478536968:"IFCRELATIONSHIP",3765753017:"IFCREINFORCEMENTDEFINITIONPROPERTIES",3413951693:"IFCREGULARTIMESERIES",3615266464:"IFCRECTANGLEPROFILEDEF",110355661:"IFCPROPERTYTABLEVALUE",3650150729:"IFCPROPERTYSINGLEVALUE",3357820518:"IFCPROPERTYSETDEFINITION",941946838:"IFCPROPERTYREFERENCEVALUE",2752243245:"IFCPROPERTYLISTVALUE",4166981789:"IFCPROPERTYENUMERATEDVALUE",1680319473:"IFCPROPERTYDEFINITION",871118103:"IFCPROPERTYBOUNDEDVALUE",673634403:"IFCPRODUCTDEFINITIONSHAPE",179317114:"IFCPREDEFINEDPOINTMARKERSYMBOL",433424934:"IFCPREDEFINEDDIMENSIONSYMBOL",2559016684:"IFCPREDEFINEDCURVEFONT",759155922:"IFCPREDEFINEDCOLOUR",2775532180:"IFCPOLYGONALBOUNDEDHALFSPACE",2924175390:"IFCPOLYLOOP",1423911732:"IFCPOINTONSURFACE",4022376103:"IFCPOINTONCURVE",2067069095:"IFCPOINT",1663979128:"IFCPLANAREXTENT",2004835150:"IFCPLACEMENT",597895409:"IFCPIXELTEXTURE",3021840470:"IFCPHYSICALCOMPLEXQUANTITY",2519244187:"IFCPATH",2529465313:"IFCPARAMETERIZEDPROFILEDEF",1029017970:"IFCORIENTEDEDGE",2665983363:"IFCOPENSHELL",2833995503:"IFCONEDIRECTIONREPEATFACTOR",219451334:"IFCOBJECTDEFINITION",1430189142:"IFCMECHANICALCONCRETEMATERIALPROPERTIES",2022407955:"IFCMATERIALDEFINITIONREPRESENTATION",2347385850:"IFCMAPPEDITEM",1008929658:"IFCLOOP",2624227202:"IFCLOCALPLACEMENT",3422422726:"IFCLIGHTSOURCESPOT",1520743889:"IFCLIGHTSOURCEPOSITIONAL",4266656042:"IFCLIGHTSOURCEGONIOMETRIC",2604431987:"IFCLIGHTSOURCEDIRECTIONAL",125510826:"IFCLIGHTSOURCEAMBIENT",1402838566:"IFCLIGHTSOURCE",3741457305:"IFCIRREGULARTIMESERIES",3905492369:"IFCIMAGETEXTURE",2445078500:"IFCHYGROSCOPICMATERIALPROPERTIES",812098782:"IFCHALFSPACESOLID",178086475:"IFCGRIDPLACEMENT",3590301190:"IFCGEOMETRICSET",4142052618:"IFCGEOMETRICREPRESENTATIONSUBCONTEXT",2453401579:"IFCGEOMETRICREPRESENTATIONITEM",3448662350:"IFCGEOMETRICREPRESENTATIONCONTEXT",1446786286:"IFCGENERALPROFILEPROPERTIES",803998398:"IFCGENERALMATERIALPROPERTIES",3857492461:"IFCFUELPROPERTIES",738692330:"IFCFILLAREASTYLE",4219587988:"IFCFAILURECONNECTIONCONDITION",3008276851:"IFCFACESURFACE",803316827:"IFCFACEOUTERBOUND",1809719519:"IFCFACEBOUND",2556980723:"IFCFACE",1860660968:"IFCEXTENDEDMATERIALPROPERTIES",476780140:"IFCEDGECURVE",3900360178:"IFCEDGE",4170525392:"IFCDRAUGHTINGPREDEFINEDTEXTFONT",3732053477:"IFCDOCUMENTREFERENCE",1694125774:"IFCDIMENSIONPAIR",2273265877:"IFCDIMENSIONCALLOUTRELATIONSHIP",3632507154:"IFCDERIVEDPROFILEDEF",3800577675:"IFCCURVESTYLE",2889183280:"IFCCONVERSIONBASEDUNIT",3050246964:"IFCCONTEXTDEPENDENTUNIT",45288368:"IFCCONNECTIONPOINTECCENTRICITY",1981873012:"IFCCONNECTIONCURVEGEOMETRY",370225590:"IFCCONNECTEDFACESET",1485152156:"IFCCOMPOSITEPROFILEDEF",2542286263:"IFCCOMPLEXPROPERTY",776857604:"IFCCOLOURRGB",647927063:"IFCCLASSIFICATIONREFERENCE",3150382593:"IFCCENTERLINEPROFILEDEF",616511568:"IFCBLOBTEXTURE",2705031697:"IFCARBITRARYPROFILEDEFWITHVOIDS",1310608509:"IFCARBITRARYOPENPROFILEDEF",3798115385:"IFCARBITRARYCLOSEDPROFILEDEF",2297822566:"IFCANNOTATIONTEXTOCCURRENCE",3612888222:"IFCANNOTATIONSYMBOLOCCURRENCE",962685235:"IFCANNOTATIONSURFACEOCCURRENCE",2442683028:"IFCANNOTATIONOCCURRENCE",1065908215:"IFCWATERPROPERTIES",891718957:"IFCVIRTUALGRIDINTERSECTION",1907098498:"IFCVERTEXPOINT",3304826586:"IFCVERTEXBASEDTEXTUREMAP",2799835756:"IFCVERTEX",180925521:"IFCUNITASSIGNMENT",1735638870:"IFCTOPOLOGYREPRESENTATION",1377556343:"IFCTOPOLOGICALREPRESENTATIONITEM",581633288:"IFCTIMESERIESVALUE",1718945513:"IFCTIMESERIESREFERENCERELATIONSHIP",3101149627:"IFCTIMESERIES",3317419933:"IFCTHERMALMATERIALPROPERTIES",1210645708:"IFCTEXTUREVERTEX",2552916305:"IFCTEXTUREMAP",1742049831:"IFCTEXTURECOORDINATEGENERATOR",280115917:"IFCTEXTURECOORDINATE",1484833681:"IFCTEXTSTYLEWITHBOXCHARACTERISTICS",1640371178:"IFCTEXTSTYLETEXTMODEL",2636378356:"IFCTEXTSTYLEFORDEFINEDFONT",1983826977:"IFCTEXTSTYLEFONTMODEL",1447204868:"IFCTEXTSTYLE",912023232:"IFCTELECOMADDRESS",531007025:"IFCTABLEROW",985171141:"IFCTABLE",1290481447:"IFCSYMBOLSTYLE",626085974:"IFCSURFACETEXTURE",1351298697:"IFCSURFACESTYLEWITHTEXTURES",846575682:"IFCSURFACESTYLESHADING",1607154358:"IFCSURFACESTYLEREFRACTION",3303107099:"IFCSURFACESTYLELIGHTING",1300840506:"IFCSURFACESTYLE",3049322572:"IFCSTYLEDREPRESENTATION",3958052878:"IFCSTYLEDITEM",2830218821:"IFCSTYLEMODEL",3408363356:"IFCSTRUCTURALLOADTEMPERATURE",2525727697:"IFCSTRUCTURALLOADSTATIC",2162789131:"IFCSTRUCTURALLOAD",2273995522:"IFCSTRUCTURALCONNECTIONCONDITION",3692461612:"IFCSIMPLEPROPERTY",4240577450:"IFCSHAPEREPRESENTATION",3982875396:"IFCSHAPEMODEL",867548509:"IFCSHAPEASPECT",4165799628:"IFCSECTIONREINFORCEMENTPROPERTIES",2042790032:"IFCSECTIONPROPERTIES",448429030:"IFCSIUNIT",2341007311:"IFCROOT",3679540991:"IFCRIBPLATEPROFILEPROPERTIES",1660063152:"IFCREPRESENTATIONMAP",3008791417:"IFCREPRESENTATIONITEM",3377609919:"IFCREPRESENTATIONCONTEXT",1076942058:"IFCREPRESENTATION",1222501353:"IFCRELAXATION",1580146022:"IFCREINFORCEMENTBARPROPERTIES",2692823254:"IFCREFERENCESVALUEDOCUMENT",825690147:"IFCQUANTITYWEIGHT",2405470396:"IFCQUANTITYVOLUME",3252649465:"IFCQUANTITYTIME",931644368:"IFCQUANTITYLENGTH",2093928680:"IFCQUANTITYCOUNT",2044713172:"IFCQUANTITYAREA",3710013099:"IFCPROPERTYENUMERATION",148025276:"IFCPROPERTYDEPENDENCYRELATIONSHIP",3896028662:"IFCPROPERTYCONSTRAINTRELATIONSHIP",2598011224:"IFCPROPERTY",2802850158:"IFCPROFILEPROPERTIES",3958567839:"IFCPROFILEDEF",2267347899:"IFCPRODUCTSOFCOMBUSTIONPROPERTIES",2095639259:"IFCPRODUCTREPRESENTATION",2417041796:"IFCPRESENTATIONSTYLEASSIGNMENT",3119450353:"IFCPRESENTATIONSTYLE",1304840413:"IFCPRESENTATIONLAYERWITHSTYLE",2022622350:"IFCPRESENTATIONLAYERASSIGNMENT",1775413392:"IFCPREDEFINEDTEXTFONT",3213052703:"IFCPREDEFINEDTERMINATORSYMBOL",990879717:"IFCPREDEFINEDSYMBOL",3727388367:"IFCPREDEFINEDITEM",3355820592:"IFCPOSTALADDRESS",2226359599:"IFCPHYSICALSIMPLEQUANTITY",2483315170:"IFCPHYSICALQUANTITY",101040310:"IFCPERSONANDORGANIZATION",2077209135:"IFCPERSON",1207048766:"IFCOWNERHISTORY",1411181986:"IFCORGANIZATIONRELATIONSHIP",4251960020:"IFCORGANIZATION",1227763645:"IFCOPTICALMATERIALPROPERTIES",2251480897:"IFCOBJECTIVE",3701648758:"IFCOBJECTPLACEMENT",1918398963:"IFCNAMEDUNIT",2706619895:"IFCMONETARYUNIT",3368373690:"IFCMETRIC",677618848:"IFCMECHANICALSTEELMATERIALPROPERTIES",4256014907:"IFCMECHANICALMATERIALPROPERTIES",2597039031:"IFCMEASUREWITHUNIT",3265635763:"IFCMATERIALPROPERTIES",2199411900:"IFCMATERIALLIST",1303795690:"IFCMATERIALLAYERSETUSAGE",3303938423:"IFCMATERIALLAYERSET",248100487:"IFCMATERIALLAYER",1847130766:"IFCMATERIALCLASSIFICATIONRELATIONSHIP",1838606355:"IFCMATERIAL",30780891:"IFCLOCALTIME",1566485204:"IFCLIGHTINTENSITYDISTRIBUTION",4162380809:"IFCLIGHTDISTRIBUTIONDATA",3452421091:"IFCLIBRARYREFERENCE",2655187982:"IFCLIBRARYINFORMATION",3020489413:"IFCIRREGULARTIMESERIESVALUE",852622518:"IFCGRIDAXIS",3548104201:"IFCEXTERNALLYDEFINEDTEXTFONT",3207319532:"IFCEXTERNALLYDEFINEDSYMBOL",1040185647:"IFCEXTERNALLYDEFINEDSURFACESTYLE",2242383968:"IFCEXTERNALLYDEFINEDHATCHSTYLE",3200245327:"IFCEXTERNALREFERENCE",1648886627:"IFCENVIRONMENTALIMPACTVALUE",3796139169:"IFCDRAUGHTINGCALLOUTRELATIONSHIP",770865208:"IFCDOCUMENTINFORMATIONRELATIONSHIP",1154170062:"IFCDOCUMENTINFORMATION",1376555844:"IFCDOCUMENTELECTRONICFORMAT",2949456006:"IFCDIMENSIONALEXPONENTS",1045800335:"IFCDERIVEDUNITELEMENT",1765591967:"IFCDERIVEDUNIT",1072939445:"IFCDATEANDTIME",3510044353:"IFCCURVESTYLEFONTPATTERN",2367409068:"IFCCURVESTYLEFONTANDSCALING",1105321065:"IFCCURVESTYLEFONT",539742890:"IFCCURRENCYRELATIONSHIP",602808272:"IFCCOSTVALUE",1065062679:"IFCCOORDINATEDUNIVERSALTIMEOFFSET",347226245:"IFCCONSTRAINTRELATIONSHIP",613356794:"IFCCONSTRAINTCLASSIFICATIONRELATIONSHIP",1658513725:"IFCCONSTRAINTAGGREGATIONRELATIONSHIP",1959218052:"IFCCONSTRAINT",2732653382:"IFCCONNECTIONSURFACEGEOMETRY",4257277454:"IFCCONNECTIONPORTGEOMETRY",2614616156:"IFCCONNECTIONPOINTGEOMETRY",2859738748:"IFCCONNECTIONGEOMETRY",3264961684:"IFCCOLOURSPECIFICATION",3639012971:"IFCCLASSIFICATIONNOTATIONFACET",938368621:"IFCCLASSIFICATIONNOTATION",1098599126:"IFCCLASSIFICATIONITEMRELATIONSHIP",1767535486:"IFCCLASSIFICATIONITEM",747523909:"IFCCLASSIFICATION",622194075:"IFCCALENDARDATE",2069777674:"IFCBOUNDARYNODECONDITIONWARPING",1387855156:"IFCBOUNDARYNODECONDITION",3367102660:"IFCBOUNDARYFACECONDITION",1560379544:"IFCBOUNDARYEDGECONDITION",4037036970:"IFCBOUNDARYCONDITION",3869604511:"IFCAPPROVALRELATIONSHIP",390851274:"IFCAPPROVALPROPERTYRELATIONSHIP",2080292479:"IFCAPPROVALACTORRELATIONSHIP",130549933:"IFCAPPROVAL",1110488051:"IFCAPPLIEDVALUERELATIONSHIP",411424972:"IFCAPPLIEDVALUE",639542469:"IFCAPPLICATION",618182010:"IFCADDRESS",3630933823:"IFCACTORROLE",599546466:"FILE_DESCRIPTION",1390159747:"FILE_NAME",1109904537:"FILE_SCHEMA"};let Ds=class{constructor(){O(this,"enabled",!0),O(this,"trigger",(t=>{if(!this.enabled)return;const e=this.handlers.slice(0);for(const s of e)s(t)})),O(this,"handlers",[])}add(t){this.handlers.push(t)}remove(t){this.handlers=this.handlers.filter((e=>e!==t))}reset(){this.handlers.length=0}},UL=class{constructor(){O(this,"enabled",!0),O(this,"trigger",(async t=>{if(!this.enabled)return;const e=this.handlers.slice(0);for(const s of e)await s(t)})),O(this,"handlers",[])}add(t){this.handlers.push(t)}remove(t){this.handlers=this.handlers.filter((e=>e!==t))}reset(){this.handlers.length=0}},Yt=class extends Map{constructor(t){super(t),O(this,"onItemSet",new Ds),O(this,"onItemUpdated",new Ds),O(this,"onItemDeleted",new Ds),O(this,"onBeforeDelete",new Ds),O(this,"onCleared",new Ds),O(this,"guard",(()=>!0))}set eventsEnabled(t){this.onItemSet.enabled=t,this.onItemUpdated.enabled=t,this.onItemDeleted.enabled=t,this.onBeforeDelete.enabled=t,this.onCleared.enabled=t}clear(){for(const[t,e]of this)this.onBeforeDelete.trigger({key:t,value:e});super.clear(),this.onCleared.trigger()}set(t,e){const s=this.has(t);if(!(this.guard??(()=>!0))(t,e))return this;const i=super.set(t,e);return s?(this.onItemUpdated||(this.onItemUpdated=new Ds),this.onItemUpdated.trigger({key:t,value:e})):(this.onItemSet||(this.onItemSet=new Ds),this.onItemSet.trigger({key:t,value:e})),i}delete(t){const e=this.get(t);if(!e)return!1;this.onBeforeDelete.trigger({key:t,value:e});const s=super.delete(t);return s&&this.onItemDeleted.trigger(t),s}getKey(t){for(const[e,s]of this)if(s===t)return e}update(t){const e=this.getKey(t);e&&this.set(e,t)}deleteIf(t){for(const[e,s]of this)t(s,e)&&this.delete(e)}replaceKey(t,e,s=!1){const i=this.get(t);return i?!(this.get(e)&&!s)&&(this.eventsEnabled=!1,this.delete(t),this.eventsEnabled=!0,this.set(e,i),!0):!1}dispose(){this.clear(),this.onItemSet.reset(),this.onItemDeleted.reset(),this.onItemUpdated.reset(),this.onCleared.reset(),this.onBeforeDelete.reset()}},fe=class extends Set{constructor(t){super(t),O(this,"onUpdated",new Ds),O(this,"onItemAdded",new Ds),O(this,"onBeforeDelete",new Ds),O(this,"onItemDeleted",new Ds),O(this,"onCleared",new Ds),O(this,"guard",(()=>!0))}set eventsEnabled(t){this.onUpdated.enabled=t,this.onItemAdded.enabled=t,this.onItemDeleted.enabled=t,this.onBeforeDelete.enabled=t,this.onCleared.enabled=t}clear(){for(const t of this)this.onBeforeDelete.trigger(t);super.clear(),this.onCleared.trigger(),this.onUpdated.trigger()}add(...t){for(const e of t)this.has(e)||(this.guard??(()=>!0))(e)&&(super.add(e),this.onItemAdded||(this.onItemAdded=new Ds),this.onItemAdded.trigger(e));return this.onUpdated||(this.onUpdated=new Ds),this.onUpdated.trigger(),this}delete(t){if(!this.has(t))return!1;this.onBeforeDelete.trigger(t);const e=super.delete(t);return e&&(this.onItemDeleted.trigger(),this.onUpdated.trigger()),e}deleteIf(t){for(const e of this)t(e)&&this.delete(e)}getIndex(t){let e=0;for(const s of this){if(s===t)return e;e++}return-1}dispose(){this.clear(),this.onItemAdded.reset(),this.onItemDeleted.reset(),this.onCleared.reset(),this.onBeforeDelete.reset(),this.onUpdated.reset()}};const po=new Int32Array(2),yw=new Float32Array(po.buffer),vw=new Float64Array(po.buffer),pp=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var i0,fp;(fp=i0||(i0={}))[fp.UTF8_BYTES=1]="UTF8_BYTES",fp[fp.UTF16_STRING=2]="UTF16_STRING";let n0=class EC{constructor(t){this.bytes_=t,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(t){return new EC(new Uint8Array(t))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(t){this.position_=t}capacity(){return this.bytes_.length}readInt8(t){return this.readUint8(t)<<24>>24}readUint8(t){return this.bytes_[t]}readInt16(t){return this.readUint16(t)<<16>>16}readUint16(t){return this.bytes_[t]|this.bytes_[t+1]<<8}readInt32(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24}readUint32(t){return this.readInt32(t)>>>0}readInt64(t){return BigInt.asIntN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readUint64(t){return BigInt.asUintN(64,BigInt(this.readUint32(t))+(BigInt(this.readUint32(t+4))<<BigInt(32)))}readFloat32(t){return po[0]=this.readInt32(t),yw[0]}readFloat64(t){return po[pp?0:1]=this.readInt32(t),po[pp?1:0]=this.readInt32(t+4),vw[0]}writeInt8(t,e){this.bytes_[t]=e}writeUint8(t,e){this.bytes_[t]=e}writeInt16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeUint16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeInt32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeUint32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeInt64(t,e){this.writeInt32(t,Number(BigInt.asIntN(32,e))),this.writeInt32(t+4,Number(BigInt.asIntN(32,e>>BigInt(32))))}writeUint64(t,e){this.writeUint32(t,Number(BigInt.asUintN(32,e))),this.writeUint32(t+4,Number(BigInt.asUintN(32,e>>BigInt(32))))}writeFloat32(t,e){yw[0]=e,this.writeInt32(t,po[0])}writeFloat64(t,e){vw[0]=e,this.writeInt32(t,po[pp?0:1]),this.writeInt32(t+4,po[pp?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+4+4)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let t="";for(let e=0;e<4;e++)t+=String.fromCharCode(this.readInt8(this.position_+4+e));return t}__offset(t,e){const s=t-this.readInt32(t);return e<this.readInt16(s)?this.readInt16(s+e):0}__union(t,e){return t.bb_pos=e+this.readInt32(e),t.bb=this,t}__string(t,e){t+=this.readInt32(t);const s=this.readInt32(t);t+=4;const i=this.bytes_.subarray(t,t+s);return e===i0.UTF8_BYTES?i:this.text_decoder_.decode(i)}__union_with_string(t,e){return typeof t=="string"?this.__string(e):this.__union(t,e)}__indirect(t){return t+this.readInt32(t)}__vector(t){return t+this.readInt32(t)+4}__vector_len(t){return this.readInt32(t+this.readInt32(t))}__has_identifier(t){if(t.length!=4)throw new Error("FlatBuffers: file identifier must be length 4");for(let e=0;e<4;e++)if(t.charCodeAt(e)!=this.readInt8(this.position()+4+e))return!1;return!0}createScalarList(t,e){const s=[];for(let i=0;i<e;++i){const r=t(i);r!==null&&s.push(r)}return s}createObjList(t,e){const s=[];for(let i=0;i<e;++i){const r=t(i);r!==null&&s.push(r.unpack())}return s}},VL=class xC{constructor(t){let e;this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null,this.text_encoder=new TextEncoder,e=t||1024,this.bb=n0.allocate(e),this.space=e}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(t){this.force_defaults=t}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(t,e){t>this.minalign&&(this.minalign=t);const s=1+~(this.bb.capacity()-this.space+e)&t-1;for(;this.space<s+t+e;){const i=this.bb.capacity();this.bb=xC.growByteBuffer(this.bb),this.space+=this.bb.capacity()-i}this.pad(s)}pad(t){for(let e=0;e<t;e++)this.bb.writeInt8(--this.space,0)}writeInt8(t){this.bb.writeInt8(this.space-=1,t)}writeInt16(t){this.bb.writeInt16(this.space-=2,t)}writeInt32(t){this.bb.writeInt32(this.space-=4,t)}writeInt64(t){this.bb.writeInt64(this.space-=8,t)}writeFloat32(t){this.bb.writeFloat32(this.space-=4,t)}writeFloat64(t){this.bb.writeFloat64(this.space-=8,t)}addInt8(t){this.prep(1,0),this.writeInt8(t)}addInt16(t){this.prep(2,0),this.writeInt16(t)}addInt32(t){this.prep(4,0),this.writeInt32(t)}addInt64(t){this.prep(8,0),this.writeInt64(t)}addFloat32(t){this.prep(4,0),this.writeFloat32(t)}addFloat64(t){this.prep(8,0),this.writeFloat64(t)}addFieldInt8(t,e,s){(this.force_defaults||e!=s)&&(this.addInt8(e),this.slot(t))}addFieldInt16(t,e,s){(this.force_defaults||e!=s)&&(this.addInt16(e),this.slot(t))}addFieldInt32(t,e,s){(this.force_defaults||e!=s)&&(this.addInt32(e),this.slot(t))}addFieldInt64(t,e,s){(this.force_defaults||e!==s)&&(this.addInt64(e),this.slot(t))}addFieldFloat32(t,e,s){(this.force_defaults||e!=s)&&(this.addFloat32(e),this.slot(t))}addFieldFloat64(t,e,s){(this.force_defaults||e!=s)&&(this.addFloat64(e),this.slot(t))}addFieldOffset(t,e,s){(this.force_defaults||e!=s)&&(this.addOffset(e),this.slot(t))}addFieldStruct(t,e,s){e!=s&&(this.nested(e),this.slot(t))}nested(t){if(t!=this.offset())throw new TypeError("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new TypeError("FlatBuffers: object serialization must not be nested.")}slot(t){this.vtable!==null&&(this.vtable[t]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(t){const e=t.capacity();if(3221225472&e)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const s=e<<1,i=n0.allocate(s);return i.setPosition(s-e),i.bytes().set(t.bytes(),s-e),i}addOffset(t){this.prep(4,0),this.writeInt32(this.offset()-t+4)}startObject(t){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=t;for(let e=0;e<t;e++)this.vtable[e]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const t=this.offset();let e=this.vtable_in_use-1;for(;e>=0&&this.vtable[e]==0;e--);const s=e+1;for(;e>=0;e--)this.addInt16(this.vtable[e]!=0?t-this.vtable[e]:0);this.addInt16(t-this.object_start);const i=2*(s+2);this.addInt16(i);let r=0;const o=this.space;t:for(e=0;e<this.vtables.length;e++){const a=this.bb.capacity()-this.vtables[e];if(i==this.bb.readInt16(a)){for(let l=2;l<i;l+=2)if(this.bb.readInt16(o+l)!=this.bb.readInt16(a+l))continue t;r=this.vtables[e];break}}return r?(this.space=this.bb.capacity()-t,this.bb.writeInt32(this.space,r-t)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-t,this.offset()-t)),this.isNested=!1,t}finish(t,e,s){const i=s?4:0;if(e){const r=e;if(this.prep(this.minalign,8+i),r.length!=4)throw new TypeError("FlatBuffers: file identifier must be length 4");for(let o=3;o>=0;o--)this.writeInt8(r.charCodeAt(o))}this.prep(this.minalign,4+i),this.addOffset(t),i&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(t,e){this.finish(t,e,!0)}requiredField(t,e){const s=this.bb.capacity()-t,i=s-this.bb.readInt32(s);if(!(e<this.bb.readInt16(i)&&this.bb.readInt16(i+e)!=0))throw new TypeError("FlatBuffers: field "+e+" must be set")}startVector(t,e,s){this.notNested(),this.vector_num_elems=e,this.prep(4,t*e),this.prep(s,t*e)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(t){if(!t)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(t))return this.string_maps.get(t);const e=this.createString(t);return this.string_maps.set(t,e),e}createString(t){if(t==null)return 0;let e;return e=t instanceof Uint8Array?t:this.text_encoder.encode(t),this.addInt8(0),this.startVector(1,e.length,1),this.bb.setPosition(this.space-=e.length),this.bb.bytes().set(e,this.space),this.endVector()}createByteVector(t){return t==null?0:(this.startVector(1,t.length,1),this.bb.setPosition(this.space-=t.length),this.bb.bytes().set(t,this.space),this.endVector())}createObjectOffset(t){return t===null?0:typeof t=="string"?this.createString(t):t.pack(this)}createObjectOffsetList(t){const e=[];for(let s=0;s<t.length;++s){const i=t[s];if(i===null)throw new TypeError("FlatBuffers: Argument for createObjectOffsetList cannot contain null.");e.push(this.createObjectOffset(i))}return e}createStructOffsetList(t,e){return e(this,t.length),this.createObjectOffsetList(t.slice().reverse()),this.endVector()}},uc=class no{constructor(){O(this,"bb",null),O(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsAlignment(t,e){return(e||new no).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsAlignment(t,e){return t.setPosition(t.position()+4),(e||new no).__init(t.readInt32(t.position())+t.position(),t)}absolute(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}absoluteLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}absoluteArray(){const t=this.bb.__offset(this.bb_pos,4);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}horizontal(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}horizontalLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}horizontalArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}vertical(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}verticalLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}verticalArray(){const t=this.bb.__offset(this.bb_pos,8);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}static startAlignment(t){t.startObject(3)}static addAbsolute(t,e){t.addFieldOffset(0,e,0)}static createAbsoluteVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addInt32(e[s]);return t.endVector()}static startAbsoluteVector(t,e){t.startVector(4,e,4)}static addHorizontal(t,e){t.addFieldOffset(1,e,0)}static createHorizontalVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addInt32(e[s]);return t.endVector()}static startHorizontalVector(t,e){t.startVector(4,e,4)}static addVertical(t,e){t.addFieldOffset(2,e,0)}static createVerticalVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addInt32(e[s]);return t.endVector()}static startVerticalVector(t,e){t.startVector(4,e,4)}static endAlignment(t){return t.endObject()}static createAlignment(t,e,s,i){return no.startAlignment(t),no.addAbsolute(t,e),no.addHorizontal(t,s),no.addVertical(t,i),no.endAlignment(t)}},Am=class Xl{constructor(){O(this,"bb",null),O(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsAttribute(t,e){return(e||new Xl).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsAttribute(t,e){return t.setPosition(t.position()+4),(e||new Xl).__init(t.readInt32(t.position())+t.position(),t)}data(t,e){const s=this.bb.__offset(this.bb_pos,4);return s?this.bb.__string(this.bb.__vector(this.bb_pos+s)+4*t,e):null}dataLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}static startAttribute(t){t.startObject(1)}static addData(t,e){t.addFieldOffset(0,e,0)}static createDataVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startDataVector(t,e){t.startVector(4,e,4)}static endAttribute(t){const e=t.endObject();return t.requiredField(e,4),e}static createAttribute(t,e){return Xl.startAttribute(t),Xl.addData(t,e),Xl.endAttribute(t)}},rs=class{constructor(){O(this,"bb",null),O(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}x(){return this.bb.readFloat32(this.bb_pos)}mutate_x(t){return this.bb.writeFloat32(this.bb_pos+0,t),!0}y(){return this.bb.readFloat32(this.bb_pos+4)}mutate_y(t){return this.bb.writeFloat32(this.bb_pos+4,t),!0}z(){return this.bb.readFloat32(this.bb_pos+8)}mutate_z(t){return this.bb.writeFloat32(this.bb_pos+8,t),!0}static sizeOf(){return 12}static createFloatVector(t,e,s,i){return t.prep(4,12),t.writeFloat32(i),t.writeFloat32(s),t.writeFloat32(e),t.offset()}},zd=class{constructor(){O(this,"bb",null),O(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}aperture(){return this.bb.readFloat32(this.bb_pos)}mutate_aperture(t){return this.bb.writeFloat32(this.bb_pos+0,t),!0}position(t){return(t||new rs).__init(this.bb_pos+4,this.bb)}radius(){return this.bb.readFloat32(this.bb_pos+16)}mutate_radius(t){return this.bb.writeFloat32(this.bb_pos+16,t),!0}xDirection(t){return(t||new rs).__init(this.bb_pos+20,this.bb)}yDirection(t){return(t||new rs).__init(this.bb_pos+32,this.bb)}static sizeOf(){return 44}static createCircleCurve(t,e,s,i,r,o,a,l,c,h,u,p){return t.prep(4,44),t.prep(4,12),t.writeFloat32(p),t.writeFloat32(u),t.writeFloat32(h),t.prep(4,12),t.writeFloat32(c),t.writeFloat32(l),t.writeFloat32(a),t.writeFloat32(o),t.prep(4,12),t.writeFloat32(r),t.writeFloat32(i),t.writeFloat32(s),t.writeFloat32(e),t.offset()}},fg=class{constructor(){O(this,"bb",null),O(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}p1(t){return(t||new rs).__init(this.bb_pos,this.bb)}p2(t){return(t||new rs).__init(this.bb_pos+12,this.bb)}static sizeOf(){return 24}static createWire(t,e,s,i,r,o,a){return t.prep(4,24),t.prep(4,12),t.writeFloat32(a),t.writeFloat32(o),t.writeFloat32(r),t.prep(4,12),t.writeFloat32(i),t.writeFloat32(s),t.writeFloat32(e),t.offset()}},mg=class Ql{constructor(){O(this,"bb",null),O(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsWireSet(t,e){return(e||new Ql).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsWireSet(t,e){return t.setPosition(t.position()+4),(e||new Ql).__init(t.readInt32(t.position())+t.position(),t)}ps(t,e){const s=this.bb.__offset(this.bb_pos,4);return s?(e||new rs).__init(this.bb.__vector(this.bb_pos+s)+12*t,this.bb):null}psLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}static startWireSet(t){t.startObject(1)}static addPs(t,e){t.addFieldOffset(0,e,0)}static startPsVector(t,e){t.startVector(12,e,4)}static endWireSet(t){return t.endObject()}static createWireSet(t,e){return Ql.startWireSet(t),Ql.addPs(t,e),Ql.endWireSet(t)}},hs=class Qn{constructor(){O(this,"bb",null),O(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsAxis(t,e){return(e||new Qn).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsAxis(t,e){return t.setPosition(t.position()+4),(e||new Qn).__init(t.readInt32(t.position())+t.position(),t)}wires(t,e){const s=this.bb.__offset(this.bb_pos,4);return s?(e||new fg).__init(this.bb.__vector(this.bb_pos+s)+24*t,this.bb):null}wiresLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}order(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}orderLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}orderArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}parts(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readInt8(this.bb.__vector(this.bb_pos+e)+t):0}partsLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}partsArray(){const t=this.bb.__offset(this.bb_pos,8);return t?new Int8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}wireSets(t,e){const s=this.bb.__offset(this.bb_pos,10);return s?(e||new mg).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}wireSetsLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}circleCurves(t,e){const s=this.bb.__offset(this.bb_pos,12);return s?(e||new zd).__init(this.bb.__vector(this.bb_pos+s)+44*t,this.bb):null}circleCurvesLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}static startAxis(t){t.startObject(5)}static addWires(t,e){t.addFieldOffset(0,e,0)}static startWiresVector(t,e){t.startVector(24,e,4)}static addOrder(t,e){t.addFieldOffset(1,e,0)}static createOrderVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addInt32(e[s]);return t.endVector()}static startOrderVector(t,e){t.startVector(4,e,4)}static addParts(t,e){t.addFieldOffset(2,e,0)}static createPartsVector(t,e){t.startVector(1,e.length,1);for(let s=e.length-1;s>=0;s--)t.addInt8(e[s]);return t.endVector()}static startPartsVector(t,e){t.startVector(1,e,1)}static addWireSets(t,e){t.addFieldOffset(3,e,0)}static createWireSetsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startWireSetsVector(t,e){t.startVector(4,e,4)}static addCircleCurves(t,e){t.addFieldOffset(4,e,0)}static startCircleCurvesVector(t,e){t.startVector(44,e,4)}static endAxis(t){const e=t.endObject();return t.requiredField(e,4),t.requiredField(e,6),t.requiredField(e,8),t.requiredField(e,10),t.requiredField(e,12),e}static createAxis(t,e,s,i,r,o){return Qn.startAxis(t),Qn.addWires(t,e),Qn.addOrder(t,s),Qn.addParts(t,i),Qn.addWireSets(t,r),Qn.addCircleCurves(t,o),Qn.endAxis(t)}};var $e=(n=>(n[n.NONE=0]="NONE",n[n.WIRE=1]="WIRE",n[n.WIRE_SET=2]="WIRE_SET",n[n.CIRCLE_CURVE=3]="CIRCLE_CURVE",n))($e||{});let Ya=class ga{constructor(){O(this,"bb",null),O(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsBigShellHole(t,e){return(e||new ga).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBigShellHole(t,e){return t.setPosition(t.position()+4),(e||new ga).__init(t.readInt32(t.position())+t.position(),t)}indices(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}indicesLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}indicesArray(){const t=this.bb.__offset(this.bb_pos,4);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}profileId(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint16(this.bb_pos+t):0}mutate_profile_id(t){const e=this.bb.__offset(this.bb_pos,6);return e!==0&&(this.bb.writeUint16(this.bb_pos+e,t),!0)}static startBigShellHole(t){t.startObject(2)}static addIndices(t,e){t.addFieldOffset(0,e,0)}static createIndicesVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addInt32(e[s]);return t.endVector()}static startIndicesVector(t,e){t.startVector(4,e,4)}static addProfileId(t,e){t.addFieldInt16(1,e,0)}static endBigShellHole(t){const e=t.endObject();return t.requiredField(e,4),e}static createBigShellHole(t,e,s){return ga.startBigShellHole(t),ga.addIndices(t,e),ga.addProfileId(t,s),ga.endBigShellHole(t)}},Mo=class Kl{constructor(){O(this,"bb",null),O(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsBigShellProfile(t,e){return(e||new Kl).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBigShellProfile(t,e){return t.setPosition(t.position()+4),(e||new Kl).__init(t.readInt32(t.position())+t.position(),t)}indices(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}indicesLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}indicesArray(){const t=this.bb.__offset(this.bb_pos,4);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}static startBigShellProfile(t){t.startObject(1)}static addIndices(t,e){t.addFieldOffset(0,e,0)}static createIndicesVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addInt32(e[s]);return t.endVector()}static startIndicesVector(t,e){t.startVector(4,e,4)}static endBigShellProfile(t){const e=t.endObject();return t.requiredField(e,4),e}static createBigShellProfile(t,e){return Kl.startBigShellProfile(t),Kl.addIndices(t,e),Kl.endBigShellProfile(t)}},Zy=class{constructor(){O(this,"bb",null),O(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}min(t){return(t||new rs).__init(this.bb_pos,this.bb)}max(t){return(t||new rs).__init(this.bb_pos+12,this.bb)}static sizeOf(){return 24}static createBoundingBox(t,e,s,i,r,o,a){return t.prep(4,24),t.prep(4,12),t.writeFloat32(a),t.writeFloat32(o),t.writeFloat32(r),t.prep(4,12),t.writeFloat32(i),t.writeFloat32(s),t.writeFloat32(e),t.offset()}},Hi=class ba{constructor(){O(this,"bb",null),O(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsCircleExtrusion(t,e){return(e||new ba).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsCircleExtrusion(t,e){return t.setPosition(t.position()+4),(e||new ba).__init(t.readInt32(t.position())+t.position(),t)}radius(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readFloat64(this.bb.__vector(this.bb_pos+e)+8*t):0}radiusLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}radiusArray(){const t=this.bb.__offset(this.bb_pos,4);return t?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}axes(t,e){const s=this.bb.__offset(this.bb_pos,6);return s?(e||new hs).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}axesLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}static startCircleExtrusion(t){t.startObject(2)}static addRadius(t,e){t.addFieldOffset(0,e,0)}static createRadiusVector(t,e){t.startVector(8,e.length,8);for(let s=e.length-1;s>=0;s--)t.addFloat64(e[s]);return t.endVector()}static startRadiusVector(t,e){t.startVector(8,e,8)}static addAxes(t,e){t.addFieldOffset(1,e,0)}static createAxesVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startAxesVector(t,e){t.startVector(4,e,4)}static endCircleExtrusion(t){const e=t.endObject();return t.requiredField(e,4),t.requiredField(e,6),e}static createCircleExtrusion(t,e,s){return ba.startCircleExtrusion(t),ba.addRadius(t,e),ba.addAxes(t,s),ba.endCircleExtrusion(t)}},Xy=class{constructor(){O(this,"bb",null),O(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}x(){return this.bb.readFloat64(this.bb_pos)}mutate_x(t){return this.bb.writeFloat64(this.bb_pos+0,t),!0}y(){return this.bb.readFloat64(this.bb_pos+8)}mutate_y(t){return this.bb.writeFloat64(this.bb_pos+8,t),!0}z(){return this.bb.readFloat64(this.bb_pos+16)}mutate_z(t){return this.bb.writeFloat64(this.bb_pos+16,t),!0}static sizeOf(){return 24}static createDoubleVector(t,e,s,i){return t.prep(8,24),t.writeFloat64(i),t.writeFloat64(s),t.writeFloat64(e),t.offset()}},ei=class Jl{constructor(){O(this,"bb",null),O(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsGeometryLines(t,e){return(e||new Jl).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsGeometryLines(t,e){return t.setPosition(t.position()+4),(e||new Jl).__init(t.readInt32(t.position())+t.position(),t)}points(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readFloat32(this.bb.__vector(this.bb_pos+e)+4*t):0}pointsLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}pointsArray(){const t=this.bb.__offset(this.bb_pos,4);return t?new Float32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}static startGeometryLines(t){t.startObject(1)}static addPoints(t,e){t.addFieldOffset(0,e,0)}static createPointsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addFloat32(e[s]);return t.endVector()}static startPointsVector(t,e){t.startVector(4,e,4)}static endGeometryLines(t){const e=t.endObject();return t.requiredField(e,4),e}static createGeometryLines(t,e){return Jl.startGeometryLines(t),Jl.addPoints(t,e),Jl.endGeometryLines(t)}},Ru=class{constructor(){O(this,"bb",null),O(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}id(){return this.bb.readUint32(this.bb_pos)}mutate_id(t){return this.bb.writeUint32(this.bb_pos+0,t),!0}geometryClass(){return this.bb.readInt8(this.bb_pos+4)}mutate_geometry_class(t){return this.bb.writeInt8(this.bb_pos+4,t),!0}static sizeOf(){return 8}static createGeometryRepresentation(t,e,s){return t.prep(4,8),t.pad(3),t.writeInt8(s),t.writeInt32(e),t.offset()}},Fu=class{constructor(){O(this,"bb",null),O(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}id(){return this.bb.readUint32(this.bb_pos)}mutate_id(t){return this.bb.writeUint32(this.bb_pos+0,t),!0}transform(){return this.bb.readUint32(this.bb_pos+4)}mutate_transform(t){return this.bb.writeUint32(this.bb_pos+4,t),!0}static sizeOf(){return 8}static createGeometrySample(t,e,s){return t.prep(4,8),t.writeInt32(s),t.writeInt32(e),t.offset()}},IC=class{constructor(){O(this,"bb",null),O(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}start(t){return(t||new rs).__init(this.bb_pos,this.bb)}end(t){return(t||new rs).__init(this.bb_pos+12,this.bb)}height(){return this.bb.readFloat32(this.bb_pos+24)}mutate_height(t){return this.bb.writeFloat32(this.bb_pos+24,t),!0}width(){return this.bb.readFloat32(this.bb_pos+28)}mutate_width(t){return this.bb.writeFloat32(this.bb_pos+28,t),!0}offset(){return this.bb.readFloat32(this.bb_pos+32)}mutate_offset(t){return this.bb.writeFloat32(this.bb_pos+32,t),!0}static sizeOf(){return 36}static createGeometryWall(t,e,s,i,r,o,a,l,c,h){return t.prep(4,36),t.writeFloat32(h),t.writeFloat32(c),t.writeFloat32(l),t.prep(4,12),t.writeFloat32(a),t.writeFloat32(o),t.writeFloat32(r),t.prep(4,12),t.writeFloat32(i),t.writeFloat32(s),t.writeFloat32(e),t.offset()}},ur=class{constructor(){O(this,"bb",null),O(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}position(t){return(t||new Xy).__init(this.bb_pos,this.bb)}xDirection(t){return(t||new rs).__init(this.bb_pos+24,this.bb)}yDirection(t){return(t||new rs).__init(this.bb_pos+36,this.bb)}static sizeOf(){return 48}static createTransform(t,e,s,i,r,o,a,l,c,h){return t.prep(8,48),t.prep(4,12),t.writeFloat32(h),t.writeFloat32(c),t.writeFloat32(l),t.prep(4,12),t.writeFloat32(a),t.writeFloat32(o),t.writeFloat32(r),t.prep(8,24),t.writeFloat64(i),t.writeFloat64(s),t.writeFloat64(e),t.offset()}},He=class Qs{constructor(){O(this,"bb",null),O(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsGeometries(t,e){return(e||new Qs).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsGeometries(t,e){return t.setPosition(t.position()+4),(e||new Qs).__init(t.readInt32(t.position())+t.position(),t)}samples(t,e){const s=this.bb.__offset(this.bb_pos,4);return s?(e||new Fu).__init(this.bb.__vector(this.bb_pos+s)+8*t,this.bb):null}samplesLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}sampleIds(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}sampleIdsLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}sampleIdsArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}representations(t,e){const s=this.bb.__offset(this.bb_pos,8);return s?(e||new Ru).__init(this.bb.__vector(this.bb_pos+s)+8*t,this.bb):null}representationsLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}representationIds(t){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}representationIdsLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}representationIdsArray(){const t=this.bb.__offset(this.bb_pos,10);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}transforms(t,e){const s=this.bb.__offset(this.bb_pos,12);return s?(e||new ur).__init(this.bb.__vector(this.bb_pos+s)+48*t,this.bb):null}transformsLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}transformIds(t){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}transformIdsLength(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}transformIdsArray(){const t=this.bb.__offset(this.bb_pos,14);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}representationsSamples(t){const e=this.bb.__offset(this.bb_pos,16);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}representationsSamplesLength(){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.__vector_len(this.bb_pos+t):0}representationsSamplesArray(){const t=this.bb.__offset(this.bb_pos,16);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}lines(t,e){const s=this.bb.__offset(this.bb_pos,18);return s?(e||new ei).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}linesLength(){const t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}walls(t,e){const s=this.bb.__offset(this.bb_pos,20);return s?(e||new IC).__init(this.bb.__vector(this.bb_pos+s)+36*t,this.bb):null}wallsLength(){const t=this.bb.__offset(this.bb_pos,20);return t?this.bb.__vector_len(this.bb_pos+t):0}static startGeometries(t){t.startObject(9)}static addSamples(t,e){t.addFieldOffset(0,e,0)}static startSamplesVector(t,e){t.startVector(8,e,4)}static addSampleIds(t,e){t.addFieldOffset(1,e,0)}static createSampleIdsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addInt32(e[s]);return t.endVector()}static startSampleIdsVector(t,e){t.startVector(4,e,4)}static addRepresentations(t,e){t.addFieldOffset(2,e,0)}static startRepresentationsVector(t,e){t.startVector(8,e,4)}static addRepresentationIds(t,e){t.addFieldOffset(3,e,0)}static createRepresentationIdsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addInt32(e[s]);return t.endVector()}static startRepresentationIdsVector(t,e){t.startVector(4,e,4)}static addTransforms(t,e){t.addFieldOffset(4,e,0)}static startTransformsVector(t,e){t.startVector(48,e,8)}static addTransformIds(t,e){t.addFieldOffset(5,e,0)}static createTransformIdsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addInt32(e[s]);return t.endVector()}static startTransformIdsVector(t,e){t.startVector(4,e,4)}static addRepresentationsSamples(t,e){t.addFieldOffset(6,e,0)}static createRepresentationsSamplesVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addInt32(e[s]);return t.endVector()}static startRepresentationsSamplesVector(t,e){t.startVector(4,e,4)}static addLines(t,e){t.addFieldOffset(7,e,0)}static createLinesVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startLinesVector(t,e){t.startVector(4,e,4)}static addWalls(t,e){t.addFieldOffset(8,e,0)}static startWallsVector(t,e){t.startVector(36,e,4)}static endGeometries(t){const e=t.endObject();return t.requiredField(e,4),t.requiredField(e,8),t.requiredField(e,12),t.requiredField(e,18),e}static createGeometries(t,e,s,i,r,o,a,l,c,h){return Qs.startGeometries(t),Qs.addSamples(t,e),Qs.addSampleIds(t,s),Qs.addRepresentations(t,i),Qs.addRepresentationIds(t,r),Qs.addTransforms(t,o),Qs.addTransformIds(t,a),Qs.addRepresentationsSamples(t,l),Qs.addLines(t,c),Qs.addWalls(t,h),Qs.endGeometries(t)}};var Pn=(n=>(n[n.NONE=0]="NONE",n[n.LINES=1]="LINES",n[n.ELLIPSE_ARC=2]="ELLIPSE_ARC",n[n.CLOTHOID=3]="CLOTHOID",n[n.PARABOLA=4]="PARABOLA",n[n.WALLS=5]="WALLS",n))(Pn||{});let Qy=class{constructor(){O(this,"bb",null),O(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}r(){return this.bb.readUint8(this.bb_pos)}mutate_r(t){return this.bb.writeUint8(this.bb_pos+0,t),!0}g(){return this.bb.readUint8(this.bb_pos+1)}mutate_g(t){return this.bb.writeUint8(this.bb_pos+1,t),!0}b(){return this.bb.readUint8(this.bb_pos+2)}mutate_b(t){return this.bb.writeUint8(this.bb_pos+2,t),!0}a(){return this.bb.readUint8(this.bb_pos+3)}mutate_a(t){return this.bb.writeUint8(this.bb_pos+3,t),!0}renderedFaces(){return this.bb.readInt8(this.bb_pos+4)}mutate_rendered_faces(t){return this.bb.writeInt8(this.bb_pos+4,t),!0}stroke(){return this.bb.readInt8(this.bb_pos+5)}mutate_stroke(t){return this.bb.writeInt8(this.bb_pos+5,t),!0}static sizeOf(){return 6}static createMaterial(t,e,s,i,r,o,a){return t.prep(1,6),t.writeInt8(a),t.writeInt8(o),t.writeInt8(r),t.writeInt8(i),t.writeInt8(s),t.writeInt8(e),t.offset()}},Xc=class{constructor(){O(this,"bb",null),O(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}id(){return this.bb.readUint32(this.bb_pos)}mutate_id(t){return this.bb.writeUint32(this.bb_pos+0,t),!0}bbox(t){return(t||new Zy).__init(this.bb_pos+4,this.bb)}representationClass(){return this.bb.readInt8(this.bb_pos+28)}mutate_representation_class(t){return this.bb.writeInt8(this.bb_pos+28,t),!0}static sizeOf(){return 32}static createRepresentation(t,e,s,i,r,o,a,l,c){return t.prep(4,32),t.pad(3),t.writeInt8(c),t.prep(4,24),t.prep(4,12),t.writeFloat32(l),t.writeFloat32(a),t.writeFloat32(o),t.prep(4,12),t.writeFloat32(r),t.writeFloat32(i),t.writeFloat32(s),t.writeInt32(e),t.offset()}},Qc=class{constructor(){O(this,"bb",null),O(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}item(){return this.bb.readUint32(this.bb_pos)}mutate_item(t){return this.bb.writeUint32(this.bb_pos+0,t),!0}material(){return this.bb.readUint32(this.bb_pos+4)}mutate_material(t){return this.bb.writeUint32(this.bb_pos+4,t),!0}representation(){return this.bb.readUint32(this.bb_pos+8)}mutate_representation(t){return this.bb.writeUint32(this.bb_pos+8,t),!0}localTransform(){return this.bb.readUint32(this.bb_pos+12)}mutate_local_transform(t){return this.bb.writeUint32(this.bb_pos+12,t),!0}static sizeOf(){return 16}static createSample(t,e,s,i,r){return t.prep(4,16),t.writeInt32(r),t.writeInt32(i),t.writeInt32(s),t.writeInt32(e),t.offset()}},Ga=class _a{constructor(){O(this,"bb",null),O(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsShellHole(t,e){return(e||new _a).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsShellHole(t,e){return t.setPosition(t.position()+4),(e||new _a).__init(t.readInt32(t.position())+t.position(),t)}indices(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint16(this.bb.__vector(this.bb_pos+e)+2*t):0}indicesLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}indicesArray(){const t=this.bb.__offset(this.bb_pos,4);return t?new Uint16Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}profileId(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint16(this.bb_pos+t):0}mutate_profile_id(t){const e=this.bb.__offset(this.bb_pos,6);return e!==0&&(this.bb.writeUint16(this.bb_pos+e,t),!0)}static startShellHole(t){t.startObject(2)}static addIndices(t,e){t.addFieldOffset(0,e,0)}static createIndicesVector(t,e){t.startVector(2,e.length,2);for(let s=e.length-1;s>=0;s--)t.addInt16(e[s]);return t.endVector()}static startIndicesVector(t,e){t.startVector(2,e,2)}static addProfileId(t,e){t.addFieldInt16(1,e,0)}static endShellHole(t){const e=t.endObject();return t.requiredField(e,4),e}static createShellHole(t,e,s){return _a.startShellHole(t),_a.addIndices(t,e),_a.addProfileId(t,s),_a.endShellHole(t)}},Do=class tc{constructor(){O(this,"bb",null),O(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsShellProfile(t,e){return(e||new tc).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsShellProfile(t,e){return t.setPosition(t.position()+4),(e||new tc).__init(t.readInt32(t.position())+t.position(),t)}indices(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readUint16(this.bb.__vector(this.bb_pos+e)+2*t):0}indicesLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}indicesArray(){const t=this.bb.__offset(this.bb_pos,4);return t?new Uint16Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}static startShellProfile(t){t.startObject(1)}static addIndices(t,e){t.addFieldOffset(0,e,0)}static createIndicesVector(t,e){t.startVector(2,e.length,2);for(let s=e.length-1;s>=0;s--)t.addInt16(e[s]);return t.endVector()}static startIndicesVector(t,e){t.startVector(2,e,2)}static endShellProfile(t){const e=t.endObject();return t.requiredField(e,4),e}static createShellProfile(t,e){return tc.startShellProfile(t),tc.addIndices(t,e),tc.endShellProfile(t)}};var ms=(n=>(n[n.NONE=0]="NONE",n[n.BIG=1]="BIG",n))(ms||{});let ji=class wn{constructor(){O(this,"bb",null),O(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsShell(t,e){return(e||new wn).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsShell(t,e){return t.setPosition(t.position()+4),(e||new wn).__init(t.readInt32(t.position())+t.position(),t)}profiles(t,e){const s=this.bb.__offset(this.bb_pos,4);return s?(e||new Do).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}profilesLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}holes(t,e){const s=this.bb.__offset(this.bb_pos,6);return s?(e||new Ga).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}holesLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}points(t,e){const s=this.bb.__offset(this.bb_pos,8);return s?(e||new rs).__init(this.bb.__vector(this.bb_pos+s)+12*t,this.bb):null}pointsLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}bigProfiles(t,e){const s=this.bb.__offset(this.bb_pos,10);return s?(e||new Mo).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}bigProfilesLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}bigHoles(t,e){const s=this.bb.__offset(this.bb_pos,12);return s?(e||new Ya).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}bigHolesLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}type(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readInt8(this.bb_pos+t):ms.NONE}mutate_type(t){const e=this.bb.__offset(this.bb_pos,14);return e!==0&&(this.bb.writeInt8(this.bb_pos+e,t),!0)}static startShell(t){t.startObject(6)}static addProfiles(t,e){t.addFieldOffset(0,e,0)}static createProfilesVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startProfilesVector(t,e){t.startVector(4,e,4)}static addHoles(t,e){t.addFieldOffset(1,e,0)}static createHolesVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startHolesVector(t,e){t.startVector(4,e,4)}static addPoints(t,e){t.addFieldOffset(2,e,0)}static startPointsVector(t,e){t.startVector(12,e,4)}static addBigProfiles(t,e){t.addFieldOffset(3,e,0)}static createBigProfilesVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startBigProfilesVector(t,e){t.startVector(4,e,4)}static addBigHoles(t,e){t.addFieldOffset(4,e,0)}static createBigHolesVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startBigHolesVector(t,e){t.startVector(4,e,4)}static addType(t,e){t.addFieldInt8(5,e,ms.NONE)}static endShell(t){const e=t.endObject();return t.requiredField(e,4),t.requiredField(e,6),t.requiredField(e,8),t.requiredField(e,10),t.requiredField(e,12),e}static createShell(t,e,s,i,r,o,a){return wn.startShell(t),wn.addProfiles(t,e),wn.addHoles(t,s),wn.addPoints(t,i),wn.addBigProfiles(t,r),wn.addBigHoles(t,o),wn.addType(t,a),wn.endShell(t)}},je=class Ks{constructor(){O(this,"bb",null),O(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsMeshes(t,e){return(e||new Ks).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsMeshes(t,e){return t.setPosition(t.position()+4),(e||new Ks).__init(t.readInt32(t.position())+t.position(),t)}coordinates(t){const e=this.bb.__offset(this.bb_pos,4);return e?(t||new ur).__init(this.bb_pos+e,this.bb):null}meshesItems(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}meshesItemsLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}meshesItemsArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}samples(t,e){const s=this.bb.__offset(this.bb_pos,8);return s?(e||new Qc).__init(this.bb.__vector(this.bb_pos+s)+16*t,this.bb):null}samplesLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}representations(t,e){const s=this.bb.__offset(this.bb_pos,10);return s?(e||new Xc).__init(this.bb.__vector(this.bb_pos+s)+32*t,this.bb):null}representationsLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}materials(t,e){const s=this.bb.__offset(this.bb_pos,12);return s?(e||new Qy).__init(this.bb.__vector(this.bb_pos+s)+6*t,this.bb):null}materialsLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}circleExtrusions(t,e){const s=this.bb.__offset(this.bb_pos,14);return s?(e||new Hi).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}circleExtrusionsLength(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}shells(t,e){const s=this.bb.__offset(this.bb_pos,16);return s?(e||new ji).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}shellsLength(){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.__vector_len(this.bb_pos+t):0}localTransforms(t,e){const s=this.bb.__offset(this.bb_pos,18);return s?(e||new ur).__init(this.bb.__vector(this.bb_pos+s)+48*t,this.bb):null}localTransformsLength(){const t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}globalTransforms(t,e){const s=this.bb.__offset(this.bb_pos,20);return s?(e||new ur).__init(this.bb.__vector(this.bb_pos+s)+48*t,this.bb):null}globalTransformsLength(){const t=this.bb.__offset(this.bb_pos,20);return t?this.bb.__vector_len(this.bb_pos+t):0}static startMeshes(t){t.startObject(9)}static addCoordinates(t,e){t.addFieldStruct(0,e,0)}static addMeshesItems(t,e){t.addFieldOffset(1,e,0)}static createMeshesItemsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addInt32(e[s]);return t.endVector()}static startMeshesItemsVector(t,e){t.startVector(4,e,4)}static addSamples(t,e){t.addFieldOffset(2,e,0)}static startSamplesVector(t,e){t.startVector(16,e,4)}static addRepresentations(t,e){t.addFieldOffset(3,e,0)}static startRepresentationsVector(t,e){t.startVector(32,e,4)}static addMaterials(t,e){t.addFieldOffset(4,e,0)}static startMaterialsVector(t,e){t.startVector(6,e,1)}static addCircleExtrusions(t,e){t.addFieldOffset(5,e,0)}static createCircleExtrusionsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startCircleExtrusionsVector(t,e){t.startVector(4,e,4)}static addShells(t,e){t.addFieldOffset(6,e,0)}static createShellsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startShellsVector(t,e){t.startVector(4,e,4)}static addLocalTransforms(t,e){t.addFieldOffset(7,e,0)}static startLocalTransformsVector(t,e){t.startVector(48,e,8)}static addGlobalTransforms(t,e){t.addFieldOffset(8,e,0)}static startGlobalTransformsVector(t,e){t.startVector(48,e,8)}static endMeshes(t){const e=t.endObject();return t.requiredField(e,4),t.requiredField(e,6),t.requiredField(e,8),t.requiredField(e,10),t.requiredField(e,12),t.requiredField(e,14),t.requiredField(e,16),t.requiredField(e,18),t.requiredField(e,20),e}static createMeshes(t,e,s,i,r,o,a,l,c,h){return Ks.startMeshes(t),Ks.addCoordinates(t,e),Ks.addMeshesItems(t,s),Ks.addSamples(t,i),Ks.addRepresentations(t,r),Ks.addMaterials(t,o),Ks.addCircleExtrusions(t,a),Ks.addShells(t,l),Ks.addLocalTransforms(t,c),Ks.addGlobalTransforms(t,h),Ks.endMeshes(t)}},Sm=class ec{constructor(){O(this,"bb",null),O(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsRelation(t,e){return(e||new ec).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsRelation(t,e){return t.setPosition(t.position()+4),(e||new ec).__init(t.readInt32(t.position())+t.position(),t)}data(t,e){const s=this.bb.__offset(this.bb_pos,4);return s?this.bb.__string(this.bb.__vector(this.bb_pos+s)+4*t,e):null}dataLength(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__vector_len(this.bb_pos+t):0}static startRelation(t){t.startObject(1)}static addData(t,e){t.addFieldOffset(0,e,0)}static createDataVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startDataVector(t,e){t.startVector(4,e,4)}static endRelation(t){const e=t.endObject();return t.requiredField(e,4),e}static createRelation(t,e){return ec.startRelation(t),ec.addData(t,e),ec.endRelation(t)}},Cs=class Cr{constructor(){O(this,"bb",null),O(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsSpatialStructure(t,e){return(e||new Cr).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsSpatialStructure(t,e){return t.setPosition(t.position()+4),(e||new Cr).__init(t.readInt32(t.position())+t.position(),t)}localId(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readUint32(this.bb_pos+t):null}mutate_local_id(t){const e=this.bb.__offset(this.bb_pos,4);return e!==0&&(this.bb.writeUint32(this.bb_pos+e,t),!0)}category(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__string(this.bb_pos+e,t):null}children(t,e){const s=this.bb.__offset(this.bb_pos,8);return s?(e||new Cr).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}childrenLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}static startSpatialStructure(t){t.startObject(3)}static addLocalId(t,e){t.addFieldInt32(0,e,null)}static addCategory(t,e){t.addFieldOffset(1,e,0)}static addChildren(t,e){t.addFieldOffset(2,e,0)}static createChildrenVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startChildrenVector(t,e){t.startVector(4,e,4)}static endSpatialStructure(t){return t.endObject()}static createSpatialStructure(t,e,s,i){return Cr.startSpatialStructure(t),e!==null&&Cr.addLocalId(t,e),Cr.addCategory(t,s),Cr.addChildren(t,i),Cr.endSpatialStructure(t)}},ne=class r0{constructor(){O(this,"bb",null),O(this,"bb_pos",0)}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsModel(t,e){return(e||new r0).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsModel(t,e){return t.setPosition(t.position()+4),(e||new r0).__init(t.readInt32(t.position())+t.position(),t)}static bufferHasIdentifier(t){return t.__has_identifier("0001")}metadata(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}guids(t,e){const s=this.bb.__offset(this.bb_pos,6);return s?this.bb.__string(this.bb.__vector(this.bb_pos+s)+4*t,e):null}guidsLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}guidsItems(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}guidsItemsLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}guidsItemsArray(){const t=this.bb.__offset(this.bb_pos,8);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}maxLocalId(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readUint32(this.bb_pos+t):0}mutate_max_local_id(t){const e=this.bb.__offset(this.bb_pos,10);return e!==0&&(this.bb.writeUint32(this.bb_pos+e,t),!0)}localIds(t){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readUint32(this.bb.__vector(this.bb_pos+e)+4*t):0}localIdsLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}localIdsArray(){const t=this.bb.__offset(this.bb_pos,12);return t?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}categories(t,e){const s=this.bb.__offset(this.bb_pos,14);return s?this.bb.__string(this.bb.__vector(this.bb_pos+s)+4*t,e):null}categoriesLength(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}meshes(t){const e=this.bb.__offset(this.bb_pos,16);return e?(t||new je).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}attributes(t,e){const s=this.bb.__offset(this.bb_pos,18);return s?(e||new Am).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}attributesLength(){const t=this.bb.__offset(this.bb_pos,18);return t?this.bb.__vector_len(this.bb_pos+t):0}relations(t,e){const s=this.bb.__offset(this.bb_pos,20);return s?(e||new Sm).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}relationsLength(){const t=this.bb.__offset(this.bb_pos,20);return t?this.bb.__vector_len(this.bb_pos+t):0}relationsItems(t){const e=this.bb.__offset(this.bb_pos,22);return e?this.bb.readInt32(this.bb.__vector(this.bb_pos+e)+4*t):0}relationsItemsLength(){const t=this.bb.__offset(this.bb_pos,22);return t?this.bb.__vector_len(this.bb_pos+t):0}relationsItemsArray(){const t=this.bb.__offset(this.bb_pos,22);return t?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}guid(t){const e=this.bb.__offset(this.bb_pos,24);return e?this.bb.__string(this.bb_pos+e,t):null}spatialStructure(t){const e=this.bb.__offset(this.bb_pos,26);return e?(t||new Cs).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}alignments(t,e){const s=this.bb.__offset(this.bb_pos,28);return s?(e||new uc).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+s)+4*t),this.bb):null}alignmentsLength(){const t=this.bb.__offset(this.bb_pos,28);return t?this.bb.__vector_len(this.bb_pos+t):0}geometries(t){const e=this.bb.__offset(this.bb_pos,30);return e?(t||new He).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}uniqueAttributes(t,e){const s=this.bb.__offset(this.bb_pos,32);return s?this.bb.__string(this.bb.__vector(this.bb_pos+s)+4*t,e):null}uniqueAttributesLength(){const t=this.bb.__offset(this.bb_pos,32);return t?this.bb.__vector_len(this.bb_pos+t):0}relationNames(t,e){const s=this.bb.__offset(this.bb_pos,34);return s?this.bb.__string(this.bb.__vector(this.bb_pos+s)+4*t,e):null}relationNamesLength(){const t=this.bb.__offset(this.bb_pos,34);return t?this.bb.__vector_len(this.bb_pos+t):0}static startModel(t){t.startObject(16)}static addMetadata(t,e){t.addFieldOffset(0,e,0)}static addGuids(t,e){t.addFieldOffset(1,e,0)}static createGuidsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startGuidsVector(t,e){t.startVector(4,e,4)}static addGuidsItems(t,e){t.addFieldOffset(2,e,0)}static createGuidsItemsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addInt32(e[s]);return t.endVector()}static startGuidsItemsVector(t,e){t.startVector(4,e,4)}static addMaxLocalId(t,e){t.addFieldInt32(3,e,0)}static addLocalIds(t,e){t.addFieldOffset(4,e,0)}static createLocalIdsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addInt32(e[s]);return t.endVector()}static startLocalIdsVector(t,e){t.startVector(4,e,4)}static addCategories(t,e){t.addFieldOffset(5,e,0)}static createCategoriesVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startCategoriesVector(t,e){t.startVector(4,e,4)}static addMeshes(t,e){t.addFieldOffset(6,e,0)}static addAttributes(t,e){t.addFieldOffset(7,e,0)}static createAttributesVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startAttributesVector(t,e){t.startVector(4,e,4)}static addRelations(t,e){t.addFieldOffset(8,e,0)}static createRelationsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startRelationsVector(t,e){t.startVector(4,e,4)}static addRelationsItems(t,e){t.addFieldOffset(9,e,0)}static createRelationsItemsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addInt32(e[s]);return t.endVector()}static startRelationsItemsVector(t,e){t.startVector(4,e,4)}static addGuid(t,e){t.addFieldOffset(10,e,0)}static addSpatialStructure(t,e){t.addFieldOffset(11,e,0)}static addAlignments(t,e){t.addFieldOffset(12,e,0)}static createAlignmentsVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startAlignmentsVector(t,e){t.startVector(4,e,4)}static addGeometries(t,e){t.addFieldOffset(13,e,0)}static addUniqueAttributes(t,e){t.addFieldOffset(14,e,0)}static createUniqueAttributesVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startUniqueAttributesVector(t,e){t.startVector(4,e,4)}static addRelationNames(t,e){t.addFieldOffset(15,e,0)}static createRelationNamesVector(t,e){t.startVector(4,e.length,4);for(let s=e.length-1;s>=0;s--)t.addOffset(e[s]);return t.endVector()}static startRelationNamesVector(t,e){t.startVector(4,e,4)}static endModel(t){const e=t.endObject();return t.requiredField(e,6),t.requiredField(e,8),t.requiredField(e,12),t.requiredField(e,14),t.requiredField(e,16),t.requiredField(e,24),e}static finishModelBuffer(t,e){t.finish(e,"0001")}static finishSizePrefixedModelBuffer(t,e){t.finish(e,"0001",!0)}};var il=(n=>(n[n.ONE=0]="ONE",n[n.TWO=1]="TWO",n))(il||{}),Ur=(n=>(n[n.NONE=0]="NONE",n[n.SHELL=1]="SHELL",n[n.CIRCLE_EXTRUSION=2]="CIRCLE_EXTRUSION",n))(Ur||{}),CC=(n=>(n[n.DEFAULT=0]="DEFAULT",n))(CC||{});const qa=65536;var zs=(n=>(n[n.LINE=0]="LINE",n[n.SHELL=1]="SHELL",n))(zs||{}),Ne=(n=>(n[n.UPDATE=0]="UPDATE",n[n.CREATE=1]="CREATE",n[n.DELETE=2]="DELETE",n[n.FINISH=3]="FINISH",n))(Ne||{}),jt=(n=>(n[n.GEOMETRY=0]="GEOMETRY",n[n.WIRES=1]="WIRES",n[n.INVISIBLE=2]="INVISIBLE",n))(jt||{}),Ci=(n=>(n[n.CREATE_MODEL=0]="CREATE_MODEL",n[n.DELETE_MODEL=1]="DELETE_MODEL",n[n.EXECUTE=2]="EXECUTE",n[n.RAYCAST=3]="RAYCAST",n[n.FETCH_BOXES=4]="FETCH_BOXES",n[n.REFRESH_VIEW=5]="REFRESH_VIEW",n[n.RECOMPUTE_MESHES=6]="RECOMPUTE_MESHES",n[n.CREATE_MATERIAL=7]="CREATE_MATERIAL",n[n.THROW_ERROR=8]="THROW_ERROR",n))(Ci||{}),Om=(n=>(n[n.VISIBLE=0]="VISIBLE",n))(Om||{}),Ws=(n=>(n[n.POINT=0]="POINT",n[n.LINE=1]="LINE",n[n.FACE=2]="FACE",n))(Ws||{});let rd=class{static containedInParallelPlanes(t,e){let s=!0;for(const i of t){const r=i.distanceToPoint(e);s=s&&r>=0}return s}static collides(t,e,s){for(const i of e)if(this.getPointDistance(i,s,t)<0)return!1;return!0}static getPointDistance(t,e,s){const i=t.normal;for(const r of this.dimensions){const o=i[r]>=0!==e;this.tempPoint[r]=o?s.max[r]:s.min[r]}return t.distanceToPoint(this.tempPoint)}};O(rd,"tempPoint",new F),O(rd,"dimensions",["x","y","z"]);let Ma=class{static transform(t,e,s=new No){for(let i=0;i<s.planes.length;i++){const r=s.planes[i],o=t.planes[i];r.copy(o),r.applyMatrix4(e)}return s}static isIncluded(t,e){return rd.collides(t,e,!0)}static collides(t,e){return rd.collides(t,e,!1)}};function TC(n,t,e=2){const s=t&&t.length,i=s?t[0]*e:n.length;let r=ww(n,0,i,e,!0);const o=[];if(!r||r.next===r.prev)return o;let a,l,c;if(s&&(r=(function(h,u,p,d){const g=[];for(let m=0,b=u.length;m<b;m++){const f=ww(h,u[m]*d,m<b-1?u[m+1]*d:h.length,d,!1);f===f.next&&(f.steiner=!0),g.push(XL(f))}g.sort(GL);for(let m=0;m<g.length;m++)p=qL(g[m],p);return p})(n,t,r,e)),n.length>80*e){a=1/0,l=1/0;let h=-1/0,u=-1/0;for(let p=e;p<i;p+=e){const d=n[p],g=n[p+1];d<a&&(a=d),g<l&&(l=g),d>h&&(h=d),g>u&&(u=g)}c=Math.max(h-a,u-l),c=c!==0?32767/c:0}return od(r,o,e,a,l,c,0),o}function ww(n,t,e,s,i){let r;if(i===(function(o,a,l,c){let h=0;for(let u=a,p=l-c;u<l;u+=c)h+=(o[p]-o[u])*(o[u+1]+o[p+1]),p=u;return h})(n,t,e,s)>0)for(let o=t;o<e;o+=s)r=Ew(o/s|0,n[o],n[o+1],r);else for(let o=e-s;o>=t;o-=s)r=Ew(o/s|0,n[o],n[o+1],r);return r&&Cc(r,r.next)&&(ld(r),r=r.next),r}function Za(n,t){if(!n)return n;t||(t=n);let e,s=n;do if(e=!1,s.steiner||!Cc(s,s.next)&&Be(s.prev,s,s.next)!==0)s=s.next;else{if(ld(s),s=t=s.prev,s===s.next)break;e=!0}while(e||s!==t);return t}function od(n,t,e,s,i,r,o){if(!n)return;!o&&r&&(function(l,c,h,u){let p=l;do p.z===0&&(p.z=o0(p.x,p.y,c,h,u)),p.prevZ=p.prev,p.nextZ=p.next,p=p.next;while(p!==l);p.prevZ.nextZ=null,p.prevZ=null,(function(d){let g,m=1;do{let b,f=d;d=null;let _=null;for(g=0;f;){g++;let y=f,v=0;for(let I=0;I<m&&(v++,y=y.nextZ,y);I++);let w=m;for(;v>0||w>0&&y;)v!==0&&(w===0||!y||f.z<=y.z)?(b=f,f=f.nextZ,v--):(b=y,y=y.nextZ,w--),_?_.nextZ=b:d=b,b.prevZ=_,_=b;f=y}_.nextZ=null,m*=2}while(g>1)})(p)})(n,s,i,r);let a=n;for(;n.prev!==n.next;){const l=n.prev,c=n.next;if(r?jL(n,s,i,r):HL(n))t.push(l.i,n.i,c.i),ld(n),n=c.next,a=c.next;else if((n=c)===a){o?o===1?od(n=WL(Za(n),t),t,e,s,i,r,2):o===2&&YL(n,t,e,s,i,r):od(Za(n),t,e,s,i,r,1);break}}}function HL(n){const t=n.prev,e=n,s=n.next;if(Be(t,e,s)>=0)return!1;const i=t.x,r=e.x,o=s.x,a=t.y,l=e.y,c=s.y,h=Math.min(i,r,o),u=Math.min(a,l,c),p=Math.max(i,r,o),d=Math.max(a,l,c);let g=s.next;for(;g!==t;){if(g.x>=h&&g.x<=p&&g.y>=u&&g.y<=d&&du(i,a,r,l,o,c,g.x,g.y)&&Be(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function jL(n,t,e,s){const i=n.prev,r=n,o=n.next;if(Be(i,r,o)>=0)return!1;const a=i.x,l=r.x,c=o.x,h=i.y,u=r.y,p=o.y,d=Math.min(a,l,c),g=Math.min(h,u,p),m=Math.max(a,l,c),b=Math.max(h,u,p),f=o0(d,g,t,e,s),_=o0(m,b,t,e,s);let y=n.prevZ,v=n.nextZ;for(;y&&y.z>=f&&v&&v.z<=_;){if(y.x>=d&&y.x<=m&&y.y>=g&&y.y<=b&&y!==i&&y!==o&&du(a,h,l,u,c,p,y.x,y.y)&&Be(y.prev,y,y.next)>=0||(y=y.prevZ,v.x>=d&&v.x<=m&&v.y>=g&&v.y<=b&&v!==i&&v!==o&&du(a,h,l,u,c,p,v.x,v.y)&&Be(v.prev,v,v.next)>=0))return!1;v=v.nextZ}for(;y&&y.z>=f;){if(y.x>=d&&y.x<=m&&y.y>=g&&y.y<=b&&y!==i&&y!==o&&du(a,h,l,u,c,p,y.x,y.y)&&Be(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;v&&v.z<=_;){if(v.x>=d&&v.x<=m&&v.y>=g&&v.y<=b&&v!==i&&v!==o&&du(a,h,l,u,c,p,v.x,v.y)&&Be(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function WL(n,t){let e=n;do{const s=e.prev,i=e.next.next;!Cc(s,i)&&SC(s,e,e.next,i)&&ad(s,i)&&ad(i,s)&&(t.push(s.i,e.i,i.i),ld(e),ld(e.next),e=n=i),e=e.next}while(e!==n);return Za(e)}function YL(n,t,e,s,i,r){let o=n;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&QL(o,a)){let l=OC(o,a);return o=Za(o,o.next),l=Za(l,l.next),od(o,t,e,s,i,r,0),void od(l,t,e,s,i,r,0)}a=a.next}o=o.next}while(o!==n)}function GL(n,t){let e=n.x-t.x;return e===0&&(e=n.y-t.y,e===0)&&(e=(n.next.y-n.y)/(n.next.x-n.x)-(t.next.y-t.y)/(t.next.x-t.x)),e}function qL(n,t){const e=(function(i,r){let o=r;const a=i.x,l=i.y;let c,h=-1/0;if(Cc(i,o))return o;do{if(Cc(i,o.next))return o.next;if(l<=o.y&&l>=o.next.y&&o.next.y!==o.y){const m=o.x+(l-o.y)*(o.next.x-o.x)/(o.next.y-o.y);if(m<=a&&m>h&&(h=m,c=o.x<o.next.x?o:o.next,m===a))return c}o=o.next}while(o!==r);if(!c)return null;const u=c,p=c.x,d=c.y;let g=1/0;o=c;do{if(a>=o.x&&o.x>=p&&a!==o.x&&AC(l<d?a:h,l,p,d,l<d?h:a,l,o.x,o.y)){const m=Math.abs(l-o.y)/(a-o.x);ad(o,i)&&(m<g||m===g&&(o.x>c.x||o.x===c.x&&ZL(c,o)))&&(c=o,g=m)}o=o.next}while(o!==u);return c})(n,t);if(!e)return t;const s=OC(e,n);return Za(s,s.next),Za(e,e.next)}function ZL(n,t){return Be(n.prev,n,t.prev)<0&&Be(t.next,n,n.next)<0}function o0(n,t,e,s,i){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-e)*i|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-s)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function XL(n){let t=n,e=n;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==n);return e}function AC(n,t,e,s,i,r,o,a){return(i-o)*(t-a)>=(n-o)*(r-a)&&(n-o)*(s-a)>=(e-o)*(t-a)&&(e-o)*(r-a)>=(i-o)*(s-a)}function du(n,t,e,s,i,r,o,a){return!(n===o&&t===a)&&AC(n,t,e,s,i,r,o,a)}function QL(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!(function(e,s){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==s.i&&i.next.i!==s.i&&SC(i,i.next,e,s))return!0;i=i.next}while(i!==e);return!1})(n,t)&&(ad(n,t)&&ad(t,n)&&(function(e,s){let i=e,r=!1;const o=(e.x+s.x)/2,a=(e.y+s.y)/2;do i.y>a!=i.next.y>a&&i.next.y!==i.y&&o<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==e);return r})(n,t)&&(Be(n.prev,n,t.prev)||Be(n,t.prev,t))||Cc(n,t)&&Be(n.prev,n,n.next)>0&&Be(t.prev,t,t.next)>0)}function Be(n,t,e){return(t.y-n.y)*(e.x-t.x)-(t.x-n.x)*(e.y-t.y)}function Cc(n,t){return n.x===t.x&&n.y===t.y}function SC(n,t,e,s){const i=gp(Be(n,t,e)),r=gp(Be(n,t,s)),o=gp(Be(e,s,n)),a=gp(Be(e,s,t));return i!==r&&o!==a||!(i!==0||!mp(n,e,t))||!(r!==0||!mp(n,s,t))||!(o!==0||!mp(e,n,s))||!(a!==0||!mp(e,t,s))}function mp(n,t,e){return t.x<=Math.max(n.x,e.x)&&t.x>=Math.min(n.x,e.x)&&t.y<=Math.max(n.y,e.y)&&t.y>=Math.min(n.y,e.y)}function gp(n){return n>0?1:n<0?-1:0}function ad(n,t){return Be(n.prev,n,n.next)<0?Be(n,t,n.next)>=0&&Be(n,n.prev,t)>=0:Be(n,t,n.prev)<0||Be(n,n.next,t)<0}function OC(n,t){const e=a0(n.i,n.x,n.y),s=a0(t.i,t.x,t.y),i=n.next,r=t.prev;return n.next=t,t.prev=n,e.next=i,i.prev=e,s.next=e,e.prev=s,r.next=s,s.prev=r,s}function Ew(n,t,e,s){const i=a0(n,t,e);return s?(i.next=s.next,i.prev=s,s.next.prev=i,s.next=i):(i.prev=i,i.next=i),i}function ld(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function a0(n,t,e){return{i:n,x:t,y:e,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}let KL=class{constructor(){O(this,"_inverseMatrix",new xt),O(this,"_localPlane",new Wt),O(this,"_tempLine",new qt),O(this,"_tempVector",new F),O(this,"_plane"),O(this,"_plane2DCoordinateSystem",new xt),O(this,"_precission",1e4)}get plane(){if(!this._plane)throw new Error("Fragments: Plane not set");return this._plane}set plane(t){this._plane=t}createEdges(t){const{meshes:e,posAttr:s}=t;let i=0;s.array.fill(0);const r=[];let o=0;const a=new ht;for(const l of e)if(l.geometry){if(l.geometry.boundsTree||l.geometry.computeBoundsTree(),!l.geometry.boundsTree)throw new Error("Fragments: Bounds tree not found for edges generation.");if(l instanceof Wy){if(l.count===0)continue;const c=l;for(let h=0;h<c.count;h++){a.geometry=l.geometry,a.matrix.copy(l.matrix);const u=new xt;c.getMatrixAt(h,u),a.applyMatrix4(u),a.applyMatrix4(l.matrixWorld),a.updateMatrix(),a.updateMatrixWorld(),this._inverseMatrix.copy(a.matrixWorld).invert(),this._localPlane.copy(this.plane).applyMatrix4(this._inverseMatrix),i=this.shapecast(a,s,i),i!==o&&(r.push(i),o=i)}}else this._inverseMatrix.copy(l.matrixWorld).invert(),this._localPlane.copy(this.plane).applyMatrix4(this._inverseMatrix),i=this.shapecast(l,s,i),i!==o&&(r.push(i),o=i)}return{indexes:r,index:i}}createFills(t,e){this.updatePlane2DCoordinateSystem();const s=[];let i=0;for(let r=0;r<e.length;r++){const o=e[r],a=[];for(let c=i;c<o;c+=2)a.push(3*c);const l=this.computeFill(a,t);for(const c of l)s.push(c);i=o}return s}computeFill(t,e){const s=new Map,i={},r=new Map;let o=0;const a=new Map,l=new Map,c=new Set,h=this._precission;for(let p=0;p<t.length;p++){const d=t[p];let g=0,m=0,b=0,f=0;const _=e[d],y=e[d+1],v=e[d+2],w=e[d+3],I=e[d+4],C=e[d+5];if(this._tempVector.set(_,y,v),this._tempVector.applyMatrix4(this._plane2DCoordinateSystem),g=Math.trunc(this._tempVector.x*h)/h,m=Math.trunc(this._tempVector.y*h)/h,this._tempVector.set(w,I,C),this._tempVector.applyMatrix4(this._plane2DCoordinateSystem),b=Math.trunc(this._tempVector.x*h)/h,f=Math.trunc(this._tempVector.y*h)/h,g===b&&m===f)continue;const A=`${g}|${m}`,S=`${b}|${f}`;s.has(A)||s.set(A,d/3),s.has(S)||s.set(S,d/3+1);const P=s.get(A),M=s.get(S);i[P]=[g,m],i[M]=[b,f];const T=l.has(P),L=a.has(P),E=l.has(M),N=a.has(M);if(!(T||L||E||N))l.set(P,o),a.set(M,o),c.add(o),r.set(o,[P,M]),o++;else if(T&&N){const W=l.get(P),V=a.get(M);if(W!==V){const et=r.get(V),j=r.get(W);if(!et||!j)continue;r.delete(W),c.delete(W),a.set(j[j.length-1],V),a.delete(et[et.length-1]);for(const nt of j)et.push(nt)}else c.delete(V);l.delete(P),a.delete(M)}else if(L&&E){const W=l.get(M),V=a.get(P);if(W!==V){const et=r.get(V),j=r.get(W);if(!et||!j)continue;r.delete(W),c.delete(W),a.set(j[j.length-1],V),a.delete(et[et.length-1]);for(const nt of j)et.push(nt)}else c.delete(V);l.delete(M),a.delete(P)}else if(T&&E){const W=l.get(M),V=l.get(P),et=r.get(V),j=r.get(W);if(!et||!j)continue;r.delete(W),c.delete(W),l.delete(et[0]),l.delete(j[0]),a.delete(j[j.length-1]),l.set(j[j.length-1],V),j.reverse(),et.splice(0,0,...j)}else if(L&&N){const W=a.get(M),V=a.get(P),et=r.get(V),j=r.get(W);if(!et||!j)continue;r.delete(W),c.delete(W),a.delete(et[et.length-1]),a.delete(j[j.length-1]),l.delete(j[0]),a.set(j[0],V),j.reverse(),et.push(...j)}else if(T){const W=l.get(P),V=r.get(W);if(!V)continue;V.unshift(M),l.delete(P),l.set(M,W)}else if(L){const W=a.get(P),V=r.get(W);if(!V)continue;V.push(M),a.delete(P),a.set(M,W)}else if(E){const W=l.get(M),V=r.get(W);if(!V)continue;V.unshift(P),l.delete(M),l.set(P,W)}else if(N){const W=a.get(M),V=r.get(W);if(!V)continue;V.push(P),a.delete(M),a.set(P,W)}}const u=[];for(const[p,d]of r){if(c.has(p))continue;const g=[],m=new Map;let b=0;for(const _ of d){const y=i[_];g.push(y[0],y[1]),m.set(b++,_)}const f=TC(g);for(const _ of f){const y=m.get(_);if(y===void 0)throw new Error("Fragments: Map error!");u.push(y)}}return u}updatePlane2DCoordinateSystem(){this._plane2DCoordinateSystem=new xt;const t=this.plane.normal,e=new F;let s,i;if(this.plane.coplanarPoint(e),Math.abs(t.z)>.99)s=new F(1,0,0),i=new F(0,1,0);else if(Math.abs(t.x)>.99)s=new F(0,1,0),i=new F(0,0,1);else if(Math.abs(t.y)>.99)s=new F(1,0,0),i=new F(0,0,1);else{const r=Math.abs(t.x)<.5?new F(1,0,0):new F(0,1,0);s=new F,s.crossVectors(r,t).normalize(),i=new F,i.crossVectors(t,s).normalize()}this._plane2DCoordinateSystem.fromArray([s.x,s.y,s.z,0,i.x,i.y,i.z,0,t.x,t.y,t.z,0,e.x,e.y,e.z,1]),this._plane2DCoordinateSystem.invert()}shapecast(t,e,s){return t.geometry.boundsTree.shapecast({intersectsBounds:i=>this._localPlane.intersectsBox(i),intersectsTriangle:i=>{let r=0;if(this._tempLine.start.copy(i.a),this._tempLine.end.copy(i.b),this._localPlane.intersectLine(this._tempLine,this._tempVector)){const o=this._tempVector.applyMatrix4(t.matrixWorld);e.setXYZ(s,o.x,o.y,o.z),r++,s++}if(this._tempLine.start.copy(i.b),this._tempLine.end.copy(i.c),this._localPlane.intersectLine(this._tempLine,this._tempVector)){const o=this._tempVector.applyMatrix4(t.matrixWorld);e.setXYZ(s,o.x,o.y,o.z),r++,s++}if(this._tempLine.start.copy(i.c),this._tempLine.end.copy(i.a),this._localPlane.intersectLine(this._tempLine,this._tempVector)){const o=this._tempVector.applyMatrix4(t.matrixWorld);e.setXYZ(s,o.x,o.y,o.z),r++,s++}r!==2&&(s-=r)}}),s}},JL=class{constructor(){O(this,"int"),O(this,"float"),O(this,"buffer"),O(this,"s1",4),O(this,"s2",8);const{intBuffer:t,floatBuffer:e,buffer:s}=this.newBuffers();this.int=t,this.float=e,this.buffer=s}newBuffers(){const t=new Int32Array(1),e=t.buffer;return{intBuffer:t,floatBuffer:new Float32Array(e),buffer:new Uint8Array(e)}}},l0=class{static check(t){const e=Number.isInteger(t),s=t<this._max,i=t>this._min;return e&&s&&i}};O(l0,"_max",2147483647),O(l0,"_min",-2147483648);const PC=class RC{constructor(){O(this,"_core",new JL),O(this,"_handlers"),O(this,"_result",-1),O(this,"handleObject",(t=>{const e=Object.keys(t);for(const s of e)t.hasOwnProperty(s)&&this.compute(t[s])})),O(this,"handleString",(t=>{const e=t.length;for(let s=0;s<e;++s){const i=t.codePointAt(s);this._core.int[0]=i,this.update()}})),O(this,"handleBoolean",(t=>{this._core.int[0]=t?1:0,this.update()})),O(this,"handleNumber",(t=>{(l0.check(t)?this._core.int:this._core.float)[0]=t,this.update()})),this._handlers=this.newHandlers()}get value(){return~this._result}fromMaterialData(t){const{modelId:e,objectClass:s,currentLod:i,templateId:r,...o}=t;this.reset(),this.compute(e),this.compute(s),this.compute(o),this.compute(i),this.compute(r!==void 0)}generate(t){this.reset();for(const e of t)this.compute(e);return this.value}compute(t){return this.getHandler(t)(t),this}reset(){return this._result=-1,this}getHandler(t){const e=typeof t,s=this._handlers[e];if(!s)throw new Error("Fragments: Unsupported input type");return s}newHandlers(){return{number:this.handleNumber,boolean:this.handleBoolean,string:this.handleString,object:this.handleObject}}update(){for(let t=0;t<this._core.s1;++t){this._result^=this._core.buffer[t];for(let e=0;e<this._core.s2;++e)1&this._result?this._result=this._result>>1^RC._polynomial:this._result>>=1}}};O(PC,"_polynomial",2197175160);let Ky=PC;const Xf=class Qf{constructor(t,e){O(this,"_first"),this._first=this.newData(t,e)}static getComplementary(t,e){let s=0;const i=t.position.length;s=this.makeBufferComplementary(i,t,s,e),s!==1/0&&e(s,1/0)}static get(t,e,s,i){const{filtered:r,position:o,size:a}=this.getData(t,s);return this.setAllBufferData(r,e,o,a,i),{position:o,size:a}}fullOf(t){const e=this._first.following,s=this._first.data;return e===null&&s===t}update(t,e){const s=this.getBufferData(t);if(s.data!==e){const{a:i,c:r,b:o}=this.newBuffers(t,s,e);this.setupInputData(s,i,r),this.setupUpdateBuffers(i,o,r)}}size(t){let e=0,s=this._first;for(;s!==null;)this.doesFilterPass(t,s)&&e++,s=s.following;return e}static setAllBufferData(t,e,s,i,r){for(let o=0;o<t.length;++o){const a=t[o];this.transform(a,e),this.setBuffers(s,i,o),r&&r(o,a.data)}}static makeBufferComplementary(t,e,s,i){for(let r=0;r<t;++r){const o=this.getBuffers(e,r),{position:a,size:l}=o;a>s&&i(s,a-s),s=a+l}return s}static setBuffers(t,e,s){t[s]=this._tempData.position;const i=this._tempData.size===1/0;e[s]=i?this._inf:this._tempData.size}add(t,e,s){if(!Qf._stash.length)return this.newData(e,s,t);const i=Qf._stash.pop();if(!i)throw new Error("Fragments: No stash found");return i.position=t,i.size=e,i.data=s,i}remove(t){t&&(t.following=null,t.past=null,Qf._stash.push(t))}static getData(t,e){const s=t.filter(e),i=s.length;return{filtered:s,position:new Uint32Array(i),size:new Uint32Array(i)}}filter(t){const e=[];let s=this._first;for(;s!==null;)this.doesFilterPass(t,s)&&e.push(s),s=s.following;return e}static transform(t,e){const s=this.getTempData(),i=t.position+t.size,r=i===e.length;if(s.position=e[t.position],r)s.size=1/0;else{const o=e[i];s.size=o-s.position}return s}static getBuffers(t,e){const s=t.position[e];let i;return i=t.size[e]===this._inf?1/0:t.size[e],{position:s,size:i}}static getTempData(){return this._tempData?this._tempData:{position:0,size:0}}doesFilterPass(t,e){return!t||t(e.data)}setupUpdateBuffers(t,e,s){this.chainBuffers(t,e,s),this.setupFirstBuffer(t,e),this.setupLastBuffer(s,e),this.setupMiddleBufferStart(e),this.setupMiddleBufferEnd(e)}setupMiddleBufferEnd(t){var e;if(((e=t.following)==null?void 0:e.data)===t.data){if(!t.following)return;const s=t.following.size+t.size,i=t.following.following;t.size=s,this.remove(t.following),t.following=i,t.following&&(t.following.past=t)}}setupFirstBuffer(t,e){t.size||(t.past?t.past.following=e:this._first=e,e.past=t.past,this.remove(t))}setupMiddleBufferStart(t){var e;if(((e=t.past)==null?void 0:e.data)===t.data){if(!t.past)return;t.size=t.past.size+t.size,t.position=t.past.position;const s=t.past.past;this.remove(t.past),t.past=s,t.past?t.past.following=t:this._first=t}}chainBuffers(t,e,s){t.following=e,e.past=t,e.following=s,s.past=e}setupLastBuffer(t,e){t.size||(t.following&&(t.following.past=e),e.following=t.following,this.remove(t))}newBuffers(t,e,s){const i=t-e.position,r=this.add(e.position,i,e.data),o=this.add(t,1,s),a=e.size-r.size-1;return{a:r,c:this.add(t+1,a,e.data),b:o}}setupInputData(t,e,s){t.past?(t.past.following=e,e.past=t.past):this._first=e,t.following&&(t.following.past=s,s.following=t.following),this.remove(t)}newData(t,e,s=0){return{position:s,size:t,past:null,following:null,data:e}}getBufferData(t){let e=this._first;for(;;){const s=e===null,i=e.position<=t,r=t<e.position+e.size;if(s||i&&r)return e;e=e.following}}};O(Xf,"_stash",[]),O(Xf,"_tempData",{position:0,size:0}),O(Xf,"_inf",4294967295);let pu=Xf,Wi=class{static fixNumber(t){return Number.isNaN(t)?0:Number.isFinite(t)?t:0}static forEach(t,e){if(Array.isArray(t)){let s=0;for(const i of t)e(i,s++)}else e(t,0)}},FC=class{static estimateCapacity(){const t=this.capacityFactor,e=window.screen.width,s=window.screen.height,i=window.devicePixelRatio;return Math.trunc(e*s*i*i*t)}};O(FC,"capacityFactor",200);let hb=class{static check(t,e,s){const i=this.get(s);return!!(t[e]&i)}static apply(t,e,s,i){const r=this.get(s);i?t[e]|=r:t[e]&=~r}static checkMemory(t){if(t>qa)throw new Error("Fragments: Memory overflow!")}static get(t){return 1<<t}},Oo=class{static parseMaterial(t){const e=t.r()/255,s=t.g()/255,i=t.b()/255,r=t.a()/255,o=t.a()<255;return{color:new Dt(e,s,i),renderedFaces:t.renderedFaces(),opacity:r,transparent:o}}static parseBox(t,e){this.getBox(t,e,"min"),this.getBox(t,e,"max")}static parseTransform(t,e){return this.getVector(t,"position",this._doubleVector),this.getVector(t,"xDirection",this._floatVector),this.getVector(t,"yDirection",this._floatVector),this.computeZVector(),this.setTransform(e),e}static setTransform(t){const{x:e,y:s,z:i}=this._temp.xDirection,{x:r,y:o,z:a}=this._temp.yDirection,{x:l,y:c,z:h}=this._temp.zDirection,{x:u,y:p,z:d}=this._temp.position;t.set(e,r,l,u,s,o,c,p,i,a,h,d,0,0,0,1)}static getBox(t,e,s){t[s](this._floatVector);const i=this._floatVector.x(),r=this._floatVector.y(),o=this._floatVector.z();e[s].x=Wi.fixNumber(i),e[s].y=Wi.fixNumber(r),e[s].z=Wi.fixNumber(o)}static getVector(t,e,s){t[e](s);const i=this._temp[e],r=s.x(),o=s.y(),a=s.z();i.x=Wi.fixNumber(r),i.y=Wi.fixNumber(o),i.z=Wi.fixNumber(a)}static computeZVector(){this._temp.zDirection.crossVectors(this._temp.xDirection,this._temp.yDirection)}};O(Oo,"_temp",{position:new F,xDirection:new F,yDirection:new F,zDirection:new F}),O(Oo,"_doubleVector",new Xy),O(Oo,"_floatVector",new rs);const Js=class{static get(t,e,s){this.fetchSampleTransform(t,e),this.fetchItemTransform(t,e),s.multiplyMatrices(this._item,this._sample)}static getBox(t,e){t.bbox(this._box),Oo.parseBox(this._box,e)}static getBoxData(t){this._min.copy(t.min),this._max.copy(t.max),this._center.addVectors(this._min,this._max),this._center.divideScalar(2),t.getSize(this._distance)}static boxSize(t){return this.getBoxData(t),this.applyTransformer(),this._edge.start=this._min.clone(),this._edge.end=this._max.clone(),this._edge}static applyTransformer(){const{x:t,y:e,z:s}=this._distance,i=Math.max(t,e,s);t===i?this._transformers.x():e===i?this._transformers.y():this._transformers.z()}static fetchItemTransform(t,e){const s=t.item();e.globalTransforms(s,this._transform),Oo.parseTransform(this._transform,this._item)}static fetchSampleTransform(t,e){const s=t.localTransform();e.localTransforms(s,this._transform),Oo.parseTransform(this._transform,this._sample)}static setBoxZ(){this._min.set(this._center.x,this._center.y,this._min.z),this._max.set(this._center.x,this._center.y,this._max.z)}static setBoxY(){this._min.set(this._center.x,this._min.y,this._center.z),this._max.set(this._center.x,this._max.y,this._center.z)}static setBoxX(){this._min.set(this._min.x,this._center.y,this._center.z),this._max.set(this._max.x,this._center.y,this._center.z)}};O(Js,"_transform",new ur),O(Js,"_min",new F),O(Js,"_max",new F),O(Js,"_center",new F),O(Js,"_distance",new F),O(Js,"_edge",new qt),O(Js,"_item",new xt),O(Js,"_sample",new xt),O(Js,"_box",new Zy),O(Js,"_transformers",{x:()=>Js.setBoxX(),y:()=>Js.setBoxY(),z:()=>Js.setBoxZ()});let $r=Js,LC=class{static getWidth(t){return t.getSize(this._temp.vector),this._temp.vector.x>this._temp.vector.y&&this._temp.vector.set(this._temp.vector.y,this._temp.vector.x,this._temp.vector.z),this._temp.vector.y>this._temp.vector.z&&this._temp.vector.set(this._temp.vector.x,this._temp.vector.z,this._temp.vector.y),this._temp.vector.x>this._temp.vector.y&&this._temp.vector.set(this._temp.vector.y,this._temp.vector.x,this._temp.vector.z),this._temp.vector.y}};O(LC,"_temp",{vector:new F});let $C=class{static getEarcutDimensions(t){const e=Math.abs(t.x),s=Math.abs(t.y),i=Math.abs(t.z);return i>e&&i>s?t.z>0?[0,1]:[1,0]:s>e&&s>i?t.y>0?[2,0]:[0,2]:t.x>0?[1,2]:[2,1]}};const xw=new Tt,bp=new F;let NC=class extends jy{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new Si([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new Si([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(t){const e=this.attributes.instanceStart,s=this.attributes.instanceEnd;return e!==void 0&&(e.applyMatrix4(t),s.applyMatrix4(t),e.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(t){let e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));const s=new ja(e,6,1);return this.setAttribute("instanceStart",new ri(s,3,0)),this.setAttribute("instanceEnd",new ri(s,3,3)),this.instanceCount=this.attributes.instanceStart.count,this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(t){let e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));const s=new ja(e,6,1);return this.setAttribute("instanceColorStart",new ri(s,3,0)),this.setAttribute("instanceColorEnd",new ri(s,3,3)),this}fromWireframeGeometry(t){return this.setPositions(t.attributes.position.array),this}fromEdgesGeometry(t){return this.setPositions(t.attributes.position.array),this}fromMesh(t){return this.fromWireframeGeometry(new aC(t.geometry)),this}fromLineSegments(t){const e=t.geometry;return this.setPositions(e.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Tt);const t=this.attributes.instanceStart,e=this.attributes.instanceEnd;t!==void 0&&e!==void 0&&(this.boundingBox.setFromBufferAttribute(t),xw.setFromBufferAttribute(e),this.boundingBox.union(xw))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Us),this.boundingBox===null&&this.computeBoundingBox();const t=this.attributes.instanceStart,e=this.attributes.instanceEnd;if(t!==void 0&&e!==void 0){const s=this.boundingSphere.center;this.boundingBox.getCenter(s);let i=0;for(let r=0,o=t.count;r<o;r++)bp.fromBufferAttribute(t,r),i=Math.max(i,s.distanceToSquared(bp)),bp.fromBufferAttribute(e,r),i=Math.max(i,s.distanceToSquared(bp));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}};Lr.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Ut(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},So.line={uniforms:Nd.merge([Lr.common,Lr.fog,Lr.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};let wa=class extends Dd{constructor(t){super({type:"LineMaterial",uniforms:Nd.clone(So.line.uniforms),vertexShader:So.line.vertexShader,fragmentShader:So.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(t)}get color(){return this.uniforms.diffuse.value}set color(t){this.uniforms.diffuse.value=t}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(t){t===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(t){this.uniforms.linewidth&&(this.uniforms.linewidth.value=t)}get dashed(){return"USE_DASH"in this.defines}set dashed(t){t===!0!==this.dashed&&(this.needsUpdate=!0),t===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(t){this.uniforms.dashScale.value=t}get dashSize(){return this.uniforms.dashSize.value}set dashSize(t){this.uniforms.dashSize.value=t}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(t){this.uniforms.dashOffset.value=t}get gapSize(){return this.uniforms.gapSize.value}set gapSize(t){this.uniforms.gapSize.value=t}get opacity(){return this.uniforms.opacity.value}set opacity(t){this.uniforms&&(this.uniforms.opacity.value=t)}get resolution(){return this.uniforms.resolution.value}set resolution(t){this.uniforms.resolution.value.copy(t)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(t){this.defines&&(t===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),t===!0?this.defines.USE_ALPHA_TO_COVERAGE="":delete this.defines.USE_ALPHA_TO_COVERAGE)}};const ub=new un,Iw=new F,Cw=new F,vs=new un,ws=new un,zn=new un,db=new F,pb=new xt,Es=new qt,Tw=new F,_p=new Tt,yp=new Us,Bn=new un;let Un,Ea;function Aw(n,t,e){return Bn.set(0,0,-t,1).applyMatrix4(n.projectionMatrix),Bn.multiplyScalar(1/Bn.w),Bn.x=Ea/e.width,Bn.y=Ea/e.height,Bn.applyMatrix4(n.projectionMatrixInverse),Bn.multiplyScalar(1/Bn.w),Math.abs(Math.max(Bn.x,Bn.y))}let t5=class extends ht{constructor(t=new NC,e=new wa({color:16777215*Math.random()})){super(t,e),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const t=this.geometry,e=t.attributes.instanceStart,s=t.attributes.instanceEnd,i=new Float32Array(2*e.count);for(let o=0,a=0,l=e.count;o<l;o++,a+=2)Iw.fromBufferAttribute(e,o),Cw.fromBufferAttribute(s,o),i[a]=a===0?0:i[a-1],i[a+1]=i[a]+Iw.distanceTo(Cw);const r=new ja(i,2,1);return t.setAttribute("instanceDistanceStart",new ri(r,1,0)),t.setAttribute("instanceDistanceEnd",new ri(r,1,1)),this}raycast(t,e){const s=this.material.worldUnits,i=t.camera;i!==null||s||console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const r=t.params.Line2!==void 0&&t.params.Line2.threshold||0;Un=t.ray;const o=this.matrixWorld,a=this.geometry,l=this.material;let c,h;Ea=l.linewidth+r,a.boundingSphere===null&&a.computeBoundingSphere(),yp.copy(a.boundingSphere).applyMatrix4(o),s?c=.5*Ea:c=Aw(i,Math.max(i.near,yp.distanceToPoint(Un.origin)),l.resolution),yp.radius+=c,Un.intersectsSphere(yp)!==!1&&(a.boundingBox===null&&a.computeBoundingBox(),_p.copy(a.boundingBox).applyMatrix4(o),s?h=.5*Ea:h=Aw(i,Math.max(i.near,_p.distanceToPoint(Un.origin)),l.resolution),_p.expandByScalar(h),Un.intersectsBox(_p)!==!1&&(s?(function(u,p){const d=u.matrixWorld,g=u.geometry,m=g.attributes.instanceStart,b=g.attributes.instanceEnd;for(let f=0,_=Math.min(g.instanceCount,m.count);f<_;f++){Es.start.fromBufferAttribute(m,f),Es.end.fromBufferAttribute(b,f),Es.applyMatrix4(d);const y=new F,v=new F;Un.distanceSqToSegment(Es.start,Es.end,v,y),v.distanceTo(y)<.5*Ea&&p.push({point:v,pointOnLine:y,distance:Un.origin.distanceTo(v),object:u,face:null,faceIndex:f,uv:null,uv1:null})}})(this,e):(function(u,p,d){const g=p.projectionMatrix,m=u.material.resolution,b=u.matrixWorld,f=u.geometry,_=f.attributes.instanceStart,y=f.attributes.instanceEnd,v=Math.min(f.instanceCount,_.count),w=-p.near;Un.at(1,zn),zn.w=1,zn.applyMatrix4(p.matrixWorldInverse),zn.applyMatrix4(g),zn.multiplyScalar(1/zn.w),zn.x*=m.x/2,zn.y*=m.y/2,zn.z=0,db.copy(zn),pb.multiplyMatrices(p.matrixWorldInverse,b);for(let I=0,C=v;I<C;I++){if(vs.fromBufferAttribute(_,I),ws.fromBufferAttribute(y,I),vs.w=1,ws.w=1,vs.applyMatrix4(pb),ws.applyMatrix4(pb),vs.z>w&&ws.z>w)continue;if(vs.z>w){const T=vs.z-ws.z,L=(vs.z-w)/T;vs.lerp(ws,L)}else if(ws.z>w){const T=ws.z-vs.z,L=(ws.z-w)/T;ws.lerp(vs,L)}vs.applyMatrix4(g),ws.applyMatrix4(g),vs.multiplyScalar(1/vs.w),ws.multiplyScalar(1/ws.w),vs.x*=m.x/2,vs.y*=m.y/2,ws.x*=m.x/2,ws.y*=m.y/2,Es.start.copy(vs),Es.start.z=0,Es.end.copy(ws),Es.end.z=0;const A=Es.closestPointToPointParameter(db,!0);Es.at(A,Tw);const S=kd.lerp(vs.z,ws.z,A),P=S>=-1&&S<=1,M=db.distanceTo(Tw)<.5*Ea;if(P&&M){Es.start.fromBufferAttribute(_,I),Es.end.fromBufferAttribute(y,I),Es.start.applyMatrix4(b),Es.end.applyMatrix4(b);const T=new F,L=new F;Un.distanceSqToSegment(Es.start,Es.end,L,T),d.push({point:L,pointOnLine:T,distance:Un.origin.distanceTo(L),object:u,face:null,faceIndex:I,uv:null,uv1:null})}}})(this,i,e)))}onBeforeRender(t){const e=this.material.uniforms;e&&e.resolution&&(t.getViewport(ub),this.material.uniforms.resolution.value.set(ub.z,ub.w))}},MC=class extends NC{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(t){const e=t.length-3,s=new Float32Array(2*e);for(let i=0;i<e;i+=3)s[2*i]=t[i],s[2*i+1]=t[i+1],s[2*i+2]=t[i+2],s[2*i+3]=t[i+3],s[2*i+4]=t[i+4],s[2*i+5]=t[i+5];return super.setPositions(s),this}setColors(t){const e=t.length-3,s=new Float32Array(2*e);for(let i=0;i<e;i+=3)s[2*i]=t[i],s[2*i+1]=t[i+1],s[2*i+2]=t[i+2],s[2*i+3]=t[i+3],s[2*i+4]=t[i+4],s[2*i+5]=t[i+5];return super.setColors(s),this}setFromPoints(t){const e=t.length-1,s=new Float32Array(6*e);for(let i=0;i<e;i++)s[6*i]=t[i].x,s[6*i+1]=t[i].y,s[6*i+2]=t[i].z||0,s[6*i+3]=t[i+1].x,s[6*i+4]=t[i+1].y,s[6*i+5]=t[i+1].z||0;return super.setPositions(s),this}fromLine(t){const e=t.geometry;return this.setPositions(e.attributes.position.array),this}},e5=class extends t5{constructor(t=new MC,e=new wa({color:16777215*Math.random()})){super(t,e),this.isLine2=!0,this.type="Line2"}},s5=class{constructor(t){O(this,"model"),O(this,"_endpointsMaterials",{interior:new Z_({color:15658734,size:8,sizeAttenuation:!1,depthTest:!1}),exterior:new Z_({color:16777215,size:16,sizeAttenuation:!1,depthTest:!1})}),O(this,"_absoluteAlignments",new Fn),O(this,"_horizontalAlignments",new Fn),O(this,"_verticalAlignments",new Fn),O(this,"_alignmentMaterials",new Map([[Pn.NONE,new wa({color:16777215,linewidth:5,depthTest:!1})],[Pn.LINES,new wa({color:16711935,linewidth:5,depthTest:!1})],[Pn.CLOTHOID,new wa({color:16711680,linewidth:5,depthTest:!1})],[Pn.ELLIPSE_ARC,new wa({color:65535,linewidth:5,depthTest:!1})],[Pn.PARABOLA,new wa({color:255,linewidth:5,depthTest:!1})]])),this.model=t}async getAlignments(){return this._absoluteAlignments.children.length||await this.constructAlignments(),this._absoluteAlignments}async getHorizontalAlignments(){return this._horizontalAlignments.children.length||await this.constructAlignments(),this._horizontalAlignments}async getVerticalAlignments(){return this._verticalAlignments.children.length||await this.constructAlignments(),this._verticalAlignments}async getAlignmentStyles(){return{...this._alignmentMaterials,...this._endpointsMaterials}}async constructAlignments(){const t=await this.model.threads.invoke(this.model.modelId,"getAlignments");for(const e of t)this.constructLine(e.absolute,this._absoluteAlignments),this.constructLine(e.horizontal,this._horizontalAlignments),this.constructLine(e.vertical,this._verticalAlignments)}constructLine(t,e){if(!t.length)return;const s=[],i=[],r=new Fn;e.add(r);const o=t[0].points,a=t[t.length-1].points;i.push(a[0],a[1],a[2]),i.push(o[o.length-3],o[o.length-2],o[o.length-1]);for(const h of t){const u=h.points;s.push(u[0],u[1],u[2]),s.push(u[u.length-3],u[u.length-2],u[u.length-1]);const p=new MC;p.setPositions(u);const d=this._alignmentMaterials.get(h.type),g=new e5(p,d);r.add(g),g.renderOrder=1,g.userData.points=u}const{interior:l,exterior:c}=this._endpointsMaterials;this.constructPoints(s,l,r),this.constructPoints(i,c,r)}constructPoints(t,e,s){const i=new oC,r=new Ce,o=new Float32Array(t),a=new ze(o,3);r.setAttribute("position",a),i.geometry=r,i.material=e,s.add(i),i.renderOrder=2}dispose(){this._absoluteAlignments.removeFromParent();for(const t of this._absoluteAlignments.children){const e=t;e.geometry.dispose(),e.geometry=void 0,e.material=void 0}for(const t of Object.values(this._alignmentMaterials))t.dispose();this._alignmentMaterials={}}},i5=class{async setup(t,e,s,i,r){const o=this.getCreateModelMessage(t,s,i,r),a=this.formatModelData(s),l=await t.threads.fetch(o,a);this.updateBox(e,l)}formatModelData(t){if(t instanceof ArrayBuffer)return[t]}updateBox(t,e){t.min.copy(e.boundingBox.min),t.max.copy(e.boundingBox.max)}getCreateModelMessage(t,e,s,i){return{class:Ci.CREATE_MODEL,modelId:t.modelId,modelData:e,raw:s,config:i}}},n5=class{async getBoxes(t,e){const s=this.getIndividualBoxesIds(e),i=this.getBoxRequest(t,s),r=await t.threads.fetch(i);return this.getAllBoxes(r,t)}async getMergedBox(t,e){const s=this.getBoxRequest(t,[e]),{boxes:i}=await t.threads.fetch(s),[r]=i;return this.getAbsoluteBox(r,t)}getAbsoluteBox(t,e){const s=new Tt;return s.copy(t),s.applyMatrix4(e.object.matrixWorld),s}getIndividualBoxesIds(t){if(!t)return;const e=[];for(const s of t)e.push([s]);return e}getAllBoxes(t,e){const s=t.boxes,i=[];for(const r of s){const o=new Tt;o.copy(r),o.applyMatrix4(e.object.matrixWorld),i.push(o)}return i}getBoxRequest(t,e){return{class:Ci.FETCH_BOXES,modelId:t.modelId,localIds:e}}},r5=class{constructor(){O(this,"_coordinationMatrices",new Map)}async getCoordinationMatrix(t){let e=this._coordinationMatrices.get(t.modelId);if(e)return e;e=new xt,this._coordinationMatrices.set(t.modelId,e);const[s,i,r,o,a,l,c,h,u]=await this.getCoordinates(t),p=new F(o,a,l),d=new F(c,h,u),g=new F().crossVectors(p,d);return e.set(o,c,g.x,s,a,h,g.y,i,l,u,g.z,r,0,0,0,1),e}async getCoordinates(t){const e=t.modelId;return t.threads.invoke(e,"getCoordinates")}async getPositions(t,e){const s=[e],i=await t.threads.invoke(t.modelId,"getPositions",s);return this.getAbsolutePositions(i,t)}getAbsolutePositions(t,e){const s=[];for(const i of t){const{x:r,y:o,z:a}=i,l=new F(r,o,a);l.applyMatrix4(e.object.matrixWorld),s.push(l)}return s}},o5=class extends Map{constructor(t,e){super(e),O(this,"tracker",null),O(this,"localId"),O(this,"guard",(()=>!0)),this.localId=t}get object(){const t={};for(const[e,s]of this.entries())t[e]=s.value;return t}set(t,e){if(!(this.guard??(()=>!0))(t,e))return this;const s=e.type!==void 0?e:{value:e.value,type:this.getType(t)};if(!this.tracker)return super.set(t,s);if(this.localId===null)return console.warn("Item attributes are missing a valid localId. Changes can't be tracked."),super.set(t,s);let i=this.tracker.get(this.localId);return i||(i={type:"modified",added:{},deleted:[],modified:{}},this.tracker.set(this.localId,i)),i.type==="added"?i.data[t]=s:i.type==="modified"&&(this.has(t)?i.modified[t]=s:i.deleted.includes(t)?(i.deleted=i.deleted.filter((r=>r!==t)),i.modified[t]=s):i.added[t]=s),super.set(t,s)}setValue(t,e){return this.set(t,{value:e,type:this.getType(t)})}setType(t,e){const s=this.getValue(t);return s?this.set(t,{value:s,type:e}):this}delete(t){if(!this.tracker)return super.delete(t);const e=this.get("localId");if(e===void 0||typeof e!="number")return console.warn("Item attributes are missing a valid localId. Changes can't be tracked."),t!=="localId"&&super.delete(t);if(t==="localId"||!this.has(t))return!1;let s=this.tracker.get(e);return s||(s={type:"modified",added:{},deleted:[],modified:{}},this.tracker.set(e,s)),s.type==="added"?delete s.data[t]:s.type==="modified"&&(t in s.added?delete s.added[t]:(t in s.modified&&delete s.modified[t],s.deleted.push(t))),super.delete(t)}getValue(t){const e=this.get(t);return e?e.value:null}getType(t){var e;return(e=this.get(t))==null?void 0:e.type}},a5=class extends Map{constructor(t,e){super(e),O(this,"tracker",null),O(this,"localId"),O(this,"guard",(()=>!0)),O(this,"onItemsRequested",null),this.localId=t}get itemChanges(){if(!this.tracker)return null;if(!this.localId)return console.warn("Item relations can't be tracked."),null;let t=this.tracker.get(this.localId);return t||(t={type:"modified",added:{},deleted:new Set,removed:{},modified:{}},this.tracker.set(this.localId,t)),t}set(t,e){const s=this.has(t);if(!(this.guard??(()=>!0))(t,e))return this;const i=this.itemChanges;return i?(s?i.modified[t]=e:i.added[t]=e,super.set(t,e)):super.set(t,e)}add(t,e){var s;const i=this.has(t);let r=this.get(t);if(!r)return r=new Set([e]),this.set(t,r),!0;if(!r||r.has(e))return!1;const o=this.itemChanges;if(!o)return r.add(e),!0;if(i)if((s=o.removed[t])!=null&&s.has(e))o.removed[t].delete(e),o.removed[t].size===0&&delete o.removed[t];else{let a=o.modified[t];a||(a=new Set,o.modified[t]=a),a.add(e)}else{let a=o.added[t];a||(a=new Set,o.added[t]=a),a.add(e)}return r.add(e),!0}remove(t,e){var s;const i=this.get(t);if(!i||!i.has(e))return!1;const r=this.itemChanges;if(!r)return i.delete(e);if((s=r.modified[t])!=null&&s.has(e))r.modified[t].delete(e),r.modified[t].size===0&&delete r.modified[t];else{let o=r.removed[t];o||(o=new Set,r.removed[t]=o),o.add(e)}return i.delete(e)}delete(t){if(!this.has(t))return!1;const e=this.itemChanges;return e?(e.deleted.add(t),super.delete(t)):super.delete(t)}async getItems(t){if(!this.onItemsRequested)return null;const e=this.get(t);return e?await this.onItemsRequested([...e]):null}},l5=class{constructor(t,e){O(this,"model"),O(this,"localId"),O(this,"_indices",null),O(this,"_transform",null),O(this,"_normals",null),O(this,"_positions",null),O(this,"_vertices",null),O(this,"_triangles",null),O(this,"_position",null),O(this,"_box",null),this.model=t,this.localId=e}async get(){const[t]=await this.model.threads.invoke(this.model.modelId,"getItemsGeometry",[[this.localId]]);for(const e of t){e.transform=new xt().fromArray(e.transform.elements);const{indices:s,normals:i,positions:r,transform:o}=e;this._indices||(this._indices=[]),this._normals||(this._normals=[]),this._positions||(this._positions=[]),this._transform||(this._transform=[]),this._indices.push(s),this._normals.push(i),this._positions.push(r),this._transform.push(o)}return t}async getIndices(){return this._indices!==null||await this.get(),this._indices}async getTransform(){return this._transform!==null||await this.get(),this._transform}async getNormals(){return this._normals!==null||await this.get(),this._normals}async getPositions(){return this._positions!==null||await this.get(),this._positions}async getVertices(){if(this._vertices)return this._vertices;const t=await this.getPositions(),e=await this.getTransform();if(!t||!e)return this._vertices;this._vertices=[];for(let s=0;s<t.length;s++){const i=t[s],r=e[s];if(!i||!r)continue;const o=[];this._vertices.push(o);const a=Object.keys(i).length/3,l=[];for(let c=0;c<a;c++){const h=i[3*c],u=i[3*c+1],p=i[3*c+2];if(typeof h!="number"||typeof u!="number"||typeof p!="number")continue;const d=`${h},${u},${p}`;if(l.includes(d))continue;l.push(d);const g=new F(h,u,p);g.applyMatrix4(r),o.push(g)}}return this._vertices}async getTriangles(){if(this._triangles)return this._triangles;const t=await this.getIndices(),e=await this.getPositions(),s=await this.getTransform();if(!t||!e||!s)return this._triangles;this._triangles=[];for(let i=0;i<t.length;i++){const r=t[i],o=e[i],a=s[i];if(!r||!o||!a)continue;const l=[];this._triangles.push(l);for(let c=0;c<r.length;c+=3){const h=r[c],u=r[c+1],p=r[c+2],d=new F(o[3*h],o[3*h+1],o[3*h+2]),g=new F(o[3*u],o[3*u+1],o[3*u+2]),m=new F(o[3*p],o[3*p+1],o[3*p+2]);d.applyMatrix4(a),g.applyMatrix4(a),m.applyMatrix4(a),l.push(new ns(d,g,m))}}return this._triangles}async getPosition(){if(!this._position){if(this.localId===null)return null;this._position=await this.model.getPositions([this.localId])}return this._position}async getBox(){if(!this._box){if(this.localId===null)return null;this._box=await this.model.getBoxes([this.localId])}return this._box}async setVisibility(t){await this.model.setVisible([this.localId],t)}async getVisibility(){const[t]=await this.model.getVisible([this.localId]);return t}},c5=class{constructor(t,e){O(this,"model"),O(this,"_localId",null),O(this,"_attributes",null),O(this,"_relations",null),O(this,"_guid",null),O(this,"_category",null),O(this,"_geometry",null),this.model=t,typeof e=="number"&&(this._localId=e),typeof e=="string"&&(this._guid=e)}async getLocalId(){if(!this._localId){if(!this._guid)throw new Error("Fragments: Item localId couldn't be get.");[this._localId]=await this.model.threads.invoke(this.model.modelId,"getLocalIdsByGuids",[[this._guid]])}return this._localId}async getAttributes(){if(this._attributes)return this._attributes;const t=await this.getLocalId();if(t===null)return null;const e=await this.model.threads.invoke(this.model.modelId,"getItemAttributes",[t]);if(this._attributes=new o5(t),!e){const i=this.model.attrsChanges.get(t);if(!i||i.type!=="added")return null;this._attributes.localId=t;for(const[r,o]of Object.entries(i.data))this._attributes.set(r,o);return this._attributes}const s=this.model.attrsChanges.get(t);if(s&&s.type==="modified")for(const[i,r]of Object.entries(s.added))this._attributes.set(i,r);for(const i in e){const{value:r,type:o}=e[i];s?.type==="modified"&&s.deleted.includes(i)||(s?.type==="modified"&&i in s.modified?this._attributes.set(i,s.modified[i]):this._attributes.set(i,{value:r,type:o}))}return this._attributes.tracker=this.model.attrsChanges,this._attributes}async getRelations(){if(this._relations)return this._relations;const t=await this.getLocalId();if(t===null)return null;const e=await this.model.threads.invoke(this.model.modelId,"getItemRelations",[t]);if(!e)return null;this._relations=new a5(t),this._relations.onItemsRequested=async i=>{const r=[];for(const o of i){const a=this.model.getItem(o);a&&r.push(a)}return r};const s=this.model.relsChanges.get(t);if(s&&s.type==="modified")for(const[i,r]of Object.entries(s.added))this._relations.set(i,r);for(const[i,r]of Object.entries(e))if(s?.type!=="modified"||!s.deleted.has(i))if(s?.type==="modified"&&i in s.modified){const o=new Set([...s.modified[i],...r]);this._relations.set(i,new Set(o))}else this._relations.set(i,new Set(r));return this._relations.tracker=this.model.relsChanges,this._relations}async getGuid(){if(!this._guid){const t=await this.getLocalId();if(t===null)return null;[this._guid]=await this.model.threads.invoke(this.model.modelId,"getGuidsByLocalIds",[[t]])}return this._guid}async getCategory(){if(!this._category){const t=await this.getLocalId();if(t===null)return null;this._category=await this.model.threads.invoke(this.model.modelId,"getItemCategory",[t])}return this._category}async getGeometry(){if(this._geometry)return this._geometry;const t=await this.getLocalId();return t===null?null:new l5(this.model,t)}async getData(t=[]){var e;const s=await this.getLocalId();if(s==null)return{};t.push(s);const i=(e=await this.getAttributes())==null?void 0:e.object,r=await this.getRelations(),o={};if(r)for(const a of r.keys()){const l=[];o[a]=l;const c=await r.getItems(a);if(c)for(const h of c){const u=await h.getLocalId();if(!u||t.find((d=>d===u))!==void 0)continue;t.push(u);const p=await h.getData(t);p&&l.push(p)}}return{...i,...o}}},h5=class{getItem(t,e){return new c5(t,e)}async getItemsData(t,e,s){return t.threads.invoke(t.modelId,"getItemsData",[e,s])}async getItemsChildren(t,e){return t.threads.invoke(t.modelId,"getItemsChildren",[e])}},u5=class{constructor(){O(this,"getClippingPlanesEvent",(()=>[])),O(this,"_tempMatrix",new xt),O(this,"_tempVec",new F),O(this,"_tempFrustum",new No),O(this,"_updateCameraPositionEvent",(()=>{})),O(this,"_updateCameraFrustumEvent",(()=>{})),O(this,"_updateFOVEvent",(()=>{})),O(this,"_updateOrthoSizeEvent",(()=>{}))}async refreshView(t,e){const s=this.setup(e,t),i=Ma.transform(this._tempFrustum,this._tempMatrix),r=this.newViewRequest(i,s,t);await t.threads.fetch(r)}useCamera(t){const e=new xt;this.setCameraPosition(t),this.setCameraFrustum(t,e),this.setFov(t),this.setOrtho()}getOrthoSize(){let t=this._updateOrthoSizeEvent();return t&&(t*=this._tempMatrix.getMaxScaleOnAxis()),t}setup(t,e){return t.requests.clean(e.modelId),this._tempMatrix.copy(e.object.matrixWorld).invert(),this._updateCameraPositionEvent(this._tempVec),this._updateCameraFrustumEvent(this._tempFrustum),this._updateFOVEvent()}newViewRequest(t,e,s){const i=this.newView(t,e,s),r={};return r.class=Ci.REFRESH_VIEW,r.modelId=s.modelId,r.cameraFrustum=t,r.view=i,r}newView(t,e,s){const i={};return i.cameraFrustum=t,i.cameraPosition=this._tempVec.applyMatrix4(this._tempMatrix),i.fov=e,i.orthogonalDimension=this.getOrthoSize(),i.viewSize=Math.max(window.innerWidth,window.innerHeight),i.graphicThreshold=FC.estimateCapacity(),i.graphicQuality=-1.5*s.graphicsQuality+2,i.clippingPlanes=this.getPlanes(),i.modelPlacement=s.object.matrixWorld,i}setOrtho(){this._updateOrthoSizeEvent=()=>{}}setFov(t){this._updateFOVEvent=()=>{if(t instanceof Md)return t.fov}}getPlanes(){const t=[],e=this.getClippingPlanesEvent();for(const s of e){const i=s.clone();i.applyMatrix4(this._tempMatrix),t.push(i)}return t}setCameraPosition(t){this._updateCameraPositionEvent=e=>{e.copy(t.position)}}setCameraFrustum(t,e){this._updateCameraFrustumEvent=s=>{t.updateProjectionMatrix(),t.updateWorldMatrix(!0,!0);const{projectionMatrix:i,matrixWorldInverse:r}=t;e.multiplyMatrices(i,r),s.setFromProjectionMatrix(e)}}},d5=class{constructor(){O(this,"_caster",new el),O(this,"_ray",new $o),O(this,"_frustum",new No),O(this,"_inverseTransform",new xt),O(this,"_t",new Wt),O(this,"_r",new Wt),O(this,"_b",new Wt),O(this,"_l",new Wt),O(this,"_n",new Wt),O(this,"_f",new Wt),O(this,"_tl",new F),O(this,"_tr",new F),O(this,"_bl",new F),O(this,"_br",new F),O(this,"_tln",new F),O(this,"_brn",new F),O(this,"_tlp",new Ut),O(this,"_brp",new Ut),O(this,"distance",10)}async raycast(t,e){const{frustum:s,ray:i}=this.getRayAndFrustum(e),r=this.getRequest(t,s,i);if(!r)return null;const o=await t.threads.fetch(r);if(o.results&&o.results.length){const[a]=o.results;return this.getResult({hit:a,frustum:s,ray:i,model:t})}return null}async rectangleRaycast(t,e,s){const i=this.getFrustum(s),r=this.getRequest(t,i);if(!r)return null;r.fullyIncluded=s.fullyIncluded;const o=await t.threads.fetch(r);return o.localIds&&o.localIds.length?this.newRectangleCastResponse(o,e):null}async raycastWithSnapping(t,e){const{frustum:s,ray:i}=this.getRayAndFrustum(e),r=this.getRequest(t,s,i);if(!r)return null;r.snappingClass=e.snappingClasses;const o=await t.threads.fetch(r);return o.results?this.newRaycastSnapResult(o,s,i,t):null}screenRectToFrustum(t,e,s,i){return this.screenToCast(t,s,this._tlp),this.screenToCast(e,s,this._brp),this.setVectors(i),this.setPlanes(i),this.newFrustum()}screenToCasterPoint(t,e,s){const i=this.screenToCast(t,e);return this._caster.setFromCamera(i,s),this._caster.ray.clone()}setPlanes(t){this.setBasePoints(),t.getWorldDirection(this._n.normal),this.setEnds(t)}setVectors(t){this.setVector(this._tl,this._tlp,this._tlp,1,t),this.setVector(this._tr,this._brp,this._tlp,1,t),this.setVector(this._bl,this._tlp,this._brp,1,t),this.setVector(this._br,this._brp,this._brp,1,t),this.setVector(this._tln,this._tlp,this._tlp,0,t),this.setVector(this._brn,this._brp,this._brp,0,t)}newFrustum(){return new No(this._t,this._b,this._l,this._r,this._f,this._n)}setEnds(t){this._n.constant=t.position.length(),this._f.normal=this._n.normal,this._f.constant=1/0}screenToCast(t,e,s=new Ut){const i=e.getBoundingClientRect(),r=i.width/e.clientWidth,o=i.height/e.clientHeight,a=(t.x-i.left)/r,l=(t.y-i.top)/o;return s.x=a/e.clientWidth*2-1,s.y=-l/e.clientHeight*2+1,s}setVector(t,e,s,i,r){t.set(e.x,s.y,i),t.unproject(r)}setPlane(t,e,s,i){t.setFromCoplanarPoints(e,s,i)}setBasePoints(){this.setPlane(this._t,this._tln,this._tl,this._tr),this.setPlane(this._r,this._brn,this._tr,this._br),this.setPlane(this._b,this._brn,this._br,this._bl),this.setPlane(this._l,this._tln,this._bl,this._tl)}setupRay(t,e){t&&(this._ray.copy(t),this._ray.applyMatrix4(this._inverseTransform),e.ray=this._ray)}setupMatrix(t){this._inverseTransform.copy(t.matrixWorld),this._inverseTransform.invert()}getRequest(t,e,s){const{object:i,box:r,modelId:o}=t;return e.intersectsBox(r)?this.newCastRequest(i,o,s,e):null}getRayAndFrustum(t){this.updateCamera(t.camera);const{bottomLeft:e,topRight:s}=this.getCorners(t.mouse);return{ray:this.screenToCasterPoint(t.mouse,t.dom,t.camera),frustum:this.screenRectToFrustum(e,s,t.dom,t.camera)}}getFrustum(t){return this.updateCamera(t.camera),this.screenRectToFrustum(t.topLeft,t.bottomRight,t.dom,t.camera)}getCorners(t){return{bottomLeft:t.clone().subScalar(this.distance),topRight:t.clone().addScalar(this.distance)}}getResult(t){const{hit:e,frustum:s,ray:i,model:r}=t,o={};return this.setPoint(r,e,o),this.setNormal(r,e,o),this.setDistance(r,e,o),this.setRayDistance(r,e,o),this.setBasicHitData(r,e,o,i,s),this.setSnapEdge(r,e,o,"snappedEdgeP1"),this.setSnapEdge(r,e,o,"snappedEdgeP2"),o.facePoints=e.facePoints,o.faceIndices=e.faceIndices,o}updateCamera(t){t.updateProjectionMatrix(),t.updateWorldMatrix(!0,!0)}newCastRequest(t,e,s,i){this.setupMatrix(t);const r={};return r.class=Ci.RAYCAST,r.modelId=e,this.setupRay(s,r),Ma.transform(i,this._inverseTransform,this._frustum),r.frustum=this._frustum,r}setSnapEdge(t,e,s,i){if(e[i]){const r=new F;r.copy(e[i]),r.applyMatrix4(t.object.matrixWorld),s[i]=r}else s[i]=void 0}setNormal(t,e,s){if(e.normal){const i=new F;return i.copy(e.normal),i.transformDirection(t.object.matrixWorld),i.normalize(),void(s.normal=i)}s.normal=void 0}setDistance(t,e,s){const i=Math.sqrt(e.cameraSquaredDistance),r=t.object.matrixWorld.getMaxScaleOnAxis();s.distance=i*r}setPoint(t,e,s){const i=new F;i.copy(e.point),i.applyMatrix4(t.object.matrixWorld),s.point=i}newRaycastSnapResult(t,e,s,i){const r=[];for(const o of t.results){const a=this.getResult({hit:o,frustum:e,ray:s,model:i});r.push(a)}return r}newRectangleCastResponse(t,e){return{localIds:t.localIds,fragments:e.list.get(t.modelId)}}setRayDistance(t,e,s){if(e.raySquaredDistance===void 0)s.rayDistance=void 0;else{const i=t.object.matrixWorld.getMaxScaleOnAxis(),r=Math.sqrt(e.raySquaredDistance);s.rayDistance=r*i}}setBasicHitData(t,e,s,i,r){s.itemId=e.itemId,s.localId=e.localId,s.object=t.object,s.fragments=t,s.ray=i,s.frustum=r,s.representationClass=e.representationClass,s.snappingClass=e.snappingClass}},p5=class{async resetVisible(t){await t.threads.invoke(t.modelId,"resetVisible")}async getItemsByVisibility(t,e){return t.threads.invoke(t.modelId,"getItemsByVisibility",[e])}async getVisible(t,e){return t.threads.invoke(t.modelId,"getVisible",[e])}},Pm=class{};O(Pm,"vertex",`
            #include <common>
            #include <clipping_planes_pars_vertex>

            attribute float itemFilter;
            uniform vec2 lodSize;
            attribute vec3 itemFirst;
            attribute vec3 itemLast;

            float lodWidth = 2.0;
            
            void cutLodLine(const in vec4 first, inout vec4 second ) {
                float projValue1 = projectionMatrix[2][2];
                float projValue2 = projectionMatrix[3][2];
                float approxResult = -(projValue2 / projValue1) / 2.0;
                float diff1 = approxResult - first.z;
                float diff2 = second.z - first.z;
                float cutFilter = diff1 / diff2;
                second.xyz = mix(first.xyz, second.xyz, cutFilter);
            }
                
            void main() {
                if (itemFilter == 0.0) {
                    gl_Position = vec4(0,0,0,0);
                    return;
                }

                vec4 rawFirst = vec4(itemFirst, 1.0);
                vec4 rawLast = vec4(itemLast, 1.0);
                vec4 first = modelViewMatrix * rawFirst;
                vec4 last = modelViewMatrix * rawLast;
                
                bool lodPerspective = projectionMatrix[2][3] == -1.0;
                if (lodPerspective) {
                    bool firstCut = first.z < 0.0 && last.z >= 0.0;
                    bool lastCut = last.z < 0.0 && first.z >= 0.0;
                    if (firstCut) {
                        cutLodLine( first, last );
                    } else if (lastCut) {
                        cutLodLine( last, first );
                    }
                }

                vec4 firstCut = projectionMatrix * first;
                vec4 lastCut = projectionMatrix * last;
                vec3 firstNdc = firstCut.xyz / firstCut.w;
                vec3 lastNdc = lastCut.xyz / lastCut.w;

                vec2 lodOrientation = lastNdc.xy - firstNdc.xy;

                float lodRatio = lodSize.x / lodSize.y;
                lodOrientation.x *= lodRatio;
                lodOrientation = normalize(lodOrientation);
                
                vec2 lodDistance = vec2(lodOrientation.y, - lodOrientation.x);
                lodOrientation.x /= lodRatio;
                lodDistance.x /= lodRatio;

                if (position.x < 0.0) { 
                    lodDistance *= - 1.0;
                }

                if (position.y < 0.0) {
                    lodDistance += -lodOrientation;
                } else if (position.y > 1.0) {
                    lodDistance += lodOrientation;
                }

                lodDistance *= lodWidth;
                lodDistance /= lodSize.y;

                bool isFirst = position.y < 0.5;
                vec4 lodPosition = isFirst ? firstCut : lastCut;
                lodDistance *= lodPosition.w;
                lodPosition.xy += lodDistance;
                gl_Position = lodPosition;

                vec4 mvPosition = isFirst ? first : last;
                #include <clipping_planes_vertex>
            }
    `),O(Pm,"fragment",`
            #include <common>
            #include <clipping_planes_pars_fragment>

            uniform vec3 lodColor;
            uniform float lodOpacity;

            void main() {
                #include <clipping_planes_fragment>
                gl_FragColor = vec4(lodColor, lodOpacity);
                #include <colorspace_fragment>
            }
    `);const fu=class ro{static setupLodMeshResize(t){t.onBeforeRender=e=>{e.getSize(t.material[0].lodSize)}}static setupLodAttributes(t){t.setIndex(ro.indices),t.setAttribute("position",ro.vertices)}static setLodBuffer(t,e,s){let i=t.getItemFirst(),r=t.getItemLast(),o=this.setItemFirst(t,i,e,r);({itemFirst:i,dataBuffer:o,itemLast:r}=this.resetAttributes(i,o,e,r)),this.setupFinish(s,o),t.setAttribute("itemFirst",i),t.setAttribute("itemLast",r)}static setLodVisibility(t,e){const s=this.setupItemFilter(t);this.applyVisibilityState(t,e,s),s.needsUpdate=!0}static getInterAttribute(t,e){return t.getAttribute(e)}static computeLodSphere(t){if(!t.boundingSphere)return;const e=t.getItemFirst();if(e){const s=ro.getLodMidPoint(t,e),i=ro.getLodRadius(s,e);t.boundingSphere.radius=i}}static newLodMaterialParams(t){const e={lodColor:{value:new Dt(t.color)},lodSize:{value:new Ut(1,1)},lodOpacity:{value:t.opacity??1}};return{uniforms:Nd.merge([Lr.common,e]),transparent:t.transparent??!1,vertexShader:Pm.vertex,fragmentShader:Pm.fragment}}static setLodFilter(t,e){const s=t.getItemFilter(),i=s.array;for(let r=0;r<e.position.length;++r){const o=e.position[r]/2,a=e.size[r]/2;a===4294967295?i.fill(1,o):i.fill(1,o,o+a)}s.needsUpdate=!0}static getInstancedAttribute(t,e){return t.getAttribute(e)}static computeLodBox(t){if(!t.boundingBox)return;const e=t.getItemFirst();if(e){const s=e.data.array;t.boundingBox.setFromArray(s)}else t.boundingBox.makeEmpty()}static setDataBuffer(t,e,s){return(t=e.data).array=s,t.needsUpdate=!0,t}static disposeAllData(t){delete t.attributes.itemFilter,delete t.attributes.position,t.index=null,t.dispose(),ro.setupLodAttributes(t)}static setItemFirst(t,e,s,i){let r=null;return e&&(s.length===e.data.array.length?r=this.setDataBuffer(r,e,s):(e=void 0,this.disposeAllData(t))),r}static setupFinish(t,e){t&&(e.onUploadCallback=t)}static resetAttributes(t,e,s,i){return t||(e=new ja(s,6,1),t=new ri(e,3,0),i=new ri(e,3,3)),{itemFirst:t,dataBuffer:e,itemLast:i}}static setupItemFilter(t){const e=t.getItemFirst().count;let s=t.getItemFilter();return s?s.array.fill(0):(s=new i3(new Uint8Array(e),1),t.setAttribute("itemFilter",s)),s}static applyVisibilityState(t,e,s){e!==!0?e&&this.setLodFilter(t,e):s.array.fill(1)}static getLodMidPoint(t,e){const s=t.boundingSphere.center;return this.tempBox.setFromArray(e.data.array),this.tempBox.getCenter(s),s}static getLodRadius(t,e){let s=0;const i=e.data.array.length;for(let r=0;r<i;r+=3){const o=e.data.array;ro.tempVec.fromArray(o,r);const a=t.distanceToSquared(ro.tempVec);s=Math.max(s,a)}return Math.sqrt(s)}};O(fu,"tempVec",new F),O(fu,"tempBox",new Tt),O(fu,"vertices",new Si([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),O(fu,"indices",new s3([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5],1));let On=fu,Sw=class extends ht{constructor(t,e){super(t,e),O(this,"geometry"),O(this,"material"),this.geometry=t,this.material=e,On.setupLodMeshResize(this)}},f5=class extends jy{constructor(){super(),O(this,"isLODGeometry",!0),On.setupLodAttributes(this)}isFiltered(){return!!this.getItemFilter()}computeBoundingBox(){this.boundingBox||(this.boundingBox=new Tt),On.computeLodBox(this)}applyMatrix4(t){return this.applyTransformToBuffers(t),this.updateBounds(),this}computeBoundingSphere(){this.boundingSphere||(this.boundingSphere=new Us),On.computeLodSphere(this)}getItemFilter(){return On.getInstancedAttribute(this,"itemFilter")}getItemLast(){return On.getInterAttribute(this,"itemLast")}getItemFirst(){return On.getInterAttribute(this,"itemFirst")}applyTransformToBuffers(t){this.getItemFirst().applyMatrix4(t),this.getItemLast().applyMatrix4(t)}updateBounds(){this.boundingBox&&this.computeBoundingBox(),this.boundingSphere&&this.computeBoundingSphere()}},m5=class extends Dd{constructor(t){super(On.newLodMaterialParams(t)),O(this,"isLodMaterial",!0),O(this,"isLineMaterial",!0),this.clipping=!0,this.lights=!1,this.needsUpdate=!0}get lodSize(){return this.uniforms.lodSize.value}set lodColor(t){this.uniforms.lodColor.value=t}set lodSize(t){this.uniforms.lodSize.value.copy(t)}get lodColor(){return this.uniforms.lodColor.value}},Jy=class{constructor(){O(this,"list",new Yt),O(this,"_modelMaterialMapping",new Map),O(this,"_definitions",new Map),O(this,"_idGenerator",new Ky),O(this,"white",4294967295)}static resetColors(t){for(const e of t){if(!e||!e.color)continue;const{color:s}=e;if(s.isColor)continue;const{r:i,g:r,b:o}=s;e.color=new Dt(i,r,o)}}dispose(t){this._definitions.delete(t);const e=this._modelMaterialMapping.get(t);if(e){for(const s of e){const i=this.list.get(s);i&&(i.dispose(),this.list.delete(s))}this._modelMaterialMapping.delete(t)}}get(t,e){const{modelId:s,objectClass:i,currentLod:r,templateId:o}=e;if(!s||i===void 0||r===void 0)throw new Error("Fragments: material definition information is missing to create the material.");this._idGenerator.fromMaterialData({modelId:s,objectClass:i,currentLod:r,templateId:o,...t});const{value:a}=this._idGenerator;return this.getUniqueMaterial(a,t,e)}addDefinitions(t,e){const s=this._definitions.get(t);s?s.push(...e):this._definitions.set(t,e)}createHighlights(t,e){const{tileData:{highlightData:s,highlightIds:i},modelId:r,material:o}=e,{geometry:a}=t,l=t.material.slice(0,2),c=new Map,h=this._definitions.get(r);if(!h)return l;for(let u=0;u<s.position.length;u++){const p=i[u];this.processHighlight(c,p,h,o,e,l);const d=s.position[u],g=s.size[u],m=g===this.white?1/0:g;a.addGroup(d,m,c.get(i[u]))}return l}getFromRequest(t){const{material:e,modelId:s}=t,i=this._definitions.get(s),r=i?.[e];if(!r)throw new Error(`Fragments: Missing mesh material for index ${e}`);return this.get(r,t)}newLODMaterial(t,e){const{data:s}=t,i=new Dt(s.color);e.currentLod===jt.WIRES&&i.multiplyScalar(.85);const r={color:i,...this.getParameters(s)},o=new m5(r);return o.userData={customId:s.customId},o}getParameters(t){const{opacity:e,transparent:s}=t;return{opacity:e,transparent:s||e<1,clipIntersection:!1}}new(t,e){const{objectClass:s,templateId:i}=e;let r;if(s===zs.SHELL)r=new nd({color:t.color,transparent:t.opacity<1,opacity:t.opacity,userData:{customId:t.customId},depthTest:t.depthTest??!0});else{if(s!==zs.LINE)throw new Error("Fragments: Unsupported object class");r=this.newLODMaterial({data:t,instancing:i!==void 0},e)}return r}addMaterialToModel(t,e){let s=this._modelMaterialMapping.get(t);s||(s=new Set,this._modelMaterialMapping.set(t,s)),s.add(e)}processHighlight(t,e,s,i,r,o){if(!t.has(e)){const a={...s[i],...s[e]},l=this.get(a,r);o.push(l),t.set(e,o.length-1)}}getUniqueMaterial(t,e,s){const i=s.modelId;let r=this.list.get(t);return r||(r=this.new(e,s),this.list.set(t,r),this.addMaterialToModel(i,t),r)}},g5=class{async getHighlight(t,e){const s=await t.threads.invoke(t.modelId,"getHighlight",[e]);return Jy.resetColors(s),s}async highlight(t,e,s){await t.threads.invoke(t.modelId,"highlight",[e,s])}async getHighlightItemIds(t){return t.threads.invoke(t.modelId,"getHighlightItemIds")}async resetHighlight(t,e){await t.threads.invoke(t.modelId,"resetHighlight",[e])}},b5=class{async getSection(t,e,s){const i=[e,s];return await t.threads.invoke(t.modelId,"getSection",i)}},_5=class{async dispose(t,e,s){e.list.delete(t.modelId),await this.requestModelDelete(t),t.threads.delete(t.modelId),this.deleteAllTiles(t),e.materials.dispose(t.modelId),s.dispose()}async getBuffer(t,e){return t.threads.invoke(t.modelId,"getBuffer",[e])}async getCategories(t){return t.threads.invoke(t.modelId,"getCategories")}async getMaxLocalId(t){return t.threads.invoke(t.modelId,"getMaxLocalId")}async getLocalIdsByGuids(t,e){return t.threads.invoke(t.modelId,"getLocalIdsByGuids",[e])}async getSpatialStructure(t){return t.threads.invoke(t.modelId,"getSpatialStructure")}async getItemsWithGeometry(t){return(await t.threads.invoke(t.modelId,"getItemsWithGeometry",[])).map((e=>t.getItem(e)))}async getItemsWithGeometryCategories(t){return t.threads.invoke(t.modelId,"getItemsWithGeometryCategories",[])}async getItemsIdsWithGeometry(t){return t.threads.invoke(t.modelId,"getItemsWithGeometry",[])}async getItemsOfCategories(t,e){const s=[e];return await t.threads.invoke(t.modelId,"getItemsOfCategories",s)}async getItemsByQuery(t,e){const s=[e];return await t.threads.invoke(t.modelId,"getItemsByQuery",s)}async getMetadata(t){return t.threads.invoke(t.modelId,"getMetadata",[])}async getGuidsByLocalIds(t,e){return t.threads.invoke(t.modelId,"getGuidsByLocalIds",[e])}async requestModelDelete(t){await t.threads.fetch({class:Ci.DELETE_MODEL,modelId:t.modelId})}deleteAllTiles(t){for(const[e]of t.tiles)t.tiles.delete(e)}},y5=class{async getSequenced(t,e,s,i){const r=[e,s,i];return await t.threads.invoke(t.modelId,"getSequenced",r)}},DC=class{constructor(t,e,s){O(this,"attrsChanges",new Map),O(this,"relsChanges",new Map),O(this,"threads"),O(this,"tiles",new Yt),O(this,"object",new Oi),O(this,"graphicsQuality",0),O(this,"_boxManager",new n5),O(this,"_itemsManager",new h5),O(this,"_coordinatesManager",new r5),O(this,"_setupManager",new i5),O(this,"_viewManager",new u5),O(this,"_raycastManager",new d5),O(this,"_visibilityManager",new p5),O(this,"_highlightManager",new g5),O(this,"_sectionManager",new b5),O(this,"_dataManager",new _5),O(this,"_sequenceManager",new y5),O(this,"_bbox",new Tt),O(this,"_alignmentsManager"),O(this,"_meshManager"),O(this,"_isProcessing",!1),O(this,"_isLoaded",!1),O(this,"_frozen",!1),O(this,"_isSetup",!1),this.object.name=t,this.object.up.set(0,0,1),this._meshManager=e,this.threads=s,this._alignmentsManager=new s5(this),this.tiles.onItemSet.add((({value:i})=>this.object.add(i))),this.tiles.onBeforeDelete.add((({value:i})=>{this.object.remove(i),i.geometry.dispose(),Wi.forEach(i.material,(r=>r.dispose()))}))}get modelId(){return this.object.name}get box(){return this._bbox.clone().applyMatrix4(this.object.matrixWorld)}get isBusy(){const t=this._meshManager.requests.arePending;return!this._isLoaded||this._isProcessing||t}get frozen(){return!!this._frozen}set frozen(t){t!==this._frozen&&(this._frozen=t,t||this._refreshView())}get getClippingPlanesEvent(){return this._viewManager.getClippingPlanesEvent}set getClippingPlanesEvent(t){this._viewManager.getClippingPlanesEvent=t}async dispose(){this._isLoaded=!1,await this._dataManager.dispose(this,this._meshManager,this._alignmentsManager)}async getSpatialStructure(){return this._dataManager.getSpatialStructure(this)}async getLocalIdsByGuids(t){return this._dataManager.getLocalIdsByGuids(this,t)}async getCategories(){return this._dataManager.getCategories(this)}async getItemsWithGeometryCategories(){return this._dataManager.getItemsWithGeometryCategories(this)}async getItemsWithGeometry(){return this._dataManager.getItemsWithGeometry(this)}async getItemsIdsWithGeometry(){return this._dataManager.getItemsIdsWithGeometry(this)}async getMetadata(){return this._dataManager.getMetadata(this)}async getGuidsByLocalIds(t){return this._dataManager.getGuidsByLocalIds(this,t)}async getBuffer(t=!1){return this._dataManager.getBuffer(this,t)}async getItemsOfCategories(t){return this._dataManager.getItemsOfCategories(this,t)}async getGuids(){return await this.threads.invoke(this.modelId,"getGuids",[])}async getLocalIds(){return await this.threads.invoke(this.modelId,"getLocalIds",[])}async getItemsByQuery(t){return this._dataManager.getItemsByQuery(this,t)}async getItemsMaterialDefinition(t){return await this.threads.invoke(this.modelId,"getItemsMaterialDefinition",[t])}async getItemsGeometry(t){return await this.threads.invoke(this.modelId,"getItemsGeometry",[t])}async getItemsVolume(t){return await this.threads.invoke(this.modelId,"getItemsVolume",[t])}async getAttributeNames(){return await this.threads.invoke(this.modelId,"getAttributeNames",[])}async getAttributeValues(){return await this.threads.invoke(this.modelId,"getAttributeValues",[])}async getAttributesUniqueValues(t){return await this.threads.invoke(this.modelId,"getAttributesUniqueValues",[t])}async getAttributeTypes(){return await this.threads.invoke(this.modelId,"getAttributeTypes",[])}async getRelationNames(){return await this.threads.invoke(this.modelId,"getRelationNames",[])}async getMaxLocalId(){return this._dataManager.getMaxLocalId(this)}getItem(t){return this._itemsManager.getItem(this,t)}async getItemsChildren(t){return this._itemsManager.getItemsChildren(this,t)}async getItemsData(t,e){return this._itemsManager.getItemsData(this,t,e)}async getPositions(t){return this._coordinatesManager.getPositions(this,t)}async getCoordinates(){return this._coordinatesManager.getCoordinates(this)}async getCoordinationMatrix(){return this._coordinatesManager.getCoordinationMatrix(this)}async getMergedBox(t){return this._boxManager.getMergedBox(this,t)}async getBoxes(t){return this._boxManager.getBoxes(this,t)}async getAlignments(){return this._alignmentsManager.getAlignments()}async getHorizontalAlignments(){return this._alignmentsManager.getHorizontalAlignments()}async getVerticalAlignments(){return this._alignmentsManager.getVerticalAlignments()}getAlignmentStyles(){return this._alignmentsManager.getAlignmentStyles()}useCamera(t){this._viewManager.useCamera(t)}async rectangleRaycast(t){return this._raycastManager.rectangleRaycast(this,this._meshManager,t)}async raycast(t){return this._raycastManager.raycast(this,t)}async raycastWithSnapping(t){return this._raycastManager.raycastWithSnapping(this,t)}async setVisible(t,e){const s=[t,e];await this.threads.invoke(this.modelId,"setVisible",s)}async toggleVisible(t){const e=[t];await this.threads.invoke(this.modelId,"toggleVisible",e)}async getItemsByVisibility(t){return this._visibilityManager.getItemsByVisibility(this,t)}async getVisible(t){return this._visibilityManager.getVisible(this,t)}async resetVisible(){return this._visibilityManager.resetVisible(this)}async highlight(t,e){return this._highlightManager.highlight(this,t,e)}async getHighlight(t){return this._highlightManager.getHighlight(this,t)}async resetHighlight(t){return this._highlightManager.resetHighlight(this,t)}async getHighlightItemIds(){return this._highlightManager.getHighlightItemIds(this)}async getSection(t,e){return this._sectionManager.getSection(this,t,e)}async getSequenced(t,e,s){return this._sequenceManager.getSequenced(this,t,e,s)}async handleRequest(t){await this._meshManager.requests.handleRequest(this._meshManager,t)}_finishProcessing(){this._isProcessing=!1}async _refreshView(){this.frozen||(this._isProcessing=!0,await this._viewManager.refreshView(this,this._meshManager))}async _setup(t,e,s){this._isSetup||(await this._setupManager.setup(this,this._bbox,t,e,s),this._isLoaded=!0,this._isProcessing=!0,this._isSetup=!0)}},v5=class{constructor(){O(this,"list",[]),O(this,"onFinish",(()=>{}))}get arePending(){return this.list.length>0}async handleRequest(t,e){if(e.class===Ci.RECOMPUTE_MESHES)this.add(e.list),e.list=void 0;else if(e.class===Ci.CREATE_MATERIAL){const{materialDefinitions:s,modelId:i}=e;Jy.resetColors(s),t.materials.addDefinitions(i,s),e.materialDefinitions=void 0}else e.class===Ci.THROW_ERROR&&console.error(e)}add(t){for(const e of t)this.insert(e)||this.list.push(e),e.tileRequestClass===Ne.FINISH&&this.onFinish()}clean(t){const e=this.list.filter((s=>s.modelId!==t||s.tileRequestClass!==Ne.FINISH));this.list=e}insert(t){const{modelId:e,tileId:s,tileRequestClass:i,tileData:r}=t;if(s===void 0)return!1;if(i===Ne.DELETE){const o=this.list.filter((a=>!((a.tileRequestClass===Ne.CREATE||a.tileRequestClass===Ne.DELETE)&&a.modelId===e&&a.tileId===s)));this.list=o}if(i===Ne.CREATE){const o=this.list.filter((a=>!(a.tileRequestClass===Ne.CREATE&&a.modelId===e&&a.tileId===s)));this.list=o}if(i===Ne.UPDATE){const o=this.list.find((a=>a.modelId===e&&a.tileId===s));if(o)return o.tileRequestClass!==Ne.CREATE&&o.tileRequestClass!==Ne.UPDATE||(o.tileData=r),!0}return!1}},w5=class{constructor(t){O(this,"_materials"),O(this,"white",4294967295),this._materials=t}createMesh(t,e){const s=this._materials.getFromRequest(e);if(!("isLodMaterial"in s)||!s.isLodMaterial)throw new Error("Fragments: material is not an instance of LodMaterial.");const{positions:i}=e;if(!i)throw new Error("Fragments: no positions provided to create the LOD mesh.");const r=new f5,o=this.deleteAttributeEvent(t);return On.setLodBuffer(r,i,o),new Sw(r,[s])}updateVisibility(t,e){const{geometry:s}=t,{visibilityData:i,highlightData:r}=e;On.setLodVisibility(s,i),r?(On.setLodFilter(s,r),pu.getComplementary(r,((o,a)=>{s.addGroup(o,a,0)}))):s.addGroup(0,1/0,0)}processMesh(t,e){const{geometry:s}=t,{tileData:{visibilityData:i},currentLod:r}=e;if(r===jt.WIRES&&t instanceof Sw)this.updateVisibility(t,e.tileData);else if(i&&i.position.length>0)for(let o=0;o<i.position.length;++o){const a=i.size[o]===this.white,l=i.position[o],c=a?1/0:i.size[o];s.addGroup(l,c,0)}}deleteAttributeEvent(t){return function(){delete this.array}}},E5=class{constructor(t){O(this,"list",new Yt),O(this,"materials",new Jy),O(this,"lod",new w5(this.materials)),O(this,"requests",new v5),O(this,"updateThreshold",4),O(this,"_updateFinished",!0),O(this,"_onUpdate"),this._onUpdate=t,this.requests.onFinish=()=>this._updateFinished=!0}forceUpdateFinish(t=200){return new Promise((e=>{this._updateFinished=!1;const s=setInterval((()=>{this.update(),this._updateFinished&&(clearInterval(s),e())}),t)}))}update(){const t=performance.now();for(;this.requests.arePending;){const e=this.requests.list.shift();if(e&&(this.processTileRequest(e),this._onUpdate(),performance.now()-t>this.updateThreshold))return}}setTileData(t,e){const{tileId:s,itemId:i,matrix:r,aabb:o}=e;this.setMeshData(t,s,i,r),this.setupBoundings(t,o),this.updateStatus(t,e)}processTileRequest(t){const{tileRequestClass:e,tileId:s,modelId:i}=t,r=this.list.get(i);if(r)if(e===Ne.CREATE){if(t.objectClass===void 0)return;const o=this.create(t);this.setTileData(o,t),r.tiles.set(o.userData.tileId,o)}else if(e===Ne.DELETE)r.tiles.delete(s);else if(e===Ne.UPDATE){const o=r.tiles.get(s);o&&this.updateStatus(o,t)}else e===Ne.FINISH&&r._finishProcessing()}createMesh(t){const{indices:e,positions:s,normals:i,itemIds:r,faceIds:o}=t,a=new Ce;this.setIndex(a,e),this.setPositions(s,a),this.setNormals(i,a),this.setItemIds(r,a),this.setFaceIds(o,a);const l=this.materials.getFromRequest(t);return new ht(a,[l])}setupBoundings(t,e){const{geometry:s}=t,i=new Tt().copy(e),r=new Us;i.getBoundingSphere(r),s.boundingBox=i,s.boundingSphere=r}create(t){if(t.objectClass===zs.SHELL)return this.createMesh(t);if(t.objectClass===zs.LINE){const e=new Ce;return this.lod.createMesh(e,t)}throw new Error(`Fragments: object class ${t.objectClass} is not supported.`)}updateStatus(t,e){const{tileData:{highlightData:s},currentLod:i}=e,{geometry:r}=t;if(r.clearGroups(),this.lod.processMesh(t,e),!s||i===jt.WIRES)return;const o=this.materials.createHighlights(t,e);t.material=o}cleanAttributeMemory(t,e){t.attributes[e].onUpload(this.deleteAttribute(t))}setPositions(t,e){if(!t)throw new Error("Fragments: no positions provided to create the mesh.");e.setAttribute("position",new ze(t,3)),this.cleanAttributeMemory(e,"position")}setFaceIds(t,e){t&&(e.setAttribute("color",new ze(t,3)),this.cleanAttributeMemory(e,"color"))}setIndex(t,e){if(!e)throw new Error("Fragments: no indices provided to create the mesh.");t.setIndex(new ze(e,1)),t.index.onUpload(this.deleteAttribute(t))}setNormals(t,e){t&&e.setAttribute("normal",new ze(t,3,!0)),this.cleanAttributeMemory(e,"normal")}setItemIds(t,e){t&&(e.setAttribute("id",new ze(t,1,!1)),this.cleanAttributeMemory(e,"id"))}deleteAttribute(t){return function(){delete this.array}}setMeshData(t,e,s,i){t.userData={tileId:e,itemId:s},t.matrixAutoUpdate=!1,t.applyMatrix4(i),t.matrix.copy(i)}},x5=class{constructor(){O(this,"_list",new Map),O(this,"_communicationKey",0)}setupInput(t){t.requestId=this._communicationKey++}set(t,e,s){const i=this.newHandler(e,s);this._list.set(t,i)}run(t){const e=this._list.get(t.requestId);this._list.delete(t.requestId),e(t)}newHandler(t,e){return s=>{s.errorInfo?t(s.errorInfo):e(s)}}},Da=class En{static newThread(t){return new Worker(t,{type:"module"})}static newUpdater(t,e){return setInterval(t,e)}static getMeshComputeRequest(t,e){return{class:Ci.RECOMPUTE_MESHES,modelId:t,list:e}}static planeSet(t){const e=[];for(const s of t){const i=this.array(s.normal),r=s.constant,o=new Wt(i,r);e.push(o)}return e}static data(t){var e,s;if(t?.elements!==void 0)return En.transform(t);if(t?.origin!==void 0&&t?.direction!==void 0)return En.beam(t);if(t?.planes!==void 0)return En.frustum(t);const i=t?.normal!==void 0,r=t?.constant!==void 0;if(i&&r)return En.plane(t);const o=((e=t[0])==null?void 0:e.normal)!==void 0,a=((s=t[0])==null?void 0:s.constant)!==void 0;if(o&&a)return En.planeSet(t);const l=t?.x!==void 0,c=t?.y!==void 0,h=t?.z!==void 0;return l&&c&&h?En.array(t):t}static getExecuteRequest(t,e,s){const i=Array.from(s);return{class:Ci.EXECUTE,modelId:t,function:e,parameters:i}}static plane(t){const e=this.array(t.normal),s=t.constant;return new Wt(e,s)}static getRequestContent(t){const e=[];for(const s of t.list)En.setupCreateRequest(s,e),En.setupUpdateRequest(s,e);return e}static array(t){const e=new F;return e.set(t.x,t.y,t.z),e}static cleanRequests(t){const e=[],s=En;for(const i of t)s.isFinishRequest(i)||e.push(i);return e}static frustum(t){const e=this.planeSet(t.planes),[s,i,r,o,a,l]=e;return new No(s,i,r,o,a,l)}static beam(t){const e=this.array(t.origin),s=this.array(t.direction);return new $o(e,s)}static transform(t){const e=new xt;return e.copy(t),e}static deleteUpdater(t){clearInterval(t)}static areCoresAvailable(t){const e=En.getCpuCapacity();return t<Math.max(e,2)}static isFinishRequest(t){return t.tileRequestClass===Ne.FINISH}static setupUpdateRequest(t,e){t.tileRequestClass===Ne.UPDATE&&this.addAllTileData(t,e)}static getCpuCapacity(){var t;return(t=globalThis.navigator)!=null&&t.hardwareConcurrency?navigator.hardwareConcurrency-3:0}static addAllTileData(t,e){this.addRequestTileData(t,e,"visibilityData"),this.addRequestTileData(t,e,"highlightData",["highlightIds"])}static addRequestContent(t,e,s){if(!e[t])return;const i=e[t].buffer;s.push(i)}static addRequestTileData(t,e,s,i=[]){const r=t.tileData[s];if(r){e.push(r.position.buffer),e.push(r.size.buffer);for(const o of i)e.push(t.tileData[o].buffer)}}static setupCreateRequest(t,e){if(t.tileRequestClass!==Ne.CREATE)return;const s=this.getCreateRequestIds();for(const i of s)this.addRequestContent(i,t,e);this.addAllTileData(t,e)}static getCreateRequestIds(){return["positions","indices","normals","itemIds"]}},I5=class{constructor(t){O(this,"_handlers",new x5),O(this,"_handleInput"),O(this,"_port"),O(this,"onInput",(e=>{e.data.toMainThread?this._handlers.run(e.data):this.manageInput(e.data)})),this._handleInput=t}fetchMeshCompute(t,e){const s=Da,i=s.getMeshComputeRequest(t,e),r=s.getRequestContent(i);this.fetch(i,r)}fetch(t,e){return this._handlers.setupInput(t),new Promise(((s,i)=>{this._handlers.set(t.requestId,i,s),this.executeConnection(t,e)}))}init(t){this._port=t,this.initConnection(t)}initConnection(t){t.onmessage=this.onInput}async fetchConnection(t){if(!this._port)throw new Error("Fragments: Connection not initialized");return this._port}async executeConnection(t,e){(await this.fetchConnection(t)).postMessage(t,e)}async manageOutput(t){const e=await this.fetchConnection(t);t.toMainThread=!0,e.postMessage(t)}async manageConnection(t){try{await this._handleInput(t)}catch(e){t.errorInfo=e.toString(),console.error(e)}}async manageInput(t){await this.manageConnection(t),await this.manageOutput(t)}},C5=class{constructor(t){O(this,"_modelThread",new Map),O(this,"_threadsModelAmount",new Map),O(this,"_threadPort",new Map),O(this,"_threadPath"),O(this,"_placeholder"),this._placeholder={},this._threadPath=t}get path(){return this._threadPath}usePlaceholder(t){this._modelThread.set(t,this._placeholder)}getAmount(t){return this._threadsModelAmount.get(t)}getThread(t){return this._modelThread.get(t)}getAndCheckThread(t){const e=this._modelThread.get(t);if(e===this._placeholder)throw new Error("Fragments: Error fetching thread!");return e}set(t,e){this._modelThread.set(t,e)}deleteModel(t){const e=this.getThreadSafe(t),s=this.getAmountSafe(e)-1;this.setAmount(e,s),this._modelThread.delete(t)}getThreadSafe(t){const e=this.getThread(t);if(!e)throw new Error(`Fragments: Thread for model ${t} not found`);return e}deleteThread(t){this._threadsModelAmount.delete(t),this._threadPort.delete(t),t.terminate()}getThreadAmount(){return this._threadsModelAmount.size}balanceThreadLoad(t){const{lessBusyThread:e,modelAmount:s}=this.getLessBusyThread();return this._threadsModelAmount.set(e,s+1),this._modelThread.set(t.modelId,e),this._threadPort.get(e)}getAmountSafe(t){const e=this.getAmount(t);if(!e)throw new Error(`Fragments: Amount for thread ${t} not found`);return e}setPort(t,e){this._threadPort.set(t,e)}setAmount(t,e){this._threadsModelAmount.set(t,e)}getPort(t){return this._threadPort.get(t)}getLessBusyThread(){let t=Number.MAX_VALUE,e=this._threadsModelAmount.keys().next().value;for(const[s,i]of this._threadsModelAmount)i<t&&(t=i,e=s);return{lessBusyThread:e,modelAmount:t}}},T5=class extends I5{constructor(t,e){super(t),O(this,"_data"),this._data=new C5(e)}delete(t){const e=this._data.getThreadSafe(t),s=this._data.getAmountSafe(e)-1;this._data.deleteModel(t),s===0&&this._data.deleteThread(e)}async invoke(t,e,s=[]){const i=Da.getExecuteRequest(t,e,s);return(await this.fetch(i)).result}async fetchConnection(t){const e=this._data.getAndCheckThread(t.modelId);return e?this._data.getPort(e):this.setupNewThread(t)}setupNewThread(t){const e=Da;this._data.usePlaceholder(t.modelId);const s=this._data.getThreadAmount();return e.areCoresAvailable(s)?this.newThread(t,this._data.path):this._data.balanceThreadLoad(t)}setupThread(t){const e=new MessageChannel,s=e.port1,i=e.port2;this.initConnection(s),this._data.setPort(t,s),t.postMessage(i,[i])}newThread(t,e){const s=Da.newThread(e);return this.setupThread(s),this._data.setAmount(s,1),this._data.set(t.modelId,s),this._data.getPort(s)}};/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */function Kc(n){let t=n.length;for(;--t>=0;)n[t]=0}const c0=256,kC=286,Lu=30,$u=15,h0=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Kf=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),A5=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Ow=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Tr=new Array(576);Kc(Tr);const mu=new Array(60);Kc(mu);const cd=new Array(512);Kc(cd);const Nu=new Array(256);Kc(Nu);const tv=new Array(29);Kc(tv);const Rm=new Array(Lu);function fb(n,t,e,s,i){this.static_tree=n,this.extra_bits=t,this.extra_base=e,this.elems=s,this.max_length=i,this.has_stree=n&&n.length}let Pw,Rw,Fw;function mb(n,t){this.dyn_tree=n,this.max_code=0,this.stat_desc=t}Kc(Rm);const zC=n=>n<256?cd[n]:cd[256+(n>>>7)],hd=(n,t)=>{n.pending_buf[n.pending++]=255&t,n.pending_buf[n.pending++]=t>>>8&255},ni=(n,t,e)=>{n.bi_valid>16-e?(n.bi_buf|=t<<n.bi_valid&65535,hd(n,n.bi_buf),n.bi_buf=t>>16-n.bi_valid,n.bi_valid+=e-16):(n.bi_buf|=t<<n.bi_valid&65535,n.bi_valid+=e)},cr=(n,t,e)=>{ni(n,e[2*t],e[2*t+1])},BC=(n,t)=>{let e=0;do e|=1&n,n>>>=1,e<<=1;while(--t>0);return e>>>1},UC=(n,t,e)=>{const s=new Array(16);let i,r,o=0;for(i=1;i<=$u;i++)o=o+e[i-1]<<1,s[i]=o;for(r=0;r<=t;r++){let a=n[2*r+1];a!==0&&(n[2*r]=BC(s[a]++,a))}},Lw=n=>{let t;for(t=0;t<kC;t++)n.dyn_ltree[2*t]=0;for(t=0;t<Lu;t++)n.dyn_dtree[2*t]=0;for(t=0;t<19;t++)n.bl_tree[2*t]=0;n.dyn_ltree[512]=1,n.opt_len=n.static_len=0,n.sym_next=n.matches=0},VC=n=>{n.bi_valid>8?hd(n,n.bi_buf):n.bi_valid>0&&(n.pending_buf[n.pending++]=n.bi_buf),n.bi_buf=0,n.bi_valid=0},$w=(n,t,e,s)=>{const i=2*t,r=2*e;return n[i]<n[r]||n[i]===n[r]&&s[t]<=s[e]},gb=(n,t,e)=>{const s=n.heap[e];let i=e<<1;for(;i<=n.heap_len&&(i<n.heap_len&&$w(t,n.heap[i+1],n.heap[i],n.depth)&&i++,!$w(t,s,n.heap[i],n.depth));)n.heap[e]=n.heap[i],e=i,i<<=1;n.heap[e]=s},Nw=(n,t,e)=>{let s,i,r,o,a=0;if(n.sym_next!==0)do s=255&n.pending_buf[n.sym_buf+a++],s+=(255&n.pending_buf[n.sym_buf+a++])<<8,i=n.pending_buf[n.sym_buf+a++],s===0?cr(n,i,t):(r=Nu[i],cr(n,r+c0+1,t),o=h0[r],o!==0&&(i-=tv[r],ni(n,i,o)),s--,r=zC(s),cr(n,r,e),o=Kf[r],o!==0&&(s-=Rm[r],ni(n,s,o)));while(a<n.sym_next);cr(n,256,t)},bb=(n,t)=>{const e=t.dyn_tree,s=t.stat_desc.static_tree,i=t.stat_desc.has_stree,r=t.stat_desc.elems;let o,a,l,c=-1;for(n.heap_len=0,n.heap_max=573,o=0;o<r;o++)e[2*o]!==0?(n.heap[++n.heap_len]=c=o,n.depth[o]=0):e[2*o+1]=0;for(;n.heap_len<2;)l=n.heap[++n.heap_len]=c<2?++c:0,e[2*l]=1,n.depth[l]=0,n.opt_len--,i&&(n.static_len-=s[2*l+1]);for(t.max_code=c,o=n.heap_len>>1;o>=1;o--)gb(n,e,o);l=r;do o=n.heap[1],n.heap[1]=n.heap[n.heap_len--],gb(n,e,1),a=n.heap[1],n.heap[--n.heap_max]=o,n.heap[--n.heap_max]=a,e[2*l]=e[2*o]+e[2*a],n.depth[l]=(n.depth[o]>=n.depth[a]?n.depth[o]:n.depth[a])+1,e[2*o+1]=e[2*a+1]=l,n.heap[1]=l++,gb(n,e,1);while(n.heap_len>=2);n.heap[--n.heap_max]=n.heap[1],((h,u)=>{const p=u.dyn_tree,d=u.max_code,g=u.stat_desc.static_tree,m=u.stat_desc.has_stree,b=u.stat_desc.extra_bits,f=u.stat_desc.extra_base,_=u.stat_desc.max_length;let y,v,w,I,C,A,S=0;for(I=0;I<=$u;I++)h.bl_count[I]=0;for(p[2*h.heap[h.heap_max]+1]=0,y=h.heap_max+1;y<573;y++)v=h.heap[y],I=p[2*p[2*v+1]+1]+1,I>_&&(I=_,S++),p[2*v+1]=I,v>d||(h.bl_count[I]++,C=0,v>=f&&(C=b[v-f]),A=p[2*v],h.opt_len+=A*(I+C),m&&(h.static_len+=A*(g[2*v+1]+C)));if(S!==0){do{for(I=_-1;h.bl_count[I]===0;)I--;h.bl_count[I]--,h.bl_count[I+1]+=2,h.bl_count[_]--,S-=2}while(S>0);for(I=_;I!==0;I--)for(v=h.bl_count[I];v!==0;)w=h.heap[--y],w>d||(p[2*w+1]!==I&&(h.opt_len+=(I-p[2*w+1])*p[2*w],p[2*w+1]=I),v--)}})(n,t),UC(e,c,n.bl_count)},Mw=(n,t,e)=>{let s,i,r=-1,o=t[1],a=0,l=7,c=4;for(o===0&&(l=138,c=3),t[2*(e+1)+1]=65535,s=0;s<=e;s++)i=o,o=t[2*(s+1)+1],++a<l&&i===o||(a<c?n.bl_tree[2*i]+=a:i!==0?(i!==r&&n.bl_tree[2*i]++,n.bl_tree[32]++):a<=10?n.bl_tree[34]++:n.bl_tree[36]++,a=0,r=i,o===0?(l=138,c=3):i===o?(l=6,c=3):(l=7,c=4))},Dw=(n,t,e)=>{let s,i,r=-1,o=t[1],a=0,l=7,c=4;for(o===0&&(l=138,c=3),s=0;s<=e;s++)if(i=o,o=t[2*(s+1)+1],!(++a<l&&i===o)){if(a<c)do cr(n,i,n.bl_tree);while(--a!=0);else i!==0?(i!==r&&(cr(n,i,n.bl_tree),a--),cr(n,16,n.bl_tree),ni(n,a-3,2)):a<=10?(cr(n,17,n.bl_tree),ni(n,a-3,3)):(cr(n,18,n.bl_tree),ni(n,a-11,7));a=0,r=i,o===0?(l=138,c=3):i===o?(l=6,c=3):(l=7,c=4)}};let kw=!1;const zw=(n,t,e,s)=>{ni(n,0+(s?1:0),3),VC(n),hd(n,e),hd(n,~e),e&&n.pending_buf.set(n.window.subarray(t,t+e),n.pending),n.pending+=e};var S5={_tr_init:n=>{kw||((()=>{let t,e,s,i,r;const o=new Array(16);for(s=0,i=0;i<28;i++)for(tv[i]=s,t=0;t<1<<h0[i];t++)Nu[s++]=i;for(Nu[s-1]=i,r=0,i=0;i<16;i++)for(Rm[i]=r,t=0;t<1<<Kf[i];t++)cd[r++]=i;for(r>>=7;i<Lu;i++)for(Rm[i]=r<<7,t=0;t<1<<Kf[i]-7;t++)cd[256+r++]=i;for(e=0;e<=$u;e++)o[e]=0;for(t=0;t<=143;)Tr[2*t+1]=8,t++,o[8]++;for(;t<=255;)Tr[2*t+1]=9,t++,o[9]++;for(;t<=279;)Tr[2*t+1]=7,t++,o[7]++;for(;t<=287;)Tr[2*t+1]=8,t++,o[8]++;for(UC(Tr,287,o),t=0;t<Lu;t++)mu[2*t+1]=5,mu[2*t]=BC(t,5);Pw=new fb(Tr,h0,257,kC,$u),Rw=new fb(mu,Kf,0,Lu,$u),Fw=new fb(new Array(0),A5,0,19,7)})(),kw=!0),n.l_desc=new mb(n.dyn_ltree,Pw),n.d_desc=new mb(n.dyn_dtree,Rw),n.bl_desc=new mb(n.bl_tree,Fw),n.bi_buf=0,n.bi_valid=0,Lw(n)},_tr_stored_block:zw,_tr_flush_block:(n,t,e,s)=>{let i,r,o=0;n.level>0?(n.strm.data_type===2&&(n.strm.data_type=(a=>{let l,c=4093624447;for(l=0;l<=31;l++,c>>>=1)if(1&c&&a.dyn_ltree[2*l]!==0)return 0;if(a.dyn_ltree[18]!==0||a.dyn_ltree[20]!==0||a.dyn_ltree[26]!==0)return 1;for(l=32;l<c0;l++)if(a.dyn_ltree[2*l]!==0)return 1;return 0})(n)),bb(n,n.l_desc),bb(n,n.d_desc),o=(a=>{let l;for(Mw(a,a.dyn_ltree,a.l_desc.max_code),Mw(a,a.dyn_dtree,a.d_desc.max_code),bb(a,a.bl_desc),l=18;l>=3&&a.bl_tree[2*Ow[l]+1]===0;l--);return a.opt_len+=3*(l+1)+5+5+4,l})(n),i=n.opt_len+3+7>>>3,r=n.static_len+3+7>>>3,r<=i&&(i=r)):i=r=e+5,e+4<=i&&t!==-1?zw(n,t,e,s):n.strategy===4||r===i?(ni(n,2+(s?1:0),3),Nw(n,Tr,mu)):(ni(n,4+(s?1:0),3),((a,l,c,h)=>{let u;for(ni(a,l-257,5),ni(a,c-1,5),ni(a,h-4,4),u=0;u<h;u++)ni(a,a.bl_tree[2*Ow[u]+1],3);Dw(a,a.dyn_ltree,l-1),Dw(a,a.dyn_dtree,c-1)})(n,n.l_desc.max_code+1,n.d_desc.max_code+1,o+1),Nw(n,n.dyn_ltree,n.dyn_dtree)),Lw(n),s&&VC(n)},_tr_tally:(n,t,e)=>(n.pending_buf[n.sym_buf+n.sym_next++]=t,n.pending_buf[n.sym_buf+n.sym_next++]=t>>8,n.pending_buf[n.sym_buf+n.sym_next++]=e,t===0?n.dyn_ltree[2*e]++:(n.matches++,t--,n.dyn_ltree[2*(Nu[e]+c0+1)]++,n.dyn_dtree[2*zC(t)]++),n.sym_next===n.sym_end),_tr_align:n=>{ni(n,2,3),cr(n,256,Tr),(t=>{t.bi_valid===16?(hd(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(n)}},Mu=(n,t,e,s)=>{let i=65535&n,r=n>>>16&65535,o=0;for(;e!==0;){o=e>2e3?2e3:e,e-=o;do i=i+t[s++]|0,r=r+i|0;while(--o);i%=65521,r%=65521}return i|r<<16};const O5=new Uint32Array((()=>{let n,t=[];for(var e=0;e<256;e++){n=e;for(var s=0;s<8;s++)n=1&n?3988292384^n>>>1:n>>>1;t[e]=n}return t})());var ds=(n,t,e,s)=>{const i=O5,r=s+e;n^=-1;for(let o=s;o<r;o++)n=n>>>8^i[255&(n^t[o])];return~n},Xa={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Bd={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:P5,_tr_stored_block:u0,_tr_flush_block:R5,_tr_tally:Po,_tr_align:F5}=S5,{Z_NO_FLUSH:Ro,Z_PARTIAL_FLUSH:L5,Z_FULL_FLUSH:$5,Z_FINISH:Yi,Z_BLOCK:Bw,Z_OK:Ts,Z_STREAM_END:Uw,Z_STREAM_ERROR:er,Z_DATA_ERROR:N5,Z_BUF_ERROR:_b,Z_DEFAULT_COMPRESSION:M5,Z_FILTERED:D5,Z_HUFFMAN_ONLY:vp,Z_RLE:k5,Z_FIXED:z5,Z_DEFAULT_STRATEGY:B5,Z_UNKNOWN:U5,Z_DEFLATED:Fm}=Bd,Aa=258,dr=262,_c=42,xa=113,gu=666,Ia=(n,t)=>(n.msg=Xa[t],t),Vw=n=>2*n-(n>4?9:0),bo=n=>{let t=n.length;for(;--t>=0;)n[t]=0},V5=n=>{let t,e,s,i=n.w_size;t=n.hash_size,s=t;do e=n.head[--s],n.head[s]=e>=i?e-i:0;while(--t);t=i,s=t;do e=n.prev[--s],n.prev[s]=e>=i?e-i:0;while(--t)};let Fo=(n,t,e)=>(t<<n.hash_shift^e)&n.hash_mask;const ui=n=>{const t=n.state;let e=t.pending;e>n.avail_out&&(e=n.avail_out),e!==0&&(n.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+e),n.next_out),n.next_out+=e,t.pending_out+=e,n.total_out+=e,n.avail_out-=e,t.pending-=e,t.pending===0&&(t.pending_out=0))},fi=(n,t)=>{R5(n,n.block_start>=0?n.block_start:-1,n.strstart-n.block_start,t),n.block_start=n.strstart,ui(n.strm)},Kt=(n,t)=>{n.pending_buf[n.pending++]=t},vh=(n,t)=>{n.pending_buf[n.pending++]=t>>>8&255,n.pending_buf[n.pending++]=255&t},d0=(n,t,e,s)=>{let i=n.avail_in;return i>s&&(i=s),i===0?0:(n.avail_in-=i,t.set(n.input.subarray(n.next_in,n.next_in+i),e),n.state.wrap===1?n.adler=Mu(n.adler,t,i,e):n.state.wrap===2&&(n.adler=ds(n.adler,t,i,e)),n.next_in+=i,n.total_in+=i,i)},HC=(n,t)=>{let e,s,i=n.max_chain_length,r=n.strstart,o=n.prev_length,a=n.nice_match;const l=n.strstart>n.w_size-dr?n.strstart-(n.w_size-dr):0,c=n.window,h=n.w_mask,u=n.prev,p=n.strstart+Aa;let d=c[r+o-1],g=c[r+o];n.prev_length>=n.good_match&&(i>>=2),a>n.lookahead&&(a=n.lookahead);do if(e=t,c[e+o]===g&&c[e+o-1]===d&&c[e]===c[r]&&c[++e]===c[r+1]){r+=2,e++;do;while(c[++r]===c[++e]&&c[++r]===c[++e]&&c[++r]===c[++e]&&c[++r]===c[++e]&&c[++r]===c[++e]&&c[++r]===c[++e]&&c[++r]===c[++e]&&c[++r]===c[++e]&&r<p);if(s=Aa-(p-r),r=p-Aa,s>o){if(n.match_start=t,o=s,s>=a)break;d=c[r+o-1],g=c[r+o]}}while((t=u[t&h])>l&&--i!=0);return o<=n.lookahead?o:n.lookahead},dc=n=>{const t=n.w_size;let e,s,i;do{if(s=n.window_size-n.lookahead-n.strstart,n.strstart>=t+(t-dr)&&(n.window.set(n.window.subarray(t,t+t-s),0),n.match_start-=t,n.strstart-=t,n.block_start-=t,n.insert>n.strstart&&(n.insert=n.strstart),V5(n),s+=t),n.strm.avail_in===0)break;if(e=d0(n.strm,n.window,n.strstart+n.lookahead,s),n.lookahead+=e,n.lookahead+n.insert>=3)for(i=n.strstart-n.insert,n.ins_h=n.window[i],n.ins_h=Fo(n,n.ins_h,n.window[i+1]);n.insert&&(n.ins_h=Fo(n,n.ins_h,n.window[i+3-1]),n.prev[i&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=i,i++,n.insert--,!(n.lookahead+n.insert<3)););}while(n.lookahead<dr&&n.strm.avail_in!==0)},jC=(n,t)=>{let e,s,i,r=n.pending_buf_size-5>n.w_size?n.w_size:n.pending_buf_size-5,o=0,a=n.strm.avail_in;do{if(e=65535,i=n.bi_valid+42>>3,n.strm.avail_out<i||(i=n.strm.avail_out-i,s=n.strstart-n.block_start,e>s+n.strm.avail_in&&(e=s+n.strm.avail_in),e>i&&(e=i),e<r&&(e===0&&t!==Yi||t===Ro||e!==s+n.strm.avail_in)))break;o=t===Yi&&e===s+n.strm.avail_in?1:0,u0(n,0,0,o),n.pending_buf[n.pending-4]=e,n.pending_buf[n.pending-3]=e>>8,n.pending_buf[n.pending-2]=~e,n.pending_buf[n.pending-1]=~e>>8,ui(n.strm),s&&(s>e&&(s=e),n.strm.output.set(n.window.subarray(n.block_start,n.block_start+s),n.strm.next_out),n.strm.next_out+=s,n.strm.avail_out-=s,n.strm.total_out+=s,n.block_start+=s,e-=s),e&&(d0(n.strm,n.strm.output,n.strm.next_out,e),n.strm.next_out+=e,n.strm.avail_out-=e,n.strm.total_out+=e)}while(o===0);return a-=n.strm.avail_in,a&&(a>=n.w_size?(n.matches=2,n.window.set(n.strm.input.subarray(n.strm.next_in-n.w_size,n.strm.next_in),0),n.strstart=n.w_size,n.insert=n.strstart):(n.window_size-n.strstart<=a&&(n.strstart-=n.w_size,n.window.set(n.window.subarray(n.w_size,n.w_size+n.strstart),0),n.matches<2&&n.matches++,n.insert>n.strstart&&(n.insert=n.strstart)),n.window.set(n.strm.input.subarray(n.strm.next_in-a,n.strm.next_in),n.strstart),n.strstart+=a,n.insert+=a>n.w_size-n.insert?n.w_size-n.insert:a),n.block_start=n.strstart),n.high_water<n.strstart&&(n.high_water=n.strstart),o?4:t!==Ro&&t!==Yi&&n.strm.avail_in===0&&n.strstart===n.block_start?2:(i=n.window_size-n.strstart,n.strm.avail_in>i&&n.block_start>=n.w_size&&(n.block_start-=n.w_size,n.strstart-=n.w_size,n.window.set(n.window.subarray(n.w_size,n.w_size+n.strstart),0),n.matches<2&&n.matches++,i+=n.w_size,n.insert>n.strstart&&(n.insert=n.strstart)),i>n.strm.avail_in&&(i=n.strm.avail_in),i&&(d0(n.strm,n.window,n.strstart,i),n.strstart+=i,n.insert+=i>n.w_size-n.insert?n.w_size-n.insert:i),n.high_water<n.strstart&&(n.high_water=n.strstart),i=n.bi_valid+42>>3,i=n.pending_buf_size-i>65535?65535:n.pending_buf_size-i,r=i>n.w_size?n.w_size:i,s=n.strstart-n.block_start,(s>=r||(s||t===Yi)&&t!==Ro&&n.strm.avail_in===0&&s<=i)&&(e=s>i?i:s,o=t===Yi&&n.strm.avail_in===0&&e===s?1:0,u0(n,n.block_start,e,o),n.block_start+=e,ui(n.strm)),o?3:1)},yb=(n,t)=>{let e,s;for(;;){if(n.lookahead<dr){if(dc(n),n.lookahead<dr&&t===Ro)return 1;if(n.lookahead===0)break}if(e=0,n.lookahead>=3&&(n.ins_h=Fo(n,n.ins_h,n.window[n.strstart+3-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),e!==0&&n.strstart-e<=n.w_size-dr&&(n.match_length=HC(n,e)),n.match_length>=3)if(s=Po(n,n.strstart-n.match_start,n.match_length-3),n.lookahead-=n.match_length,n.match_length<=n.max_lazy_match&&n.lookahead>=3){n.match_length--;do n.strstart++,n.ins_h=Fo(n,n.ins_h,n.window[n.strstart+3-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart;while(--n.match_length!=0);n.strstart++}else n.strstart+=n.match_length,n.match_length=0,n.ins_h=n.window[n.strstart],n.ins_h=Fo(n,n.ins_h,n.window[n.strstart+1]);else s=Po(n,0,n.window[n.strstart]),n.lookahead--,n.strstart++;if(s&&(fi(n,!1),n.strm.avail_out===0))return 1}return n.insert=n.strstart<2?n.strstart:2,t===Yi?(fi(n,!0),n.strm.avail_out===0?3:4):n.sym_next&&(fi(n,!1),n.strm.avail_out===0)?1:2},ll=(n,t)=>{let e,s,i;for(;;){if(n.lookahead<dr){if(dc(n),n.lookahead<dr&&t===Ro)return 1;if(n.lookahead===0)break}if(e=0,n.lookahead>=3&&(n.ins_h=Fo(n,n.ins_h,n.window[n.strstart+3-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),n.prev_length=n.match_length,n.prev_match=n.match_start,n.match_length=2,e!==0&&n.prev_length<n.max_lazy_match&&n.strstart-e<=n.w_size-dr&&(n.match_length=HC(n,e),n.match_length<=5&&(n.strategy===D5||n.match_length===3&&n.strstart-n.match_start>4096)&&(n.match_length=2)),n.prev_length>=3&&n.match_length<=n.prev_length){i=n.strstart+n.lookahead-3,s=Po(n,n.strstart-1-n.prev_match,n.prev_length-3),n.lookahead-=n.prev_length-1,n.prev_length-=2;do++n.strstart<=i&&(n.ins_h=Fo(n,n.ins_h,n.window[n.strstart+3-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart);while(--n.prev_length!=0);if(n.match_available=0,n.match_length=2,n.strstart++,s&&(fi(n,!1),n.strm.avail_out===0))return 1}else if(n.match_available){if(s=Po(n,0,n.window[n.strstart-1]),s&&fi(n,!1),n.strstart++,n.lookahead--,n.strm.avail_out===0)return 1}else n.match_available=1,n.strstart++,n.lookahead--}return n.match_available&&(s=Po(n,0,n.window[n.strstart-1]),n.match_available=0),n.insert=n.strstart<2?n.strstart:2,t===Yi?(fi(n,!0),n.strm.avail_out===0?3:4):n.sym_next&&(fi(n,!1),n.strm.avail_out===0)?1:2};function Vn(n,t,e,s,i){this.good_length=n,this.max_lazy=t,this.nice_length=e,this.max_chain=s,this.func=i}const bu=[new Vn(0,0,0,0,jC),new Vn(4,4,8,4,yb),new Vn(4,5,16,8,yb),new Vn(4,6,32,32,yb),new Vn(4,4,16,16,ll),new Vn(8,16,32,32,ll),new Vn(8,16,128,128,ll),new Vn(8,32,128,256,ll),new Vn(32,128,258,1024,ll),new Vn(32,258,258,4096,ll)];function H5(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Fm,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),bo(this.dyn_ltree),bo(this.dyn_dtree),bo(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),bo(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),bo(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const _u=n=>{if(!n)return 1;const t=n.state;return!t||t.strm!==n||t.status!==_c&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==xa&&t.status!==gu?1:0},WC=n=>{if(_u(n))return Ia(n,er);n.total_in=n.total_out=0,n.data_type=U5;const t=n.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?_c:xa,n.adler=t.wrap===2?0:1,t.last_flush=-2,P5(t),Ts},YC=n=>{const t=WC(n);var e;return t===Ts&&((e=n.state).window_size=2*e.w_size,bo(e.head),e.max_lazy_match=bu[e.level].max_lazy,e.good_match=bu[e.level].good_length,e.nice_match=bu[e.level].nice_length,e.max_chain_length=bu[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0),t},Hw=(n,t,e,s,i,r)=>{if(!n)return er;let o=1;if(t===M5&&(t=6),s<0?(o=0,s=-s):s>15&&(o=2,s-=16),i<1||i>9||e!==Fm||s<8||s>15||t<0||t>9||r<0||r>z5||s===8&&o!==1)return Ia(n,er);s===8&&(s=9);const a=new H5;return n.state=a,a.strm=n,a.status=_c,a.wrap=o,a.gzhead=null,a.w_bits=s,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=t,a.strategy=r,a.method=e,YC(n)};var Du={deflateInit:(n,t)=>Hw(n,t,Fm,15,8,B5),deflateInit2:Hw,deflateReset:YC,deflateResetKeep:WC,deflateSetHeader:(n,t)=>_u(n)||n.state.wrap!==2?er:(n.state.gzhead=t,Ts),deflate:(n,t)=>{if(_u(n)||t>Bw||t<0)return n?Ia(n,er):er;const e=n.state;if(!n.output||n.avail_in!==0&&!n.input||e.status===gu&&t!==Yi)return Ia(n,n.avail_out===0?_b:er);const s=e.last_flush;if(e.last_flush=t,e.pending!==0){if(ui(n),n.avail_out===0)return e.last_flush=-1,Ts}else if(n.avail_in===0&&Vw(t)<=Vw(s)&&t!==Yi)return Ia(n,_b);if(e.status===gu&&n.avail_in!==0)return Ia(n,_b);if(e.status===_c&&e.wrap===0&&(e.status=xa),e.status===_c){let i=Fm+(e.w_bits-8<<4)<<8,r=-1;if(r=e.strategy>=vp||e.level<2?0:e.level<6?1:e.level===6?2:3,i|=r<<6,e.strstart!==0&&(i|=32),i+=31-i%31,vh(e,i),e.strstart!==0&&(vh(e,n.adler>>>16),vh(e,65535&n.adler)),n.adler=1,e.status=xa,ui(n),e.pending!==0)return e.last_flush=-1,Ts}if(e.status===57){if(n.adler=0,Kt(e,31),Kt(e,139),Kt(e,8),e.gzhead)Kt(e,(e.gzhead.text?1:0)+(e.gzhead.hcrc?2:0)+(e.gzhead.extra?4:0)+(e.gzhead.name?8:0)+(e.gzhead.comment?16:0)),Kt(e,255&e.gzhead.time),Kt(e,e.gzhead.time>>8&255),Kt(e,e.gzhead.time>>16&255),Kt(e,e.gzhead.time>>24&255),Kt(e,e.level===9?2:e.strategy>=vp||e.level<2?4:0),Kt(e,255&e.gzhead.os),e.gzhead.extra&&e.gzhead.extra.length&&(Kt(e,255&e.gzhead.extra.length),Kt(e,e.gzhead.extra.length>>8&255)),e.gzhead.hcrc&&(n.adler=ds(n.adler,e.pending_buf,e.pending,0)),e.gzindex=0,e.status=69;else if(Kt(e,0),Kt(e,0),Kt(e,0),Kt(e,0),Kt(e,0),Kt(e,e.level===9?2:e.strategy>=vp||e.level<2?4:0),Kt(e,3),e.status=xa,ui(n),e.pending!==0)return e.last_flush=-1,Ts}if(e.status===69){if(e.gzhead.extra){let i=e.pending,r=(65535&e.gzhead.extra.length)-e.gzindex;for(;e.pending+r>e.pending_buf_size;){let a=e.pending_buf_size-e.pending;if(e.pending_buf.set(e.gzhead.extra.subarray(e.gzindex,e.gzindex+a),e.pending),e.pending=e.pending_buf_size,e.gzhead.hcrc&&e.pending>i&&(n.adler=ds(n.adler,e.pending_buf,e.pending-i,i)),e.gzindex+=a,ui(n),e.pending!==0)return e.last_flush=-1,Ts;i=0,r-=a}let o=new Uint8Array(e.gzhead.extra);e.pending_buf.set(o.subarray(e.gzindex,e.gzindex+r),e.pending),e.pending+=r,e.gzhead.hcrc&&e.pending>i&&(n.adler=ds(n.adler,e.pending_buf,e.pending-i,i)),e.gzindex=0}e.status=73}if(e.status===73){if(e.gzhead.name){let i,r=e.pending;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>r&&(n.adler=ds(n.adler,e.pending_buf,e.pending-r,r)),ui(n),e.pending!==0)return e.last_flush=-1,Ts;r=0}i=e.gzindex<e.gzhead.name.length?255&e.gzhead.name.charCodeAt(e.gzindex++):0,Kt(e,i)}while(i!==0);e.gzhead.hcrc&&e.pending>r&&(n.adler=ds(n.adler,e.pending_buf,e.pending-r,r)),e.gzindex=0}e.status=91}if(e.status===91){if(e.gzhead.comment){let i,r=e.pending;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>r&&(n.adler=ds(n.adler,e.pending_buf,e.pending-r,r)),ui(n),e.pending!==0)return e.last_flush=-1,Ts;r=0}i=e.gzindex<e.gzhead.comment.length?255&e.gzhead.comment.charCodeAt(e.gzindex++):0,Kt(e,i)}while(i!==0);e.gzhead.hcrc&&e.pending>r&&(n.adler=ds(n.adler,e.pending_buf,e.pending-r,r))}e.status=103}if(e.status===103){if(e.gzhead.hcrc){if(e.pending+2>e.pending_buf_size&&(ui(n),e.pending!==0))return e.last_flush=-1,Ts;Kt(e,255&n.adler),Kt(e,n.adler>>8&255),n.adler=0}if(e.status=xa,ui(n),e.pending!==0)return e.last_flush=-1,Ts}if(n.avail_in!==0||e.lookahead!==0||t!==Ro&&e.status!==gu){let i=e.level===0?jC(e,t):e.strategy===vp?((r,o)=>{let a;for(;;){if(r.lookahead===0&&(dc(r),r.lookahead===0)){if(o===Ro)return 1;break}if(r.match_length=0,a=Po(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++,a&&(fi(r,!1),r.strm.avail_out===0))return 1}return r.insert=0,o===Yi?(fi(r,!0),r.strm.avail_out===0?3:4):r.sym_next&&(fi(r,!1),r.strm.avail_out===0)?1:2})(e,t):e.strategy===k5?((r,o)=>{let a,l,c,h;const u=r.window;for(;;){if(r.lookahead<=Aa){if(dc(r),r.lookahead<=Aa&&o===Ro)return 1;if(r.lookahead===0)break}if(r.match_length=0,r.lookahead>=3&&r.strstart>0&&(c=r.strstart-1,l=u[c],l===u[++c]&&l===u[++c]&&l===u[++c])){h=r.strstart+Aa;do;while(l===u[++c]&&l===u[++c]&&l===u[++c]&&l===u[++c]&&l===u[++c]&&l===u[++c]&&l===u[++c]&&l===u[++c]&&c<h);r.match_length=Aa-(h-c),r.match_length>r.lookahead&&(r.match_length=r.lookahead)}if(r.match_length>=3?(a=Po(r,1,r.match_length-3),r.lookahead-=r.match_length,r.strstart+=r.match_length,r.match_length=0):(a=Po(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++),a&&(fi(r,!1),r.strm.avail_out===0))return 1}return r.insert=0,o===Yi?(fi(r,!0),r.strm.avail_out===0?3:4):r.sym_next&&(fi(r,!1),r.strm.avail_out===0)?1:2})(e,t):bu[e.level].func(e,t);if(i!==3&&i!==4||(e.status=gu),i===1||i===3)return n.avail_out===0&&(e.last_flush=-1),Ts;if(i===2&&(t===L5?F5(e):t!==Bw&&(u0(e,0,0,!1),t===$5&&(bo(e.head),e.lookahead===0&&(e.strstart=0,e.block_start=0,e.insert=0))),ui(n),n.avail_out===0))return e.last_flush=-1,Ts}return t!==Yi?Ts:e.wrap<=0?Uw:(e.wrap===2?(Kt(e,255&n.adler),Kt(e,n.adler>>8&255),Kt(e,n.adler>>16&255),Kt(e,n.adler>>24&255),Kt(e,255&n.total_in),Kt(e,n.total_in>>8&255),Kt(e,n.total_in>>16&255),Kt(e,n.total_in>>24&255)):(vh(e,n.adler>>>16),vh(e,65535&n.adler)),ui(n),e.wrap>0&&(e.wrap=-e.wrap),e.pending!==0?Ts:Uw)},deflateEnd:n=>{if(_u(n))return er;const t=n.state.status;return n.state=null,t===xa?Ia(n,N5):Ts},deflateSetDictionary:(n,t)=>{let e=t.length;if(_u(n))return er;const s=n.state,i=s.wrap;if(i===2||i===1&&s.status!==_c||s.lookahead)return er;if(i===1&&(n.adler=Mu(n.adler,t,e,0)),s.wrap=0,e>=s.w_size){i===0&&(bo(s.head),s.strstart=0,s.block_start=0,s.insert=0);let l=new Uint8Array(s.w_size);l.set(t.subarray(e-s.w_size,e),0),t=l,e=s.w_size}const r=n.avail_in,o=n.next_in,a=n.input;for(n.avail_in=e,n.next_in=0,n.input=t,dc(s);s.lookahead>=3;){let l=s.strstart,c=s.lookahead-2;do s.ins_h=Fo(s,s.ins_h,s.window[l+3-1]),s.prev[l&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=l,l++;while(--c);s.strstart=l,s.lookahead=2,dc(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=2,s.match_available=0,n.next_in=o,n.input=a,n.avail_in=r,s.wrap=i,Ts},deflateInfo:"pako deflate (from Nodeca project)"};const j5=(n,t)=>Object.prototype.hasOwnProperty.call(n,t);var GC=function(n){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const e=t.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(const s in e)j5(e,s)&&(n[s]=e[s])}}return n},qC=n=>{let t=0;for(let s=0,i=n.length;s<i;s++)t+=n[s].length;const e=new Uint8Array(t);for(let s=0,i=0,r=n.length;s<r;s++){let o=n[s];e.set(o,i),i+=o.length}return e};let ZC=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{ZC=!1}const ud=new Uint8Array(256);for(let n=0;n<256;n++)ud[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;ud[254]=ud[254]=1;var ev=n=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(n);let t,e,s,i,r,o=n.length,a=0;for(i=0;i<o;i++)e=n.charCodeAt(i),(64512&e)==55296&&i+1<o&&(s=n.charCodeAt(i+1),(64512&s)==56320&&(e=65536+(e-55296<<10)+(s-56320),i++)),a+=e<128?1:e<2048?2:e<65536?3:4;for(t=new Uint8Array(a),r=0,i=0;r<a;i++)e=n.charCodeAt(i),(64512&e)==55296&&i+1<o&&(s=n.charCodeAt(i+1),(64512&s)==56320&&(e=65536+(e-55296<<10)+(s-56320),i++)),e<128?t[r++]=e:e<2048?(t[r++]=192|e>>>6,t[r++]=128|63&e):e<65536?(t[r++]=224|e>>>12,t[r++]=128|e>>>6&63,t[r++]=128|63&e):(t[r++]=240|e>>>18,t[r++]=128|e>>>12&63,t[r++]=128|e>>>6&63,t[r++]=128|63&e);return t},W5=(n,t)=>{const e=t||n.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(n.subarray(0,t));let s,i;const r=new Array(2*e);for(i=0,s=0;s<e;){let o=n[s++];if(o<128){r[i++]=o;continue}let a=ud[o];if(a>4)r[i++]=65533,s+=a-1;else{for(o&=a===2?31:a===3?15:7;a>1&&s<e;)o=o<<6|63&n[s++],a--;a>1?r[i++]=65533:o<65536?r[i++]=o:(o-=65536,r[i++]=55296|o>>10&1023,r[i++]=56320|1023&o)}}return((o,a)=>{if(a<65534&&o.subarray&&ZC)return String.fromCharCode.apply(null,o.length===a?o:o.subarray(0,a));let l="";for(let c=0;c<a;c++)l+=String.fromCharCode(o[c]);return l})(r,i)},Y5=(n,t)=>{(t=t||n.length)>n.length&&(t=n.length);let e=t-1;for(;e>=0&&(192&n[e])==128;)e--;return e<0||e===0?t:e+ud[n[e]]>t?e:t},XC=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const QC=Object.prototype.toString,{Z_NO_FLUSH:G5,Z_SYNC_FLUSH:q5,Z_FULL_FLUSH:Z5,Z_FINISH:X5,Z_OK:Lm,Z_STREAM_END:Q5,Z_DEFAULT_COMPRESSION:K5,Z_DEFAULT_STRATEGY:J5,Z_DEFLATED:t$}=Bd;function ku(n){this.options=GC({level:K5,method:t$,chunkSize:16384,windowBits:15,memLevel:8,strategy:J5},n||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new XC,this.strm.avail_out=0;let e=Du.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(e!==Lm)throw new Error(Xa[e]);if(t.header&&Du.deflateSetHeader(this.strm,t.header),t.dictionary){let s;if(s=typeof t.dictionary=="string"?ev(t.dictionary):QC.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,e=Du.deflateSetDictionary(this.strm,s),e!==Lm)throw new Error(Xa[e]);this._dict_set=!0}}function vb(n,t){const e=new ku(t);if(e.push(n,!0),e.err)throw e.msg||Xa[e.err];return e.result}ku.prototype.push=function(n,t){const e=this.strm,s=this.options.chunkSize;let i,r;if(this.ended)return!1;for(r=t===~~t?t:t===!0?X5:G5,typeof n=="string"?e.input=ev(n):QC.call(n)==="[object ArrayBuffer]"?e.input=new Uint8Array(n):e.input=n,e.next_in=0,e.avail_in=e.input.length;;)if(e.avail_out===0&&(e.output=new Uint8Array(s),e.next_out=0,e.avail_out=s),(r===q5||r===Z5)&&e.avail_out<=6)this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;else{if(i=Du.deflate(e,r),i===Q5)return e.next_out>0&&this.onData(e.output.subarray(0,e.next_out)),i=Du.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===Lm;if(e.avail_out!==0){if(r>0&&e.next_out>0)this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;else if(e.avail_in===0)break}else this.onData(e.output)}return!0},ku.prototype.onData=function(n){this.chunks.push(n)},ku.prototype.onEnd=function(n){n===Lm&&(this.result=qC(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};var e$={Deflate:ku,deflate:vb,deflateRaw:function(n,t){return(t=t||{}).raw=!0,vb(n,t)},gzip:function(n,t){return(t=t||{}).gzip=!0,vb(n,t)}};const wp=16209;var s$=function(n,t){let e,s,i,r,o,a,l,c,h,u,p,d,g,m,b,f,_,y,v,w,I,C,A,S;const P=n.state;e=n.next_in,A=n.input,s=e+(n.avail_in-5),i=n.next_out,S=n.output,r=i-(t-n.avail_out),o=i+(n.avail_out-257),a=P.dmax,l=P.wsize,c=P.whave,h=P.wnext,u=P.window,p=P.hold,d=P.bits,g=P.lencode,m=P.distcode,b=(1<<P.lenbits)-1,f=(1<<P.distbits)-1;t:do{d<15&&(p+=A[e++]<<d,d+=8,p+=A[e++]<<d,d+=8),_=g[p&b];e:for(;;){if(y=_>>>24,p>>>=y,d-=y,y=_>>>16&255,y===0)S[i++]=65535&_;else{if(!(16&y)){if(64&y){if(32&y){P.mode=16191;break t}n.msg="invalid literal/length code",P.mode=wp;break t}_=g[(65535&_)+(p&(1<<y)-1)];continue e}for(v=65535&_,y&=15,y&&(d<y&&(p+=A[e++]<<d,d+=8),v+=p&(1<<y)-1,p>>>=y,d-=y),d<15&&(p+=A[e++]<<d,d+=8,p+=A[e++]<<d,d+=8),_=m[p&f];;){if(y=_>>>24,p>>>=y,d-=y,y=_>>>16&255,16&y){if(w=65535&_,y&=15,d<y&&(p+=A[e++]<<d,d+=8,d<y&&(p+=A[e++]<<d,d+=8)),w+=p&(1<<y)-1,w>a){n.msg="invalid distance too far back",P.mode=wp;break t}if(p>>>=y,d-=y,y=i-r,w>y){if(y=w-y,y>c&&P.sane){n.msg="invalid distance too far back",P.mode=wp;break t}if(I=0,C=u,h===0){if(I+=l-y,y<v){v-=y;do S[i++]=u[I++];while(--y);I=i-w,C=S}}else if(h<y){if(I+=l+h-y,y-=h,y<v){v-=y;do S[i++]=u[I++];while(--y);if(I=0,h<v){y=h,v-=y;do S[i++]=u[I++];while(--y);I=i-w,C=S}}}else if(I+=h-y,y<v){v-=y;do S[i++]=u[I++];while(--y);I=i-w,C=S}for(;v>2;)S[i++]=C[I++],S[i++]=C[I++],S[i++]=C[I++],v-=3;v&&(S[i++]=C[I++],v>1&&(S[i++]=C[I++]))}else{I=i-w;do S[i++]=S[I++],S[i++]=S[I++],S[i++]=S[I++],v-=3;while(v>2);v&&(S[i++]=S[I++],v>1&&(S[i++]=S[I++]))}break}if(64&y){n.msg="invalid distance code",P.mode=wp;break t}_=m[(65535&_)+(p&(1<<y)-1)]}}break}}while(e<s&&i<o);v=d>>3,e-=v,d-=v<<3,p&=(1<<d)-1,n.next_in=e,n.next_out=i,n.avail_in=e<s?s-e+5:5-(e-s),n.avail_out=i<o?o-i+257:257-(i-o),P.hold=p,P.bits=d};const Ep=15,i$=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),n$=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),r$=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),o$=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var zu=(n,t,e,s,i,r,o,a)=>{const l=a.bits;let c,h,u,p,d,g,m=0,b=0,f=0,_=0,y=0,v=0,w=0,I=0,C=0,A=0,S=null;const P=new Uint16Array(16),M=new Uint16Array(16);let T,L,E,N=null;for(m=0;m<=Ep;m++)P[m]=0;for(b=0;b<s;b++)P[t[e+b]]++;for(y=l,_=Ep;_>=1&&P[_]===0;_--);if(y>_&&(y=_),_===0)return i[r++]=20971520,i[r++]=20971520,a.bits=1,0;for(f=1;f<_&&P[f]===0;f++);for(y<f&&(y=f),I=1,m=1;m<=Ep;m++)if(I<<=1,I-=P[m],I<0)return-1;if(I>0&&(n===0||_!==1))return-1;for(M[1]=0,m=1;m<Ep;m++)M[m+1]=M[m]+P[m];for(b=0;b<s;b++)t[e+b]!==0&&(o[M[t[e+b]]++]=b);if(n===0?(S=N=o,g=20):n===1?(S=i$,N=n$,g=257):(S=r$,N=o$,g=0),A=0,b=0,m=f,d=r,v=y,w=0,u=-1,C=1<<y,p=C-1,n===1&&C>852||n===2&&C>592)return 1;for(;;){T=m-w,o[b]+1<g?(L=0,E=o[b]):o[b]>=g?(L=N[o[b]-g],E=S[o[b]-g]):(L=96,E=0),c=1<<m-w,h=1<<v,f=h;do h-=c,i[d+(A>>w)+h]=T<<24|L<<16|E;while(h!==0);for(c=1<<m-1;A&c;)c>>=1;if(c!==0?(A&=c-1,A+=c):A=0,b++,--P[m]==0){if(m===_)break;m=t[e+o[b]]}if(m>y&&(A&p)!==u){for(w===0&&(w=y),d+=f,v=m-w,I=1<<v;v+w<_&&(I-=P[v+w],!(I<=0));)v++,I<<=1;if(C+=1<<v,n===1&&C>852||n===2&&C>592)return 1;u=A&p,i[u]=y<<24|v<<16|d-r}}return A!==0&&(i[d+A]=m-w<<24|64<<16),a.bits=y,0};const{Z_FINISH:jw,Z_BLOCK:a$,Z_TREES:xp,Z_OK:Ca,Z_STREAM_END:l$,Z_NEED_DICT:c$,Z_STREAM_ERROR:Vi,Z_DATA_ERROR:Ww,Z_MEM_ERROR:Yw,Z_BUF_ERROR:h$,Z_DEFLATED:Gw}=Bd,gg=16180,Ip=16190,xr=16191,wb=16192,Eb=16194,Cp=16199,Tp=16200,xb=16206,Te=16209,qw=n=>(n>>>24&255)+(n>>>8&65280)+((65280&n)<<8)+((255&n)<<24);function u$(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Sa=n=>{if(!n)return 1;const t=n.state;return!t||t.strm!==n||t.mode<gg||t.mode>16211?1:0},KC=n=>{if(Sa(n))return Vi;const t=n.state;return n.total_in=n.total_out=t.total=0,n.msg="",t.wrap&&(n.adler=1&t.wrap),t.mode=gg,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Ca},JC=n=>{if(Sa(n))return Vi;const t=n.state;return t.wsize=0,t.whave=0,t.wnext=0,KC(n)},tT=(n,t)=>{let e;if(Sa(n))return Vi;const s=n.state;return t<0?(e=0,t=-t):(e=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Vi:(s.window!==null&&s.wbits!==t&&(s.window=null),s.wrap=e,s.wbits=t,JC(n))},Zw=(n,t)=>{if(!n)return Vi;const e=new u$;n.state=e,e.strm=n,e.window=null,e.mode=gg;const s=tT(n,t);return s!==Ca&&(n.state=null),s};let Ib,Cb,Xw=!0;const d$=n=>{if(Xw){Ib=new Int32Array(512),Cb=new Int32Array(32);let t=0;for(;t<144;)n.lens[t++]=8;for(;t<256;)n.lens[t++]=9;for(;t<280;)n.lens[t++]=7;for(;t<288;)n.lens[t++]=8;for(zu(1,n.lens,0,288,Ib,0,n.work,{bits:9}),t=0;t<32;)n.lens[t++]=5;zu(2,n.lens,0,32,Cb,0,n.work,{bits:5}),Xw=!1}n.lencode=Ib,n.lenbits=9,n.distcode=Cb,n.distbits=5},Qw=(n,t,e,s)=>{let i;const r=n.state;return r.window===null&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),s>=r.wsize?(r.window.set(t.subarray(e-r.wsize,e),0),r.wnext=0,r.whave=r.wsize):(i=r.wsize-r.wnext,i>s&&(i=s),r.window.set(t.subarray(e-s,e-s+i),r.wnext),(s-=i)?(r.window.set(t.subarray(e-s,e),0),r.wnext=s,r.whave=r.wsize):(r.wnext+=i,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=i))),0};var Rr={inflateReset:JC,inflateReset2:tT,inflateResetKeep:KC,inflateInit:n=>Zw(n,15),inflateInit2:Zw,inflate:(n,t)=>{let e,s,i,r,o,a,l,c,h,u,p,d,g,m,b,f,_,y,v,w,I,C,A=0;const S=new Uint8Array(4);let P,M;const T=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Sa(n)||!n.output||!n.input&&n.avail_in!==0)return Vi;e=n.state,e.mode===xr&&(e.mode=wb),o=n.next_out,i=n.output,l=n.avail_out,r=n.next_in,s=n.input,a=n.avail_in,c=e.hold,h=e.bits,u=a,p=l,C=Ca;t:for(;;)switch(e.mode){case gg:if(e.wrap===0){e.mode=wb;break}for(;h<16;){if(a===0)break t;a--,c+=s[r++]<<h,h+=8}if(2&e.wrap&&c===35615){e.wbits===0&&(e.wbits=15),e.check=0,S[0]=255&c,S[1]=c>>>8&255,e.check=ds(e.check,S,2,0),c=0,h=0,e.mode=16181;break}if(e.head&&(e.head.done=!1),!(1&e.wrap)||(((255&c)<<8)+(c>>8))%31){n.msg="incorrect header check",e.mode=Te;break}if((15&c)!==Gw){n.msg="unknown compression method",e.mode=Te;break}if(c>>>=4,h-=4,I=8+(15&c),e.wbits===0&&(e.wbits=I),I>15||I>e.wbits){n.msg="invalid window size",e.mode=Te;break}e.dmax=1<<e.wbits,e.flags=0,n.adler=e.check=1,e.mode=512&c?16189:xr,c=0,h=0;break;case 16181:for(;h<16;){if(a===0)break t;a--,c+=s[r++]<<h,h+=8}if(e.flags=c,(255&e.flags)!==Gw){n.msg="unknown compression method",e.mode=Te;break}if(57344&e.flags){n.msg="unknown header flags set",e.mode=Te;break}e.head&&(e.head.text=c>>8&1),512&e.flags&&4&e.wrap&&(S[0]=255&c,S[1]=c>>>8&255,e.check=ds(e.check,S,2,0)),c=0,h=0,e.mode=16182;case 16182:for(;h<32;){if(a===0)break t;a--,c+=s[r++]<<h,h+=8}e.head&&(e.head.time=c),512&e.flags&&4&e.wrap&&(S[0]=255&c,S[1]=c>>>8&255,S[2]=c>>>16&255,S[3]=c>>>24&255,e.check=ds(e.check,S,4,0)),c=0,h=0,e.mode=16183;case 16183:for(;h<16;){if(a===0)break t;a--,c+=s[r++]<<h,h+=8}e.head&&(e.head.xflags=255&c,e.head.os=c>>8),512&e.flags&&4&e.wrap&&(S[0]=255&c,S[1]=c>>>8&255,e.check=ds(e.check,S,2,0)),c=0,h=0,e.mode=16184;case 16184:if(1024&e.flags){for(;h<16;){if(a===0)break t;a--,c+=s[r++]<<h,h+=8}e.length=c,e.head&&(e.head.extra_len=c),512&e.flags&&4&e.wrap&&(S[0]=255&c,S[1]=c>>>8&255,e.check=ds(e.check,S,2,0)),c=0,h=0}else e.head&&(e.head.extra=null);e.mode=16185;case 16185:if(1024&e.flags&&(d=e.length,d>a&&(d=a),d&&(e.head&&(I=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(s.subarray(r,r+d),I)),512&e.flags&&4&e.wrap&&(e.check=ds(e.check,s,d,r)),a-=d,r+=d,e.length-=d),e.length))break t;e.length=0,e.mode=16186;case 16186:if(2048&e.flags){if(a===0)break t;d=0;do I=s[r+d++],e.head&&I&&e.length<65536&&(e.head.name+=String.fromCharCode(I));while(I&&d<a);if(512&e.flags&&4&e.wrap&&(e.check=ds(e.check,s,d,r)),a-=d,r+=d,I)break t}else e.head&&(e.head.name=null);e.length=0,e.mode=16187;case 16187:if(4096&e.flags){if(a===0)break t;d=0;do I=s[r+d++],e.head&&I&&e.length<65536&&(e.head.comment+=String.fromCharCode(I));while(I&&d<a);if(512&e.flags&&4&e.wrap&&(e.check=ds(e.check,s,d,r)),a-=d,r+=d,I)break t}else e.head&&(e.head.comment=null);e.mode=16188;case 16188:if(512&e.flags){for(;h<16;){if(a===0)break t;a--,c+=s[r++]<<h,h+=8}if(4&e.wrap&&c!==(65535&e.check)){n.msg="header crc mismatch",e.mode=Te;break}c=0,h=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),n.adler=e.check=0,e.mode=xr;break;case 16189:for(;h<32;){if(a===0)break t;a--,c+=s[r++]<<h,h+=8}n.adler=e.check=qw(c),c=0,h=0,e.mode=Ip;case Ip:if(e.havedict===0)return n.next_out=o,n.avail_out=l,n.next_in=r,n.avail_in=a,e.hold=c,e.bits=h,c$;n.adler=e.check=1,e.mode=xr;case xr:if(t===a$||t===xp)break t;case wb:if(e.last){c>>>=7&h,h-=7&h,e.mode=xb;break}for(;h<3;){if(a===0)break t;a--,c+=s[r++]<<h,h+=8}switch(e.last=1&c,c>>>=1,h-=1,3&c){case 0:e.mode=16193;break;case 1:if(d$(e),e.mode=Cp,t===xp){c>>>=2,h-=2;break t}break;case 2:e.mode=16196;break;case 3:n.msg="invalid block type",e.mode=Te}c>>>=2,h-=2;break;case 16193:for(c>>>=7&h,h-=7&h;h<32;){if(a===0)break t;a--,c+=s[r++]<<h,h+=8}if((65535&c)!=(c>>>16^65535)){n.msg="invalid stored block lengths",e.mode=Te;break}if(e.length=65535&c,c=0,h=0,e.mode=Eb,t===xp)break t;case Eb:e.mode=16195;case 16195:if(d=e.length,d){if(d>a&&(d=a),d>l&&(d=l),d===0)break t;i.set(s.subarray(r,r+d),o),a-=d,r+=d,l-=d,o+=d,e.length-=d;break}e.mode=xr;break;case 16196:for(;h<14;){if(a===0)break t;a--,c+=s[r++]<<h,h+=8}if(e.nlen=257+(31&c),c>>>=5,h-=5,e.ndist=1+(31&c),c>>>=5,h-=5,e.ncode=4+(15&c),c>>>=4,h-=4,e.nlen>286||e.ndist>30){n.msg="too many length or distance symbols",e.mode=Te;break}e.have=0,e.mode=16197;case 16197:for(;e.have<e.ncode;){for(;h<3;){if(a===0)break t;a--,c+=s[r++]<<h,h+=8}e.lens[T[e.have++]]=7&c,c>>>=3,h-=3}for(;e.have<19;)e.lens[T[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,P={bits:e.lenbits},C=zu(0,e.lens,0,19,e.lencode,0,e.work,P),e.lenbits=P.bits,C){n.msg="invalid code lengths set",e.mode=Te;break}e.have=0,e.mode=16198;case 16198:for(;e.have<e.nlen+e.ndist;){for(;A=e.lencode[c&(1<<e.lenbits)-1],b=A>>>24,f=A>>>16&255,_=65535&A,!(b<=h);){if(a===0)break t;a--,c+=s[r++]<<h,h+=8}if(_<16)c>>>=b,h-=b,e.lens[e.have++]=_;else{if(_===16){for(M=b+2;h<M;){if(a===0)break t;a--,c+=s[r++]<<h,h+=8}if(c>>>=b,h-=b,e.have===0){n.msg="invalid bit length repeat",e.mode=Te;break}I=e.lens[e.have-1],d=3+(3&c),c>>>=2,h-=2}else if(_===17){for(M=b+3;h<M;){if(a===0)break t;a--,c+=s[r++]<<h,h+=8}c>>>=b,h-=b,I=0,d=3+(7&c),c>>>=3,h-=3}else{for(M=b+7;h<M;){if(a===0)break t;a--,c+=s[r++]<<h,h+=8}c>>>=b,h-=b,I=0,d=11+(127&c),c>>>=7,h-=7}if(e.have+d>e.nlen+e.ndist){n.msg="invalid bit length repeat",e.mode=Te;break}for(;d--;)e.lens[e.have++]=I}}if(e.mode===Te)break;if(e.lens[256]===0){n.msg="invalid code -- missing end-of-block",e.mode=Te;break}if(e.lenbits=9,P={bits:e.lenbits},C=zu(1,e.lens,0,e.nlen,e.lencode,0,e.work,P),e.lenbits=P.bits,C){n.msg="invalid literal/lengths set",e.mode=Te;break}if(e.distbits=6,e.distcode=e.distdyn,P={bits:e.distbits},C=zu(2,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,P),e.distbits=P.bits,C){n.msg="invalid distances set",e.mode=Te;break}if(e.mode=Cp,t===xp)break t;case Cp:e.mode=Tp;case Tp:if(a>=6&&l>=258){n.next_out=o,n.avail_out=l,n.next_in=r,n.avail_in=a,e.hold=c,e.bits=h,s$(n,p),o=n.next_out,i=n.output,l=n.avail_out,r=n.next_in,s=n.input,a=n.avail_in,c=e.hold,h=e.bits,e.mode===xr&&(e.back=-1);break}for(e.back=0;A=e.lencode[c&(1<<e.lenbits)-1],b=A>>>24,f=A>>>16&255,_=65535&A,!(b<=h);){if(a===0)break t;a--,c+=s[r++]<<h,h+=8}if(f&&!(240&f)){for(y=b,v=f,w=_;A=e.lencode[w+((c&(1<<y+v)-1)>>y)],b=A>>>24,f=A>>>16&255,_=65535&A,!(y+b<=h);){if(a===0)break t;a--,c+=s[r++]<<h,h+=8}c>>>=y,h-=y,e.back+=y}if(c>>>=b,h-=b,e.back+=b,e.length=_,f===0){e.mode=16205;break}if(32&f){e.back=-1,e.mode=xr;break}if(64&f){n.msg="invalid literal/length code",e.mode=Te;break}e.extra=15&f,e.mode=16201;case 16201:if(e.extra){for(M=e.extra;h<M;){if(a===0)break t;a--,c+=s[r++]<<h,h+=8}e.length+=c&(1<<e.extra)-1,c>>>=e.extra,h-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=16202;case 16202:for(;A=e.distcode[c&(1<<e.distbits)-1],b=A>>>24,f=A>>>16&255,_=65535&A,!(b<=h);){if(a===0)break t;a--,c+=s[r++]<<h,h+=8}if(!(240&f)){for(y=b,v=f,w=_;A=e.distcode[w+((c&(1<<y+v)-1)>>y)],b=A>>>24,f=A>>>16&255,_=65535&A,!(y+b<=h);){if(a===0)break t;a--,c+=s[r++]<<h,h+=8}c>>>=y,h-=y,e.back+=y}if(c>>>=b,h-=b,e.back+=b,64&f){n.msg="invalid distance code",e.mode=Te;break}e.offset=_,e.extra=15&f,e.mode=16203;case 16203:if(e.extra){for(M=e.extra;h<M;){if(a===0)break t;a--,c+=s[r++]<<h,h+=8}e.offset+=c&(1<<e.extra)-1,c>>>=e.extra,h-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){n.msg="invalid distance too far back",e.mode=Te;break}e.mode=16204;case 16204:if(l===0)break t;if(d=p-l,e.offset>d){if(d=e.offset-d,d>e.whave&&e.sane){n.msg="invalid distance too far back",e.mode=Te;break}d>e.wnext?(d-=e.wnext,g=e.wsize-d):g=e.wnext-d,d>e.length&&(d=e.length),m=e.window}else m=i,g=o-e.offset,d=e.length;d>l&&(d=l),l-=d,e.length-=d;do i[o++]=m[g++];while(--d);e.length===0&&(e.mode=Tp);break;case 16205:if(l===0)break t;i[o++]=e.length,l--,e.mode=Tp;break;case xb:if(e.wrap){for(;h<32;){if(a===0)break t;a--,c|=s[r++]<<h,h+=8}if(p-=l,n.total_out+=p,e.total+=p,4&e.wrap&&p&&(n.adler=e.check=e.flags?ds(e.check,i,p,o-p):Mu(e.check,i,p,o-p)),p=l,4&e.wrap&&(e.flags?c:qw(c))!==e.check){n.msg="incorrect data check",e.mode=Te;break}c=0,h=0}e.mode=16207;case 16207:if(e.wrap&&e.flags){for(;h<32;){if(a===0)break t;a--,c+=s[r++]<<h,h+=8}if(4&e.wrap&&c!==(4294967295&e.total)){n.msg="incorrect length check",e.mode=Te;break}c=0,h=0}e.mode=16208;case 16208:C=l$;break t;case Te:C=Ww;break t;case 16210:return Yw;default:return Vi}return n.next_out=o,n.avail_out=l,n.next_in=r,n.avail_in=a,e.hold=c,e.bits=h,(e.wsize||p!==n.avail_out&&e.mode<Te&&(e.mode<xb||t!==jw))&&Qw(n,n.output,n.next_out,p-n.avail_out),u-=n.avail_in,p-=n.avail_out,n.total_in+=u,n.total_out+=p,e.total+=p,4&e.wrap&&p&&(n.adler=e.check=e.flags?ds(e.check,i,p,n.next_out-p):Mu(e.check,i,p,n.next_out-p)),n.data_type=e.bits+(e.last?64:0)+(e.mode===xr?128:0)+(e.mode===Cp||e.mode===Eb?256:0),(u===0&&p===0||t===jw)&&C===Ca&&(C=h$),C},inflateEnd:n=>{if(Sa(n))return Vi;let t=n.state;return t.window&&(t.window=null),n.state=null,Ca},inflateGetHeader:(n,t)=>{if(Sa(n))return Vi;const e=n.state;return 2&e.wrap?(e.head=t,t.done=!1,Ca):Vi},inflateSetDictionary:(n,t)=>{const e=t.length;let s,i,r;return Sa(n)?Vi:(s=n.state,s.wrap!==0&&s.mode!==Ip?Vi:s.mode===Ip&&(i=1,i=Mu(i,t,e,0),i!==s.check)?Ww:(r=Qw(n,t,e,e),r?(s.mode=16210,Yw):(s.havedict=1,Ca)))},inflateInfo:"pako inflate (from Nodeca project)"},p$=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const eT=Object.prototype.toString,{Z_NO_FLUSH:f$,Z_FINISH:m$,Z_OK:Bu,Z_STREAM_END:Tb,Z_NEED_DICT:Ab,Z_STREAM_ERROR:g$,Z_DATA_ERROR:Kw,Z_MEM_ERROR:b$}=Bd;function Uu(n){this.options=GC({chunkSize:65536,windowBits:15,to:""},n||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||n&&n.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new XC,this.strm.avail_out=0;let e=Rr.inflateInit2(this.strm,t.windowBits);if(e!==Bu)throw new Error(Xa[e]);if(this.header=new p$,Rr.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=ev(t.dictionary):eT.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(e=Rr.inflateSetDictionary(this.strm,t.dictionary),e!==Bu)))throw new Error(Xa[e])}function Sb(n,t){const e=new Uu(t);if(e.push(n),e.err)throw e.msg||Xa[e.err];return e.result}Uu.prototype.push=function(n,t){const e=this.strm,s=this.options.chunkSize,i=this.options.dictionary;let r,o,a;if(this.ended)return!1;for(o=t===~~t?t:t===!0?m$:f$,eT.call(n)==="[object ArrayBuffer]"?e.input=new Uint8Array(n):e.input=n,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(s),e.next_out=0,e.avail_out=s),r=Rr.inflate(e,o),r===Ab&&i&&(r=Rr.inflateSetDictionary(e,i),r===Bu?r=Rr.inflate(e,o):r===Kw&&(r=Ab));e.avail_in>0&&r===Tb&&e.state.wrap>0&&n[e.next_in]!==0;)Rr.inflateReset(e),r=Rr.inflate(e,o);switch(r){case g$:case Kw:case Ab:case b$:return this.onEnd(r),this.ended=!0,!1}if(a=e.avail_out,e.next_out&&(e.avail_out===0||r===Tb))if(this.options.to==="string"){let l=Y5(e.output,e.next_out),c=e.next_out-l,h=W5(e.output,l);e.next_out=c,e.avail_out=s-c,c&&e.output.set(e.output.subarray(l,l+c),0),this.onData(h)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(r!==Bu||a!==0){if(r===Tb)return r=Rr.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(e.avail_in===0)break}}return!0},Uu.prototype.onData=function(n){this.chunks.push(n)},Uu.prototype.onEnd=function(n){n===Bu&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=qC(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};var _$={Inflate:Uu,inflate:Sb,inflateRaw:function(n,t){return(t=t||{}).raw=!0,Sb(n,t)},ungzip:Sb};const{Deflate:y$,deflate:v$,deflateRaw:w$,gzip:E$}=e$,{Inflate:x$,inflate:I$,inflateRaw:C$,ungzip:T$}=_$;var sv={Deflate:y$,deflate:v$,deflateRaw:w$,gzip:E$,Inflate:x$,inflate:I$,inflateRaw:C$,ungzip:T$,constants:Bd};const Ob=1.25,bg=65535,A$=Math.pow(2,-24),Pb=Symbol("SKIP_GENERATION");function Tc(n){return(function(t){return t.index?t.index.count:t.attributes.position.count})(n)/3}function S$(n,t){if(!n.index){const e=n.attributes.position.count,s=(function(i,r=ArrayBuffer){return i>65535?new Uint32Array(new r(4*i)):new Uint16Array(new r(2*i))})(e,t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer);n.setIndex(new ze(s,1));for(let i=0;i<e;i++)s[i]=i}}function sT(n){const t=Tc(n),e=n.drawRange,s=e.start/3,i=(e.start+e.count)/3,r=Math.max(0,s),o=Math.min(t,i)-r;return[{offset:Math.floor(r),count:Math.floor(o)}]}function iT(n){if(!n.groups||!n.groups.length)return sT(n);const t=[],e=new Set,s=n.drawRange,i=s.start/3,r=(s.start+s.count)/3;for(const a of n.groups){const l=a.start/3,c=(a.start+a.count)/3;e.add(Math.max(i,l)),e.add(Math.min(r,c))}const o=Array.from(e.values()).sort(((a,l)=>a-l));for(let a=0;a<o.length-1;a++){const l=o[a],c=o[a+1];t.push({offset:Math.floor(l),count:Math.floor(c-l)})}return t}function Me(n,t,e){return e.min.x=t[n],e.min.y=t[n+1],e.min.z=t[n+2],e.max.x=t[n+3],e.max.y=t[n+4],e.max.z=t[n+5],e}function Jw(n){let t=-1,e=-1/0;for(let s=0;s<3;s++){const i=n[s+3]-n[s];i>e&&(e=i,t=s)}return t}function t1(n,t){t.set(n)}function e1(n,t,e){let s,i;for(let r=0;r<3;r++){const o=r+3;s=n[r],i=t[r],e[r]=s<i?s:i,s=n[o],i=t[o],e[o]=s>i?s:i}}function Ap(n,t,e){for(let s=0;s<3;s++){const i=t[n+2*s],r=t[n+2*s+1],o=i-r,a=i+r;o<e[s]&&(e[s]=o),a>e[s+3]&&(e[s+3]=a)}}function wh(n){const t=n[3]-n[0],e=n[4]-n[1],s=n[5]-n[2];return 2*(t*e+e*s+s*t)}function Rb(n,t,e,s,i=null){let r=1/0,o=1/0,a=1/0,l=-1/0,c=-1/0,h=-1/0,u=1/0,p=1/0,d=1/0,g=-1/0,m=-1/0,b=-1/0;const f=i!==null;for(let _=6*t,y=6*(t+e);_<y;_+=6){const v=n[_+0],w=n[_+1],I=v-w,C=v+w;I<r&&(r=I),C>l&&(l=C),f&&v<u&&(u=v),f&&v>g&&(g=v);const A=n[_+2],S=n[_+3],P=A-S,M=A+S;P<o&&(o=P),M>c&&(c=M),f&&A<p&&(p=A),f&&A>m&&(m=A);const T=n[_+4],L=n[_+5],E=T-L,N=T+L;E<a&&(a=E),N>h&&(h=N),f&&T<d&&(d=T),f&&T>b&&(b=T)}s[0]=r,s[1]=o,s[2]=a,s[3]=l,s[4]=c,s[5]=h,f&&(i[0]=u,i[1]=p,i[2]=d,i[3]=g,i[4]=m,i[5]=b)}const Jf=32,O$=(n,t)=>n.candidate-t.candidate,Kr=new Array(Jf).fill().map((()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0}))),Sp=new Float32Array(6);let Op=class{constructor(){}};function P$(n,t,e,s,i,r){let o=s,a=s+i-1;const l=r.pos,c=2*r.axis;for(;;){for(;o<=a&&e[6*o+c]<l;)o++;for(;o<=a&&e[6*a+c]>=l;)a--;if(!(o<a))return o;for(let h=0;h<3;h++){let u=t[3*o+h];t[3*o+h]=t[3*a+h],t[3*a+h]=u}for(let h=0;h<6;h++){let u=e[6*o+h];e[6*o+h]=e[6*a+h],e[6*a+h]=u}o++,a--}}function R$(n,t,e,s,i,r){let o=s,a=s+i-1;const l=r.pos,c=2*r.axis;for(;;){for(;o<=a&&e[6*o+c]<l;)o++;for(;o<=a&&e[6*a+c]>=l;)a--;if(!(o<a))return o;{let h=n[o];n[o]=n[a],n[a]=h;for(let u=0;u<6;u++){let p=e[6*o+u];e[6*o+u]=e[6*a+u],e[6*a+u]=p}o++,a--}}}function F$(n,t){const e=n.geometry,s=e.index?e.index.array:null,i=t.maxDepth,r=t.verbose,o=t.maxLeafTris,a=t.strategy,l=t.onProgress,c=Tc(e),h=n._indirectBuffer;let u=!1;const p=new Float32Array(6),d=new Float32Array(6),g=(function(v,w){var I;(I=w)[0]=I[1]=I[2]=1/0,I[3]=I[4]=I[5]=-1/0;const C=v.attributes.position,A=v.index?v.index.array:null,S=Tc(v),P=new Float32Array(6*S),M=C.normalized,T=C.array,L=C.offset||0;let E=3;C.isInterleavedBufferAttribute&&(E=C.data.stride);const N=["getX","getY","getZ"];for(let W=0;W<S;W++){const V=3*W,et=6*W;let j=V+0,nt=V+1,H=V+2;A&&(j=A[j],nt=A[nt],H=A[H]),M||(j=j*E+L,nt=nt*E+L,H=H*E+L);for(let B=0;B<3;B++){let rt,Q,st;M?(rt=C[N[B]](j),Q=C[N[B]](nt),st=C[N[B]](H)):(rt=T[j+B],Q=T[nt+B],st=T[H+B]);let ct=rt;Q<ct&&(ct=Q),st<ct&&(ct=st);let _t=rt;Q>_t&&(_t=Q),st>_t&&(_t=st);const ut=(_t-ct)/2,pt=2*B;P[et+pt+0]=ct+ut,P[et+pt+1]=ut+(Math.abs(ct)+ut)*A$,ct<w[B]&&(w[B]=ct),_t>w[B+3]&&(w[B+3]=_t)}}return P})(e,p),m=t.indirect?R$:P$,b=[],f=t.indirect?sT(e):iT(e);if(f.length===1){const v=f[0],w=new Op;w.boundingData=p,(function(I,C,A,S){let P=1/0,M=1/0,T=1/0,L=-1/0,E=-1/0,N=-1/0;for(let W=6*C,V=6*(C+A);W<V;W+=6){const et=I[W+0];et<P&&(P=et),et>L&&(L=et);const j=I[W+2];j<M&&(M=j),j>E&&(E=j);const nt=I[W+4];nt<T&&(T=nt),nt>N&&(N=nt)}S[0]=P,S[1]=M,S[2]=T,S[3]=L,S[4]=E,S[5]=N})(g,v.offset,v.count,d),y(w,v.offset,v.count,d),b.push(w)}else for(let v of f){const w=new Op;w.boundingData=new Float32Array(6),Rb(g,v.offset,v.count,w.boundingData,d),y(w,v.offset,v.count,d),b.push(w)}return b;function _(v){l&&l(v/c)}function y(v,w,I,C=null,A=0){if(!u&&A>=i&&(u=!0,r&&(console.warn(`MeshBVH: Max depth of ${i} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),I<=o||A>=i)return _(w+I),v.offset=w,v.count=I,v;const S=(function(M,T,L,E,N,W){let V=-1,et=0;if(W===0)V=Jw(T),V!==-1&&(et=(T[V]+T[V+3])/2);else if(W===1)V=Jw(M),V!==-1&&(et=(function(j,nt,H,B){let rt=0;for(let Q=nt,st=nt+H;Q<st;Q++)rt+=j[6*Q+2*B];return rt/H})(L,E,N,V));else if(W===2){const j=wh(M);let nt=Ob*N;const H=6*E,B=6*(E+N);for(let rt=0;rt<3;rt++){const Q=T[rt],st=(T[rt+3]-Q)/Jf;if(N<8){const ct=[...Kr];ct.length=N;let _t=0;for(let pt=H;pt<B;pt+=6,_t++){const bt=ct[_t];bt.candidate=L[pt+2*rt],bt.count=0;const{bounds:wt,leftCacheBounds:St,rightCacheBounds:Rt}=bt;for(let x=0;x<3;x++)Rt[x]=1/0,Rt[x+3]=-1/0,St[x]=1/0,St[x+3]=-1/0,wt[x]=1/0,wt[x+3]=-1/0;Ap(pt,L,wt)}ct.sort(O$);let ut=N;for(let pt=0;pt<ut;pt++){const bt=ct[pt];for(;pt+1<ut&&ct[pt+1].candidate===bt.candidate;)ct.splice(pt+1,1),ut--}for(let pt=H;pt<B;pt+=6){const bt=L[pt+2*rt];for(let wt=0;wt<ut;wt++){const St=ct[wt];bt>=St.candidate?Ap(pt,L,St.rightCacheBounds):(Ap(pt,L,St.leftCacheBounds),St.count++)}}for(let pt=0;pt<ut;pt++){const bt=ct[pt],wt=bt.count,St=N-bt.count,Rt=bt.leftCacheBounds,x=bt.rightCacheBounds;let Z=0;wt!==0&&(Z=wh(Rt)/j);let Y=0;St!==0&&(Y=wh(x)/j);const $=1+Ob*(Z*wt+Y*St);$<nt&&(V=rt,nt=$,et=bt.candidate)}}else{for(let ut=0;ut<Jf;ut++){const pt=Kr[ut];pt.count=0,pt.candidate=Q+st+ut*st;const bt=pt.bounds;for(let wt=0;wt<3;wt++)bt[wt]=1/0,bt[wt+3]=-1/0}for(let ut=H;ut<B;ut+=6){let pt=~~((L[ut+2*rt]-Q)/st);pt>=Jf&&(pt=31);const bt=Kr[pt];bt.count++,Ap(ut,L,bt.bounds)}const ct=Kr[31];t1(ct.bounds,ct.rightCacheBounds);for(let ut=30;ut>=0;ut--){const pt=Kr[ut],bt=Kr[ut+1];e1(pt.bounds,bt.rightCacheBounds,pt.rightCacheBounds)}let _t=0;for(let ut=0;ut<31;ut++){const pt=Kr[ut],bt=pt.count,wt=pt.bounds,St=Kr[ut+1].rightCacheBounds;bt!==0&&(_t===0?t1(wt,Sp):e1(wt,Sp,Sp)),_t+=bt;let Rt=0,x=0;_t!==0&&(Rt=wh(Sp)/j);const Z=N-_t;Z!==0&&(x=wh(St)/j);const Y=1+Ob*(Rt*_t+x*Z);Y<nt&&(V=rt,nt=Y,et=pt.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${W} used.`);return{axis:V,pos:et}})(v.boundingData,C,g,w,I,a);if(S.axis===-1)return _(w+I),v.offset=w,v.count=I,v;const P=m(h,s,g,w,I,S);if(P===w||P===w+I)_(w+I),v.offset=w,v.count=I;else{v.splitAxis=S.axis;const M=new Op,T=w,L=P-w;v.left=M,M.boundingData=new Float32Array(6),Rb(g,T,L,M.boundingData,d),y(M,T,L,d,A+1);const E=new Op,N=P,W=I-L;v.right=E,E.boundingData=new Float32Array(6),Rb(g,N,W,E.boundingData,d),y(E,N,W,d,A+1)}return v}}function L$(n,t){const e=n.geometry;t.indirect&&(n._indirectBuffer=(function(u,p){const d=(u.index?u.index.count:u.attributes.position.count)/3,g=d>65536,m=g?4:2,b=p?new SharedArrayBuffer(d*m):new ArrayBuffer(d*m),f=g?new Uint32Array(b):new Uint16Array(b);for(let _=0,y=f.length;_<y;_++)f[_]=_;return f})(e,t.useSharedArrayBuffer),(function(u){if(u.groups.length===0)return!1;const p=Tc(u),d=iT(u).sort(((b,f)=>b.offset-f.offset)),g=d[d.length-1];g.count=Math.min(p-g.offset,g.count);let m=0;return d.forEach((({count:b})=>m+=b)),p!==m})(e)&&!t.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),n._indirectBuffer||S$(e,t);const s=F$(n,t);let i,r,o;const a=[],l=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let u=0;u<s.length;u++){const p=s[u],d=new l(32*c(p));i=new Float32Array(d),r=new Uint32Array(d),o=new Uint16Array(d),h(0,p),a.push(d)}return void(n._roots=a);function c(u){return u.count?1:1+c(u.left)+c(u.right)}function h(u,p){const d=u/4,g=u/2,m=!!p.count,b=p.boundingData;for(let f=0;f<6;f++)i[d+f]=b[f];if(m){const f=p.offset,_=p.count;return r[d+6]=f,o[g+14]=_,o[g+15]=bg,u+32}{const f=p.left,_=p.right,y=p.splitAxis;let v;if(v=h(u+32,f),v/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return r[d+6]=v/4,v=h(v,_),r[d+7]=y,v}}}let kr=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(t,e){let s=1/0,i=-1/0;for(let r=0,o=t.length;r<o;r++){const a=t[r][e];s=a<s?a:s,i=a>i?a:i}this.min=s,this.max=i}setFromPoints(t,e){let s=1/0,i=-1/0;for(let r=0,o=e.length;r<o;r++){const a=e[r],l=t.dot(a);s=l<s?l:s,i=l>i?l:i}this.min=s,this.max=i}isSeparated(t){return this.min>t.max||t.min>this.max}};kr.prototype.setFromBox=(function(){const n=new F;return function(t,e){const s=e.min,i=e.max;let r=1/0,o=-1/0;for(let a=0;a<=1;a++)for(let l=0;l<=1;l++)for(let c=0;c<=1;c++){n.x=s.x*a+i.x*(1-a),n.y=s.y*l+i.y*(1-l),n.z=s.z*c+i.z*(1-c);const h=t.dot(n);r=Math.min(h,r),o=Math.max(h,o)}this.min=r,this.max=o}})();const $$=(function(){const n=new F,t=new F,e=new F;return function(s,i,r){const o=s.start,a=n,l=i.start,c=t;e.subVectors(o,l),n.subVectors(s.end,s.start),t.subVectors(i.end,i.start);const h=e.dot(c),u=c.dot(a),p=c.dot(c),d=e.dot(a),g=a.dot(a)*p-u*u;let m,b;m=g!==0?(h*u-d*p)/g:0,b=(h+m*u)/p,r.x=m,r.y=b}})(),p0=(function(){const n=new Ut,t=new F,e=new F;return function(s,i,r,o){$$(s,i,n);let a=n.x,l=n.y;if(a>=0&&a<=1&&l>=0&&l<=1)return s.at(a,r),void i.at(l,o);if(a>=0&&a<=1)return l<0?i.at(0,o):i.at(1,o),void s.closestPointToPoint(o,!0,r);if(l>=0&&l<=1)return a<0?s.at(0,r):s.at(1,r),void i.closestPointToPoint(r,!0,o);{let c,h;c=a<0?s.start:s.end,h=l<0?i.start:i.end;const u=t,p=e;return s.closestPointToPoint(h,!0,t),i.closestPointToPoint(c,!0,e),u.distanceToSquared(h)<=p.distanceToSquared(c)?(r.copy(u),void o.copy(h)):(r.copy(c),void o.copy(p))}}})(),N$=(function(){const n=new F,t=new F,e=new Wt,s=new qt;return function(i,r){const{radius:o,center:a}=i,{a:l,b:c,c:h}=r;if(s.start=l,s.end=c,s.closestPointToPoint(a,!0,n).distanceTo(a)<=o||(s.start=l,s.end=h,s.closestPointToPoint(a,!0,n).distanceTo(a)<=o)||(s.start=c,s.end=h,s.closestPointToPoint(a,!0,n).distanceTo(a)<=o))return!0;const u=r.getPlane(e);if(Math.abs(u.distanceToPoint(a))<=o){const p=u.projectPoint(a,t);if(r.containsPoint(p))return!0}return!1}})();function Fb(n){return Math.abs(n)<1e-15}let Rn=class extends ns{constructor(...t){super(...t),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map((()=>new F)),this.satBounds=new Array(4).fill().map((()=>new kr)),this.points=[this.a,this.b,this.c],this.sphere=new Us,this.plane=new Wt,this.needsUpdate=!0}intersectsSphere(t){return N$(t,this)}update(){const t=this.a,e=this.b,s=this.c,i=this.points,r=this.satAxes,o=this.satBounds,a=r[0],l=o[0];this.getNormal(a),l.setFromPoints(a,i);const c=r[1],h=o[1];c.subVectors(t,e),h.setFromPoints(c,i);const u=r[2],p=o[2];u.subVectors(e,s),p.setFromPoints(u,i);const d=r[3],g=o[3];d.subVectors(s,t),g.setFromPoints(d,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,t),this.needsUpdate=!1}};Rn.prototype.closestPointToSegment=(function(){const n=new F,t=new F,e=new qt;return function(s,i=null,r=null){const{start:o,end:a}=s,l=this.points;let c,h=1/0;for(let u=0;u<3;u++){const p=(u+1)%3;e.start.copy(l[u]),e.end.copy(l[p]),p0(e,s,n,t),c=n.distanceToSquared(t),c<h&&(h=c,i&&i.copy(n),r&&r.copy(t))}return this.closestPointToPoint(o,n),c=o.distanceToSquared(n),c<h&&(h=c,i&&i.copy(n),r&&r.copy(o)),this.closestPointToPoint(a,n),c=a.distanceToSquared(n),c<h&&(h=c,i&&i.copy(n),r&&r.copy(a)),Math.sqrt(h)}})(),Rn.prototype.intersectsTriangle=(function(){const n=new Rn,t=new Array(3),e=new Array(3),s=new kr,i=new kr,r=new F,o=new F,a=new F,l=new F,c=new F,h=new qt,u=new qt,p=new qt,d=new F;function g(m,b,f){const _=m.points;let y=0,v=-1;for(let w=0;w<3;w++){const{start:I,end:C}=h;I.copy(_[w]),C.copy(_[(w+1)%3]),h.delta(o);const A=Fb(b.distanceToPoint(I));if(Fb(b.normal.dot(o))&&A){f.copy(h),y=2;break}const S=b.intersectLine(h,d);if(!S&&A&&d.copy(I),(S||A)&&!Fb(d.distanceTo(C))){if(y<=1)(y===1?f.start:f.end).copy(d),A&&(v=y);else if(y>=2){(v===1?f.start:f.end).copy(d),y=2;break}if(y++,y===2&&v===-1)break}}return y}return function(m,b=null,f=!1){this.needsUpdate&&this.update(),m.isExtendedTriangle?m.needsUpdate&&m.update():(n.copy(m),n.update(),m=n);const _=this.plane,y=m.plane;if(Math.abs(_.normal.dot(y.normal))>1-1e-10){const v=this.satBounds,w=this.satAxes;e[0]=m.a,e[1]=m.b,e[2]=m.c;for(let A=0;A<4;A++){const S=v[A],P=w[A];if(s.setFromPoints(P,e),S.isSeparated(s))return!1}const I=m.satBounds,C=m.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let A=0;A<4;A++){const S=I[A],P=C[A];if(s.setFromPoints(P,t),S.isSeparated(s))return!1}for(let A=0;A<4;A++){const S=w[A];for(let P=0;P<4;P++){const M=C[P];if(r.crossVectors(S,M),s.setFromPoints(r,t),i.setFromPoints(r,e),s.isSeparated(i))return!1}}return b&&(f||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),b.start.set(0,0,0),b.end.set(0,0,0)),!0}{const v=g(this,y,u);if(v===1&&m.containsPoint(u.end))return b&&(b.start.copy(u.end),b.end.copy(u.end)),!0;if(v!==2)return!1;const w=g(m,_,p);if(w===1&&this.containsPoint(p.end))return b&&(b.start.copy(p.end),b.end.copy(p.end)),!0;if(w!==2)return!1;if(u.delta(a),p.delta(l),a.dot(l)<0){let P=p.start;p.start=p.end,p.end=P}const I=u.start.dot(a),C=u.end.dot(a),A=p.start.dot(a),S=p.end.dot(a);return(I===S||A===C||C<A!=I<S)&&(b&&(c.subVectors(u.start,p.start),c.dot(a)>0?b.start.copy(u.start):b.start.copy(p.start),c.subVectors(u.end,p.end),c.dot(a)<0?b.end.copy(u.end):b.end.copy(p.end)),!0)}}})(),Rn.prototype.distanceToPoint=(function(){const n=new F;return function(t){return this.closestPointToPoint(t,n),t.distanceTo(n)}})(),Rn.prototype.distanceToTriangle=(function(){const n=new F,t=new F,e=["a","b","c"],s=new qt,i=new qt;return function(r,o=null,a=null){const l=o||a?s:null;if(this.intersectsTriangle(r,l))return(o||a)&&(o&&l.getCenter(o),a&&l.getCenter(a)),0;let c=1/0;for(let h=0;h<3;h++){let u;const p=e[h],d=r[p];this.closestPointToPoint(d,n),u=d.distanceToSquared(n),u<c&&(c=u,o&&o.copy(n),a&&a.copy(d));const g=this[p];r.closestPointToPoint(g,n),u=g.distanceToSquared(n),u<c&&(c=u,o&&o.copy(g),a&&a.copy(n))}for(let h=0;h<3;h++){const u=e[h],p=e[(h+1)%3];s.set(this[u],this[p]);for(let d=0;d<3;d++){const g=e[d],m=e[(d+1)%3];i.set(r[g],r[m]),p0(s,i,n,t);const b=n.distanceToSquared(t);b<c&&(c=b,o&&o.copy(n),a&&a.copy(t))}}return Math.sqrt(c)}})();let Ys=class{constructor(t,e,s){this.isOrientedBox=!0,this.min=new F,this.max=new F,this.matrix=new xt,this.invMatrix=new xt,this.points=new Array(8).fill().map((()=>new F)),this.satAxes=new Array(3).fill().map((()=>new F)),this.satBounds=new Array(3).fill().map((()=>new kr)),this.alignedSatBounds=new Array(3).fill().map((()=>new kr)),this.needsUpdate=!1,t&&this.min.copy(t),e&&this.max.copy(e),s&&this.matrix.copy(s)}set(t,e,s){this.min.copy(t),this.max.copy(e),this.matrix.copy(s),this.needsUpdate=!0}copy(t){this.min.copy(t.min),this.max.copy(t.max),this.matrix.copy(t.matrix),this.needsUpdate=!0}};Ys.prototype.update=(function(){return function(){const n=this.matrix,t=this.min,e=this.max,s=this.points;for(let l=0;l<=1;l++)for(let c=0;c<=1;c++)for(let h=0;h<=1;h++){const u=s[1*l|2*c|4*h];u.x=l?e.x:t.x,u.y=c?e.y:t.y,u.z=h?e.z:t.z,u.applyMatrix4(n)}const i=this.satBounds,r=this.satAxes,o=s[0];for(let l=0;l<3;l++){const c=r[l],h=i[l],u=s[1<<l];c.subVectors(o,u),h.setFromPoints(c,s)}const a=this.alignedSatBounds;a[0].setFromPointsField(s,"x"),a[1].setFromPointsField(s,"y"),a[2].setFromPointsField(s,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}})(),Ys.prototype.intersectsBox=(function(){const n=new kr;return function(t){this.needsUpdate&&this.update();const e=t.min,s=t.max,i=this.satBounds,r=this.satAxes,o=this.alignedSatBounds;if(n.min=e.x,n.max=s.x,o[0].isSeparated(n)||(n.min=e.y,n.max=s.y,o[1].isSeparated(n))||(n.min=e.z,n.max=s.z,o[2].isSeparated(n)))return!1;for(let a=0;a<3;a++){const l=r[a],c=i[a];if(n.setFromBox(l,t),c.isSeparated(n))return!1}return!0}})(),Ys.prototype.intersectsTriangle=(function(){const n=new Rn,t=new Array(3),e=new kr,s=new kr,i=new F;return function(r){this.needsUpdate&&this.update(),r.isExtendedTriangle?r.needsUpdate&&r.update():(n.copy(r),n.update(),r=n);const o=this.satBounds,a=this.satAxes;t[0]=r.a,t[1]=r.b,t[2]=r.c;for(let u=0;u<3;u++){const p=o[u],d=a[u];if(e.setFromPoints(d,t),p.isSeparated(e))return!1}const l=r.satBounds,c=r.satAxes,h=this.points;for(let u=0;u<3;u++){const p=l[u],d=c[u];if(e.setFromPoints(d,h),p.isSeparated(e))return!1}for(let u=0;u<3;u++){const p=a[u];for(let d=0;d<4;d++){const g=c[d];if(i.crossVectors(p,g),e.setFromPoints(i,t),s.setFromPoints(i,h),e.isSeparated(s))return!1}}return!0}})(),Ys.prototype.closestPointToPoint=(function(){return function(n,t){return this.needsUpdate&&this.update(),t.copy(n).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}})(),Ys.prototype.distanceToPoint=(function(){const n=new F;return function(t){return this.closestPointToPoint(t,n),t.distanceTo(n)}})(),Ys.prototype.distanceToBox=(function(){const n=["x","y","z"],t=new Array(12).fill().map((()=>new qt)),e=new Array(12).fill().map((()=>new qt)),s=new F,i=new F;return function(r,o=0,a=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(r))return(a||l)&&(r.getCenter(i),this.closestPointToPoint(i,s),r.closestPointToPoint(s,i),a&&a.copy(s),l&&l.copy(i)),0;const c=o*o,h=r.min,u=r.max,p=this.points;let d=1/0;for(let m=0;m<8;m++){const b=p[m];i.copy(b).clamp(h,u);const f=b.distanceToSquared(i);if(f<d&&(d=f,a&&a.copy(b),l&&l.copy(i),f<c))return Math.sqrt(f)}let g=0;for(let m=0;m<3;m++)for(let b=0;b<=1;b++)for(let f=0;f<=1;f++){const _=(m+1)%3,y=(m+2)%3,v=1<<m|b<<_|f<<y,w=p[b<<_|f<<y],I=p[v];t[g].set(w,I);const C=n[m],A=n[_],S=n[y],P=e[g],M=P.start,T=P.end;M[C]=h[C],M[A]=b?h[A]:u[A],M[S]=f?h[S]:u[A],T[C]=u[C],T[A]=b?h[A]:u[A],T[S]=f?h[S]:u[A],g++}for(let m=0;m<=1;m++)for(let b=0;b<=1;b++)for(let f=0;f<=1;f++){i.x=m?u.x:h.x,i.y=b?u.y:h.y,i.z=f?u.z:h.z,this.closestPointToPoint(i,s);const _=i.distanceToSquared(s);if(_<d&&(d=_,a&&a.copy(s),l&&l.copy(i),_<c))return Math.sqrt(_)}for(let m=0;m<12;m++){const b=t[m];for(let f=0;f<12;f++){const _=e[f];p0(b,_,s,i);const y=s.distanceToSquared(i);if(y<d&&(d=y,a&&a.copy(s),l&&l.copy(i),y<c))return Math.sqrt(y)}}return Math.sqrt(d)}})();let iv=class{constructor(t){this._getNewPrimitive=t,this._primitives=[]}getPrimitive(){const t=this._primitives;return t.length===0?this._getNewPrimitive():t.pop()}releasePrimitive(t){this._primitives.push(t)}},M$=class extends iv{constructor(){super((()=>new Rn))}};const Gi=new M$;function gi(n,t){return t[n+15]===65535}function vi(n,t){return t[n+6]}function qi(n,t){return t[n+14]}function Zi(n){return n+8}function Xi(n,t){return t[n+6]}function nT(n,t){return t[n+7]}const Ee=new class{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const n=[];let t=null;this.setBuffer=e=>{t&&n.push(t),t=e,this.float32Array=new Float32Array(e),this.uint16Array=new Uint16Array(e),this.uint32Array=new Uint32Array(e)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,n.length!==0&&this.setBuffer(n.pop())}}};let Co,pc;const cl=[],Pp=new iv((()=>new Tt));function D$(n,t,e,s,i,r){Co=Pp.getPrimitive(),pc=Pp.getPrimitive(),cl.push(Co,pc),Ee.setBuffer(n._roots[t]);const o=f0(0,n.geometry,e,s,i,r);Ee.clearBuffer(),Pp.releasePrimitive(Co),Pp.releasePrimitive(pc),cl.pop(),cl.pop();const a=cl.length;return a>0&&(pc=cl[a-1],Co=cl[a-2]),o}function f0(n,t,e,s,i=null,r=0,o=0){const{float32Array:a,uint16Array:l,uint32Array:c}=Ee;let h=2*n;if(gi(h,l)){const u=vi(n,c),p=qi(h,l);return Me(n,a,Co),s(u,p,!1,o,r+n,Co)}{let u=function(S){const{uint16Array:P,uint32Array:M}=Ee;let T=2*S;for(;!gi(T,P);)T=2*(S=Zi(S));return vi(S,M)},p=function(S){const{uint16Array:P,uint32Array:M}=Ee;let T=2*S;for(;!gi(T,P);)T=2*(S=Xi(S,M));return vi(S,M)+qi(T,P)};const d=Zi(n),g=Xi(n,c);let m,b,f,_,y=d,v=g;if(i&&(f=Co,_=pc,Me(y,a,f),Me(v,a,_),m=i(f),b=i(_),b<m)){y=g,v=d;const S=m;m=b,b=S,f=_}f||(f=Co,Me(y,a,f));const w=e(f,gi(2*y,l),m,o+1,r+y);let I;if(w===2){const S=u(y);I=s(S,p(y)-S,!0,o+1,r+y,f)}else I=w&&f0(y,t,e,s,i,r,o+1);if(I)return!0;_=pc,Me(v,a,_);const C=e(_,gi(2*v,l),b,o+1,r+v);let A;if(C===2){const S=u(v);A=s(S,p(v)-S,!0,o+1,r+v,_)}else A=C&&f0(v,t,e,s,i,r,o+1);return!!A}}const Eh=new F,Lb=new F,hl=new F,ul=new F,dl=new F,Rp=new Ut,Fp=new Ut,Lp=new Ut,s1=new F,i1=new F,n1=new F,$p=new F;function k$(n,t,e,s,i,r,o,a,l){hl.fromBufferAttribute(t,r),ul.fromBufferAttribute(t,o),dl.fromBufferAttribute(t,a);const c=(function(h,u,p,d,g,m){let b;return b=m===Yy?h.intersectTriangle(d,p,u,!0,g):h.intersectTriangle(u,p,d,m!==Pi,g),b===null?null:{distance:h.origin.distanceTo(g),point:g.clone()}})(n,hl,ul,dl,$p,l);if(c){s&&(Rp.fromBufferAttribute(s,r),Fp.fromBufferAttribute(s,o),Lp.fromBufferAttribute(s,a),c.uv=ns.getInterpolation($p,hl,ul,dl,Rp,Fp,Lp,new Ut)),i&&(Rp.fromBufferAttribute(i,r),Fp.fromBufferAttribute(i,o),Lp.fromBufferAttribute(i,a),c.uv1=ns.getInterpolation($p,hl,ul,dl,Rp,Fp,Lp,new Ut)),e&&(s1.fromBufferAttribute(e,r),i1.fromBufferAttribute(e,o),n1.fromBufferAttribute(e,a),c.normal=ns.getInterpolation($p,hl,ul,dl,s1,i1,n1,new F),c.normal.dot(n.direction)>0&&c.normal.multiplyScalar(-1));const h={a:r,b:o,c:a,normal:new F,materialIndex:0};ns.getNormal(hl,ul,dl,h.normal),c.face=h,c.faceIndex=r}return c}function _g(n,t,e,s,i){const r=3*s;let o=r+0,a=r+1,l=r+2;const c=n.index;n.index&&(o=c.getX(o),a=c.getX(a),l=c.getX(l));const{position:h,normal:u,uv:p,uv1:d}=n.attributes,g=k$(e,h,u,p,d,o,a,l,t);return g?(g.faceIndex=s,i&&i.push(g),g):null}function Je(n,t,e,s){const i=n.a,r=n.b,o=n.c;let a=t,l=t+1,c=t+2;e&&(a=e.getX(a),l=e.getX(l),c=e.getX(c)),i.x=s.getX(a),i.y=s.getY(a),i.z=s.getZ(a),r.x=s.getX(l),r.y=s.getY(l),r.z=s.getZ(l),o.x=s.getX(c),o.y=s.getY(c),o.z=s.getZ(c)}function z$(n,t,e,s,i,r,o){const{geometry:a}=e,{index:l}=a,c=a.attributes.position;for(let h=n,u=t+n;h<u;h++){let p;if(p=h,Je(o,3*p,l,c),o.needsUpdate=!0,s(o,p,i,r))return!0}return!1}function B$(n,t=null){t&&Array.isArray(t)&&(t=new Set(t));const e=n.geometry,s=e.index?e.index.array:null,i=e.attributes.position;let r,o,a,l,c=0;const h=n._roots;for(let p=0,d=h.length;p<d;p++)r=h[p],o=new Uint32Array(r),a=new Uint16Array(r),l=new Float32Array(r),u(0,c),c+=r.byteLength;function u(p,d,g=!1){const m=2*p;if(a[m+15]===bg){const b=o[p+6];let f=1/0,_=1/0,y=1/0,v=-1/0,w=-1/0,I=-1/0;for(let C=3*b,A=3*(b+a[m+14]);C<A;C++){let S=s[C];const P=i.getX(S),M=i.getY(S),T=i.getZ(S);P<f&&(f=P),P>v&&(v=P),M<_&&(_=M),M>w&&(w=M),T<y&&(y=T),T>I&&(I=T)}return(l[p+0]!==f||l[p+1]!==_||l[p+2]!==y||l[p+3]!==v||l[p+4]!==w||l[p+5]!==I)&&(l[p+0]=f,l[p+1]=_,l[p+2]=y,l[p+3]=v,l[p+4]=w,l[p+5]=I,!0)}{const b=p+8,f=o[p+6],_=b+d,y=f+d;let v=g,w=!1,I=!1;t?v||(w=t.has(_),I=t.has(y),v=!w&&!I):(w=!0,I=!0);const C=v||I;let A=!1;(v||w)&&(A=u(b,d,v));let S=!1;C&&(S=u(f,d,v));const P=A||S;if(P)for(let M=0;M<3;M++){const T=b+M,L=f+M,E=l[T],N=l[T+3],W=l[L],V=l[L+3];l[p+M]=E<W?E:W,l[p+M+3]=N>V?N:V}return P}}}const r1=new Tt;function ko(n,t,e,s){return Me(n,t,r1),e.intersectBox(r1,s)}function U$(n,t,e,s,i,r,o){const{geometry:a}=e,{index:l}=a,c=a.attributes.position;for(let h=n,u=t+n;h<u;h++){let p;if(p=e.resolveTriangleIndex(h),Je(o,3*p,l,c),o.needsUpdate=!0,s(o,p,i,r))return!0}return!1}const o1=new F;function V$(n,t,e,s,i){Ee.setBuffer(n._roots[t]),m0(0,n,e,s,i),Ee.clearBuffer()}function m0(n,t,e,s,i){const{float32Array:r,uint16Array:o,uint32Array:a}=Ee,l=2*n;if(gi(l,o))(function(c,h,u,p,d,g){const{geometry:m,_indirectBuffer:b}=c;for(let f=p,_=p+d;f<_;f++)_g(m,h,u,f,g)})(t,e,s,vi(n,a),qi(l,o),i);else{const c=Zi(n);ko(c,r,s,o1)&&m0(c,t,e,s,i);const h=Xi(n,a);ko(h,r,s,o1)&&m0(h,t,e,s,i)}}const a1=new F,H$=["x","y","z"];function j$(n,t,e,s){Ee.setBuffer(n._roots[t]);const i=g0(0,n,e,s);return Ee.clearBuffer(),i}function g0(n,t,e,s){const{float32Array:i,uint16Array:r,uint32Array:o}=Ee;let a=2*n;if(gi(a,r))return(function(l,c,h,u,p){const{geometry:d,_indirectBuffer:g}=l;let m=1/0,b=null;for(let f=u,_=u+p;f<_;f++){let y;y=_g(d,c,h,f),y&&y.distance<m&&(b=y,m=y.distance)}return b})(t,e,s,vi(n,o),qi(a,r));{const l=nT(n,o),c=H$[l],h=s.direction[c]>=0;let u,p;h?(u=Zi(n),p=Xi(n,o)):(u=Xi(n,o),p=Zi(n));const d=ko(u,i,s,a1)?g0(u,t,e,s):null;if(d){const m=d.point[c];if(h?m<=i[p+l]:m>=i[p+l+3])return d}const g=ko(p,i,s,a1)?g0(p,t,e,s):null;return d&&g?d.distance<=g.distance?d:g:d||g||null}}const Np=new Tt,pl=new Rn,fl=new Rn,xh=new xt,l1=new Ys,Mp=new Ys;function W$(n,t,e,s){Ee.setBuffer(n._roots[t]);const i=b0(0,n,e,s);return Ee.clearBuffer(),i}function b0(n,t,e,s,i=null){const{float32Array:r,uint16Array:o,uint32Array:a}=Ee;let l=2*n;if(i===null&&(e.boundingBox||e.computeBoundingBox(),l1.set(e.boundingBox.min,e.boundingBox.max,s),i=l1),!gi(l,o)){const c=n+8,h=a[n+6];return Me(c,r,Np),i.intersectsBox(Np)&&b0(c,t,e,s,i)?!0:(Me(h,r,Np),!!(i.intersectsBox(Np)&&b0(h,t,e,s,i)))}{const c=t.geometry,h=c.index,u=c.attributes.position,p=e.index,d=e.attributes.position,g=vi(n,a),m=qi(l,o);if(xh.copy(s).invert(),e.boundsTree)return Me(n,r,Mp),Mp.matrix.copy(xh),Mp.needsUpdate=!0,e.boundsTree.shapecast({intersectsBounds:b=>Mp.intersectsBox(b),intersectsTriangle:b=>{b.a.applyMatrix4(s),b.b.applyMatrix4(s),b.c.applyMatrix4(s),b.needsUpdate=!0;for(let f=3*g,_=3*(m+g);f<_;f+=3)if(Je(fl,f,h,u),fl.needsUpdate=!0,b.intersectsTriangle(fl))return!0;return!1}});for(let b=3*g,f=3*(m+g);b<f;b+=3){Je(pl,b,h,u),pl.a.applyMatrix4(xh),pl.b.applyMatrix4(xh),pl.c.applyMatrix4(xh),pl.needsUpdate=!0;for(let _=0,y=p.count;_<y;_+=3)if(Je(fl,_,p,d),fl.needsUpdate=!0,pl.intersectsTriangle(fl))return!0}}}const Dp=new xt,$b=new Ys,Ih=new Ys,Y$=new F,G$=new F,q$=new F,Z$=new F;function X$(n,t,e,s={},i={},r=0,o=1/0){t.boundingBox||t.computeBoundingBox(),$b.set(t.boundingBox.min,t.boundingBox.max,e),$b.needsUpdate=!0;const a=n.geometry,l=a.attributes.position,c=a.index,h=t.attributes.position,u=t.index,p=Gi.getPrimitive(),d=Gi.getPrimitive();let g=Y$,m=G$,b=null,f=null;i&&(b=q$,f=Z$);let _=1/0,y=null,v=null;return Dp.copy(e).invert(),Ih.matrix.copy(Dp),n.shapecast({boundsTraverseOrder:w=>$b.distanceToBox(w),intersectsBounds:(w,I,C)=>C<_&&C<o&&(I&&(Ih.min.copy(w.min),Ih.max.copy(w.max),Ih.needsUpdate=!0),!0),intersectsRange:(w,I)=>{if(t.boundsTree)return t.boundsTree.shapecast({boundsTraverseOrder:C=>Ih.distanceToBox(C),intersectsBounds:(C,A,S)=>S<_&&S<o,intersectsRange:(C,A)=>{for(let S=C,P=C+A;S<P;S++){Je(d,3*S,u,h),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let M=w,T=w+I;M<T;M++){Je(p,3*M,c,l),p.needsUpdate=!0;const L=p.distanceToTriangle(d,g,b);if(L<_&&(m.copy(g),f&&f.copy(b),_=L,y=M,v=S),L<r)return!0}}}});for(let C=0,A=Tc(t);C<A;C++){Je(d,3*C,u,h),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let S=w,P=w+I;S<P;S++){Je(p,3*S,c,l),p.needsUpdate=!0;const M=p.distanceToTriangle(d,g,b);if(M<_&&(m.copy(g),f&&f.copy(b),_=M,y=S,v=C),M<r)return!0}}}}),Gi.releasePrimitive(p),Gi.releasePrimitive(d),_===1/0?null:(s.point?s.point.copy(m):s.point=m.clone(),s.distance=_,s.faceIndex=y,i&&(i.point?i.point.copy(f):i.point=f.clone(),i.point.applyMatrix4(Dp),m.applyMatrix4(Dp),i.distance=m.sub(i.point).length(),i.faceIndex=v),s)}function Q$(n,t=null){t&&Array.isArray(t)&&(t=new Set(t));const e=n.geometry,s=e.index?e.index.array:null,i=e.attributes.position;let r,o,a,l,c=0;const h=n._roots;for(let p=0,d=h.length;p<d;p++)r=h[p],o=new Uint32Array(r),a=new Uint16Array(r),l=new Float32Array(r),u(0,c),c+=r.byteLength;function u(p,d,g=!1){const m=2*p;if(a[m+15]===bg){const b=o[p+6];let f=1/0,_=1/0,y=1/0,v=-1/0,w=-1/0,I=-1/0;for(let C=b,A=b+a[m+14];C<A;C++){const S=3*n.resolveTriangleIndex(C);for(let P=0;P<3;P++){let M=S+P;M=s?s[M]:M;const T=i.getX(M),L=i.getY(M),E=i.getZ(M);T<f&&(f=T),T>v&&(v=T),L<_&&(_=L),L>w&&(w=L),E<y&&(y=E),E>I&&(I=E)}}return(l[p+0]!==f||l[p+1]!==_||l[p+2]!==y||l[p+3]!==v||l[p+4]!==w||l[p+5]!==I)&&(l[p+0]=f,l[p+1]=_,l[p+2]=y,l[p+3]=v,l[p+4]=w,l[p+5]=I,!0)}{const b=p+8,f=o[p+6],_=b+d,y=f+d;let v=g,w=!1,I=!1;t?v||(w=t.has(_),I=t.has(y),v=!w&&!I):(w=!0,I=!0);const C=v||I;let A=!1;(v||w)&&(A=u(b,d,v));let S=!1;C&&(S=u(f,d,v));const P=A||S;if(P)for(let M=0;M<3;M++){const T=b+M,L=f+M,E=l[T],N=l[T+3],W=l[L],V=l[L+3];l[p+M]=E<W?E:W,l[p+M+3]=N>V?N:V}return P}}}const c1=new F;function K$(n,t,e,s,i){Ee.setBuffer(n._roots[t]),_0(0,n,e,s,i),Ee.clearBuffer()}function _0(n,t,e,s,i){const{float32Array:r,uint16Array:o,uint32Array:a}=Ee,l=2*n;if(gi(l,o))(function(c,h,u,p,d,g){const{geometry:m,_indirectBuffer:b}=c;for(let f=p,_=p+d;f<_;f++)_g(m,h,u,b?b[f]:f,g)})(t,e,s,vi(n,a),qi(l,o),i);else{const c=Zi(n);ko(c,r,s,c1)&&_0(c,t,e,s,i);const h=Xi(n,a);ko(h,r,s,c1)&&_0(h,t,e,s,i)}}const h1=new F,J$=["x","y","z"];function tN(n,t,e,s){Ee.setBuffer(n._roots[t]);const i=y0(0,n,e,s);return Ee.clearBuffer(),i}function y0(n,t,e,s){const{float32Array:i,uint16Array:r,uint32Array:o}=Ee;let a=2*n;if(gi(a,r))return(function(l,c,h,u,p){const{geometry:d,_indirectBuffer:g}=l;let m=1/0,b=null;for(let f=u,_=u+p;f<_;f++){let y;y=_g(d,c,h,g?g[f]:f),y&&y.distance<m&&(b=y,m=y.distance)}return b})(t,e,s,vi(n,o),qi(a,r));{const l=nT(n,o),c=J$[l],h=s.direction[c]>=0;let u,p;h?(u=Zi(n),p=Xi(n,o)):(u=Xi(n,o),p=Zi(n));const d=ko(u,i,s,h1)?y0(u,t,e,s):null;if(d){const m=d.point[c];if(h?m<=i[p+l]:m>=i[p+l+3])return d}const g=ko(p,i,s,h1)?y0(p,t,e,s):null;return d&&g?d.distance<=g.distance?d:g:d||g||null}}const kp=new Tt,ml=new Rn,gl=new Rn,Ch=new xt,u1=new Ys,zp=new Ys;function eN(n,t,e,s){Ee.setBuffer(n._roots[t]);const i=v0(0,n,e,s);return Ee.clearBuffer(),i}function v0(n,t,e,s,i=null){const{float32Array:r,uint16Array:o,uint32Array:a}=Ee;let l=2*n;if(i===null&&(e.boundingBox||e.computeBoundingBox(),u1.set(e.boundingBox.min,e.boundingBox.max,s),i=u1),!gi(l,o)){const c=n+8,h=a[n+6];return Me(c,r,kp),i.intersectsBox(kp)&&v0(c,t,e,s,i)?!0:(Me(h,r,kp),!!(i.intersectsBox(kp)&&v0(h,t,e,s,i)))}{const c=t.geometry,h=c.index,u=c.attributes.position,p=e.index,d=e.attributes.position,g=vi(n,a),m=qi(l,o);if(Ch.copy(s).invert(),e.boundsTree)return Me(n,r,zp),zp.matrix.copy(Ch),zp.needsUpdate=!0,e.boundsTree.shapecast({intersectsBounds:b=>zp.intersectsBox(b),intersectsTriangle:b=>{b.a.applyMatrix4(s),b.b.applyMatrix4(s),b.c.applyMatrix4(s),b.needsUpdate=!0;for(let f=g,_=m+g;f<_;f++)if(Je(gl,3*t.resolveTriangleIndex(f),h,u),gl.needsUpdate=!0,b.intersectsTriangle(gl))return!0;return!1}});for(let b=g,f=m+g;b<f;b++){const _=t.resolveTriangleIndex(b);Je(ml,3*_,h,u),ml.a.applyMatrix4(Ch),ml.b.applyMatrix4(Ch),ml.c.applyMatrix4(Ch),ml.needsUpdate=!0;for(let y=0,v=p.count;y<v;y+=3)if(Je(gl,y,p,d),gl.needsUpdate=!0,ml.intersectsTriangle(gl))return!0}}}const Bp=new xt,Nb=new Ys,Th=new Ys,sN=new F,iN=new F,nN=new F,rN=new F;function oN(n,t,e,s={},i={},r=0,o=1/0){t.boundingBox||t.computeBoundingBox(),Nb.set(t.boundingBox.min,t.boundingBox.max,e),Nb.needsUpdate=!0;const a=n.geometry,l=a.attributes.position,c=a.index,h=t.attributes.position,u=t.index,p=Gi.getPrimitive(),d=Gi.getPrimitive();let g=sN,m=iN,b=null,f=null;i&&(b=nN,f=rN);let _=1/0,y=null,v=null;return Bp.copy(e).invert(),Th.matrix.copy(Bp),n.shapecast({boundsTraverseOrder:w=>Nb.distanceToBox(w),intersectsBounds:(w,I,C)=>C<_&&C<o&&(I&&(Th.min.copy(w.min),Th.max.copy(w.max),Th.needsUpdate=!0),!0),intersectsRange:(w,I)=>{if(t.boundsTree){const C=t.boundsTree;return C.shapecast({boundsTraverseOrder:A=>Th.distanceToBox(A),intersectsBounds:(A,S,P)=>P<_&&P<o,intersectsRange:(A,S)=>{for(let P=A,M=A+S;P<M;P++){const T=C.resolveTriangleIndex(P);Je(d,3*T,u,h),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let L=w,E=w+I;L<E;L++){const N=n.resolveTriangleIndex(L);Je(p,3*N,c,l),p.needsUpdate=!0;const W=p.distanceToTriangle(d,g,b);if(W<_&&(m.copy(g),f&&f.copy(b),_=W,y=L,v=P),W<r)return!0}}}})}for(let C=0,A=Tc(t);C<A;C++){Je(d,3*C,u,h),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let S=w,P=w+I;S<P;S++){const M=n.resolveTriangleIndex(S);Je(p,3*M,c,l),p.needsUpdate=!0;const T=p.distanceToTriangle(d,g,b);if(T<_&&(m.copy(g),f&&f.copy(b),_=T,y=S,v=C),T<r)return!0}}}}),Gi.releasePrimitive(p),Gi.releasePrimitive(d),_===1/0?null:(s.point?s.point.copy(m):s.point=m.clone(),s.distance=_,s.faceIndex=y,i&&(i.point?i.point.copy(f):i.point=f.clone(),i.point.applyMatrix4(Bp),m.applyMatrix4(Bp),i.distance=m.sub(i.point).length(),i.faceIndex=v),s)}const Vu=new Ee.constructor,$m=new Ee.constructor,fo=new iv((()=>new Tt)),bl=new Tt,_l=new Tt,Mb=new Tt,Db=new Tt;let kb=!1;function xn(n,t,e,s,i,r=0,o=0,a=0,l=0,c=null,h=!1){let u,p;h?(u=$m,p=Vu):(u=Vu,p=$m);const d=u.float32Array,g=u.uint32Array,m=u.uint16Array,b=p.float32Array,f=p.uint32Array,_=p.uint16Array,y=2*t,v=gi(2*n,m),w=gi(y,_);let I=!1;if(w&&v)I=h?i(vi(t,f),qi(2*t,_),vi(n,g),qi(2*n,m),l,o+t,a,r+n):i(vi(n,g),qi(2*n,m),vi(t,f),qi(2*t,_),a,r+n,l,o+t);else if(w){const C=fo.getPrimitive();Me(t,b,C),C.applyMatrix4(e);const A=Zi(n),S=Xi(n,g);Me(A,d,bl),Me(S,d,_l);const P=C.intersectsBox(bl),M=C.intersectsBox(_l);I=P&&xn(t,A,s,e,i,o,r,l,a+1,C,!h)||M&&xn(t,S,s,e,i,o,r,l,a+1,C,!h),fo.releasePrimitive(C)}else{const C=Zi(t),A=Xi(t,f);Me(C,b,Mb),Me(A,b,Db);const S=c.intersectsBox(Mb),P=c.intersectsBox(Db);if(S&&P)I=xn(n,C,e,s,i,r,o,a,l+1,c,h)||xn(n,A,e,s,i,r,o,a,l+1,c,h);else if(S)if(v)I=xn(n,C,e,s,i,r,o,a,l+1,c,h);else{const M=fo.getPrimitive();M.copy(Mb).applyMatrix4(e);const T=Zi(n),L=Xi(n,g);Me(T,d,bl),Me(L,d,_l);const E=M.intersectsBox(bl),N=M.intersectsBox(_l);I=E&&xn(C,T,s,e,i,o,r,l,a+1,M,!h)||N&&xn(C,L,s,e,i,o,r,l,a+1,M,!h),fo.releasePrimitive(M)}else if(P)if(v)I=xn(n,A,e,s,i,r,o,a,l+1,c,h);else{const M=fo.getPrimitive();M.copy(Db).applyMatrix4(e);const T=Zi(n),L=Xi(n,g);Me(T,d,bl),Me(L,d,_l);const E=M.intersectsBox(bl),N=M.intersectsBox(_l);I=E&&xn(A,T,s,e,i,o,r,l,a+1,M,!h)||N&&xn(A,L,s,e,i,o,r,l,a+1,M,!h),fo.releasePrimitive(M)}}return I}const Up=new Ys,d1=new Tt;let aN=class rT{static serialize(t,e={}){e={cloneBuffers:!0,...e};const s=t.geometry,i=t._roots,r=t._indirectBuffer,o=s.getIndex();let a;return a=e.cloneBuffers?{roots:i.map((l=>l.slice())),index:o.array.slice(),indirectBuffer:r?r.slice():null}:{roots:i,index:o.array,indirectBuffer:r},a}static deserialize(t,e,s={}){s={setIndex:!0,indirect:!!t.indirectBuffer,...s};const{index:i,roots:r,indirectBuffer:o}=t,a=new rT(e,{...s,[Pb]:!0});if(a._roots=r,a._indirectBuffer=o||null,s.setIndex){const l=e.getIndex();if(l===null){const c=new ze(t.index,1,!1);e.setIndex(c)}else l.array!==i&&(l.array.set(i),l.needsUpdate=!0)}return a}get indirect(){return!!this._indirectBuffer}constructor(t,e={}){if(!t.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t.index&&t.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((e=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,[Pb]:!1},e)).useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=t,this._roots=null,this._indirectBuffer=null,e[Pb]||(L$(this,e),!t.boundingBox&&e.setBoundingBox&&(t.boundingBox=this.getBoundingBox(new Tt)));const{_indirectBuffer:s}=this;this.resolveTriangleIndex=e.indirect?i=>s[i]:i=>i}refit(t=null){return(this.indirect?Q$:B$)(this,t)}traverse(t,e=0){const s=this._roots[e],i=new Uint32Array(s),r=new Uint16Array(s);(function o(a,l=0){const c=2*a,h=r[c+15]===bg;if(h){const u=i[a+6],p=r[c+14];t(l,h,new Float32Array(s,4*a,6),u,p)}else{const u=a+8,p=i[a+6],d=i[a+7];t(l,h,new Float32Array(s,4*a,6),d)||(o(u,l+1),o(p,l+1))}})(0)}raycast(t,e=Ic){const s=this._roots,i=this.geometry,r=[],o=e.isMaterial,a=Array.isArray(e),l=i.groups,c=o?e.side:e,h=this.indirect?K$:V$;for(let u=0,p=s.length;u<p;u++){const d=a?e[l[u].materialIndex].side:c,g=r.length;if(h(this,u,d,t,r),a){const m=l[u].materialIndex;for(let b=g,f=r.length;b<f;b++)r[b].face.materialIndex=m}}return r}raycastFirst(t,e=Ic){const s=this._roots,i=this.geometry,r=e.isMaterial,o=Array.isArray(e);let a=null;const l=i.groups,c=r?e.side:e,h=this.indirect?tN:j$;for(let u=0,p=s.length;u<p;u++){const d=h(this,u,o?e[l[u].materialIndex].side:c,t);d!=null&&(a==null||d.distance<a.distance)&&(a=d,o&&(d.face.materialIndex=l[u].materialIndex))}return a}intersectsGeometry(t,e){let s=!1;const i=this._roots,r=this.indirect?eN:W$;for(let o=0,a=i.length;o<a&&(s=r(this,o,t,e),!s);o++);return s}shapecast(t){const e=Gi.getPrimitive(),s=this.indirect?U$:z$;let{boundsTraverseOrder:i,intersectsBounds:r,intersectsRange:o,intersectsTriangle:a}=t;if(o&&a){const u=o;o=(p,d,g,m,b)=>!!u(p,d,g,m,b)||s(p,d,this,a,g,m,e)}else o||(o=a?(u,p,d,g)=>s(u,p,this,a,d,g,e):(u,p,d)=>d);let l=!1,c=0;const h=this._roots;for(let u=0,p=h.length;u<p;u++){const d=h[u];if(l=D$(this,u,r,o,i,c),l)break;c+=d.byteLength}return Gi.releasePrimitive(e),l}bvhcast(t,e,s){let{intersectsRanges:i,intersectsTriangles:r}=s;const o=Gi.getPrimitive(),a=this.geometry.index,l=this.geometry.attributes.position,c=this.indirect?g=>{const m=this.resolveTriangleIndex(g);Je(o,3*m,a,l)}:g=>{Je(o,3*g,a,l)},h=Gi.getPrimitive(),u=t.geometry.index,p=t.geometry.attributes.position,d=t.indirect?g=>{const m=t.resolveTriangleIndex(g);Je(h,3*m,u,p)}:g=>{Je(h,3*g,u,p)};if(r){const g=(m,b,f,_,y,v,w,I)=>{for(let C=f,A=f+_;C<A;C++){d(C),h.a.applyMatrix4(e),h.b.applyMatrix4(e),h.c.applyMatrix4(e),h.needsUpdate=!0;for(let S=m,P=m+b;S<P;S++)if(c(S),o.needsUpdate=!0,r(o,h,S,C,y,v,w,I))return!0}return!1};if(i){const m=i;i=function(b,f,_,y,v,w,I,C){return!!m(b,f,_,y,v,w,I,C)||g(b,f,_,y,v,w,I,C)}}else i=g}return(function(g,m,b,f){if(kb)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");kb=!0;const _=g._roots,y=m._roots;let v,w=0,I=0;const C=new xt().copy(b).invert();for(let A=0,S=_.length;A<S;A++){Vu.setBuffer(_[A]),I=0;const P=fo.getPrimitive();Me(0,Vu.float32Array,P),P.applyMatrix4(C);for(let M=0,T=y.length;M<T&&($m.setBuffer(y[A]),v=xn(0,0,b,C,f,w,I,0,0,P),$m.clearBuffer(),I+=y[M].length,!v);M++);if(fo.releasePrimitive(P),Vu.clearBuffer(),w+=_[A].length,v)break}return kb=!1,v})(this,t,e,i)}intersectsBox(t,e){return Up.set(t.min,t.max,e),Up.needsUpdate=!0,this.shapecast({intersectsBounds:s=>Up.intersectsBox(s),intersectsTriangle:s=>Up.intersectsTriangle(s)})}intersectsSphere(t){return this.shapecast({intersectsBounds:e=>t.intersectsBox(e),intersectsTriangle:e=>e.intersectsSphere(t)})}closestPointToGeometry(t,e,s={},i={},r=0,o=1/0){return(this.indirect?oN:X$)(this,t,e,s,i,r,o)}closestPointToPoint(t,e={},s=0,i=1/0){return(function(r,o,a={},l=0,c=1/0){const h=l*l,u=c*c;let p=1/0,d=null;if(r.shapecast({boundsTraverseOrder:m=>(Eh.copy(o).clamp(m.min,m.max),Eh.distanceToSquared(o)),intersectsBounds:(m,b,f)=>f<p&&f<u,intersectsTriangle:(m,b)=>{m.closestPointToPoint(o,Eh);const f=o.distanceToSquared(Eh);return f<p&&(Lb.copy(Eh),p=f,d=b),f<h}}),p===1/0)return null;const g=Math.sqrt(p);return a.point?a.point.copy(Lb):a.point=Lb.clone(),a.distance=g,a.faceIndex=d,a})(this,t,e,s,i)}getBoundingBox(t){return t.makeEmpty(),this._roots.forEach((e=>{Me(0,new Float32Array(e),d1),t.union(d1)})),t}};function p1(n,t,e){return n===null?null:(n.point.applyMatrix4(t.matrixWorld),n.distance=n.point.distanceTo(e.ray.origin),n.object=t,n.distance<e.near||n.distance>e.far?null:n)}const zb=new $o,f1=new xt,lN=ht.prototype.raycast;function cN(n,t){if(this.geometry.boundsTree){if(this.material===void 0)return;f1.copy(this.matrixWorld).invert(),zb.copy(n.ray).applyMatrix4(f1);const e=this.geometry.boundsTree;if(n.firstHitOnly===!0){const s=p1(e.raycastFirst(zb,this.material),this,n);s&&t.push(s)}else{const s=e.raycast(zb,this.material);for(let i=0,r=s.length;i<r;i++){const o=p1(s[i],this,n);o&&t.push(o)}}}else lN.call(this,n,t)}function hN(n){return this.boundsTree=new aN(this,n),this.boundsTree}function uN(){this.boundsTree=null}let oT=class{constructor(t,e){O(this,"meshes"),O(this,"_templateController",new WN),O(this,"_meshIds",new Set),O(this,"_idGenerator",new Ky),O(this,"_modelCode"),this.meshes=e,this._modelCode=this.getModelCode(t)}dispose(){ic.delete(this._meshIds)}useMesh(t,e,s){const i=this.meshCode(t,s);ic.lockIn(e),this._templateController.add(i,e)}getMesh(t,e){const s=this.meshCode(t,e);return ic.get(s)??this._templateController.get(s)}saveMesh(t,e,s){Wi.forEach(e,ic.updateMeshMemory);const i=this.meshCode(t,s);ic.add(i,e),this._meshIds.add(i)}meshCode(t,e){const s=[this._modelCode,this.getRepresentation(),e,t];return this._idGenerator.generate(s)}getModelCode(t){return this._idGenerator.generate([t])}};const Hu=32767;var Oa=(n=>(n[n.NONE=0]="NONE",n[n.AABB=1]="AABB",n[n.CUSTOM=2]="CUSTOM",n))(Oa||{});const ti=class In{static getProfile(t,e,s){return t.type()===ms.BIG?t.bigProfiles(e,s):t.profiles(e,s)}static getPoints(t){const e=new Float32Array(3*t.pointsLength());for(let s=0;s<t.pointsLength();s++)t.points(s,this._tempPoint),e[3*s]=this._tempPoint.x(),e[3*s+1]=this._tempPoint.y(),e[3*s+2]=this._tempPoint.z();return e}static getProfileIndices(t,e){const s=t.type()===ms.BIG,i={outer:[],inners:[]},r=s?t.bigHolesLength():t.holesLength(),o=s?"bigHoles":"holes",a=In.getProfile(t,e);i.outer=Array.from(a.indicesArray());for(let l=0;l<r;l++){const c=t[o](l);if(c.profileId()===e){const h=Array.from(c.indicesArray());i.inners.push(h)}}return i}static getHole(t,e,s){return t.type()===ms.BIG?t.bigHoles(e,s):t.holes(e,s)}static getProfilesLength(t){return t.type()===ms.BIG?t.bigProfilesLength():t.profilesLength()}static getHolesLength(t){return t.type()===ms.BIG?t.bigHolesLength():t.holesLength()}static getShell(t,e){return t.shells(e,this._shell)}static point(t,e,s){t instanceof ji&&t.points(e,this._tempPoint);const i=this._tempPoint.x(),r=this._tempPoint.y(),o=this._tempPoint.z();s.set(i,r,o)}static getNormalsOfShellProfile(t,e){const s=In.getProfilesLength(t);for(let i=0;i<s;i++){const r=In.getProfile(t,i),o=this.fetchNormalsOfProfile(t,r);e.push(o)}return e}static computeNormalsAvg(t,e,s,i){this.setupNormalBuffer(t);const r=s[e];for(let o=0;o<t.length;o++){const a=t[o],l=i.get(a);this.aggregateNormals(l,s,r),this.computeAvgNormal(o)}return this._normalBuffer}static getBuffer(t){const e=t.bb,s=e.__offset(t.bb_pos,8),i=3*t.pointsLength(),r=e.__vector(t.bb_pos+s),o=e.bytes().buffer;return new Float32Array(o,r,i)}static getPointsShell(t){return this._pointsByProfile.clear(),this.fetchAllPointsByProfile(t),In.fetchAllPointsByHole(t),this._pointsByProfile}static addNormals(t,e,s){for(const i of t){const r=e[i];s.dot(r)>this._faceThreshold&&this._tempNormal.add(r)}}static setupNormalBuffer(t){const e=3*t.length;this._normalBuffer.length<e&&(this._normalBuffer=new Int16Array(e))}static fetchNormalsOfProfile(t,e){const s=e.indicesLength();return this.isTooSmall(t,s)?new F(1,0,0):this.computeProfileNormal(s,e,t)}static fetchAllPointsByHole(t){const e=In.getHolesLength(t),s=this.getTempHole(t);for(let i=0;i<e;i++){In.getHole(t,i,s);const r=s.profileId(),o=s.indicesLength();for(let a=0;a<o;a++){const l=s.indices(a);In.savePointByProfile(l,r)}}}static computeProfileNormal(t,e,s){this._v3.set(0,0,0);for(let r=0;r<t;r++)this.fetchPointsForNormal(r,t,e,s),this.computeProfilePointNormal();const i=this._v3.clone();return i.normalize(),i}static computeProfilePointNormal(){const t=this._v1.x-this._v2.x,e=this._v1.y-this._v2.y,s=this._v1.z-this._v2.z,i=this._v1.x+this._v2.x,r=this._v1.y+this._v2.y,o=this._v1.z+this._v2.z;this._v3.x+=e*o,this._v3.y+=s*i,this._v3.z+=t*r}static aggregateNormals(t,e,s){if(this._tempNormal.set(0,0,0),!t||!t.length)return void this._tempNormal.set(1,0,0);if(t.length===1){const i=t[0];this._tempNormal=e[i].clone()}else In.addNormals(t,e,s)}static fetchPointsForNormal(t,e,s,i){const r=(t+1)%e,o=s.indices(t),a=s.indices(r);this.point(i,o,this._v1),this.point(i,a,this._v2)}static savePointByProfile(t,e){this._pointsByProfile.has(t)||this._pointsByProfile.set(t,[]),this._pointsByProfile.get(t).push(e)}static isTooSmall(t,e){return t.pointsLength()<=2||e<=2}static fetchAllPointsByProfile(t){const e=this.getProfilesLength(t),s=this.getTempProfile(t);for(let i=0;i<e;i++){In.getProfile(t,i,s);const r=s.indicesLength();for(let o=0;o<r;o++){const a=s.indices(o);In.savePointByProfile(a,i)}}}static computeAvgNormal(t){this._tempNormal.normalize(),this._tempNormal.multiplyScalar(Hu),this._tempNormal.toArray(this._normalBuffer,3*t)}static getTempProfile(t){return t.type()===ms.BIG?this._bigShellProfile:this._shellProfile}static getTempHole(t){return t.type()===ms.BIG?this._bigShellHole:this._shellHole}};O(ti,"_faceThreshold",Math.cos(Math.PI/8)),O(ti,"_shell",new ji),O(ti,"_normalBuffer",new Int16Array),O(ti,"_tempNormal",new F),O(ti,"_tempPoint",new rs),O(ti,"_shellProfile",new Do),O(ti,"_bigShellProfile",new Mo),O(ti,"_shellHole",new Ga),O(ti,"_bigShellHole",new Ya),O(ti,"_pointsByProfile",new Map),O(ti,"_v1",new F),O(ti,"_v2",new F),O(ti,"_v3",new F);let Zt=ti,dN=class{constructor(){O(this,"_shellHole",new Ga),O(this,"_bigShellHole",new Ya),O(this,"holePoints",0),O(this,"profilePoints",0),O(this,"triangleAmount",0),O(this,"indexCount",0),O(this,"meshes",[]),O(this,"_shellProfile",new Do),O(this,"_bigShellProfile",new Mo)}newMeshTemplate(t){return this.getIsEmpty(t)?{objectClass:zs.SHELL}:(this.reset(!0),this.processShell(t),this.getResult())}manageDataLeft(){this.getIsDataLeft()&&this.setMesh()}getIsEmpty(t){return Zt.getProfilesLength(t)===0}processShellHoles(t,e){let s=!1;const i=Zt.getHolesLength(t),r=this.getTempHole(t);for(let o=0;o<i;o++)Zt.getHole(t,o,r),r.profileId()===e&&(this.updateBuffers(t,s),s=!0);this.manageFoundHoles(t,s)}newMesh(){return{objectClass:zs.SHELL,indexCount:3*this.triangleAmount,positionCount:3*(this.holePoints+this.profilePoints),normalCount:3*(this.holePoints+this.profilePoints)}}reset(t){this.holePoints=0,this.profilePoints=0,this.triangleAmount=0,t&&(this.meshes=void 0)}getIsDataLeft(){const t=this.triangleAmount>0,e=this.holePoints>0,s=this.profilePoints>0;return t||e||s}processShell(t){const e=Zt.getProfilesLength(t),s=this.getTempProfile(t);for(let i=0;i<e;i++)Zt.getProfile(t,i,s),this.indexCount=s.indicesLength(),this.profilePoints+=this.indexCount,this.processShellHoles(t,i),this.manageMemory();this.manageDataLeft()}manageFoundHoles(t,e){const s=this.getTempProfile(t).indicesLength();e?this.triangleAmount+=s:s>2&&(this.triangleAmount+=s-2)}getResult(){const t=this.meshes;return this.meshes=void 0,t}manageMemory(){this.holePoints+this.profilePoints+this.indexCount>qa&&this.setMesh()}updateBuffers(t,e){const s=this.getTempHole(t);this.holePoints+=s.indicesLength(),this.triangleAmount+=s.indicesLength(),e&&(this.triangleAmount+=2)}setMesh(){const t=this.newMesh();this.meshes?Array.isArray(this.meshes)?this.meshes.push(t):this.meshes=[this.meshes,t]:this.meshes=t,this.reset(!1)}getTempProfile(t){return t.type()===ms.BIG?this._bigShellProfile:this._shellProfile}getTempHole(t){return t.type()===ms.BIG?this._bigShellHole:this._shellHole}};var w0=(n=>(n[n.four=4]="four",n[n.three=3]="three",n))(w0||{});function pN(n,t,e,s,i,r){const o=t&&t.length,a=o?t[0]*e:n.length;let l,c,h,u=m1(n,0,a,e,!0,s,i);if(u&&u.next!==u.prev){if(o&&(u=(function(p,d,g,m,b,f){const _=[];for(let y=0,v=d.length;y<v;y++){const w=m1(p,d[y]*m,y<v-1?d[y+1]*m:p.length,m,!1,b,f);w===w.next&&(w.steiner=!0),_.push(wN(w))}_.sort(_N);for(let y=0;y<_.length;y++)g=zo(g=yN(_[y],g),g.next);return g})(n,t,u,e,s,i)),n.length>80*e){let p=n[s],d=n[i];l=p,c=d;for(let g=e;g<a;g+=e){const m=n[g+s],b=n[g+i];m<l&&(l=m),b<c&&(c=b),m>p&&(p=m),b>d&&(d=b)}h=Math.max(p-l,d-c),h=h!==0?1/h:0}dd(u,r,e,l,c,h)}}function m1(n,t,e,s,i,r,o){let a,l,c;if(i===(function(h,u,p,d,g,m){let b=0;for(let f=u,_=p-d;f<p;f+=d)b+=(h[_+g]-h[f+g])*(h[f+m]+h[_+m]),_=f;return b})(n,t,e,s,r,o)>0)for(c=t;c<e;c+=s)a=g1(c,n[c+r],n[c+o],a);else for(c=e-s;c>=t;c-=s)a=g1(c,n[c+r],n[c+o],a);return a&&yg(a,a.next)&&(l=a.next,fd(a),a=l),a}function zo(n,t){if(!n)return n;t||(t=n);let e,s,i=n;do if(e=!1,i.steiner||!yg(i,i.next)&&Ue(i.prev,i,i.next)!==0)i=i.next;else{if(s=i.prev,fd(i),i=t=s,i===i.next)break;e=!0}while(e||i!==t);return t}function dd(n,t,e,s,i,r,o){!o&&r&&(function(l,c,h,u){let p=l;do p.z===null&&(p.z=E0(p.x,p.y,c,h,u)),p.prevZ=p.prev,p.nextZ=p.next,p=p.next;while(p!==l);p.prevZ.nextZ=null,p.prevZ=null,(function(d){let g,m=1;do{let b,f=d;d=null;let _=null;for(g=0;f;){g++;let y=f,v=0;for(let I=0;I<m&&(v++,y=y.nextZ,y);I++);let w=m;for(;v>0||w>0&&y;)v!==0&&(w===0||!y||f.z<=y.z)?(b=f,f=f.nextZ,v--):(b=y,y=y.nextZ,w--),_?_.nextZ=b:d=b,b.prevZ=_,_=b;f=y}_.nextZ=null,m*=2}while(g>1)})(p)})(n,s,i,r);let a=n;for(;n.prev!==n.next;){const l=n.prev,c=n.next;if(r?mN(n,s,i,r):fN(n))t(l.i/e,n.i/e,c.i/e),fd(n),n=c.next,a=c.next;else if((n=c)===a){o?o===1?dd(n=gN(zo(n),t,e),t,e,s,i,r,2):o===2&&bN(n,t,e,s,i,r):dd(zo(n),t,e,s,i,r,1);break}}}function fN(n){const t=n.prev,e=n,s=n.next;if(Ue(t,e,s)>=0)return!1;let i=n.next.next;for(;i!==n.prev;){if(fc(t.x,t.y,e.x,e.y,s.x,s.y,i.x,i.y)&&Ue(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function mN(n,t,e,s){const i=n.prev,r=n,o=n.next;if(Ue(i,r,o)>=0)return!1;const a=Math.min(i.x,r.x,o.x),l=Math.min(i.y,r.y,o.y),c=Math.max(i.x,r.x,o.x),h=Math.max(i.y,r.y,o.y),u=E0(a,l,t,e,s),p=E0(c,h,t,e,s);let d=n.prevZ,g=n.nextZ;for(;d&&d.z>=u&&g&&g.z<=p;){if(d!==n.prev&&d!==n.next&&fc(i.x,i.y,r.x,r.y,o.x,o.y,d.x,d.y)&&Ue(d.prev,d,d.next)>=0||(d=d.prevZ,g!==n.prev&&g!==n.next&&fc(i.x,i.y,r.x,r.y,o.x,o.y,g.x,g.y)&&Ue(g.prev,g,g.next)>=0))return!1;g=g.nextZ}for(;d&&d.z>=u;){if(d!==n.prev&&d!==n.next&&fc(i.x,i.y,r.x,r.y,o.x,o.y,d.x,d.y)&&Ue(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;g&&g.z<=p;){if(g!==n.prev&&g!==n.next&&fc(i.x,i.y,r.x,r.y,o.x,o.y,g.x,g.y)&&Ue(g.prev,g,g.next)>=0)return!1;g=g.nextZ}return!0}function gN(n,t,e){let s=n;do{const i=s.prev,r=s.next.next;!yg(i,r)&&aT(i,s,s.next,r)&&pd(i,r)&&pd(r,i)&&(t(i.i/e,s.i/e,r.i/e),fd(s.next),fd(s),s=n=r),s=s.next}while(s!==n);return zo(s)}function bN(n,t,e,s,i,r){let o=n;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&EN(o,a)){let l=lT(o,a);return o=zo(o,o.next),l=zo(l,l.next),dd(o,t,e,s,i,r),void dd(l,t,e,s,i,r)}a=a.next}o=o.next}while(o!==n)}function _N(n,t){return n.x-t.x}function yN(n,t){const e=(function(r,o){let a=o;const l=r.x,c=r.y;let h,u=-1/0;do{if(c<=a.y&&c>=a.next.y&&a.next.y!==a.y){const b=a.x+(c-a.y)*(a.next.x-a.x)/(a.next.y-a.y);if(b<=l&&b>u){if(u=b,b===l){if(c===a.y)return a;if(c===a.next.y)return a.next}h=a.x<a.next.x?a:a.next}}a=a.next}while(a!==o);if(!h)return null;if(l===u)return h;const p=h,d=h.x,g=h.y;let m=1/0;a=h;do{if(l>=a.x&&a.x>=d&&l!==a.x&&fc(c<g?l:u,c,d,g,c<g?u:l,c,a.x,a.y)){const b=Math.abs(c-a.y)/(l-a.x);pd(a,r)&&(b<m||b===m&&(a.x>h.x||a.x===h.x&&vN(h,a)))&&(h=a,m=b)}a=a.next}while(a!==p);return h})(n,t);if(!e)return t;const s=lT(e,n),i=zo(e,e.next);return zo(s,s.next),t===t.next||e===t?i:t}function vN(n,t){return Ue(n.prev,n,t.prev)<0&&Ue(t.next,n,n.next)<0}function E0(n,t,e,s,i){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-e)*i)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-s)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function wN(n){let t=n,e=n;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==n);return e}function fc(n,t,e,s,i,r,o,a){return(i-o)*(t-a)-(n-o)*(r-a)>=0&&(n-o)*(s-a)-(e-o)*(t-a)>=0&&(e-o)*(r-a)-(i-o)*(s-a)>=0}function EN(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!(function(e,s){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==s.i&&i.next.i!==s.i&&aT(i,i.next,e,s))return!0;i=i.next}while(i!==e);return!1})(n,t)&&(pd(n,t)&&pd(t,n)&&(function(e,s){let i=e,r=!1;const o=(e.x+s.x)/2,a=(e.y+s.y)/2;do i.y>a!=i.next.y>a&&i.next.y!==i.y&&o<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==e);return r})(n,t)&&(Ue(n.prev,n,t.prev)||Ue(n,t.prev,t))||yg(n,t)&&Ue(n.prev,n,n.next)>0&&Ue(t.prev,t,t.next)>0)}function Ue(n,t,e){return(t.y-n.y)*(e.x-t.x)-(t.x-n.x)*(e.y-t.y)}function yg(n,t){return n.x===t.x&&n.y===t.y}function aT(n,t,e,s){const i=Hp(Ue(n,t,e)),r=Hp(Ue(n,t,s)),o=Hp(Ue(e,s,n)),a=Hp(Ue(e,s,t));return i!==r&&o!==a||!(i!==0||!Vp(n,e,t))||!(r!==0||!Vp(n,s,t))||!(o!==0||!Vp(e,n,s))||!(a!==0||!Vp(e,t,s))}function Vp(n,t,e){return t.x<=Math.max(n.x,e.x)&&t.x>=Math.min(n.x,e.x)&&t.y<=Math.max(n.y,e.y)&&t.y>=Math.min(n.y,e.y)}function Hp(n){return n>0?1:n<0?-1:0}function pd(n,t){return Ue(n.prev,n,n.next)<0?Ue(n,t,n.next)>=0&&Ue(n,n.prev,t)>=0:Ue(n,t,n.prev)<0||Ue(n,n.next,t)<0}function lT(n,t){const e=x0(n.i,n.x,n.y),s=x0(t.i,t.x,t.y),i=n.next,r=t.prev;return n.next=t,t.prev=n,e.next=i,i.prev=e,s.next=e,e.prev=s,r.next=s,s.prev=r,s}function g1(n,t,e,s){const i=x0(n,t,e);return s?(i.next=s.next,i.prev=s,s.next.prev=i,s.next=i):(i.prev=i,i.next=i),i}function fd(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ),n.next=n,n.prev=n}function x0(n,t,e){return{i:n,x:t,y:e,prev:null,next:null,z:null,prevZ:null,nextZ:null,steiner:!1}}const cT=class I0{static create(t,e,s,i,r,o,a,l){const c=t.length,h=a.verticesAmount;I0.processBuffers(c,t,r,a,e,s);const u=r.positionBuffer,p=(a.verticesAmount-h)/3;this.processNormals(u,this._tempVec,p,h),this.triangulate(o,i,c,r,a,h),this.setFaceId(h,a,r,l)}static setFaceId(t,e,s,i){const r=t/3,o=e.verticesAmount/3;for(let a=r;a<o;a++)s.faceIdBuffer[a]=i}static getVertices(t,e,s){const i=t.positionBuffer.buffer,r=4*e,o=s.verticesAmount-e;return new Float32Array(i,r,o)}static getEvent(t,e,s){return(i,r,o)=>{const a=t.indexBuffer;a[e.indices++]=i+s/3,a[e.indices++]=r+s/3,a[e.indices++]=o+s/3}}static processBuffers(t,e,s,i,r,o){for(let a=0;a<t;a++)this.processPositionBuffer(s,e,a,i,r),this.processNormalbuffer(s,o,a,i),this.updateBufferData(i)}static getHoles(t,e,s,i,r){if(t&&t.has(e)){const o=t.get(e),a=[];for(const l of o.indices)a.push(l+s);return this.setHolesBuffers(i,o,r),a}}static setHolesBuffers(t,e,s){const i=t.positionBuffer,r=t.normalBuffer;i.set(e.points,s.verticesAmount);const o=e.points.length;s.verticesAmount+=o,s.vertices+=o/3,r.set(e.normals,s.normalsAmount),s.normalsAmount+=o}static updateBufferData(t){t.vertices+=1,t.verticesAmount+=3,t.normalsAmount+=3}static processPositionBuffer(t,e,s,i,r){const o=t.positionBuffer;for(let a=0;a<3;a++){const l=3*e[s];o[i.verticesAmount+a]=r[l+a]}}static triangulate(t,e,s,i,r,o){const a=this.getHoles(t,e,s,i,r),l=I0.getVertices(i,o,r),c=$C.getEarcutDimensions(this._tempVec),h=this.getEvent(i,r,o);pN(l,a,3,c[0],c[1],h)}static processNormals(t,e,s,i=0){e.set(0,0,0);for(let r=0;r<s;r++){const o=i+3*r,a=i+3*((r+1)%s),l=t[o+0],c=t[a+0],h=t[o+1],u=t[a+1],p=t[o+2],d=t[a+2];e.x+=(h-u)*(p+d),e.y+=(p-d)*(l+c),e.z+=(l-c)*(h+u)}e.normalize()}static processNormalbuffer(t,e,s,i){const r=t.normalBuffer,o=3*s,a=e[o],l=e[o+1],c=e[o+2];r.set([a,l,c],i.normalsAmount)}};O(cT,"_tempVec",new F);let hT=cT;const ss=class{static create(t,e,s,i,r,o,a){this.setAllVectors(t,e),this.getIsConvex()?this.processConvexFace4(r,o,s,a):hT.create(t,e,s,i,r,void 0,o,a)}static setAllVectors(t,e){this.setVector(t,e,this.a,0),this.setVector(t,e,this.b,1),this.setVector(t,e,this.c,2),this.setVector(t,e,this.d,3),this.getCrossVectors()}static processConvexFace4(t,e,s,i){this.processIndices(t,e),this.processPoints(t,e),this.processNormal(t,e,s),this.setFaceId(t,e,i),this.updateData(e)}static setFaceId(t,e,s){const i=t.faceIdBuffer;for(let r=e.vertices;r<e.vertices+4;r++)i[r]=s}static getIsConvex(){return this.h.dot(this.i)>0}static getCrossVectors(){this.e.copy(this.b),this.f.copy(this.c),this.g.copy(this.d),this.e.sub(this.a),this.f.sub(this.a),this.g.sub(this.a),this.h.crossVectors(this.e,this.f),this.i.crossVectors(this.f,this.g)}static updateData(t){t.normalsAmount+=this.totalIncrease,t.vertices+=this.vertexIncrease,t.verticesAmount+=this.totalIncrease}static processPoints(t,e){let s=0;const i=t.positionBuffer,r=e.verticesAmount;for(let o=0;o<this.vertexIncrease;o++){const a=this._vecs[o];i[r+s++]=a.x,i[r+s++]=a.y,i[r+s++]=a.z}}static setVector(t,e,s,i){const r=3*t[i],o=e[r],a=e[r+1],l=e[r+2];s.set(o,a,l)}static processNormal(t,e,s){const i=t.normalBuffer,r=e.normalsAmount;for(let o=0;o<this.totalIncrease;o++)i[r+o]=s[o]}static processIndices(t,e){const s=t.indexBuffer;for(let i=0;i<this.indexIncrease;i++){const r=this._convexIndices[i];s[e.indices+i]=e.vertices+r}e.indices+=this.indexIncrease}};O(ss,"a",new F),O(ss,"b",new F),O(ss,"c",new F),O(ss,"d",new F),O(ss,"e",new F),O(ss,"f",new F),O(ss,"g",new F),O(ss,"h",new F),O(ss,"i",new F),O(ss,"_vecs",[ss.a,ss.b,ss.c,ss.d]),O(ss,"_convexIndices",[0,1,3,3,1,2]),O(ss,"totalIncrease",12),O(ss,"indexIncrease",6),O(ss,"vertexIncrease",4);let xN=ss;const C0=class tm{static create(t,e,s,i,r,o){this.setFaceIds(r,i,o),this.setIndices(i,r),this.setPoints(t,i,r,e),this.setNormals(i,r,s),this.updateData(r)}static setFaceIds(t,e,s){const i=t.verticesAmount/3,r=i+3;for(let o=i;o<r;o++)e.faceIdBuffer[o]=s}static setNormals(t,e,s){const i=t.normalBuffer;for(let r=0;r<this.totalIncrease;r++)i[e.normalsAmount+r]=s[r]}static setPoints(t,e,s,i){let r=0;const o=e.positionBuffer;for(let a=0;a<this.vertexIncrease;a++){const l=t[a]*this.vertexIncrease;for(let c=0;c<this.vertexIncrease;c++)o[s.verticesAmount+r]=i[l+c],r++}}static setIndices(t,e){const s=t.indexBuffer;for(let i=0;i<this.vertexIncrease;i++)s[e.indices+i]=e.vertices+i;e.indices+=this.vertexIncrease}static updateData(t){t.normalsAmount+=tm.totalIncrease,t.vertices+=tm.vertexIncrease,t.verticesAmount+=tm.totalIncrease}};O(C0,"vertexIncrease",3),O(C0,"totalIncrease",9);let IN=C0,CN=class{constructor(){O(this,"point",new rs),O(this,"_shellHole",new Ga),O(this,"_bigShellHole",new Ya),O(this,"interiorProfiles",new Map),O(this,"normalsAvgInterior",new Int16Array),O(this,"_pointsPerProfile",new Map),O(this,"_shellProfile",new Do),O(this,"_bigShellProfile",new Mo),O(this,"_normalsAvg",new Int16Array),O(this,"_normals",[]),O(this,"_indices",0),O(this,"_sizes",{vertices:0,indices:0,verticesAmount:0,normalsAmount:0,normals:0}),O(this,"_tileData"),O(this,"_nextFaceId",1),O(this,"nextBuffer",(t=>{this.setTileData(t),this.initializeIndices(),this.initializePositions(),this.initializeNormals(),this.initializeFaceIds(),this.initializeSizes(),this._indices++}))}construct(t,e){this.resetConstructData(e),this.getPointsPerWire(t);const s=Zt.getBuffer(t);this.newShellInteriorProfiles(t),this.constructShell(t,s,e),this._tileData=void 0}getIntProfileNormalsAvg(t,e){const s=this.getTempHole(t).indicesArray();this.normalsAvgInterior=Zt.computeNormalsAvg(s,e,this._normals,this._pointsPerProfile)}saveInteriorProfile(t){const e=this.getTempHole(t).profileId();if(this.interiorProfiles.has(e))return this.saveExistingInteriorProfile(e),e;const s=this.getNewIntProfileData();return this.interiorProfiles.set(e,s),e}computeNormalsAvg(t,e,s){if(!this.isShell(t))return;const i=this._normals,r=this._pointsPerProfile;this._normalsAvg=Zt.computeNormalsAvg(e,s,i,r)}isShell(t){return t instanceof ji}getPointsPerWire(t){this.isShell(t)&&(Zt.getNormalsOfShellProfile(t,this._normals),this._pointsPerProfile=Zt.getPointsShell(t))}getIndices(t,e){const s=this.getTempProfile(t);return Zt.getProfile(t,e,s),s.indicesArray()}resetConstructData(t){this._indices=0,this._tileData=void 0,this.nextBuffer(t),this._normals.length=0}initializeIndices(){const t=this._tileData.indexCount;this._tileData.indexBuffer=new Uint16Array(t)}constructFace4(t,e,s){const i=this.getNextFaceId();xN.create(t,e,this._normalsAvg,s,this._tileData,this._sizes,i)}initializeSizes(){this._sizes.vertices=0,this._sizes.indices=0,this._sizes.verticesAmount=0,this._sizes.normalsAmount=0,this._sizes.normals=0}getInteriorProfileBuffer(t,e){const s=this.getTempHole(t).indicesLength();if(this.isShell(t))for(let i=0;i<s;i++)this.getIntProfilePoints(i,t,e),this.getIntProfileNormals(e,i)}constructProfile(t,e,s,i){const r=this.getTempProfile(e).indicesLength(),o=!this.interiorProfiles.has(t);if(r===w0.three&&o)return void this.constructFace3(s,i);r===w0.four&&o?this.constructFace4(s,i,t):this.constructFaceX(s,i,t)}getIntProfileNormals(t,e){const s=3*e,i=this.normalsAvgInterior[s],r=this.normalsAvgInterior[s+1],o=this.normalsAvgInterior[s+2];t.normals.push(i,r,o)}saveExistingInteriorProfile(t){const e=this.interiorProfiles.get(t),s=e.points.length/3;e.indices.push(s),this.interiorProfiles.set(t,e)}getNewIntProfileData(){return{indices:[0],points:[],normals:[]}}constructFace3(t,e){const s=this.getNextFaceId();IN.create(t,e,this._normalsAvg,this._tileData,this._sizes,s)}getIntProfilePoints(t,e,s){const i=this.getTempHole(e).indices(t);e.points(i,this.point);const r=this.point.x(),o=this.point.y(),a=this.point.z();s.points.push(r,o,a)}manageMemory(t,e){const s=this.getTempProfile(t).indicesLength();this._sizes.verticesAmount/3+s>qa&&this.nextBuffer(e)}initializeFaceIds(){const t=this._tileData.positionCount;this._tileData.faceIdBuffer=new Uint32Array(t/3)}getNextFaceId(){return this._nextFaceId++}newShellInteriorProfiles(t){this.interiorProfiles.clear();const e=Zt.getHolesLength(t),s=this.getTempHole(t);for(let i=0;i<e;i++){Zt.getHole(t,i,s);const r=this.saveInteriorProfile(t),o=this.interiorProfiles.get(r);this.getIntProfileNormalsAvg(t,r),this.getInteriorProfileBuffer(t,o)}return this.interiorProfiles}initializePositions(){const t=this._tileData.positionCount;this._tileData.positionBuffer=new Float32Array(t)}initializeNormals(){const t=this._tileData.normalCount;this._tileData.normalBuffer=new Int16Array(t)}setTileData(t){Array.isArray(t)?this._tileData=t[this._indices]:this._tileData=t}constructShell(t,e,s){const i=Zt.getProfilesLength(t);for(let r=0;r<i;r++){const o=this.getIndices(t,r);this.computeNormalsAvg(t,o,r),this.constructProfile(r,t,o,e),this.manageMemory(t,s)}}constructFaceX(t,e,s){const i=this.getNextFaceId();hT.create(t,e,this._normalsAvg,s,this._tileData,this.interiorProfiles,this._sizes,i)}getTempProfile(t){return t.type()===ms.BIG?this._bigShellProfile:this._shellProfile}getTempHole(t){return t.type()===ms.BIG?this._bigShellHole:this._shellHole}},TN=class{constructor(t){O(this,"a",new F),O(this,"b",new F),O(this,"c",new F),O(this,"d",new F),O(this,"e",new F),O(this,"f",new F),O(this,"g",new F),O(this,"h",new F),O(this,"i",new F),O(this,"j",new F),O(this,"k",new F),O(this,"tempTriangle",new ns),O(this,"tempPlane",new Wt),O(this,"includedVertices",[]),O(this,"interiorProfiles",new Map),O(this,"_meshes"),this._meshes=t}faceRaycast(t,e){const s=Zt.getShell(this._meshes,t);this.resetData(),this.getInteriorProfiles(s);const i=Zt.getBuffer(s);return this.processAllCollisions(s,i,e),this.includedVertices}resetVectors(){this.a.set(0,0,0),this.b.set(0,0,0),this.c.set(0,0,0),this.d.set(0,0,0)}resetData(){this.includedVertices.length=0,this.interiorProfiles.clear()}getInteriorProfiles(t){const e=Zt.getHolesLength(t);for(let s=0;s<e;s++){const i=Zt.getHole(t,s).profileId();this.interiorProfiles.has(i)||this.interiorProfiles.set(i,[]),this.interiorProfiles.get(i).push(s)}}processTriangle(t,e,s){const i=3*t[0],r=3*t[1],o=3*t[2];this.saveTriPoint(this.e,e,i),this.saveTriPoint(this.f,e,r),this.saveTriPoint(this.g,e,o);const a=this.triangleHit(s);if(a){const l=this.getTriangleBuffer(e,t);a.facePoints=l.points,a.faceIndices=l.indices,this.includedVertices.push(a)}}processAllCollisions(t,e,s){const i=Zt.getProfilesLength(t);for(let r=0;r<i;r++){this.resetVectors();const o=this.getIndices(t,r);this.getValidCollision(o,e,s,r,t)&&this.processCollision(t,r,e,o)}}saveTriPoint(t,e,s){const i=e[s],r=e[s+1],o=e[s+2];t.set(i,r,o)}getIndices(t,e){return Zt.getProfile(t,e).indicesArray()}getIsTriangle(t){return t.length===3}getNormal(){this.tempTriangle.a=this.e,this.tempTriangle.b=this.f,this.tempTriangle.c=this.g;const t=new F;return this.tempTriangle.getNormal(t),t}isHole(t,e,s){if(this.interiorProfiles.has(t)){const i=this.interiorProfiles.get(t);return this.holeContains(i,e,s)}return!1}computeNormal(t,e){this.d.set(0,0,0);const s=e.length;for(let i=0;i<s;i++){const r=(i+1)%s,o=3*e[i],a=3*e[r];this.processNormal(t,o,a)}this.d.normalize()}holeContains(t,e,s){const i=t.length;for(let r=0;r<i;r++){const o=Zt.getHole(e,t[r]).indicesArray();if(this.polygonContains(s,o))return!0}return!1}triangleHit(t){const e=this.e,s=this.f,i=this.g;if(!t.intersectTriangle(e,s,i,!1,this.h))return;const r=this.getNormal();return{point:this.h.clone(),normal:r}}getValidCollision(t,e,s,i,r){return this.getIsTriangle(t)?(this.processTriangle(t,e,s),!1):this.getCollidesPlane(t,e,s)?!this.isHole(i,r,e):!1}processCollision(t,e,s,i){if(!this.polygonContains(s,i))return;const r=this.b.clone(),o=this.tempPlane.normal.clone(),a=this.getFaceBuffer(t,e,s);this.includedVertices.push({point:r,normal:o,facePoints:a.points,faceIndices:a.indices})}newOrthoNormalBasis(){const t=this.tempPlane.normal,e=this.j,s=this.i;if(Math.abs(t.x)>=Math.abs(t.y)){const i=1/Math.sqrt(t.x*t.x+t.z*t.z),r=-t.z*i,o=0,a=t.x*i;e.set(r,o,a);const l=t.y*e.z,c=t.z*e.x-t.x*e.z,h=-t.y*e.x;s.set(l,c,h)}else{const i=1/Math.sqrt(t.y*t.y+t.z*t.z),r=0,o=t.z*i,a=-t.y*i;e.set(r,o,a);const l=t.y*e.z-t.z*e.y,c=-t.x*e.z,h=t.x*e.y;s.set(l,c,h)}e.normalize(),s.normalize()}polygonContains(t,e){let s=!1;this.newOrthoNormalBasis(),this.setPolyContainVec(e,t);let i=this.k.dot(this.i),r=this.k.dot(this.j);for(let o=0;o<e.length;o++){const a=3*e[o],l=t[a],c=t[a+1],h=t[a+2];this.k.set(l,c,h),this.k.sub(this.b);const u=this.k.dot(this.i),p=this.k.dot(this.j);p>0!=r>0&&(i-u)*-p/(r-p)+u>0&&(s=!s),i=u,r=p}return s}processNormal(t,e,s){const i=t[e+0],r=t[s+0],o=t[e+1],a=t[s+1],l=t[e+2],c=t[s+2];this.d.x+=(o-a)*(l+c),this.d.y+=(l-c)*(i+r),this.d.z+=(i-r)*(o+a)}getCollidesPlane(t,e,s){const i=3*t[0],r=e[i],o=e[i+1],a=e[i+2];return this.a.set(r,o,a),this.computeNormal(e,t),this.tempPlane.setFromNormalAndCoplanarPoint(this.d,this.a),s.intersectPlane(this.tempPlane,this.b)}setPolyContainVec(t,e){const s=3*t[t.length-1],i=e[s],r=e[s+1],o=e[s+2];this.k.set(i,r,o),this.k.sub(this.b)}getTriangleBuffer(t,e){const s=[],i=[];for(let r=0;r<e.length;r++){const o=3*e[r];s.push(t[o],t[o+1],t[o+2]),i.push(r)}return{points:new Float32Array(s),indices:i}}getFaceBuffer(t,e,s){const i=Zt.getProfileIndices(t,e),{outer:r,inners:o}=i,a=[];for(let _=0;_<r.length;_++){const y=3*r[_];a.push(s[y],s[y+1],s[y+2])}const l=[];for(let _=0;_<o.length;_++){const y=o[_];l.push(a.length/3);for(let v=0;v<y.length;v++){const w=3*y[v];a.push(s[w],s[w+1],s[w+2])}}const c=new F,h=new F,u=new F;c.set(a[0],a[1],a[2]),h.set(a[3],a[4],a[5]),u.set(a[6],a[7],a[8]);const p=new ns;p.set(c,h,u);const d=new F;p.getNormal(d);const[g,m]=$C.getEarcutDimensions(d),b=[];for(let _=0;_<a.length;_+=3){const y=[a[_],a[_+1],a[_+2]];b.push(y[g],y[m])}const f=TC(b,l);return{points:new Float32Array(a),indices:f}}},AN=class{constructor(t){O(this,"_meshes"),O(this,"_minAngle",Math.PI/32),O(this,"_shellProfile",new Do),O(this,"_bigShellProfile",new Mo),O(this,"_tempV1",new F),O(this,"_tempV2",new F),O(this,"_tempPoint",new F),O(this,"_normals",[]),O(this,"_pointsByProfile",new Map),O(this,"_shell",new ji),O(this,"_result",[]),this._meshes=t}lineRaycast(t,e,s){return this.resetData(t),this.lineRaycastItems(e,s),this._result}lineRaycastItems(t,e){const s=Zt.getProfilesLength(this._shell);for(let i=0;i<s;i++){const r=this.getTempProfile(this._shell);Zt.getProfile(this._shell,i,r),this.lineRaycastProfile(t,e,i)}}resetData(t){this._shell=Zt.getShell(this._meshes,t),this._normals.length=0,Zt.getNormalsOfShellProfile(this._shell,this._normals),this._pointsByProfile=Zt.getPointsShell(this._shell),this._result=[]}lineRaycastProfile(t,e,s){const i=this.getTempProfile(this._shell),r=i.indicesLength();for(let o=0;o<r;o++){const a=i.indices(o),l=this.getSecondIndex(o,r);this.cast(a,l,t,e,s)&&this.saveResult(s)}}isInvalidAngle(t,e,s){const i=this.getProfile(t,e,s);if(!i.length)return!0;const r=this._normals[i[0]],o=this._normals[s];return r.dot(o)>Math.cos(this._minAngle)}getProfile(t,e,s){const i=this._pointsByProfile.get(t),r=this._pointsByProfile.get(e),o=[];for(const a of i)r.indexOf(a)!==-1&&a!==s&&o.push(a);return o}cast(t,e,s,i,r){return Zt.point(this._shell,t,this._tempV1),Zt.point(this._shell,e,this._tempV2),this.raycastSegment(s),i.containsPoint(this._tempPoint)?!this.isInvalidAngle(t,e,r):!1}saveResult(t){const e=this._tempV1.clone(),s=this._tempV2.clone(),i=this._normals[t],r=this._tempPoint.clone();this._result.push({point:r,normal:i,snappedEdgeP1:e,snappedEdgeP2:s})}getSecondIndex(t,e){const s=t===e-1,i=this.getTempProfile(this._shell);return s?i.indices(0):i.indices(t+1)}raycastSegment(t){t.distanceSqToSegment(this._tempV1,this._tempV2,void 0,this._tempPoint)}getTempProfile(t){return t.type()===ms.BIG?this._bigShellProfile:this._shellProfile}},SN=class{constructor(t){O(this,"_meshes"),O(this,"_tempVec",new F),this._meshes=t}pointRaycast(t,e){const s=Zt.getShell(this._meshes,t),i=[];return this.cast(s,e,i),i}cast(t,e,s){const i=t.pointsLength();for(let r=0;r<i;r++){if(Zt.point(t,r,this._tempVec),!e.containsPoint(this._tempVec))continue;const o=this._tempVec.clone();s.push({point:o})}}},ON=class extends oT{constructor(){super(...arguments),O(this,"_lodClass",Oa.AABB),O(this,"_objectClass",zs.SHELL),O(this,"_representationClass",Ur.SHELL),O(this,"_templates",new dN),O(this,"_constructor",new CN),O(this,"_faceRaycaster",new TN(this.meshes)),O(this,"_lineRaycaster",new AN(this.meshes)),O(this,"_pointRaycaster",new SN(this.meshes))}fetchMeshes(t,e){const s=this.getMesh(t,jt.GEOMETRY);return this.constructMesh(s,e,t),s}newMeshTemplate(t){return this._templates.newMeshTemplate(t)}lineRaycast(t,e,s){return this._lineRaycaster.lineRaycast(t,e,s)}faceRaycast(t,e){return this._faceRaycaster.faceRaycast(t,e)}raycast(t,e){return this._faceRaycaster.faceRaycast(t,e)}pointRaycast(t,e,s){return this._pointRaycaster.pointRaycast(t,s)}setupTemplates(){for(let t=0,e=this.meshes.shellsLength();t<e;t++){const s=Zt.getShell(this.meshes,t);this.useMesh(t,this.newMeshTemplate(s),jt.GEOMETRY)}}getRepresentation(){return this._representationClass}getObjectClass(){return this._objectClass}getLodClass(){return this._lodClass}isVoidMesh(t){return Array.isArray(t)?t[0].positionBuffer===void 0:t.positionBuffer===void 0}constructMesh(t,e,s){if(!this.isVoidMesh(t)||!e)return;const i=Zt.getShell(this.meshes,s);this._constructor.construct(i,t),this.saveMesh(s,t,jt.GEOMETRY)}},Bt=class{static circleCurve3Divisions(t){const e=t.aperture()*t.radius()*4,s=Math.round(e);return Math.min(Math.max(s,4),32)}static traverseCircleCurve(t,e,s){const i=t.circleCurvesLength();for(let r=0;r<i;r++){this.getAllCircleCurveData(t,r);const o=s(this._circleCurve);this._circlePoints.length=o-2,this.getCircleCurveMids(o),this.getNewCircleCurveData(),e(this._circleP1,this._circlePoints,this._circleP2)}}static traverseWireSets(t,e){const s=t.wireSetsLength();for(let i=0;i<s;i++)t.wireSets(i,this._wireSet),this.traverseWireSetWires(e)}static raycastCircleExtr(t,e,s,i){const r=e.distanceTo(t);return this.setupCircleExtrusionAxes(e,t),this.setupCircleExtrusionTransform(t,i),this.setupCircleExtrusionRay(s),this.computeCircleExtrusionRaycast(r,i)}static traverseWires(t,e){const s=t.wiresLength();for(let i=0;i<s;i++)t.wires(i,this._wire),this.setWire(),e(this._wireP1,this._wireP2)}static getNewCircleCurveData(){this._circleP2.copy(this._circleP1);const t=this._circleCurve.aperture(),e=this._circleCurve.radius();this._circleP2.applyAxisAngle(this._circleOrientation,t),this._circleP2.multiplyScalar(e),this._circleP2.add(this._circleOrigin),this._circleP1.multiplyScalar(e),this._circleP1.add(this._circleOrigin)}static setWire(){this.setWirePoint("p1",this._wireP1),this.setWirePoint("p2",this._wireP2)}static getCircleCurveMids(t){const e=this._circlePoints.length;for(let s=0;s<e;s++)this._circlePoints[s]=this.newCirclePoint(s,t)}static newCirclePoint(t,e){const s=e-1,i=t+1,r=new F;r.copy(this._circleP1);const o=this._circleCurve.radius(),a=this._circleCurve.aperture()*i/s;return r.applyAxisAngle(this._circleOrientation,a),r.multiplyScalar(o),r.add(this._circleOrigin),r}static getAllCircleCurveData(t,e){t.circleCurves(e,this._circleCurve),this.getCircleCurveData(this._circleOrigin,"position"),this.getCircleCurveData(this._circleOrientation,"xDirection"),this.getCircleCurveData(this._circleP1,"yDirection")}static setWirePoint(t,e){this._wire[t](this._floats);const s=this._floats.x(),i=this._floats.y(),r=this._floats.z();e.set(s,i,r)}static getCircleCurveData(t,e){const s=this._circleCurve[e]();this.getVectorData(s,t)}static getVectorData(t,e){const s=t.x(),i=t.y(),r=t.z();e.set(s,i,r)}static traverseWireSetWires(t){const e=this._wireSet.psLength()-1;for(let s=0;s<e;s++)this.getWiresetPoint(this._currentWireSetPoint,s),this.getWiresetPoint(this._nextWireSetPoint,s+1),t(this._currentWireSetPoint,this._nextWireSetPoint)}static getWiresetPoint(t,e){const s=this._wireSet.ps(e);this.getVectorData(s,t)}static setupCircleExtrusionTransform(t,e){this._ceTransform.identity(),this._ceTransform.makeBasis(this._ceAxisX,this._ceAxisY,this._ceAxisZ),this._ceTransform.setPosition(t),this._ceSize.set(e,e,e),this._ceTransform.scale(this._ceSize)}static computeCircleExtrusionRaycastFactors(){const t=this._ceRay.direction,e=this._ceRay.origin,s=t.x*t.x+t.y*t.y,i=2*e.x*t.x+2*e.y*t.y,r=4*s*(e.x*e.x+e.y*e.y-1),o=i*i;if(r>o)return null;const a=2*s,l=Math.sqrt(o-r);return{factorA:(-i+l)/a,factorB:(-i-l)/a}}static computeCircleExtrusionRaycast(t,e){const s=this.computeCircleExtrusionRaycastFactors();if(s===null)return[];const{factorA:i,factorB:r}=s;return this._ceInverseTransform.transpose(),this._ceRaycastPoints=[],this.computeCircleExtrusionRaycastPoints(i,t,e),this.computeCircleExtrusionRaycastPoints(r,t,e),this._ceRaycastPoints}static setupCircleExtrusionRay(t){this._ceInverseTransform.copy(this._ceTransform),this._ceInverseTransform.invert(),this._ceRay.copy(t),this._ceRay.applyMatrix4(this._ceInverseTransform)}static computeCircleExtrusionRaycastPoints(t,e,s){if(!this.checkIfCircleExtrusionClashes(t,e,s))return;this._ceRaycastPoint.applyMatrix4(this._ceTransform);const i=this._ceRaycastPoint.clone();this._ceRaycastPoints.push({point:i})}static setupCircleExtrusionAxes(t,e){this._ceAxisZ.copy(t),this._ceAxisZ.sub(e),this._ceAxisZ.normalize(),this.computeNormal(this._ceAxisZ,this._ceAxisX),this._ceAxisY.crossVectors(this._ceAxisZ,this._ceAxisX)}static computeNormal(t,e){const s=t.dot(this._ceAbsoluteX),i=Math.abs(s)>.9?this._ceAbsoluteZ:this._ceAbsoluteX;e.crossVectors(t,i),e.normalize()}static setupCircleExtrusionRaycastPoint(t){this._ceRaycastPoint.copy(this._ceRay.direction),this._ceRaycastPoint.normalize(),this._ceRaycastPoint.multiplyScalar(t),this._ceRaycastPoint.add(this._ceRay.origin)}static checkIfCircleExtrusionClashes(t,e,s){this.setupCircleExtrusionRaycastPoint(t);const i=e/s,r=this._ceRaycastPoint.z;return r>=0&&r<=i}};O(Bt,"_floats",new rs),O(Bt,"_wire",new fg),O(Bt,"_wireSet",new mg),O(Bt,"_circleCurve",new zd),O(Bt,"_wireP1",new F),O(Bt,"_wireP2",new F),O(Bt,"_circleP1",new F),O(Bt,"_circleP2",new F),O(Bt,"_circleOrigin",new F),O(Bt,"_circleOrientation",new F),O(Bt,"_currentWireSetPoint",new F),O(Bt,"_nextWireSetPoint",new F),O(Bt,"_ceAxisZ",new F),O(Bt,"_ceAxisY",new F),O(Bt,"_ceAxisX",new F),O(Bt,"_ceRaycastPoint",new F),O(Bt,"_ceSize",new F),O(Bt,"_ceAbsoluteX",new F(0,0,1)),O(Bt,"_ceAbsoluteZ",new F(1,0,0)),O(Bt,"_circlePoints",[]),O(Bt,"_ceTransform",new xt),O(Bt,"_ceInverseTransform",new xt),O(Bt,"_ceRay",new $o),O(Bt,"_ceRaycastPoints",[]);const Ve=class sc{static newPaths(t,e){const s=sc.newPathData();return this.fetchCircleCurveData(t,s),this.fetchCircleCurveMids(e,s,t),this.fetchCircleCurveEnds(s,t),this.fetchCircleCurveCuts(s),s.cuts}static getAxisPartSize(t,e,s){const i=t.parts(e),r=t.order(e),o=sc.getAxisPartData(i,s,t,r);return sc.fetchAxisPartSize(s,o),this._axisPartSize}static vertexLength(t,e=200){const s=Math.round(t*e),i=Math.max(s,sc._minSize);return Math.min(i,sc._maxSize)}static setPathVertices(t){const e=this.circleCurvePoints,s=!e,i=e&&e.length!==t;if(s||i){this.circleCurvePoints=[];for(let r=0;r<t;r++){const o=2*Math.PI*r/t,a=Math.sin(o),l=Math.cos(o),c=new F(a,l,0);this.circleCurvePoints.push(c)}}}static fetchCircleCurveEnds(t,e){t.last.copy(t.first),t.last.applyAxisAngle(t.axis,e.aperture()),t.last.multiplyScalar(e.radius()),t.last.add(t.center),t.first.multiplyScalar(e.radius()),t.first.add(t.center)}static getAxisPartData(t,e,s,i){return{[$e.WIRE]:this.getAxisPartWireData,[$e.WIRE_SET]:this.getAxisPartWireSetData,[$e.CIRCLE_CURVE]:this.getAxisPartCircleCurveData}[t](s,i,e)}static newEmptyAxisPartData(){return{indices:0,points:0,faces:0,links:0}}static fetchCircleCurveMids(t,e,s){const i=t-2;for(let r=0;r<i;r++){const o=new F;o.copy(e.first);const a=s.aperture()*(r+1)/(t-1);o.applyAxisAngle(e.axis,a),o.multiplyScalar(s.radius()),o.add(e.center),e.mids[r]=o}}static validSize(t,e,s){return qa>=t+e+s}static fetchCircleCurveCuts(t){t.cuts.push(t.first),t.cuts.push(...t.mids),t.cuts.push(t.last)}static fetchCircleCurveData(t,e){const s=t.position();e.center.set(s.x(),s.y(),s.z());const i=t.xDirection();e.axis.set(i.x(),i.y(),i.z());const r=t.yDirection();e.first.set(r.x(),r.y(),r.z())}static newPathData(){return{axis:new F,cuts:[],center:new F,last:new F,first:new F,mids:[]}}static fetchAxisPartSize(t,e){const s=t-2,i=e.faces*s*3,r=e.links*t*this._wireSize;this._axisPartSize.verticesLength=e.points,this._axisPartSize.indicesLength=e.indices+i+r}};O(Ve,"up",new F(0,0,1)),O(Ve,"circleCurves",[]),O(Ve,"circleCurvePoints"),O(Ve,"temp",{circleExtrusion:new Hi,circleCurve:new zd,wireSet:new mg,axis:new hs,rotation:new Pe,vector:new F}),O(Ve,"_wireSize",6),O(Ve,"_minSize",6),O(Ve,"_maxSize",30),O(Ve,"_axisPartSize",{verticesLength:0,indicesLength:0}),O(Ve,"getAxisPartWireSetData",((n,t,e)=>{const s=Ve.newEmptyAxisPartData();n.wireSets(t,Ve.temp.wireSet);const i=Ve.temp.wireSet.psLength()-1;return s.points=2*i*e,s.indices=Ve._wireSize*i*e,s.faces=2*i,s})),O(Ve,"getAxisPartWireData",((n,t,e)=>{const s=Ve.newEmptyAxisPartData();return s.points=2*e,s.indices=Ve._wireSize*e,s.faces=2,s})),O(Ve,"getAxisPartCircleCurveData",((n,t,e)=>{const s=Ve.newEmptyAxisPartData();n.circleCurves(t,Ve.temp.circleCurve);const i=Bt.circleCurve3Divisions(Ve.temp.circleCurve),r=e*i;s.points=r;const o=e*(i-1),a=Ve._wireSize*o;return s.indices=a,s.faces=2,s.links=2,s}));let Et=Ve,PN=class{constructor(){O(this,"_minLinkDistance",1e-8),O(this,"_first",new F),O(this,"_last",new F),O(this,"_currentPoint"),O(this,"_currentIndex"),O(this,"_v1",new F),O(this,"_v2",new F),O(this,"_v3",new F),O(this,"_v4",new F),O(this,"_tempLine",new qt),O(this,"_total",0),O(this,"_closest",0),O(this,"_result",0)}newTemplate(t,e,s){const i=t.radius(e),r=t.axes(e,Et.temp.axis),o=Et.vertexLength(i);let a=s[s.length-1];const l=r.orderLength();for(let c=0;c<l;c++)a=this.generateTemplate(r,c,o,a,s)}construct(t,e){const s={};let i=0;for(let r=0,o=t.axesLength();r<o;r++){const a=t.radius(r);t.axes(r,Et.temp.axis);const l=Et.vertexLength(a);i=this.constructVce(l,s,void 0,i,0,e,a)}}getTemplateCreationData(t,e,s){const i=!t;let r=!1;if(!i){const o=t.positionCount/3,a=e.verticesLength;r=Et.validSize(o,a,s)}return{isStart:i,fits:r}}generateTemplate(t,e,s,i,r){const o=Et.getAxisPartSize(t,e,s),{isStart:a,fits:l}=this.getTemplateCreationData(i,o,s);return(a||!l)&&(i=this.newTemplateData(),r.push(i),this.savePrevious(a,e,s,i)),i.positionCount+=3*o.verticesLength,i.normalCount+=3*o.verticesLength,i.indexCount+=o.indicesLength,i}savePrevious(t,e,s,i){if(!t&&e!==0){const r=3*(s-2);i.positionCount+=3*s,i.normalCount+=3*s,i.indexCount+=r}}constructNewVce(t,e,s,i,r,o,a){const l=!t;let c=!1;if(!l){const h=e.verticesLength;c=Et.validSize(s,h,i)}if(l||!c){t=r[o++],this.setupNewVceBuffers(t);const h=this._currentPoint;if(s=this.clearOffset(s),!l&&a!==0){const u=r[o-2];this.getClone(u,t,h,i),s+=i}}return{data:t,pointAmount:s,position:o}}constructVce(t,e,s,i,r,o,a){const l=Et.temp.axis.orderLength();for(let c=0;c<l;c++){const h=Et.temp.axis,u=Et.getAxisPartSize(h,c,t);this.setupLink(c,e),{data:s,pointAmount:i,position:r}=this.constructNewVce(s,u,i,t,o,r,c),this.newAxisPart(Et.temp.axis,c,s,a,t,e),i+=u.verticesLength}return i}newTemplateData(){return{objectClass:zs.SHELL,indexCount:0,positionCount:0,normalCount:0}}setupNewVceBuffers(t){t.positionBuffer=new Float32Array(t.positionCount),t.normalBuffer=new Int16Array(t.normalCount),t.indexBuffer=new Uint16Array(t.indexCount)}clearOffset(t){return this._currentPoint=0,this._currentIndex=0,0}getClone(t,e,s,i){for(let r=-3*i;r<0;r++){const o=e.positionBuffer,a=t.positionBuffer,l=e.normalBuffer,c=t.normalBuffer;o[this._currentPoint]=a[s+r],l[this._currentPoint]=c[s+r],this._currentPoint++}}manageAxisPartCreation(t,e,s,i,r,o,a){if(t!==$e.CIRCLE_CURVE)if(t!==$e.WIRE_SET){if(t===$e.WIRE){const l=e.wires(s);this.newWire(l,i,r,o,a)}}else{const l=e.wireSets(s);this.newWireSet(l,i,r,o,a)}else{const l=e.circleCurves(s);this.newCircleCurve(l,i,r,o,a)}}newWireSetStart(t,e,s,i){t===1?this.linkStart(e,s,i,this._first,$e.WIRE_SET):this.newPathOrderData(e,s)}newWireSet(t,e,s,i,r){for(let o=1,a=t.psLength();o<a;o++){const l=Et.temp.rotation;this.getWireSetPoints(t,o),this.setWireSetVector(),this.newPath(this._first,e,l,s,i),this.newWireSetStart(o,s,i,r),this.newPath(this._last,e,l,s,i),this.fillWireSetData(o,a,r,s,i),this.linkPaths(s,i)}}fillWireSetData(t,e,s,i,r){t!==e-1||s.last?this.newPathOrderData(i,r,!0):(s.placement=this._last,s.axisClass=$e.WIRE_SET)}setWireSetVector(){Et.temp.vector.copy(this._last),Et.temp.vector.sub(this._first),Et.temp.vector.normalize(),Et.temp.rotation.setFromUnitVectors(Et.up,Et.temp.vector)}newCircleCurveBody(t,e,s,i){const r=t-2;for(let o=0;o<r;o++){const a=Et.circleCurves[o],l=Et.circleCurves[o+1],c=Et.circleCurves[o+2],h=Et.temp.vector;h.copy(c),h.sub(a),h.normalize(),Et.temp.rotation.setFromUnitVectors(Et.up,h),this.newPath(l,e,Et.temp.rotation,s,i),this.linkPaths(s,i,!0)}}newCircleCurveFinish(t,e,s,i,r){const o=t-2,a=t-1,l=Et.circleCurves[o],c=Et.circleCurves[a],h=Et.temp.vector;h.copy(c),h.sub(l),h.normalize(),Et.temp.rotation.setFromUnitVectors(Et.up,h),this.newPath(c,e,Et.temp.rotation,s,i),r.last?this.newPathOrderData(s,i,!0):(r.placement=Et.circleCurves[a],r.axisClass=$e.CIRCLE_CURVE)}setupLink(t,e){t===0&&(e.first=!0),t===Et.temp.axis.orderLength()-1&&(e.last=!0)}newCircleCurveStart(t,e,s,i){const r=Et.circleCurves[0],o=Et.circleCurves[1],a=Et.temp.vector;a.copy(o),a.sub(r),a.normalize(),Et.temp.rotation.setFromUnitVectors(Et.up,a),this.newPath(r,t,Et.temp.rotation,e,s);const l=$e.CIRCLE_CURVE;this.linkStart(e,s,i,r,l)}getWireSetPoints(t,e){const s=t.ps(e-1);this._first.set(s.x(),s.y(),s.z());const i=t.ps(e);this._last.set(i.x(),i.y(),i.z())}finishWire(t,e,s,i){this.newPath(this._last,t,Et.temp.rotation,e,s),i.last?this.newPathOrderData(e,s,!0):(i.placement=this._last,i.axisClass=$e.WIRE),this.linkPaths(e,s)}linkPaths(t,e,s=!1){const i=e,{p1:r,p2:o,p3:a}=this.getPathPositions(i,s,t),l=t.indexBuffer;for(let c=0;c<i;c++){const h=(c+1)%i,{i3:u,i4:p,i1:d,i2:g}=this.getLinkPathIndices(a,c,r,i,h,o);l[this._currentIndex++]=u,l[this._currentIndex++]=p,l[this._currentIndex++]=d,l[this._currentIndex++]=d,l[this._currentIndex++]=p,l[this._currentIndex++]=g}}startWire(t,e,s,i){this.newPath(this._first,t,Et.temp.rotation,e,s);const r=$e.WIRE;this.linkStart(e,s,i,this._first,r)}setupWireVectors(){const t=Et.temp.vector;t.copy(this._last),t.sub(this._first),t.normalize(),Et.temp.rotation.setFromUnitVectors(Et.up,t)}getLinkPathIndices(t,e,s,i,r,o){let a=0,l=0,c=0,h=0;return a=t+e>=s?t+e-i:t+e,l=t+r>=s?t+r-i:t+r,c=o+e>=s+i?o+e-i:o+e,h=o+r>=s+i?o+r-i:o+r,{i3:c,i4:h,i1:a,i2:l}}fetchWirePoints(t){const e=t.p1(),s=t.p2();this._first.set(e.x(),e.y(),e.z()),this._last.set(s.x(),s.y(),s.z())}findLinkedVertex(t,e,s,i,r){for(let o=t;o<e;o++){this.point(o,s,this._v1);const a=o-i+r,l=a>=t?a-i:a;this.point(l,s,this._v2);const c=a+1>=t?a+1-i:a+1;this.point(c,s,this._v3),this._tempLine.set(this._v2,this._v3),this._tempLine.closestPointToPoint(this._v1,!0,this._v4),this._total+=this._v4.distanceTo(this._v1)}}newPath(t,e,s,i,r){Et.setPathVertices(r);for(let o=0;o<r;o++)this.setPathPosition(o,e,s,t,i),this.setPathNormal(o,s,i),this._currentPoint+=3}linkStart(t,e,s,i,r){if(s.first)return void this.newPathOrderData(t,e);const o=$e.CIRCLE_CURVE,a=s.axisClass===o||r===o,l=s.placement.distanceToSquared(i)<this._minLinkDistance;if(!a||!l)return this.newPathOrderData(t,e,!0,!0),void this.newPathOrderData(t,e);this.linkPaths(t,e,!0)}setPathPosition(t,e,s,i,r){const o=Et.temp.vector;o.copy(Et.circleCurvePoints[t]),o.multiplyScalar(e),o.applyQuaternion(s),o.add(i);const a=r.positionBuffer,l=this._currentPoint,c=this._currentPoint+1,h=this._currentPoint+2;a[l]=o.x,a[c]=o.y,a[h]=o.z}newWire(t,e,s,i,r){this.fetchWirePoints(t),this.setupWireVectors(),this.startWire(e,s,i,r),this.finishWire(e,s,i,r)}newCircleCurve(t,e,s,i,r){const o=Bt.circleCurve3Divisions(t);Et.circleCurves=Et.newPaths(t,o),this.newCircleCurveStart(e,s,i,r),this.newCircleCurveBody(o,e,s,i),this.newCircleCurveFinish(o,e,s,i,r),this.linkPaths(s,i,!0)}newPathOrderData(t,e,s=!1,i=!1){const r=e-2,o=t.indexBuffer;for(let a=0;a<r;a++){const l=this._currentPoint/3,c=e*(i?2:1),h=l-c;o[this._currentIndex]=h,this._currentIndex++;const u=l+a+(s?2:1)-c;o[this._currentIndex]=u,this._currentIndex++;const p=l+a+(s?1:2)-c;o[this._currentIndex]=p,this._currentIndex++}}getPathPositions(t,e,s){const i=this._currentPoint/3-t,r=i;let o=i-t;return e&&(o=this.fetchLinkedVertex(i,s,t)),{p3:o,p1:i,p2:r}}newAxisPart(t,e,s,i,r,o){const a=t.parts(e),l=t.order(e);this.manageAxisPartCreation(a,t,l,i,s,r,o),o.first=!1,o.last=!1}fetchLinkedVertex(t,e,s){this._closest=Number.MAX_VALUE;for(let i=0;i<s;i++){this._total=0;const r=t+s;this.findLinkedVertex(t,r,e,s,i),this._total<this._closest&&(this._closest=this._total,this._result=t-s+i+1)}return this._result}setPathNormal(t,e,s){const i=Et.temp.vector,r=Et.circleCurvePoints[t];i.copy(r),i.applyQuaternion(e);const o=s.normalBuffer,a=this._currentPoint,l=this._currentPoint+1,c=this._currentPoint+2;o[a]=i.x*Hu,o[l]=i.y*Hu,o[c]=i.z*Hu}point(t,e,s){const i=e.positionBuffer,r=3*t+1,o=3*t+2,a=i[3*t],l=i[r],c=i[o];return s.set(a,l,c),s}},RN=class{constructor(t){O(this,"_meshes"),O(this,"_results",[]),O(this,"_circleExtrusion",new Hi),O(this,"_axis",new hs),this._meshes=t}raycast(t,e){this._results.length=0,this._meshes.circleExtrusions(t,this._circleExtrusion);for(let s=0,i=this._circleExtrusion.axesLength();s<i;s++){this._circleExtrusion.axes(s,this._axis);const r=this._circleExtrusion.radius(s);this.traverseAllCurves(e,r)}return this._results}getTraverseWiresEvent(t,e){return(s,i)=>{this.castCurveExtrusion(s,i,t,e)}}castCurveExtrusion(t,e,s,i){const r=Bt.raycastCircleExtr(t,e,s,i);for(const o of r)this._results.push(o)}getTraverseCircleCurveEvent(t,e){return(s,i,r)=>{const o=i[0];this.castCurveExtrusion(s,o,t,e);for(let l=0;l<i.length;l++){if(l===0)continue;const c=i[l-1],h=i[l];this.castCurveExtrusion(c,h,t,e)}const a=i[i.length-1];this.castCurveExtrusion(a,r,t,e)}}traverseAllCurves(t,e){const s=this.getTraverseWiresEvent(t,e);Bt.traverseWires(this._axis,s);const i=this.getTraverseCircleCurveEvent(t,e),r=Bt.circleCurve3Divisions;Bt.traverseCircleCurve(this._axis,i,r);const o=this.getTraverseWiresEvent(t,e);Bt.traverseWireSets(this._axis,o)}},FN=class{constructor(t){O(this,"_meshes"),O(this,"_found",[]),O(this,"_circleExtrusion",new Hi),O(this,"_axis",new hs),O(this,"_wirePoint",new F),this._meshes=t}lineRaycast(t,e){this._found.length=0,this._meshes.circleExtrusions(t,this._circleExtrusion);const s=this._circleExtrusion.axesLength();for(let i=0;i<s;i++)this._circleExtrusion.axes(i,this._axis),this.processLineRaycast(i,e);return this._found}wireSetRaycast(t,e){const s=this._axis;Bt.traverseWireSets(s,((i,r)=>{this.cylinderRaycast(i,r,t,e)}))}exclusiveCylinderRaycast(t,e){const s=this._axis,i=this.getCylinderRaycastEvent(t,e);Bt.traverseWires(s,i)}processLineRaycast(t,e){const s=this._circleExtrusion.radius(t);this.exclusiveCylinderRaycast(e,s),this.circleCurveRaycast(e,s),this.wireSetRaycast(e,s)}getCylinderRaycastEvent(t,e){return(s,i)=>{this.cylinderRaycast(s,i,t,e)}}processCircleCurveBody(t,e,s){for(let i=0;i<t.length;i++){if(i===0)continue;const r=t[i],o=t[i-1];this.cylinderRaycast(o,r,e,s)}}getCircleCurveRaycastEvent(t,e){return(s,i,r)=>{this.cylinderRaycast(s,i[0],t,e),this.processCircleCurveBody(i,t,e);const o=i[i.length-1];this.cylinderRaycast(o,r,t,e)}}fetchCylinderRaycastResult(t,e,s){t.distanceSqToSegment(e,s,void 0,this._wirePoint);const i=this.newResult(e,s);this._found.push(i)}circleCurveRaycast(t,e){const s=Bt.circleCurve3Divisions,i=this.getCircleCurveRaycastEvent(t,e);Bt.traverseCircleCurve(this._axis,i,s)}newResult(t,e){return{point:this._wirePoint.clone(),raySquaredDistance:void 0,snappedEdgeP1:t.clone(),snappedEdgeP2:e.clone()}}cylinderRaycast(t,e,s,i){const r=Bt.raycastCircleExtr(t,e,s,i);for(const o of r)o.point&&this.fetchCylinderRaycastResult(s,t,e)}},LN=class{constructor(t){O(this,"_meshes"),O(this,"_results",[]),O(this,"_circleExtrusion",new Hi),O(this,"_axis",new hs),O(this,"_normal",new F),O(this,"_point",new F),O(this,"_plane",new Wt),this._meshes=t}pointRaycast(t,e){return this._results.length=0,this._meshes.circleExtrusions(t,this._circleExtrusion),this.traverseAllCircleExtrusions(e),this.getCleanResults()}fetchOrientation(t,e){Et.temp.vector.copy(t),Et.temp.vector.sub(e),Et.temp.vector.normalize(),Et.temp.rotation.setFromUnitVectors(Et.up,Et.temp.vector)}getTraverseWiresEvent(t,e){return(s,i)=>{this.fetchOrientation(s,i);const r=this.raycastCutCircleExtrusion(s,t,e),o=this.raycastCutCircleExtrusion(i,t,e);this._results.push(r,o)}}traverseAllCircleExtrusions(t){const e=this._circleExtrusion.axesLength();for(let s=0;s<e;s++){this._circleExtrusion.axes(s,this._axis);const i=this._circleExtrusion.radius(s),r=Et.vertexLength(i);Et.setPathVertices(r),this.traverseAllCurves(t,i)}}setupCuttedCircleExtrusion(t){this._normal.set(0,0,1),this._normal.applyQuaternion(Et.temp.rotation),this._plane.setFromNormalAndCoplanarPoint(this._normal,t)}getTraverseCircleCurveEvent(t,e){return(s,i,r)=>{this.fetchOrientation(s,i[0]);const o=this.raycastCutCircleExtrusion(s,t,e),a=i[i.length-1];this.fetchOrientation(a,r);const l=this.raycastCutCircleExtrusion(r,t,e);this._results.push(o,l)}}computeCutCircleExtrCast(t,e,s){if(s.intersectPlane(this._plane,this._point),this._point.distanceTo(t)<=e)return{point:t.clone()}}raycastCutCircleExtrusion(t,e,s){if(this.setupCuttedCircleExtrusion(t),e.intersectsPlane(this._plane))return this.computeCutCircleExtrCast(t,s,e)}getCleanResults(){const t=[];for(const e of this._results)e&&t.push(e);return t}traverseAllCurves(t,e){const s=this.getTraverseWiresEvent(t,e);Bt.traverseWires(this._axis,s);const i=this.getTraverseCircleCurveEvent(t,e),r=Bt.circleCurve3Divisions;Bt.traverseCircleCurve(this._axis,i,r);const o=this.getTraverseWiresEvent(t,e);Bt.traverseWireSets(this._axis,o)}},$N=class{constructor(){O(this,"_currentElement",0),O(this,"_wireSize",6),O(this,"newCircleCurveLod",((t,e,s)=>{const i=this.newCircleCurveLodPath(t,e),r=s.positionBuffer;for(let o=1;o<i;o++){const a=Et.circleCurves[o-1],l=Et.circleCurves[o];this.newWire(r,a,l)}})),O(this,"newWireSetLod",((t,e,s)=>{const i=t.wireSets(e),r=i.psLength(),o=s.positionBuffer;for(let a=1;a<r;a++){const l=i.ps(a-1),c=i.ps(a);this.newWire(o,l,c)}})),O(this,"newWireTemplate",((t,e)=>{e.positionCount+=this._wireSize})),O(this,"newWireSetTemplate",((t,e)=>{const s=Et.temp.axis.wireSets(t,Et.temp.wireSet).psLength()-1;e.positionCount+=this._wireSize*s})),O(this,"newWireLod",((t,e,s)=>{const i=t.wires(e),r=i.p1(),o=i.p2(),a=s.positionBuffer;this.newWire(a,r,o)})),O(this,"newCircleCurveTemplate",((t,e)=>{const s=Et.temp.axis.circleCurves(t,Et.temp.circleCurve),i=Bt.circleCurve3Divisions(s);e.positionCount+=this._wireSize*(i-1)}))}construct(t,e){this._currentElement=0,e.positionBuffer=new Float32Array(e.positionCount);for(let s=0,i=t.axesLength();s<i;s++)t.axes(s,Et.temp.axis),this.constructLod(e);return e}constructCircleExtrusionLod(t,e){const s=Et.temp.axis,i=s.parts(t),r=s.order(t);this.getLodConstructor(i)(s,r,e)}newCircleCurveLodPath(t,e){const s=t.circleCurves(e),i=Bt.circleCurve3Divisions(s);return Et.circleCurves=Et.newPaths(s,i),i}selectNextWire(){this._currentElement+=this._wireSize}getAxisPartVertexSize(t,e){const s=Et.temp.axis,i=s.parts(t),r=s.order(t);this.getTemplateConstructor(i)(r,e)}getIndices(){return{i1:this._currentElement,i2:this._currentElement+1,i3:this._currentElement+2,i4:this._currentElement+3,i5:this._currentElement+4,i6:this._currentElement+5}}setAxisTemplate(t,e){Et.temp.circleExtrusion.axes(t,Et.temp.axis);const s=Et.temp.axis.partsLength();for(let i=0;i<s;i++)this.getAxisPartVertexSize(i,e);this.setAxisThickness(e,t)}constructLod(t){const e=Et.temp.axis.orderLength();for(let s=0;s<e;s++)this.constructCircleExtrusionLod(s,t)}getLodConstructor(t){return{[$e.WIRE]:this.newWireLod,[$e.WIRE_SET]:this.newWireSetLod,[$e.CIRCLE_CURVE]:this.newCircleCurveLod}[t]}newTemplate(){const t=Et.temp.circleExtrusion,e=this.newTemplateData(),s=t.axesLength();for(let i=0;i<s;i++)this.setAxisTemplate(i,e);return e}setAxisThickness(t,e){const s=t.lodThickness,i=Et.temp.circleExtrusion.radius(e);t.lodThickness=Math.max(s,i)}newTemplateData(){return{objectClass:zs.LINE,lod:jt.WIRES,lodThickness:0,positionCount:0}}getTemplateConstructor(t){return{[$e.WIRE]:this.newWireTemplate,[$e.WIRE_SET]:this.newWireSetTemplate,[$e.CIRCLE_CURVE]:this.newCircleCurveTemplate}[t]}newWire(t,e,s){const i=e instanceof F?e.x:e.x(),r=e instanceof F?e.y:e.y(),o=e instanceof F?e.z:e.z(),a=s instanceof F?s.x:s.x(),l=s instanceof F?s.y:s.y(),c=s instanceof F?s.z:s.z(),{i1:h,i2:u,i3:p,i4:d,i5:g,i6:m}=this.getIndices();t[h]=i,t[u]=r,t[p]=o,t[d]=a,t[g]=l,t[m]=c,this.selectNextWire()}},NN=class extends oT{constructor(){super(...arguments),O(this,"_vceConstructor",new PN),O(this,"_lodConstructor",new $N),O(this,"_vceRaycaster",new RN(this.meshes)),O(this,"_vceLineRaycaster",new FN(this.meshes)),O(this,"_vcePointRaycaster",new LN(this.meshes)),O(this,"_representationClass",Ur.CIRCLE_EXTRUSION),O(this,"_objectClass",zs.LINE),O(this,"lodClass",Oa.CUSTOM)}setupTemplates(){const t=this.meshes.circleExtrusionsLength();for(let e=0;e<t;e++)this.newCircleExtrusionTemplate(e)}fetchLod(t,e){const s=this.getMesh(t,jt.WIRES);return this.generateLodIfNeeded(t,e,s),s}fetchMeshes(t,e){const s=this.getMesh(t,jt.GEOMETRY);return this.generateMeshesIfNeeded(t,e,s),s}raycast(t,e){return this._vceRaycaster.raycast(t,e)}faceRaycast(){return[]}pointRaycast(t,e){return this._vcePointRaycaster.pointRaycast(t,e)}lineRaycast(t,e){return this._vceLineRaycaster.lineRaycast(t,e)}getObjectClass(){return this._objectClass}getRepresentation(){return this._representationClass}getLodClass(){return this.lodClass}newMeshes(t,e){this.meshes.circleExtrusions(t,Et.temp.circleExtrusion);const s=Et.temp.circleExtrusion;this._vceConstructor.construct(s,e),this.saveMesh(t,e,jt.GEOMETRY)}generateMeshesIfNeeded(t,e,s){if(s.length===0)return;const i=!!s.length,r=!s[0].positionBuffer;e&&r&&i&&this.newMeshes(t,s)}newCircleExtrusionTemplate(t){const e=[];this.meshes.circleExtrusions(t,Et.temp.circleExtrusion);const s=Et.temp.circleExtrusion,i=s.axesLength();for(let o=0;o<i;o++)this._vceConstructor.newTemplate(s,o,e);const r=this._lodConstructor.newTemplate();this.useMesh(t,e,jt.GEOMETRY),this.useMesh(t,r,jt.WIRES)}generateLodIfNeeded(t,e,s){!s.positionBuffer&&e&&(this.meshes.circleExtrusions(t,Et.temp.circleExtrusion),this._lodConstructor.construct(Et.temp.circleExtrusion,s),this.saveMesh(t,s,jt.WIRES))}},uT=class{constructor(t){O(this,"size"),O(this,"_data"),O(this,"_highlightData"),this.size=t,this._data=new Uint8Array(t),this._highlightData=new Uint16Array(t),this._data.fill(1)}getHighlight(t){return this._highlightData[t]}setHighlight(t,e){hb.checkMemory(e),this._highlightData[t]=e}clearHighlight(){this._highlightData.fill(0)}visible(t){return hb.check(this._data,t,Om.VISIBLE)}setVisible(t,e){hb.apply(this._data,t,Om.VISIBLE,e)}clearVisible(){this._data.fill(1)}},MN=class{constructor(t,e){O(this,"_rate",64),O(this,"_updater"),O(this,"_modelId"),O(this,"_threshold",16),O(this,"_connection"),O(this,"_list",[]),O(this,"refresh",(()=>{if(this._list.length){const s=this._list;this._connection.fetchMeshCompute(this._modelId,s),this._list=[]}})),this._modelId=t,this._connection=e,this._updater=Da.newUpdater(this.refresh,this._rate)}get needsRefresh(){return this._list.length>this._threshold}dispose(){Da.deleteUpdater(this._updater)}clean(){this._list=Da.cleanRequests(this._list)}process(t){this._list.push(t),this.needsRefresh&&this.refresh()}},dT=class{constructor(t,e,s,i){O(this,"_meshes"),O(this,"_model"),O(this,"_boxes"),O(this,"_tiles"),O(this,"_items"),O(this,"_edgeThreshold",8),O(this,"_raycastMultiplier",32),O(this,"_maxDuration",512),O(this,"_precission",.001),O(this,"_temp",{sample:new Qc,representation:new Xc,tempPlane:new Wt,ray:new $o,frustum:new No,m1:new xt,m2:new xt,m3:new xt,v1:new F,planes:[]}),this._model=t,this._boxes=e,this._tiles=s,this._items=i,this._meshes=t.meshes()}static cast(t,e,s,i,r){const o=e.id();return r===Ws.FACE?t.faceRaycast(o,s,i):r===Ws.LINE?t.lineRaycast(o,s,i):r===Ws.POINT?t.pointRaycast(o,s,i):r===void 0?t.raycast(o,s,i):void 0}raycast(t,e,s){const i={ray:t,frustum:e,planes:s},r=this.castBox(e,s);return r.length?this.computeRaycastList(r,i):null}snapRaycast(t,e,s,i){const r=[],o={ray:t,frustum:e,planes:i},a=this.raycast(t,e,i);return a?(this.getSnaps(a,o,s,r),a.normal?this.filterOnFront(r):r):this.snapCastEdges(o,s)}rectangleRaycast(t,e,s){const i=this._boxes.lookup.collideFrustum(e,t,s),r=this.filterVisible(i);return this.localIdsFromItemIds(r)}snapCastEdges(t,e){const s=[],i=e.includes(Ws.POINT),r=e.includes(Ws.LINE);return(i||r)&&this.computeEdgesCast(t,e,s),this.addDistanceToEdgeResult(s,t.ray),s}filterVisible(t){const e=[];for(const s of t){this._meshes.samples(s,this._temp.sample);const i=this._temp.sample.item();this._items.visible(i)&&e.push(s)}return e}computeSnaps(t,e,s,i){for(const r of t)if(this.isValidSnap(r)){const o={snap:r,...e},a=this.castSample(s,o);for(const l of a)i.push(l)}}computeEdgesCast(t,e,s){const i=this.getRawEdges(t),r=performance.now();for(const o of i)if(this.fetchSampleData(o),this.computeSnaps(e,t,o,s),this.isTimeExceeded(r))break}addDistanceToEdgeResult(t,e){for(const s of t){const i=s.point;s.raySquaredDistance=e.distanceSqToPoint(i)}}getRawEdges(t){const e=this.castBox(t.frustum,t.planes);return e.length<=this._edgeThreshold?e:this.sortBoxes(t.ray,e,this._edgeThreshold)}sortBoxes(t,e,s){const i=[],r=new F,o=t.origin;for(let l=0;l<e.length;l++){const c=e[l],h=this._boxes.get(c);t.intersectBox(h,r);const u=r.distanceToSquared(o);i.push(u)}const a=this.dataSort(e,i);return s&&a.length>s&&a.splice(s),a}castBox(t,e){const s=this._boxes.lookup;if(t instanceof $o){const r=s.collideRay(e,t);return this.filterVisible(r)}const i=s.collideFrustum(e,t);return this.filterVisible(i)}dataSort(t,e){const s=Array.from(t.keys()).sort(((r,o)=>e[r]-e[o])),i=[];for(const r of s){const o=t[r];i.push(o)}return i}localIdsFromItemIds(t){const e=new Set;for(const s of t){this._meshes.samples(s,this._temp.sample);const i=this._temp.sample.item(),r=this._meshes.meshesItems(i);if(r===null)continue;const o=this._model.localIds(r);o!==null&&e.add(o)}return Array.from(e)}getNearest(t){let e=t[0];for(let s=1;s<t.length;s++){const i=t[s];if(e.raySquaredDistance&&i.raySquaredDistance){const r=this.getNearScore(e);this.getNearScore(i)<r&&(e=i)}else i.cameraSquaredDistance<e.cameraSquaredDistance&&(e=i)}return e}getEdges(t,e,s){const i=this.snapCastEdges(t,e);if(i)for(const r of i)s.push(r)}getNearScore(t){const e=this._raycastMultiplier;return t.raySquaredDistance*e+t.cameraSquaredDistance}setupSampleCastData(t){$r.get(this._temp.sample,this._meshes,this._temp.m1),this._temp.m2.copy(this._temp.m1).invert(),this._temp.ray.copy(t.ray).applyMatrix4(this._temp.m2),Ma.transform(t.frustum,this._temp.m2,this._temp.frustum)}addLocalId(t){if(!t)return;const e=this._meshes.meshesItems(t.itemId);e!==null&&(t.localId=this._model.localIds(e))}fetchSampleData(t){this._meshes.samples(t,this._temp.sample);const e=this._temp.sample.representation();this._meshes.representations(e,this._temp.representation)}computeRaycastList(t,e){const s=Array.from(new Set(t)),i=this.sortBoxes(e.ray,s),r=this.castBox(e.ray,e.planes),o=this.findAll(i,r,e);if(o.length){const a=this.getNearest(o);return this.addLocalId(a),a}return null}formatRaycastResult(t,e,s){for(const i of t){if(i.point.applyMatrix4(this._temp.m1),i.normal&&i.normal.transformDirection(this._temp.m1),"facePoints"in i){const o=this._meshes.samples(e,this._temp.sample);$r.get(o,this._meshes,this._temp.m3);for(let a=0;a<i.facePoints.length;a+=3){const l=i.facePoints[a],c=i.facePoints[a+1],h=i.facePoints[a+2];this._temp.v1.set(l,c,h),this._temp.v1.applyMatrix4(this._temp.m3),i.facePoints[a]=this._temp.v1.x,i.facePoints[a+1]=this._temp.v1.y,i.facePoints[a+2]=this._temp.v1.z}}i.sampleId=e,i.itemId=this._temp.sample.item();const r=s.ray.origin.distanceToSquared(i.point);i.cameraSquaredDistance=r,i.snappingClass||(i.snappingClass=s.snap),i.snappedEdgeP1&&i.snappedEdgeP1.applyMatrix4(this._temp.m1),i.snappedEdgeP2&&i.snappedEdgeP2.applyMatrix4(this._temp.m1)}}findAll(t,e,s){const i=[],r=performance.now();for(const o of t){if(this.fetchSampleData(o),!e.includes(o))continue;const a=this.castSample(o,s);for(const l of a)i.push(l);if(this.isTimeExceeded(r))break}return i}isTimeExceeded(t){return performance.now()-t>this._maxDuration}getFilteredSampleCast(t){const e=this._tiles.raycast(this._temp.representation,this._temp.ray,this._temp.frustum,t.snap);if(this._temp.planes.length===0)return e;const s=[];if(e)for(const i of e){const r=this._temp.planes,o=i.point;rd.containedInParallelPlanes(r,o)&&s.push(i)}return s}getSnaps(t,e,s,i){this.fetchSampleData(t.sampleId),t.normal&&(this.setCastSide(t,e.ray),this.setCastPlane(t)),this.getFaces(s,e,t,i),this.getEdges(e,s,i);for(const r of i)this.addLocalId(r)}filterOnFront(t){const e=[];for(const s of t)this._temp.tempPlane.distanceToPoint(s.point)>=0&&e.push(s);return e}setCastSide(t,e){const s=t.point.clone().sub(e.origin);t.normal.dot(s)>0&&t.normal.negate()}getFaces(t,e,s,i){for(const r of t){const o={snap:r,...e},a=this.castSample(s.sampleId,o);for(const l of a)i.push(l)}}setCastPlane(t){const e=this._temp.tempPlane,s=t.point.clone(),i=t.normal.clone();i.multiplyScalar(this._precission),s.sub(i),e.setFromNormalAndCoplanarPoint(t.normal,s)}castSample(t,e){this.setupSampleCastData(e),this.setupPlanesForSampleCast(e);const s=this.getFilteredSampleCast(e);return s&&this.formatRaycastResult(s,t,e),s}isValidSnap(t){const e=t===Ws.LINE,s=t===Ws.POINT;return e||s}transform(t,e){const s=[];if(t)for(const i of t){const r=new Wt().copy(i);r.applyMatrix4(e),s.push(r)}return s}setupPlanesForSampleCast(t){if(this._temp.planes.length=0,t.planes&&t.planes.length>0){const e=this.transform(t.planes,this._temp.m2);for(const s of e)this._temp.planes.push(s)}}};const yc=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,b1=new Set,T0=typeof process=="object"&&process?process:{},pT=(n,t,e,s)=>{typeof T0.emitWarning=="function"?T0.emitWarning(n,t,e,s):console.error(`[${e}] ${t}: ${n}`)};let Nm=globalThis.AbortController,_1=globalThis.AbortSignal;if(Nm===void 0){_1=class{constructor(){O(this,"onabort"),O(this,"_onabort",[]),O(this,"reason"),O(this,"aborted",!1)}addEventListener(e,s){this._onabort.push(s)}},Nm=class{constructor(){O(this,"signal",new _1),t()}abort(e){var s,i;if(!this.signal.aborted){this.signal.reason=e,this.signal.aborted=!0;for(const r of this.signal._onabort)r(e);(i=(s=this.signal).onabort)==null||i.call(s,e)}}};let n=((_w=T0.env)==null?void 0:_w.LRU_CACHE_IGNORE_AC_WARNING)!=="1";const t=()=>{n&&(n=!1,pT("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",t))}}const _o=n=>n&&n===Math.floor(n)&&n>0&&isFinite(n),fT=n=>_o(n)?n<=Math.pow(2,8)?Uint8Array:n<=Math.pow(2,16)?Uint16Array:n<=Math.pow(2,32)?Uint32Array:n<=Number.MAX_SAFE_INTEGER?em:null:null;let em=class extends Array{constructor(t){super(t),this.fill(0)}};const mT=class yu{constructor(t,e){if(O(this,"heap"),O(this,"length"),!q(yu,Au))throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new e(t),this.length=0}static create(t){const e=fT(t);if(!e)return[];Ot(yu,Au,!0);const s=new yu(t,e);return Ot(yu,Au,!1),s}push(t){this.heap[this.length++]=t}pop(){return this.heap[--this.length]}};Au=new WeakMap,kt(mT,Au,!1);let DN=mT;const kN=class gT{constructor(t){kt(this,Yf),kt(this,J_),kt(this,Ir),kt(this,Pr),kt(this,Gf),kt(this,Pu),kt(this,hu),kt(this,ye),kt(this,Zf),kt(this,Zl),kt(this,Fr),kt(this,Tm),kt(this,sr,void 0),kt(this,Di,void 0),kt(this,ir,void 0),kt(this,ql,void 0),kt(this,tr,void 0),kt(this,Su,void 0),kt(this,lu,void 0),O(this,"ttl"),O(this,"ttlResolution"),O(this,"ttlAutopurge"),O(this,"updateAgeOnGet"),O(this,"updateAgeOnHas"),O(this,"allowStale"),O(this,"noDisposeOnSet"),O(this,"noUpdateTTL"),O(this,"maxEntrySize"),O(this,"sizeCalculation"),O(this,"noDeleteOnFetchRejection"),O(this,"noDeleteOnStaleGet"),O(this,"allowStaleOnFetchAbort"),O(this,"allowStaleOnFetchRejection"),O(this,"ignoreFetchAbort"),kt(this,ps,void 0),kt(this,ki,void 0),kt(this,is,void 0),kt(this,Oe,void 0),kt(this,zt,void 0),kt(this,si,void 0),kt(this,zi,void 0),kt(this,js,void 0),kt(this,Ss,void 0),kt(this,lr,void 0),kt(this,Os,void 0),kt(this,nr,void 0),kt(this,rr,void 0),kt(this,Bi,void 0),kt(this,or,void 0),kt(this,Ta,void 0),kt(this,ii,void 0),kt(this,cu,void 0),kt(this,cc,(()=>{})),kt(this,ho,(()=>{})),kt(this,xm,(()=>{})),kt(this,Ui,(()=>!1)),kt(this,hc,(S=>{})),kt(this,Ou,((S,P,M)=>{})),kt(this,Im,((S,P,M,T)=>{if(M||T)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0})),O(this,wC,"LRUCache");const{max:e=0,ttl:s,ttlResolution:i=1,ttlAutopurge:r,updateAgeOnGet:o,updateAgeOnHas:a,allowStale:l,dispose:c,onInsert:h,disposeAfter:u,noDisposeOnSet:p,noUpdateTTL:d,maxSize:g=0,maxEntrySize:m=0,sizeCalculation:b,fetchMethod:f,memoMethod:_,noDeleteOnFetchRejection:y,noDeleteOnStaleGet:v,allowStaleOnFetchRejection:w,allowStaleOnFetchAbort:I,ignoreFetchAbort:C}=t;if(e!==0&&!_o(e))throw new TypeError("max option must be a nonnegative integer");const A=e?fT(e):Array;if(!A)throw new Error("invalid max value: "+e);if(Ot(this,sr,e),Ot(this,Di,g),this.maxEntrySize=m||q(this,Di),this.sizeCalculation=b,this.sizeCalculation){if(!q(this,Di)&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(_!==void 0&&typeof _!="function")throw new TypeError("memoMethod must be a function if defined");if(Ot(this,lu,_),f!==void 0&&typeof f!="function")throw new TypeError("fetchMethod must be a function if specified");if(Ot(this,Su,f),Ot(this,Ta,!!f),Ot(this,is,new Map),Ot(this,Oe,new Array(e).fill(void 0)),Ot(this,zt,new Array(e).fill(void 0)),Ot(this,si,new A(e)),Ot(this,zi,new A(e)),Ot(this,js,0),Ot(this,Ss,0),Ot(this,lr,DN.create(e)),Ot(this,ps,0),Ot(this,ki,0),typeof c=="function"&&Ot(this,ir,c),typeof h=="function"&&Ot(this,ql,h),typeof u=="function"?(Ot(this,tr,u),Ot(this,Os,[])):(Ot(this,tr,void 0),Ot(this,Os,void 0)),Ot(this,or,!!q(this,ir)),Ot(this,cu,!!q(this,ql)),Ot(this,ii,!!q(this,tr)),this.noDisposeOnSet=!!p,this.noUpdateTTL=!!d,this.noDeleteOnFetchRejection=!!y,this.allowStaleOnFetchRejection=!!w,this.allowStaleOnFetchAbort=!!I,this.ignoreFetchAbort=!!C,this.maxEntrySize!==0){if(q(this,Di)!==0&&!_o(q(this,Di)))throw new TypeError("maxSize must be a positive integer if specified");if(!_o(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");Ct(this,J_,vC).call(this)}if(this.allowStale=!!l,this.noDeleteOnStaleGet=!!v,this.updateAgeOnGet=!!o,this.updateAgeOnHas=!!a,this.ttlResolution=_o(i)||i===0?i:1,this.ttlAutopurge=!!r,this.ttl=s||0,this.ttl){if(!_o(this.ttl))throw new TypeError("ttl must be a positive integer if specified");Ct(this,Yf,K_).call(this)}if(q(this,sr)===0&&this.ttl===0&&q(this,Di)===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!q(this,sr)&&!q(this,Di)){const S="LRU_CACHE_UNBOUNDED";(P=>!b1.has(P))(S)&&(b1.add(S),pT("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",S,gT))}}static unsafeExposeInternals(t){return{starts:q(t,rr),ttls:q(t,Bi),sizes:q(t,nr),keyMap:q(t,is),keyList:q(t,Oe),valList:q(t,zt),next:q(t,si),prev:q(t,zi),get head(){return q(t,js)},get tail(){return q(t,Ss)},free:q(t,lr),isBackgroundFetch:e=>{var s;return Ct(s=t,ye,we).call(s,e)},backgroundFetch:(e,s,i,r)=>{var o;return Ct(o=t,hu,qf).call(o,e,s,i,r)},moveToTail:e=>{var s;return Ct(s=t,Zl,uu).call(s,e)},indexes:e=>{var s;return Ct(s=t,Ir,io).call(s,e)},rindexes:e=>{var s;return Ct(s=t,Pr,uo).call(s,e)},isStale:e=>{var s;return q(s=t,Ui).call(s,e)}}}get max(){return q(this,sr)}get maxSize(){return q(this,Di)}get calculatedSize(){return q(this,ki)}get size(){return q(this,ps)}get fetchMethod(){return q(this,Su)}get memoMethod(){return q(this,lu)}get dispose(){return q(this,ir)}get onInsert(){return q(this,ql)}get disposeAfter(){return q(this,tr)}getRemainingTTL(t){return q(this,is).has(t)?1/0:0}*entries(){for(const t of Ct(this,Ir,io).call(this))q(this,zt)[t]===void 0||q(this,Oe)[t]===void 0||Ct(this,ye,we).call(this,q(this,zt)[t])||(yield[q(this,Oe)[t],q(this,zt)[t]])}*rentries(){for(const t of Ct(this,Pr,uo).call(this))q(this,zt)[t]===void 0||q(this,Oe)[t]===void 0||Ct(this,ye,we).call(this,q(this,zt)[t])||(yield[q(this,Oe)[t],q(this,zt)[t]])}*keys(){for(const t of Ct(this,Ir,io).call(this)){const e=q(this,Oe)[t];e===void 0||Ct(this,ye,we).call(this,q(this,zt)[t])||(yield e)}}*rkeys(){for(const t of Ct(this,Pr,uo).call(this)){const e=q(this,Oe)[t];e===void 0||Ct(this,ye,we).call(this,q(this,zt)[t])||(yield e)}}*values(){for(const t of Ct(this,Ir,io).call(this))q(this,zt)[t]===void 0||Ct(this,ye,we).call(this,q(this,zt)[t])||(yield q(this,zt)[t])}*rvalues(){for(const t of Ct(this,Pr,uo).call(this))q(this,zt)[t]===void 0||Ct(this,ye,we).call(this,q(this,zt)[t])||(yield q(this,zt)[t])}[Symbol.iterator](){return this.entries()}find(t,e={}){for(const s of Ct(this,Ir,io).call(this)){const i=q(this,zt)[s],r=Ct(this,ye,we).call(this,i)?i.__staleWhileFetching:i;if(r!==void 0&&t(r,q(this,Oe)[s],this))return this.get(q(this,Oe)[s],e)}}forEach(t,e=this){for(const s of Ct(this,Ir,io).call(this)){const i=q(this,zt)[s],r=Ct(this,ye,we).call(this,i)?i.__staleWhileFetching:i;r!==void 0&&t.call(e,r,q(this,Oe)[s],this)}}rforEach(t,e=this){for(const s of Ct(this,Pr,uo).call(this)){const i=q(this,zt)[s],r=Ct(this,ye,we).call(this,i)?i.__staleWhileFetching:i;r!==void 0&&t.call(e,r,q(this,Oe)[s],this)}}purgeStale(){let t=!1;for(const e of Ct(this,Pr,uo).call(this,{allowStale:!0}))q(this,Ui).call(this,e)&&(Ct(this,Fr,Io).call(this,q(this,Oe)[e],"expire"),t=!0);return t}info(t){const e=q(this,is).get(t);if(e===void 0)return;const s=q(this,zt)[e],i=Ct(this,ye,we).call(this,s)?s.__staleWhileFetching:s;if(i===void 0)return;const r={value:i};if(q(this,Bi)&&q(this,rr)){const o=q(this,Bi)[e],a=q(this,rr)[e];if(o&&a){const l=o-(yc.now()-a);r.ttl=l,r.start=Date.now()}}return q(this,nr)&&(r.size=q(this,nr)[e]),r}dump(){const t=[];for(const e of Ct(this,Ir,io).call(this,{allowStale:!0})){const s=q(this,Oe)[e],i=q(this,zt)[e],r=Ct(this,ye,we).call(this,i)?i.__staleWhileFetching:i;if(r===void 0||s===void 0)continue;const o={value:r};if(q(this,Bi)&&q(this,rr)){o.ttl=q(this,Bi)[e];const a=yc.now()-q(this,rr)[e];o.start=Math.floor(Date.now()-a)}q(this,nr)&&(o.size=q(this,nr)[e]),t.unshift([s,o])}return t}load(t){this.clear();for(const[e,s]of t){if(s.start){const i=Date.now()-s.start;s.start=yc.now()-i}this.set(e,s.value,s)}}set(t,e,s={}){var i,r,o,a,l,c,h;if(e===void 0)return this.delete(t),this;const{ttl:u=this.ttl,start:p,noDisposeOnSet:d=this.noDisposeOnSet,sizeCalculation:g=this.sizeCalculation,status:m}=s;let{noUpdateTTL:b=this.noUpdateTTL}=s;const f=q(this,Im).call(this,t,e,s.size||0,g);if(this.maxEntrySize&&f>this.maxEntrySize)return m&&(m.set="miss",m.maxEntrySizeExceeded=!0),Ct(this,Fr,Io).call(this,t,"set"),this;let _=q(this,ps)===0?void 0:q(this,is).get(t);if(_===void 0)_=q(this,ps)===0?q(this,Ss):q(this,lr).length!==0?q(this,lr).pop():q(this,ps)===q(this,sr)?Ct(this,Pu,Cm).call(this,!1):q(this,ps),q(this,Oe)[_]=t,q(this,zt)[_]=e,q(this,is).set(t,_),q(this,si)[q(this,Ss)]=_,q(this,zi)[_]=q(this,Ss),Ot(this,Ss,_),e0(this,ps)._++,q(this,Ou).call(this,_,f,m),m&&(m.set="add"),b=!1,q(this,cu)&&((i=q(this,ql))==null||i.call(this,e,t,"add"));else{Ct(this,Zl,uu).call(this,_);const y=q(this,zt)[_];if(e!==y){if(q(this,Ta)&&Ct(this,ye,we).call(this,y)){y.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:v}=y;v===void 0||d||(q(this,or)&&((r=q(this,ir))==null||r.call(this,v,t,"set")),q(this,ii)&&((o=q(this,Os))==null||o.push([v,t,"set"])))}else d||(q(this,or)&&((a=q(this,ir))==null||a.call(this,y,t,"set")),q(this,ii)&&((l=q(this,Os))==null||l.push([y,t,"set"])));if(q(this,hc).call(this,_),q(this,Ou).call(this,_,f,m),q(this,zt)[_]=e,m){m.set="replace";const v=y&&Ct(this,ye,we).call(this,y)?y.__staleWhileFetching:y;v!==void 0&&(m.oldValue=v)}}else m&&(m.set="update");q(this,cu)&&((c=this.onInsert)==null||c.call(this,e,t,e===y?"update":"replace"))}if(u===0||q(this,Bi)||Ct(this,Yf,K_).call(this),q(this,Bi)&&(b||q(this,xm).call(this,_,u,p),m&&q(this,ho).call(this,m,_)),!d&&q(this,ii)&&q(this,Os)){const y=q(this,Os);let v;for(;v=y?.shift();)(h=q(this,tr))==null||h.call(this,...v)}return this}pop(){var t;try{for(;q(this,ps);){const e=q(this,zt)[q(this,js)];if(Ct(this,Pu,Cm).call(this,!0),Ct(this,ye,we).call(this,e)){if(e.__staleWhileFetching)return e.__staleWhileFetching}else if(e!==void 0)return e}}finally{if(q(this,ii)&&q(this,Os)){const e=q(this,Os);let s;for(;s=e?.shift();)(t=q(this,tr))==null||t.call(this,...s)}}}has(t,e={}){const{updateAgeOnHas:s=this.updateAgeOnHas,status:i}=e,r=q(this,is).get(t);if(r!==void 0){const o=q(this,zt)[r];if(Ct(this,ye,we).call(this,o)&&o.__staleWhileFetching===void 0)return!1;if(!q(this,Ui).call(this,r))return s&&q(this,cc).call(this,r),i&&(i.has="hit",q(this,ho).call(this,i,r)),!0;i&&(i.has="stale",q(this,ho).call(this,i,r))}else i&&(i.has="miss");return!1}peek(t,e={}){const{allowStale:s=this.allowStale}=e,i=q(this,is).get(t);if(i===void 0||!s&&q(this,Ui).call(this,i))return;const r=q(this,zt)[i];return Ct(this,ye,we).call(this,r)?r.__staleWhileFetching:r}async fetch(t,e={}){const{allowStale:s=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:r=this.noDeleteOnStaleGet,ttl:o=this.ttl,noDisposeOnSet:a=this.noDisposeOnSet,size:l=0,sizeCalculation:c=this.sizeCalculation,noUpdateTTL:h=this.noUpdateTTL,noDeleteOnFetchRejection:u=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:p=this.allowStaleOnFetchRejection,ignoreFetchAbort:d=this.ignoreFetchAbort,allowStaleOnFetchAbort:g=this.allowStaleOnFetchAbort,context:m,forceRefresh:b=!1,status:f,signal:_}=e;if(!q(this,Ta))return f&&(f.fetch="get"),this.get(t,{allowStale:s,updateAgeOnGet:i,noDeleteOnStaleGet:r,status:f});const y={allowStale:s,updateAgeOnGet:i,noDeleteOnStaleGet:r,ttl:o,noDisposeOnSet:a,size:l,sizeCalculation:c,noUpdateTTL:h,noDeleteOnFetchRejection:u,allowStaleOnFetchRejection:p,allowStaleOnFetchAbort:g,ignoreFetchAbort:d,status:f,signal:_};let v=q(this,is).get(t);if(v===void 0){f&&(f.fetch="miss");const w=Ct(this,hu,qf).call(this,t,v,y,m);return w.__returned=w}{const w=q(this,zt)[v];if(Ct(this,ye,we).call(this,w)){const S=s&&w.__staleWhileFetching!==void 0;return f&&(f.fetch="inflight",S&&(f.returnedStale=!0)),S?w.__staleWhileFetching:w.__returned=w}const I=q(this,Ui).call(this,v);if(!b&&!I)return f&&(f.fetch="hit"),Ct(this,Zl,uu).call(this,v),i&&q(this,cc).call(this,v),f&&q(this,ho).call(this,f,v),w;const C=Ct(this,hu,qf).call(this,t,v,y,m),A=C.__staleWhileFetching!==void 0&&s;return f&&(f.fetch=I?"stale":"refresh",A&&I&&(f.returnedStale=!0)),A?C.__staleWhileFetching:C.__returned=C}}async forceFetch(t,e={}){const s=await this.fetch(t,e);if(s===void 0)throw new Error("fetch() returned undefined");return s}memo(t,e={}){const s=q(this,lu);if(!s)throw new Error("no memoMethod provided to constructor");const{context:i,forceRefresh:r,...o}=e,a=this.get(t,o);if(!r&&a!==void 0)return a;const l=s(t,a,{options:o,context:i});return this.set(t,l,o),l}get(t,e={}){const{allowStale:s=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:r=this.noDeleteOnStaleGet,status:o}=e,a=q(this,is).get(t);if(a!==void 0){const l=q(this,zt)[a],c=Ct(this,ye,we).call(this,l);return o&&q(this,ho).call(this,o,a),q(this,Ui).call(this,a)?(o&&(o.get="stale"),c?(o&&s&&l.__staleWhileFetching!==void 0&&(o.returnedStale=!0),s?l.__staleWhileFetching:void 0):(r||Ct(this,Fr,Io).call(this,t,"expire"),o&&s&&(o.returnedStale=!0),s?l:void 0)):(o&&(o.get="hit"),c?l.__staleWhileFetching:(Ct(this,Zl,uu).call(this,a),i&&q(this,cc).call(this,a),l))}o&&(o.get="miss")}delete(t){return Ct(this,Fr,Io).call(this,t,"delete")}clear(){return Ct(this,Tm,t0).call(this,"delete")}};wC=Symbol.toStringTag,sr=new WeakMap,Di=new WeakMap,ir=new WeakMap,ql=new WeakMap,tr=new WeakMap,Su=new WeakMap,lu=new WeakMap,ps=new WeakMap,ki=new WeakMap,is=new WeakMap,Oe=new WeakMap,zt=new WeakMap,si=new WeakMap,zi=new WeakMap,js=new WeakMap,Ss=new WeakMap,lr=new WeakMap,Os=new WeakMap,nr=new WeakMap,rr=new WeakMap,Bi=new WeakMap,or=new WeakMap,Ta=new WeakMap,ii=new WeakMap,cu=new WeakMap,Yf=new WeakSet,K_=function(){const n=new em(q(this,sr)),t=new em(q(this,sr));Ot(this,Bi,n),Ot(this,rr,t),Ot(this,xm,((i,r,o=yc.now())=>{if(t[i]=r!==0?o:0,n[i]=r,r!==0&&this.ttlAutopurge){const a=setTimeout((()=>{q(this,Ui).call(this,i)&&Ct(this,Fr,Io).call(this,q(this,Oe)[i],"expire")}),r+1);a.unref&&a.unref()}})),Ot(this,cc,(i=>{t[i]=n[i]!==0?yc.now():0})),Ot(this,ho,((i,r)=>{if(n[r]){const o=n[r],a=t[r];if(!o||!a)return;i.ttl=o,i.start=a,i.now=e||s();const l=i.now-a;i.remainingTTL=o-l}}));let e=0;const s=()=>{const i=yc.now();if(this.ttlResolution>0){e=i;const r=setTimeout((()=>e=0),this.ttlResolution);r.unref&&r.unref()}return i};this.getRemainingTTL=i=>{const r=q(this,is).get(i);if(r===void 0)return 0;const o=n[r],a=t[r];return!o||!a?1/0:o-((e||s())-a)},Ot(this,Ui,(i=>{const r=t[i],o=n[i];return!!o&&!!r&&(e||s())-r>o}))},cc=new WeakMap,ho=new WeakMap,xm=new WeakMap,Ui=new WeakMap,J_=new WeakSet,vC=function(){const n=new em(q(this,sr));Ot(this,ki,0),Ot(this,nr,n),Ot(this,hc,(t=>{Ot(this,ki,q(this,ki)-n[t]),n[t]=0})),Ot(this,Im,((t,e,s,i)=>{if(Ct(this,ye,we).call(this,e))return 0;if(!_o(s)){if(!i)throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");if(typeof i!="function")throw new TypeError("sizeCalculation must be a function");if(s=i(e,t),!_o(s))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}return s})),Ot(this,Ou,((t,e,s)=>{if(n[t]=e,q(this,Di)){const i=q(this,Di)-n[t];for(;q(this,ki)>i;)Ct(this,Pu,Cm).call(this,!0)}Ot(this,ki,q(this,ki)+n[t]),s&&(s.entrySize=e,s.totalCalculatedSize=q(this,ki))}))},hc=new WeakMap,Ou=new WeakMap,Im=new WeakMap,Ir=new WeakSet,io=function*({allowStale:n=this.allowStale}={}){if(q(this,ps))for(let t=q(this,Ss);Ct(this,Gf,lb).call(this,t)&&(!n&&q(this,Ui).call(this,t)||(yield t),t!==q(this,js));)t=q(this,zi)[t]},Pr=new WeakSet,uo=function*({allowStale:n=this.allowStale}={}){if(q(this,ps))for(let t=q(this,js);Ct(this,Gf,lb).call(this,t)&&(!n&&q(this,Ui).call(this,t)||(yield t),t!==q(this,Ss));)t=q(this,si)[t]},Gf=new WeakSet,lb=function(n){return n!==void 0&&q(this,is).get(q(this,Oe)[n])===n},Pu=new WeakSet,Cm=function(n){var t,e;const s=q(this,js),i=q(this,Oe)[s],r=q(this,zt)[s];return q(this,Ta)&&Ct(this,ye,we).call(this,r)?r.__abortController.abort(new Error("evicted")):(q(this,or)||q(this,ii))&&(q(this,or)&&((t=q(this,ir))==null||t.call(this,r,i,"evict")),q(this,ii)&&((e=q(this,Os))==null||e.push([r,i,"evict"]))),q(this,hc).call(this,s),n&&(q(this,Oe)[s]=void 0,q(this,zt)[s]=void 0,q(this,lr).push(s)),q(this,ps)===1?(Ot(this,js,Ot(this,Ss,0)),q(this,lr).length=0):Ot(this,js,q(this,si)[s]),q(this,is).delete(i),e0(this,ps)._--,s},hu=new WeakSet,qf=function(n,t,e,s){const i=t===void 0?void 0:q(this,zt)[t];if(Ct(this,ye,we).call(this,i))return i;const r=new Nm,{signal:o}=e;o?.addEventListener("abort",(()=>r.abort(o.reason)),{signal:r.signal});const a={signal:r.signal,options:e,context:s},l=(p,d=!1)=>{const{aborted:g}=r.signal,m=e.ignoreFetchAbort&&p!==void 0;if(e.status&&(g&&!d?(e.status.fetchAborted=!0,e.status.fetchError=r.signal.reason,m&&(e.status.fetchAbortIgnored=!0)):e.status.fetchResolved=!0),g&&!m&&!d)return c(r.signal.reason);const b=h;return q(this,zt)[t]===h&&(p===void 0?b.__staleWhileFetching?q(this,zt)[t]=b.__staleWhileFetching:Ct(this,Fr,Io).call(this,n,"fetch"):(e.status&&(e.status.fetchUpdated=!0),this.set(n,p,a.options))),p},c=p=>{const{aborted:d}=r.signal,g=d&&e.allowStaleOnFetchAbort,m=g||e.allowStaleOnFetchRejection,b=m||e.noDeleteOnFetchRejection,f=h;if(q(this,zt)[t]===h&&(!b||f.__staleWhileFetching===void 0?Ct(this,Fr,Io).call(this,n,"fetch"):g||(q(this,zt)[t]=f.__staleWhileFetching)),m)return e.status&&f.__staleWhileFetching!==void 0&&(e.status.returnedStale=!0),f.__staleWhileFetching;if(f.__returned===f)throw p};e.status&&(e.status.fetchDispatched=!0);const h=new Promise(((p,d)=>{var g;const m=(g=q(this,Su))==null?void 0:g.call(this,n,i,a);m&&m instanceof Promise&&m.then((b=>p(b===void 0?void 0:b)),d),r.signal.addEventListener("abort",(()=>{e.ignoreFetchAbort&&!e.allowStaleOnFetchAbort||(p(void 0),e.allowStaleOnFetchAbort&&(p=b=>l(b,!0)))}))})).then(l,(p=>(e.status&&(e.status.fetchRejected=!0,e.status.fetchError=p),c(p)))),u=Object.assign(h,{__abortController:r,__staleWhileFetching:i,__returned:void 0});return t===void 0?(this.set(n,u,{...a.options,status:void 0}),t=q(this,is).get(n)):q(this,zt)[t]=u,u},ye=new WeakSet,we=function(n){if(!q(this,Ta))return!1;const t=n;return!!t&&t instanceof Promise&&t.hasOwnProperty("__staleWhileFetching")&&t.__abortController instanceof Nm},Zf=new WeakSet,cb=function(n,t){q(this,zi)[t]=n,q(this,si)[n]=t},Zl=new WeakSet,uu=function(n){n!==q(this,Ss)&&(n===q(this,js)?Ot(this,js,q(this,si)[n]):Ct(this,Zf,cb).call(this,q(this,zi)[n],q(this,si)[n]),Ct(this,Zf,cb).call(this,q(this,Ss),n),Ot(this,Ss,n))},Fr=new WeakSet,Io=function(n,t){var e,s,i,r;let o=!1;if(q(this,ps)!==0){const a=q(this,is).get(n);if(a!==void 0)if(o=!0,q(this,ps)===1)Ct(this,Tm,t0).call(this,t);else{q(this,hc).call(this,a);const l=q(this,zt)[a];if(Ct(this,ye,we).call(this,l)?l.__abortController.abort(new Error("deleted")):(q(this,or)||q(this,ii))&&(q(this,or)&&((e=q(this,ir))==null||e.call(this,l,n,t)),q(this,ii)&&((s=q(this,Os))==null||s.push([l,n,t]))),q(this,is).delete(n),q(this,Oe)[a]=void 0,q(this,zt)[a]=void 0,a===q(this,Ss))Ot(this,Ss,q(this,zi)[a]);else if(a===q(this,js))Ot(this,js,q(this,si)[a]);else{const c=q(this,zi)[a];q(this,si)[c]=q(this,si)[a];const h=q(this,si)[a];q(this,zi)[h]=q(this,zi)[a]}e0(this,ps)._--,q(this,lr).push(a)}}if(q(this,ii)&&((i=q(this,Os))!=null&&i.length)){const a=q(this,Os);let l;for(;l=a?.shift();)(r=q(this,tr))==null||r.call(this,...l)}return o},Tm=new WeakSet,t0=function(n){var t,e,s;for(const i of Ct(this,Pr,uo).call(this,{allowStale:!0})){const r=q(this,zt)[i];if(Ct(this,ye,we).call(this,r))r.__abortController.abort(new Error("deleted"));else{const o=q(this,Oe)[i];q(this,or)&&((t=q(this,ir))==null||t.call(this,r,o,n)),q(this,ii)&&((e=q(this,Os))==null||e.push([r,o,n]))}}if(q(this,is).clear(),q(this,zt).fill(void 0),q(this,Oe).fill(void 0),q(this,Bi)&&q(this,rr)&&(q(this,Bi).fill(0),q(this,rr).fill(0)),q(this,nr)&&q(this,nr).fill(0),Ot(this,js,0),Ot(this,Ss,0),q(this,lr).length=0,Ot(this,ki,0),Ot(this,ps,0),q(this,ii)&&q(this,Os)){const i=q(this,Os);let r;for(;r=i?.shift();)(s=q(this,tr))==null||s.call(this,...r)}};let zN=kN;const Ar=class{static get(t){return this._meshes.get(t)}static lockIn(t){Object.seal(t)}static add(t,e){this._meshes.set(t,e)}static delete(t){for(const e of t)this._meshes.delete(e)}static setCapacity(t){t!==this._capacity&&(this._meshes.clear(),this._meshes=this.setupMeshes(t),this._capacity=t)}static setupMeshes(t){const e=Math.max(t??this.computeCapacity(),1),s=this.getSizeCalculationEvent();return new zN({maxSize:e,sizeCalculation:s})}static computeCapacity(){const t=globalThis.navigator&&"deviceMemory"in globalThis.navigator?globalThis.navigator.deviceMemory:null,e=t!==null?t:2,s=this.oneHundredMb*e;return Math.trunc(s)}static getDataSetMemory(t){let e=0;for(const s of t)e+=s.usedMemory;return Math.max(e,1)}static getSizeCalculationEvent(){return t=>Array.isArray(t)?this.getDataSetMemory(t):Math.max(t.usedMemory,1)}};O(Ar,"oneHundredMb",1e8),O(Ar,"_meshes",Ar.setupMeshes()),O(Ar,"_capacity"),O(Ar,"_memoryAttributes",["positionBuffer","indexBuffer","normalBuffer"]),O(Ar,"updateMeshMemory",(n=>{n.usedMemory=0;for(const t of Ar._memoryAttributes)n.usedMemory!==void 0&&n[t]&&(n.usedMemory+=n[t].byteLength);Ar.lockIn(n)}));let ic=Ar;const bT=class sm{constructor(t){O(this,"meshes"),O(this,"tilesUpdated",!1),O(this,"_sampleAmount"),O(this,"_tileDimension"),O(this,"_tileBySample"),O(this,"_lodBySample"),O(this,"_virtualMeshes",new Map),O(this,"_meshConnection"),O(this,"_samples"),O(this,"_tileIdGenerator",new Ky),O(this,"_tiles",new Map),O(this,"_tilesChanged",new Set),O(this,"_sizeByTile",new Map),O(this,"_samplesDimensions"),O(this,"_sampleLodClass"),O(this,"_sampleLodState"),O(this,"_sampleLodSize"),O(this,"_boxes"),O(this,"_items"),O(this,"_materials"),O(this,"_modelId"),O(this,"_lastView",{rotation:new F,location:new F}),O(this,"_params",{updateTime:16,updateSamples:64,updateviewOrientation:8*Math.PI/180,updateViewPosition:256,smallTileSize:.32,mediumTileSize:4,smallObjectSize:2,smallScreenSize:2,mediumScreenSize:4,largeScreenSize:16,tempTileDataSize:6,tileIdIncrement:1,tileSizeMultiplier:10,minTileDimension:32,tileDimensionFactor:8}),O(this,"_temp",{sample:new Qc,representation:new Xc,vector:new F,matrix:new xt,transform:new xt,boundingBox:new Tt,sampleGeometry:{},box:new Tt,raycastPoints:[],tileData:{positionCount:this._params.tempTileDataSize,objectClass:zs.LINE,positionBuffer:new Float32Array(this._params.tempTileDataSize)},tileCenter:new F,tile:{objectClass:zs.LINE,positionCount:6},viewDimension:0,pastFieldOfview:0}),O(this,"_currentSample",0),O(this,"_virtualPlanes",[]),O(this,"_changedSamples",0),O(this,"_virtualView"),this._modelId=t.modelId,this._boxes=t.boxes,this._items=t.items,this._materials=t.materials,this._meshConnection=new MN(t.modelId,t.connection),this.meshes=t.model.meshes(),this._sampleAmount=this.meshes.samplesLength(),this._samples=new uT(this._sampleAmount),this._samplesDimensions=new Int32Array(this._sampleAmount),this._sampleLodClass=new Uint8Array(this._sampleAmount),this._sampleLodState=new Uint8Array(this._sampleAmount),this._sampleLodSize=new Float32Array(this._sampleAmount),this._tileDimension=this.computeTileSize(),this._tileBySample=new Array(this._sampleAmount),this._lodBySample=new Array(this._sampleAmount),this.init()}restart(){this.resetUpdateProcess(),this._meshConnection.clean()}fetchSample(t,e){this.fetchSampleAndRepresentation(t);const s=this.fetchCurrentMesh(),i=this.sampleTemplate(t);return i.geometries=this.sampleGeoms(i,e,s),i}dispose(){this._meshConnection.dispose();for(const[,t]of this._virtualMeshes)t.dispose()}generate(){for(const[,t]of this._virtualMeshes)t.setupTemplates();for(let t=0;t<this._sampleAmount;t++)this.generateSampleInTiles(t);this.setupTileVisibilityAndHighlight()}setupView(t){this._virtualView=t,ic.setCapacity(t.meshThreshold),this.restart(),this.updateOrientationIfNeeded(),this.updatePositionIfNeeded(),this.setupViewPlanes()}updateVirtualMeshes(t){if(t&&this._virtualView){for(const e of t)this.updateItem(e);this.restart()}}getSampleTransform(t){return this.fetchSampleAndRepresentation(t),this.sampleTemplate(t).transform}async update(t){this.updateTiles(t),this.notifyUpdateFinished();for(const e of this._tilesChanged){const s=this._tiles.get(e);this._meshConnection.process({tileRequestClass:Ne.UPDATE,modelId:this._modelId,tileId:e,objectClass:s.objectClass,material:s.materialId,tileData:this.getTileData(s),currentLod:s.lod})}this._tilesChanged.clear()}raycast(t,e,s,i){this._temp.raycastPoints=[];const r=t.representationClass(),o=this._virtualMeshes.get(r);return this.manageRaycast(o,t,e,s,i),this._temp.raycastPoints}init(){const t=new ON(this._modelId,this.meshes),e=t.getRepresentation();this._virtualMeshes.set(e,t);const s=new NN(this._modelId,this.meshes),i=s.getRepresentation();this._virtualMeshes.set(i,s),this.processSamplesDimension(),this.fetchSampleLodSize()}initSampleLod(t){this.fetchSampleAndRepresentation(t);const e=this.fetchCurrentMesh();this._sampleLodClass[t]=e.getLodClass(),this._sampleLodState[t]=jt.INVISIBLE}fetchSampleAndRepresentation(t){this.meshes.samples(t,this._temp.sample),this.meshes.representations(this._temp.sample.representation(),this._temp.representation)}fetchCurrentMesh(){const t=this._temp.representation.representationClass();return this._virtualMeshes.get(t)}fetchCurrentMaterial(){const t=this._temp.sample.material();return this._materials[t]}fetchSampleLodSize(){for(let t=0;t<this._sampleAmount;t++)this.initSampleLod(t),$r.getBox(this._temp.representation,this._temp.box),this._sampleLodSize[t]=LC.getWidth(this._temp.box)}setupTileVisibilityAndHighlight(){for(const[,t]of this._tiles)t.visibilities=new pu(t.size,!1),t.highlights=new pu(t.size,0)}addLodToTile(t,e,s){t.getLodClass()!==Oa.AABB?t.getLodClass()===Oa.CUSTOM&&this.addCustomLodToTile(t,e,s):this.addBoxLodToTile(e,s)}addBoxLodToTile(t,e){this._lodBySample[t]=this.lodTileAppendSample(t,e)}notifyUpdateFinished(){const t=!this.tilesUpdated;this._changedSamples>=this._sampleAmount&&t&&(this._meshConnection.process({tileRequestClass:Ne.FINISH,modelId:this._modelId}),this.tilesUpdated=!0)}updatePositionIfNeeded(){const t=this._params.updateViewPosition,e=this._virtualView.cameraPosition;e.distanceToSquared(this._lastView.location)>t&&(this._currentSample=0,this._lastView.location.copy(e))}updateCurrentSample(){this._currentSample++,this._currentSample>=this._sampleAmount&&(this._currentSample=0),this._changedSamples++}processSamplesDimension(){for(let t=0;t<this._sampleAmount;t++)this._samplesDimensions[t]=t;this._samplesDimensions.sort(((t,e)=>this._boxes.dimensionOf(e)-this._boxes.dimensionOf(t)))}setupViewPlanes(){this._virtualPlanes=[];for(const t of this._virtualView.cameraFrustum.planes)this._virtualPlanes.push(t);if(this._virtualView.clippingPlanes)for(const t of this._virtualView.clippingPlanes)this._virtualPlanes.push(t)}updateOrientationIfNeeded(){const t=this.getCurrentViewOrientation(),e=this._params.updateviewOrientation;t.angleTo(this._lastView.rotation)>e&&(this._currentSample=0,this._lastView.rotation.copy(t))}getCurrentViewOrientation(){return this._virtualView.cameraFrustum.planes[4].normal}resetUpdateProcess(){this._changedSamples=0,this.tilesUpdated=!1}manageRaycast(t,e,s,i,r){const o=dT.cast(t,e,s,i,r);if(o)for(const a of o)a.representationClass=t.getObjectClass(),this._temp.raycastPoints.push(a)}setTileShellBuffer(t){t.usedMemory!==void 0&&t.objectClass===zs.SHELL&&(t.ids=new Float32Array(t.positionCount/3),t.usedMemory+=t.ids.byteLength)}getTileWhenSamplePut(t,e,s){let i=this._tiles.get(t);if(i===void 0){const r=e.lod||jt.GEOMETRY;i=this.newTile(e.objectClass,s,r),this._tiles.set(t,i)}return i}getPerspTrueDim(t,e){const s=Math.PI/180;return e*Math.tan(.5*t*s)}getTileHighlight(t,e){let s,i;const r=t.highlights;if(!r)return{highlightData:void 0,highlightIds:void 0};const o=r.size((a=>a!==0));if(o>0){i=new Uint16Array(o);const a=c=>c!==0,l=(c,h)=>i[c]=h;s=pu.get(r,e,a,l)}return{highlightData:s,highlightIds:i}}setupTileSampleAttributes(t,e,s,i){const r=3*t.vertexLocation[e];for(let o=0;o<s.positionBuffer.length;o+=3)this._temp.vector.fromArray(s.positionBuffer,o),this._temp.vector.applyMatrix4(this._temp.matrix),this._temp.vector.toArray(t.positionBuffer,r+o);if(t.normalBuffer){const o=3*t.vertexLocation[e];for(let a=0;a<s.normalBuffer.length;a+=3)this._temp.vector.fromArray(s.normalBuffer,a),this._temp.vector.transformDirection(this._temp.matrix),this._temp.vector.multiplyScalar(Hu),this._temp.vector.toArray(t.normalBuffer,o+a)}if(t.indexBuffer){const o=t.indexLocation[e],a=t.vertexLocation[e];for(let l=0;l<s.indexCount;l++){const c=s.indexBuffer[l]+a;t.indexBuffer[l+o]=c}}if(t.faceIdBuffer&&s.faceIdBuffer){const o=100*i.sample,a=t.vertexLocation[e],l=a+s.positionCount/3;for(let c=a;c<l;c++)t.faceIdBuffer[c]=s.faceIdBuffer[c-a]+o}if(s.objectClass===zs.SHELL){const o=t.vertexLocation[e],a=o+s.positionCount/3;t.ids.fill(this.itemId(i.sample),o,a)}}getTileVisibility(t,e){if(!t.visibilities)throw new Error("Fragments: Malformed tile!");if(!t.visibilities.fullOf(!1))return pu.get(t.visibilities,e,(s=>s))}memoryOverflow(){return sm._graphicMemoryConsumed>this._virtualView.graphicThreshold}updateMesh(t){let e=this.fetchLodLevel(t);const s=this._sampleLodState[t];e=this.hideHighlightedLods(e,t),e!==s?this.updateVisible(s,e,t):this.updateSampleIfSeen(e,t)}tileLoadSample(t,e,s){const i=t.sampleLocation.get(e.sample),r=this.getSampleGeometries(e,s);this.setupTileLocation(t,r,e),this.fetchSampleTransform(t,e),this.setupTileSampleAttributes(t,i,r,e)}updateSampleIfSeen(t,e){t!==jt.INVISIBLE&&this.updateSample(e,t)}hideHighlightedLods(t,e){return t===jt.WIRES&&this._samples.getHighlight(e)&&(t=jt.INVISIBLE),t}updateVisible(t,e,s){t!==jt.INVISIBLE&&this.makeSampleInvisible(s,t);const i=e!==jt.INVISIBLE;i&&this.updateSample(s,e),this._samples.setVisible(s,i),this._sampleLodState[s]=e}makeInvisibleFromTile(t,e){const s=this._tiles.get(t);this.updateTileData(s,e,!1,0),this.deleteTileIfNeeded(s,t)}updateSample(t,e){const s=this.itemId(t),i=this._items.visible(s),r=this._items.getHighlight(s);this.hasChanged(t,e,i,r)&&this.setSample(t,i,r,e)}hasHighlightChanged(t,e){return e!==this._samples.getHighlight(t)}hasVisibleChanged(t,e){return e!==this._samples.visible(t)}newTile(t,e,s){const i={notVirtual:!1};return i.materialId=e,i.indexLocation=[],i.box=new Tt,i.objectClass=t,i.lod=s,i.normalCount=0,i.indexCount=0,i.vertexLocation=[],i.size=0,i.geometriesLocation=[],i.positionCount=0,i.sampleLocation=new Map,i.faceIdBuffer=new Uint32Array(0),i}createLod(t){const e=$r.boxSize(t),s=this._temp.tileData.positionBuffer;if(!s)throw new Error("Fragments: Malformed tiles!");return s[0]=e.start.x,s[1]=e.start.y,s[2]=e.start.z,s[3]=e.end.x,s[4]=e.end.y,s[5]=e.end.z,this._temp.tileData}sampleTemplate(t){const e=this._temp.sample,s=this._temp.representation;$r.get(e,this.meshes,this._temp.transform),$r.getBox(s,this._temp.boundingBox),this._temp.sampleGeometry.sample=t;const i=e.material();return this._temp.sampleGeometry.material=this._materials[i],this._temp.sampleGeometry.transform=this._temp.transform,this._temp.sampleGeometry.aabb=this._temp.boundingBox,delete this._temp.sampleGeometry.geometries,this._temp.sampleGeometry}makeSampleInvisible(t,e){const s=this.getTileIds(t,e);s&&Wi.forEach(s,(i=>this.makeInvisibleFromTile(i,t)))}setSample(t,e,s,i){this._samples.setVisible(t,e),this._samples.setHighlight(t,s);const r=this.getTileIds(t,i);r!==void 0&&Wi.forEach(r,(o=>{this.updateTile(o,t,s,s===0)}))}getTileIds(t,e){return e===jt.GEOMETRY?this._tileBySample[t]:this._lodBySample[t]}addBasicTileData(t,e,s){t.sampleLocation.set(e,t.size),t.size++,t.geometriesLocation.push(s),t.indexLocation.push(t.indexCount||0),t.vertexLocation.push((t.positionCount||0)/3)}buildNewVirtualTile(t,e){this.constructTile(t),this.loadTile(e,t),t.notVirtual=!0,delete t.indexBuffer,delete t.positionBuffer,delete t.normalBuffer,delete t.faceIdBuffer,delete t.ids}deleteTileIfNeeded(t,e){if(this.getShouldDeleteTile(t))return this.deleteGeometry(e),t.notVirtual=!1,void(sm._graphicMemoryConsumed-=t.usedMemory);this._tilesChanged.add(e)}getShouldDeleteTile(t){if(!t.visibilities||!t.highlights)throw new Error("Fragments: Malformed tile!");const e=t.visibilities.fullOf(!1),s=t.highlights.fullOf(0),i=this.memoryOverflow();return e&&s&&i}checkTileMemoryOverflow(t,e){const s=this._tiles.get(t);return(s?s.positionCount:0)+e.positionCount>qa}updateTileData(t,e,s,i){if(!t.visibilities||!t.highlights)throw new Error("Fragments: Malformed tile!");const r=t.sampleLocation.get(e);t.visibilities.update(r,s),t.highlights.update(r,i)}getKeepUpdating(t,e){const s=this._params.updateTime,i=this._params.updateSamples,r=t<this._sampleAmount,o=performance.now()-e;return r&&(o<s||t<i)}computeTileSize(){const t=this._boxes.fullBox.getSize(this._temp.vector),e=Math.max(t.x,t.y,t.z)/this._params.tileDimensionFactor,s=Math.ceil(e);return Math.max(this._params.minTileDimension,s)}newTileId(t,e,s){this.logBufferOverflowIfNeeded(s);const i=s.lod||jt.GEOMETRY,r=this.generateTileCode(t,e,s,i),o=this._sizeByTile.get(r)||1;let a=r+o-1;return this.checkTileMemoryOverflow(a,s)&&(a+=this._params.tileIdIncrement,this._sizeByTile.set(r,o+1)),a}logBufferOverflowIfNeeded(t){t.positionCount/3>qa&&console.log("Fragments: Buffer overflow")}fetchLodLevel(t){const e=this._boxes.get(t);if(!Ma.collides(e,this._virtualPlanes))return jt.INVISIBLE;this.meshes.samples(t,this._temp.sample);const s=this._temp.sample.item();if(!this._items.visible(s))return jt.INVISIBLE;const i=this._virtualView.graphicQuality,r=this._boxes.dimensionOf(t),o=e.distanceToPoint(this._virtualView.cameraPosition),a=this.screenSize(r,o),l=r<this._params.smallObjectSize,c=!l,h=this._params.smallScreenSize*i,u=this._params.mediumScreenSize*i,p=this._params.largeScreenSize*i,d=a<u,g=l&&a<p,m=c&&d;if(l&&d||c&&a<h)return jt.INVISIBLE;if(g||m)return jt.WIRES;const b=this._sampleLodSize[t];return this.screenSize(b,o)<Math.max(u,this._params.mediumScreenSize)?jt.WIRES:jt.GEOMETRY}generateTileCode(t,e,s,i){this._tileIdGenerator.reset(),this.processTileDataId(s,e,i);const r=this.processTileSpatialId(t,i);return this.processTileDimensionId(r),this._tileIdGenerator.value}processTileDataId(t,e,s){this._tileIdGenerator.compute(t.objectClass!==void 0?t.objectClass:0),this._tileIdGenerator.compute(e),this._tileIdGenerator.compute(s)}deleteGeometry(t){this._meshConnection.process({tileRequestClass:Ne.DELETE,modelId:this._modelId,tileId:t})}processTileSpatialId(t,e){const s=this._temp.tileCenter.x,i=this._temp.tileCenter.y,r=this._temp.tileCenter.z,o=this._boxes.get(t);o.getCenter(this._temp.tileCenter);const a=this.getTileDimension(e),l=s-s%a,c=i-i%a,h=r-r%a;return this._tileIdGenerator.compute(l),this._tileIdGenerator.compute(c),this._tileIdGenerator.compute(h),o}addCustomLodToTile(t,e,s){const i=this.meshData(t,!1,jt.WIRES);this._sampleLodSize[e]=i.lodThickness||0,this._lodBySample[e]=this.putSampleInTiles(e,s,i)}getTileLocations(t){return t.indexCount?t.indexLocation:t.vertexLocation}getTileDimension(t){let e=this._tileDimension;return t===jt.GEOMETRY&&(e*=this._params.tileSizeMultiplier),e}processTileDimensionId(t){const e=this.getTileDimensionClass(t);this._tileIdGenerator.compute(e)}tileAppend(t,e,s,i){this.addBasicTileData(t,s,i),this.tileAppendAttribute(t,e,"indexCount",!1),this.tileAppendAttribute(t,e,"positionCount",!1),this.tileAppendAttribute(t,e,"normalCount",!1),this.tileAppendAttribute(t,e,"materialId",!0)}putSampleInTiles(t,e,s){let i;return Wi.forEach(s,((r,o)=>{const a=this.newTileId(t,e,r);i=this.getTileIdsWhenSamplePut(i,a);const l=this.getTileWhenSamplePut(a,r,e);this.tileAppend(l,r,t,o)})),i}hasLodChanged(t,e){return e!==this._sampleLodState[t]}getTileIdsWhenSamplePut(t,e){return t===void 0?t=e:typeof t=="number"?t!==e&&(t=[t,e]):t.includes(e)||t.push(e),t}updateTile(t,e,s,i){const r=this._tiles.get(t);this.updateTileData(r,e,i,s),r.notVirtual?this._tilesChanged.add(t):this.buildNewVirtualTile(r,t)}getLodTileWhenPutSample(t,e){let s=this._tiles.get(t);if(!s){const i=this._temp.tile.objectClass;s=this.newTile(i,e,jt.WIRES),this._tiles.set(t,s)}return s}lodTileAppendSample(t,e){const s=jt.WIRES,i=this._temp.tile,r=this.generateTileCode(t,e,i,s),o=this.getLodTileWhenPutSample(r,e);return this.tileAppend(o,i,t,0),r}addSampleToTile(t,e,s){const i=this.meshData(t,!1,jt.GEOMETRY);this._tileBySample[e]=this.putSampleInTiles(e,s,i)}setTileBuffer(t,e,s){if(t.usedMemory===void 0)return;const i=t[`${e}Count`];if(i>0){const r=s?new Uint16Array(i):new Int16Array(i);t[`${e}Buffer`]=r,t.usedMemory+=r.byteLength}}updateTiles(t){const e=this._changedSamples<this._sampleAmount;if(this._virtualView===void 0||!e)return;let s=!0,i=0;for(;s;){const r=this._samplesDimensions[this._currentSample];this.updateMesh(r),this.updateCurrentSample(),i++,s=this.getKeepUpdating(i,t)}}sampleGeoms(t,e,s){return s.getLodClass()===Oa.AABB&&e===jt.WIRES?this.createLod(t.aabb):this.meshData(s,!0,e)}generateSampleInTiles(t){this.fetchSampleAndRepresentation(t);const e=this.fetchCurrentMaterial(),s=this.fetchCurrentMesh();this.addSampleToTile(s,t,e),this.addLodToTile(s,t,e)}buildSampleInTile(t,e,s,i,r){const o=t.geometriesLocation[e];if(this.tileLoadSample(t,s,o),i){const a=this._boxes.get(r);this._temp.vector.copy(t.location),this._temp.vector.negate(),a.translate(this._temp.vector),t.box.union(a)}}getSampleGeometries(t,e){return Array.isArray(t.geometries)?t.geometries[e]:t.geometries}constructTile(t){t.positionBuffer===void 0&&(t.positionBuffer=new Float32Array(t.positionCount),t.usedMemory=t.positionBuffer.byteLength,this.setTileBuffer(t,"index",!0),this.setTileBuffer(t,"normal",!1),this.setTileShellBuffer(t),t.faceIdBuffer=new Uint32Array(t.positionCount/3),t.usedMemory+=t.faceIdBuffer.byteLength);const e=!t.location;for(const[s,i]of t.sampleLocation){const r=this.fetchSample(s,t.lod);r&&r.geometries&&this.buildSampleInTile(t,i,r,e,s)}}fetchSampleTransform(t,e){this._temp.vector.copy(t.location),this._temp.vector.negate(),this._temp.matrix.identity(),this._temp.matrix.setPosition(this._temp.vector),this._temp.matrix.multiply(e.transform)}hasChanged(t,e,s,i){const r=this.hasLodChanged(t,e),o=this.hasVisibleChanged(t,s),a=this.hasHighlightChanged(t,i);return r||o||a}setupTileLocation(t,e,s){if(t.location)return;const i=new F;i.fromArray(e.positionBuffer),i.applyMatrix4(s.transform),t.location=i}getTileData(t){const e=this.getTileLocations(t),s=this.getTileVisibility(t,e),i=this.getTileHighlight(t,e),{highlightData:r,highlightIds:o}=i;return{visibilityData:s,highlightData:r,highlightIds:o}}updateMemoryOnTileLoad(t){sm._graphicMemoryConsumed+=t.usedMemory}fetchTileMatrixOnLoad(t){t.location&&(this._temp.matrix.identity(),this._temp.matrix.setPosition(t.location))}updateItem(t){const e=this._boxes.sampleOf(t);if(e)for(const s of e)this.updateMesh(s)}screenSize(t,e){return t/this.getViewDimension(e)*this._virtualView.viewSize}getTileDimensionClass(t){const e=t.min.distanceToSquared(t.max),s=this._params.smallTileSize;return e>this._params.mediumTileSize?2:e>s?1:0}getViewDimension(t){if(this._virtualView.orthogonalDimension)return this._virtualView.orthogonalDimension;const e=this._virtualView.fov;return e!==this._temp.pastFieldOfview&&(this._temp.viewDimension=this.getPerspTrueDim(e,1),this._temp.pastFieldOfview=e),t*this._temp.viewDimension}loadTile(t,e){const s=this.getTileData(e);this.fetchTileMatrixOnLoad(e);const i=this.getFaceIds(e);this._meshConnection.process({tileRequestClass:Ne.CREATE,modelId:this._modelId,objectClass:e.objectClass,tileId:t,itemId:void 0,tileData:s,indices:e.indexBuffer,positions:e.positionBuffer,normals:e.normalBuffer,faceIds:i,itemIds:e.ids,material:e.materialId,matrix:this._temp.matrix.clone(),aabb:e.box.clone(),currentLod:e.lod}),this.updateMemoryOnTileLoad(e)}getFaceIds(t){const e=new Dt,s=t.faceIdBuffer,i=new Float32Array(3*s.length);for(let r=0;r<s.length;r++){const o=s[r];e.set(0+o),i[3*r]=e.r,i[3*r+1]=e.g,i[3*r+2]=e.b}return i}meshData(t,e,s){const i=this._temp.representation.id(),r=t.getLodClass()===Oa.CUSTOM,o=s===jt.WIRES;return r&&o?t.fetchLod(i,e):t.fetchMeshes(i,e)}tileAppendAttribute(t,e,s,i){e[s]!==void 0&&(i?t[s]=e[s]:t[s]+=e[s])}itemId(t){return this.meshes.samples(t,this._temp.sample),this._temp.sample.item()}};O(bT,"_graphicMemoryConsumed",0);let BN=bT,UN=class{static isSame(t,e){const s=this.checkSameColor(t.color,e.color),i=this.checkSame(t.opacity,e.opacity,1),r=t.renderedFaces,o=e.renderedFaces,a=this.checkSame(r,o,il.ONE);return s&&i&&a}static checkSame(t,e,s){return t===e||t===s&&e===void 0||t===void 0&&e===s}static checkSameColor(t,e){if(t===e)return!0;if(t===void 0||e===void 0)return!1;const{r:s,g:i,b:r}=t,{r:o,g:a,b:l}=e;return s===o&&i===a&&r===l}},VN=class{constructor(t,e){O(this,"_modelId"),O(this,"_list",[]),O(this,"_onTransfer"),this._modelId=t,this._onTransfer=e}update(t){const e=t.meshes();return this.getAll(e,[])}fetch(t){return this._list[t]}transfer(t){const e=this.deduplicateMaterials(t),{materialDefinitions:s,ids:i}=e;return this.transferMaterialData(s),i}getItemsMaterialDefinition(t,e,s){const i=[],r=t.meshes();if(!r)return[];const o=new Map;for(const[a,l]of e.entries()){const c=r.samples(l);if(!c)continue;const h=c.material();let u=o.get(h);u||(u=new Set,o.set(h,u)),u.add(s[a])}for(const[a,l]of o.entries()){const c=r.materials(a);if(!c)continue;const h=Oo.parseMaterial(c);i.push({localIds:[...l],definition:h})}return i}checkMaterialExists(t,e){const s=this._list.length;for(let i=0;i<s;i++){const r=this._list[i];if(UN.isSame(t,r))return e.push(i),!0}return!1}deduplicateMaterials(t){const e=[],s=[];for(const i of t)if(!this.checkMaterialExists(i,e)){this._list.push(i),s.push(i);const r=this._list.length-1;e.push(r)}return{materialDefinitions:s,ids:e}}getAll(t,e){const s=t.materialsLength();for(let i=0;i<s;i++){const r=t.materials(i),o=Oo.parseMaterial(r);e.push(o)}return this.transfer(e)}transferMaterialData(t){this._onTransfer({class:Ci.CREATE_MATERIAL,modelId:this._modelId,materialDefinitions:t})}},HN=class{constructor(t,e,s){if(O(this,"_model"),O(this,"_boxes"),O(this,"_localIdsToGeometryIds",new Map),O(this,"_guidToLocalIdMap",new Map),O(this,"_items",new Map),O(this,"_itemDataCache",new Map),O(this,"_itemDataConfig",{attributesDefault:!0,relationsDefault:{attributes:!1,relations:!1}}),O(this,"_spatialStructure",null),O(this,"_relations",new Map),this._model=t,this._boxes=e,this.preindexGeometryIds(),s&&s.extraRelations)for(const r of s.extraRelations){const{category:o,relation:a,inverseName:l}=r;this.addInverseRelation(o,a,l)}const i=this._model.localIdsArray();if(i){for(let r=0;r<this._model.localIdsLength();r++){const o=this._model.categories(r),a=i[r];let l=this._items.get(a);l||(l={category:null,guid:null,geometryIds:null,attrs:null},this._items.set(a,l)),l.category=o}for(let r=0;r<this._model.guidsItemsLength();r++){const o=this._model.guidsItems(r);if(o===null)continue;const a=this._model.guids(r);this._guidToLocalIdMap.set(a,o);let l=this._items.get(o);l||(l={category:null,guid:null,geometryIds:null,attrs:null},this._items.set(o,l)),l.guid=a}}}getAllLocalIds(){return this._model.localIdsArray()??[]}addInverseRelation(t,e,s){const i=this.getItemsOfCategories([new RegExp(`^${t}$`)])[t];for(const r of i){const o=this.getItemRelations(r);if(!o||!o[e])continue;const a=o[e];for(const l of a){let c=this._relations.get(l);c||(c={},this._relations.set(l,c));let h=c[s];h||(h=[],c[s]=h),h.push(r)}}}getItemsCount(){return this._model.localIdsLength()}getMaxLocalId(){return this._model.maxLocalId()}getMetadata(){const t=this._model.metadata();return t?JSON.parse(t):null}getItemIdsFromLocalIds(t){if(!t)return Array.from(this._model.meshes().meshesItemsArray());const e=[];for(const s of t){const i=this._localIdsToGeometryIds.get(s);if(i)for(const r of i)e.push(r)}return e}getLocalIdsFromItemIds(t){const e=[],s=this._localIdsToGeometryIds.entries();for(const[i,r]of s)for(const o of t)r.includes(o)&&e.push(i);return e}getBox(t,e){for(const s of t){const i=this._boxes.sampleOf(s);if(i)for(const r of i){const o=this._boxes.get(r);e.union(o)}}}getSpatialStructure(){if(this._spatialStructure)return this._spatialStructure;const t=this._model.spatialStructure();return t?(this._spatialStructure=this.getTreeItem(t),this._spatialStructure):{}}getItemsChildren(t){const e=new Set;for(const s of t){const i=this.convertToLocalId(s);i!==null&&this.traverseSpatialStructure(i,e)}return[...e]}getGuids(){const t=[];for(let e=0;e<this._model.guidsLength();e++){const s=this._model.guids(e);t.push(s)}return t}getLocalIds(){const t=this._model.localIdsArray();return t?Array.from(t):[]}getItemsCategories(t){var e;const s=[];for(const i of t){const r=this.convertToLocalId(i);if(r===null)continue;const o=((e=this._items.get(r))==null?void 0:e.category)??null;s.push(o)}return s}getLocalIdsByGuids(t){const e=[];for(const s of t){const i=this._guidToLocalIdMap.get(s);e.push(i!==void 0?i:null)}return e}getGuidsByLocalIds(t){var e;const s=[];for(const i of t){const r=(e=this._items.get(i))==null?void 0:e.guid;s.push(r!==void 0?r:null)}return s}getAttributeNames(){const t=new Set;for(let e=0;e<this._model.uniqueAttributesLength();e++){const s=this._model.uniqueAttributes(e);if(!s)continue;const[i]=JSON.parse(s);t.add(i)}return[...t]}getAttributeValues(){const t=new Set;for(let e=0;e<this._model.uniqueAttributesLength();e++){const s=this._model.uniqueAttributes(e);if(!s)continue;const[,i]=JSON.parse(s);t.add(i)}return[...t]}getAttributesUniqueValues(t){var e,s,i;const r=new Map,o=t.every((c=>c.categories!==void 0)),a=t.map((c=>c.categories)).filter((c=>c!==void 0)).flat();for(let c=0;c<this._model.categoriesLength();c++){let h=!0;if(o){const m=this._model.categories(c);h=a.some((b=>b?.test(m)))}if(!h)continue;const u=this._model.attributes(c);if(!u)continue;const p={};for(let m=0;m<u.dataLength();m++){const b=u.data(m);if(!b)continue;const[f,_,y]=JSON.parse(b);p[f]={value:_,type:y}}const d=Object.keys(p),g=this._model.categories(c);for(const{key:m,attributes:b,get:f,categories:_}of t){let y=!0;if(_&&(y=_.some((w=>w.test(g)))),!y)continue;let v=!0;if(b){const{aggregation:w,queries:I}=b,C=[];for(const{name:A,value:S,type:P,negate:M}of I){const T=d.find((W=>A.test(W)));if(!T||((e=p[T])==null?void 0:e.value)===void 0)break;let L=!1;const{value:E,type:N}=p[T];L=S instanceof RegExp?typeof E=="string"&&S.test(E):E===S,P!==void 0&&(L=L&&typeof N=="string"&&P.test(N)),M&&(L=!L),C.push(L)}v=w==="exclusive"?C.every((A=>A)):C.some((A=>A))}if(v){const w=d.find((A=>f.test(A)));if(!w||((s=p[w])==null?void 0:s.value)===void 0)continue;const I=m??w;let C=r.get(I);C||(C=new Set,r.set(I,C)),C.add((i=p[w])==null?void 0:i.value)}}}const l={};for(const[c,h]of r)l[c]=Array.from(h);return l}getAttributeTypes(){const t=new Set;for(let e=0;e<this._model.uniqueAttributesLength();e++){const s=this._model.uniqueAttributes(e);if(!s)continue;const[,,i]=JSON.parse(s);t.add(i)}return[...t]}getRelationNames(){const t=new Set;for(let e=0;e<this._model.relationNamesLength();e++){const s=this._model.relationNames(e);s&&t.add(s)}return[...t]}getItemAttributes(t){var e;const s=typeof t=="number"?t:this.getLocalIdsByGuids([t])[0];if(s===null)return null;const i=(e=this._model.localIdsArray())==null?void 0:e.indexOf(s);if(i===void 0||i===-1)return null;const r=this._model.attributes(i);if(!r)return null;const o={};for(let a=0;a<r.dataLength();a++){const l=r.data(a);if(!l)continue;const[c,h,u]=JSON.parse(l);o[c]={value:h,type:u}}return o}getItemData(t,e={}){var s,i;const r=this._itemDataConfig.attributesDefault,o=this._itemDataConfig.attributes,a=this._itemDataConfig.relations??{};let{attributes:l,relations:c}=this._itemDataConfig.relationsDefault;const{parentName:h,rel:u}=e;if(h||u){const g=h&&h in a;if(u&&u in a){const m=a[u];m&&(l=m.attributes,c=m.relations)}else if(g){const m=a[h];m&&(l=m.attributes,c=m.relations)}}else l=!0,c=!0;if(!l&&!c)return{};if(this._itemDataCache.has(t))return this._itemDataCache.get(t);const p=typeof t=="number"?t:this._guidToLocalIdMap.get(t)??null,d={_category:{value:p!==null?((s=this._items.get(p))==null?void 0:s.category)??null:null},_localId:{value:p},_guid:{value:typeof t=="string"?t:((i=this._items.get(t))==null?void 0:i.guid)??null}};if(this._itemDataCache.set(t,d),l&&p!==null){const g=this.getItemAttributes(t);for(const[m,b]of Object.entries(g??{}))r?o?.includes(m)||(d[m]=b):o?.includes(m)&&(d[m]=b)}if(c){const g=this.getItemRelations(t);for(const[m,b]of Object.entries(g??{}))for(const f of b){const _=this.getItemData(f,{parentName:u,rel:m});if(Object.keys(_).length===0)continue;const y=d[m];Array.isArray(y)?y.push(_):d[m]=[_]}}return d}getItemsData(t,e={}){this._itemDataCache.clear();const s=[],i=t.length!==0?t:this._model.localIdsArray();if(!i)return s;this._itemDataConfig={...this._itemDataConfig,...e};for(const r of i)s.push(this.getItemData(r));return this._itemDataCache.clear(),this._itemDataConfig={relationsDefault:{attributes:!1,relations:!1},attributesDefault:!0},s}getItemRelations(t){var e;const s=typeof t=="number"?t:this.getLocalIdsByGuids([t])[0];if(s===null)return null;const i=this._relations.get(s)??{},r=(e=this._model.relationsItemsArray())==null?void 0:e.indexOf(s);if(r===void 0||r===-1)return Object.keys(i).length>0?i:null;const o=this._model.relations(r);if(!o)return Object.keys(i).length>0?i:null;for(let a=0;a<o.dataLength();a++){const l=o.data(a);if(!l)continue;const[c,...h]=JSON.parse(l);i[c]=h}return i}getCategories(){const t=new Set;for(let e=0;e<this._model.categoriesLength();e++){const s=this._model.categories(e);s&&t.add(s)}return[...t]}getItemsOfCategories(t){const e={},s=this._model.localIdsArray();if(!s)return e;for(let i=0;i<this._model.categoriesLength();i++){const r=this._model.categories(i);if(r){for(const o of t)if(o.test(r)){e[r]||(e[r]=[]),e[r].push(s[i]);break}}}return e}getItemsWithGeometry(){const t=this._model.meshes(new je),e=[];if(!t)return e;const s=t.meshesItemsArray();if(!s)return e;for(const i of s){const r=this._model.localIds(i);r!==null&&e.push(r)}return e}getItemsWithGeometryCategories(){const t=this.getItemsWithGeometry();return this.getItemsCategories(t)}getItemsByAttribute({name:t,value:e,type:s,negate:i,itemIds:r}){const o=this._model.attributesLength(),a=[];for(let l=0;l<o;l++){const c=this._model.localIds(l);if(c===null||r?.length&&!r.includes(c))continue;const h=this._model.attributes(l);if(!h)continue;const u=h?.dataLength();let p=!1;for(let d=0;d<u;d++){const g=h.data(d);if(!g)continue;const[m,b,f]=JSON.parse(g);if(t.test(m)){let _=e===void 0&&s===void 0;if(_||(e!==void 0&&(_=Array.isArray(e)?e.some((y=>typeof b=="string"&&y.test(b))):e instanceof RegExp?typeof b=="string"&&e.test(b):b===e),s!==void 0&&(_=_&&typeof f=="string"&&s.test(f))),_){p=!0;break}}}(i?!p:p)&&a.push(c)}return a}getItemsByRelation({name:t,targetItemIds:e,sourceItemIds:s}){const i=[],r=s??this.getAllLocalIds();for(const o of r){const a=this.getItemRelations(o),l=a?.[t];if(l)if(e){for(const c of l)if(e.has(c)){i.push(o);break}}else i.push(o)}return i}getItemsByQuery(t){var e;const{categories:s,attributes:i,relation:r}=t;let o=(e=s?.filter(Boolean))!=null&&e.length?Object.values(this.getItemsOfCategories(s)).flat():void 0;if(o?.length===0)return[];if(i){const a=i.aggregation??"exclusive",l=[];for(const h of i.queries)if(i&&h.name){const u=this.getItemsByAttribute({...h,itemIds:o});l.push(u)}const c=new Set;if(a==="inclusive")for(const h of l)for(const u of h)c.add(u);else{const h=new Map;for(const u of l)for(const p of u){const d=h.get(p);d===void 0?h.set(p,1):h.set(p,d+1)}for(const[u,p]of h)p===l.length&&c.add(u)}o=[...c]}if(o?.length===0)return[];if(r&&r.name){const{name:a,query:l}=r,c=l?new Set(this.getItemsByQuery(l)):void 0;o=this.getItemsByRelation({name:a,targetItemIds:c,sourceItemIds:o})}return Array.from(new Set(o))}getTreeItem(t){const e={category:t.category(),localId:t.localId()},s=[];for(let i=0;i<t.childrenLength();i++){const r=t.children(i);r&&s.push(this.getTreeItem(r))}return s.length>0&&(e.children=s),e}preindexGeometryIds(){const t=this._model.meshes(),e=t.meshesItemsLength();for(let s=0;s<e;s++){const i=t.meshesItems(s),r=this._model.localIds(i);r!==null&&(this._localIdsToGeometryIds.has(r)||this._localIdsToGeometryIds.set(r,[]),this._localIdsToGeometryIds.get(r).push(s))}}convertToLocalId(t){if(typeof t=="number")return t;const e=this._guidToLocalIdMap.get(t);return e===void 0?null:e}getChildrenLocalIds(t,e){if(t.localId!==null&&e.add(t.localId),t.children)for(const s of t.children)this.getChildrenLocalIds(s,e)}traverseSpatialStructure(t,e,s=this.getSpatialStructure()){if(s){if(s.localId===t&&s.children)for(const i of s.children)this.getChildrenLocalIds(i,e);else if(s.children)for(const i of s.children)this.traverseSpatialStructure(t,e,i)}}},jN=class{constructor(t){O(this,"_model"),this._model=t}async getAlignments(){const t=[],e=this._model.alignmentsLength();for(let s=0;s<e;s++){const i=this._model.alignments(s),r={absolute:[],horizontal:[],vertical:[]};t.push(r),this.constructAlignment(i,r,"absolute"),this.constructAlignment(i,r,"horizontal"),this.constructAlignment(i,r,"vertical")}return t}constructAlignment(t,e,s){const i=t[{absolute:"absoluteLength",horizontal:"horizontalLength",vertical:"verticalLength"}[s]](),r=this._model.geometries();for(let o=0;o<i;o++){const a=t[s](o),l=r.samples(a).id(),c=r.representations(l),h=c.id(),u=c.geometryClass(),p=[],d=r.lines(h).pointsArray();for(const g of d)p.push(g);e[s].push({points:new Float32Array(p),type:u})}}},WN=class{constructor(){O(this,"_templates",new Map)}add(t,e){this._templates.set(t,e)}get(t){const e=this._templates.get(t);return Array.isArray(e)?this.getTemplateSet(e):{...e}}getTemplateSet(t){const e=[];for(const s of t){const i={...s};e.push(i)}return e}};const _T=class Kn{constructor(t,e){O(this,"_dataBuffer"),O(this,"_dataPosition"),this._dataBuffer=e||this.getDefaultData(),this._dataPosition=t||Kn._data.defaultPosition}set(t){let e=0;for(const s of Kn._data.points)for(const i of Kn._data.coords){const r=this.getPosition(i,s),o=t[e++];this.setValue(r,o)}}get(t,e){const s=this.getPosition(t,e);return this._dataBuffer[s]}clone(t){for(const e of Kn._data.points)for(const s of Kn._data.coords){const i=this.getPosition(s,e),r=t.get(s,e);this.setValue(i,r)}}combine(t,e){for(const s of Kn._data.points)for(const i of Kn._data.coords)this.save(i,s,t,e)}setValue(t,e){this._dataBuffer[t]=e}getDefaultData(){return new Float64Array(Kn._data.size)}getPosition(t,e){return Kn._data[e][t]+this._dataPosition}save(t,e,s,i){const r=this.getPosition(t,e),o=s.get(t,e),a=i.get(t,e),l=Math[e](o,a);this.setValue(r,l)}};O(_T,"_data",{size:6,defaultPosition:0,min:{x:0,y:2,z:4},max:{x:1,y:3,z:5},coords:["x","y","z"],points:["min","max"]});let im=_T;const yT=class nm{constructor(t,e){O(this,"box"),O(this,"data",0),this.box=new im(t,e)}get size(){return this.data*nm._data.factor}get isPoint(){return this.data>=nm._data.threshold}transform(t,e,s){s||(t*=nm._data.factor),this.data=t,this.box.clone(e)}};O(yT,"_data",{threshold:0,factor:-1});let YN=yT,GN=class{constructor(t){O(this,"_boxes"),O(this,"_min",new F),O(this,"_max",new F),this._boxes=t}inflate(t){const e=this._boxes.fullBox.min,s=this.getVector(t,e,"min"),i=this.getVector(t,e,"max");return new Tt(s,i)}deflate(t,e){this.read(t);const s=[];s.push(this._min.x,this._min.y,this._min.z),s.push(this._max.x,this._max.y,this._max.z),e.set(s)}getVector(t,e,s){const i=t.get("x",s)+e.x,r=t.get("y",s)+e.y,o=t.get("z",s)+e.z;return new F(i,r,o)}read(t){const{min:e}=this._boxes.fullBox;this._min.subVectors(t.min,e),this._max.subVectors(t.max,e)}},qN=class{constructor(t,e){O(this,"_data"),O(this,"_compressor"),this._data=e,this._compressor=t}frustumCollide(t,e,s=!1){const i=this.getFrustumPlanes(e,t),r=this.getFrustumOnCollide(i),o=this.getFrustumOnIncludes(i),a=this.newDefaultCallback(!0);return this.collide(r,o,a,s)}rayCollide(t,e){const s=this.getRayOnCollide(e),i=this.newDefaultCallback(!1),r=this.getRayOnSeen(t);return this.collide(s,i,r)}addPoint(t,e,s,i){t?i&&e.push(this.getPointData(s)):e.push(this.getPointData(s))}getPointData(t){return this.getPoint(t).data}getBounds(t){const e=this.getPoint(t);return this._compressor.inflate(e.box)}isPoint(t){return this.getPoint(t).isPoint}newDefaultCallback(t){return e=>t}groupSize(t){return this.getPoint(t).size}getPoint(t){return this._data.points[t]}getRayOnSeen(t){let e=this.newDefaultCallback(!0);return t?.length>0&&(e=s=>Ma.collides(s,t)),e}getRayOnCollide(t){return e=>t.intersectsBox(e)}collide(t,e,s,i=!1){const r=this._data.points.length,o=[];let a=0;const l=(h,u)=>{const p=a+this.groupSize(a);for(;a<p;a++)this.isPoint(a)&&s(h)&&(i?u&&this.savePoint(a,o):this.savePoint(a,o))},c=()=>{const h=this.getBounds(a),u=e(h),p=this.isPoint(a),d=u||t(h);p&&d&&s(h)&&this.addPoint(i,o,a,u),d||p?(a++,u&&!p&&l(h,u)):a+=this.groupSize(a)};for(;a<r;)c();return o}getFrustumOnIncludes(t){return e=>Ma.isIncluded(e,t)}getFrustumOnCollide(t){return e=>Ma.collides(e,t)}getFrustumPlanes(t,e){const s=[];for(const i of t.planes)s.push(i);if(e)for(const i of e)s.push(i);return s}savePoint(t,e){const s=this.getPoint(t);e.push(s.data)}},ZN=class{constructor(t){O(this,"_boxes"),O(this,"_total",new F),O(this,"_change",new F),O(this,"_average",new F),O(this,"_tempCenterVector",new F),O(this,"_tempVectors",{x:new F,y:new F,z:new F}),this._boxes=t}sort(t,e,s){this.average(this._average,t,e,s),this.getDataToTotal(e,s,t);let i=this.anySort(e,s,t);return i=this.adjust(s,e,i),Math.round(i)}anySort(t,e,s){return this._total.x>this._total.y?this._total.x>this._total.z?this.sortDim("x",this._average.x,t,e,s):this.sortDim("z",this._average.z,t,e,s):this._total.y>this._total.z?this.sortDim("y",this._average.y,t,e,s):this.sortDim("z",this._average.z,t,e,s)}getDataToTotal(t,e,s){this._total.set(0,0,0);for(let i=t;i<e;i++){this._boxes.get(s[i]).getCenter(this._change).sub(this._average);const r=this._change.multiply(this._change);this._total.add(r)}}sortDim(t,e,s,i,r){let o=s;for(let a=s;a<i;a++)this.getValue(r,a,t)>e&&(this.exchange(a,o,r),o++);return o}exchange(t,e,s){const i=s[t];s[t]=s[e],s[e]=i}getValue(t,e,s){const i=this.getBox(t,e),r=this._tempVectors[s];return i.getCenter(r)[s]}average(t,e,s,i){const r=this.getBox(e,s);return r.getCenter(t),this.aggregate(s,i,e,r,t),t.divideScalar(i-s)}aggregate(t,e,s,i,r){for(let o=t+1;o<e;o++){const a=s[o],l=this._boxes.get(a).getCenter(this._tempCenterVector);r.add(l)}}adjust(t,e,s){const i=(e+t)/2,r=(t-e)/3;return(s<=e+r||s>=t-1-r)&&(s=i),s}getBox(t,e){const s=t[e];return this._boxes.get(s)}},XN=class{constructor(t,e,s){O(this,"_data"),O(this,"_compressor"),O(this,"_boxes"),O(this,"_sorter"),this._data=s,this._compressor=e,this._boxes=t,this._sorter=new ZN(t)}make(t,e,s=0,i=0,r=0,o=0){const a=s-i;return a===1?this.makePoint(t,i,e,o):a===2?this.makeGroup3(o,t,i,e):this.makeGroup(r,t,i,s,o,e)}makeGroup3(t,e,s,i){const r=this.makeBox(t+1,e,s),o=this.makeBox(t+2,e,s+1);return i.combine(r,o),this.newGroup(t,3,i),3}makeGroup(t,e,s,i,r,o){const a=this._data.limits.primary[t],l=this._data.limits.secondary[t],c=this._sorter.sort(e,s,i),h=this.make(e,a,c,s,t+1,r+1),u=r+h+1,p=this.make(e,l,i,c,t+1,u);o.combine(a,l);const d=h+p+1;return this.newGroup(r,d,o),d}makeBox(t,e,s){const i=this._data.points[t].box,r=e[s],o=this._boxes.get(r);return this._compressor.deflate(o,i),this.set(t,r),i}makePoint(t,e,s,i){const r=this._boxes.get(t[e]);return this._compressor.deflate(r,s),this.newPoint(i,t[e],s),1}newGroup(t,e,s){this.get(t).transform(e,s,!1)}get(t){return this._data.points[t]}newPoint(t,e,s){this.get(t).transform(e,s,!0)}set(t,e){this.get(t).data=e}};const A0=class rm{constructor(t){O(this,"_compressor"),O(this,"_collider"),O(this,"_maker"),O(this,"_data"),O(this,"_boxes"),this._boxes=t,this._compressor=new GN(t),this._data=this.getData(),this._collider=new qN(this._compressor,this._data),this._maker=new XN(this._boxes,this._compressor,this._data),this.initData()}collideFrustum(t,e,s=!1){return this._collider.frustumCollide(t,e,s)}collideRay(t,e){return this._collider.rayCollide(t,e)}setupLimits(){for(let t=0;t<rm._limitThreshold;t++)this._data.limits.primary.push(new im),this._data.limits.secondary.push(new im)}getPointBuffer(){const t=this._boxes.getCount(),e=new Uint32Array(t);for(let s=0;s<e.length;s++)e[s]=s;return e}getPointsAmount(t){return 2*t.length-1}initData(){const t=this.getPointBuffer(),e=this.getPointsAmount(t),s=e*rm._boxSize,i=new Float64Array(s);for(let o=0;o<e;o++){const a=o*rm._boxSize,l=new YN(a,i);this._data.points.push(l)}this.setupLimits();const r=new im;this._maker.make(t,r,t.length)}getData(){return{points:[],limits:{primary:[],secondary:[]}}}};O(A0,"_boxSize",6),O(A0,"_limitThreshold",32);let QN=A0,KN=class{constructor(t){O(this,"lookup"),O(this,"_boxSize",6),O(this,"_pointSize",3),O(this,"_temp"),O(this,"_dimensionsOfSamples"),O(this,"_samples",[]),O(this,"_boxes"),O(this,"_meshes"),O(this,"_box"),this._temp={box:new Tt,vector:new F,transform:new xt,sample:new Qc,representation:new Xc},this._box=new Tt;const e=t.meshes();if(!e)throw new Error("Fragments: Malformed fragments data!");this._meshes=e;const s=e.samplesLength();this._dimensionsOfSamples=new Float32Array(s);const i=s*this._boxSize;this._boxes=new Float64Array(i),this.lookup=this.newLookup()}get fullBox(){return this._box}set fullBox(t){this._box=t}sampleOf(t){return this._samples[t]}get(t){const e=this.getMinPosition(t),s=this.getMaxPosition(t);return this._temp.box.min.fromArray(this._boxes,e),this._temp.box.max.fromArray(this._boxes,s),this._temp.box}process(t){this.fetchSampleAndRepresentation(t),this.getBox(),this.addToFullBox();const e=this.getMinPosition(t),s=this.getMaxPosition(t);this._temp.box.min.toArray(this._boxes,e),this._temp.box.max.toArray(this._boxes,s)}getCount(){return this._boxes.length/this._boxSize}dimensionOf(t){const e=this._dimensionsOfSamples[t];if(!e)throw new Error("Fragments: Dimension not found!");return e}newLookup(){const t=this._meshes.samplesLength(),e=this._meshes.globalTransformsLength();for(let s=0;s<t;s++){this.fetchSampleAndRepresentation(s),$r.getBox(this._temp.representation,this._temp.box);const i=this._temp.box.getSize(this._temp.vector);this._dimensionsOfSamples[s]=i.length(),this.process(s)}this._samples=new Array(e);for(let s=0;s<t;s++)this.storeBox(s);if(!this.getCount())throw new Error("Fragments: Malformed boxes!");return new QN(this)}getBox(){$r.get(this._temp.sample,this._meshes,this._temp.transform),$r.getBox(this._temp.representation,this._temp.box),this._temp.box.applyMatrix4(this._temp.transform)}fetchSampleAndRepresentation(t){this._meshes.samples(t,this._temp.sample);const e=this._temp.sample.representation();this._meshes.representations(e,this._temp.representation)}getMinPosition(t){return t*this._boxSize}storeBox(t){this.fetchSampleAndRepresentation(t);const e=this._temp.sample.item();this._samples[e]===void 0&&(this._samples[e]=[]),this._samples[e].push(t)}getMaxPosition(t){return t*this._boxSize+this._pointSize}addToFullBox(){this.fullBox.union(this._temp.box)}},JN=class{raycast(t,e,s){if(t.view)return t.raycaster.raycast(e,s,t.view.clippingPlanes)}snapRaycast(t,e,s,i){return t.view?t.raycaster.snapRaycast(e,s,i,t.view.clippingPlanes):[]}rectangleRaycast(t,e,s){return t.view?t.raycaster.rectangleRaycast(e,t.view.clippingPlanes,s):[]}},tM=class{getPositions(t,e){const s=[],i=t.properties.getItemIdsFromLocalIds(e);for(const r of i){const o=t.tiles.meshes.globalTransforms(r);if(!o)continue;const a=o.position(),l=a.x(),c=a.y(),h=a.z();s.push({x:l,y:c,z:h})}return s}getCoordinates(t){const e=t.data.meshes().coordinates(),s=e.position(),i=e.xDirection(),r=e.yDirection();return[s.x(),s.y(),s.z(),i.x(),i.y(),i.z(),r.x(),r.y(),r.z()]}},eM=class{constructor(){O(this,"_highlightProps",["color","opacity","transparent","renderedFaces"])}resetHighlight(t,e){const s=t.properties.getItemIdsFromLocalIds(e);this.resetHighlightForItems(s,t),t.tiles.restart()}getHighlight(t,e){const s=[],i=t.properties.getItemIdsFromLocalIds(e),r=this.getFetchEvent(t,s);return t.traverse(i,r),s}getHighlightItems(t){const e=[],s=t.itemConfig.size;for(let i=0;i<s;i++){if(!t.itemConfig.getHighlight(i))continue;const[r]=t.properties.getLocalIdsFromItemIds([i]);e.push(r)}return e}highlight(t,e,s){const i=t.properties.getItemIdsFromLocalIds(e),r=[],o=this.getCheckEvent(t,s,r);t.traverse(i,o);const a=t.materials.transfer(r),l=this.getCreateEvent(t,a);t.traverse(i,l),t.tiles.updateVirtualMeshes(i)}getFetchEvent(t,e){return s=>{const i=t.itemConfig.getHighlight(s);if(i){const r=t.materials.fetch(i);e.push(r)}else e.push(void 0)}}setHighlightProperty(t,e,s){t[s]===void 0&&e[s]!==void 0&&(t[s]=e[s])}getNewHighFromPast(t,e,s){const i=t.materials.fetch(e),r={...s};for(const o of this._highlightProps)this.setHighlightProperty(r,i,o);return r}getCheckEvent(t,e,s){return i=>{const r=t.itemConfig.getHighlight(i);if(r===void 0)s.push(e);else{const o=this.getNewHighFromPast(t,r,e);s.push(o)}}}getCreateEvent(t,e){return(s,i)=>{t.itemConfig.setHighlight(s,e[i])}}resetHighlightForItems(t,e){if(t)for(const s of t)e.itemConfig.setHighlight(s,0);else e.itemConfig.clearHighlight()}},sM=class{resetVisible(t){t.itemConfig.clearVisible(),t.tiles.restart()}getVisible(t,e){const s=t.properties.getItemIdsFromLocalIds(e),i=[];for(const r of s){const o=t.itemConfig.visible(r);i.push(o)}return i}getItemsByVisibility(t,e){const s=this.getVisibleCondition(t,e),i=t.getItemsByConfig(s);return t.properties.getLocalIdsFromItemIds(i)}toggleVisible(t,e){const s=t.properties.getItemIdsFromLocalIds(e),i=this.getToggleEvent(t);t.traverse(s,i),t.tiles.updateVirtualMeshes(s)}setVisible(t,e,s){const i=t.properties.getItemIdsFromLocalIds(e),r=this.getSetEvent(t,s);t.traverse(i,r),t.tiles.updateVirtualMeshes(i)}getSetEvent(t,e){return s=>{t.itemConfig.setVisible(s,e)}}getVisibleCondition(t,e){return s=>t.itemConfig.visible(s)===e}getToggleEvent(t){return e=>{const s=t.itemConfig.visible(e);t.itemConfig.setVisible(e,!s)}}},iM=class{getGeometriesLength(t){return t.data.meshes().globalTransformsLength()}getGeometry(t,e){const s=t.boxes.sampleOf(e),i=[];if(!s)return i;for(const r of s){const o=t.tiles.fetchSample(r,jt.GEOMETRY),a=Array.isArray(o.geometries)?o.geometries:[o.geometries];for(const l of a)i.push({transform:o.transform.clone(),indices:l.indexBuffer,positions:l.positionBuffer,normals:l.normalBuffer})}return i}getVolume(t,e){let s=0;const i={x:0,y:0,z:0},r={x:0,y:0,z:0},o={x:0,y:0,z:0},a=this.getGeometry(t,e);for(const{indices:l,positions:c}of a)if(l&&c)for(let h=0;h<l.length-2;h+=3){const u=3*l[h],p=3*l[h+1],d=3*l[h+2];i.x=c[u],i.y=c[u+1],i.z=c[u+2],r.x=c[p],r.y=c[p+1],r.z=c[p+2],o.x=c[d],o.y=c[d+1],o.z=c[d+2],s+=this.getSignedVolumeOfTriangle(i,r,o)}return Math.abs(s)}getSignedVolumeOfTriangle(t,e,s){return 1/6*(-(s.x*e.y*t.z)+e.x*s.y*t.z+s.x*t.y*e.z-t.x*s.y*e.z-e.x*t.y*s.z+t.x*e.y*s.z)}},nM=class{constructor(){O(this,"_sectionGenerator",new KL)}async getSection(t,e,s){this._sectionGenerator.plane=e,performance.now();const i=new Map,r=[];for(const u of s){const p=t.boxes.sampleOf(u);if(p)for(const d of p){const g=t.boxes.get(d);if(!e.intersectsBox(g))continue;const m=t.tiles.meshes.meshesItems(u);if(t.data.categories(m)==="IFCSPACE")continue;const b=t.tiles.meshes.samples(d);if(!b)continue;const f=b.representation();if(!i.has(f)){const y=[],v=t.tiles.fetchSample(d,jt.GEOMETRY);Wi.forEach(v.geometries,(w=>{if(!w.indexBuffer||!w.positionBuffer)return;const I=new Ce;I.setIndex(Array.from(w.indexBuffer)),I.setAttribute("position",new ze(w.positionBuffer,3)),y.push(I)})),i.set(f,y)}const _=i.get(f);if(_)for(const y of _){const v=new ht(y),w=t.tiles.getSampleTransform(d);v.applyMatrix4(w),v.updateWorldMatrix(!0,!0),r.push(v)}}}const o=new Float32Array(6e5),a=new ze(o,3,!1),{index:l,indexes:c}=this._sectionGenerator.createEdges({meshes:r,posAttr:a}),h=this._sectionGenerator.createFills(o,c);for(const[,u]of i)for(const p of u)p.dispose();return{buffer:o,index:l,fillsIndices:h}}},rM=class{constructor(t){O(this,"_model"),O(this,"sequenceSelectorFunction",{withVisiblity:e=>this._model.getItemsByVisibility(e),highlighted:()=>this._model.getHighlightItemIds(),children:e=>this._model.getItemsChildren(e),ofCategory:e=>{const s=this._model.getItemsOfCategories(e);return Object.values(s).flat()},withCondition:()=>[],withGeometry:()=>this._model.getItemsWithGeometry()}),O(this,"sequenceResultFunction",{attributes:e=>e.map((s=>this._model.getItemAttributes(s))),mergedBoxes:e=>this._model.getBBoxes(e),category:e=>this._model.getItemsCategories(e),children:e=>this._model.getItemsChildren(e),data:(e,...s)=>this._model.getItemsData(e,s[0]),geometry:e=>this._model.getItemsGeometry(e),guid:e=>this._model.getGuidsByLocalIds(e),highlight:e=>this._model.getHighlight(e),relations:e=>e.map((s=>this._model.getItemRelations(s))),visibility:e=>this._model.getVisible(e)}),this._model=t}getSequenced(t,e,s){var i;const r=this.sequenceResultFunction[t];if(!r)return null;let o=[],a=0;for(const l of e){const c=this.sequenceSelectorFunction[l];if(!c)continue;const h=(i=s?.selector)==null?void 0:i[l];o=c(a===0?h:o),a++}return r(o,s?.result)}},oM=class{traverse(t,e,s){e?this.traverseItems(e,s):this.traverseAllItems(t,s)}getItemsByConfig(t,e){const s=[],i=t.data.localIdsLength();for(let r=0;r<i;r++)e(r)&&s.push(r);return s}traverseItems(t,e){const s=t.length;for(let i=0;i<s;i++)e(t[i],i)}traverseAllItems(t,e){const s=t.itemConfig.size;for(let i=0;i<s;i++)e(i,i)}},aM=class{constructor(t,e,s,i){O(this,"data"),O(this,"view"),O(this,"raycaster"),O(this,"itemConfig"),O(this,"properties"),O(this,"materials"),O(this,"tiles"),O(this,"boxes"),O(this,"_raycastHelper",new JN),O(this,"_coordinatesHelper",new tM),O(this,"_highlightHelper",new eM),O(this,"_visibilityHelper",new sM),O(this,"_geometryHelper",new iM),O(this,"_sectionHelper",new nM),O(this,"_itemsHelper",new oM),O(this,"_sequenceHelper",new rM(this)),O(this,"_config",{}),O(this,"_modelId"),O(this,"_alignments"),O(this,"_connection"),O(this,"_onTransferMaterial",((r,o)=>{if(this._connection)return this._connection.fetch(r,o)})),this._modelId=t,this._connection=s,this._config={...this._config,...i},this.data=this.setupModel(e),this.boxes=new KN(this.data),this.materials=this.setupMaterials(t),this._alignments=new jN(this.data),this.itemConfig=this.setupItemsConfig(),this.tiles=this.setupTiles(),this.properties=this.setupProperties(),this.raycaster=this.setupRaycaster(),this.setupBVH()}getItemsByConfig(t){return this._itemsHelper.getItemsByConfig(this,t)}getItemsCategories(t){return this.properties.getItemsCategories(t)}getItemIdsByLocalIds(t){return this.properties.getItemIdsFromLocalIds(t)}getItemAttributes(t){return this.properties.getItemAttributes(t)}getAttributesUniqueValues(t){return this.properties.getAttributesUniqueValues(t)}getItemsData(t,e){return this.properties.getItemsData(t,e)}getItemsOfCategories(t){return this.properties.getItemsOfCategories(t)}getItemsWithGeometry(){return this.properties.getItemsWithGeometry()}getItemsWithGeometryCategories(){return this.properties.getItemsWithGeometryCategories()}getItemsByQuery(t){return this.properties.getItemsByQuery(t)}getItemRelations(t){return this.properties.getItemRelations(t)}getSpatialStructure(){return this.properties.getSpatialStructure()}getMaxLocalId(){return this.properties.getMaxLocalId()}getCategories(){return this.properties.getCategories()}getMetadata(){return this.properties.getMetadata()}getLocalIdsByGuids(t){return this.properties.getLocalIdsByGuids(t)}getGuidsByLocalIds(t){return this.properties.getGuidsByLocalIds(t)}getSequenced(t,e,s){return this._sequenceHelper.getSequenced(t,e,s)}highlight(t,e){this._highlightHelper.highlight(this,t,e)}getHighlight(t){return this._highlightHelper.getHighlight(this,t)}getHighlightItemIds(){return this._highlightHelper.getHighlightItems(this)}resetHighlight(t){this._highlightHelper.resetHighlight(this,t)}getCoordinates(){return this._coordinatesHelper.getCoordinates(this)}getPositions(t){return this._coordinatesHelper.getPositions(this,t)}getGeometriesLength(){return this._geometryHelper.getGeometriesLength(this)}getGuids(){return this.properties.getGuids()}getLocalIds(){return this.properties.getLocalIds()}getItemsGeometry(t){const e=this.properties.getItemIdsFromLocalIds(t),s=[];for(const i of e){const r=this._geometryHelper.getGeometry(this,i);s.push(r)}return s}getItemsVolume(t){const e=this.properties.getItemIdsFromLocalIds(t);let s=0;for(const i of e)s+=this._geometryHelper.getVolume(this,i);return s}getAttributeNames(){return this.properties.getAttributeNames()}getAttributeValues(){return this.properties.getAttributeValues()}getAttributeTypes(){return this.properties.getAttributeTypes()}getRelationNames(){return this.properties.getRelationNames()}getItemsMaterialDefinition(t){const e=this.properties.getItemIdsFromLocalIds(t);return this.materials.getItemsMaterialDefinition(this.data,e,t)}resetVisible(){this._visibilityHelper.resetVisible(this)}getItemsByVisibility(t){return this._visibilityHelper.getItemsByVisibility(this,t)}raycast(t,e){return this._raycastHelper.raycast(this,t,e)}snapRaycast(t,e,s){return this._raycastHelper.snapRaycast(this,t,e,s)}rectangleRaycast(t,e){return this._raycastHelper.rectangleRaycast(this,t,e)}async getSection(t,e){const s=this.properties.getItemIdsFromLocalIds(e);return this._sectionHelper.getSection(this,t,s)}async getAlignments(){return this._alignments.getAlignments()}getBuffer(t){const e=this.data.bb.bytes().buffer;return t?e:sv.deflate(e)}dispose(){this.tiles.dispose()}setVisible(t,e){this._visibilityHelper.setVisible(this,t,e)}toggleVisible(t){this._visibilityHelper.toggleVisible(this,t)}getVisible(t){return this._visibilityHelper.getVisible(this,t)}getItemsChildren(t){return this.properties.getItemsChildren(t)}setupData(){this.tiles.generate()}refreshView(t){this.view=t,this.tiles.setupView(t)}getFullBBox(){return this.boxes.fullBox}getBBoxes(t){const e=new Tt;return this.properties.getBox(t,e),e}traverse(t,e){this._itemsHelper.traverse(this,t,e)}update(t){return this.tiles.update(t),this.tiles.tilesUpdated}setupBVH(){Ce.prototype.computeBoundsTree=hN,Ce.prototype.disposeBoundsTree=uN,ht.prototype.raycast=cN}setupProperties(){return new HN(this.data,this.boxes,this._config.properties)}setupRaycaster(){return new dT(this.data,this.boxes,this.tiles,this.itemConfig)}setupMaterials(t){return new VN(t,this._onTransferMaterial)}setupTiles(){const t=this.materials.update(this.data);return new BN({modelId:this._modelId,connection:this._connection,model:this.data,boxes:this.boxes,items:this.itemConfig,materials:t})}setupModel(t){const e=new Uint8Array(t),s=new n0(e);return ne.getRootAsModel(s)}setupItemsConfig(){const t=this.data.localIdsLength();return new uT(t)}},lM=class{constructor(t,e,s=!1){O(this,"_modelId"),O(this,"_virtualModel"),this._modelId=t;let i=e;s||(i=sv.inflate(e)),this._virtualModel=new aM(t,i,void 0)}get modelId(){return this._modelId}dispose(){this._virtualModel.dispose(),this._virtualModel=null}getSpatialStructure(){return this._virtualModel.getSpatialStructure()}getLocalIdsByGuids(t){return this._virtualModel.getLocalIdsByGuids(t)}getCategories(){return this._virtualModel.getCategories()}getItemsWithGeometry(){return this._virtualModel.getItemsWithGeometry()}getMetadata(){return this._virtualModel.getMetadata()}getGuidsByLocalIds(t){return this._virtualModel.getGuidsByLocalIds(t)}getBuffer(t=!1){return this._virtualModel.getBuffer(t)}getItemsOfCategories(t){return this._virtualModel.getItemsOfCategories(t)}getMaxLocalId(){return this._virtualModel.getMaxLocalId()}getItemsChildren(t){this._virtualModel.getItemsChildren(t)}getItemsData(t,e){return this._virtualModel.getItemsData(t,e)}getPositions(t){return this._virtualModel.getPositions(t)}getCoordinates(){return this._virtualModel.getCoordinates()}},nv=class{constructor(t){O(this,"onModelLoaded",new Ds),O(this,"models"),O(this,"settings",{autoCoordinate:!0,maxUpdateRate:100,graphicsQuality:0}),O(this,"baseCoordinates",null),O(this,"_connection"),O(this,"_isDisposed",!1),O(this,"_autoRedrawInterval",null),O(this,"_lastUpdate",0);const e=this.newRequestEvent(),s=this.newUpdateEvent();this._connection=new T5(e,t),this.models=new E5(s),this.models.list.onItemDeleted.add((()=>{this.models.list.size===0&&(this.baseCoordinates=null)}))}async load(t,e){const s=new DC(e.modelId,this.models,this._connection);e.userData&&(s.object.userData=e.userData),s.frozen=!0,s.graphicsQuality=this.settings.graphicsQuality;try{if(this.models.list.set(s.modelId,s),await s._setup(t,e.raw,e.virtualModelConfig),this.settings.autoCoordinate){const r=await s.getCoordinates();if(this.baseCoordinates===null)this.baseCoordinates=r;else{const[o,a,l]=r,[c,h,u]=this.baseCoordinates,p=new F(c-o,h-a,u-l);s.object.position.add(p)}}}catch(r){throw this.models.list.delete(s.modelId),r}const{camera:i}=e;return i&&s.useCamera(i),s.frozen=!1,this.onModelLoaded.trigger(s),s}async dispose(){this._isDisposed=!0;const t=Array.from(this.models.list.values()),e=[];for(const s of t)e.push(s.dispose());await Promise.all(e),this.onModelLoaded.reset()}async disposeModel(t){const e=this.models.list.get(t);e&&await e.dispose()}async update(t=!1){if(this._isDisposed)return;const e=performance.now();if(e-this._lastUpdate<this.settings.maxUpdateRate)return;this._lastUpdate=e;const s=[];for(const i of this.models.list.values())s.push(i._refreshView());await Promise.all(s),t?await this.models.forceUpdateFinish():this.models.update()}async manageRequest(t){const e=this.models.list.get(t.modelId);e&&await e.handleRequest(t)}newUpdateEvent(){return()=>{this._autoRedrawInterval&&clearTimeout(this._autoRedrawInterval);const t=this.settings.maxUpdateRate+1;this._autoRedrawInterval=setTimeout((()=>{this.update()}),t)}}newRequestEvent(){return t=>{this.manageRequest(t)}}},cM=class{constructor(t,e){O(this,"_lengthUnitsFactor",1),O(this,"_attributesOffsets",[]),O(this,"_relationsMap",{}),O(this,"_guids",[]),O(this,"_guidsItems",[]),O(this,"_uniqueAttributes",new Set),O(this,"_uniqueRelNames",new Set),O(this,"_ifcApi",null),O(this,"wasm",{path:"/node_modules/web-ifc/",absolute:!1}),O(this,"webIfcSettings",{}),O(this,"expressIDs",[]),O(this,"classes",[]),this._serializer=t,this._builder=e}async getIfcApi(){if(!this._ifcApi){const t=new Wa;t.SetWasmPath(this.wasm.path,this.wasm.absolute),await t.Init(),t.SetLogLevel(pg.LOG_LEVEL_OFF),this._ifcApi=t}return this._ifcApi}async getSchema(t=0){const e=(await this.getIfcApi()).GetModelSchema(t);if(!e)throw new Error("Fragments: IFC Schema not found");return e.startsWith("IFC2X3")?"IFC2X3":e.startsWith("IFC4")&&e.replace("IFC4","")===""?"IFC4":e.startsWith("IFC4X")?"IFC4X3":e}async process(t){var e,s,i;const r=await this.getIfcApi();if(t.readFromCallback)r.OpenModelFromCallback(t.readCallback,this.webIfcSettings);else{if(!t.bytes)throw new Error("Fragments: No data provided");await r.OpenModel(t.bytes,this.webIfcSettings)}this._serializer.replaceStoreyElevation&&await this.setLengthUnitsFactor();const o=r.GetAllTypesOfModel(0).map((M=>M.typeID)),a=await this.getSchema();if(!cL[a])throw new Error("Fragments: Model schema not recognized.");const l=t.geometryProcessedLocalIDs;await this.processItems(l);const c=new Set(l);(e=t.progressCallback)==null||e.call(t,.6,{process:"attributes",state:"start",entitiesProcessed:l.length});const h=new Set([...this._serializer.classes.abstract,...this._serializer.classes.elements]),u=o.filter((M=>h.has(M))),p=.15/u.length;for(const[M,T]of u.entries()){const L=r.GetLineIDsWithType(0,T);if(L.size()===0)continue;const E=[];for(let N=0;N<L.size();N++){const W=L.get(N);c.has(W)||E.push(W)}E.length!==0&&(await this.processItems(E),(s=t.progressCallback)==null||s.call(t,p*(M+1)+.6,{process:"attributes",state:M+1===u.length?"finish":"inProgress",class:bc[T],entitiesProcessed:E.length}))}const d=new Set([...this._serializer.relations.keys()]),g=o.filter((M=>d.has(M))),m=.15/g.length;for(const[M,T]of g.entries()){const L=M===0?"start":M+1===g.length?"finish":"inProgress";await this.processRelations([T]),(i=t.progressCallback)==null||i.call(t,m*(M+1)+.75,{process:"relations",state:L,class:bc[T]})}const{relIndicesVector:b,relsVector:f}=this.getRelationsVector(),{guidsVector:_,guidsItemsVector:y}=this.getGuidsVector(),v=await this.getMetadataOffset(),w=this.getAttributesVector(),I=this.getUniqueAttributesVector(),C=this.getRelNamesVector(),A=ne.createLocalIdsVector(this._builder,this.expressIDs),S=this.getCategoriesVector(),P=await this.getSpatialStructureOffset();return this.clean(),{relIndicesVector:b,relsVector:f,guidsVector:_,guidsItemsVector:y,metadataOffset:v,attributesVector:w,localIdsVector:A,categoriesVector:S,spatialStrutureOffset:P,uniqueAttributesVector:I,relNamesVector:C}}async processItems(t){const e=await this.getIfcApi();for(let s=0;s<t.length;s++){const i=t[s];try{const r=await e.properties.getItemProperties(0,i);if(!r)continue;const o=bc[r.type];this.classes.push(o),this.expressIDs.push(i),await this.serializeAttributes(i,r)}catch(r){console.log(`Problem reading properties for ${i}`),console.log(r),await new Promise((o=>{setTimeout(o,100)}));continue}}}addRelation(t,e,s){this._relationsMap[t]||(this._relationsMap[t]={}),this._relationsMap[t][e]||(this._relationsMap[t][e]=[]);for(const i of s)this._relationsMap[t][e].push(i);this._serializer.includeRelationNames&&this._uniqueRelNames.add(e)}async getStoreyElevation(t,e){const s=await this.getIfcApi(),i=await s.properties.getItemProperties(0,t);let r,o;i?.RelativePlacement&&"value"in i.RelativePlacement&&typeof i.RelativePlacement.value=="number"&&(r=await s.properties.getItemProperties(0,i.RelativePlacement.value)),r?.Location&&"value"in r.Location&&typeof r.Location.value=="number"&&(o=await s.properties.getItemProperties(0,r.Location.value)),o?.Coordinates&&Array.isArray(o.Coordinates)&&"value"in o.Coordinates[2]&&typeof o.Coordinates[2].value=="number"&&(e.value+=o.Coordinates[2].value),i?.PlacementRelTo&&"value"in i.PlacementRelTo&&typeof i.PlacementRelTo.value=="number"&&await this.getStoreyElevation(i.PlacementRelTo.value,e)}async setLengthUnitsFactor(){var t,e,s,i;const r=await this.getIfcApi(),o=r.GetLineIDsWithType(0,hL);if(o.size()!==0)for(let a=0;a<o.size();a++){const l=o.get(a),c=await r.properties.getItemProperties(0,l);for(const h of c.Units){const u=await r.properties.getItemProperties(0,h.value);if(((t=u.UnitType)==null?void 0:t.value)!=="LENGTHUNIT")continue;let p=1,d=1;u.Name.value==="METRE"&&(d=1),u.Name.value==="FOOT"&&(d=.3048),((e=u.Prefix)==null?void 0:e.value)==="MILLI"?p=.001:((s=u.Prefix)==null?void 0:s.value)==="CENTI"?p=.01:((i=u.Prefix)==null?void 0:i.value)==="DECI"&&(p=.1),this._lengthUnitsFactor=d*p}}}async serializeAttributes(t,e){const s=[];let i=null;if(this._serializer.replaceStoreyElevation&&e.type&&typeof e.type=="number"&&e.type===Q_&&e.Elevation&&"value"in e.Elevation){const a={value:0};e.ObjectPlacement&&"value"in e.ObjectPlacement&&typeof e.ObjectPlacement.value=="number"&&await this.getStoreyElevation(e.ObjectPlacement.value,a),e.Elevation.value=a.value*this._lengthUnitsFactor}for(const[a,l]of Object.entries(e)){if(typeof l=="number"||this._serializer.attributesToExclude.has(a)||l==null)continue;if(Array.isArray(l)){const u=l.filter((d=>d.type!==5));if(u.length>0){const d=[a,u.map((f=>f.value))],g="name"in u[0]&&u[0].name?u[0].name:u[0].constructor.name.toUpperCase();d.push(g!=="OBJECT"?g:"UNDEFINED");const m=JSON.stringify(d),b=this._builder.createSharedString(m);s.push(b)}const p=l.filter((d=>d.type===5)).map((d=>d.value));this.addRelation(t,a,p);continue}const{value:c,type:h}=l;if(h===5){if(typeof c!="number")continue;this.addRelation(t,a,[c])}else{if(a==="GlobalId"&&typeof c=="string"){i=c;continue}const u=[a,c],p="name"in l&&l.name?l.name:l.constructor.name.toUpperCase();u.push(p!=="OBJECT"?p:"UNDEFINED");const d=JSON.stringify(u),g=this._builder.createSharedString(d);s.push(g),this._serializer.includeUniqueAttributes&&this._uniqueAttributes.add(d)}}const r=Am.createDataVector(this._builder,s),o=Am.createAttribute(this._builder,r);this._attributesOffsets.push(o),i&&(this._guids.push(i),this._guidsItems.push(t))}getAttributesVector(){return ne.createAttributesVector(this._builder,this._attributesOffsets)}getUniqueAttributesVector(){const t=[];for(const e of this._uniqueAttributes){const s=this._builder.createSharedString(e);t.push(s)}return ne.createUniqueAttributesVector(this._builder,t)}getRelNamesVector(){const t=[];for(const e of this._uniqueRelNames){const s=this._builder.createSharedString(e);t.push(s)}return ne.createRelationNamesVector(this._builder,t)}getGuidsVector(){const t=[];for(const e of this._guids){const s=this._builder.createString(e);t.push(s)}return{guidsVector:ne.createGuidsVector(this._builder,t),guidsItemsVector:ne.createGuidsItemsVector(this._builder,this._guidsItems)}}async processRelations(t){const e=await this.getIfcApi();for(const s of t){const i=this._serializer.relations.get(s);if(!i)continue;const{forRelating:r,forRelated:o}=i,a=e.GetLineIDsWithType(0,s);if(a.size()!==0)for(let l=0;l<a.size();l++){const c=a.get(l),h=await e.properties.getItemProperties(0,c);if(!h)continue;const u=Object.keys(h),p=u.find((b=>b.startsWith("Relating"))),d=u.find((b=>b.startsWith("Related")));if(!p||!d)continue;const g=h[p].value,m=h[d].map((({value:b})=>b));this.addRelation(g,r,m);for(const b of m)this.addRelation(b,o,[g])}}}getRelationsVector(t=!1){const e=[],s=[];for(const[r,o]of Object.entries(this._relationsMap)){if(t&&!this.expressIDs.includes(Number(r)))continue;const a=[];for(const[h,u]of Object.entries(o)){let p=u;if(t&&(p=u.filter((m=>this.expressIDs.includes(m))),p.length===0))continue;const d=JSON.stringify([h,...p]),g=this._builder.createSharedString(d);a.push(g)}if(t&&a.length===0)continue;s.push(Number(r));const l=Sm.createDataVector(this._builder,a),c=Sm.createRelation(this._builder,l);e.push(c)}const i=ne.createRelationsVector(this._builder,e);return{relIndicesVector:ne.createRelationsItemsVector(this._builder,s),relsVector:i}}getCategoriesVector(){const t=this.classes.map((e=>this._builder.createSharedString(e)));return ne.createCategoriesVector(this._builder,t)}async getMetadataOffset(){const t={schema:(await this.getIfcApi()).GetModelSchema(0)};return this._builder.createString(JSON.stringify(t))}getEntityDecomposition(t,e){var s;const i=[];for(const o of e){const a=(s=this._relationsMap[t])==null?void 0:s[o];if(!a)continue;const l={};for(const c of a){const h=this.expressIDs.indexOf(c);if(h===-1)continue;const u=this.classes[h];u&&(l[u]||(l[u]=[]),l[u].push(c))}for(const c in l){const h=l[c].map((g=>this.getEntityDecomposition(g,e))),u=Cs.createChildrenVector(this._builder,h),p=this._builder.createSharedString(c);Cs.startSpatialStructure(this._builder),Cs.addCategory(this._builder,p),Cs.addChildren(this._builder,u);const d=Cs.endSpatialStructure(this._builder);i.push(d)}}const r=Cs.createChildrenVector(this._builder,i);return Cs.startSpatialStructure(this._builder),Cs.addLocalId(this._builder,t),Cs.addChildren(this._builder,r),Cs.endSpatialStructure(this._builder)}async getSpatialStructureOffset(){const t=await this.getIfcApi(),e=X_,s=[...t.GetLineIDsWithType(0,e)].map((o=>this.getEntityDecomposition(o,["IsDecomposedBy","ContainsElements"]))),i=this._builder.createSharedString("IFCPROJECT"),r=Cs.createChildrenVector(this._builder,s);return Cs.startSpatialStructure(this._builder),Cs.addCategory(this._builder,i),Cs.addChildren(this._builder,r),Cs.endSpatialStructure(this._builder)}clean(){var t;(t=this._ifcApi)==null||t.Dispose(),this._ifcApi=null,this._guids=[],this._guidsItems=[],this._attributesOffsets=[],this._relationsMap={},this._uniqueAttributes.clear(),this._uniqueRelNames.clear(),this.expressIDs=[],this.classes=[]}};function le(n,t){return Math.round(n*t)/t}let hM=class{constructor(t,e,s,i){O(this,"x"),O(this,"y"),O(this,"z"),O(this,"hash"),O(this,"id"),this.x=le(t[3*e],i),this.y=le(t[3*e+1],i),this.z=le(t[3*e+2],i),this.hash=`${this.x}/${this.y}/${this.z}`,this.id=s}},uM=class{constructor(t){O(this,"list",new Map),O(this,"tempV1",new F),O(this,"tempV2",new F),O(this,"tempV3",new F),O(this,"precission"),this.precission=t}create(t,e){const s=new hM(t,e,this.list.size,this.precission);return this.list.has(s.hash)||this.list.set(s.hash,s),this.list.get(s.hash)}get(){return Array.from(this.list.values()).map((t=>[t.x,t.y,t.z]))}isValidTriangle(t,e,s,i){this.tempV1.set(t[3*e],t[3*e+1],t[3*e+2]),this.tempV2.set(t[3*s],t[3*s+1],t[3*s+2]),this.tempV3.set(t[3*i],t[3*i+1],t[3*i+2]);const r=1/this.precission*10,o=this.tempV1.distanceTo(this.tempV2)>r,a=this.tempV1.distanceTo(this.tempV3)>r,l=this.tempV2.distanceTo(this.tempV3)>r;return o&&a&&l}},ju=class{constructor(t,e){O(this,"p1"),O(this,"p2"),O(this,"hash"),this.p1=t,this.p2=e;const s=[this.p1,this.p2];s.sort(((i,r)=>i.x-r.x||i.y-r.y||i.z-r.z)),this.hash=`${s[0].hash}_${s[1].hash}`}},dM=class{constructor(t,e){O(this,"edges",new Map),O(this,"openEdges",new Set),O(this,"id"),O(this,"plane"),this.id=t,this.plane=e}add(t){if(this.edges.size!==0)for(const e of t)this.openEdges.has(e.hash)?this.openEdges.delete(e.hash):this.openEdges.add(e.hash),this.edges.set(e.hash,e);else for(const e of t)this.openEdges.add(e.hash),this.edges.set(e.hash,e)}match(t,e){if(e.id!==this.plane.id)return!1;for(const s of t)if(this.openEdges.has(s.hash))return!0;return!1}getOpenEdges(){const t=[];for(const e of this.openEdges)t.push(this.edges.get(e));return t}merge(t){for(const[e,s]of t.edges)this.edges.set(e,s);for(const e of t.openEdges)this.openEdges.has(e)?this.openEdges.delete(e):this.openEdges.add(e)}},pM=class{constructor(){O(this,"list",new Map),O(this,"nextFaceID",0)}add(t,e){const s=this.match(t,e);if(s.length===0){const i=this.nextFaceID++,r=new dM(i,e);return r.add(t),void this.list.set(r.id,r)}if(s.length!==1){if(s.length>1){const i=this.list.get(s[0]);i.add(t);for(let r=1;r<s.length;r++){const o=s[r],a=this.list.get(o);i.merge(a),this.list.delete(o)}}}else this.list.get(s[0]).add(t)}match(t,e){let s=[];for(const i of this.list.values())i.match(t,e)&&s.push(i.id);return s}},fM=class{constructor(t){O(this,"closed",!1),O(this,"openStartPoint",null),O(this,"openEndPoint",null),O(this,"plane"),O(this,"orderedPoints",[]),this.plane=t}getEdges(t=!1){const e=[];if(t)for(let s=this.orderedPoints.length-1;s>0;s--)e.push(new ju(this.orderedPoints[s],this.orderedPoints[s-1]));else for(let s=0;s<this.orderedPoints.length-1;s++)e.push(new ju(this.orderedPoints[s],this.orderedPoints[s+1]));return e}getIndices(){return this.orderedPoints.map((t=>t.id))}add(t){if(this.orderedPoints.length===0)return this.openStartPoint=t.p1.hash,this.openEndPoint=t.p2.hash,void this.orderedPoints.push(t.p1,t.p2);const e=this.match(t);if(e===0)throw new Error("Fragments: Edge doesn't match with any open point");if(e>2)throw new Error("Fragments: Edge matches with more than 2 open points");if(e===2)return this.closed=!0,this.openEndPoint=null,void(this.openStartPoint=null);this.openStartPoint===t.p1.hash?(this.orderedPoints.unshift(t.p2),this.openStartPoint=t.p2.hash):this.openEndPoint===t.p1.hash?(this.orderedPoints.push(t.p2),this.openEndPoint=t.p2.hash):this.openStartPoint===t.p2.hash?(this.orderedPoints.unshift(t.p1),this.openStartPoint=t.p1.hash):this.openEndPoint===t.p2.hash&&(this.orderedPoints.push(t.p1),this.openEndPoint=t.p1.hash)}match(t){if(this.closed)return 0;let e=0;return this.openStartPoint===t.p1.hash&&e++,this.openStartPoint===t.p2.hash&&e++,this.openEndPoint===t.p1.hash&&e++,this.openEndPoint===t.p2.hash&&e++,e}merge(t){if(t.closed||this.closed)throw new Error("Fragments: Cannot merge closed profiles");if(t.openStartPoint===this.openEndPoint&&t.openEndPoint===this.openStartPoint)throw new Error("Fragments: Cannot merge profiles that close each other");if(t.openEndPoint===this.openEndPoint&&t.openStartPoint===this.openStartPoint)throw new Error("Fragments: Cannot merge profiles that close each other");let e=!1;t.openEndPoint!==this.openStartPoint&&t.openEndPoint!==this.openEndPoint||(e=!0);const s=t.getEdges(e);for(const i of s)this.add(i)}getArea(){const t=this.orderedPoints.map((c=>[c.x,c.y,c.z]));let e=0,s=1;const i=Math.abs(this.plane.normal.x),r=Math.abs(this.plane.normal.y),o=Math.abs(this.plane.normal.z);i>=r&&i>=o?(e=1,s=2):r>=i&&r>=o?(e=0,s=2):(e=0,s=1);const a=[];for(const c of t)a.push(new Ut(c[e],c[s]));let l=0;for(let c=0,h=a.length;c<h;c++)l+=a[c].x*a[c===a.length-1?0:c+1].y*.5,l-=a[c===a.length-1?0:c+1].x*a[c].y*.5;return Math.abs(l)}},mM=class{constructor(t){O(this,"list",new Map),O(this,"plane"),O(this,"nextProfileID",0),this.plane=t}add(t){const e=this.match(t);if(e.length===0){const s=this.nextProfileID++,i=new fM(this.plane);return i.add(t),void this.list.set(s,i)}if(e.length!==1){if(e.length>1){const s=this.list.get(e[0]);s.add(t);const i=this.list.get(e[1]);s.merge(i),this.list.delete(e[1])}}else this.list.get(e[0]).add(t)}getProfiles(){let t=null,e=0;for(const[r,o]of this.list){const a=o.getArea();a>e&&(e=a,t=r)}if(t===null)return null;const s=this.list.get(t).getIndices(),i=[];for(const[r,o]of this.list)r!==t&&i.push(o.getIndices());return{profile:s,holes:i}}match(t){const e=[];for(const[s,i]of this.list)i.match(t)>0&&e.push(s);return e}};function y1(n){let t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY;for(let a=0;a<n.length;a+=3){const l=n[a],c=n[a+1],h=n[a+2];l<t&&(t=l),c<e&&(e=c),h<s&&(s=h),l>i&&(i=l),c>r&&(r=c),h>o&&(o=h)}return{min:{x:t,y:e,z:s},max:{x:i,y:r,z:o}}}let gM=class{constructor(t,e,s){O(this,"normal"),O(this,"constant"),O(this,"id"),O(this,"faces",[]);const i=le(t.normal.x,s),r=le(t.normal.y,s),o=le(t.normal.z,s),a=le(t.constant,e);this.normal=new F(i,r,o),this.constant=a;const l="||";this.id=`${i}${l}${r}${l}${o}${l}${a}`}};function v1(n,t,e){const s=new Map,i=new Map,r=(a,l,c)=>{const h=`${a},${l},${c}`;if(s.has(h))return s.get(h)[0];const u=s.size;return s.set(h,[u,a,l,c]),u};for(let a=0;a<n.length-2;a+=3){const l=n[a],c=n[a+1],h=n[a+2],u=t[3*l],p=t[3*l+1],d=t[3*l+2],g=t[3*c],m=t[3*c+1],b=t[3*c+2],f=t[3*h],_=t[3*h+1],y=t[3*h+2],v=r(u,p,d),w=r(g,m,b),I=r(f,_,y);i.set(i.size,[v,w,I])}const o=[];for(const[,[,a,l,c]]of s)o.push([a,l,c]);return{bbox:e,type:Ur.SHELL,profiles:i,holes:new Map,points:o}}let bM=class{read(t){try{const e=t.GetAllAlignments(0),s=[];for(const i of e){const r={absolute:[],horizontal:[],vertical:[]};s.push(r);let o=0;for(let a=0;a<i.horizontal.length;a++){const l=i.curve3D[0].points,c=i.horizontal[a],h=[],u=[],p=this.getCurveType(c.data[1]),d=[],g=[];for(const f of c.points){const{x:_,y,z:v}=l[o++];d.push([_,y,v]),g.push([f.x,f.y])}d.reverse(),g.reverse();for(const[f,_,y]of d)h.push(f,_,y);for(const[f,_]of g)u.push(f,0,-_);const m=new Float32Array(h),b=new Float32Array(u);r.absolute.push({points:m,type:p}),r.horizontal.push({points:b,type:p})}for(let a=0;a<i.vertical.length;a++){const l=i.vertical[a],c=[],h=this.getCurveType(l.data[1]),u=[];for(const d of l.points)u.push([d.x,d.y]);u.reverse();for(const[d,g]of u)c.push(d,g,0);const p=new Float32Array(c);r.vertical.push({points:p,type:h})}}return s}catch(e){return console.error(e),[]}}getCurveType(t){if(t.includes("CIRCULARARC"))return Pn.ELLIPSE_ARC;if(t.includes("LINE")||t.includes("GRADIENT"))return Pn.LINES;if(t.includes("CLOTHOID"))return Pn.CLOTHOID;if(t.includes("PARABOLICARC"))return Pn.PARABOLA;throw new Error(`Fragments: Unknown curve type: ${t}`)}},_M=class{constructor(t){O(this,"_ifcAPI",null),O(this,"wasm",{path:"../../../../node_modules/web-ifc/",absolute:!1}),O(this,"webIfcSettings",{}),O(this,"_tempObject1",new Oi),O(this,"_tempObject2",new Oi),O(this,"_tempMatrix1",new xt),O(this,"_previousGeometries",new Map),O(this,"_previousGeometriesIDs",new Map),O(this,"_previousGeometriesScales",new Map),O(this,"_previousLocalTransforms",new Map),O(this,"_problematicGeometries",new Set),O(this,"_problematicGeometriesHashes",new Set),O(this,"_coordinatesInitialized",!1),O(this,"_civilReader",new bM),O(this,"_maxId",0),O(this,"_rawCategories",new Set([yC,_C])),O(this,"scene",null),O(this,"isolatedMeshes",null),O(this,"onElementLoaded",(()=>{})),O(this,"onGeometryLoaded",(()=>{})),O(this,"onLocalTransformLoaded",(()=>{})),O(this,"onMaxIdFound",(()=>{})),O(this,"onCoordinatesLoaded",(()=>{})),O(this,"onAlignmentsLoaded",(()=>{})),this._serializer=t}async load(t){var e,s,i;(e=t.progressCallback)==null||e.call(t,0,{process:"conversion",state:"start"}),this._previousGeometriesIDs.clear(),this._ifcAPI=new Wa,this._ifcAPI.SetWasmPath(this.wasm.path,this.wasm.absolute),await this._ifcAPI.Init();let r=0;if(t.readFromCallback&&t.readCallback)r=this._ifcAPI.OpenModelFromCallback(t.readCallback,this.webIfcSettings);else{if(!t.bytes)throw new Error("Fragments: No data provided");r=await this._ifcAPI.OpenModel(t.bytes,this.webIfcSettings)}this._ifcAPI.SetLogLevel(pg.LOG_LEVEL_OFF),this._maxId=this._ifcAPI.GetMaxExpressID(r),this.onLocalTransformLoaded({id:0,data:[0,0,0,1,0,0,0,1,0]});const o=new F,a=c=>{if(this._ifcAPI===null)throw new Error("Fragments: IfcAPI not initialized");if(!this._coordinatesInitialized){const S=this._ifcAPI.GetCoordinationMatrix(r);this._tempMatrix1.fromArray(S);const P=this.decompose(this._tempMatrix1);this.onCoordinatesLoaded(P),this._coordinatesInitialized=!0}const h=this._ifcAPI.GetLine(0,c.expressID),u={id:c.expressID,type:h.type,guid:h.GlobalId.value,geometries:[]},p=c.geometries.size(),d=c.geometries.get(0).flatTransformation,{transformWithoutScale:g}=this.removeScale(d),m=this._serializer.distanceThreshold;if(m!==null&&(o.set(0,0,0),o.applyMatrix4(g),o.x>m||o.y>m||o.z>m))return void console.log(`Object ${u.id} is more than ${m} meters away from the origin and will be skipped.`);for(let S=0;S<p;S++)u.type===bC?this.loadCircleExtrusionGeometry(r,u,c,S,g.elements):this.loadShellGeometry(r,u,c,S,g.elements);const{dxx:b,dxy:f,dxz:_,dyx:y,dyy:v,dyz:w,px:I,py:C,pz:A}=this.decompose(g);u.geometries.length>0&&this.onElementLoaded({element:u,position:[I,C,A],xDirection:[b,f,_],yDirection:[y,v,w]})};if((s=this.isolatedMeshes)!=null&&s.size)this._ifcAPI.StreamMeshes(r,Array.from(this.isolatedMeshes),a);else{const c=this._ifcAPI.GetAllTypesOfModel(r).map((u=>u.typeID)).filter((u=>this._serializer.classes.elements.has(u))),h=.5/c.length;for(const[u,p]of c.entries()){const d=u===0?"start":u+1===c.length?"finish":"inProgress",g=this._ifcAPI.GetLineIDsWithType(r,p),m=[];for(let b=0;b<g.size();b++)m.push(g.get(b));m.length>0&&(this._ifcAPI.StreamMeshes(r,m,a),(i=t.progressCallback)==null||i.call(t,h*(u+1),{process:"geometries",state:d,class:bc[p],entitiesProcessed:m.length}))}}const l=this._civilReader.read(this._ifcAPI);this.onAlignmentsLoaded(l),this.onMaxIdFound(this._maxId),this._ifcAPI.Dispose(),this._ifcAPI=null,this._ifcAPI=new Wa,this._ifcAPI.SetWasmPath(this.wasm.path,this.wasm.absolute),await this._ifcAPI.Init(),this._previousGeometries.clear(),this._previousGeometriesIDs.clear(),this._previousGeometriesScales.clear(),this._maxId=0,this._previousLocalTransforms.clear(),this._problematicGeometries.clear(),this._problematicGeometriesHashes.clear()}loadCircleExtrusionGeometry(t,e,s,i,r){if(this._ifcAPI===null)throw new Error("Fragments: IfcAPI not initialized");const o=s.geometries.get(i),a=o.flatTransformation,{units:l}=this.removeScale(a),{x:c,y:h,z:u,w:p}=o.color,d={id:o.geometryExpressID,color:[c,h,u,p],localTransformID:null};e.geometries.push(d);const{transformWithoutScale:g}=this.removeScale(o.flatTransformation);if(this._previousGeometriesIDs.has(d.id))return this.getLocalTransform(r,g,d),void(d.id=this._previousGeometriesIDs.get(d.id));this.getLocalTransform(r,g,d);const m=this._ifcAPI.GetGeometry(t,d.id),b=m.GetSweptDiskSolid(),f=[],_=[],y=b.axis.size();for(let T=0;T<y;T++){const L=b.axis.get(T),E=[];for(let W=0;W<L.arcSegments.size();W++)E.push(L.arcSegments.get(W));f.push(E);const N=[];for(let W=0;W<L.points.size();W++){const V=L.points.get(W);N.push({x:V.x*l.x,y:V.y*l.y,z:V.z*l.z})}_.push(N)}const v=[],w=[],I=[],C=[];for(let T=0;T<_.length;T++){const L=_[T],E=f[T],N=L.length;for(let W=0;W<N-1;W++){let V=-1,et=-1;for(let j=0;j<E.length;j+=2)if(E[j]===W){V=W,et=E[j+1];break}if(V===-1){const j=[],nt=L[W],H=L[W+1],B=nt.x,rt=nt.y,Q=nt.z,st=H.x,ct=H.y,_t=H.z;v.push(I.length),j.push(B,rt,Q,st,ct,_t),I.push(j),w.push($e.WIRE)}else{const j=[],nt=V,H=Math.round((V+et)/2),B=et,rt=L[nt],Q=L[H],st=L[B],ct=this.computeCircleCurveProperties(rt,Q,st),_t=rt.x-ct.center.x,ut=rt.y-ct.center.y,pt=rt.z-ct.center.z;let bt=Math.sqrt(_t*_t+ut*ut+pt*pt);bt===0&&(bt=1);const wt=_t/bt,St=ut/bt,Rt=pt/bt,x=Q.x-ct.center.x,Z=Q.y-ct.center.y,Y=Q.z-ct.center.z;let $=Math.sqrt(x*x+Z*Z+Y*Y);$===0&&($=1);const R=x/$,U=Z/$,tt=Y/$;let K=this.crossProduct({x:wt,y:St,z:Rt},{x:R,y:U,z:tt});bt=Math.sqrt(K.x*K.x+K.y*K.y+K.z*K.z),bt===0&&(bt=1),K={x:K.x/bt,y:K.y/bt,z:K.z/bt},v.push(C.length),j.push(ct.center.x,ct.center.y,ct.center.z,ct.radius,ct.angle,wt,St,Rt,K.x,K.y,K.z),C.push(j),w.push($e.CIRCLE_CURVE),W=B-1}}}const A=this.getGeometryBuffers(t,o);if(A===null)return console.log(`Zero length geometry: ${d.id}`),e.geometries.pop(),void this._problematicGeometries.add(d.id);const{position:S}=A;for(let T=0;T<S.length-2;T+=3)S[T]*=l.x,S[T+1]*=l.y,S[T+2]*=l.z;const P=y1(S),M=b.profileRadius*l.x;this._previousGeometriesIDs.set(d.id,d.id),this.onGeometryLoaded({id:d.id,geometry:{type:Ur.CIRCLE_EXTRUSION,indicesArray:v,typesArray:w,segments:I,circleCurveData:C,radius:M,bbox:P}}),m.delete()}loadShellGeometry(t,e,s,i,r){if(this._ifcAPI===null)throw new Error("Fragments: IfcAPI not initialized");const o=s.geometries.get(i),a=o.flatTransformation,{units:l}=this.removeScale(a);if(this._problematicGeometries.has(o.geometryExpressID))return void console.log(` Problematic geometry: ${o.geometryExpressID}`);const{x:c,y:h,z:u,w:p}=o.color,d={id:o.geometryExpressID,color:[c,h,u,p],localTransformID:null};e.geometries.push(d);const{transformWithoutScale:g}=this.removeScale(o.flatTransformation);if(this._previousGeometriesIDs.has(d.id)){const Q=this.getScaleHash(l);if(this._previousGeometriesScales.get(d.id)===Q)return this.getLocalTransform(r,g,d),void(d.id=this._previousGeometriesIDs.get(d.id));const st=++this._maxId;this._previousGeometriesScales.set(st,Q),d.id=st}const m=this.getGeometryBuffers(t,o);if(m===null)return console.log(`Zero length geometry: ${d.id}`),e.geometries.pop(),void this._problematicGeometries.add(d.id);const{position:b,normals:f,index:_}=m;for(let Q=0;Q<b.length-2;Q+=3)b[Q]*=l.x,b[Q+1]*=l.y,b[Q+2]*=l.z;const y=b.length/3,v=_.length/3;let w=0,I=0;const C=new ns,A=new F,S=new F,P=new F,M=this.getVolume(_,b),T=new F;for(let Q=0;Q<_.length-2;Q+=3){const st=_[Q],ct=_[Q+1],_t=_[Q+2];A.set(b[3*st],b[3*st+1],b[3*st+2]),S.set(b[3*ct],b[3*ct+1],b[3*ct+2]),P.set(b[3*_t],b[3*_t+1],b[3*_t+2]),T.add(A),T.add(S),T.add(P),C.set(A,S,P);const ut=C.getArea();ut>w&&(w=ut),I+=ut}T.divideScalar(_.length),A.set(b[0],b[1],b[2]),S.set(b[3],b[4],b[5]),P.set(b[6],b[7],b[8]);const L=1e4,E=le(I,L),N=le(w,L),W=le(M,L),V=le(A.x,L),et=le(A.y,L),j=le(A.z,L),nt=`${y}-${v}-${E}-${N}-${W}-${le(T.x,L)}-${le(T.x,L)}-${le(T.x,L)}-${V}-${et}-${j}`;if(this._problematicGeometriesHashes.has(nt))return console.log(`Problematic geometry: ${d.id}`),e.geometries.pop(),this._problematicGeometries.add(d.id),void this._problematicGeometriesHashes.add(nt);const H=!this._previousGeometries.has(nt),B=d.id;if(H)this._previousGeometries.set(nt,B),this._previousGeometriesIDs.set(B,B);else{const Q=this._previousGeometries.get(nt);if(Q===void 0)throw new Error("Fragments: Previous geometry not found");this._previousGeometriesIDs.set(B,Q),d.id=Q}this.getLocalTransform(r,g,d);const rt=this._rawCategories.has(e.type);if(H)try{const Q=(function(st){const{position:ct,normals:_t,index:ut,raw:pt}=st,bt=ct.length/3>3e3,wt=y1(ct);if(pt||bt)return v1(ut,ct,wt);const St=new Wt,Rt=new F,x=new F,Z=new Map;for(let K=0;K<ut.length-2;K+=3){const D=ut[K];Rt.set(_t[3*D],_t[3*D+1],_t[3*D+2]),x.set(ct[3*D],ct[3*D+1],ct[3*D+2]),St.setFromNormalAndCoplanarPoint(Rt,x);const J=new gM(St,1e3,1e7);Z.has(J.id)||Z.set(J.id,J),Z.get(J.id).faces.push(K)}const Y=new uM(1e6),$=new pM;for(const[,K]of Z)for(const D of K.faces){const J=ut[D],it=ut[D+1],X=ut[D+2];if(!Y.isValidTriangle(ct,J,it,X))continue;const lt=Y.create(ct,J),vt=Y.create(ct,it),gt=Y.create(ct,X),Ft=[new ju(lt,vt),new ju(vt,gt),new ju(gt,lt)];$.add(Ft,K)}const R=new Map,U=new Map;let tt=0;for(const[,K]of $.list){const D=new mM(K.plane),J=K.getOpenEdges();if(J.length===0)return console.log("No open edges found. Using raw geometry."),v1(ut,ct,wt);for(const X of J)D.add(X);const it=D.getProfiles();R.set(tt,it?.profile||[]),U.set(tt,it?.holes||[]),tt++}return{bbox:wt,type:Ur.SHELL,profiles:R,holes:U,points:Y.get()}})({position:b,normals:f,index:_,raw:rt});this.onGeometryLoaded({id:d.id,geometry:Q})}catch{console.error(`Fragments: Problematic geometry: ${d.id}`),e.geometries.pop(),this._problematicGeometries.add(d.id),this._problematicGeometriesHashes.add(nt)}}getScaleHash(t){return`${t.x}-${t.y}-${t.z}`}getLocalTransform(t,e,s){this._tempObject1.position.set(0,0,0),this._tempObject1.rotation.set(0,0,0),this._tempObject1.scale.set(1,1,1),this._tempObject1.updateMatrix(),this._tempMatrix1.fromArray(t),this._tempObject1.applyMatrix4(this._tempMatrix1),this._tempObject2.position.set(0,0,0),this._tempObject2.rotation.set(0,0,0),this._tempObject2.scale.set(1,1,1),this._tempObject2.updateMatrix(),this._tempObject2.applyMatrix4(e),this._tempObject1.attach(this._tempObject2);const{px:i,py:r,pz:o,dxx:a,dxy:l,dxz:c,dyx:h,dyy:u,dyz:p}=this.decompose(this._tempObject2.matrix);if(this._tempObject2.removeFromParent(),!(i===0&&r===0&&o===0&&a===1&&l===0&&c===0&&h===0&&u===1&&p===0)){const d=`${i}-${r}-${o}-${a}-${l}-${c}-${h}-${u}-${p}`,g=this._previousLocalTransforms.get(d);if(g)s.localTransformID=g.id;else{const m={id:this._previousLocalTransforms.size+1,data:[i,r,o,a,l,c,h,u,p]};this._previousLocalTransforms.set(d,m),s.localTransformID=m.id,this.onLocalTransformLoaded(m)}}}removeScale(t){const e=new xt().fromArray(t),s=new F,i=new Pe,r=new F;e.decompose(s,i,r);const o=r,a=new xt;return a.compose(s,i,new F(1,1,1)),{units:o,transformWithoutScale:a}}decompose(t){return{dxx:le(t.elements[0],1e3),dxy:le(t.elements[1],1e3),dxz:le(t.elements[2],1e3),dyx:le(t.elements[4],1e5),dyy:le(t.elements[5],1e5),dyz:le(t.elements[6],1e5),dzx:le(t.elements[8],1e5),dzy:le(t.elements[9],1e5),dzz:le(t.elements[10],1e5),px:le(t.elements[12],1e5),py:le(t.elements[13],1e5),pz:le(t.elements[14],1e5)}}getVolume(t,e){let s=0;const i=new F,r=new F,o=new F;for(let a=0;a<t.length-2;a+=3){const l=3*t[a],c=3*t[a+1],h=3*t[a+2];i.set(e[l],e[l+1],e[l+2]),r.set(e[c],e[c+1],e[c+2]),o.set(e[h],e[h+1],e[h+2]),s+=this.getSignedVolumeOfTriangle(i,r,o)}return Math.abs(s)}getSignedVolumeOfTriangle(t,e,s){return 1/6*(-(s.x*e.y*t.z)+e.x*s.y*t.z+s.x*t.y*e.z-t.x*s.y*e.z-e.x*t.y*s.z+t.x*e.y*s.z)}getGeometryBuffers(t,e){if(!this._ifcAPI)throw new Error("Fragments: IfcAPI not initialized");const s=this._ifcAPI.GetGeometry(t,e.geometryExpressID),i=this._ifcAPI.GetIndexArray(s.GetIndexData(),s.GetIndexDataSize()),r=this._ifcAPI.GetVertexArray(s.GetVertexData(),s.GetVertexDataSize());if(i.length===0||r.length===0)return s.delete(),null;const o=new Float32Array(r.length/2),a=new Float32Array(r.length/2);for(let l=0;l<r.length;l+=6)o[l/2]=r[l],o[l/2+1]=r[l+1],o[l/2+2]=r[l+2],a[l/2]=r[l+3],a[l/2+1]=r[l+4],a[l/2+2]=r[l+5];return s.delete(),{position:o,normals:a,index:i}}crossProduct(t,e){return{x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}}computeCircleCurveProperties(t,e,s){function i(m,b){return{x:m.x-b.x,y:m.y-b.y,z:m.z-b.z}}function r(m){return Math.sqrt(m.x*m.x+m.y*m.y+m.z*m.z)}const o=i(e,t),a=i(s,e),l=this.crossProduct(o,a),c=(function(m,b,f){const _=b.x-m.x,y=b.y-m.y,v=b.z-m.z,w=f.x-m.x,I=f.y-m.y,C=f.z-m.z,A=.5*(_**2+y**2+v**2),S=.5*(w**2+I**2+C**2),P=_*I-y*w,M=y*C-v*I,T=v*w-_*C,L=A*w-S*_,E=A*I-S*y,N=A*C-S*v,W=P**2+M**2+T**2;if(W===0)throw new Error("Fragments: Points are collinear, no unique circle exists.");return{x:m.x+(P*E-T*N)/W,y:m.y+(M*N-P*L)/W,z:m.z+(T*L-M*E)/W}})(t,e,s),h=i(t,c),u=i(s,c),p=r(i(c,t)),d=i(t,c),g=r(d);return d.x/=g,d.y/=g,d.z/=g,{center:c,radius:p,normal:l,initialTangent:d,angle:180*Math.acos((h.x*u.x+h.y*u.y+h.z*u.z)/(r(h)*r(u)))/Math.PI}}},yM=class{constructor(t){O(this,"wasm",{path:"../../../../node_modules/web-ifc/",absolute:!1}),O(this,"webIfcSettings",{}),O(this,"_serializer"),this._serializer=t}async process(t){const{builder:e}=t;let s=0;const i=[];let r={dxx:1,dxy:0,dxz:0,dyx:0,dyy:1,dyz:0,px:0,py:0,pz:0};const o=[],a=[],l=[],c=[],h=new Map,u=new Map,p=new Map,d=new _M(this._serializer);d.wasm=this.wasm,d.webIfcSettings=this.webIfcSettings,d.onGeometryLoaded=D=>{o.push(D)},d.onElementLoaded=D=>{l.push(D)},d.onLocalTransformLoaded=D=>{c.push(D)},d.onCoordinatesLoaded=D=>{r=D},d.onMaxIdFound=D=>{s=D},d.onAlignmentsLoaded=D=>{for(const J of D)a.push(J)},await d.load(t);const g=[];let m=0;je.startGlobalTransformsVector(e,l.length);const b=new Map,f=[];for(let D=0;D<l.length;D++){const J=l[l.length-1-D];g.push(m++);const{position:it,xDirection:X,yDirection:lt}=J,[vt,gt,Ft]=it,[ue,Gt,ge]=X,[Pt,Ls,ci]=lt;i.push(l[D].element.id);const ve=l.length-1-D,yn=J.element.type,vn=bc[yn];b.has(vn)||b.set(vn,b.size),ur.createTransform(e,vt,gt,Ft,ue,Gt,ge,Pt,Ls,ci),b.get(vn),f.unshift(J.element.id),h.set(J.element.id,ve)}const _=e.endVector(),y=[];for(let D=0;D<o.length;D++){const J=o[D];if(J.geometry.type!==Ur.SHELL)continue;const{points:it,profiles:X,holes:lt}=J.geometry,vt=65e3,gt=it.length>vt,Ft=gt?ms.BIG:ms.NONE;ji.startPointsVector(e,it.length);for(let ys=0;ys<it.length;ys++){const[$s,Re,Ye]=it[it.length-1-ys];rs.createFloatVector(e,$s,Re,Ye)}const ue=e.endVector(),Gt=[],ge=[],Pt=[],Ls=[];for(const[,ys]of X){if(gt){const Ye=Mo.createIndicesVector(e,ys),Er=Mo.createBigShellProfile(e,Ye);Pt.push(Er);continue}const $s=Do.createIndicesVector(e,ys),Re=Do.createShellProfile(e,$s);Gt.push(Re)}const ci=ji.createBigProfilesVector(e,Pt),ve=ji.createProfilesVector(e,Gt);for(const[ys,$s]of lt)if(gt)for(const Re of $s){const Ye=Ya.createIndicesVector(e,Re),Er=Ya.createBigShellHole(e,Ye,ys);Ls.push(Er)}else for(const Re of $s){const Ye=Ga.createIndicesVector(e,Re),Er=Ga.createShellHole(e,Ye,ys);ge.push(Er)}const yn=ji.createBigHolesVector(e,Ls),vn=ji.createHolesVector(e,ge),hi=ji.createShell(e,ve,vn,ue,ci,yn,Ft);y.push(hi)}const v=je.createShellsVector(e,y),w=[];for(let D=0;D<o.length;D++){const J=o[D];if(J.geometry.type!==Ur.CIRCLE_EXTRUSION)continue;const it=[],{radius:X,indicesArray:lt,typesArray:vt,segments:gt,circleCurveData:Ft}=J.geometry;hs.startCircleCurvesVector(e,Ft.length);for(let hi=0;hi<Ft.length;hi++){const[ys,$s,Re,Ye,Er,ab,QP,KP,JP,t3,e3]=Ft[hi];zd.createCircleCurve(e,Er/360*2*Math.PI,ys,$s,Re,Ye,JP,t3,e3,ab,QP,KP)}const ue=e.endVector();hs.startWiresVector(e,gt.length);for(let hi=0;hi<gt.length;hi++){const[ys,$s,Re,Ye,Er,ab]=gt[hi];fg.createWire(e,ys,$s,Re,Ye,Er,ab)}const Gt=e.endVector(),ge=hs.createOrderVector(e,lt),Pt=hs.createPartsVector(e,vt);hs.startWireSetsVector(e,0);const Ls=e.endVector();hs.startAxis(e),hs.addCircleCurves(e,ue),hs.addOrder(e,ge),hs.addWires(e,Gt),hs.addWireSets(e,Ls),hs.addParts(e,Pt);const ci=hs.endAxis(e);it.push(ci);const ve=Hi.createAxesVector(e,it),yn=Hi.createRadiusVector(e,[X]);Hi.startCircleExtrusion(e),Hi.addAxes(e,ve),Hi.addRadius(e,yn);const vn=Hi.endCircleExtrusion(e);w.push(vn)}const I=je.createCircleExtrusionsVector(e,w);je.startRepresentationsVector(e,o.length);const C=new Map;for(let D=0;D<o.length;D++){const J=o.length-1-D,it=o[J].geometry.type;let X=C.get(it);X===void 0&&(X=-1),C.set(it,X+1)}const A=new F,S=new F;for(let D=0;D<o.length;D++){const J=o.length-1-D,it=o[J],{bbox:X}=it.geometry;u.set(it.id,J);const lt=it.geometry.type,vt=C.get(lt);if(vt===void 0)throw new Error("Fragments: Malformed geometry definition");C.set(lt,vt-1),A.set(X.min.x,X.min.y,X.min.z),S.set(X.max.x,X.max.y,X.max.z),A.distanceTo(S)>999999&&(console.log(`Infinity bounding box: ${it.id}`),X.min.x=0,X.min.y=0,X.min.z=0,X.max.x=.1,X.max.y=.1,X.max.z=.1),Xc.createRepresentation(e,vt,X.min.x,X.min.y,X.min.z,X.max.x,X.max.y,X.max.z,it.geometry.type)}const P=e.endVector();let M=0;for(const D of l)for(const J of D.element.geometries){const it=J.color.toString();if(!p.has(it)){const X=J.color.map((lt=>255*lt));p.set(it,{id:M++,color:X})}}je.startMaterialsVector(e,p.size);const T=Array.from(p.keys());for(let D=0;D<T.length;D++){const J=T[T.length-1-D],{color:it}=p.get(J),[X,lt,vt,gt]=it;Qy.createMaterial(e,X,lt,vt,gt,il.ONE,0)}const L=e.endVector();let E=0;for(const D of l)E+=D.element.geometries.length;je.startSamplesVector(e,E);for(let D=0;D<l.length;D++){const J=l[l.length-1-D],it=h.get(J.element.id),X=J.element.geometries;for(let lt=0;lt<X.length;lt++){const vt=X[X.length-lt-1],gt=u.get(vt.id),Ft=p.get(vt.color.toString()).id,ue=vt.localTransformID||0;Qc.createSample(e,it,Ft,gt,ue)}}const N=e.endVector();je.startLocalTransformsVector(e,c.length);for(let D=0;D<c.length;D++){const J=c[c.length-1-D],[it,X,lt,vt,gt,Ft,ue,Gt,ge]=J.data;ur.createTransform(e,it,X,lt,vt,gt,Ft,ue,Gt,ge)}const W=e.endVector(),V=je.createMeshesItemsVector(e,g),et=ur.createTransform(e,r.px,r.py,r.pz,r.dxx,r.dxy,r.dxz,r.dyx,r.dyy,r.dyz);je.startMeshes(e),je.addCoordinates(e,et),je.addGlobalTransforms(e,_),je.addShells(e,v),je.addRepresentations(e,P),je.addSamples(e,N),je.addLocalTransforms(e,W),je.addMaterials(e,L),je.addCircleExtrusions(e,I),je.addMeshesItems(e,V);const j=je.endMeshes(e),nt=[],H=new Map,B=new Map,rt=new Map;let Q=0;for(let D=0;D<a.length;D++){const J=D,it=a[J],X=[];H.set(J,X);const lt=[];B.set(J,lt);const vt=[];rt.set(J,vt);for(let gt=0;gt<it.absolute.length;gt++){const Ft=it.absolute[it.absolute.length-1-gt],{points:ue}=Ft,Gt=ei.createPointsVector(e,ue);ei.startGeometryLines(e),ei.addPoints(e,Gt);const ge=ei.endGeometryLines(e);nt.push(ge),X.push(Q++)}for(let gt=0;gt<it.horizontal.length;gt++){const Ft=it.horizontal[it.horizontal.length-1-gt],{points:ue}=Ft,Gt=ei.createPointsVector(e,ue);ei.startGeometryLines(e),ei.addPoints(e,Gt);const ge=ei.endGeometryLines(e);nt.push(ge),lt.push(Q++)}for(let gt=0;gt<it.vertical.length;gt++){const Ft=it.vertical[it.vertical.length-1-gt],{points:ue}=Ft,Gt=ei.createPointsVector(e,ue);ei.startGeometryLines(e),ei.addPoints(e,Gt);const ge=ei.endGeometryLines(e);nt.push(ge),vt.push(Q++)}}const st=He.createLinesVector(e,nt);let ct=Q;He.startRepresentationsVector(e,ct);const _t=[];ct--;for(let D=0;D<a.length;D++){const J=a.length-1-D,it=a[J];for(let X=0;X<it.absolute.length;X++){const lt=it.absolute[it.absolute.length-1-X],{type:vt}=lt;_t.unshift(s++);const gt=ct--;Ru.createGeometryRepresentation(e,gt,vt)}for(let X=0;X<it.horizontal.length;X++){const lt=it.horizontal[it.horizontal.length-1-X],{type:vt}=lt;_t.unshift(s++);const gt=ct--;Ru.createGeometryRepresentation(e,gt,vt)}for(let X=0;X<it.vertical.length;X++){const lt=it.vertical[it.vertical.length-1-X],{type:vt}=lt;_t.unshift(s++);const gt=ct--;Ru.createGeometryRepresentation(e,gt,vt)}}const ut=e.endVector();let pt=Q;const bt=[];He.startSamplesVector(e,pt),pt--;for(let D=0;D<a.length;D++){const J=a.length-1-D,it=a[J];for(let X=0;X<it.absolute.length;X++){const lt=pt--;bt.unshift(s++),Fu.createGeometrySample(e,lt,0)}for(let X=0;X<it.horizontal.length;X++){const lt=pt--;bt.unshift(s++),Fu.createGeometrySample(e,lt,0)}for(let X=0;X<it.vertical.length;X++){const lt=pt--;bt.unshift(s++),Fu.createGeometrySample(e,lt,0)}}const wt=e.endVector();He.startTransformsVector(e,1),ur.createTransform(e,0,0,0,1,0,0,0,1,0);const St=e.endVector(),Rt=[s++];He.startWallsVector(e,0);const x=e.endVector();He.startRepresentationsSamplesVector(e,0);const Z=e.endVector(),Y=He.createRepresentationIdsVector(e,_t),$=He.createSampleIdsVector(e,bt),R=He.createRepresentationsSamplesVector(e,Rt);He.startGeometries(e),He.addSamples(e,wt),He.addSampleIds(e,$),He.addRepresentations(e,ut),He.addRepresentationIds(e,Y),He.addTransforms(e,St),He.addTransformIds(e,R),He.addRepresentationsSamples(e,Z),He.addLines(e,st),He.addWalls(e,x);const U=He.endGeometries(e),tt=[];for(let D=0;D<a.length;D++){const J=H.get(D),it=B.get(D),X=rt.get(D);if(J===void 0||it===void 0||X===void 0)throw new Error("Fragments: Malformed alignment definition");const lt=uc.createAbsoluteVector(e,J),vt=uc.createHorizontalVector(e,it),gt=uc.createVerticalVector(e,X),Ft=uc.createAlignment(e,lt,vt,gt);tt.push(Ft)}const K=ne.createAlignmentsVector(e,tt);return{modelMesh:j,localIDs:i,maxLocalID:s,modelGeometries:U,modelAlignments:K}}};const vu={base:new Set([X_,gw,bw,Q_]),materials:new Set([JF,tL,eL,sL,iL,nL,rL,oL,aL,lL]),properties:new Set([HF,jF,WF,YF,GF,qF,ZF,XF,QF,KF]),types:new Set([uL,dL,pL,fL,mL,gL,bL,_L,yL,vL,wL,EL,xL,IL,CL,TL,AL,SL,OL,PL,RL,FL,LL,$L,NL,ML,DL,kL,zL]),elements:new Set([X_,gw,bw,Q_,p3,f3,m3,g3,b3,_3,y3,v3,w3,E3,x3,I3,C3,T3,A3,S3,O3,P3,R3,F3,L3,$3,N3,M3,D3,k3,z3,B3,U3,V3,H3,j3,W3,Y3,G3,bC,q3,Z3,X3,Q3,K3,J3,tR,eR,sR,iR,nR,rR,oR,aR,lR,cR,hR,uR,dR,pR,fR,mR,gR,bR,_R,yR,vR,wR,ER,xR,IR,CR,TR,AR,SR,OR,PR,RR,FR,LR,$R,NR,MR,DR,kR,zR,BR,UR,VR,HR,jR,WR,YR,GR,qR,ZR,XR,QR,KR,JR,tF,eF,sF,iF,nF,rF,oF,aF,lF,cF,hF,uF,dF,pF,fF,mF,gF,bF,_F,yF,vF,wF,EF,xF,IF,CF,TF,AF,SF,OF,PF,RF,FF,LF,$F,NF,MF,DF,_C,yC,kF,zF,BF,UF,VF])};let rv=class{constructor(){O(this,"_builder",null),O(this,"wasm",{path:"/node_modules/web-ifc/",absolute:!1}),O(this,"webIfcSettings",{COORDINATE_TO_ORIGIN:!0}),O(this,"attributesToExclude",new Set(["Representation","ObjectPlacement","CompositionType","OwnerHistory"])),O(this,"relations",new Map([[c3,{forRelating:"DefinesOcurrence",forRelated:"IsDefinedBy"}],[h3,{forRelated:"HasAssociations",forRelating:"AssociatedTo"}],[u3,{forRelated:"Decomposes",forRelating:"IsDecomposedBy"}],[d3,{forRelated:"ContainedInStructure",forRelating:"ContainsElements"}]])),O(this,"classes",{elements:new fe([...vu.elements]),abstract:new fe([...vu.base,...vu.materials,...vu.properties])}),O(this,"includeUniqueAttributes",!1),O(this,"includeRelationNames",!1),O(this,"replaceStoreyElevation",!0),O(this,"distanceThreshold",1e5)}get builder(){if(!this._builder)throw new Error("Fragments: Builder not initialized");return this._builder}async process(t){var e;this._builder=new VL(1024);const s=new yM(this);s.wasm=this.wasm,s.webIfcSettings=this.webIfcSettings;const i={...t,builder:this.builder},r=await s.process(i),{modelMesh:o,maxLocalID:a,localIDs:l,modelGeometries:c,modelAlignments:h}=r,u=new cM(this,this.builder);u.wasm=this.wasm,u.webIfcSettings=this.webIfcSettings;const p={...t,geometryProcessedLocalIDs:l},d=await u.process(p),{relIndicesVector:g,relsVector:m,guidsVector:b,guidsItemsVector:f,metadataOffset:_,localIdsVector:y,spatialStrutureOffset:v,attributesVector:w,categoriesVector:I,uniqueAttributesVector:C,relNamesVector:A}=d,S=t.id??kd.generateUUID(),P=this.builder.createString(S);ne.startModel(this.builder),ne.addMeshes(this.builder,o),ne.addMetadata(this.builder,_),ne.addAttributes(this.builder,w),ne.addUniqueAttributes(this.builder,C),ne.addRelationNames(this.builder,A),ne.addLocalIds(this.builder,y),ne.addCategories(this.builder,I),ne.addRelationsItems(this.builder,g),ne.addRelations(this.builder,m),ne.addGuidsItems(this.builder,f),ne.addGuids(this.builder,b),ne.addSpatialStructure(this.builder,v),ne.addGuid(this.builder,P),ne.addMaxLocalId(this.builder,a),ne.addGeometries(this.builder,c),ne.addAlignments(this.builder,h);const M=ne.endModel(this.builder);this.builder.finish(M);const T=this.builder.asUint8Array();this.clean();const L=t.raw?T:sv.deflate(T);return(e=t.progressCallback)==null||e.call(t,1,{process:"conversion",state:"finish"}),L}clean(){var t;(t=this._builder)==null||t.clear(),this._builder=null}};const Nq=Object.freeze(Object.defineProperty({__proto__:null,Alignment:uc,AsyncEvent:UL,Attribute:Am,Axis:hs,AxisPartClass:$e,BigShellHole:Ya,BigShellProfile:Mo,BoundingBox:Zy,CircleCurve:zd,CircleExtrusion:Hi,CurrentLod:jt,DataMap:Yt,DataSet:fe,DoubleVector:Xy,Event:Ds,FloatVector:rs,FragmentsModel:DC,FragmentsModels:nv,Geometries:He,GeometryClass:Pn,GeometryLines:ei,GeometryRepresentation:Ru,GeometrySample:Fu,GeometryWall:IC,IfcImporter:rv,ItemConfigClass:Om,Material:Qy,Meshes:je,Model:ne,MultiThreadingRequestClass:Ci,ObjectClass:zs,Relation:Sm,RenderedFaces:il,Representation:Xc,RepresentationClass:Ur,Sample:Qc,Shell:ji,ShellHole:Ga,ShellProfile:Do,ShellType:ms,SingleThreadedFragmentsModel:lM,SnappingClass:Ws,SpatialStructure:Cs,Stroke:CC,TileRequestClass:Ne,Transform:ur,Wire:fg,WireSet:mg,getObject:s0,ifcCategoryMap:bc,ifcClasses:vu,limitOf2Bytes:qa},Symbol.toStringTag,{value:"Module"}));var vM=Object.defineProperty,wM=(n,t,e)=>t in n?vM(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,k=(n,t,e)=>(wM(n,typeof t!="symbol"?t+"":t,e),e);let It=class{constructor(){k(this,"enabled",!0),k(this,"trigger",t=>{if(!this.enabled)return;const e=this.handlers.slice(0);for(const s of e)s(t)}),k(this,"handlers",[])}add(t){this.handlers.push(t)}remove(t){this.handlers=this.handlers.filter(e=>e!==t)}reset(){this.handlers.length=0}};class ov{constructor(t){k(this,"isDisposeable",()=>"dispose"in this&&"onDisposed"in this),k(this,"isResizeable",()=>"resize"in this&&"getSize"in this),k(this,"isUpdateable",()=>"onAfterUpdate"in this&&"onBeforeUpdate"in this&&"update"in this),k(this,"isHideable",()=>"visible"in this),k(this,"isConfigurable",()=>"setup"in this&&"config"in this&&"onSetup"in this),this.components=t}}class Fs extends ov{}class av extends ov{constructor(t){super(t),k(this,"worlds",new Yt),k(this,"onWorldChanged",new It),k(this,"_currentWorld",null),this.onWorldChanged.add(({world:e,action:s})=>{s==="removed"&&this.worlds.delete(e.uuid)})}set currentWorld(t){this._currentWorld=t}get currentWorld(){return this._currentWorld}}class EM extends av{constructor(){super(...arguments),k(this,"hasCameraControls",()=>"controls"in this)}}class xM extends av{constructor(){super(...arguments),k(this,"onAfterUpdate",new It),k(this,"onBeforeUpdate",new It),k(this,"onDisposed",new It),k(this,"onResize",new It),k(this,"onClippingPlanesUpdated",new It),k(this,"clippingPlanes",[])}updateClippingPlanes(){this.onClippingPlanesUpdated.trigger()}setPlane(t,e,s){e.isLocal=s;const i=this.clippingPlanes.indexOf(e);t&&i===-1?this.clippingPlanes.push(e):!t&&i>-1&&this.clippingPlanes.splice(i,1),this.three.clippingPlanes=this.clippingPlanes.filter(r=>!r.isLocal)}}const vT=class S0 extends Fs{constructor(t){super(t),k(this,"_disposedComponents",new Set),k(this,"enabled",!0),t.add(S0.uuid,this)}get(){return this._disposedComponents}destroy(t,e=!0,s=!0){t.removeFromParent();const i=t;i.dispose&&i.dispose(),this.disposeGeometryAndMaterials(t,e),s&&i.children&&i.children.length&&this.disposeChildren(i),t.children.length=0}disposeGeometry(t){t.boundsTree&&t.disposeBoundsTree&&t.disposeBoundsTree(),t.dispose()}disposeGeometryAndMaterials(t,e){const s=t;s.geometry&&this.disposeGeometry(s.geometry),e&&s.material&&S0.disposeMaterial(s),s.material=[],s.geometry=null}disposeChildren(t){for(const e of t.children)this.destroy(e)}static disposeMaterial(t){if(t.material)if(Array.isArray(t.material))for(const e of t.material)e.dispose();else t.material.dispose()}};k(vT,"uuid","76e9cd8e-ad8f-4753-9ef6-cbc60f7247fe");let vg=vT;class IM extends av{constructor(t){super(t),k(this,"onDisposed",new It),k(this,"directionalLights",new Map),k(this,"ambientLights",new Map)}dispose(){const t=this.components.get(vg);for(const e of this.three.children){const s=e;s.geometry&&t.destroy(s)}this.deleteAllLights(),this.three.children=[],this.onDisposed.trigger(),this.onDisposed.reset()}deleteAllLights(){for(const[,t]of this.directionalLights)t.removeFromParent(),t.target.removeFromParent(),t.dispose();this.directionalLights.clear();for(const[,t]of this.ambientLights)t.removeFromParent(),t.dispose();this.ambientLights.clear()}}class Bb extends Set{constructor(t){super(t),k(this,"onItemAdded",new It),k(this,"onItemDeleted",new It),k(this,"onCleared",new It),k(this,"guard",()=>!0)}clear(){super.clear(),this.onCleared.trigger()}add(...t){for(const e of t)this.has(e)||!this.guard(e)||(super.add(e),this.onItemAdded||(this.onItemAdded=new It),this.onItemAdded.trigger(e));return this}delete(t){const e=super.delete(t);return e&&this.onItemDeleted.trigger(),e}dispose(){this.clear(),this.onItemAdded.reset(),this.onItemDeleted.reset(),this.onCleared.reset()}}const lv=class ls{static create(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,s=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return`${ls._lut[t&255]+ls._lut[t>>8&255]+ls._lut[t>>16&255]+ls._lut[t>>24&255]}-${ls._lut[e&255]}${ls._lut[e>>8&255]}-${ls._lut[e>>16&15|64]}${ls._lut[e>>24&255]}-${ls._lut[s&63|128]}${ls._lut[s>>8&255]}-${ls._lut[s>>16&255]}${ls._lut[s>>24&255]}${ls._lut[i&255]}${ls._lut[i>>8&255]}${ls._lut[i>>16&255]}${ls._lut[i>>24&255]}`.toLowerCase()}static validate(t){if(!ls._pattern.test(t))throw new Error(`${t} is not a valid UUID v4.

- If you're the tool creator, you can take one from https://www.uuidgenerator.net/.

- If you're using a platform tool, verify the uuid isn't misspelled or contact the tool creator.`)}};k(lv,"_pattern",/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/);k(lv,"_lut",["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"]);let wi=lv;var jp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function CM(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var wT={},wg={};(function(n){const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",e=t+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",s="["+t+"]["+e+"]*",i=new RegExp("^"+s+"$"),r=function(a,l){const c=[];let h=l.exec(a);for(;h;){const u=[];u.startIndex=l.lastIndex-h[0].length;const p=h.length;for(let d=0;d<p;d++)u.push(h[d]);c.push(u),h=l.exec(a)}return c},o=function(a){const l=i.exec(a);return!(l===null||typeof l>"u")};n.isExist=function(a){return typeof a<"u"},n.isEmptyObject=function(a){return Object.keys(a).length===0},n.merge=function(a,l,c){if(l){const h=Object.keys(l),u=h.length;for(let p=0;p<u;p++)c==="strict"?a[h[p]]=[l[h[p]]]:a[h[p]]=l[h[p]]}},n.getValue=function(a){return n.isExist(a)?a:""},n.isName=o,n.getAllMatches=r,n.nameRegexp=s})(wg);const cv=wg,TM={allowBooleanAttributes:!1,unpairedTags:[]};wT.validate=function(n,t){t=Object.assign({},TM,t);const e=[];let s=!1,i=!1;n[0]==="\uFEFF"&&(n=n.substr(1));for(let r=0;r<n.length;r++)if(n[r]==="<"&&n[r+1]==="?"){if(r+=2,r=E1(n,r),r.err)return r}else if(n[r]==="<"){let o=r;if(r++,n[r]==="!"){r=x1(n,r);continue}else{let a=!1;n[r]==="/"&&(a=!0,r++);let l="";for(;r<n.length&&n[r]!==">"&&n[r]!==" "&&n[r]!=="	"&&n[r]!==`
`&&n[r]!=="\r";r++)l+=n[r];if(l=l.trim(),l[l.length-1]==="/"&&(l=l.substring(0,l.length-1),r--),!$M(l)){let u;return l.trim().length===0?u="Invalid space after '<'.":u="Tag '"+l+"' is an invalid name.",Ge("InvalidTag",u,Vs(n,r))}const c=OM(n,r);if(c===!1)return Ge("InvalidAttr","Attributes for '"+l+"' have open quote.",Vs(n,r));let h=c.value;if(r=c.index,h[h.length-1]==="/"){const u=r-h.length;h=h.substring(0,h.length-1);const p=I1(h,t);if(p===!0)s=!0;else return Ge(p.err.code,p.err.msg,Vs(n,u+p.err.line))}else if(a)if(c.tagClosed){if(h.trim().length>0)return Ge("InvalidTag","Closing tag '"+l+"' can't have attributes or invalid starting.",Vs(n,o));if(e.length===0)return Ge("InvalidTag","Closing tag '"+l+"' has not been opened.",Vs(n,o));{const u=e.pop();if(l!==u.tagName){let p=Vs(n,u.tagStartPos);return Ge("InvalidTag","Expected closing tag '"+u.tagName+"' (opened in line "+p.line+", col "+p.col+") instead of closing tag '"+l+"'.",Vs(n,o))}e.length==0&&(i=!0)}}else return Ge("InvalidTag","Closing tag '"+l+"' doesn't have proper closing.",Vs(n,r));else{const u=I1(h,t);if(u!==!0)return Ge(u.err.code,u.err.msg,Vs(n,r-h.length+u.err.line));if(i===!0)return Ge("InvalidXml","Multiple possible root nodes found.",Vs(n,r));t.unpairedTags.indexOf(l)!==-1||e.push({tagName:l,tagStartPos:o}),s=!0}for(r++;r<n.length;r++)if(n[r]==="<")if(n[r+1]==="!"){r++,r=x1(n,r);continue}else if(n[r+1]==="?"){if(r=E1(n,++r),r.err)return r}else break;else if(n[r]==="&"){const u=FM(n,r);if(u==-1)return Ge("InvalidChar","char '&' is not expected.",Vs(n,r));r=u}else if(i===!0&&!w1(n[r]))return Ge("InvalidXml","Extra text at the end",Vs(n,r));n[r]==="<"&&r--}}else{if(w1(n[r]))continue;return Ge("InvalidChar","char '"+n[r]+"' is not expected.",Vs(n,r))}if(s){if(e.length==1)return Ge("InvalidTag","Unclosed tag '"+e[0].tagName+"'.",Vs(n,e[0].tagStartPos));if(e.length>0)return Ge("InvalidXml","Invalid '"+JSON.stringify(e.map(r=>r.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return Ge("InvalidXml","Start tag expected.",1);return!0};function w1(n){return n===" "||n==="	"||n===`
`||n==="\r"}function E1(n,t){const e=t;for(;t<n.length;t++)if(n[t]=="?"||n[t]==" "){const s=n.substr(e,t-e);if(t>5&&s==="xml")return Ge("InvalidXml","XML declaration allowed only at the start of the document.",Vs(n,t));if(n[t]=="?"&&n[t+1]==">"){t++;break}else continue}return t}function x1(n,t){if(n.length>t+5&&n[t+1]==="-"&&n[t+2]==="-"){for(t+=3;t<n.length;t++)if(n[t]==="-"&&n[t+1]==="-"&&n[t+2]===">"){t+=2;break}}else if(n.length>t+8&&n[t+1]==="D"&&n[t+2]==="O"&&n[t+3]==="C"&&n[t+4]==="T"&&n[t+5]==="Y"&&n[t+6]==="P"&&n[t+7]==="E"){let e=1;for(t+=8;t<n.length;t++)if(n[t]==="<")e++;else if(n[t]===">"&&(e--,e===0))break}else if(n.length>t+9&&n[t+1]==="["&&n[t+2]==="C"&&n[t+3]==="D"&&n[t+4]==="A"&&n[t+5]==="T"&&n[t+6]==="A"&&n[t+7]==="["){for(t+=8;t<n.length;t++)if(n[t]==="]"&&n[t+1]==="]"&&n[t+2]===">"){t+=2;break}}return t}const AM='"',SM="'";function OM(n,t){let e="",s="",i=!1;for(;t<n.length;t++){if(n[t]===AM||n[t]===SM)s===""?s=n[t]:s!==n[t]||(s="");else if(n[t]===">"&&s===""){i=!0;break}e+=n[t]}return s!==""?!1:{value:e,index:t,tagClosed:i}}const PM=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function I1(n,t){const e=cv.getAllMatches(n,PM),s={};for(let i=0;i<e.length;i++){if(e[i][1].length===0)return Ge("InvalidAttr","Attribute '"+e[i][2]+"' has no space in starting.",Ah(e[i]));if(e[i][3]!==void 0&&e[i][4]===void 0)return Ge("InvalidAttr","Attribute '"+e[i][2]+"' is without value.",Ah(e[i]));if(e[i][3]===void 0&&!t.allowBooleanAttributes)return Ge("InvalidAttr","boolean attribute '"+e[i][2]+"' is not allowed.",Ah(e[i]));const r=e[i][2];if(!LM(r))return Ge("InvalidAttr","Attribute '"+r+"' is an invalid name.",Ah(e[i]));if(!s.hasOwnProperty(r))s[r]=1;else return Ge("InvalidAttr","Attribute '"+r+"' is repeated.",Ah(e[i]))}return!0}function RM(n,t){let e=/\d/;for(n[t]==="x"&&(t++,e=/[\da-fA-F]/);t<n.length;t++){if(n[t]===";")return t;if(!n[t].match(e))break}return-1}function FM(n,t){if(t++,n[t]===";")return-1;if(n[t]==="#")return t++,RM(n,t);let e=0;for(;t<n.length;t++,e++)if(!(n[t].match(/\w/)&&e<20)){if(n[t]===";")break;return-1}return t}function Ge(n,t,e){return{err:{code:n,msg:t,line:e.line||e,col:e.col}}}function LM(n){return cv.isName(n)}function $M(n){return cv.isName(n)}function Vs(n,t){const e=n.substring(0,t).split(/\r?\n/);return{line:e.length,col:e[e.length-1].length+1}}function Ah(n){return n.startIndex+n[1].length}var hv={};const ET={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(n,t){return t},attributeValueProcessor:function(n,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(n,t,e){return n}},NM=function(n){return Object.assign({},ET,n)};hv.buildOptions=NM;hv.defaultOptions=ET;class MM{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,e){t==="__proto__"&&(t="#__proto__"),this.child.push({[t]:e})}addChild(t){t.tagname==="__proto__"&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,":@":t[":@"]}):this.child.push({[t.tagname]:t.child})}}var DM=MM;const kM=wg;function zM(n,t){const e={};if(n[t+3]==="O"&&n[t+4]==="C"&&n[t+5]==="T"&&n[t+6]==="Y"&&n[t+7]==="P"&&n[t+8]==="E"){t=t+9;let s=1,i=!1,r=!1,o="";for(;t<n.length;t++)if(n[t]==="<"&&!r){if(i&&VM(n,t))t+=7,[entityName,val,t]=BM(n,t+1),val.indexOf("&")===-1&&(e[YM(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(i&&HM(n,t))t+=8;else if(i&&jM(n,t))t+=8;else if(i&&WM(n,t))t+=9;else if(UM)r=!0;else throw new Error("Invalid DOCTYPE");s++,o=""}else if(n[t]===">"){if(r?n[t-1]==="-"&&n[t-2]==="-"&&(r=!1,s--):s--,s===0)break}else n[t]==="["?i=!0:o+=n[t];if(s!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:e,i:t}}function BM(n,t){let e="";for(;t<n.length&&n[t]!=="'"&&n[t]!=='"';t++)e+=n[t];if(e=e.trim(),e.indexOf(" ")!==-1)throw new Error("External entites are not supported");const s=n[t++];let i="";for(;t<n.length&&n[t]!==s;t++)i+=n[t];return[e,i,t]}function UM(n,t){return n[t+1]==="!"&&n[t+2]==="-"&&n[t+3]==="-"}function VM(n,t){return n[t+1]==="!"&&n[t+2]==="E"&&n[t+3]==="N"&&n[t+4]==="T"&&n[t+5]==="I"&&n[t+6]==="T"&&n[t+7]==="Y"}function HM(n,t){return n[t+1]==="!"&&n[t+2]==="E"&&n[t+3]==="L"&&n[t+4]==="E"&&n[t+5]==="M"&&n[t+6]==="E"&&n[t+7]==="N"&&n[t+8]==="T"}function jM(n,t){return n[t+1]==="!"&&n[t+2]==="A"&&n[t+3]==="T"&&n[t+4]==="T"&&n[t+5]==="L"&&n[t+6]==="I"&&n[t+7]==="S"&&n[t+8]==="T"}function WM(n,t){return n[t+1]==="!"&&n[t+2]==="N"&&n[t+3]==="O"&&n[t+4]==="T"&&n[t+5]==="A"&&n[t+6]==="T"&&n[t+7]==="I"&&n[t+8]==="O"&&n[t+9]==="N"}function YM(n){if(kM.isName(n))return n;throw new Error(`Invalid entity name ${n}`)}var GM=zM;const qM=/^[-+]?0x[a-fA-F0-9]+$/,ZM=/^([\-\+])?(0*)([0-9]*(\.[0-9]*)?)$/,XM={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function QM(n,t={}){if(t=Object.assign({},XM,t),!n||typeof n!="string")return n;let e=n.trim();if(t.skipLike!==void 0&&t.skipLike.test(e))return n;if(n==="0")return 0;if(t.hex&&qM.test(e))return JM(e,16);if(e.search(/[eE]/)!==-1){const s=e.match(/^([-\+])?(0*)([0-9]*(\.[0-9]*)?[eE][-\+]?[0-9]+)$/);if(s){if(t.leadingZeros)e=(s[1]||"")+s[3];else if(!(s[2]==="0"&&s[3][0]==="."))return n;return t.eNotation?Number(e):n}else return n}else{const s=ZM.exec(e);if(s){const i=s[1],r=s[2];let o=KM(s[3]);if(!t.leadingZeros&&r.length>0&&i&&e[2]!==".")return n;if(!t.leadingZeros&&r.length>0&&!i&&e[1]!==".")return n;if(t.leadingZeros&&r===n)return 0;{const a=Number(e),l=""+a;return l.search(/[eE]/)!==-1?t.eNotation?a:n:e.indexOf(".")!==-1?l==="0"&&o===""||l===o||i&&l==="-"+o?a:n:r?o===l||i+o===l?a:n:e===l||e===i+l?a:n}}else return n}}function KM(n){return n&&n.indexOf(".")!==-1&&(n=n.replace(/0+$/,""),n==="."?n="0":n[0]==="."?n="0"+n:n[n.length-1]==="."&&(n=n.substr(0,n.length-1))),n}function JM(n,t){if(parseInt)return parseInt(n,t);if(Number.parseInt)return Number.parseInt(n,t);if(window&&window.parseInt)return window.parseInt(n,t);throw new Error("parseInt, Number.parseInt, window.parseInt are not supported")}var t4=QM;const xT=wg,Sh=DM,e4=GM,s4=t4;let i4=class{constructor(t){this.options=t,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(e,s)=>String.fromCharCode(Number.parseInt(s,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(e,s)=>String.fromCharCode(Number.parseInt(s,16))}},this.addExternalEntities=n4,this.parseXml=c4,this.parseTextData=r4,this.resolveNameSpace=o4,this.buildAttributesMap=l4,this.isItStopNode=p4,this.replaceEntitiesValue=u4,this.readStopNodeData=m4,this.saveTextToParentTag=d4,this.addChild=h4}};function n4(n){const t=Object.keys(n);for(let e=0;e<t.length;e++){const s=t[e];this.lastEntities[s]={regex:new RegExp("&"+s+";","g"),val:n[s]}}}function r4(n,t,e,s,i,r,o){if(n!==void 0&&(this.options.trimValues&&!s&&(n=n.trim()),n.length>0)){o||(n=this.replaceEntitiesValue(n));const a=this.options.tagValueProcessor(t,n,e,i,r);return a==null?n:typeof a!=typeof n||a!==n?a:this.options.trimValues?P0(n,this.options.parseTagValue,this.options.numberParseOptions):n.trim()===n?P0(n,this.options.parseTagValue,this.options.numberParseOptions):n}}function o4(n){if(this.options.removeNSPrefix){const t=n.split(":"),e=n.charAt(0)==="/"?"/":"";if(t[0]==="xmlns")return"";t.length===2&&(n=e+t[1])}return n}const a4=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function l4(n,t,e){if(!this.options.ignoreAttributes&&typeof n=="string"){const s=xT.getAllMatches(n,a4),i=s.length,r={};for(let o=0;o<i;o++){const a=this.resolveNameSpace(s[o][1]);let l=s[o][4],c=this.options.attributeNamePrefix+a;if(a.length)if(this.options.transformAttributeName&&(c=this.options.transformAttributeName(c)),c==="__proto__"&&(c="#__proto__"),l!==void 0){this.options.trimValues&&(l=l.trim()),l=this.replaceEntitiesValue(l);const h=this.options.attributeValueProcessor(a,l,t);h==null?r[c]=l:typeof h!=typeof l||h!==l?r[c]=h:r[c]=P0(l,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(r[c]=!0)}if(!Object.keys(r).length)return;if(this.options.attributesGroupName){const o={};return o[this.options.attributesGroupName]=r,o}return r}}const c4=function(n){n=n.replace(/\r\n?/g,`
`);const t=new Sh("!xml");let e=t,s="",i="";for(let r=0;r<n.length;r++)if(n[r]==="<")if(n[r+1]==="/"){const a=Pa(n,">",r,"Closing Tag is not closed.");let l=n.substring(r+2,a).trim();if(this.options.removeNSPrefix){const u=l.indexOf(":");u!==-1&&(l=l.substr(u+1))}this.options.transformTagName&&(l=this.options.transformTagName(l)),e&&(s=this.saveTextToParentTag(s,e,i));const c=i.substring(i.lastIndexOf(".")+1);if(l&&this.options.unpairedTags.indexOf(l)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${l}>`);let h=0;c&&this.options.unpairedTags.indexOf(c)!==-1?(h=i.lastIndexOf(".",i.lastIndexOf(".")-1),this.tagsNodeStack.pop()):h=i.lastIndexOf("."),i=i.substring(0,h),e=this.tagsNodeStack.pop(),s="",r=a}else if(n[r+1]==="?"){let a=O0(n,r,!1,"?>");if(!a)throw new Error("Pi Tag is not closed.");if(s=this.saveTextToParentTag(s,e,i),!(this.options.ignoreDeclaration&&a.tagName==="?xml"||this.options.ignorePiTags)){const l=new Sh(a.tagName);l.add(this.options.textNodeName,""),a.tagName!==a.tagExp&&a.attrExpPresent&&(l[":@"]=this.buildAttributesMap(a.tagExp,i,a.tagName)),this.addChild(e,l,i)}r=a.closeIndex+1}else if(n.substr(r+1,3)==="!--"){const a=Pa(n,"-->",r+4,"Comment is not closed.");if(this.options.commentPropName){const l=n.substring(r+4,a-2);s=this.saveTextToParentTag(s,e,i),e.add(this.options.commentPropName,[{[this.options.textNodeName]:l}])}r=a}else if(n.substr(r+1,2)==="!D"){const a=e4(n,r);this.docTypeEntities=a.entities,r=a.i}else if(n.substr(r+1,2)==="!["){const a=Pa(n,"]]>",r,"CDATA is not closed.")-2,l=n.substring(r+9,a);s=this.saveTextToParentTag(s,e,i);let c=this.parseTextData(l,e.tagname,i,!0,!1,!0,!0);c==null&&(c=""),this.options.cdataPropName?e.add(this.options.cdataPropName,[{[this.options.textNodeName]:l}]):e.add(this.options.textNodeName,c),r=a+2}else{let a=O0(n,r,this.options.removeNSPrefix),l=a.tagName;const c=a.rawTagName;let h=a.tagExp,u=a.attrExpPresent,p=a.closeIndex;this.options.transformTagName&&(l=this.options.transformTagName(l)),e&&s&&e.tagname!=="!xml"&&(s=this.saveTextToParentTag(s,e,i,!1));const d=e;if(d&&this.options.unpairedTags.indexOf(d.tagname)!==-1&&(e=this.tagsNodeStack.pop(),i=i.substring(0,i.lastIndexOf("."))),l!==t.tagname&&(i+=i?"."+l:l),this.isItStopNode(this.options.stopNodes,i,l)){let g="";if(h.length>0&&h.lastIndexOf("/")===h.length-1)l[l.length-1]==="/"?(l=l.substr(0,l.length-1),i=i.substr(0,i.length-1),h=l):h=h.substr(0,h.length-1),r=a.closeIndex;else if(this.options.unpairedTags.indexOf(l)!==-1)r=a.closeIndex;else{const b=this.readStopNodeData(n,c,p+1);if(!b)throw new Error(`Unexpected end of ${c}`);r=b.i,g=b.tagContent}const m=new Sh(l);l!==h&&u&&(m[":@"]=this.buildAttributesMap(h,i,l)),g&&(g=this.parseTextData(g,l,i,!0,u,!0,!0)),i=i.substr(0,i.lastIndexOf(".")),m.add(this.options.textNodeName,g),this.addChild(e,m,i)}else{if(h.length>0&&h.lastIndexOf("/")===h.length-1){l[l.length-1]==="/"?(l=l.substr(0,l.length-1),i=i.substr(0,i.length-1),h=l):h=h.substr(0,h.length-1),this.options.transformTagName&&(l=this.options.transformTagName(l));const g=new Sh(l);l!==h&&u&&(g[":@"]=this.buildAttributesMap(h,i,l)),this.addChild(e,g,i),i=i.substr(0,i.lastIndexOf("."))}else{const g=new Sh(l);this.tagsNodeStack.push(e),l!==h&&u&&(g[":@"]=this.buildAttributesMap(h,i,l)),this.addChild(e,g,i),e=g}s="",r=p}}else s+=n[r];return t.child};function h4(n,t,e){const s=this.options.updateTag(t.tagname,e,t[":@"]);s===!1||(typeof s=="string"&&(t.tagname=s),n.addChild(t))}const u4=function(n){if(this.options.processEntities){for(let t in this.docTypeEntities){const e=this.docTypeEntities[t];n=n.replace(e.regx,e.val)}for(let t in this.lastEntities){const e=this.lastEntities[t];n=n.replace(e.regex,e.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const e=this.htmlEntities[t];n=n.replace(e.regex,e.val)}n=n.replace(this.ampEntity.regex,this.ampEntity.val)}return n};function d4(n,t,e,s){return n&&(s===void 0&&(s=Object.keys(t.child).length===0),n=this.parseTextData(n,t.tagname,e,!1,t[":@"]?Object.keys(t[":@"]).length!==0:!1,s),n!==void 0&&n!==""&&t.add(this.options.textNodeName,n),n=""),n}function p4(n,t,e){const s="*."+e;for(const i in n){const r=n[i];if(s===r||t===r)return!0}return!1}function f4(n,t,e=">"){let s,i="";for(let r=t;r<n.length;r++){let o=n[r];if(s)o===s&&(s="");else if(o==='"'||o==="'")s=o;else if(o===e[0])if(e[1]){if(n[r+1]===e[1])return{data:i,index:r}}else return{data:i,index:r};else o==="	"&&(o=" ");i+=o}}function Pa(n,t,e,s){const i=n.indexOf(t,e);if(i===-1)throw new Error(s);return i+t.length-1}function O0(n,t,e,s=">"){const i=f4(n,t+1,s);if(!i)return;let r=i.data;const o=i.index,a=r.search(/\s/);let l=r,c=!0;a!==-1&&(l=r.substring(0,a),r=r.substring(a+1).trimStart());const h=l;if(e){const u=l.indexOf(":");u!==-1&&(l=l.substr(u+1),c=l!==i.data.substr(u+1))}return{tagName:l,tagExp:r,closeIndex:o,attrExpPresent:c,rawTagName:h}}function m4(n,t,e){const s=e;let i=1;for(;e<n.length;e++)if(n[e]==="<")if(n[e+1]==="/"){const r=Pa(n,">",e,`${t} is not closed`);if(n.substring(e+2,r).trim()===t&&(i--,i===0))return{tagContent:n.substring(s,e),i:r};e=r}else if(n[e+1]==="?")e=Pa(n,"?>",e+1,"StopNode is not closed.");else if(n.substr(e+1,3)==="!--")e=Pa(n,"-->",e+3,"StopNode is not closed.");else if(n.substr(e+1,2)==="![")e=Pa(n,"]]>",e,"StopNode is not closed.")-2;else{const r=O0(n,e,">");r&&((r&&r.tagName)===t&&r.tagExp[r.tagExp.length-1]!=="/"&&i++,e=r.closeIndex)}}function P0(n,t,e){if(t&&typeof n=="string"){const s=n.trim();return s==="true"?!0:s==="false"?!1:s4(n,e)}else return xT.isExist(n)?n:""}var g4=i4,IT={};function b4(n,t){return CT(n,t)}function CT(n,t,e){let s;const i={};for(let r=0;r<n.length;r++){const o=n[r],a=_4(o);let l="";if(e===void 0?l=a:l=e+"."+a,a===t.textNodeName)s===void 0?s=o[a]:s+=""+o[a];else{if(a===void 0)continue;if(o[a]){let c=CT(o[a],t,l);const h=v4(c,t);o[":@"]?y4(c,o[":@"],l,t):Object.keys(c).length===1&&c[t.textNodeName]!==void 0&&!t.alwaysCreateTextNode?c=c[t.textNodeName]:Object.keys(c).length===0&&(t.alwaysCreateTextNode?c[t.textNodeName]="":c=""),i[a]!==void 0&&i.hasOwnProperty(a)?(Array.isArray(i[a])||(i[a]=[i[a]]),i[a].push(c)):t.isArray(a,l,h)?i[a]=[c]:i[a]=c}}}return typeof s=="string"?s.length>0&&(i[t.textNodeName]=s):s!==void 0&&(i[t.textNodeName]=s),i}function _4(n){const t=Object.keys(n);for(let e=0;e<t.length;e++){const s=t[e];if(s!==":@")return s}}function y4(n,t,e,s){if(t){const i=Object.keys(t),r=i.length;for(let o=0;o<r;o++){const a=i[o];s.isArray(a,e+"."+a,!0,!0)?n[a]=[t[a]]:n[a]=t[a]}}}function v4(n,t){const{textNodeName:e}=t,s=Object.keys(n).length;return!!(s===0||s===1&&(n[e]||typeof n[e]=="boolean"||n[e]===0))}IT.prettify=b4;const{buildOptions:w4}=hv,E4=g4,{prettify:x4}=IT,I4=wT;let C4=class{constructor(t){this.externalEntities={},this.options=w4(t)}parse(t,e){if(typeof t!="string")if(t.toString)t=t.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(e){e===!0&&(e={});const r=I4.validate(t,e);if(r!==!0)throw Error(`${r.err.msg}:${r.err.line}:${r.err.col}`)}const s=new E4(this.options);s.addExternalEntities(this.externalEntities);const i=s.parseXml(t);return this.options.preserveOrder||i===void 0?i:x4(i,this.options)}addEntity(t,e){if(e.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(t.indexOf("&")!==-1||t.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(e==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[t]=e}};var T4=C4;const A4=`
`;function S4(n,t){let e="";return t.format&&t.indentBy.length>0&&(e=A4),TT(n,t,"",e)}function TT(n,t,e,s){let i="",r=!1;for(let o=0;o<n.length;o++){const a=n[o],l=O4(a);if(l===void 0)continue;let c="";if(e.length===0?c=l:c=`${e}.${l}`,l===t.textNodeName){let g=a[l];P4(c,t)||(g=t.tagValueProcessor(l,g),g=AT(g,t)),r&&(i+=s),i+=g,r=!1;continue}else if(l===t.cdataPropName){r&&(i+=s),i+=`<![CDATA[${a[l][0][t.textNodeName]}]]>`,r=!1;continue}else if(l===t.commentPropName){i+=s+`<!--${a[l][0][t.textNodeName]}-->`,r=!0;continue}else if(l[0]==="?"){const g=C1(a[":@"],t),m=l==="?xml"?"":s;let b=a[l][0][t.textNodeName];b=b.length!==0?" "+b:"",i+=m+`<${l}${b}${g}?>`,r=!0;continue}let h=s;h!==""&&(h+=t.indentBy);const u=C1(a[":@"],t),p=s+`<${l}${u}`,d=TT(a[l],t,c,h);t.unpairedTags.indexOf(l)!==-1?t.suppressUnpairedNode?i+=p+">":i+=p+"/>":(!d||d.length===0)&&t.suppressEmptyNode?i+=p+"/>":d&&d.endsWith(">")?i+=p+`>${d}${s}</${l}>`:(i+=p+">",d&&s!==""&&(d.includes("/>")||d.includes("</"))?i+=s+t.indentBy+d+s:i+=d,i+=`</${l}>`),r=!0}return i}function O4(n){const t=Object.keys(n);for(let e=0;e<t.length;e++){const s=t[e];if(n.hasOwnProperty(s)&&s!==":@")return s}}function C1(n,t){let e="";if(n&&!t.ignoreAttributes)for(let s in n){if(!n.hasOwnProperty(s))continue;let i=t.attributeValueProcessor(s,n[s]);i=AT(i,t),i===!0&&t.suppressBooleanAttributes?e+=` ${s.substr(t.attributeNamePrefix.length)}`:e+=` ${s.substr(t.attributeNamePrefix.length)}="${i}"`}return e}function P4(n,t){n=n.substr(0,n.length-t.textNodeName.length-1);let e=n.substr(n.lastIndexOf(".")+1);for(let s in t.stopNodes)if(t.stopNodes[s]===n||t.stopNodes[s]==="*."+e)return!0;return!1}function AT(n,t){if(n&&n.length>0&&t.processEntities)for(let e=0;e<t.entities.length;e++){const s=t.entities[e];n=n.replace(s.regex,s.val)}return n}var R4=S4;const F4=R4,L4={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(n,t){return t},attributeValueProcessor:function(n,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function qo(n){this.options=Object.assign({},L4,n),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=M4),this.processTextOrObjNode=$4,this.options.format?(this.indentate=N4,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}qo.prototype.build=function(n){return this.options.preserveOrder?F4(n,this.options):(Array.isArray(n)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(n={[this.options.arrayNodeName]:n}),this.j2x(n,0).val)};qo.prototype.j2x=function(n,t){let e="",s="";for(let i in n)if(Object.prototype.hasOwnProperty.call(n,i))if(typeof n[i]>"u")this.isAttribute(i)&&(s+="");else if(n[i]===null)this.isAttribute(i)?s+="":i[0]==="?"?s+=this.indentate(t)+"<"+i+"?"+this.tagEndChar:s+=this.indentate(t)+"<"+i+"/"+this.tagEndChar;else if(n[i]instanceof Date)s+=this.buildTextValNode(n[i],i,"",t);else if(typeof n[i]!="object"){const r=this.isAttribute(i);if(r)e+=this.buildAttrPairStr(r,""+n[i]);else if(i===this.options.textNodeName){let o=this.options.tagValueProcessor(i,""+n[i]);s+=this.replaceEntitiesValue(o)}else s+=this.buildTextValNode(n[i],i,"",t)}else if(Array.isArray(n[i])){const r=n[i].length;let o="",a="";for(let l=0;l<r;l++){const c=n[i][l];if(!(typeof c>"u"))if(c===null)i[0]==="?"?s+=this.indentate(t)+"<"+i+"?"+this.tagEndChar:s+=this.indentate(t)+"<"+i+"/"+this.tagEndChar;else if(typeof c=="object")if(this.options.oneListGroup){const h=this.j2x(c,t+1);o+=h.val,this.options.attributesGroupName&&c.hasOwnProperty(this.options.attributesGroupName)&&(a+=h.attrStr)}else o+=this.processTextOrObjNode(c,i,t);else if(this.options.oneListGroup){let h=this.options.tagValueProcessor(i,c);h=this.replaceEntitiesValue(h),o+=h}else o+=this.buildTextValNode(c,i,"",t)}this.options.oneListGroup&&(o=this.buildObjectNode(o,i,a,t)),s+=o}else if(this.options.attributesGroupName&&i===this.options.attributesGroupName){const r=Object.keys(n[i]),o=r.length;for(let a=0;a<o;a++)e+=this.buildAttrPairStr(r[a],""+n[i][r[a]])}else s+=this.processTextOrObjNode(n[i],i,t);return{attrStr:e,val:s}};qo.prototype.buildAttrPairStr=function(n,t){return t=this.options.attributeValueProcessor(n,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&t==="true"?" "+n:" "+n+'="'+t+'"'};function $4(n,t,e){const s=this.j2x(n,e+1);return n[this.options.textNodeName]!==void 0&&Object.keys(n).length===1?this.buildTextValNode(n[this.options.textNodeName],t,s.attrStr,e):this.buildObjectNode(s.val,t,s.attrStr,e)}qo.prototype.buildObjectNode=function(n,t,e,s){if(n==="")return t[0]==="?"?this.indentate(s)+"<"+t+e+"?"+this.tagEndChar:this.indentate(s)+"<"+t+e+this.closeTag(t)+this.tagEndChar;{let i="</"+t+this.tagEndChar,r="";return t[0]==="?"&&(r="?",i=""),(e||e==="")&&n.indexOf("<")===-1?this.indentate(s)+"<"+t+e+r+">"+n+i:this.options.commentPropName!==!1&&t===this.options.commentPropName&&r.length===0?this.indentate(s)+`<!--${n}-->`+this.newLine:this.indentate(s)+"<"+t+e+r+this.tagEndChar+n+this.indentate(s)+i}};qo.prototype.closeTag=function(n){let t="";return this.options.unpairedTags.indexOf(n)!==-1?this.options.suppressUnpairedNode||(t="/"):this.options.suppressEmptyNode?t="/":t=`></${n}`,t};qo.prototype.buildTextValNode=function(n,t,e,s){if(this.options.cdataPropName!==!1&&t===this.options.cdataPropName)return this.indentate(s)+`<![CDATA[${n}]]>`+this.newLine;if(this.options.commentPropName!==!1&&t===this.options.commentPropName)return this.indentate(s)+`<!--${n}-->`+this.newLine;if(t[0]==="?")return this.indentate(s)+"<"+t+e+"?"+this.tagEndChar;{let i=this.options.tagValueProcessor(t,n);return i=this.replaceEntitiesValue(i),i===""?this.indentate(s)+"<"+t+e+this.closeTag(t)+this.tagEndChar:this.indentate(s)+"<"+t+e+">"+i+"</"+t+this.tagEndChar}};qo.prototype.replaceEntitiesValue=function(n){if(n&&n.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){const e=this.options.entities[t];n=n.replace(e.regex,e.val)}return n};function N4(n){return this.options.indentBy.repeat(n)}function M4(n){return n.startsWith(this.options.attributeNamePrefix)&&n!==this.options.textNodeName?n.substr(this.attrPrefixLen):!1}var D4=qo;const k4=T4,z4=D4;var Eg={XMLParser:k4,XMLBuilder:z4};class xg{}k(xg,"parser",new Eg.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",ignoreAttributes:!1,ignoreDeclaration:!0,ignorePiTags:!0,numberParseOptions:{leadingZeros:!0,hex:!0},parseAttributeValue:!0,preserveOrder:!1,processEntities:!1,removeNSPrefix:!0,trimValues:!0}));k(xg,"builder",new Eg.XMLBuilder({attributeNamePrefix:"$",ignoreAttributes:!1,suppressBooleanAttributes:!1}));class gs{static join(t){const e={};for(const s of t)for(const i in s)if(!e[i])e[i]=new Set(s[i]);else for(const r of s[i])e[i].add(r);return e}static intersect(t){if(t.length===0)return{};let e=gs.clone(t[0]);for(let s=1;s<t.length;s++){const i=t[s],r={};for(const o in e)if(i[o]){const a=new Set;for(const l of e[o])i[o].has(l)&&a.add(l);a.size>0&&(r[o]=a)}e=r}return e}static clone(t){const e={};for(const s in t)e[s]=new Set(t[s]);return e}static remove(t,e,s=!1){s&&(t=gs.clone(t));for(const i in e)if(t[i]){for(const r of e[i])t[i].delete(r);t[i].size===0&&delete t[i]}}static add(t,e,s=!1){s&&(t=gs.clone(t));for(const i in e)if(!t[i])t[i]=new Set(e[i]);else for(const r of e[i])t[i].add(r)}static append(t,e,...s){let i=t[e];i||(i=new Set,t[e]=i);for(const r of s)i.add(r)}static isEqual(t,e){const s=Object.keys(t),i=Object.keys(e);if(s.length!==i.length)return!1;for(const r of s){if(!e[r]||t[r].size!==e[r].size)return!1;for(const o of t[r])if(!e[r].has(o))return!1}return!0}static isEmpty(t){return Object.values(t).reduce((s,i)=>s+i.size,0)===0}static toRaw(t){const e={};for(const s in t)e[s]=Array.from(t[s]);return e}static fromRaw(t){const e={};for(const s in t)e[s]=new Set(t[s]);return e}}class Ac extends Map{constructor(t){super(t),k(this,"onItemSet",new It),k(this,"onItemUpdated",new It),k(this,"onItemDeleted",new It),k(this,"onCleared",new It),k(this,"guard",()=>!0)}clear(){super.clear(),this.onCleared.trigger()}set(t,e){const s=this.has(t);if(!(this.guard??(()=>!0))(t,e))return this;const o=super.set(t,e);return s?(this.onItemUpdated||(this.onItemUpdated=new It),this.onItemUpdated.trigger({key:t,value:e})):(this.onItemSet||(this.onItemSet=new It),this.onItemSet.trigger({key:t,value:e})),o}add(t){const e=wi.create();return this.set(e,t),e}delete(t){const e=super.delete(t);return e&&this.onItemDeleted.trigger(t),e}dispose(){this.clear(),this.onItemSet.reset(),this.onItemDeleted.reset(),this.onCleared.reset()}}class Ub{static isEntry(t){return new Set(["Boolean","Color","Text","Number","Select","Vector3","TextSet","None"]).has(t.type)}static copySchema(t,e={}){for(const s in t){const i=t[s];this.isEntry(i)?e[s]=this.copyEntry(i):(e[s]={},this.copySchema(i,e[s]))}return e}static copyEntry(t){if(t.type==="Boolean"){const e=t;return{type:e.type,value:e.value}}if(t.type==="Color"){const e=t;return{type:e.type,value:e.value.clone()}}if(t.type==="Text"){const e=t;return{type:e.type,value:e.value}}if(t.type==="Number"){const e=t;return{type:e.type,value:e.value,min:e.min,max:e.max,interpolable:e.interpolable}}if(t.type==="Select"){const e=t;return{type:e.type,value:e.value,multiple:e.multiple,options:new Set(e.options)}}if(t.type==="Vector3"){const e=t;return{type:e.type,value:e.value.clone()}}if(t.type==="TextSet"){const e=t;return{type:e.type,value:new Set(e.value)}}if(t.type==="None"){const e=t;return{type:e.type,value:e.value}}throw new Error("Invalid entry!")}}class Ud{constructor(t,e,s,i){k(this,"_component"),k(this,"name"),k(this,"uuid"),this._component=t,this.name=s,this.uuid=i??wi.create(),e.get(Ig).list.set(this.uuid,this)}get controls(){return Ub.copySchema(this._config)}set(t){for(const e in t)if(e in this){const s=e;this[s]=t[e].value}}export(t=this._config,e={}){for(const s in t){const i=t[s];if(Ub.isEntry(i))if(i.type==="Color"){const{r:o,g:a,b:l}=i.value;e[s]={...i,value:{r:o,g:a,b:l}}}else if(i.type==="Vector3"){const{x:o,y:a,z:l}=i.value;e[s]={...i,value:{x:o,y:a,z:l}}}else if(i.type==="TextSet"){const o=Array.from(i.value);e[s]={...i,value:o}}else if(i.type==="Select"){const o=Array.from(i.options);e[s]={...i,options:o}}else e[s]={...i};else e[s]={},this.export(i,e[s])}return e}import(t,e={},s=!0){for(const i in t){const r=t[i];if(Ub.isEntry(r))if(r.type==="Color"){const{r:a,g:l,b:c}=r.value;e[i]={...r,value:new Dt(a,l,c)}}else if(r.type==="Vector3"){const{x:a,y:l,z:c}=r.value;e[i]={...r,value:new F(a,l,c)}}else r.type==="TextSet"?e[i]={...r,value:new Set(r.value)}:r.type==="Select"?e[i]={...r,options:new Set(r.options)}:e[i]={...r};else e[i]={},this.import(r,e[i],!1)}s&&this.set(e)}}const ST=class OT extends Fs{constructor(t){super(t),k(this,"list",new Ac),k(this,"enabled",!0),t.add(OT.uuid,this)}};k(ST,"uuid","b8c764e0-6b24-4e77-9a32-35fa728ee5b4");let Ig=ST;class B4{constructor(t){k(this,"_event"),k(this,"_position",new Ut),k(this,"onDisposed",new It),k(this,"updateMouseInfo",e=>{this._event=e}),this.dom=t,this.setupEvents(!0)}get position(){return this.updatePosition(!1),this._position.clone()}get rawPosition(){return this.updatePosition(!0),this._position.clone()}dispose(){this.setupEvents(!1),this.onDisposed.trigger(),this.onDisposed.reset()}updatePosition(t){if(this._event){const e=this.dom.getBoundingClientRect();this._position.x=this.getPositionX(e,this._event,t),this._position.y=this.getPositionY(e,this._event,t)}}getPositionY(t,e,s){const i=this.getDataObject(e);return s?i.clientY:-((i.clientY-t.top)/(t.bottom-t.top))*2+1}getPositionX(t,e,s){const i=this.getDataObject(e);return s?i.clientX:(i.clientX-t.left)/(t.right-t.left)*2-1}getDataObject(t){return t instanceof MouseEvent?t:t.touches[0]}setupEvents(t){t?(this.dom.addEventListener("pointermove",this.updateMouseInfo),this.dom.addEventListener("touchstart",this.updateMouseInfo)):(this.dom.removeEventListener("pointermove",this.updateMouseInfo),this.dom.removeEventListener("touchstart",this.updateMouseInfo))}}const PT=class RT extends Fs{constructor(t){super(t),k(this,"onDisposed",new It),k(this,"onFragmentsLoaded",new It),k(this,"baseCoordinationModel",""),k(this,"baseCoordinationMatrix",new xt),k(this,"enabled",!0),k(this,"initialized",!1),k(this,"_core"),this.components.add(RT.uuid,this)}get list(){return this.core.models.list}get core(){if(!this._core)throw new Error("FragmentsManager not initialized. Call init() first.");return this._core}dispose(){this._core&&(this.core.dispose(),this._core=void 0),this.baseCoordinationModel="",this.onFragmentsLoaded.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}init(t){this._core=new nv(t),this.initialized=!0,this.core.onModelLoaded.add(async e=>{this.list.size===1&&(this.baseCoordinationModel=e.modelId,this.baseCoordinationMatrix=await e.getCoordinationMatrix())}),this.list.onItemDeleted.add(()=>{this.list.size>0||(this.baseCoordinationModel="",this.baseCoordinationMatrix=new xt)})}async raycast(t){const e=[];for(const r of this.core.models.list.values())if(t.snappingClasses&&t.snappingClasses.length>0){const o=await r.raycastWithSnapping(t);if(o&&o.length>0)e.push(o[0]);else{const a=await r.raycast(t);a&&e.push(a)}}else{const o=await r.raycast(t);o&&e.push(o)}if(await Promise.all(e),e.length===0)return;let s=e[0],i=s.distance;for(let r=1;r<e.length;r++)e[r].distance<i&&(i=e[r].distance,s=e[r]);return s}async getPositions(t){const e=[],s=async(r,o)=>{const a=await r.getPositions(o);for(const l of a)e.push(l)},i=[];for(const r in t){const o=this.core.models.list.get(r);o&&i.push(s(o,Array.from(t[r])))}return await Promise.all(i),e}async getBBoxes(t){const e=[],s=async(r,o)=>{const a=await r.getBoxes(o);if(a)for(const l of a)e.push(l)},i=[];for(const r in t){const o=this.core.models.list.get(r);o&&i.push(s(o,Array.from(t[r])))}return await Promise.all(i),e}async highlight(t,e){await this.forEachModel(e,"highlight",t)}async getData(t,e){const s={};for(const[i,r]of Object.entries(t)){const o=this.list.get(i);if(!o)continue;const a=await o.getItemsData([...r],e);s[i]=a}return s}async resetHighlight(t){await this.forEachModel(t,"resetHighlight")}async forEachModel(t,e,...s){const i={};if(t)for(const o in t){const a=t[o];i[o]=Array.from(a)}else for(const o of this.core.models.list.keys())i[o]=void 0;const r=[];for(const o in i){const a=this.core.models.list.get(o);if(a){const l=i[o],c=a[e](l,...s);r.push(c)}}await Promise.all(r)}async guidsToModelIdMap(t){const e={};for(const[s,i]of this.list){const r=(await i.getLocalIdsByGuids([...t])).filter(o=>o!==null);e[s]=new Set(r)}return e}async modelIdMapToGuids(t){const e=[];for(const[s,i]of Object.entries(t)){const r=this.list.get(s);if(!r)continue;const o=(await r.getGuidsByLocalIds([...i])).filter(a=>a!==null);e.push(...o)}return e}applyBaseCoordinateSystem(t,e){const s=new xt;return e&&s.copy(e.clone()).invert(),s.multiply(this.baseCoordinationMatrix),t.applyMatrix4(s),s}};k(PT,"uuid","fef46874-46a3-461b-8c44-2922ab77c806");let Nt=PT;class U4{constructor(){k(this,"wasm",{path:"",absolute:!1,logLevel:pg.LOG_LEVEL_OFF}),k(this,"webIfc",{COORDINATE_TO_ORIGIN:!0}),k(this,"autoSetWasm",!0),k(this,"customLocateFileHandler",null)}}const FT=class R0 extends Fs{constructor(t){super(t),k(this,"onDisposed",new It),k(this,"onIfcStartedLoading",new It),k(this,"onSetup",new It),k(this,"settings",new U4),k(this,"webIfc",new Wa),k(this,"enabled",!0),this.components.add(R0.uuid,this)}dispose(){this.webIfc=null,this.onDisposed.trigger(R0.uuid),this.onDisposed.reset()}async setup(t){this.settings={...this.settings,...t},this.settings.autoSetWasm&&await this.autoSetWasm(),this.onSetup.trigger()}async load(t,e,s,i){const r=this.components.get(Nt);if(!r.initialized)throw new Error("You need to initialize fragments first.");this.settings.autoSetWasm&&await this.autoSetWasm(),r.core.settings.autoCoordinate=e;const o=new rv;o.wasm.path=this.settings.wasm.path,o.wasm.absolute=this.settings.wasm.absolute,i?.instanceCallback&&i.instanceCallback(o);const a=await o.process({...i?.processData,bytes:t});return await r.core.load(a,{modelId:s,userData:i?.userData})}async readIfcFile(t){const{path:e,absolute:s,logLevel:i}=this.settings.wasm;return this.webIfc.SetWasmPath(e,s),await this.webIfc.Init(this.settings.customLocateFileHandler||void 0),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModel(t,this.settings.webIfc)}cleanUp(){try{this.webIfc.Dispose()}catch{console.log("Web-ifc wasn't disposed.")}this.webIfc=null,this.webIfc=new Wa}async autoSetWasm(){const t=await fetch(`https://unpkg.com/@thatopen/components@${tA.release}/package.json`);if(!t.ok){console.warn("Couldn't get openbim-components package.json. Set wasm settings manually.");return}const e=await t.json();if(!("web-ifc"in e.peerDependencies))console.warn("Couldn't get web-ifc from peer dependencies in openbim-components. Set wasm settings manually.");else{const s=e.peerDependencies["web-ifc"];this.settings.wasm.path=`https://unpkg.com/web-ifc@${s}/`,this.settings.wasm.absolute=!0}}};k(FT,"uuid","a659add7-1418-4771-a0d6-7d4d438e4624");let V4=FT;const LT=class $T extends Fs{constructor(t){super(t),k(this,"enabled",!0),this.components.add($T.uuid,this)}async set(t,e){const s=this.components.get(Nt),i=[];if(e)for(const[r,o]of Object.entries(e)){const a=s.list.get(r);a&&i.push(a.setVisible([...o],t))}else for(const r of s.list.values())i.push(r.setVisible(void 0,t));await Promise.all(i),await s.core.update(!0)}async isolate(t){await Promise.all([this.set(!1),this.set(!0,t)])}async toggle(t){const e=[],s=this.components.get(Nt);for(const[i,r]of Object.entries(t)){const o=s.list.get(i);o&&e.push(o.toggleVisible([...r]))}await Promise.all(e),await s.core.update(!0)}async getVisibilityMap(t,e){const s=[],i=[],r=this.components.get(Nt);if(e)for(const l of e){const c=r.list.get(l);c&&(s.push(c.modelId),i.push(c.getItemsByVisibility(t)))}else for(const l of r.list.values())s.push(l.modelId),i.push(l.getItemsByVisibility(t));const o=await Promise.all(i),a={};for(const[l,c]of s.entries())a[c]=o[l];return a}};k(LT,"uuid","dd9ccf2d-8a21-4821-b7f6-2949add16a29");let H4=LT;const NT=class F0 extends Fs{constructor(t){super(t),k(this,"enabled",!0),k(this,"onDisposed",new It),k(this,"list",new fe),this.components.add(F0.uuid,this)}dispose(t=!0){this.list.clear(),this.onDisposed.trigger(F0.uuid),t&&(this.onDisposed.reset(),this.list.eventsEnabled=!1,this.list.dispose())}get(){const t=new Tt;for(const e of this.list)t.union(e);return t}async addFromModelIdMap(t){const e=this.components.get(Nt),s=new Tt;for(const[i,r]of Object.entries(t)){const o=e.list.get(i);if(!o)continue;const a=await o.getMergedBox([...r]);s.union(a)}this.list.add(s)}addFromModels(t){const e=this.components.get(Nt);for(const[s,i]of e.list)t&&!t.some(r=>r.test(s))||this.list.add(i.box)}async getCenter(t){this.list.clear(),await this.addFromModelIdMap(t);const e=this.get();this.list.clear();const s=new F;return e.getCenter(s),s}async getCameraOrientation(t,e=1){const s=this.components.get(Nt);this.list.clear();for(const[c,h]of s.list)this.list.add(h.box);const i=this.get();this.list.clear();const r=new F;i.getCenter(r);const o=new F;i.getSize(o);const a=Math.max(o.x,o.y,o.z)*e,l=new F;switch(t){case"front":l.set(r.x,r.y,r.z+a);break;case"back":l.set(r.x,r.y,r.z-a);break;case"left":l.set(r.x-a,r.y,r.z);break;case"right":l.set(r.x+a,r.y,r.z);break;case"top":l.set(r.x,r.y+a,r.z);break;case"bottom":l.set(r.x,r.y-a,r.z);break;default:l.set(r.x,r.y,r.z+a)}return{position:l,target:r}}};k(NT,"uuid","d1444724-dba6-4cdd-a0c7-68ee1450d166");let MT=NT;class j4{constructor(t,e){k(this,"description"),k(this,"_components"),k(this,"_queries",[]),k(this,"_aggregation","exclusive"),k(this,"result",null),k(this,"cache",!0),k(this,"serializeQueryParameters",s=>{var i;return{categories:(i=s.categories)==null?void 0:i.map(o=>o.source),attributes:s.attributes?{aggregation:s.attributes.aggregation,queries:s.attributes.queries.map(this.serializeAttributeQuery)}:void 0,relation:s.relation?{name:s.relation.name,query:s.relation.query?this.serializeQueryParameters(s.relation.query):void 0}:void 0}}),k(this,"deserializeQueryParameters",s=>{var i;return{categories:(i=s.categories)==null?void 0:i.map(o=>new RegExp(o)),attributes:s.attributes?{aggregation:s.attributes.aggregation,queries:s.attributes.queries.map(this.deserializeAttributeQuery)}:void 0,relation:s.relation?{name:s.relation.name,query:s.relation.query?this.deserializeQueryParameters(s.relation.query):void 0}:void 0}}),this._components=t,this.queries=e}set queries(t){this._queries=t,this.clearCache()}get queries(){return this._queries}set aggregation(t){t!==this._aggregation&&this.clearCache(),this._aggregation=t}get aggregation(){return this._aggregation}async test(t){const{modelIds:e,force:s}={force:!1,...t};if(this.result&&!s)return this.result;const r=await this._components.get(om).getItems(this.queries,{modelIds:e,aggregation:this.aggregation});return this.cache&&(this.result=r),r}clearCache(){this.result=null}serializeAttributeQuery(t){let e;return Array.isArray(t.value)?e=t.value.map(i=>i.source):t.value instanceof RegExp?e=t.value.source:e=t.value,{name:t.name.source,value:e,type:t.type instanceof RegExp?t.type.source:t.type,negate:t.negate,itemIds:t.itemIds}}toJSON(){return{name:"Finder Query",description:this.description,queries:this.queries.map(this.serializeQueryParameters),aggregation:this.aggregation,cache:this.cache}}deserializeAttributeQuery(t){let e;return Array.isArray(t.value)?e=t.value.map(i=>new RegExp(i)):typeof t.value=="string"?e=new RegExp(t.value):e=t.value,{name:new RegExp(t.name),value:e,type:t.type?new RegExp(t.type):void 0,negate:t.negate,itemIds:t.itemIds}}fromJSON(t){return this.description=t.description,this.aggregation=t.aggregation,this.cache=t.cache,this.queries=t.queries.map(this.deserializeQueryParameters),this}}const DT=class kT extends Fs{constructor(t){super(t),k(this,"enabled",!0),k(this,"list",new Yt),t.add(kT.uuid,this)}async getItems(t,e){const{modelIds:s}=e??{},i=e?.aggregation??"exclusive",r=this.components.get(Nt),o=await Promise.all(t.map(async l=>{const c={};return await Promise.all(Array.from(r.list).map(async([h,u])=>{if(s&&!s.some(d=>d.test(h)))return;const p=await u.getItemsByQuery(l);c[h]=new Set(p)})),c}));return i==="inclusive"?gs.join(o):gs.intersect(o)}create(t,e){const s=new j4(this.components,e);return this.list.set(t,s),s}async addFromCategories(t){const e=new Set,s=this.components.get(Nt);for(const[i,r]of s.list){if(t&&!t.some(l=>l.test(i)))continue;const o=(await r.getItemsWithGeometryCategories()).filter(l=>l!==null),a=new Set(o);for(const l of a)this.list.has(l)||(this.create(l,[{categories:[new RegExp(`^${l}$`)]}]),e.add(l))}return[...e]}import(t){const{data:e}=t,s=[];if(!e)return s;for(const i of e){const{name:r,description:o,queries:a,aggregation:l,cache:c}=i,h=this.create(r,[]);h.fromJSON({description:o,queries:a,aggregation:l,cache:c}),s.push(h)}return s}export(){const t=[];for(const[e,s]of this.list.entries()){const r={...s.toJSON(),name:e};t.push(r)}return{data:t}}};k(DT,"uuid","0da7ad77-f734-42ca-942f-a074adfd1e3a");let om=DT;const W4=class zT extends Fs{constructor(t){super(t),k(this,"enabled",!0),k(this,"onDisposed",new It),k(this,"list",new Yt),k(this,"defaultSaveFunction",s=>"value"in s.Name?s.Name.value:null),k(this,"onBeforeFragmentsDispose",async s=>{const{key:i,value:r}=s,o=await r.getLocalIds(),a={[i]:new Set(o)};this.removeItems(a)}),t.add(zT.uuid,this),this.setupEvents(),t.get(Nt).list.onBeforeDelete.add(this.onBeforeFragmentsDispose)}setupEvents(){this.list.onBeforeDelete.add(({value:t})=>t.dispose())}getClassificationGroups(t){let e=this.list.get(t);return e||(e=new Yt,this.list.set(t,e)),e}getModelItems(t,e,s){const{map:i}=this.getGroupData(t,e);let r=i[s];return r||(r=new Set,i[s]=r),r}getGroupData(t,e){const s=this.components.get(om),i=this.getClassificationGroups(t);let r=i.get(e);return r||(r={map:{},get(){return new Promise(o=>{if(!r){o({});return}if(r.query){const{name:a,config:l}=r.query,c=s.list.get(a);if(!c)throw new Error("Classifier: the query name associated with the group doesn't exist in the ItemsFinder component");c.test(l).then(h=>{if(!r){o({});return}const u=gs.join([h,r.map]);o(u)})}else o(r.map)})}},i.set(e,r)),r}async aggregateItems(t,e,s){const i=s?.data??void 0,r=s?.aggregationCallback??this.defaultSaveFunction,o=this.components.get(Nt),l=await this.components.get(om).getItems([e],{modelIds:s?.modelIds});for(const[c,h]of Object.entries(l)){const u=o.list.get(c);if(!u)continue;const p=(g,...m)=>{const b=this.getModelItems(t,g,c);for(const f of m)b.add(f)},d=await u.getItemsData([...h],i);for(const g of d)r(g,p)}}addGroupItems(t,e,s){const{map:i}=this.getGroupData(t,e);gs.add(i,s)}setGroupQuery(t,e,s){const i=this.getGroupData(t,e);i.query=s}async find(t){const e=[];for(const[i,r]of Object.entries(t)){const o=[],a=this.list.get(i);if(!a)continue;for(const c of r){const h=a.get(c);if(!h)continue;const u=await h.get();o.push(u)}const l=gs.join(o);e.push(l)}return gs.intersect(e)}async aggregateItemRelations(t,e,s,i){const r=i?.attribute??"Name",o={relations:{[s]:{attributes:!0,relations:!1}}};await this.aggregateItems(t,e,{modelIds:i?.modelIds,data:o,aggregationCallback:(a,l)=>{if(!a?.[r])return;const c=a[r];if(!("value"in c))return;const h=a[s];if(Array.isArray(h))for(const u of h)"value"in u._localId&&l(c.value,u._localId.value)}})}async byIfcBuildingStorey(t){await this.aggregateItemRelations(t?.classificationName??"Storeys",{categories:[/BUILDINGSTOREY/]},"ContainsElements",{modelIds:t?.modelIds})}async byCategory(t){const s=await this.components.get(om).addFromCategories(t?.modelIds);for(const i of s)this.setGroupQuery(t?.classificationName??"Categories",i,{name:i})}dispose(){this.list.clear(),this.components.get(Nt).list.onBeforeDelete.remove(this.onBeforeFragmentsDispose),this.onDisposed.trigger()}removeItems(t,e){if(e&&e.classificationName){const s=this.list.get(e.classificationName);if(!s||e.groupName&&!s.get(e.groupName))return;for(const[,i]of s)gs.remove(i.map,t);return}for(const[,s]of this.list.entries())for(const[,i]of s)gs.remove(i.map,t)}async byModel(t){const e=this.components.get(Nt),s=t?.classificationName??"Models";for(const[i,r]of e.list){if(t&&t.modelIds&&!t.modelIds.some(l=>l.test(i)))continue;const o=await r.getItemsIdsWithGeometry(),a={[i]:new Set(o)};this.getGroupData(s,i),this.addGroupItems(s,i,a)}}};k(W4,"uuid","e25a7f3c-46c4-4a14-9d3d-5115f24ebeb7");class Y4{constructor(t,e){k(this,"enabled",!0),k(this,"components"),k(this,"onDisposed",new It),k(this,"mouse"),k(this,"three",new el),k(this,"world");const s=e.renderer;if(!s)throw new Error("A renderer is needed for the raycaster to work!");this.world=e,this.mouse=new B4(s.three.domElement),this.components=t}dispose(){this.mouse.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}castRayToObjects(t=Array.from(this.world.meshes),e=this.mouse.position){if(!this.world)throw new Error("A world is needed to cast rays!");const s=this.world.camera.three;return this.three.setFromCamera(e,s),this.intersect(t)}async castRay(t){const e=t?.snappingClasses,s=t?.items??Array.from(this.world.meshes),i=t?.position??this.mouse.position;if(!this.world)throw new Error("A world is needed to cast rays!");const r=this.world.camera.three,o=this.components.get(Nt),a=this.world.renderer.three.domElement,l=this.mouse.rawPosition;let c=null;if(o.initialized&&(c=await o.raycast({camera:r,dom:a,mouse:l,snappingClasses:e}),s.length===0))return c;this.three.setFromCamera(i,r);const h=this.intersect(s);return c?h&&h.distance<c.distance?h:c:h}intersect(t=Array.from(this.world.meshes)){const e=this.three.intersectObjects(t),s=this.filterClippingPlanes(e);return s.length>0?s[0]:null}filterClippingPlanes(t){if(!this.world.renderer)throw new Error("Renderer not found!");const e=this.world.renderer.three;if(!e.clippingPlanes)return t;const s=e.clippingPlanes;return t.length<=0||!s||s?.length<=0?t:t.filter(i=>s.every(r=>r.distanceToPoint(i.point)>0))}}const BT=class UT extends Fs{constructor(t){super(t),k(this,"enabled",!0),k(this,"list",new Map),k(this,"onDisposed",new It),t.add(UT.uuid,this)}get(t){if(this.list.has(t.uuid))return this.list.get(t.uuid);const e=new Y4(this.components,t);return this.list.set(t.uuid,e),t.onDisposed.add(()=>{this.delete(t)}),e}delete(t){const e=this.list.get(t.uuid);e&&e.dispose(),this.list.delete(t.uuid)}dispose(){for(const[t,e]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger()}};k(BT,"uuid","d5d8bdf0-db25-4952-b951-b643af207ace");let L0=BT;class G4 extends ov{constructor(){super(...arguments),k(this,"onCameraChanged",new It),k(this,"meshes",new Set),k(this,"onAfterUpdate",new It),k(this,"onBeforeUpdate",new It),k(this,"onDisposed",new It),k(this,"isDisposing",!1),k(this,"enabled",!0),k(this,"_dynamicAnchor",!1),k(this,"uuid",wi.create()),k(this,"name"),k(this,"_scene"),k(this,"_camera"),k(this,"_renderer",null),k(this,"onPointerDown",async t=>{if(!this.camera.hasCameraControls())throw new Error("World: can't set dynamic anchor if the camera doesn't have controls.");const s=await this.components.get(L0).get(this).castRay();s&&s.point&&t.button===0&&this.camera.controls.setOrbitPoint(s.point.x,s.point.y,s.point.z)}),k(this,"_defaultCamera")}set dynamicAnchor(t){var e;const s=(e=this.renderer)==null?void 0:e.three.domElement.parentElement;if(!s)throw new Error("World: the renderer must have a parentElement to set dynamic anchoring.");t?(this.camera.controls&&(this.camera.controls.minDistance=.01),s.addEventListener("pointerdown",this.onPointerDown)):s.removeEventListener("pointerdown",this.onPointerDown)}get dynamicAnchor(){return this._dynamicAnchor}get defaultCamera(){if(!this._defaultCamera)throw new Error("World: there is no default camera defined.");return this._defaultCamera}set defaultCamera(t){this._defaultCamera=t}get scene(){if(!this._scene)throw new Error("No scene initialized!");return this._scene}set scene(t){this._scene=t,t.worlds.set(this.uuid,this),t.currentWorld=this,t.onWorldChanged.trigger({world:this,action:"added"})}get camera(){if(!this._camera)throw new Error("No camera initialized!");return this._camera}set camera(t){this._camera||(this.defaultCamera=t),this._camera=t,t.currentWorld=this,this.onCameraChanged.trigger(t)}get renderer(){return this._renderer}set renderer(t){this._renderer=t,t&&(t.worlds.set(this.uuid,this),t.currentWorld=this,t.onWorldChanged.trigger({world:this,action:"added"}))}useDefaultCamera(){this.camera=this.defaultCamera}update(t){this.enabled&&(!this._scene||!this._camera||(this.scene.currentWorld=this,this.camera.currentWorld=this,this.renderer&&(this.renderer.currentWorld=this),this.onBeforeUpdate.trigger(),this.scene.isUpdateable()&&this.scene.update(t),this.camera.isUpdateable()&&this.camera.update(t),this.renderer&&this.renderer.update(t),this.onAfterUpdate.trigger()))}dispose(t=!0){if(this.enabled=!1,this.isDisposing=!0,this.scene.onWorldChanged.trigger({world:this,action:"removed"}),this.camera.onWorldChanged.trigger({world:this,action:"removed"}),this.renderer&&this.renderer.onWorldChanged.trigger({world:this,action:"removed"}),t){const s=this.components.get(vg);this.scene.dispose(),this.camera.isDisposeable()&&this.camera.dispose(),this.renderer&&this.renderer.dispose();for(const i of this.meshes)s.destroy(i);this.meshes.clear()}this._scene=null,this._camera=null,this._renderer=null,this.components.get(Vd).list.delete(this.uuid),this.onDisposed.trigger(),this.onDisposed.reset()}}class q4{constructor(t,e){k(this,"_list"),k(this,"_scene"),this._list=t,this._scene=e}get color(){return this._list.directionalLight.color.value}set color(t){this._list.directionalLight.color.value=t;for(const[,e]of this._scene.directionalLights)e.color.copy(t)}get intensity(){return this._list.directionalLight.intensity.value}set intensity(t){this._list.directionalLight.intensity.value=t;for(const[,e]of this._scene.directionalLights)e.intensity=t}get position(){return this._list.directionalLight.position.value.clone()}set position(t){this._list.directionalLight.position.value=t;for(const[,e]of this._scene.directionalLights)e.position.copy(t)}}class Z4{constructor(t,e){k(this,"_list"),k(this,"_scene"),this._list=t,this._scene=e}get color(){return this._list.ambientLight.color.value}set color(t){this._list.ambientLight.color.value=t;for(const[,e]of this._scene.ambientLights)e.color.copy(t)}get intensity(){return this._list.ambientLight.intensity.value}set intensity(t){this._list.ambientLight.intensity.value=t;for(const[,e]of this._scene.ambientLights)e.intensity=t}}class X4 extends Ud{constructor(){super(...arguments),k(this,"_config",{backgroundColor:{value:new Dt,type:"Color"},ambientLight:{color:{type:"Color",value:new Dt},intensity:{type:"Number",interpolable:!0,min:0,max:10,value:2}},directionalLight:{color:{type:"Color",value:new Dt},intensity:{type:"Number",interpolable:!0,min:0,max:10,value:2},position:{type:"Vector3",value:new F}}}),k(this,"ambientLight",new Z4(this._config,this._component)),k(this,"directionalLight",new q4(this._config,this._component))}get backgroundColor(){return this._config.backgroundColor.value}set backgroundColor(t){this._config.backgroundColor.value=t,this._component.three.background=t}}class VT extends IM{constructor(t){super(t),k(this,"onSetup",new It),k(this,"isSetup",!1),k(this,"three"),k(this,"config",new X4(this,this.components,"Scene")),k(this,"_defaultConfig",{backgroundColor:new Dt(2107698),directionalLight:{color:new Dt("white"),intensity:1.5,position:new F(5,10,3)},ambientLight:{color:new Dt("white"),intensity:1}}),this.three=new mC,this.three.background=new Dt(2107698)}setup(t){const e={...this._defaultConfig,...t};this.config.backgroundColor=e.backgroundColor;const s=e.ambientLight;this.config.ambientLight.color=s.color,this.config.ambientLight.intensity=s.intensity;const i=e.directionalLight;this.config.directionalLight.color=i.color,this.config.directionalLight.intensity=i.intensity,this.config.directionalLight.position=i.position,this.deleteAllLights();const{color:r,intensity:o}=this.config.directionalLight,a=new n3(r,o);a.position.copy(i.position);const{color:l,intensity:c}=this.config.directionalLight,h=new r3(l,c);this.three.add(a,h),this.directionalLights.set(a.uuid,a),this.ambientLights.set(h.uuid,h),this.isSetup=!0,this.onSetup.trigger()}dispose(){super.dispose(),this.components.get(Ig).list.delete(this.config.uuid)}}class Q4 extends xM{constructor(t,e,s){super(t),k(this,"enabled",!0),k(this,"container"),k(this,"three"),k(this,"_canvas"),k(this,"_parameters"),k(this,"_resizeObserver",null),k(this,"onContainerUpdated",new It),k(this,"_resizing",!1),k(this,"resize",o=>{if(this._resizing)return;this._resizing=!0,this.onContainerUpdated.trigger();const a=o?o.x:this.container.clientWidth,l=o?o.y:this.container.clientHeight;this.three.setSize(a,l),this.onResize.trigger(new Ut(a,l)),this._resizing=!1}),k(this,"resizeEvent",()=>{this.resize()}),k(this,"onContextLost",o=>{o.preventDefault(),this.enabled=!1}),k(this,"onContextBack",()=>{this.three.setRenderTarget(null),this.three.dispose(),this.three=new wm({canvas:this._canvas,antialias:!0,alpha:!0,...this._parameters}),this.enabled=!0}),this.container=e,this._parameters=s,this.three=new wm({antialias:!0,alpha:!0,...s}),this.three.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.setupRenderer(),this.setupEvents(!0),this.resize(),this._canvas=this.three.domElement;const i=this.three.getContext(),{canvas:r}=i;r.addEventListener("webglcontextlost",this.onContextLost,!1),r.addEventListener("webglcontextrestored",this.onContextBack,!1)}update(){if(!this.enabled||!this.currentWorld)return;this.onBeforeUpdate.trigger(this);const t=this.currentWorld.scene.three,e=this.currentWorld.camera.three;this.three.render(t,e),this.onAfterUpdate.trigger(this)}dispose(){this.enabled=!1,this.setupEvents(!1),this.three.domElement.remove(),this.three.forceContextLoss(),this.three.dispose(),this.onResize.reset(),this.onAfterUpdate.reset(),this.onBeforeUpdate.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}getSize(){return new Ut(this.three.domElement.clientWidth,this.three.domElement.clientHeight)}setupEvents(t){const e=this.three.domElement.parentElement;if(!e)throw new Error("This renderer needs to have an HTML container!");this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null),window.removeEventListener("resize",this.resizeEvent),t&&(this._resizeObserver=new ResizeObserver(this.resizeEvent),this._resizeObserver.observe(e),window.addEventListener("resize",this.resizeEvent))}setupRenderer(){this.three.localClippingEnabled=!0,this.container&&this.container.appendChild(this.three.domElement),this.onContainerUpdated.trigger()}}/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const Fe={LEFT:1,RIGHT:2,MIDDLE:4},ot=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,SCREEN_PAN:4,OFFSET:8,DOLLY:16,ZOOM:32,TOUCH_ROTATE:64,TOUCH_TRUCK:128,TOUCH_SCREEN_PAN:256,TOUCH_OFFSET:512,TOUCH_DOLLY:1024,TOUCH_ZOOM:2048,TOUCH_DOLLY_TRUCK:4096,TOUCH_DOLLY_SCREEN_PAN:8192,TOUCH_DOLLY_OFFSET:16384,TOUCH_DOLLY_ROTATE:32768,TOUCH_ZOOM_TRUCK:65536,TOUCH_ZOOM_OFFSET:131072,TOUCH_ZOOM_SCREEN_PAN:262144,TOUCH_ZOOM_ROTATE:524288}),yl={NONE:0,IN:1,OUT:-1};function ra(n){return n.isPerspectiveCamera}function oo(n){return n.isOrthographicCamera}const vl=Math.PI*2,T1=Math.PI/2,HT=1e-5,Oh=Math.PI/180;function Cn(n,t,e){return Math.max(t,Math.min(e,n))}function be(n,t=HT){return Math.abs(n)<t}function se(n,t,e=HT){return be(n-t,e)}function A1(n,t){return Math.round(n/t)*t}function Ph(n){return isFinite(n)?n:n<0?-Number.MAX_VALUE:Number.MAX_VALUE}function Rh(n){return Math.abs(n)<Number.MAX_VALUE?n:n*(1/0)}function Wp(n,t,e,s,i=1/0,r){s=Math.max(1e-4,s);const o=2/s,a=o*r,l=1/(1+a+.48*a*a+.235*a*a*a);let c=n-t;const h=t,u=i*s;c=Cn(c,-u,u),t=n-c;const p=(e.value+o*c)*r;e.value=(e.value-o*p)*l;let d=t+(c+p)*l;return h-n>0==d>h&&(d=h,e.value=(d-h)/r),d}function S1(n,t,e,s,i=1/0,r,o){s=Math.max(1e-4,s);const a=2/s,l=a*r,c=1/(1+l+.48*l*l+.235*l*l*l);let h=t.x,u=t.y,p=t.z,d=n.x-h,g=n.y-u,m=n.z-p;const b=h,f=u,_=p,y=i*s,v=y*y,w=d*d+g*g+m*m;if(w>v){const N=Math.sqrt(w);d=d/N*y,g=g/N*y,m=m/N*y}h=n.x-d,u=n.y-g,p=n.z-m;const I=(e.x+a*d)*r,C=(e.y+a*g)*r,A=(e.z+a*m)*r;e.x=(e.x-a*I)*c,e.y=(e.y-a*C)*c,e.z=(e.z-a*A)*c,o.x=h+(d+I)*c,o.y=u+(g+C)*c,o.z=p+(m+A)*c;const S=b-n.x,P=f-n.y,M=_-n.z,T=o.x-b,L=o.y-f,E=o.z-_;return S*T+P*L+M*E>0&&(o.x=b,o.y=f,o.z=_,e.x=(o.x-b)/r,e.y=(o.y-f)/r,e.z=(o.z-_)/r),o}function Vb(n,t){t.set(0,0),n.forEach(e=>{t.x+=e.clientX,t.y+=e.clientY}),t.x/=n.length,t.y/=n.length}function Hb(n,t){return oo(n)?(console.warn(`${t} is not supported in OrthographicCamera`),!0):!1}class K4{constructor(){this._listeners={}}addEventListener(t,e){const s=this._listeners;s[t]===void 0&&(s[t]=[]),s[t].indexOf(e)===-1&&s[t].push(e)}hasEventListener(t,e){const s=this._listeners;return s[t]!==void 0&&s[t].indexOf(e)!==-1}removeEventListener(t,e){const i=this._listeners[t];if(i!==void 0){const r=i.indexOf(e);r!==-1&&i.splice(r,1)}}removeAllEventListeners(t){if(!t){this._listeners={};return}Array.isArray(this._listeners[t])&&(this._listeners[t].length=0)}dispatchEvent(t){const s=this._listeners[t.type];if(s!==void 0){t.target=this;const i=s.slice(0);for(let r=0,o=i.length;r<o;r++)i[r].call(this,t)}}}var jb;const J4="2.10.1",Yp=1/8,tD=/Mac/.test((jb=globalThis?.navigator)===null||jb===void 0?void 0:jb.platform);let Lt,O1,Gp,Wb,Zs,Vt,Xt,wl,Fh,Hn,jn,oa,P1,R1,Ni,Lh,El,F1,Yb,L1,Gb,qb,qp;class ks extends K4{static install(t){Lt=t.THREE,O1=Object.freeze(new Lt.Vector3(0,0,0)),Gp=Object.freeze(new Lt.Vector3(0,1,0)),Wb=Object.freeze(new Lt.Vector3(0,0,1)),Zs=new Lt.Vector2,Vt=new Lt.Vector3,Xt=new Lt.Vector3,wl=new Lt.Vector3,Fh=new Lt.Vector3,Hn=new Lt.Vector3,jn=new Lt.Vector3,oa=new Lt.Vector3,P1=new Lt.Vector3,R1=new Lt.Vector3,Ni=new Lt.Spherical,Lh=new Lt.Spherical,El=new Lt.Box3,F1=new Lt.Box3,Yb=new Lt.Sphere,L1=new Lt.Quaternion,Gb=new Lt.Quaternion,qb=new Lt.Matrix4,qp=new Lt.Raycaster}static get ACTION(){return ot}set verticalDragToForward(t){console.warn("camera-controls: `verticalDragToForward` was removed. Use `mouseButtons.left = CameraControls.ACTION.SCREEN_PAN` instead.")}constructor(t,e){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=ot.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=yl.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new Lt.Vector3,this._focalOffsetVelocity=new Lt.Vector3,this._zoomVelocity={value:0},this._truckInternal=(f,_,y,v)=>{let w,I;if(ra(this._camera)){const C=Vt.copy(this._camera.position).sub(this._target),A=this._camera.getEffectiveFOV()*Oh,S=C.length()*Math.tan(A*.5);w=this.truckSpeed*f*S/this._elementRect.height,I=this.truckSpeed*_*S/this._elementRect.height}else if(oo(this._camera)){const C=this._camera;w=this.truckSpeed*f*(C.right-C.left)/C.zoom/this._elementRect.width,I=this.truckSpeed*_*(C.top-C.bottom)/C.zoom/this._elementRect.height}else return;v?(y?this.setFocalOffset(this._focalOffsetEnd.x+w,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(w,0,!0),this.forward(-I,!0)):y?this.setFocalOffset(this._focalOffsetEnd.x+w,this._focalOffsetEnd.y+I,this._focalOffsetEnd.z,!0):this.truck(w,I,!0)},this._rotateInternal=(f,_)=>{const y=vl*this.azimuthRotateSpeed*f/this._elementRect.height,v=vl*this.polarRotateSpeed*_/this._elementRect.height;this.rotate(y,v,!0)},this._dollyInternal=(f,_,y)=>{const v=Math.pow(.95,-f*this.dollySpeed),w=this._sphericalEnd.radius,I=this._sphericalEnd.radius*v,C=Cn(I,this.minDistance,this.maxDistance),A=C-I;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(I,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(A,!0),this._dollyToNoClamp(C,!0)):this._dollyToNoClamp(C,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?I:C)-w,this._dollyControlCoord.set(_,y)),this._lastDollyDirection=Math.sign(-f)},this._zoomInternal=(f,_,y)=>{const v=Math.pow(.95,f*this.dollySpeed),w=this._zoom,I=this._zoom*v;this.zoomTo(I,!0),this.dollyToCursor&&(this._changedZoom+=I-w,this._dollyControlCoord.set(_,y))},typeof Lt>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=t,this._yAxisUpSpace=new Lt.Quaternion().setFromUnitVectors(this._camera.up,Gp),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=ot.NONE,this._target=new Lt.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new Lt.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new Lt.Spherical().setFromVector3(Vt.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new Lt.Vector3,new Lt.Vector3,new Lt.Vector3,new Lt.Vector3],this._updateNearPlaneCorners(),this._boundary=new Lt.Box3(new Lt.Vector3(-1/0,-1/0,-1/0),new Lt.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new Lt.Vector2,this.mouseButtons={left:ot.ROTATE,middle:ot.DOLLY,right:ot.TRUCK,wheel:ra(this._camera)?ot.DOLLY:oo(this._camera)?ot.ZOOM:ot.NONE},this.touches={one:ot.TOUCH_ROTATE,two:ra(this._camera)?ot.TOUCH_DOLLY_TRUCK:oo(this._camera)?ot.TOUCH_ZOOM_TRUCK:ot.NONE,three:ot.TOUCH_TRUCK};const s=new Lt.Vector2,i=new Lt.Vector2,r=new Lt.Vector2,o=f=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const v=this._domElement.getBoundingClientRect(),w=f.clientX/v.width,I=f.clientY/v.height;if(w<this._interactiveArea.left||w>this._interactiveArea.right||I<this._interactiveArea.top||I>this._interactiveArea.bottom)return}const _=f.pointerType!=="mouse"?null:(f.buttons&Fe.LEFT)===Fe.LEFT?Fe.LEFT:(f.buttons&Fe.MIDDLE)===Fe.MIDDLE?Fe.MIDDLE:(f.buttons&Fe.RIGHT)===Fe.RIGHT?Fe.RIGHT:null;if(_!==null){const v=this._findPointerByMouseButton(_);v&&this._disposePointer(v)}if((f.buttons&Fe.LEFT)===Fe.LEFT&&this._lockedPointer)return;const y={pointerId:f.pointerId,clientX:f.clientX,clientY:f.clientY,deltaX:0,deltaY:0,mouseButton:_};this._activePointers.push(y),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),this._isDragging=!0,p(f)},a=f=>{f.cancelable&&f.preventDefault();const _=f.pointerId,y=this._lockedPointer||this._findPointerById(_);if(y){if(y.clientX=f.clientX,y.clientY=f.clientY,y.deltaX=f.movementX,y.deltaY=f.movementY,this._state=0,f.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(f.buttons&Fe.LEFT)===Fe.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(f.buttons&Fe.MIDDLE)===Fe.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(f.buttons&Fe.RIGHT)===Fe.RIGHT&&(this._state=this._state|this.mouseButtons.right);d()}},l=f=>{const _=this._findPointerById(f.pointerId);if(!(_&&_===this._lockedPointer)){if(_&&this._disposePointer(_),f.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=ot.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=ot.NONE;g()}};let c=-1;const h=f=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===ot.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const I=this._domElement.getBoundingClientRect(),C=f.clientX/I.width,A=f.clientY/I.height;if(C<this._interactiveArea.left||C>this._interactiveArea.right||A<this._interactiveArea.top||A>this._interactiveArea.bottom)return}if(f.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===ot.ROTATE||this.mouseButtons.wheel===ot.TRUCK){const I=performance.now();c-I<1e3&&this._getClientRect(this._elementRect),c=I}const _=tD?-1:-3,y=f.deltaMode===1||f.ctrlKey?f.deltaY/_:f.deltaY/(_*10),v=this.dollyToCursor?(f.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,w=this.dollyToCursor?(f.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case ot.ROTATE:{this._rotateInternal(f.deltaX,f.deltaY),this._isUserControllingRotate=!0;break}case ot.TRUCK:{this._truckInternal(f.deltaX,f.deltaY,!1,!1),this._isUserControllingTruck=!0;break}case ot.SCREEN_PAN:{this._truckInternal(f.deltaX,f.deltaY,!1,!0),this._isUserControllingTruck=!0;break}case ot.OFFSET:{this._truckInternal(f.deltaX,f.deltaY,!0,!1),this._isUserControllingOffset=!0;break}case ot.DOLLY:{this._dollyInternal(-y,v,w),this._isUserControllingDolly=!0;break}case ot.ZOOM:{this._zoomInternal(-y,v,w),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},u=f=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===ks.ACTION.NONE){const _=f instanceof PointerEvent?f.pointerId:0,y=this._findPointerById(_);y&&this._disposePointer(y),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l);return}f.preventDefault()}},p=f=>{if(!this._enabled)return;if(Vb(this._activePointers,Zs),this._getClientRect(this._elementRect),s.copy(Zs),i.copy(Zs),this._activePointers.length>=2){const y=Zs.x-this._activePointers[1].clientX,v=Zs.y-this._activePointers[1].clientY,w=Math.sqrt(y*y+v*v);r.set(0,w);const I=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,C=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;i.set(I,C)}if(this._state=0,!f)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in f&&f.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(f.buttons&Fe.LEFT)===Fe.LEFT&&(this._state=this._state|this.mouseButtons.left),(f.buttons&Fe.MIDDLE)===Fe.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(f.buttons&Fe.RIGHT)===Fe.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&ot.ROTATE)===ot.ROTATE||(this._state&ot.TOUCH_ROTATE)===ot.TOUCH_ROTATE||(this._state&ot.TOUCH_DOLLY_ROTATE)===ot.TOUCH_DOLLY_ROTATE||(this._state&ot.TOUCH_ZOOM_ROTATE)===ot.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&ot.TRUCK)===ot.TRUCK||(this._state&ot.SCREEN_PAN)===ot.SCREEN_PAN||(this._state&ot.TOUCH_TRUCK)===ot.TOUCH_TRUCK||(this._state&ot.TOUCH_SCREEN_PAN)===ot.TOUCH_SCREEN_PAN||(this._state&ot.TOUCH_DOLLY_TRUCK)===ot.TOUCH_DOLLY_TRUCK||(this._state&ot.TOUCH_DOLLY_SCREEN_PAN)===ot.TOUCH_DOLLY_SCREEN_PAN||(this._state&ot.TOUCH_ZOOM_TRUCK)===ot.TOUCH_ZOOM_TRUCK||(this._state&ot.TOUCH_ZOOM_SCREEN_PAN)===ot.TOUCH_DOLLY_SCREEN_PAN)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&ot.DOLLY)===ot.DOLLY||(this._state&ot.TOUCH_DOLLY)===ot.TOUCH_DOLLY||(this._state&ot.TOUCH_DOLLY_TRUCK)===ot.TOUCH_DOLLY_TRUCK||(this._state&ot.TOUCH_DOLLY_SCREEN_PAN)===ot.TOUCH_DOLLY_SCREEN_PAN||(this._state&ot.TOUCH_DOLLY_OFFSET)===ot.TOUCH_DOLLY_OFFSET||(this._state&ot.TOUCH_DOLLY_ROTATE)===ot.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&ot.ZOOM)===ot.ZOOM||(this._state&ot.TOUCH_ZOOM)===ot.TOUCH_ZOOM||(this._state&ot.TOUCH_ZOOM_TRUCK)===ot.TOUCH_ZOOM_TRUCK||(this._state&ot.TOUCH_ZOOM_SCREEN_PAN)===ot.TOUCH_ZOOM_SCREEN_PAN||(this._state&ot.TOUCH_ZOOM_OFFSET)===ot.TOUCH_ZOOM_OFFSET||(this._state&ot.TOUCH_ZOOM_ROTATE)===ot.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&ot.OFFSET)===ot.OFFSET||(this._state&ot.TOUCH_OFFSET)===ot.TOUCH_OFFSET||(this._state&ot.TOUCH_DOLLY_OFFSET)===ot.TOUCH_DOLLY_OFFSET||(this._state&ot.TOUCH_ZOOM_OFFSET)===ot.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})},d=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,Vb(this._activePointers,Zs);const _=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,y=_?-_.deltaX:i.x-Zs.x,v=_?-_.deltaY:i.y-Zs.y;if(i.copy(Zs),((this._state&ot.ROTATE)===ot.ROTATE||(this._state&ot.TOUCH_ROTATE)===ot.TOUCH_ROTATE||(this._state&ot.TOUCH_DOLLY_ROTATE)===ot.TOUCH_DOLLY_ROTATE||(this._state&ot.TOUCH_ZOOM_ROTATE)===ot.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(y,v),this._isUserControllingRotate=!0),(this._state&ot.DOLLY)===ot.DOLLY||(this._state&ot.ZOOM)===ot.ZOOM){const w=this.dollyToCursor?(s.x-this._elementRect.x)/this._elementRect.width*2-1:0,I=this.dollyToCursor?(s.y-this._elementRect.y)/this._elementRect.height*-2+1:0,C=this.dollyDragInverted?-1:1;(this._state&ot.DOLLY)===ot.DOLLY?(this._dollyInternal(C*v*Yp,w,I),this._isUserControllingDolly=!0):(this._zoomInternal(C*v*Yp,w,I),this._isUserControllingZoom=!0)}if((this._state&ot.TOUCH_DOLLY)===ot.TOUCH_DOLLY||(this._state&ot.TOUCH_ZOOM)===ot.TOUCH_ZOOM||(this._state&ot.TOUCH_DOLLY_TRUCK)===ot.TOUCH_DOLLY_TRUCK||(this._state&ot.TOUCH_ZOOM_TRUCK)===ot.TOUCH_ZOOM_TRUCK||(this._state&ot.TOUCH_DOLLY_SCREEN_PAN)===ot.TOUCH_DOLLY_SCREEN_PAN||(this._state&ot.TOUCH_ZOOM_SCREEN_PAN)===ot.TOUCH_ZOOM_SCREEN_PAN||(this._state&ot.TOUCH_DOLLY_OFFSET)===ot.TOUCH_DOLLY_OFFSET||(this._state&ot.TOUCH_ZOOM_OFFSET)===ot.TOUCH_ZOOM_OFFSET||(this._state&ot.TOUCH_DOLLY_ROTATE)===ot.TOUCH_DOLLY_ROTATE||(this._state&ot.TOUCH_ZOOM_ROTATE)===ot.TOUCH_ZOOM_ROTATE){const w=Zs.x-this._activePointers[1].clientX,I=Zs.y-this._activePointers[1].clientY,C=Math.sqrt(w*w+I*I),A=r.y-C;r.set(0,C);const S=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,P=this.dollyToCursor?(i.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&ot.TOUCH_DOLLY)===ot.TOUCH_DOLLY||(this._state&ot.TOUCH_DOLLY_ROTATE)===ot.TOUCH_DOLLY_ROTATE||(this._state&ot.TOUCH_DOLLY_TRUCK)===ot.TOUCH_DOLLY_TRUCK||(this._state&ot.TOUCH_DOLLY_SCREEN_PAN)===ot.TOUCH_DOLLY_SCREEN_PAN||(this._state&ot.TOUCH_DOLLY_OFFSET)===ot.TOUCH_DOLLY_OFFSET?(this._dollyInternal(A*Yp,S,P),this._isUserControllingDolly=!0):(this._zoomInternal(A*Yp,S,P),this._isUserControllingZoom=!0)}((this._state&ot.TRUCK)===ot.TRUCK||(this._state&ot.TOUCH_TRUCK)===ot.TOUCH_TRUCK||(this._state&ot.TOUCH_DOLLY_TRUCK)===ot.TOUCH_DOLLY_TRUCK||(this._state&ot.TOUCH_ZOOM_TRUCK)===ot.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(y,v,!1,!1),this._isUserControllingTruck=!0),((this._state&ot.SCREEN_PAN)===ot.SCREEN_PAN||(this._state&ot.TOUCH_SCREEN_PAN)===ot.TOUCH_SCREEN_PAN||(this._state&ot.TOUCH_DOLLY_SCREEN_PAN)===ot.TOUCH_DOLLY_SCREEN_PAN||(this._state&ot.TOUCH_ZOOM_SCREEN_PAN)===ot.TOUCH_ZOOM_SCREEN_PAN)&&(this._truckInternal(y,v,!1,!0),this._isUserControllingTruck=!0),((this._state&ot.OFFSET)===ot.OFFSET||(this._state&ot.TOUCH_OFFSET)===ot.TOUCH_OFFSET||(this._state&ot.TOUCH_DOLLY_OFFSET)===ot.TOUCH_DOLLY_OFFSET||(this._state&ot.TOUCH_ZOOM_OFFSET)===ot.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(y,v,!0,!1),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},g=()=>{Vb(this._activePointers,Zs),i.copy(Zs),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",m),this._domElement.ownerDocument.addEventListener("pointerlockerror",b),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),p())},this.unlockPointer=()=>{var f,_,y;this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),(f=this._domElement)===null||f===void 0||f.ownerDocument.exitPointerLock(),(_=this._domElement)===null||_===void 0||_.ownerDocument.removeEventListener("pointerlockchange",m),(y=this._domElement)===null||y===void 0||y.ownerDocument.removeEventListener("pointerlockerror",b),this.cancel()};const m=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},b=()=>{this.unlockPointer()};this._addAllEventListeners=f=>{this._domElement=f,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",o),this._domElement.addEventListener("pointercancel",l),this._domElement.addEventListener("wheel",h,{passive:!1}),this._domElement.addEventListener("contextmenu",u)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",o),this._domElement.removeEventListener("pointercancel",l),this._domElement.removeEventListener("wheel",h,{passive:!1}),this._domElement.removeEventListener("contextmenu",u),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.removeEventListener("pointerlockchange",m),this._domElement.ownerDocument.removeEventListener("pointerlockerror",b))},this.cancel=()=>{this._state!==ot.NONE&&(this._state=ot.NONE,this._activePointers.length=0,g())},e&&this.connect(e),this.update(0)}get camera(){return this._camera}set camera(t){this._camera=t,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._domElement&&(t?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(t){this._spherical.radius===t&&this._sphericalEnd.radius===t||(this._spherical.radius=t,this._sphericalEnd.radius=t,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(t){this._spherical.theta===t&&this._sphericalEnd.theta===t||(this._spherical.theta=t,this._sphericalEnd.theta=t,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(t){this._spherical.phi===t&&this._sphericalEnd.phi===t||(this._spherical.phi=t,this._sphericalEnd.phi=t,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(t){this._boundaryEnclosesCamera=t,this._needsUpdate=!0}set interactiveArea(t){this._interactiveArea.width=Cn(t.width,0,1),this._interactiveArea.height=Cn(t.height,0,1),this._interactiveArea.x=Cn(t.x,0,1-this._interactiveArea.width),this._interactiveArea.y=Cn(t.y,0,1-this._interactiveArea.height)}addEventListener(t,e){super.addEventListener(t,e)}removeEventListener(t,e){super.removeEventListener(t,e)}rotate(t,e,s=!1){return this.rotateTo(this._sphericalEnd.theta+t,this._sphericalEnd.phi+e,s)}rotateAzimuthTo(t,e=!1){return this.rotateTo(t,this._sphericalEnd.phi,e)}rotatePolarTo(t,e=!1){return this.rotateTo(this._sphericalEnd.theta,t,e)}rotateTo(t,e,s=!1){this._isUserControllingRotate=!1;const i=Cn(t,this.minAzimuthAngle,this.maxAzimuthAngle),r=Cn(e,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=i,this._sphericalEnd.phi=r,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,s||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const o=!s||se(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&se(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(o)}dolly(t,e=!1){return this.dollyTo(this._sphericalEnd.radius-t,e)}dollyTo(t,e=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=yl.NONE,this._changedDolly=0,this._dollyToNoClamp(Cn(t,this.minDistance,this.maxDistance),e)}_dollyToNoClamp(t,e=!1){const s=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const o=this._collisionTest(),a=se(o,this._spherical.radius);if(!(s>t)&&a)return Promise.resolve();this._sphericalEnd.radius=Math.min(t,o)}else this._sphericalEnd.radius=t;this._needsUpdate=!0,e||(this._spherical.radius=this._sphericalEnd.radius);const r=!e||se(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(r)}dollyInFixed(t,e=!1){this._targetEnd.add(this._getCameraDirection(Fh).multiplyScalar(t)),e||this._target.copy(this._targetEnd);const s=!e||se(this._target.x,this._targetEnd.x,this.restThreshold)&&se(this._target.y,this._targetEnd.y,this.restThreshold)&&se(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}zoom(t,e=!1){return this.zoomTo(this._zoomEnd+t,e)}zoomTo(t,e=!1){this._isUserControllingZoom=!1,this._zoomEnd=Cn(t,this.minZoom,this.maxZoom),this._needsUpdate=!0,e||(this._zoom=this._zoomEnd);const s=!e||se(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(s)}pan(t,e,s=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(t,e,s)}truck(t,e,s=!1){this._camera.updateMatrix(),Hn.setFromMatrixColumn(this._camera.matrix,0),jn.setFromMatrixColumn(this._camera.matrix,1),Hn.multiplyScalar(t),jn.multiplyScalar(-e);const i=Vt.copy(Hn).add(jn),r=Xt.copy(this._targetEnd).add(i);return this.moveTo(r.x,r.y,r.z,s)}forward(t,e=!1){Vt.setFromMatrixColumn(this._camera.matrix,0),Vt.crossVectors(this._camera.up,Vt),Vt.multiplyScalar(t);const s=Xt.copy(this._targetEnd).add(Vt);return this.moveTo(s.x,s.y,s.z,e)}elevate(t,e=!1){return Vt.copy(this._camera.up).multiplyScalar(t),this.moveTo(this._targetEnd.x+Vt.x,this._targetEnd.y+Vt.y,this._targetEnd.z+Vt.z,e)}moveTo(t,e,s,i=!1){this._isUserControllingTruck=!1;const r=Vt.set(t,e,s).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,r,this.boundaryFriction),this._needsUpdate=!0,i||this._target.copy(this._targetEnd);const o=!i||se(this._target.x,this._targetEnd.x,this.restThreshold)&&se(this._target.y,this._targetEnd.y,this.restThreshold)&&se(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(o)}lookInDirectionOf(t,e,s,i=!1){const a=Vt.set(t,e,s).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(a.x,a.y,a.z,i)}fitToBox(t,e,{cover:s=!1,paddingLeft:i=0,paddingRight:r=0,paddingBottom:o=0,paddingTop:a=0}={}){const l=[],c=t.isBox3?El.copy(t):El.setFromObject(t);c.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const h=A1(this._sphericalEnd.theta,T1),u=A1(this._sphericalEnd.phi,T1);l.push(this.rotateTo(h,u,e));const p=Vt.setFromSpherical(this._sphericalEnd).normalize(),d=L1.setFromUnitVectors(p,Wb),g=se(Math.abs(p.y),1);g&&d.multiply(Gb.setFromAxisAngle(Gp,h)),d.multiply(this._yAxisUpSpaceInverse);const m=F1.makeEmpty();Xt.copy(c.min).applyQuaternion(d),m.expandByPoint(Xt),Xt.copy(c.min).setX(c.max.x).applyQuaternion(d),m.expandByPoint(Xt),Xt.copy(c.min).setY(c.max.y).applyQuaternion(d),m.expandByPoint(Xt),Xt.copy(c.max).setZ(c.min.z).applyQuaternion(d),m.expandByPoint(Xt),Xt.copy(c.min).setZ(c.max.z).applyQuaternion(d),m.expandByPoint(Xt),Xt.copy(c.max).setY(c.min.y).applyQuaternion(d),m.expandByPoint(Xt),Xt.copy(c.max).setX(c.min.x).applyQuaternion(d),m.expandByPoint(Xt),Xt.copy(c.max).applyQuaternion(d),m.expandByPoint(Xt),m.min.x-=i,m.min.y-=o,m.max.x+=r,m.max.y+=a,d.setFromUnitVectors(Wb,p),g&&d.premultiply(Gb.invert()),d.premultiply(this._yAxisUpSpace);const b=m.getSize(Vt),f=m.getCenter(Xt).applyQuaternion(d);if(ra(this._camera)){const _=this.getDistanceToFitBox(b.x,b.y,b.z,s);l.push(this.moveTo(f.x,f.y,f.z,e)),l.push(this.dollyTo(_,e)),l.push(this.setFocalOffset(0,0,0,e))}else if(oo(this._camera)){const _=this._camera,y=_.right-_.left,v=_.top-_.bottom,w=s?Math.max(y/b.x,v/b.y):Math.min(y/b.x,v/b.y);l.push(this.moveTo(f.x,f.y,f.z,e)),l.push(this.zoomTo(w,e)),l.push(this.setFocalOffset(0,0,0,e))}return Promise.all(l)}fitToSphere(t,e){const s=[],r="isObject3D"in t?ks.createBoundingSphere(t,Yb):Yb.copy(t);if(s.push(this.moveTo(r.center.x,r.center.y,r.center.z,e)),ra(this._camera)){const o=this.getDistanceToFitSphere(r.radius);s.push(this.dollyTo(o,e))}else if(oo(this._camera)){const o=this._camera.right-this._camera.left,a=this._camera.top-this._camera.bottom,l=2*r.radius,c=Math.min(o/l,a/l);s.push(this.zoomTo(c,e))}return s.push(this.setFocalOffset(0,0,0,e)),Promise.all(s)}setLookAt(t,e,s,i,r,o,a=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=yl.NONE,this._changedDolly=0;const l=Xt.set(i,r,o),c=Vt.set(t,e,s);this._targetEnd.copy(l),this._sphericalEnd.setFromVector3(c.sub(l).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,a||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const h=!a||se(this._target.x,this._targetEnd.x,this.restThreshold)&&se(this._target.y,this._targetEnd.y,this.restThreshold)&&se(this._target.z,this._targetEnd.z,this.restThreshold)&&se(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&se(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&se(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(h)}lerpLookAt(t,e,s,i,r,o,a,l,c,h,u,p,d,g=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=yl.NONE,this._changedDolly=0;const m=Vt.set(i,r,o),b=Xt.set(t,e,s);Ni.setFromVector3(b.sub(m).applyQuaternion(this._yAxisUpSpace));const f=wl.set(h,u,p),_=Xt.set(a,l,c);Lh.setFromVector3(_.sub(f).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(m.lerp(f,d));const y=Lh.theta-Ni.theta,v=Lh.phi-Ni.phi,w=Lh.radius-Ni.radius;this._sphericalEnd.set(Ni.radius+w*d,Ni.phi+v*d,Ni.theta+y*d),this.normalizeRotations(),this._needsUpdate=!0,g||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const I=!g||se(this._target.x,this._targetEnd.x,this.restThreshold)&&se(this._target.y,this._targetEnd.y,this.restThreshold)&&se(this._target.z,this._targetEnd.z,this.restThreshold)&&se(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&se(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&se(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(I)}setPosition(t,e,s,i=!1){return this.setLookAt(t,e,s,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,i)}setTarget(t,e,s,i=!1){const r=this.getPosition(Vt),o=this.setLookAt(r.x,r.y,r.z,t,e,s,i);return this._sphericalEnd.phi=Cn(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),o}setFocalOffset(t,e,s,i=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(t,e,s),this._needsUpdate=!0,i||this._focalOffset.copy(this._focalOffsetEnd);const r=!i||se(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&se(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&se(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}setOrbitPoint(t,e,s){this._camera.updateMatrixWorld(),Hn.setFromMatrixColumn(this._camera.matrixWorldInverse,0),jn.setFromMatrixColumn(this._camera.matrixWorldInverse,1),oa.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const i=Vt.set(t,e,s),r=i.distanceTo(this._camera.position),o=i.sub(this._camera.position);Hn.multiplyScalar(o.x),jn.multiplyScalar(o.y),oa.multiplyScalar(o.z),Vt.copy(Hn).add(jn).add(oa),Vt.z=Vt.z+r,this.dollyTo(r,!1),this.setFocalOffset(-Vt.x,Vt.y,-Vt.z,!1),this.moveTo(t,e,s,!1)}setBoundary(t){if(!t){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(t),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(t,e,s,i){if(t===null){this._viewport=null;return}this._viewport=this._viewport||new Lt.Vector4,typeof t=="number"?this._viewport.set(t,e,s,i):this._viewport.copy(t)}getDistanceToFitBox(t,e,s,i=!1){if(Hb(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const r=t/e,o=this._camera.getEffectiveFOV()*Oh,a=this._camera.aspect;return((i?r>a:r<a)?e:t/a)*.5/Math.tan(o*.5)+s*.5}getDistanceToFitSphere(t){if(Hb(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const e=this._camera.getEffectiveFOV()*Oh,s=Math.atan(Math.tan(e*.5)*this._camera.aspect)*2,i=1<this._camera.aspect?e:s;return t/Math.sin(i*.5)}getTarget(t,e=!0){return(t&&t.isVector3?t:new Lt.Vector3).copy(e?this._targetEnd:this._target)}getPosition(t,e=!0){return(t&&t.isVector3?t:new Lt.Vector3).setFromSpherical(e?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(e?this._targetEnd:this._target)}getSpherical(t,e=!0){return(t||new Lt.Spherical).copy(e?this._sphericalEnd:this._spherical)}getFocalOffset(t,e=!0){return(t&&t.isVector3?t:new Lt.Vector3).copy(e?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%vl,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=vl),this._spherical.theta+=vl*Math.round((this._sphericalEnd.theta-this._spherical.theta)/vl)}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(t=!1){if(!se(this._camera.up.x,this._cameraUp0.x)||!se(this._camera.up.y,this._cameraUp0.y)||!se(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const s=this.getPosition(Vt);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}const e=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,t),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,t),this.zoomTo(this._zoom0,t)];return Promise.all(e)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,Gp),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const t=Vt.subVectors(this._target,this._camera.position).normalize(),e=Xt.crossVectors(t,this._camera.up);this._camera.up.crossVectors(e,t).normalize(),this._camera.updateMatrixWorld();const s=this.getPosition(Vt);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}update(t){const e=this._sphericalEnd.theta-this._spherical.theta,s=this._sphericalEnd.phi-this._spherical.phi,i=this._sphericalEnd.radius-this._spherical.radius,r=P1.subVectors(this._targetEnd,this._target),o=R1.subVectors(this._focalOffsetEnd,this._focalOffset),a=this._zoomEnd-this._zoom;if(be(e))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const u=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=Wp(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,u,1/0,t),this._needsUpdate=!0}if(be(s))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const u=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=Wp(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,u,1/0,t),this._needsUpdate=!0}if(be(i))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const u=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=Wp(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,u,this.maxSpeed,t),this._needsUpdate=!0}if(be(r.x)&&be(r.y)&&be(r.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const u=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;S1(this._target,this._targetEnd,this._targetVelocity,u,this.maxSpeed,t,this._target),this._needsUpdate=!0}if(be(o.x)&&be(o.y)&&be(o.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const u=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;S1(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,u,this.maxSpeed,t,this._focalOffset),this._needsUpdate=!0}if(be(a))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const u=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=Wp(this._zoom,this._zoomEnd,this._zoomVelocity,u,1/0,t)}if(this.dollyToCursor){if(ra(this._camera)&&this._changedDolly!==0){const u=this._spherical.radius-this._lastDistance,p=this._camera,d=this._getCameraDirection(Fh),g=Vt.copy(d).cross(p.up).normalize();g.lengthSq()===0&&(g.x=1);const m=Xt.crossVectors(g,d),b=this._sphericalEnd.radius*Math.tan(p.getEffectiveFOV()*Oh*.5),_=(this._sphericalEnd.radius-u-this._sphericalEnd.radius)/this._sphericalEnd.radius,y=wl.copy(this._targetEnd).add(g.multiplyScalar(this._dollyControlCoord.x*b*p.aspect)).add(m.multiplyScalar(this._dollyControlCoord.y*b)),v=Vt.copy(this._targetEnd).lerp(y,_),w=this._lastDollyDirection===yl.IN&&this._spherical.radius<=this.minDistance,I=this._lastDollyDirection===yl.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(w||I)){this._sphericalEnd.radius-=u,this._spherical.radius-=u;const A=Xt.copy(d).multiplyScalar(-u);v.add(A)}this._boundary.clampPoint(v,v);const C=Xt.subVectors(v,this._targetEnd);this._targetEnd.copy(v),this._target.add(C),this._changedDolly-=u,be(this._changedDolly)&&(this._changedDolly=0)}else if(oo(this._camera)&&this._changedZoom!==0){const u=this._zoom-this._lastZoom,p=this._camera,d=Vt.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(p.near+p.far)/(p.near-p.far)).unproject(p),g=Xt.set(0,0,-1).applyQuaternion(p.quaternion),m=wl.copy(d).add(g.multiplyScalar(-d.dot(p.up))),f=-(this._zoom-u-this._zoom)/this._zoom,_=this._getCameraDirection(Fh),y=this._targetEnd.dot(_),v=Vt.copy(this._targetEnd).lerp(m,f),w=v.dot(_),I=_.multiplyScalar(w-y);v.sub(I),this._boundary.clampPoint(v,v);const C=Xt.subVectors(v,this._targetEnd);this._targetEnd.copy(v),this._target.add(C),this._changedZoom-=u,be(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const l=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,l),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!be(this._focalOffset.x)||!be(this._focalOffset.y)||!be(this._focalOffset.z))&&(Hn.setFromMatrixColumn(this._camera.matrix,0),jn.setFromMatrixColumn(this._camera.matrix,1),oa.setFromMatrixColumn(this._camera.matrix,2),Hn.multiplyScalar(this._focalOffset.x),jn.multiplyScalar(-this._focalOffset.y),oa.multiplyScalar(this._focalOffset.z),Vt.copy(Hn).add(jn).add(oa),this._camera.position.add(Vt),this._camera.updateMatrixWorld()),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),Vt.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const h=this._needsUpdate;return h&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):h?(this.dispatchEvent({type:"update"}),be(e,this.restThreshold)&&be(s,this.restThreshold)&&be(i,this.restThreshold)&&be(r.x,this.restThreshold)&&be(r.y,this.restThreshold)&&be(r.z,this.restThreshold)&&be(o.x,this.restThreshold)&&be(o.y,this.restThreshold)&&be(o.z,this.restThreshold)&&be(a,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!h&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=h,this._needsUpdate=!1,h}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:Ph(this.maxDistance),minZoom:this.minZoom,maxZoom:Ph(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:Ph(this.maxPolarAngle),minAzimuthAngle:Ph(this.minAzimuthAngle),maxAzimuthAngle:Ph(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,target:this._targetEnd.toArray(),position:Vt.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(t,e=!1){const s=JSON.parse(t);this.enabled=s.enabled,this.minDistance=s.minDistance,this.maxDistance=Rh(s.maxDistance),this.minZoom=s.minZoom,this.maxZoom=Rh(s.maxZoom),this.minPolarAngle=s.minPolarAngle,this.maxPolarAngle=Rh(s.maxPolarAngle),this.minAzimuthAngle=Rh(s.minAzimuthAngle),this.maxAzimuthAngle=Rh(s.maxAzimuthAngle),this.smoothTime=s.smoothTime,this.draggingSmoothTime=s.draggingSmoothTime,this.dollySpeed=s.dollySpeed,this.truckSpeed=s.truckSpeed,this.dollyToCursor=s.dollyToCursor,this._target0.fromArray(s.target0),this._position0.fromArray(s.position0),this._zoom0=s.zoom0,this._focalOffset0.fromArray(s.focalOffset0),this.moveTo(s.target[0],s.target[1],s.target[2],e),Ni.setFromVector3(Vt.fromArray(s.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(Ni.theta,Ni.phi,e),this.dollyTo(Ni.radius,e),this.zoomTo(s.zoom,e),this.setFocalOffset(s.focalOffset[0],s.focalOffset[1],s.focalOffset[2],e),this._needsUpdate=!0}connect(t){if(this._domElement){console.warn("camera-controls is already connected.");return}t.setAttribute("data-camera-controls-version",J4),this._addAllEventListeners(t),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(t){return t.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(t){return this._getTargetDirection(t).negate()}_findPointerById(t){return this._activePointers.find(e=>e.pointerId===t)}_findPointerByMouseButton(t){return this._activePointers.find(e=>e.mouseButton===t)}_disposePointer(t){this._activePointers.splice(this._activePointers.indexOf(t),1)}_encloseToBoundary(t,e,s){const i=e.lengthSq();if(i===0)return t;const r=Xt.copy(e).add(t),a=this._boundary.clampPoint(r,wl).sub(r),l=a.lengthSq();if(l===0)return t.add(e);if(l===i)return t;if(s===0)return t.add(e).add(a);{const c=1+s*l/e.dot(a);return t.add(Xt.copy(e).multiplyScalar(c)).add(a.multiplyScalar(1-s))}}_updateNearPlaneCorners(){if(ra(this._camera)){const t=this._camera,e=t.near,s=t.getEffectiveFOV()*Oh,i=Math.tan(s*.5)*e,r=i*t.aspect;this._nearPlaneCorners[0].set(-r,-i,0),this._nearPlaneCorners[1].set(r,-i,0),this._nearPlaneCorners[2].set(r,i,0),this._nearPlaneCorners[3].set(-r,i,0)}else if(oo(this._camera)){const t=this._camera,e=1/t.zoom,s=t.left*e,i=t.right*e,r=t.top*e,o=t.bottom*e;this._nearPlaneCorners[0].set(s,r,0),this._nearPlaneCorners[1].set(i,r,0),this._nearPlaneCorners[2].set(i,o,0),this._nearPlaneCorners[3].set(s,o,0)}}_collisionTest(){let t=1/0;if(!(this.colliderMeshes.length>=1)||Hb(this._camera,"_collisionTest"))return t;const s=this._getTargetDirection(Fh);qb.lookAt(O1,s,this._camera.up);for(let i=0;i<4;i++){const r=Xt.copy(this._nearPlaneCorners[i]);r.applyMatrix4(qb);const o=wl.addVectors(this._target,r);qp.set(o,s),qp.far=this._spherical.radius+1;const a=qp.intersectObjects(this.colliderMeshes);a.length!==0&&a[0].distance<t&&(t=a[0].distance)}return t}_getClientRect(t){if(!this._domElement)return;const e=this._domElement.getBoundingClientRect();return t.x=e.left,t.y=e.top,this._viewport?(t.x+=this._viewport.x,t.y+=e.height-this._viewport.w-this._viewport.y,t.width=this._viewport.z,t.height=this._viewport.w):(t.width=e.width,t.height=e.height),t}_createOnRestPromise(t){return t?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(e=>{const s=()=>{this.removeEventListener("rest",s),e()};this.addEventListener("rest",s)}))}_addAllEventListeners(t){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(t){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(t){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(t,e=new Lt.Sphere){const s=e,i=s.center;El.makeEmpty(),t.traverseVisible(o=>{o.isMesh&&El.expandByObject(o)}),El.getCenter(i);let r=0;return t.traverseVisible(o=>{if(!o.isMesh)return;const a=o;if(!a.geometry)return;const l=a.geometry.clone();l.applyMatrix4(a.matrixWorld);const h=l.attributes.position;for(let u=0,p=h.count;u<p;u++)Vt.fromBufferAttribute(h,u),r=Math.max(r,i.distanceToSquared(Vt))}),s.radius=Math.sqrt(r),s}}class md extends EM{constructor(t){super(t),k(this,"onBeforeUpdate",new It),k(this,"onAfterUpdate",new It),k(this,"onAspectUpdated",new It),k(this,"onDisposed",new It),k(this,"three"),k(this,"_allControls",new Map),k(this,"updateAspect",()=>{var e;if(!(!this.currentWorld||!this.currentWorld.renderer)){if(this.three instanceof sl){this.onAspectUpdated.trigger();return}if((e=this.currentWorld.renderer)!=null&&e.isResizeable()){const s=this.currentWorld.renderer.getSize();this.three.aspect=s.width/s.height,this.three.updateProjectionMatrix(),this.onAspectUpdated.trigger()}}}),this.three=this.setupCamera(),this.setupEvents(!0),this.worlds.onItemSet.add(({value:e})=>{const s=this.newCameraControls();this._allControls.set(e.uuid,s)}),this.worlds.onBeforeDelete.add(({value:e})=>{const s=this._allControls.get(e.uuid);s&&(s.dispose(),this._allControls.delete(e.uuid))})}get controls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");const t=this._allControls.get(this.currentWorld.uuid);if(!t)throw new Error("Controls not found!");return t}get enabled(){return this.currentWorld===null?!1:this.controls.enabled}set enabled(t){this.currentWorld!==null&&(this.controls.enabled=t)}set currentWorld(t){if(super.currentWorld=t,!t)return;this.worlds.get(t.uuid)||this.worlds.set(t.uuid,t)}get currentWorld(){return this._currentWorld}dispose(){this.setupEvents(!1),this.onAspectUpdated.reset(),this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.three.removeFromParent(),this.onDisposed.trigger(),this.onDisposed.reset();for(const[t,e]of this._allControls)e.dispose();this.worlds.clear()}async fitToItems(t){const e=await this.getItemsBounding(t);await this.controls.fitToSphere(e,!0)}async setOrbitToItems(t){const e=await this.getItemsBounding(t);this.controls.setOrbitPoint(e.center.x,e.center.y,e.center.z)}update(t){this.enabled&&(this.onBeforeUpdate.trigger(this),this.controls.update(t),this.onAfterUpdate.trigger(this))}async getItemsBounding(t){const e=this.components.get(Nt),s=this.components.get(MT);s.list.clear();const i=new Us;if(t)await s.addFromModelIdMap(t);else for(const[,r]of e.list)s.list.add(r.box);return s.get().getBoundingSphere(i),s.list.clear(),i}setupCamera(){const t=window.innerWidth/window.innerHeight,e=new Md(60,t,1,1e3);return e.position.set(50,50,50),e.lookAt(new F(0,0,0)),e}newCameraControls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");if(!this.currentWorld.renderer)throw new Error("This camera needs a renderer to work!");ks.install({THREE:md.getSubsetOfThree()});const{domElement:t}=this.currentWorld.renderer.three,e=new ks(this.three,t);return e.smoothTime=.2,e.dollyToCursor=!0,e.infinityDolly=!0,e.minDistance=6,e}setupEvents(t){t?window.addEventListener("resize",this.updateAspect):window.removeEventListener("resize",this.updateAspect)}static getSubsetOfThree(){return{MOUSE:uC,Vector2:Ut,Vector3:F,Vector4:un,Quaternion:Pe,Matrix4:xt,Spherical:hC,Box3:Tt,Sphere:Us,Raycaster:el,MathUtils:kd}}}const jT=class WT extends Fs{constructor(t){super(t),k(this,"onAfterUpdate",new It),k(this,"onBeforeUpdate",new It),k(this,"onDisposed",new It),k(this,"list",new Ac),k(this,"enabled",!0),t.add(WT.uuid,this)}create(){const t=new G4(this.components),e=t.uuid;if(this.list.has(e))throw new Error("There is already a world with this name!");return this.list.set(e,t),t}delete(t){if(!this.list.has(t.uuid))throw new Error("The provided world is not found in the list!");this.list.delete(t.uuid),t.dispose()}dispose(){this.enabled=!1;for(const[t,e]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger()}update(t){if(this.enabled)for(const[e,s]of this.list)s.update(t)}};k(jT,"uuid","fdb61dc4-2ec1-4966-b83d-54ea795fad4a");let Vd=jT;class eD extends Ud{constructor(){super(...arguments),k(this,"_config",{visible:{value:!0,type:"Boolean"},color:{value:new Dt,type:"Color"},primarySize:{type:"Number",interpolable:!0,value:1,min:0,max:1e3},secondarySize:{type:"Number",interpolable:!0,value:10,min:0,max:1e3},distance:{type:"Number",interpolable:!0,value:500,min:0,max:500}})}get visible(){return this._config.visible.value}set visible(t){this._config.visible.value=t,this._component.visible=t}get color(){return this._config.color.value}set color(t){this._config.color.value=t,this._component.material.uniforms.uColor.value=t,this._component.material.uniformsNeedUpdate=!0}get primarySize(){return this._config.primarySize.value}set primarySize(t){this._config.primarySize.value=t,this._component.material.uniforms.uSize1.value=t,this._component.material.uniformsNeedUpdate=!0}get secondarySize(){return this._config.secondarySize.value}set secondarySize(t){this._config.secondarySize.value=t,this._component.material.uniforms.uSize2.value=t,this._component.material.uniformsNeedUpdate=!0}get distance(){return this._config.distance.value}set distance(t){this._config.distance.value=t,this._component.material.uniforms.uDistance.value=t,this._component.material.uniformsNeedUpdate=!0}}class sD{constructor(t,e){k(this,"onDisposed",new It),k(this,"onSetup",new It),k(this,"isSetup",!1),k(this,"world"),k(this,"components"),k(this,"config"),k(this,"_defaultConfig",{visible:!0,color:new Dt(12303291),primarySize:1,secondarySize:10,distance:500}),k(this,"three"),k(this,"_fade",3),k(this,"updateZoom",()=>{this.world.camera instanceof md&&(this.material.uniforms.uZoom.value=this.world.camera.three.zoom)}),this.world=e;const{color:s,primarySize:i,secondarySize:r,distance:o}=this._defaultConfig;this.components=t,this.config=new eD(this,this.components,"Grid");const a=new Zc(2,2,1,1),l=new Dd({side:Pi,uniforms:{uSize1:{value:i},uSize2:{value:r},uColor:{value:s},uDistance:{value:o},uFade:{value:this._fade},uZoom:{value:1}},transparent:!0,vertexShader:`
            
            varying vec3 worldPosition;
            
            uniform float uDistance;
            
            void main() {
            
                    vec3 pos = position.xzy * uDistance;
                    pos.xz += cameraPosition.xz;
                    
                    worldPosition = pos;
                    
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
            
            }
            `,fragmentShader:`
            
            varying vec3 worldPosition;
            
            uniform float uZoom;
            uniform float uFade;
            uniform float uSize1;
            uniform float uSize2;
            uniform vec3 uColor;
            uniform float uDistance;
                
                
                
                float getGrid(float size) {
                
                    vec2 r = worldPosition.xz / size;
                    
                    
                    vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
                    float line = min(grid.x, grid.y);
                    
                
                    return 1.0 - min(line, 1.0);
                }
                
            void main() {
            
                    
                    float d = 1.0 - min(distance(cameraPosition.xz, worldPosition.xz) / uDistance, 1.0);
                    
                    float g1 = getGrid(uSize1);
                    float g2 = getGrid(uSize2);
                    
                    // Ortho camera fades the grid away when zooming out
                    float minZoom = step(0.2, uZoom);
                    float zoomFactor = pow(min(uZoom, 1.), 2.) * minZoom;
                    
                    gl_FragColor = vec4(uColor.rgb, mix(g2, g1, g1) * pow(d, uFade));
                    gl_FragColor.a = mix(0.5 * gl_FragColor.a, gl_FragColor.a, g2) * zoomFactor;
                    
                    if ( gl_FragColor.a <= 0.0 ) discard;
                    
            
            }
            
            `,extensions:{derivatives:!0}});this.three=new ht(a,l),this.three.frustumCulled=!1,e.scene.three.add(this.three),this.setupEvents(!0)}get visible(){return this.three.visible}set visible(t){this.three.visible=t,t?this.world.scene.three.add(this.three):this.three.removeFromParent()}get material(){return this.three.material}get fade(){return this._fade===3}set fade(t){this._fade=t?3:0,this.material.uniforms.uFade.value=this._fade}setup(t){const e={...this._defaultConfig,...t};this.config.visible=!0,this.config.color=e.color,this.config.primarySize=e.primarySize,this.config.secondarySize=e.secondarySize,this.config.distance=e.distance,this.isSetup=!0,this.onSetup.trigger()}dispose(){this.setupEvents(!1),this.components.get(Ig).list.delete(this.config.uuid),this.components.get(vg).destroy(this.three),this.onDisposed.trigger(),this.onDisposed.reset(),this.world=null,this.components=null}setupEvents(t){if(this.world.isDisposing||!(this.world.camera instanceof md))return;const e=this.world.camera.controls;t?e.addEventListener("update",this.updateZoom):e.removeEventListener("update",this.updateZoom)}}const YT=class GT extends Fs{constructor(t){super(t),k(this,"list",new Map),k(this,"onDisposed",new It),k(this,"enabled",!0),t.add(GT.uuid,this)}create(t){if(this.list.has(t.uuid))throw new Error("This world already has a grid!");const e=new sD(this.components,t);return this.list.set(t.uuid,e),t.onDisposed.add(()=>{this.delete(t)}),e}delete(t){const e=this.list.get(t.uuid);e&&e.dispose(),this.list.delete(t.uuid)}dispose(){for(const[t,e]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger(),this.onDisposed.reset()}};k(YT,"uuid","d1e814d5-b81c-4452-87a2-f039375e0489");let iD=YT;const qT=0,nD=1,rD=2,$1=2,Zb=1.25,N1=1,am=32,Cg=65535,oD=Math.pow(2,-24),Xb=Symbol("SKIP_GENERATION");function aD(n){return n.index?n.index.count:n.attributes.position.count}function Jc(n){return aD(n)/3}function lD(n,t=ArrayBuffer){return n>65535?new Uint32Array(new t(4*n)):new Uint16Array(new t(2*n))}function cD(n,t){if(!n.index){const e=n.attributes.position.count,s=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,i=lD(e,s);n.setIndex(new ze(i,1));for(let r=0;r<e;r++)i[r]=r}}function ZT(n){const t=Jc(n),e=n.drawRange,s=e.start/3,i=(e.start+e.count)/3,r=Math.max(0,s),o=Math.min(t,i)-r;return[{offset:Math.floor(r),count:Math.floor(o)}]}function XT(n){if(!n.groups||!n.groups.length)return ZT(n);const t=[],e=new Set,s=n.drawRange,i=s.start/3,r=(s.start+s.count)/3;for(const a of n.groups){const l=a.start/3,c=(a.start+a.count)/3;e.add(Math.max(i,l)),e.add(Math.min(r,c))}const o=Array.from(e.values()).sort((a,l)=>a-l);for(let a=0;a<o.length-1;a++){const l=o[a],c=o[a+1];t.push({offset:Math.floor(l),count:Math.floor(c-l)})}return t}function hD(n){if(n.groups.length===0)return!1;const t=Jc(n),e=XT(n).sort((r,o)=>r.offset-o.offset),s=e[e.length-1];s.count=Math.min(t-s.offset,s.count);let i=0;return e.forEach(({count:r})=>i+=r),t!==i}function De(n,t,e){return e.min.x=t[n],e.min.y=t[n+1],e.min.z=t[n+2],e.max.x=t[n+3],e.max.y=t[n+4],e.max.z=t[n+5],e}function uD(n){n[0]=n[1]=n[2]=1/0,n[3]=n[4]=n[5]=-1/0}function M1(n){let t=-1,e=-1/0;for(let s=0;s<3;s++){const i=n[s+3]-n[s];i>e&&(e=i,t=s)}return t}function D1(n,t){t.set(n)}function k1(n,t,e){let s,i;for(let r=0;r<3;r++){const o=r+3;s=n[r],i=t[r],e[r]=s<i?s:i,s=n[o],i=t[o],e[o]=s>i?s:i}}function Zp(n,t,e){for(let s=0;s<3;s++){const i=t[n+2*s],r=t[n+2*s+1],o=i-r,a=i+r;o<e[s]&&(e[s]=o),a>e[s+3]&&(e[s+3]=a)}}function $h(n){const t=n[3]-n[0],e=n[4]-n[1],s=n[5]-n[2];return 2*(t*e+e*s+s*t)}function Qb(n,t,e,s,i=null){let r=1/0,o=1/0,a=1/0,l=-1/0,c=-1/0,h=-1/0,u=1/0,p=1/0,d=1/0,g=-1/0,m=-1/0,b=-1/0;const f=i!==null;for(let _=t*6,y=(t+e)*6;_<y;_+=6){const v=n[_+0],w=n[_+1],I=v-w,C=v+w;I<r&&(r=I),C>l&&(l=C),f&&v<u&&(u=v),f&&v>g&&(g=v);const A=n[_+2],S=n[_+3],P=A-S,M=A+S;P<o&&(o=P),M>c&&(c=M),f&&A<p&&(p=A),f&&A>m&&(m=A);const T=n[_+4],L=n[_+5],E=T-L,N=T+L;E<a&&(a=E),N>h&&(h=N),f&&T<d&&(d=T),f&&T>b&&(b=T)}s[0]=r,s[1]=o,s[2]=a,s[3]=l,s[4]=c,s[5]=h,f&&(i[0]=u,i[1]=p,i[2]=d,i[3]=g,i[4]=m,i[5]=b)}function dD(n,t,e,s){let i=1/0,r=1/0,o=1/0,a=-1/0,l=-1/0,c=-1/0;for(let h=t*6,u=(t+e)*6;h<u;h+=6){const p=n[h+0];p<i&&(i=p),p>a&&(a=p);const d=n[h+2];d<r&&(r=d),d>l&&(l=d);const g=n[h+4];g<o&&(o=g),g>c&&(c=g)}s[0]=i,s[1]=r,s[2]=o,s[3]=a,s[4]=l,s[5]=c}function pD(n,t){uD(t);const e=n.attributes.position,s=n.index?n.index.array:null,i=Jc(n),r=new Float32Array(i*6),o=e.normalized,a=e.array,l=e.offset||0;let c=3;e.isInterleavedBufferAttribute&&(c=e.data.stride);const h=["getX","getY","getZ"];for(let u=0;u<i;u++){const p=u*3,d=u*6;let g=p+0,m=p+1,b=p+2;s&&(g=s[g],m=s[m],b=s[b]),o||(g=g*c+l,m=m*c+l,b=b*c+l);for(let f=0;f<3;f++){let _,y,v;o?(_=e[h[f]](g),y=e[h[f]](m),v=e[h[f]](b)):(_=a[g+f],y=a[m+f],v=a[b+f]);let w=_;y<w&&(w=y),v<w&&(w=v);let I=_;y>I&&(I=y),v>I&&(I=v);const C=(I-w)/2,A=f*2;r[d+A+0]=w+C,r[d+A+1]=C+(Math.abs(w)+C)*oD,w<t[f]&&(t[f]=w),I>t[f+3]&&(t[f+3]=I)}}return r}const Sr=32,fD=(n,t)=>n.candidate-t.candidate,Jr=new Array(Sr).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),Xp=new Float32Array(6);function mD(n,t,e,s,i,r){let o=-1,a=0;if(r===qT)o=M1(t),o!==-1&&(a=(t[o]+t[o+3])/2);else if(r===nD)o=M1(n),o!==-1&&(a=gD(e,s,i,o));else if(r===rD){const l=$h(n);let c=Zb*i;const h=s*6,u=(s+i)*6;for(let p=0;p<3;p++){const d=t[p],b=(t[p+3]-d)/Sr;if(i<Sr/4){const f=[...Jr];f.length=i;let _=0;for(let v=h;v<u;v+=6,_++){const w=f[_];w.candidate=e[v+2*p],w.count=0;const{bounds:I,leftCacheBounds:C,rightCacheBounds:A}=w;for(let S=0;S<3;S++)A[S]=1/0,A[S+3]=-1/0,C[S]=1/0,C[S+3]=-1/0,I[S]=1/0,I[S+3]=-1/0;Zp(v,e,I)}f.sort(fD);let y=i;for(let v=0;v<y;v++){const w=f[v];for(;v+1<y&&f[v+1].candidate===w.candidate;)f.splice(v+1,1),y--}for(let v=h;v<u;v+=6){const w=e[v+2*p];for(let I=0;I<y;I++){const C=f[I];w>=C.candidate?Zp(v,e,C.rightCacheBounds):(Zp(v,e,C.leftCacheBounds),C.count++)}}for(let v=0;v<y;v++){const w=f[v],I=w.count,C=i-w.count,A=w.leftCacheBounds,S=w.rightCacheBounds;let P=0;I!==0&&(P=$h(A)/l);let M=0;C!==0&&(M=$h(S)/l);const T=N1+Zb*(P*I+M*C);T<c&&(o=p,c=T,a=w.candidate)}}else{for(let y=0;y<Sr;y++){const v=Jr[y];v.count=0,v.candidate=d+b+y*b;const w=v.bounds;for(let I=0;I<3;I++)w[I]=1/0,w[I+3]=-1/0}for(let y=h;y<u;y+=6){let I=~~((e[y+2*p]-d)/b);I>=Sr&&(I=Sr-1);const C=Jr[I];C.count++,Zp(y,e,C.bounds)}const f=Jr[Sr-1];D1(f.bounds,f.rightCacheBounds);for(let y=Sr-2;y>=0;y--){const v=Jr[y],w=Jr[y+1];k1(v.bounds,w.rightCacheBounds,v.rightCacheBounds)}let _=0;for(let y=0;y<Sr-1;y++){const v=Jr[y],w=v.count,I=v.bounds,A=Jr[y+1].rightCacheBounds;w!==0&&(_===0?D1(I,Xp):k1(I,Xp,Xp)),_+=w;let S=0,P=0;_!==0&&(S=$h(Xp)/l);const M=i-_;M!==0&&(P=$h(A)/l);const T=N1+Zb*(S*_+P*M);T<c&&(o=p,c=T,a=v.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${r} used.`);return{axis:o,pos:a}}function gD(n,t,e,s){let i=0;for(let r=t,o=t+e;r<o;r++)i+=n[r*6+s*2];return i/e}class Qp{constructor(){}}function bD(n,t,e,s,i,r){let o=s,a=s+i-1;const l=r.pos,c=r.axis*2;for(;;){for(;o<=a&&e[o*6+c]<l;)o++;for(;o<=a&&e[a*6+c]>=l;)a--;if(o<a){for(let h=0;h<3;h++){let u=t[o*3+h];t[o*3+h]=t[a*3+h],t[a*3+h]=u}for(let h=0;h<6;h++){let u=e[o*6+h];e[o*6+h]=e[a*6+h],e[a*6+h]=u}o++,a--}else return o}}function _D(n,t,e,s,i,r){let o=s,a=s+i-1;const l=r.pos,c=r.axis*2;for(;;){for(;o<=a&&e[o*6+c]<l;)o++;for(;o<=a&&e[a*6+c]>=l;)a--;if(o<a){let h=n[o];n[o]=n[a],n[a]=h;for(let u=0;u<6;u++){let p=e[o*6+u];e[o*6+u]=e[a*6+u],e[a*6+u]=p}o++,a--}else return o}}function yD(n,t){const e=(n.index?n.index.count:n.attributes.position.count)/3,s=e>2**16,i=s?4:2,r=t?new SharedArrayBuffer(e*i):new ArrayBuffer(e*i),o=s?new Uint32Array(r):new Uint16Array(r);for(let a=0,l=o.length;a<l;a++)o[a]=a;return o}function vD(n,t){const e=n.geometry,s=e.index?e.index.array:null,i=t.maxDepth,r=t.verbose,o=t.maxLeafTris,a=t.strategy,l=t.onProgress,c=Jc(e),h=n._indirectBuffer;let u=!1;const p=new Float32Array(6),d=new Float32Array(6),g=pD(e,p),m=t.indirect?_D:bD,b=[],f=t.indirect?ZT(e):XT(e);if(f.length===1){const v=f[0],w=new Qp;w.boundingData=p,dD(g,v.offset,v.count,d),y(w,v.offset,v.count,d),b.push(w)}else for(let v of f){const w=new Qp;w.boundingData=new Float32Array(6),Qb(g,v.offset,v.count,w.boundingData,d),y(w,v.offset,v.count,d),b.push(w)}return b;function _(v){l&&l(v/c)}function y(v,w,I,C=null,A=0){if(!u&&A>=i&&(u=!0,r&&(console.warn(`MeshBVH: Max depth of ${i} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),I<=o||A>=i)return _(w+I),v.offset=w,v.count=I,v;const S=mD(v.boundingData,C,g,w,I,a);if(S.axis===-1)return _(w+I),v.offset=w,v.count=I,v;const P=m(h,s,g,w,I,S);if(P===w||P===w+I)_(w+I),v.offset=w,v.count=I;else{v.splitAxis=S.axis;const M=new Qp,T=w,L=P-w;v.left=M,M.boundingData=new Float32Array(6),Qb(g,T,L,M.boundingData,d),y(M,T,L,d,A+1);const E=new Qp,N=P,W=I-L;v.right=E,E.boundingData=new Float32Array(6),Qb(g,N,W,E.boundingData,d),y(E,N,W,d,A+1)}return v}}function wD(n,t){const e=n.geometry;t.indirect&&(n._indirectBuffer=yD(e,t.useSharedArrayBuffer),hD(e)&&!t.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),n._indirectBuffer||cD(e,t);const s=vD(n,t);let i,r,o;const a=[],l=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let u=0;u<s.length;u++){const p=s[u];let d=c(p);const g=new l(am*d);i=new Float32Array(g),r=new Uint32Array(g),o=new Uint16Array(g),h(0,p),a.push(g)}n._roots=a;return;function c(u){return u.count?1:1+c(u.left)+c(u.right)}function h(u,p){const d=u/4,g=u/2,m=!!p.count,b=p.boundingData;for(let f=0;f<6;f++)i[d+f]=b[f];if(m){const f=p.offset,_=p.count;return r[d+6]=f,o[g+14]=_,o[g+15]=Cg,u+am}else{const f=p.left,_=p.right,y=p.splitAxis;let v;if(v=h(u+am,f),v/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return r[d+6]=v/4,v=h(v,_),r[d+7]=y,v}}}class Vr{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(t,e){let s=1/0,i=-1/0;for(let r=0,o=t.length;r<o;r++){const l=t[r][e];s=l<s?l:s,i=l>i?l:i}this.min=s,this.max=i}setFromPoints(t,e){let s=1/0,i=-1/0;for(let r=0,o=e.length;r<o;r++){const a=e[r],l=t.dot(a);s=l<s?l:s,i=l>i?l:i}this.min=s,this.max=i}isSeparated(t){return this.min>t.max||t.min>this.max}}Vr.prototype.setFromBox=(function(){const n=new F;return function(e,s){const i=s.min,r=s.max;let o=1/0,a=-1/0;for(let l=0;l<=1;l++)for(let c=0;c<=1;c++)for(let h=0;h<=1;h++){n.x=i.x*l+r.x*(1-l),n.y=i.y*c+r.y*(1-c),n.z=i.z*h+r.z*(1-h);const u=e.dot(n);o=Math.min(u,o),a=Math.max(u,a)}this.min=o,this.max=a}})();const ED=(function(){const n=new F,t=new F,e=new F;return function(i,r,o){const a=i.start,l=n,c=r.start,h=t;e.subVectors(a,c),n.subVectors(i.end,i.start),t.subVectors(r.end,r.start);const u=e.dot(h),p=h.dot(l),d=h.dot(h),g=e.dot(l),b=l.dot(l)*d-p*p;let f,_;b!==0?f=(u*p-g*d)/b:f=0,_=(u+f*p)/d,o.x=f,o.y=_}})(),uv=(function(){const n=new Ut,t=new F,e=new F;return function(i,r,o,a){ED(i,r,n);let l=n.x,c=n.y;if(l>=0&&l<=1&&c>=0&&c<=1){i.at(l,o),r.at(c,a);return}else if(l>=0&&l<=1){c<0?r.at(0,a):r.at(1,a),i.closestPointToPoint(a,!0,o);return}else if(c>=0&&c<=1){l<0?i.at(0,o):i.at(1,o),r.closestPointToPoint(o,!0,a);return}else{let h;l<0?h=i.start:h=i.end;let u;c<0?u=r.start:u=r.end;const p=t,d=e;if(i.closestPointToPoint(u,!0,t),r.closestPointToPoint(h,!0,e),p.distanceToSquared(u)<=d.distanceToSquared(h)){o.copy(p),a.copy(u);return}else{o.copy(h),a.copy(d);return}}}})(),xD=(function(){const n=new F,t=new F,e=new Wt,s=new qt;return function(r,o){const{radius:a,center:l}=r,{a:c,b:h,c:u}=o;if(s.start=c,s.end=h,s.closestPointToPoint(l,!0,n).distanceTo(l)<=a||(s.start=c,s.end=u,s.closestPointToPoint(l,!0,n).distanceTo(l)<=a)||(s.start=h,s.end=u,s.closestPointToPoint(l,!0,n).distanceTo(l)<=a))return!0;const m=o.getPlane(e);if(Math.abs(m.distanceToPoint(l))<=a){const f=m.projectPoint(l,t);if(o.containsPoint(f))return!0}return!1}})(),ID=1e-15;function Kb(n){return Math.abs(n)<ID}class Ln extends ns{constructor(...t){super(...t),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new F),this.satBounds=new Array(4).fill().map(()=>new Vr),this.points=[this.a,this.b,this.c],this.sphere=new Us,this.plane=new Wt,this.needsUpdate=!0}intersectsSphere(t){return xD(t,this)}update(){const t=this.a,e=this.b,s=this.c,i=this.points,r=this.satAxes,o=this.satBounds,a=r[0],l=o[0];this.getNormal(a),l.setFromPoints(a,i);const c=r[1],h=o[1];c.subVectors(t,e),h.setFromPoints(c,i);const u=r[2],p=o[2];u.subVectors(e,s),p.setFromPoints(u,i);const d=r[3],g=o[3];d.subVectors(s,t),g.setFromPoints(d,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,t),this.needsUpdate=!1}}Ln.prototype.closestPointToSegment=(function(){const n=new F,t=new F,e=new qt;return function(i,r=null,o=null){const{start:a,end:l}=i,c=this.points;let h,u=1/0;for(let p=0;p<3;p++){const d=(p+1)%3;e.start.copy(c[p]),e.end.copy(c[d]),uv(e,i,n,t),h=n.distanceToSquared(t),h<u&&(u=h,r&&r.copy(n),o&&o.copy(t))}return this.closestPointToPoint(a,n),h=a.distanceToSquared(n),h<u&&(u=h,r&&r.copy(n),o&&o.copy(a)),this.closestPointToPoint(l,n),h=l.distanceToSquared(n),h<u&&(u=h,r&&r.copy(n),o&&o.copy(l)),Math.sqrt(u)}})();Ln.prototype.intersectsTriangle=(function(){const n=new Ln,t=new Array(3),e=new Array(3),s=new Vr,i=new Vr,r=new F,o=new F,a=new F,l=new F,c=new F,h=new qt,u=new qt,p=new qt,d=new F;function g(m,b,f){const _=m.points;let y=0,v=-1;for(let w=0;w<3;w++){const{start:I,end:C}=h;I.copy(_[w]),C.copy(_[(w+1)%3]),h.delta(o);const A=Kb(b.distanceToPoint(I));if(Kb(b.normal.dot(o))&&A){f.copy(h),y=2;break}const S=b.intersectLine(h,d);if(!S&&A&&d.copy(I),(S||A)&&!Kb(d.distanceTo(C))){if(y<=1)(y===1?f.start:f.end).copy(d),A&&(v=y);else if(y>=2){(v===1?f.start:f.end).copy(d),y=2;break}if(y++,y===2&&v===-1)break}}return y}return function(b,f=null,_=!1){this.needsUpdate&&this.update(),b.isExtendedTriangle?b.needsUpdate&&b.update():(n.copy(b),n.update(),b=n);const y=this.plane,v=b.plane;if(Math.abs(y.normal.dot(v.normal))>1-1e-10){const w=this.satBounds,I=this.satAxes;e[0]=b.a,e[1]=b.b,e[2]=b.c;for(let S=0;S<4;S++){const P=w[S],M=I[S];if(s.setFromPoints(M,e),P.isSeparated(s))return!1}const C=b.satBounds,A=b.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let S=0;S<4;S++){const P=C[S],M=A[S];if(s.setFromPoints(M,t),P.isSeparated(s))return!1}for(let S=0;S<4;S++){const P=I[S];for(let M=0;M<4;M++){const T=A[M];if(r.crossVectors(P,T),s.setFromPoints(r,t),i.setFromPoints(r,e),s.isSeparated(i))return!1}}return f&&(_||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),f.start.set(0,0,0),f.end.set(0,0,0)),!0}else{const w=g(this,v,u);if(w===1&&b.containsPoint(u.end))return f&&(f.start.copy(u.end),f.end.copy(u.end)),!0;if(w!==2)return!1;const I=g(b,y,p);if(I===1&&this.containsPoint(p.end))return f&&(f.start.copy(p.end),f.end.copy(p.end)),!0;if(I!==2)return!1;if(u.delta(a),p.delta(l),a.dot(l)<0){let L=p.start;p.start=p.end,p.end=L}const C=u.start.dot(a),A=u.end.dot(a),S=p.start.dot(a),P=p.end.dot(a),M=A<S,T=C<P;return C!==P&&S!==A&&M===T?!1:(f&&(c.subVectors(u.start,p.start),c.dot(a)>0?f.start.copy(u.start):f.start.copy(p.start),c.subVectors(u.end,p.end),c.dot(a)<0?f.end.copy(u.end):f.end.copy(p.end)),!0)}}})();Ln.prototype.distanceToPoint=(function(){const n=new F;return function(e){return this.closestPointToPoint(e,n),e.distanceTo(n)}})();Ln.prototype.distanceToTriangle=(function(){const n=new F,t=new F,e=["a","b","c"],s=new qt,i=new qt;return function(o,a=null,l=null){const c=a||l?s:null;if(this.intersectsTriangle(o,c))return(a||l)&&(a&&c.getCenter(a),l&&c.getCenter(l)),0;let h=1/0;for(let u=0;u<3;u++){let p;const d=e[u],g=o[d];this.closestPointToPoint(g,n),p=g.distanceToSquared(n),p<h&&(h=p,a&&a.copy(n),l&&l.copy(g));const m=this[d];o.closestPointToPoint(m,n),p=m.distanceToSquared(n),p<h&&(h=p,a&&a.copy(m),l&&l.copy(n))}for(let u=0;u<3;u++){const p=e[u],d=e[(u+1)%3];s.set(this[p],this[d]);for(let g=0;g<3;g++){const m=e[g],b=e[(g+1)%3];i.set(o[m],o[b]),uv(s,i,n,t);const f=n.distanceToSquared(t);f<h&&(h=f,a&&a.copy(n),l&&l.copy(t))}}return Math.sqrt(h)}})();class Gs{constructor(t,e,s){this.isOrientedBox=!0,this.min=new F,this.max=new F,this.matrix=new xt,this.invMatrix=new xt,this.points=new Array(8).fill().map(()=>new F),this.satAxes=new Array(3).fill().map(()=>new F),this.satBounds=new Array(3).fill().map(()=>new Vr),this.alignedSatBounds=new Array(3).fill().map(()=>new Vr),this.needsUpdate=!1,t&&this.min.copy(t),e&&this.max.copy(e),s&&this.matrix.copy(s)}set(t,e,s){this.min.copy(t),this.max.copy(e),this.matrix.copy(s),this.needsUpdate=!0}copy(t){this.min.copy(t.min),this.max.copy(t.max),this.matrix.copy(t.matrix),this.needsUpdate=!0}}Gs.prototype.update=(function(){return function(){const t=this.matrix,e=this.min,s=this.max,i=this.points;for(let c=0;c<=1;c++)for(let h=0;h<=1;h++)for(let u=0;u<=1;u++){const p=1*c|2*h|4*u,d=i[p];d.x=c?s.x:e.x,d.y=h?s.y:e.y,d.z=u?s.z:e.z,d.applyMatrix4(t)}const r=this.satBounds,o=this.satAxes,a=i[0];for(let c=0;c<3;c++){const h=o[c],u=r[c],p=1<<c,d=i[p];h.subVectors(a,d),u.setFromPoints(h,i)}const l=this.alignedSatBounds;l[0].setFromPointsField(i,"x"),l[1].setFromPointsField(i,"y"),l[2].setFromPointsField(i,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}})();Gs.prototype.intersectsBox=(function(){const n=new Vr;return function(e){this.needsUpdate&&this.update();const s=e.min,i=e.max,r=this.satBounds,o=this.satAxes,a=this.alignedSatBounds;if(n.min=s.x,n.max=i.x,a[0].isSeparated(n)||(n.min=s.y,n.max=i.y,a[1].isSeparated(n))||(n.min=s.z,n.max=i.z,a[2].isSeparated(n)))return!1;for(let l=0;l<3;l++){const c=o[l],h=r[l];if(n.setFromBox(c,e),h.isSeparated(n))return!1}return!0}})();Gs.prototype.intersectsTriangle=(function(){const n=new Ln,t=new Array(3),e=new Vr,s=new Vr,i=new F;return function(o){this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(n.copy(o),n.update(),o=n);const a=this.satBounds,l=this.satAxes;t[0]=o.a,t[1]=o.b,t[2]=o.c;for(let p=0;p<3;p++){const d=a[p],g=l[p];if(e.setFromPoints(g,t),d.isSeparated(e))return!1}const c=o.satBounds,h=o.satAxes,u=this.points;for(let p=0;p<3;p++){const d=c[p],g=h[p];if(e.setFromPoints(g,u),d.isSeparated(e))return!1}for(let p=0;p<3;p++){const d=l[p];for(let g=0;g<4;g++){const m=h[g];if(i.crossVectors(d,m),e.setFromPoints(i,t),s.setFromPoints(i,u),e.isSeparated(s))return!1}}return!0}})();Gs.prototype.closestPointToPoint=(function(){return function(t,e){return this.needsUpdate&&this.update(),e.copy(t).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e}})();Gs.prototype.distanceToPoint=(function(){const n=new F;return function(e){return this.closestPointToPoint(e,n),e.distanceTo(n)}})();Gs.prototype.distanceToBox=(function(){const n=["x","y","z"],t=new Array(12).fill().map(()=>new qt),e=new Array(12).fill().map(()=>new qt),s=new F,i=new F;return function(o,a=0,l=null,c=null){if(this.needsUpdate&&this.update(),this.intersectsBox(o))return(l||c)&&(o.getCenter(i),this.closestPointToPoint(i,s),o.closestPointToPoint(s,i),l&&l.copy(s),c&&c.copy(i)),0;const h=a*a,u=o.min,p=o.max,d=this.points;let g=1/0;for(let b=0;b<8;b++){const f=d[b];i.copy(f).clamp(u,p);const _=f.distanceToSquared(i);if(_<g&&(g=_,l&&l.copy(f),c&&c.copy(i),_<h))return Math.sqrt(_)}let m=0;for(let b=0;b<3;b++)for(let f=0;f<=1;f++)for(let _=0;_<=1;_++){const y=(b+1)%3,v=(b+2)%3,w=f<<y|_<<v,I=1<<b|f<<y|_<<v,C=d[w],A=d[I];t[m].set(C,A);const P=n[b],M=n[y],T=n[v],L=e[m],E=L.start,N=L.end;E[P]=u[P],E[M]=f?u[M]:p[M],E[T]=_?u[T]:p[M],N[P]=p[P],N[M]=f?u[M]:p[M],N[T]=_?u[T]:p[M],m++}for(let b=0;b<=1;b++)for(let f=0;f<=1;f++)for(let _=0;_<=1;_++){i.x=b?p.x:u.x,i.y=f?p.y:u.y,i.z=_?p.z:u.z,this.closestPointToPoint(i,s);const y=i.distanceToSquared(s);if(y<g&&(g=y,l&&l.copy(s),c&&c.copy(i),y<h))return Math.sqrt(y)}for(let b=0;b<12;b++){const f=t[b];for(let _=0;_<12;_++){const y=e[_];uv(f,y,s,i);const v=s.distanceToSquared(i);if(v<g&&(g=v,l&&l.copy(s),c&&c.copy(i),v<h))return Math.sqrt(v)}}return Math.sqrt(g)}})();class dv{constructor(t){this._getNewPrimitive=t,this._primitives=[]}getPrimitive(){const t=this._primitives;return t.length===0?this._getNewPrimitive():t.pop()}releasePrimitive(t){this._primitives.push(t)}}class CD extends dv{constructor(){super(()=>new Ln)}}const Qi=new CD;function bi(n,t){return t[n+15]===65535}function Ei(n,t){return t[n+6]}function Ki(n,t){return t[n+14]}function Ji(n){return n+8}function tn(n,t){return t[n+6]}function QT(n,t){return t[n+7]}class TD{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const t=[];let e=null;this.setBuffer=s=>{e&&t.push(e),e=s,this.float32Array=new Float32Array(s),this.uint16Array=new Uint16Array(s),this.uint32Array=new Uint32Array(s)},this.clearBuffer=()=>{e=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,t.length!==0&&this.setBuffer(t.pop())}}}const xe=new TD;let To,mc;const xl=[],Kp=new dv(()=>new Tt);function AD(n,t,e,s,i,r){To=Kp.getPrimitive(),mc=Kp.getPrimitive(),xl.push(To,mc),xe.setBuffer(n._roots[t]);const o=$0(0,n.geometry,e,s,i,r);xe.clearBuffer(),Kp.releasePrimitive(To),Kp.releasePrimitive(mc),xl.pop(),xl.pop();const a=xl.length;return a>0&&(mc=xl[a-1],To=xl[a-2]),o}function $0(n,t,e,s,i=null,r=0,o=0){const{float32Array:a,uint16Array:l,uint32Array:c}=xe;let h=n*2;if(bi(h,l)){const p=Ei(n,c),d=Ki(h,l);return De(n,a,To),s(p,d,!1,o,r+n,To)}else{let p=function(T){const{uint16Array:L,uint32Array:E}=xe;let N=T*2;for(;!bi(N,L);)T=Ji(T),N=T*2;return Ei(T,E)},d=function(T){const{uint16Array:L,uint32Array:E}=xe;let N=T*2;for(;!bi(N,L);)T=tn(T,E),N=T*2;return Ei(T,E)+Ki(N,L)};const g=Ji(n),m=tn(n,c);let b=g,f=m,_,y,v,w;if(i&&(v=To,w=mc,De(b,a,v),De(f,a,w),_=i(v),y=i(w),y<_)){b=m,f=g;const T=_;_=y,y=T,v=w}v||(v=To,De(b,a,v));const I=bi(b*2,l),C=e(v,I,_,o+1,r+b);let A;if(C===$1){const T=p(b),E=d(b)-T;A=s(T,E,!0,o+1,r+b,v)}else A=C&&$0(b,t,e,s,i,r,o+1);if(A)return!0;w=mc,De(f,a,w);const S=bi(f*2,l),P=e(w,S,y,o+1,r+f);let M;if(P===$1){const T=p(f),E=d(f)-T;M=s(T,E,!0,o+1,r+f,w)}else M=P&&$0(f,t,e,s,i,r,o+1);return!!M}}const Nh=new F,Jb=new F;function SD(n,t,e={},s=0,i=1/0){const r=s*s,o=i*i;let a=1/0,l=null;if(n.shapecast({boundsTraverseOrder:h=>(Nh.copy(t).clamp(h.min,h.max),Nh.distanceToSquared(t)),intersectsBounds:(h,u,p)=>p<a&&p<o,intersectsTriangle:(h,u)=>{h.closestPointToPoint(t,Nh);const p=t.distanceToSquared(Nh);return p<a&&(Jb.copy(Nh),a=p,l=u),p<r}}),a===1/0)return null;const c=Math.sqrt(a);return e.point?e.point.copy(Jb):e.point=Jb.clone(),e.distance=c,e.faceIndex=l,e}const Il=new F,Cl=new F,Tl=new F,Jp=new Ut,tf=new Ut,ef=new Ut,z1=new F,B1=new F,U1=new F,sf=new F;function OD(n,t,e,s,i,r){let o;return r===Yy?o=n.intersectTriangle(s,e,t,!0,i):o=n.intersectTriangle(t,e,s,r!==Pi,i),o===null?null:{distance:n.origin.distanceTo(i),point:i.clone()}}function PD(n,t,e,s,i,r,o,a,l){Il.fromBufferAttribute(t,r),Cl.fromBufferAttribute(t,o),Tl.fromBufferAttribute(t,a);const c=OD(n,Il,Cl,Tl,sf,l);if(c){s&&(Jp.fromBufferAttribute(s,r),tf.fromBufferAttribute(s,o),ef.fromBufferAttribute(s,a),c.uv=ns.getInterpolation(sf,Il,Cl,Tl,Jp,tf,ef,new Ut)),i&&(Jp.fromBufferAttribute(i,r),tf.fromBufferAttribute(i,o),ef.fromBufferAttribute(i,a),c.uv1=ns.getInterpolation(sf,Il,Cl,Tl,Jp,tf,ef,new Ut)),e&&(z1.fromBufferAttribute(e,r),B1.fromBufferAttribute(e,o),U1.fromBufferAttribute(e,a),c.normal=ns.getInterpolation(sf,Il,Cl,Tl,z1,B1,U1,new F),c.normal.dot(n.direction)>0&&c.normal.multiplyScalar(-1));const h={a:r,b:o,c:a,normal:new F,materialIndex:0};ns.getNormal(Il,Cl,Tl,h.normal),c.face=h,c.faceIndex=r}return c}function Tg(n,t,e,s,i){const r=s*3;let o=r+0,a=r+1,l=r+2;const c=n.index;n.index&&(o=c.getX(o),a=c.getX(a),l=c.getX(l));const{position:h,normal:u,uv:p,uv1:d}=n.attributes,g=PD(e,h,u,p,d,o,a,l,t);return g?(g.faceIndex=s,i&&i.push(g),g):null}function ts(n,t,e,s){const i=n.a,r=n.b,o=n.c;let a=t,l=t+1,c=t+2;e&&(a=e.getX(a),l=e.getX(l),c=e.getX(c)),i.x=s.getX(a),i.y=s.getY(a),i.z=s.getZ(a),r.x=s.getX(l),r.y=s.getY(l),r.z=s.getZ(l),o.x=s.getX(c),o.y=s.getY(c),o.z=s.getZ(c)}function RD(n,t,e,s,i,r){const{geometry:o,_indirectBuffer:a}=n;for(let l=s,c=s+i;l<c;l++)Tg(o,t,e,l,r)}function FD(n,t,e,s,i){const{geometry:r,_indirectBuffer:o}=n;let a=1/0,l=null;for(let c=s,h=s+i;c<h;c++){let u;u=Tg(r,t,e,c),u&&u.distance<a&&(l=u,a=u.distance)}return l}function LD(n,t,e,s,i,r,o){const{geometry:a}=e,{index:l}=a,c=a.attributes.position;for(let h=n,u=t+n;h<u;h++){let p;if(p=h,ts(o,p*3,l,c),o.needsUpdate=!0,s(o,p,i,r))return!0}return!1}function $D(n,t=null){t&&Array.isArray(t)&&(t=new Set(t));const e=n.geometry,s=e.index?e.index.array:null,i=e.attributes.position;let r,o,a,l,c=0;const h=n._roots;for(let p=0,d=h.length;p<d;p++)r=h[p],o=new Uint32Array(r),a=new Uint16Array(r),l=new Float32Array(r),u(0,c),c+=r.byteLength;function u(p,d,g=!1){const m=p*2;if(a[m+15]===Cg){const f=o[p+6],_=a[m+14];let y=1/0,v=1/0,w=1/0,I=-1/0,C=-1/0,A=-1/0;for(let S=3*f,P=3*(f+_);S<P;S++){let M=s[S];const T=i.getX(M),L=i.getY(M),E=i.getZ(M);T<y&&(y=T),T>I&&(I=T),L<v&&(v=L),L>C&&(C=L),E<w&&(w=E),E>A&&(A=E)}return l[p+0]!==y||l[p+1]!==v||l[p+2]!==w||l[p+3]!==I||l[p+4]!==C||l[p+5]!==A?(l[p+0]=y,l[p+1]=v,l[p+2]=w,l[p+3]=I,l[p+4]=C,l[p+5]=A,!0):!1}else{const f=p+8,_=o[p+6],y=f+d,v=_+d;let w=g,I=!1,C=!1;t?w||(I=t.has(y),C=t.has(v),w=!I&&!C):(I=!0,C=!0);const A=w||I,S=w||C;let P=!1;A&&(P=u(f,d,w));let M=!1;S&&(M=u(_,d,w));const T=P||M;if(T)for(let L=0;L<3;L++){const E=f+L,N=_+L,W=l[E],V=l[E+3],et=l[N],j=l[N+3];l[p+L]=W<et?W:et,l[p+L+3]=V>j?V:j}return T}}}const V1=new Tt;function Bo(n,t,e,s){return De(n,t,V1),e.intersectBox(V1,s)}function ND(n,t,e,s,i,r){const{geometry:o,_indirectBuffer:a}=n;for(let l=s,c=s+i;l<c;l++){let h=a?a[l]:l;Tg(o,t,e,h,r)}}function MD(n,t,e,s,i){const{geometry:r,_indirectBuffer:o}=n;let a=1/0,l=null;for(let c=s,h=s+i;c<h;c++){let u;u=Tg(r,t,e,o?o[c]:c),u&&u.distance<a&&(l=u,a=u.distance)}return l}function DD(n,t,e,s,i,r,o){const{geometry:a}=e,{index:l}=a,c=a.attributes.position;for(let h=n,u=t+n;h<u;h++){let p;if(p=e.resolveTriangleIndex(h),ts(o,p*3,l,c),o.needsUpdate=!0,s(o,p,i,r))return!0}return!1}const H1=new F;function kD(n,t,e,s,i){xe.setBuffer(n._roots[t]),N0(0,n,e,s,i),xe.clearBuffer()}function N0(n,t,e,s,i){const{float32Array:r,uint16Array:o,uint32Array:a}=xe,l=n*2;if(bi(l,o)){const h=Ei(n,a),u=Ki(l,o);RD(t,e,s,h,u,i)}else{const h=Ji(n);Bo(h,r,s,H1)&&N0(h,t,e,s,i);const u=tn(n,a);Bo(u,r,s,H1)&&N0(u,t,e,s,i)}}const j1=new F,zD=["x","y","z"];function BD(n,t,e,s){xe.setBuffer(n._roots[t]);const i=M0(0,n,e,s);return xe.clearBuffer(),i}function M0(n,t,e,s){const{float32Array:i,uint16Array:r,uint32Array:o}=xe;let a=n*2;if(bi(a,r)){const c=Ei(n,o),h=Ki(a,r);return FD(t,e,s,c,h)}else{const c=QT(n,o),h=zD[c],p=s.direction[h]>=0;let d,g;p?(d=Ji(n),g=tn(n,o)):(d=tn(n,o),g=Ji(n));const b=Bo(d,i,s,j1)?M0(d,t,e,s):null;if(b){const y=b.point[h];if(p?y<=i[g+c]:y>=i[g+c+3])return b}const _=Bo(g,i,s,j1)?M0(g,t,e,s):null;return b&&_?b.distance<=_.distance?b:_:b||_||null}}const nf=new Tt,Al=new Ln,Sl=new Ln,Mh=new xt,W1=new Gs,rf=new Gs;function UD(n,t,e,s){xe.setBuffer(n._roots[t]);const i=D0(0,n,e,s);return xe.clearBuffer(),i}function D0(n,t,e,s,i=null){const{float32Array:r,uint16Array:o,uint32Array:a}=xe;let l=n*2;if(i===null&&(e.boundingBox||e.computeBoundingBox(),W1.set(e.boundingBox.min,e.boundingBox.max,s),i=W1),bi(l,o)){const h=t.geometry,u=h.index,p=h.attributes.position,d=e.index,g=e.attributes.position,m=Ei(n,a),b=Ki(l,o);if(Mh.copy(s).invert(),e.boundsTree)return De(n,r,rf),rf.matrix.copy(Mh),rf.needsUpdate=!0,e.boundsTree.shapecast({intersectsBounds:_=>rf.intersectsBox(_),intersectsTriangle:_=>{_.a.applyMatrix4(s),_.b.applyMatrix4(s),_.c.applyMatrix4(s),_.needsUpdate=!0;for(let y=m*3,v=(b+m)*3;y<v;y+=3)if(ts(Sl,y,u,p),Sl.needsUpdate=!0,_.intersectsTriangle(Sl))return!0;return!1}});for(let f=m*3,_=(b+m)*3;f<_;f+=3){ts(Al,f,u,p),Al.a.applyMatrix4(Mh),Al.b.applyMatrix4(Mh),Al.c.applyMatrix4(Mh),Al.needsUpdate=!0;for(let y=0,v=d.count;y<v;y+=3)if(ts(Sl,y,d,g),Sl.needsUpdate=!0,Al.intersectsTriangle(Sl))return!0}}else{const h=n+8,u=a[n+6];return De(h,r,nf),!!(i.intersectsBox(nf)&&D0(h,t,e,s,i)||(De(u,r,nf),i.intersectsBox(nf)&&D0(u,t,e,s,i)))}}const of=new xt,t_=new Gs,Dh=new Gs,VD=new F,HD=new F,jD=new F,WD=new F;function YD(n,t,e,s={},i={},r=0,o=1/0){t.boundingBox||t.computeBoundingBox(),t_.set(t.boundingBox.min,t.boundingBox.max,e),t_.needsUpdate=!0;const a=n.geometry,l=a.attributes.position,c=a.index,h=t.attributes.position,u=t.index,p=Qi.getPrimitive(),d=Qi.getPrimitive();let g=VD,m=HD,b=null,f=null;i&&(b=jD,f=WD);let _=1/0,y=null,v=null;return of.copy(e).invert(),Dh.matrix.copy(of),n.shapecast({boundsTraverseOrder:w=>t_.distanceToBox(w),intersectsBounds:(w,I,C)=>C<_&&C<o?(I&&(Dh.min.copy(w.min),Dh.max.copy(w.max),Dh.needsUpdate=!0),!0):!1,intersectsRange:(w,I)=>{if(t.boundsTree)return t.boundsTree.shapecast({boundsTraverseOrder:A=>Dh.distanceToBox(A),intersectsBounds:(A,S,P)=>P<_&&P<o,intersectsRange:(A,S)=>{for(let P=A,M=A+S;P<M;P++){ts(d,3*P,u,h),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let T=w,L=w+I;T<L;T++){ts(p,3*T,c,l),p.needsUpdate=!0;const E=p.distanceToTriangle(d,g,b);if(E<_&&(m.copy(g),f&&f.copy(b),_=E,y=T,v=P),E<r)return!0}}}});{const C=Jc(t);for(let A=0,S=C;A<S;A++){ts(d,3*A,u,h),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let P=w,M=w+I;P<M;P++){ts(p,3*P,c,l),p.needsUpdate=!0;const T=p.distanceToTriangle(d,g,b);if(T<_&&(m.copy(g),f&&f.copy(b),_=T,y=P,v=A),T<r)return!0}}}}}),Qi.releasePrimitive(p),Qi.releasePrimitive(d),_===1/0?null:(s.point?s.point.copy(m):s.point=m.clone(),s.distance=_,s.faceIndex=y,i&&(i.point?i.point.copy(f):i.point=f.clone(),i.point.applyMatrix4(of),m.applyMatrix4(of),i.distance=m.sub(i.point).length(),i.faceIndex=v),s)}function GD(n,t=null){t&&Array.isArray(t)&&(t=new Set(t));const e=n.geometry,s=e.index?e.index.array:null,i=e.attributes.position;let r,o,a,l,c=0;const h=n._roots;for(let p=0,d=h.length;p<d;p++)r=h[p],o=new Uint32Array(r),a=new Uint16Array(r),l=new Float32Array(r),u(0,c),c+=r.byteLength;function u(p,d,g=!1){const m=p*2;if(a[m+15]===Cg){const f=o[p+6],_=a[m+14];let y=1/0,v=1/0,w=1/0,I=-1/0,C=-1/0,A=-1/0;for(let S=f,P=f+_;S<P;S++){const M=3*n.resolveTriangleIndex(S);for(let T=0;T<3;T++){let L=M+T;L=s?s[L]:L;const E=i.getX(L),N=i.getY(L),W=i.getZ(L);E<y&&(y=E),E>I&&(I=E),N<v&&(v=N),N>C&&(C=N),W<w&&(w=W),W>A&&(A=W)}}return l[p+0]!==y||l[p+1]!==v||l[p+2]!==w||l[p+3]!==I||l[p+4]!==C||l[p+5]!==A?(l[p+0]=y,l[p+1]=v,l[p+2]=w,l[p+3]=I,l[p+4]=C,l[p+5]=A,!0):!1}else{const f=p+8,_=o[p+6],y=f+d,v=_+d;let w=g,I=!1,C=!1;t?w||(I=t.has(y),C=t.has(v),w=!I&&!C):(I=!0,C=!0);const A=w||I,S=w||C;let P=!1;A&&(P=u(f,d,w));let M=!1;S&&(M=u(_,d,w));const T=P||M;if(T)for(let L=0;L<3;L++){const E=f+L,N=_+L,W=l[E],V=l[E+3],et=l[N],j=l[N+3];l[p+L]=W<et?W:et,l[p+L+3]=V>j?V:j}return T}}}const Y1=new F;function qD(n,t,e,s,i){xe.setBuffer(n._roots[t]),k0(0,n,e,s,i),xe.clearBuffer()}function k0(n,t,e,s,i){const{float32Array:r,uint16Array:o,uint32Array:a}=xe,l=n*2;if(bi(l,o)){const h=Ei(n,a),u=Ki(l,o);ND(t,e,s,h,u,i)}else{const h=Ji(n);Bo(h,r,s,Y1)&&k0(h,t,e,s,i);const u=tn(n,a);Bo(u,r,s,Y1)&&k0(u,t,e,s,i)}}const G1=new F,ZD=["x","y","z"];function XD(n,t,e,s){xe.setBuffer(n._roots[t]);const i=z0(0,n,e,s);return xe.clearBuffer(),i}function z0(n,t,e,s){const{float32Array:i,uint16Array:r,uint32Array:o}=xe;let a=n*2;if(bi(a,r)){const c=Ei(n,o),h=Ki(a,r);return MD(t,e,s,c,h)}else{const c=QT(n,o),h=ZD[c],p=s.direction[h]>=0;let d,g;p?(d=Ji(n),g=tn(n,o)):(d=tn(n,o),g=Ji(n));const b=Bo(d,i,s,G1)?z0(d,t,e,s):null;if(b){const y=b.point[h];if(p?y<=i[g+c]:y>=i[g+c+3])return b}const _=Bo(g,i,s,G1)?z0(g,t,e,s):null;return b&&_?b.distance<=_.distance?b:_:b||_||null}}const af=new Tt,Ol=new Ln,Pl=new Ln,kh=new xt,q1=new Gs,lf=new Gs;function QD(n,t,e,s){xe.setBuffer(n._roots[t]);const i=B0(0,n,e,s);return xe.clearBuffer(),i}function B0(n,t,e,s,i=null){const{float32Array:r,uint16Array:o,uint32Array:a}=xe;let l=n*2;if(i===null&&(e.boundingBox||e.computeBoundingBox(),q1.set(e.boundingBox.min,e.boundingBox.max,s),i=q1),bi(l,o)){const h=t.geometry,u=h.index,p=h.attributes.position,d=e.index,g=e.attributes.position,m=Ei(n,a),b=Ki(l,o);if(kh.copy(s).invert(),e.boundsTree)return De(n,r,lf),lf.matrix.copy(kh),lf.needsUpdate=!0,e.boundsTree.shapecast({intersectsBounds:_=>lf.intersectsBox(_),intersectsTriangle:_=>{_.a.applyMatrix4(s),_.b.applyMatrix4(s),_.c.applyMatrix4(s),_.needsUpdate=!0;for(let y=m,v=b+m;y<v;y++)if(ts(Pl,3*t.resolveTriangleIndex(y),u,p),Pl.needsUpdate=!0,_.intersectsTriangle(Pl))return!0;return!1}});for(let f=m,_=b+m;f<_;f++){const y=t.resolveTriangleIndex(f);ts(Ol,3*y,u,p),Ol.a.applyMatrix4(kh),Ol.b.applyMatrix4(kh),Ol.c.applyMatrix4(kh),Ol.needsUpdate=!0;for(let v=0,w=d.count;v<w;v+=3)if(ts(Pl,v,d,g),Pl.needsUpdate=!0,Ol.intersectsTriangle(Pl))return!0}}else{const h=n+8,u=a[n+6];return De(h,r,af),!!(i.intersectsBox(af)&&B0(h,t,e,s,i)||(De(u,r,af),i.intersectsBox(af)&&B0(u,t,e,s,i)))}}const cf=new xt,e_=new Gs,zh=new Gs,KD=new F,JD=new F,tk=new F,ek=new F;function sk(n,t,e,s={},i={},r=0,o=1/0){t.boundingBox||t.computeBoundingBox(),e_.set(t.boundingBox.min,t.boundingBox.max,e),e_.needsUpdate=!0;const a=n.geometry,l=a.attributes.position,c=a.index,h=t.attributes.position,u=t.index,p=Qi.getPrimitive(),d=Qi.getPrimitive();let g=KD,m=JD,b=null,f=null;i&&(b=tk,f=ek);let _=1/0,y=null,v=null;return cf.copy(e).invert(),zh.matrix.copy(cf),n.shapecast({boundsTraverseOrder:w=>e_.distanceToBox(w),intersectsBounds:(w,I,C)=>C<_&&C<o?(I&&(zh.min.copy(w.min),zh.max.copy(w.max),zh.needsUpdate=!0),!0):!1,intersectsRange:(w,I)=>{if(t.boundsTree){const C=t.boundsTree;return C.shapecast({boundsTraverseOrder:A=>zh.distanceToBox(A),intersectsBounds:(A,S,P)=>P<_&&P<o,intersectsRange:(A,S)=>{for(let P=A,M=A+S;P<M;P++){const T=C.resolveTriangleIndex(P);ts(d,3*T,u,h),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let L=w,E=w+I;L<E;L++){const N=n.resolveTriangleIndex(L);ts(p,3*N,c,l),p.needsUpdate=!0;const W=p.distanceToTriangle(d,g,b);if(W<_&&(m.copy(g),f&&f.copy(b),_=W,y=L,v=P),W<r)return!0}}}})}else{const C=Jc(t);for(let A=0,S=C;A<S;A++){ts(d,3*A,u,h),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let P=w,M=w+I;P<M;P++){const T=n.resolveTriangleIndex(P);ts(p,3*T,c,l),p.needsUpdate=!0;const L=p.distanceToTriangle(d,g,b);if(L<_&&(m.copy(g),f&&f.copy(b),_=L,y=P,v=A),L<r)return!0}}}}}),Qi.releasePrimitive(p),Qi.releasePrimitive(d),_===1/0?null:(s.point?s.point.copy(m):s.point=m.clone(),s.distance=_,s.faceIndex=y,i&&(i.point?i.point.copy(f):i.point=f.clone(),i.point.applyMatrix4(cf),m.applyMatrix4(cf),i.distance=m.sub(i.point).length(),i.faceIndex=v),s)}function ik(){return typeof SharedArrayBuffer<"u"}const Wu=new xe.constructor,Mm=new xe.constructor,mo=new dv(()=>new Tt),Rl=new Tt,Fl=new Tt,s_=new Tt,i_=new Tt;let n_=!1;function nk(n,t,e,s){if(n_)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");n_=!0;const i=n._roots,r=t._roots;let o,a=0,l=0;const c=new xt().copy(e).invert();for(let h=0,u=i.length;h<u;h++){Wu.setBuffer(i[h]),l=0;const p=mo.getPrimitive();De(0,Wu.float32Array,p),p.applyMatrix4(c);for(let d=0,g=r.length;d<g&&(Mm.setBuffer(r[h]),o=Tn(0,0,e,c,s,a,l,0,0,p),Mm.clearBuffer(),l+=r[d].length,!o);d++);if(mo.releasePrimitive(p),Wu.clearBuffer(),a+=i[h].length,o)break}return n_=!1,o}function Tn(n,t,e,s,i,r=0,o=0,a=0,l=0,c=null,h=!1){let u,p;h?(u=Mm,p=Wu):(u=Wu,p=Mm);const d=u.float32Array,g=u.uint32Array,m=u.uint16Array,b=p.float32Array,f=p.uint32Array,_=p.uint16Array,y=n*2,v=t*2,w=bi(y,m),I=bi(v,_);let C=!1;if(I&&w)h?C=i(Ei(t,f),Ki(t*2,_),Ei(n,g),Ki(n*2,m),l,o+t,a,r+n):C=i(Ei(n,g),Ki(n*2,m),Ei(t,f),Ki(t*2,_),a,r+n,l,o+t);else if(I){const A=mo.getPrimitive();De(t,b,A),A.applyMatrix4(e);const S=Ji(n),P=tn(n,g);De(S,d,Rl),De(P,d,Fl);const M=A.intersectsBox(Rl),T=A.intersectsBox(Fl);C=M&&Tn(t,S,s,e,i,o,r,l,a+1,A,!h)||T&&Tn(t,P,s,e,i,o,r,l,a+1,A,!h),mo.releasePrimitive(A)}else{const A=Ji(t),S=tn(t,f);De(A,b,s_),De(S,b,i_);const P=c.intersectsBox(s_),M=c.intersectsBox(i_);if(P&&M)C=Tn(n,A,e,s,i,r,o,a,l+1,c,h)||Tn(n,S,e,s,i,r,o,a,l+1,c,h);else if(P)if(w)C=Tn(n,A,e,s,i,r,o,a,l+1,c,h);else{const T=mo.getPrimitive();T.copy(s_).applyMatrix4(e);const L=Ji(n),E=tn(n,g);De(L,d,Rl),De(E,d,Fl);const N=T.intersectsBox(Rl),W=T.intersectsBox(Fl);C=N&&Tn(A,L,s,e,i,o,r,l,a+1,T,!h)||W&&Tn(A,E,s,e,i,o,r,l,a+1,T,!h),mo.releasePrimitive(T)}else if(M)if(w)C=Tn(n,S,e,s,i,r,o,a,l+1,c,h);else{const T=mo.getPrimitive();T.copy(i_).applyMatrix4(e);const L=Ji(n),E=tn(n,g);De(L,d,Rl),De(E,d,Fl);const N=T.intersectsBox(Rl),W=T.intersectsBox(Fl);C=N&&Tn(S,L,s,e,i,o,r,l,a+1,T,!h)||W&&Tn(S,E,s,e,i,o,r,l,a+1,T,!h),mo.releasePrimitive(T)}}return C}const hf=new Gs,Z1=new Tt;class pv{static serialize(t,e={}){e={cloneBuffers:!0,...e};const s=t.geometry,i=t._roots,r=t._indirectBuffer,o=s.getIndex();let a;return e.cloneBuffers?a={roots:i.map(l=>l.slice()),index:o.array.slice(),indirectBuffer:r?r.slice():null}:a={roots:i,index:o.array,indirectBuffer:r},a}static deserialize(t,e,s={}){s={setIndex:!0,indirect:!!t.indirectBuffer,...s};const{index:i,roots:r,indirectBuffer:o}=t,a=new pv(e,{...s,[Xb]:!0});if(a._roots=r,a._indirectBuffer=o||null,s.setIndex){const l=e.getIndex();if(l===null){const c=new ze(t.index,1,!1);e.setIndex(c)}else l.array!==i&&(l.array.set(i),l.needsUpdate=!0)}return a}get indirect(){return!!this._indirectBuffer}constructor(t,e={}){if(t.isBufferGeometry){if(t.index&&t.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e=Object.assign({strategy:qT,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,[Xb]:!1},e),e.useSharedArrayBuffer&&!ik())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=t,this._roots=null,this._indirectBuffer=null,e[Xb]||(wD(this,e),!t.boundingBox&&e.setBoundingBox&&(t.boundingBox=this.getBoundingBox(new Tt)));const{_indirectBuffer:s}=this;this.resolveTriangleIndex=e.indirect?i=>s[i]:i=>i}refit(t=null){return(this.indirect?GD:$D)(this,t)}traverse(t,e=0){const s=this._roots[e],i=new Uint32Array(s),r=new Uint16Array(s);o(0);function o(a,l=0){const c=a*2,h=r[c+15]===Cg;if(h){const u=i[a+6],p=r[c+14];t(l,h,new Float32Array(s,a*4,6),u,p)}else{const u=a+am/4,p=i[a+6],d=i[a+7];t(l,h,new Float32Array(s,a*4,6),d)||(o(u,l+1),o(p,l+1))}}}raycast(t,e=Ic){const s=this._roots,i=this.geometry,r=[],o=e.isMaterial,a=Array.isArray(e),l=i.groups,c=o?e.side:e,h=this.indirect?qD:kD;for(let u=0,p=s.length;u<p;u++){const d=a?e[l[u].materialIndex].side:c,g=r.length;if(h(this,u,d,t,r),a){const m=l[u].materialIndex;for(let b=g,f=r.length;b<f;b++)r[b].face.materialIndex=m}}return r}raycastFirst(t,e=Ic){const s=this._roots,i=this.geometry,r=e.isMaterial,o=Array.isArray(e);let a=null;const l=i.groups,c=r?e.side:e,h=this.indirect?XD:BD;for(let u=0,p=s.length;u<p;u++){const d=o?e[l[u].materialIndex].side:c,g=h(this,u,d,t);g!=null&&(a==null||g.distance<a.distance)&&(a=g,o&&(g.face.materialIndex=l[u].materialIndex))}return a}intersectsGeometry(t,e){let s=!1;const i=this._roots,r=this.indirect?QD:UD;for(let o=0,a=i.length;o<a&&(s=r(this,o,t,e),!s);o++);return s}shapecast(t){const e=Qi.getPrimitive(),s=this.indirect?DD:LD;let{boundsTraverseOrder:i,intersectsBounds:r,intersectsRange:o,intersectsTriangle:a}=t;if(o&&a){const u=o;o=(p,d,g,m,b)=>u(p,d,g,m,b)?!0:s(p,d,this,a,g,m,e)}else o||(a?o=(u,p,d,g)=>s(u,p,this,a,d,g,e):o=(u,p,d)=>d);let l=!1,c=0;const h=this._roots;for(let u=0,p=h.length;u<p;u++){const d=h[u];if(l=AD(this,u,r,o,i,c),l)break;c+=d.byteLength}return Qi.releasePrimitive(e),l}bvhcast(t,e,s){let{intersectsRanges:i,intersectsTriangles:r}=s;const o=Qi.getPrimitive(),a=this.geometry.index,l=this.geometry.attributes.position,c=this.indirect?g=>{const m=this.resolveTriangleIndex(g);ts(o,m*3,a,l)}:g=>{ts(o,g*3,a,l)},h=Qi.getPrimitive(),u=t.geometry.index,p=t.geometry.attributes.position,d=t.indirect?g=>{const m=t.resolveTriangleIndex(g);ts(h,m*3,u,p)}:g=>{ts(h,g*3,u,p)};if(r){const g=(m,b,f,_,y,v,w,I)=>{for(let C=f,A=f+_;C<A;C++){d(C),h.a.applyMatrix4(e),h.b.applyMatrix4(e),h.c.applyMatrix4(e),h.needsUpdate=!0;for(let S=m,P=m+b;S<P;S++)if(c(S),o.needsUpdate=!0,r(o,h,S,C,y,v,w,I))return!0}return!1};if(i){const m=i;i=function(b,f,_,y,v,w,I,C){return m(b,f,_,y,v,w,I,C)?!0:g(b,f,_,y,v,w,I,C)}}else i=g}return nk(this,t,e,i)}intersectsBox(t,e){return hf.set(t.min,t.max,e),hf.needsUpdate=!0,this.shapecast({intersectsBounds:s=>hf.intersectsBox(s),intersectsTriangle:s=>hf.intersectsTriangle(s)})}intersectsSphere(t){return this.shapecast({intersectsBounds:e=>t.intersectsBox(e),intersectsTriangle:e=>e.intersectsSphere(t)})}closestPointToGeometry(t,e,s={},i={},r=0,o=1/0){return(this.indirect?sk:YD)(this,t,e,s,i,r,o)}closestPointToPoint(t,e={},s=0,i=1/0){return SD(this,t,e,s,i)}getBoundingBox(t){return t.makeEmpty(),this._roots.forEach(s=>{De(0,new Float32Array(s),Z1),t.union(Z1)}),t}}function X1(n,t,e){return n===null||(n.point.applyMatrix4(t.matrixWorld),n.distance=n.point.distanceTo(e.ray.origin),n.object=t,n.distance<e.near||n.distance>e.far)?null:n}const r_=new $o,Q1=new xt,rk=ht.prototype.raycast;function ok(n,t){if(this.geometry.boundsTree){if(this.material===void 0)return;Q1.copy(this.matrixWorld).invert(),r_.copy(n.ray).applyMatrix4(Q1);const e=this.geometry.boundsTree;if(n.firstHitOnly===!0){const s=X1(e.raycastFirst(r_,this.material),this,n);s&&t.push(s)}else{const s=e.raycast(r_,this.material);for(let i=0,r=s.length;i<r;i++){const o=X1(s[i],this,n);o&&t.push(o)}}}else rk.call(this,n,t)}function ak(n){return this.boundsTree=new pv(this,n),this.boundsTree}function lk(){this.boundsTree=null}const KT=class JT{constructor(){k(this,"onDisposed",new It),k(this,"list",new Yt),k(this,"enabled",!1),k(this,"_clock"),k(this,"onInit",new It),k(this,"update",()=>{if(!this.enabled)return;const t=this._clock.getDelta();for(const[e,s]of this.list)s.enabled&&s.isUpdateable()&&s.update(t);requestAnimationFrame(this.update)}),this._clock=new lC,JT.setupBVH()}add(t,e){if(this.list.has(t))throw new Error("You're trying to add a component that already exists in the components instance. Use Components.get() instead.");wi.validate(t),this.list.set(t,e)}get(t){const e=t.uuid;if(!this.list.has(e)){const s=new t(this);return s.isDisposeable()&&s.onDisposed.add(()=>this.list.delete(e)),this.list.has(e)||this.add(e,s),s}return this.list.get(e)}init(){this.enabled=!0;for(const[t,e]of this.list.entries())e.enabled=!0;this._clock.start(),this.update(),this.onInit.trigger()}dispose(){this.enabled=!1;let t;for(const[e,s]of this.list){if(s.enabled=!1,e===Nt.uuid){t=s;continue}s.isDisposeable()&&s.dispose()}t?.dispose(),this._clock.stop(),this.onDisposed.trigger()}static setupBVH(){Ce.prototype.computeBoundsTree=ak,Ce.prototype.disposeBoundsTree=lk,ht.prototype.raycast=ok}};k(KT,"release","2.4.3");let tA=KT;class ck{constructor(t){k(this,"enabled",!1),k(this,"id","FirstPerson"),this.camera=t}set(t){if(this.enabled=t,t){if(this.camera.projection.current!=="Perspective"){this.camera.set("Orbit");return}this.setupFirstPersonCamera()}}setupFirstPersonCamera(){const t=this.camera.controls,e=new F;t.distance--,t.getPosition(e),t.minDistance=1,t.maxDistance=1,t.distance=1,t.moveTo(e.x,e.y,e.z),t.truckSpeed=50,t.mouseButtons.wheel=ks.ACTION.DOLLY,t.touches.two=ks.ACTION.TOUCH_ZOOM_TRUCK}}class hk{constructor(t){k(this,"enabled",!0),k(this,"id","Orbit"),this.camera=t,this.activateOrbitControls()}set(t){this.enabled=t,t&&this.activateOrbitControls()}activateOrbitControls(){const t=this.camera.controls;t.minDistance=1,t.maxDistance=300;const e=new F;t.getPosition(e);const s=e.length();t.distance=s,t.truckSpeed=2;const{rotation:i}=this.camera.three,r=new F(0,0,-1).applyEuler(i),o=e.addScaledVector(r,s);t.moveTo(o.x,o.y,o.z)}}class uk{constructor(t){k(this,"enabled",!1),k(this,"id","Plan"),k(this,"mouseAction1"),k(this,"mouseAction2"),k(this,"mouseInitialized",!1),k(this,"defaultAzimuthSpeed"),k(this,"defaultPolarSpeed"),this.camera=t,this.defaultAzimuthSpeed=t.controls.azimuthRotateSpeed,this.defaultPolarSpeed=t.controls.polarRotateSpeed}set(t){this.enabled=t;const e=this.camera.controls;e.azimuthRotateSpeed=t?0:this.defaultAzimuthSpeed,e.polarRotateSpeed=t?0:this.defaultPolarSpeed,this.mouseInitialized||(this.mouseAction1=e.touches.one,this.mouseAction2=e.touches.two,this.mouseInitialized=!0),t?(e.mouseButtons.left=ks.ACTION.TRUCK,e.touches.one=ks.ACTION.TOUCH_TRUCK,e.touches.two=ks.ACTION.TOUCH_ZOOM):(e.mouseButtons.left=ks.ACTION.ROTATE,e.touches.one=this.mouseAction1,e.touches.two=this.mouseAction2)}}class dk{constructor(t){k(this,"onChanged",new It),k(this,"current","Perspective"),k(this,"camera"),k(this,"matchOrthoDistanceEnabled",!1),k(this,"_component"),k(this,"_previousDistance",-1),this._component=t,this.camera=t.three}async set(t){this.current!==t&&(t==="Orthographic"?this.setOrthoCamera():await this.setPerspectiveCamera(),this.onChanged.trigger(this.camera))}async toggle(){const e=this.current==="Perspective"?"Orthographic":"Perspective";await this.set(e)}setOrthoCamera(){if(this._component.mode===null||this._component.mode.id==="FirstPerson")return;this._previousDistance=this._component.controls.distance,this._component.controls.distance=200;const t=this.getPerspectiveDims();if(!t)return;const{width:e,height:s}=t;this.setupOrthoCamera(s,e),this.camera=this._component.threeOrtho,this.current="Orthographic"}getPerspectiveDims(){const t=this._component.currentWorld;if(!t||!t.renderer)return null;const e=new F;this._component.threePersp.getWorldDirection(e);const s=new F;this._component.controls.getTarget(s);const r=s.clone().sub(this._component.threePersp.position).dot(e),o=t.renderer.getSize(),a=o.x/o.y,l=this._component.threePersp,c=r*2*Math.atan(l.fov*(Math.PI/180)/2);return{width:c*a,height:c}}setupOrthoCamera(t,e){this._component.controls.mouseButtons.wheel=ks.ACTION.ZOOM,this._component.controls.mouseButtons.middle=ks.ACTION.ZOOM;const s=this._component.threePersp,i=this._component.threeOrtho;i.zoom=1,i.left=e/-2,i.right=e/2,i.top=t/2,i.bottom=t/-2,i.updateProjectionMatrix(),i.position.copy(s.position),i.quaternion.copy(s.quaternion),this._component.controls.camera=i}getDistance(){const t=this._component.threePersp,e=this._component.threeOrtho;return(e.top-e.bottom)/e.zoom/(2*Math.atan(t.fov*(Math.PI/180)/2))}async setPerspectiveCamera(){this._component.controls.mouseButtons.wheel=ks.ACTION.DOLLY,this._component.controls.mouseButtons.middle=ks.ACTION.DOLLY;const t=this._component.threePersp,e=this._component.threeOrtho;t.position.copy(e.position),t.quaternion.copy(e.quaternion),this._component.controls.mouseButtons.wheel=ks.ACTION.DOLLY,this.matchOrthoDistanceEnabled?this._component.controls.distance=this.getDistance():this._component.controls.distance=this._previousDistance,await this._component.controls.zoomTo(1),t.updateProjectionMatrix(),this._component.controls.camera=t,this.camera=t,this.current="Perspective"}}class Ag extends md{constructor(t){super(t),k(this,"projection"),k(this,"threeOrtho"),k(this,"threePersp"),k(this,"_userInputButtons",{}),k(this,"_frustumSize",50),k(this,"_navigationModes",new Map),k(this,"_mode",null),k(this,"previousSize",null),this.threePersp=this.three,this.threeOrtho=this.newOrthoCamera(),this.projection=new dk(this),this.onAspectUpdated.add(()=>{this.setOrthoPerspCameraAspect()}),this.projection.onChanged.add(e=>{this.three=e,this.updateAspect()}),this.worlds.onItemSet.add(()=>{this._navigationModes.clear(),this._navigationModes.set("Orbit",new hk(this)),this._navigationModes.set("FirstPerson",new ck(this)),this._navigationModes.set("Plan",new uk(this)),this._mode=this._navigationModes.get("Orbit"),this.mode.set(!0,{preventTargetAdjustment:!0}),this.currentWorld&&this.currentWorld.renderer&&(this.previousSize=this.currentWorld.renderer.getSize().clone())}),this.worlds.onItemDeleted.add(()=>{this._navigationModes.clear()})}get mode(){if(!this._mode)throw new Error("Mode not found, camera not initialized");return this._mode}dispose(){super.dispose(),this.threeOrtho.removeFromParent()}set(t){if(this.mode!==null&&this.mode.id!==t){if(this.mode.set(!1),!this._navigationModes.has(t))throw new Error("The specified mode does not exist!");this._mode=this._navigationModes.get(t),this.mode.set(!0)}}async fit(t,e=1.5){if(!this.enabled)return;const s=Number.MAX_VALUE,i=Number.MIN_VALUE,r=new F(s,s,s),o=new F(i,i,i);for(const d of t){const g=new Tt().setFromObject(d);g.min.x<r.x&&(r.x=g.min.x),g.min.y<r.y&&(r.y=g.min.y),g.min.z<r.z&&(r.z=g.min.z),g.max.x>o.x&&(o.x=g.max.x),g.max.y>o.y&&(o.y=g.max.y),g.max.z>o.z&&(o.z=g.max.z)}const a=new Tt(r,o),l=this.components.get(Nt);if(l.initialized)for(const[,d]of l.list){const g=d.box;g.min.x<r.x&&(r.x=g.min.x),g.min.y<r.y&&(r.y=g.min.y),g.min.z<r.z&&(r.z=g.min.z),g.max.x>o.x&&(o.x=g.max.x),g.max.y>o.y&&(o.y=g.max.y),g.max.z>o.z&&(o.z=g.max.z)}const c=new F;a.getSize(c);const h=new F;a.getCenter(h);const u=Math.max(c.x,c.y,c.z)*e,p=new Us(h,u);await this.controls.fitToSphere(p,!0)}setUserInput(t){t?this.enableUserInput():this.disableUserInput()}disableUserInput(){this._userInputButtons.left=this.controls.mouseButtons.left,this._userInputButtons.right=this.controls.mouseButtons.right,this._userInputButtons.middle=this.controls.mouseButtons.middle,this._userInputButtons.wheel=this.controls.mouseButtons.wheel,this.controls.mouseButtons.left=0,this.controls.mouseButtons.right=0,this.controls.mouseButtons.middle=0,this.controls.mouseButtons.wheel=0}enableUserInput(){Object.keys(this._userInputButtons).length!==0&&(this.controls.mouseButtons.left=this._userInputButtons.left,this.controls.mouseButtons.right=this._userInputButtons.right,this.controls.mouseButtons.middle=this._userInputButtons.middle,this.controls.mouseButtons.wheel=this._userInputButtons.wheel)}newOrthoCamera(){const t=window.innerWidth/window.innerHeight;return new sl(this._frustumSize*t/-2,this._frustumSize*t/2,this._frustumSize/2,this._frustumSize/-2,.1,1e3)}setOrthoPerspCameraAspect(){if(!this.currentWorld||!this.currentWorld.renderer||!this.previousSize)return;const t=this.currentWorld.renderer.getSize(),e=this.threeOrtho.top,s=this.threeOrtho.right,i=t.y/this.previousSize.y,r=t.x/this.previousSize.x,o=e*i,a=s*r;this.threeOrtho.left=-a,this.threeOrtho.right=a,this.threeOrtho.top=o,this.threeOrtho.bottom=-o,this.threeOrtho.updateProjectionMatrix(),this.previousSize.copy(t)}}function uf(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var eA={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(n,t){(function(e){n.exports=e()})(function(){return(function e(s,i,r){function o(c,h){if(!i[c]){if(!s[c]){var u=typeof uf=="function"&&uf;if(!h&&u)return u(c,!0);if(a)return a(c,!0);var p=new Error("Cannot find module '"+c+"'");throw p.code="MODULE_NOT_FOUND",p}var d=i[c]={exports:{}};s[c][0].call(d.exports,function(g){var m=s[c][1][g];return o(m||g)},d,d.exports,e,s,i,r)}return i[c].exports}for(var a=typeof uf=="function"&&uf,l=0;l<r.length;l++)o(r[l]);return o})({1:[function(e,s,i){var r=e("./utils"),o=e("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(l){for(var c,h,u,p,d,g,m,b=[],f=0,_=l.length,y=_,v=r.getTypeOf(l)!=="string";f<l.length;)y=_-f,u=v?(c=l[f++],h=f<_?l[f++]:0,f<_?l[f++]:0):(c=l.charCodeAt(f++),h=f<_?l.charCodeAt(f++):0,f<_?l.charCodeAt(f++):0),p=c>>2,d=(3&c)<<4|h>>4,g=1<y?(15&h)<<2|u>>6:64,m=2<y?63&u:64,b.push(a.charAt(p)+a.charAt(d)+a.charAt(g)+a.charAt(m));return b.join("")},i.decode=function(l){var c,h,u,p,d,g,m=0,b=0,f="data:";if(l.substr(0,f.length)===f)throw new Error("Invalid base64 input, it looks like a data url.");var _,y=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===a.charAt(64)&&y--,l.charAt(l.length-2)===a.charAt(64)&&y--,y%1!=0)throw new Error("Invalid base64 input, bad content length.");for(_=o.uint8array?new Uint8Array(0|y):new Array(0|y);m<l.length;)c=a.indexOf(l.charAt(m++))<<2|(p=a.indexOf(l.charAt(m++)))>>4,h=(15&p)<<4|(d=a.indexOf(l.charAt(m++)))>>2,u=(3&d)<<6|(g=a.indexOf(l.charAt(m++))),_[b++]=c,d!==64&&(_[b++]=h),g!==64&&(_[b++]=u);return _}},{"./support":30,"./utils":32}],2:[function(e,s,i){var r=e("./external"),o=e("./stream/DataWorker"),a=e("./stream/Crc32Probe"),l=e("./stream/DataLengthProbe");function c(h,u,p,d,g){this.compressedSize=h,this.uncompressedSize=u,this.crc32=p,this.compression=d,this.compressedContent=g}c.prototype={getContentWorker:function(){var h=new o(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),u=this;return h.on("end",function(){if(this.streamInfo.data_length!==u.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),h},getCompressedWorker:function(){return new o(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(h,u,p){return h.pipe(new a).pipe(new l("uncompressedSize")).pipe(u.compressWorker(p)).pipe(new l("compressedSize")).withStreamInfo("compression",u)},s.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,s,i){var r=e("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},i.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,s,i){var r=e("./utils"),o=(function(){for(var a,l=[],c=0;c<256;c++){a=c;for(var h=0;h<8;h++)a=1&a?3988292384^a>>>1:a>>>1;l[c]=a}return l})();s.exports=function(a,l){return a!==void 0&&a.length?r.getTypeOf(a)!=="string"?(function(c,h,u,p){var d=o,g=p+u;c^=-1;for(var m=p;m<g;m++)c=c>>>8^d[255&(c^h[m])];return-1^c})(0|l,a,a.length,0):(function(c,h,u,p){var d=o,g=p+u;c^=-1;for(var m=p;m<g;m++)c=c>>>8^d[255&(c^h.charCodeAt(m))];return-1^c})(0|l,a,a.length,0):0}},{"./utils":32}],5:[function(e,s,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(e,s,i){var r=null;r=typeof Promise<"u"?Promise:e("lie"),s.exports={Promise:r}},{lie:37}],7:[function(e,s,i){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=e("pako"),a=e("./utils"),l=e("./stream/GenericWorker"),c=r?"uint8array":"array";function h(u,p){l.call(this,"FlateWorker/"+u),this._pako=null,this._pakoAction=u,this._pakoOptions=p,this.meta={}}i.magic="\b\0",a.inherits(h,l),h.prototype.processChunk=function(u){this.meta=u.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(c,u.data),!1)},h.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},h.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},h.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var u=this;this._pako.onData=function(p){u.push({data:p,meta:u.meta})}},i.compressWorker=function(u){return new h("Deflate",u)},i.uncompressWorker=function(){return new h("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,s,i){function r(d,g){var m,b="";for(m=0;m<g;m++)b+=String.fromCharCode(255&d),d>>>=8;return b}function o(d,g,m,b,f,_){var y,v,w=d.file,I=d.compression,C=_!==c.utf8encode,A=a.transformTo("string",_(w.name)),S=a.transformTo("string",c.utf8encode(w.name)),P=w.comment,M=a.transformTo("string",_(P)),T=a.transformTo("string",c.utf8encode(P)),L=S.length!==w.name.length,E=T.length!==P.length,N="",W="",V="",et=w.dir,j=w.date,nt={crc32:0,compressedSize:0,uncompressedSize:0};g&&!m||(nt.crc32=d.crc32,nt.compressedSize=d.compressedSize,nt.uncompressedSize=d.uncompressedSize);var H=0;g&&(H|=8),C||!L&&!E||(H|=2048);var B=0,rt=0;et&&(B|=16),f==="UNIX"?(rt=798,B|=(function(st,ct){var _t=st;return st||(_t=ct?16893:33204),(65535&_t)<<16})(w.unixPermissions,et)):(rt=20,B|=(function(st){return 63&(st||0)})(w.dosPermissions)),y=j.getUTCHours(),y<<=6,y|=j.getUTCMinutes(),y<<=5,y|=j.getUTCSeconds()/2,v=j.getUTCFullYear()-1980,v<<=4,v|=j.getUTCMonth()+1,v<<=5,v|=j.getUTCDate(),L&&(W=r(1,1)+r(h(A),4)+S,N+="up"+r(W.length,2)+W),E&&(V=r(1,1)+r(h(M),4)+T,N+="uc"+r(V.length,2)+V);var Q="";return Q+=`
\0`,Q+=r(H,2),Q+=I.magic,Q+=r(y,2),Q+=r(v,2),Q+=r(nt.crc32,4),Q+=r(nt.compressedSize,4),Q+=r(nt.uncompressedSize,4),Q+=r(A.length,2),Q+=r(N.length,2),{fileRecord:u.LOCAL_FILE_HEADER+Q+A+N,dirRecord:u.CENTRAL_FILE_HEADER+r(rt,2)+Q+r(M.length,2)+"\0\0\0\0"+r(B,4)+r(b,4)+A+N+M}}var a=e("../utils"),l=e("../stream/GenericWorker"),c=e("../utf8"),h=e("../crc32"),u=e("../signature");function p(d,g,m,b){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=g,this.zipPlatform=m,this.encodeFileName=b,this.streamFiles=d,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(p,l),p.prototype.push=function(d){var g=d.meta.percent||0,m=this.entriesCount,b=this._sources.length;this.accumulate?this.contentBuffer.push(d):(this.bytesWritten+=d.data.length,l.prototype.push.call(this,{data:d.data,meta:{currentFile:this.currentFile,percent:m?(g+100*(m-b-1))/m:100}}))},p.prototype.openedSource=function(d){this.currentSourceOffset=this.bytesWritten,this.currentFile=d.file.name;var g=this.streamFiles&&!d.file.dir;if(g){var m=o(d,g,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},p.prototype.closedSource=function(d){this.accumulate=!1;var g=this.streamFiles&&!d.file.dir,m=o(d,g,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),g)this.push({data:(function(b){return u.DATA_DESCRIPTOR+r(b.crc32,4)+r(b.compressedSize,4)+r(b.uncompressedSize,4)})(d),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},p.prototype.flush=function(){for(var d=this.bytesWritten,g=0;g<this.dirRecords.length;g++)this.push({data:this.dirRecords[g],meta:{percent:100}});var m=this.bytesWritten-d,b=(function(f,_,y,v,w){var I=a.transformTo("string",w(v));return u.CENTRAL_DIRECTORY_END+"\0\0\0\0"+r(f,2)+r(f,2)+r(_,4)+r(y,4)+r(I.length,2)+I})(this.dirRecords.length,m,d,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})},p.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},p.prototype.registerPrevious=function(d){this._sources.push(d);var g=this;return d.on("data",function(m){g.processChunk(m)}),d.on("end",function(){g.closedSource(g.previous.streamInfo),g._sources.length?g.prepareNextSource():g.end()}),d.on("error",function(m){g.error(m)}),this},p.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},p.prototype.error=function(d){var g=this._sources;if(!l.prototype.error.call(this,d))return!1;for(var m=0;m<g.length;m++)try{g[m].error(d)}catch{}return!0},p.prototype.lock=function(){l.prototype.lock.call(this);for(var d=this._sources,g=0;g<d.length;g++)d[g].lock()},s.exports=p},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,s,i){var r=e("../compressions"),o=e("./ZipFileWorker");i.generateWorker=function(a,l,c){var h=new o(l.streamFiles,c,l.platform,l.encodeFileName),u=0;try{a.forEach(function(p,d){u++;var g=(function(_,y){var v=_||y,w=r[v];if(!w)throw new Error(v+" is not a valid compression method !");return w})(d.options.compression,l.compression),m=d.options.compressionOptions||l.compressionOptions||{},b=d.dir,f=d.date;d._compressWorker(g,m).withStreamInfo("file",{name:p,dir:b,date:f,comment:d.comment||"",unixPermissions:d.unixPermissions,dosPermissions:d.dosPermissions}).pipe(h)}),h.entriesCount=u}catch(p){h.error(p)}return h}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,s,i){function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new r;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(r.prototype=e("./object")).loadAsync=e("./load"),r.support=e("./support"),r.defaults=e("./defaults"),r.version="3.10.1",r.loadAsync=function(o,a){return new r().loadAsync(o,a)},r.external=e("./external"),s.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,s,i){var r=e("./utils"),o=e("./external"),a=e("./utf8"),l=e("./zipEntries"),c=e("./stream/Crc32Probe"),h=e("./nodejsUtils");function u(p){return new o.Promise(function(d,g){var m=p.decompressed.getContentWorker().pipe(new c);m.on("error",function(b){g(b)}).on("end",function(){m.streamInfo.crc32!==p.decompressed.crc32?g(new Error("Corrupted zip : CRC32 mismatch")):d()}).resume()})}s.exports=function(p,d){var g=this;return d=r.extend(d||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),h.isNode&&h.isStream(p)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",p,!0,d.optimizedBinaryString,d.base64).then(function(m){var b=new l(d);return b.load(m),b}).then(function(m){var b=[o.Promise.resolve(m)],f=m.files;if(d.checkCRC32)for(var _=0;_<f.length;_++)b.push(u(f[_]));return o.Promise.all(b)}).then(function(m){for(var b=m.shift(),f=b.files,_=0;_<f.length;_++){var y=f[_],v=y.fileNameStr,w=r.resolve(y.fileNameStr);g.file(w,y.decompressed,{binary:!0,optimizedBinaryString:!0,date:y.date,dir:y.dir,comment:y.fileCommentStr.length?y.fileCommentStr:null,unixPermissions:y.unixPermissions,dosPermissions:y.dosPermissions,createFolders:d.createFolders}),y.dir||(g.file(w).unsafeOriginalName=v)}return b.zipComment.length&&(g.comment=b.zipComment),g})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,s,i){var r=e("../utils"),o=e("../stream/GenericWorker");function a(l,c){o.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(c)}r.inherits(a,o),a.prototype._bindStream=function(l){var c=this;(this._stream=l).pause(),l.on("data",function(h){c.push({data:h,meta:{percent:0}})}).on("error",function(h){c.isPaused?this.generatedError=h:c.error(h)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},s.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,s,i){var r=e("readable-stream").Readable;function o(a,l,c){r.call(this,l),this._helper=a;var h=this;a.on("data",function(u,p){h.push(u)||h._helper.pause(),c&&c(p)}).on("error",function(u){h.emit("error",u)}).on("end",function(){h.push(null)})}e("../utils").inherits(o,r),o.prototype._read=function(){this._helper.resume()},s.exports=o},{"../utils":32,"readable-stream":16}],14:[function(e,s,i){s.exports={isNode:typeof Buffer<"u",newBufferFrom:function(r,o){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(r,o);if(typeof r=="number")throw new Error('The "data" argument must not be a number');return new Buffer(r,o)},allocBuffer:function(r){if(Buffer.alloc)return Buffer.alloc(r);var o=new Buffer(r);return o.fill(0),o},isBuffer:function(r){return Buffer.isBuffer(r)},isStream:function(r){return r&&typeof r.on=="function"&&typeof r.pause=="function"&&typeof r.resume=="function"}}},{}],15:[function(e,s,i){function r(w,I,C){var A,S=a.getTypeOf(I),P=a.extend(C||{},h);P.date=P.date||new Date,P.compression!==null&&(P.compression=P.compression.toUpperCase()),typeof P.unixPermissions=="string"&&(P.unixPermissions=parseInt(P.unixPermissions,8)),P.unixPermissions&&16384&P.unixPermissions&&(P.dir=!0),P.dosPermissions&&16&P.dosPermissions&&(P.dir=!0),P.dir&&(w=f(w)),P.createFolders&&(A=b(w))&&_.call(this,A,!0);var M=S==="string"&&P.binary===!1&&P.base64===!1;C&&C.binary!==void 0||(P.binary=!M),(I instanceof u&&I.uncompressedSize===0||P.dir||!I||I.length===0)&&(P.base64=!1,P.binary=!0,I="",P.compression="STORE",S="string");var T=null;T=I instanceof u||I instanceof l?I:g.isNode&&g.isStream(I)?new m(w,I):a.prepareContent(w,I,P.binary,P.optimizedBinaryString,P.base64);var L=new p(w,T,P);this.files[w]=L}var o=e("./utf8"),a=e("./utils"),l=e("./stream/GenericWorker"),c=e("./stream/StreamHelper"),h=e("./defaults"),u=e("./compressedObject"),p=e("./zipObject"),d=e("./generate"),g=e("./nodejsUtils"),m=e("./nodejs/NodejsStreamInputAdapter"),b=function(w){w.slice(-1)==="/"&&(w=w.substring(0,w.length-1));var I=w.lastIndexOf("/");return 0<I?w.substring(0,I):""},f=function(w){return w.slice(-1)!=="/"&&(w+="/"),w},_=function(w,I){return I=I!==void 0?I:h.createFolders,w=f(w),this.files[w]||r.call(this,w,null,{dir:!0,createFolders:I}),this.files[w]};function y(w){return Object.prototype.toString.call(w)==="[object RegExp]"}var v={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(w){var I,C,A;for(I in this.files)A=this.files[I],(C=I.slice(this.root.length,I.length))&&I.slice(0,this.root.length)===this.root&&w(C,A)},filter:function(w){var I=[];return this.forEach(function(C,A){w(C,A)&&I.push(A)}),I},file:function(w,I,C){if(arguments.length!==1)return w=this.root+w,r.call(this,w,I,C),this;if(y(w)){var A=w;return this.filter(function(P,M){return!M.dir&&A.test(P)})}var S=this.files[this.root+w];return S&&!S.dir?S:null},folder:function(w){if(!w)return this;if(y(w))return this.filter(function(S,P){return P.dir&&w.test(S)});var I=this.root+w,C=_.call(this,I),A=this.clone();return A.root=C.name,A},remove:function(w){w=this.root+w;var I=this.files[w];if(I||(w.slice(-1)!=="/"&&(w+="/"),I=this.files[w]),I&&!I.dir)delete this.files[w];else for(var C=this.filter(function(S,P){return P.name.slice(0,w.length)===w}),A=0;A<C.length;A++)delete this.files[C[A].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(w){var I,C={};try{if((C=a.extend(w||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=C.type.toLowerCase(),C.compression=C.compression.toUpperCase(),C.type==="binarystring"&&(C.type="string"),!C.type)throw new Error("No output type specified.");a.checkSupport(C.type),C.platform!=="darwin"&&C.platform!=="freebsd"&&C.platform!=="linux"&&C.platform!=="sunos"||(C.platform="UNIX"),C.platform==="win32"&&(C.platform="DOS");var A=C.comment||this.comment||"";I=d.generateWorker(this,C,A)}catch(S){(I=new l("error")).error(S)}return new c(I,C.type||"string",C.mimeType)},generateAsync:function(w,I){return this.generateInternalStream(w).accumulate(I)},generateNodeStream:function(w,I){return(w=w||{}).type||(w.type="nodebuffer"),this.generateInternalStream(w).toNodejsStream(I)}};s.exports=v},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,s,i){s.exports=e("stream")},{stream:void 0}],17:[function(e,s,i){var r=e("./DataReader");function o(a){r.call(this,a);for(var l=0;l<this.data.length;l++)a[l]=255&a[l]}e("../utils").inherits(o,r),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var l=a.charCodeAt(0),c=a.charCodeAt(1),h=a.charCodeAt(2),u=a.charCodeAt(3),p=this.length-4;0<=p;--p)if(this.data[p]===l&&this.data[p+1]===c&&this.data[p+2]===h&&this.data[p+3]===u)return p-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var l=a.charCodeAt(0),c=a.charCodeAt(1),h=a.charCodeAt(2),u=a.charCodeAt(3),p=this.readData(4);return l===p[0]&&c===p[1]&&h===p[2]&&u===p[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},s.exports=o},{"../utils":32,"./DataReader":18}],18:[function(e,s,i){var r=e("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var l,c=0;for(this.checkOffset(a),l=this.index+a-1;l>=this.index;l--)c=(c<<8)+this.byteAt(l);return this.index+=a,c},readString:function(a){return r.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},s.exports=o},{"../utils":32}],19:[function(e,s,i){var r=e("./Uint8ArrayReader");function o(a){r.call(this,a)}e("../utils").inherits(o,r),o.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},s.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,s,i){var r=e("./DataReader");function o(a){r.call(this,a)}e("../utils").inherits(o,r),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},s.exports=o},{"../utils":32,"./DataReader":18}],21:[function(e,s,i){var r=e("./ArrayReader");function o(a){r.call(this,a)}e("../utils").inherits(o,r),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},s.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(e,s,i){var r=e("../utils"),o=e("../support"),a=e("./ArrayReader"),l=e("./StringReader"),c=e("./NodeBufferReader"),h=e("./Uint8ArrayReader");s.exports=function(u){var p=r.getTypeOf(u);return r.checkSupport(p),p!=="string"||o.uint8array?p==="nodebuffer"?new c(u):o.uint8array?new h(r.transformTo("uint8array",u)):new a(r.transformTo("array",u)):new l(u)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,s,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,s,i){var r=e("./GenericWorker"),o=e("../utils");function a(l){r.call(this,"ConvertWorker to "+l),this.destType=l}o.inherits(a,r),a.prototype.processChunk=function(l){this.push({data:o.transformTo(this.destType,l.data),meta:l.meta})},s.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(e,s,i){var r=e("./GenericWorker"),o=e("../crc32");function a(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(a,r),a.prototype.processChunk=function(l){this.streamInfo.crc32=o(l.data,this.streamInfo.crc32||0),this.push(l)},s.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,s,i){var r=e("../utils"),o=e("./GenericWorker");function a(l){o.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}r.inherits(a,o),a.prototype.processChunk=function(l){if(l){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+l.data.length}o.prototype.processChunk.call(this,l)},s.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(e,s,i){var r=e("../utils"),o=e("./GenericWorker");function a(l){o.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(h){c.dataIsReady=!0,c.data=h,c.max=h&&h.length||0,c.type=r.getTypeOf(h),c.isPaused||c._tickAndRepeat()},function(h){c.error(h)})}r.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,c);break;case"uint8array":l=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":l=this.data.slice(this.index,c)}return this.index=c,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},s.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(e,s,i){function r(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var l=0;l<this._listeners[o].length;l++)this._listeners[o][l].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(l){a.processChunk(l)}),o.on("end",function(){a.end()}),o.on("error",function(l){a.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},s.exports=r},{}],29:[function(e,s,i){var r=e("../utils"),o=e("./ConvertWorker"),a=e("./GenericWorker"),l=e("../base64"),c=e("../support"),h=e("../external"),u=null;if(c.nodestream)try{u=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function p(g,m){return new h.Promise(function(b,f){var _=[],y=g._internalType,v=g._outputType,w=g._mimeType;g.on("data",function(I,C){_.push(I),m&&m(C)}).on("error",function(I){_=[],f(I)}).on("end",function(){try{var I=(function(C,A,S){switch(C){case"blob":return r.newBlob(r.transformTo("arraybuffer",A),S);case"base64":return l.encode(A);default:return r.transformTo(C,A)}})(v,(function(C,A){var S,P=0,M=null,T=0;for(S=0;S<A.length;S++)T+=A[S].length;switch(C){case"string":return A.join("");case"array":return Array.prototype.concat.apply([],A);case"uint8array":for(M=new Uint8Array(T),S=0;S<A.length;S++)M.set(A[S],P),P+=A[S].length;return M;case"nodebuffer":return Buffer.concat(A);default:throw new Error("concat : unsupported type '"+C+"'")}})(y,_),w);b(I)}catch(C){f(C)}_=[]}).resume()})}function d(g,m,b){var f=m;switch(m){case"blob":case"arraybuffer":f="uint8array";break;case"base64":f="string"}try{this._internalType=f,this._outputType=m,this._mimeType=b,r.checkSupport(f),this._worker=g.pipe(new o(f)),g.lock()}catch(_){this._worker=new a("error"),this._worker.error(_)}}d.prototype={accumulate:function(g){return p(this,g)},on:function(g,m){var b=this;return g==="data"?this._worker.on(g,function(f){m.call(b,f.data,f.meta)}):this._worker.on(g,function(){r.delay(m,arguments,b)}),this},resume:function(){return r.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(g){if(r.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new u(this,{objectMode:this._outputType!=="nodebuffer"},g)}},s.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,s,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var r=new ArrayBuffer(0);try{i.blob=new Blob([r],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(r),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!e("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(e,s,i){for(var r=e("./utils"),o=e("./support"),a=e("./nodejsUtils"),l=e("./stream/GenericWorker"),c=new Array(256),h=0;h<256;h++)c[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;c[254]=c[254]=1;function u(){l.call(this,"utf-8 decode"),this.leftOver=null}function p(){l.call(this,"utf-8 encode")}i.utf8encode=function(d){return o.nodebuffer?a.newBufferFrom(d,"utf-8"):(function(g){var m,b,f,_,y,v=g.length,w=0;for(_=0;_<v;_++)(64512&(b=g.charCodeAt(_)))==55296&&_+1<v&&(64512&(f=g.charCodeAt(_+1)))==56320&&(b=65536+(b-55296<<10)+(f-56320),_++),w+=b<128?1:b<2048?2:b<65536?3:4;for(m=o.uint8array?new Uint8Array(w):new Array(w),_=y=0;y<w;_++)(64512&(b=g.charCodeAt(_)))==55296&&_+1<v&&(64512&(f=g.charCodeAt(_+1)))==56320&&(b=65536+(b-55296<<10)+(f-56320),_++),b<128?m[y++]=b:(b<2048?m[y++]=192|b>>>6:(b<65536?m[y++]=224|b>>>12:(m[y++]=240|b>>>18,m[y++]=128|b>>>12&63),m[y++]=128|b>>>6&63),m[y++]=128|63&b);return m})(d)},i.utf8decode=function(d){return o.nodebuffer?r.transformTo("nodebuffer",d).toString("utf-8"):(function(g){var m,b,f,_,y=g.length,v=new Array(2*y);for(m=b=0;m<y;)if((f=g[m++])<128)v[b++]=f;else if(4<(_=c[f]))v[b++]=65533,m+=_-1;else{for(f&=_===2?31:_===3?15:7;1<_&&m<y;)f=f<<6|63&g[m++],_--;1<_?v[b++]=65533:f<65536?v[b++]=f:(f-=65536,v[b++]=55296|f>>10&1023,v[b++]=56320|1023&f)}return v.length!==b&&(v.subarray?v=v.subarray(0,b):v.length=b),r.applyFromCharCode(v)})(d=r.transformTo(o.uint8array?"uint8array":"array",d))},r.inherits(u,l),u.prototype.processChunk=function(d){var g=r.transformTo(o.uint8array?"uint8array":"array",d.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=g;(g=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),g.set(m,this.leftOver.length)}else g=this.leftOver.concat(g);this.leftOver=null}var b=(function(_,y){var v;for((y=y||_.length)>_.length&&(y=_.length),v=y-1;0<=v&&(192&_[v])==128;)v--;return v<0||v===0?y:v+c[_[v]]>y?v:y})(g),f=g;b!==g.length&&(o.uint8array?(f=g.subarray(0,b),this.leftOver=g.subarray(b,g.length)):(f=g.slice(0,b),this.leftOver=g.slice(b,g.length))),this.push({data:i.utf8decode(f),meta:d.meta})},u.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=u,r.inherits(p,l),p.prototype.processChunk=function(d){this.push({data:i.utf8encode(d.data),meta:d.meta})},i.Utf8EncodeWorker=p},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,s,i){var r=e("./support"),o=e("./base64"),a=e("./nodejsUtils"),l=e("./external");function c(m){return m}function h(m,b){for(var f=0;f<m.length;++f)b[f]=255&m.charCodeAt(f);return b}e("setimmediate"),i.newBlob=function(m,b){i.checkSupport("blob");try{return new Blob([m],{type:b})}catch{try{var f=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return f.append(m),f.getBlob(b)}catch{throw new Error("Bug : can't construct the Blob.")}}};var u={stringifyByChunk:function(m,b,f){var _=[],y=0,v=m.length;if(v<=f)return String.fromCharCode.apply(null,m);for(;y<v;)b==="array"||b==="nodebuffer"?_.push(String.fromCharCode.apply(null,m.slice(y,Math.min(y+f,v)))):_.push(String.fromCharCode.apply(null,m.subarray(y,Math.min(y+f,v)))),y+=f;return _.join("")},stringifyByChar:function(m){for(var b="",f=0;f<m.length;f++)b+=String.fromCharCode(m[f]);return b},applyCanBeUsed:{uint8array:(function(){try{return r.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return r.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}})()}};function p(m){var b=65536,f=i.getTypeOf(m),_=!0;if(f==="uint8array"?_=u.applyCanBeUsed.uint8array:f==="nodebuffer"&&(_=u.applyCanBeUsed.nodebuffer),_)for(;1<b;)try{return u.stringifyByChunk(m,f,b)}catch{b=Math.floor(b/2)}return u.stringifyByChar(m)}function d(m,b){for(var f=0;f<m.length;f++)b[f]=m[f];return b}i.applyFromCharCode=p;var g={};g.string={string:c,array:function(m){return h(m,new Array(m.length))},arraybuffer:function(m){return g.string.uint8array(m).buffer},uint8array:function(m){return h(m,new Uint8Array(m.length))},nodebuffer:function(m){return h(m,a.allocBuffer(m.length))}},g.array={string:p,array:c,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},g.arraybuffer={string:function(m){return p(new Uint8Array(m))},array:function(m){return d(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:c,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},g.uint8array={string:p,array:function(m){return d(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:c,nodebuffer:function(m){return a.newBufferFrom(m)}},g.nodebuffer={string:p,array:function(m){return d(m,new Array(m.length))},arraybuffer:function(m){return g.nodebuffer.uint8array(m).buffer},uint8array:function(m){return d(m,new Uint8Array(m.length))},nodebuffer:c},i.transformTo=function(m,b){if(b=b||"",!m)return b;i.checkSupport(m);var f=i.getTypeOf(b);return g[f][m](b)},i.resolve=function(m){for(var b=m.split("/"),f=[],_=0;_<b.length;_++){var y=b[_];y==="."||y===""&&_!==0&&_!==b.length-1||(y===".."?f.pop():f.push(y))}return f.join("/")},i.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":r.nodebuffer&&a.isBuffer(m)?"nodebuffer":r.uint8array&&m instanceof Uint8Array?"uint8array":r.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(m){if(!r[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(m){var b,f,_="";for(f=0;f<(m||"").length;f++)_+="\\x"+((b=m.charCodeAt(f))<16?"0":"")+b.toString(16).toUpperCase();return _},i.delay=function(m,b,f){setImmediate(function(){m.apply(f||null,b||[])})},i.inherits=function(m,b){function f(){}f.prototype=b.prototype,m.prototype=new f},i.extend=function(){var m,b,f={};for(m=0;m<arguments.length;m++)for(b in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],b)&&f[b]===void 0&&(f[b]=arguments[m][b]);return f},i.prepareContent=function(m,b,f,_,y){return l.Promise.resolve(b).then(function(v){return r.blob&&(v instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(v))!==-1)&&typeof FileReader<"u"?new l.Promise(function(w,I){var C=new FileReader;C.onload=function(A){w(A.target.result)},C.onerror=function(A){I(A.target.error)},C.readAsArrayBuffer(v)}):v}).then(function(v){var w=i.getTypeOf(v);return w?(w==="arraybuffer"?v=i.transformTo("uint8array",v):w==="string"&&(y?v=o.decode(v):f&&_!==!0&&(v=(function(I){return h(I,r.uint8array?new Uint8Array(I.length):new Array(I.length))})(v))),v):l.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,s,i){var r=e("./reader/readerFor"),o=e("./utils"),a=e("./signature"),l=e("./zipEntry"),c=e("./support");function h(u){this.files=[],this.loadOptions=u}h.prototype={checkSignature:function(u){if(!this.reader.readAndCheckSignature(u)){this.reader.index-=4;var p=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(p)+", expected "+o.pretty(u)+")")}},isSignature:function(u,p){var d=this.reader.index;this.reader.setIndex(u);var g=this.reader.readString(4)===p;return this.reader.setIndex(d),g},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var u=this.reader.readData(this.zipCommentLength),p=c.uint8array?"uint8array":"array",d=o.transformTo(p,u);this.zipComment=this.loadOptions.decodeFileName(d)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var u,p,d,g=this.zip64EndOfCentralSize-44;0<g;)u=this.reader.readInt(2),p=this.reader.readInt(4),d=this.reader.readData(p),this.zip64ExtensibleData[u]={id:u,length:p,value:d}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var u,p;for(u=0;u<this.files.length;u++)p=this.files[u],this.reader.setIndex(p.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),p.readLocalPart(this.reader),p.handleUTF8(),p.processAttributes()},readCentralDir:function(){var u;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(u=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(u);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var u=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(u<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(u);var p=u;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(u=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(u),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var g=p-d;if(0<g)this.isSignature(p,a.CENTRAL_FILE_HEADER)||(this.reader.zero=g);else if(g<0)throw new Error("Corrupted zip: missing "+Math.abs(g)+" bytes.")},prepareReader:function(u){this.reader=r(u)},load:function(u){this.prepareReader(u),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},s.exports=h},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,s,i){var r=e("./reader/readerFor"),o=e("./utils"),a=e("./compressedObject"),l=e("./crc32"),c=e("./utf8"),h=e("./compressions"),u=e("./support");function p(d,g){this.options=d,this.loadOptions=g}p.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(d){var g,m;if(d.skip(22),this.fileNameLength=d.readInt(2),m=d.readInt(2),this.fileName=d.readData(this.fileNameLength),d.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((g=(function(b){for(var f in h)if(Object.prototype.hasOwnProperty.call(h,f)&&h[f].magic===b)return h[f];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,g,d.readData(this.compressedSize))},readCentralPart:function(d){this.versionMadeBy=d.readInt(2),d.skip(2),this.bitFlag=d.readInt(2),this.compressionMethod=d.readString(2),this.date=d.readDate(),this.crc32=d.readInt(4),this.compressedSize=d.readInt(4),this.uncompressedSize=d.readInt(4);var g=d.readInt(2);if(this.extraFieldsLength=d.readInt(2),this.fileCommentLength=d.readInt(2),this.diskNumberStart=d.readInt(2),this.internalFileAttributes=d.readInt(2),this.externalFileAttributes=d.readInt(4),this.localHeaderOffset=d.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");d.skip(g),this.readExtraFields(d),this.parseZIP64ExtraField(d),this.fileComment=d.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var d=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),d==0&&(this.dosPermissions=63&this.externalFileAttributes),d==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var d=r(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=d.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=d.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=d.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=d.readInt(4))}},readExtraFields:function(d){var g,m,b,f=d.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});d.index+4<f;)g=d.readInt(2),m=d.readInt(2),b=d.readData(m),this.extraFields[g]={id:g,length:m,value:b};d.setIndex(f)},handleUTF8:function(){var d=u.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var g=this.findExtraFieldUnicodePath();if(g!==null)this.fileNameStr=g;else{var m=o.transformTo(d,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var b=this.findExtraFieldUnicodeComment();if(b!==null)this.fileCommentStr=b;else{var f=o.transformTo(d,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(f)}}},findExtraFieldUnicodePath:function(){var d=this.extraFields[28789];if(d){var g=r(d.value);return g.readInt(1)!==1||l(this.fileName)!==g.readInt(4)?null:c.utf8decode(g.readData(d.length-5))}return null},findExtraFieldUnicodeComment:function(){var d=this.extraFields[25461];if(d){var g=r(d.value);return g.readInt(1)!==1||l(this.fileComment)!==g.readInt(4)?null:c.utf8decode(g.readData(d.length-5))}return null}},s.exports=p},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,s,i){function r(g,m,b){this.name=g,this.dir=b.dir,this.date=b.date,this.comment=b.comment,this.unixPermissions=b.unixPermissions,this.dosPermissions=b.dosPermissions,this._data=m,this._dataBinary=b.binary,this.options={compression:b.compression,compressionOptions:b.compressionOptions}}var o=e("./stream/StreamHelper"),a=e("./stream/DataWorker"),l=e("./utf8"),c=e("./compressedObject"),h=e("./stream/GenericWorker");r.prototype={internalStream:function(g){var m=null,b="string";try{if(!g)throw new Error("No output type specified.");var f=(b=g.toLowerCase())==="string"||b==="text";b!=="binarystring"&&b!=="text"||(b="string"),m=this._decompressWorker();var _=!this._dataBinary;_&&!f&&(m=m.pipe(new l.Utf8EncodeWorker)),!_&&f&&(m=m.pipe(new l.Utf8DecodeWorker))}catch(y){(m=new h("error")).error(y)}return new o(m,b,"")},async:function(g,m){return this.internalStream(g).accumulate(m)},nodeStream:function(g,m){return this.internalStream(g||"nodebuffer").toNodejsStream(m)},_compressWorker:function(g,m){if(this._data instanceof c&&this._data.compression.magic===g.magic)return this._data.getCompressedWorker();var b=this._decompressWorker();return this._dataBinary||(b=b.pipe(new l.Utf8EncodeWorker)),c.createWorkerFrom(b,g,m)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof h?this._data:new a(this._data)}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],p=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<u.length;d++)r.prototype[u[d]]=p;s.exports=r},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,s,i){(function(r){var o,a,l=r.MutationObserver||r.WebKitMutationObserver;if(l){var c=0,h=new l(g),u=r.document.createTextNode("");h.observe(u,{characterData:!0}),o=function(){u.data=c=++c%2}}else if(r.setImmediate||r.MessageChannel===void 0)o="document"in r&&"onreadystatechange"in r.document.createElement("script")?function(){var m=r.document.createElement("script");m.onreadystatechange=function(){g(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},r.document.documentElement.appendChild(m)}:function(){setTimeout(g,0)};else{var p=new r.MessageChannel;p.port1.onmessage=g,o=function(){p.port2.postMessage(0)}}var d=[];function g(){var m,b;a=!0;for(var f=d.length;f;){for(b=d,d=[],m=-1;++m<f;)b[m]();f=d.length}a=!1}s.exports=function(m){d.push(m)!==1||a||o()}}).call(this,typeof jp<"u"?jp:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,s,i){var r=e("immediate");function o(){}var a={},l=["REJECTED"],c=["FULFILLED"],h=["PENDING"];function u(f){if(typeof f!="function")throw new TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,f!==o&&m(this,f)}function p(f,_,y){this.promise=f,typeof _=="function"&&(this.onFulfilled=_,this.callFulfilled=this.otherCallFulfilled),typeof y=="function"&&(this.onRejected=y,this.callRejected=this.otherCallRejected)}function d(f,_,y){r(function(){var v;try{v=_(y)}catch(w){return a.reject(f,w)}v===f?a.reject(f,new TypeError("Cannot resolve promise with itself")):a.resolve(f,v)})}function g(f){var _=f&&f.then;if(f&&(typeof f=="object"||typeof f=="function")&&typeof _=="function")return function(){_.apply(f,arguments)}}function m(f,_){var y=!1;function v(C){y||(y=!0,a.reject(f,C))}function w(C){y||(y=!0,a.resolve(f,C))}var I=b(function(){_(w,v)});I.status==="error"&&v(I.value)}function b(f,_){var y={};try{y.value=f(_),y.status="success"}catch(v){y.status="error",y.value=v}return y}(s.exports=u).prototype.finally=function(f){if(typeof f!="function")return this;var _=this.constructor;return this.then(function(y){return _.resolve(f()).then(function(){return y})},function(y){return _.resolve(f()).then(function(){throw y})})},u.prototype.catch=function(f){return this.then(null,f)},u.prototype.then=function(f,_){if(typeof f!="function"&&this.state===c||typeof _!="function"&&this.state===l)return this;var y=new this.constructor(o);return this.state!==h?d(y,this.state===c?f:_,this.outcome):this.queue.push(new p(y,f,_)),y},p.prototype.callFulfilled=function(f){a.resolve(this.promise,f)},p.prototype.otherCallFulfilled=function(f){d(this.promise,this.onFulfilled,f)},p.prototype.callRejected=function(f){a.reject(this.promise,f)},p.prototype.otherCallRejected=function(f){d(this.promise,this.onRejected,f)},a.resolve=function(f,_){var y=b(g,_);if(y.status==="error")return a.reject(f,y.value);var v=y.value;if(v)m(f,v);else{f.state=c,f.outcome=_;for(var w=-1,I=f.queue.length;++w<I;)f.queue[w].callFulfilled(_)}return f},a.reject=function(f,_){f.state=l,f.outcome=_;for(var y=-1,v=f.queue.length;++y<v;)f.queue[y].callRejected(_);return f},u.resolve=function(f){return f instanceof this?f:a.resolve(new this(o),f)},u.reject=function(f){var _=new this(o);return a.reject(_,f)},u.all=function(f){var _=this;if(Object.prototype.toString.call(f)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=f.length,v=!1;if(!y)return this.resolve([]);for(var w=new Array(y),I=0,C=-1,A=new this(o);++C<y;)S(f[C],C);return A;function S(P,M){_.resolve(P).then(function(T){w[M]=T,++I!==y||v||(v=!0,a.resolve(A,w))},function(T){v||(v=!0,a.reject(A,T))})}},u.race=function(f){var _=this;if(Object.prototype.toString.call(f)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=f.length,v=!1;if(!y)return this.resolve([]);for(var w=-1,I=new this(o);++w<y;)C=f[w],_.resolve(C).then(function(A){v||(v=!0,a.resolve(I,A))},function(A){v||(v=!0,a.reject(I,A))});var C;return I}},{immediate:36}],38:[function(e,s,i){var r={};(0,e("./lib/utils/common").assign)(r,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),s.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,s,i){var r=e("./zlib/deflate"),o=e("./utils/common"),a=e("./utils/strings"),l=e("./zlib/messages"),c=e("./zlib/zstream"),h=Object.prototype.toString,u=0,p=-1,d=0,g=8;function m(f){if(!(this instanceof m))return new m(f);this.options=o.assign({level:p,method:g,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},f||{});var _=this.options;_.raw&&0<_.windowBits?_.windowBits=-_.windowBits:_.gzip&&0<_.windowBits&&_.windowBits<16&&(_.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var y=r.deflateInit2(this.strm,_.level,_.method,_.windowBits,_.memLevel,_.strategy);if(y!==u)throw new Error(l[y]);if(_.header&&r.deflateSetHeader(this.strm,_.header),_.dictionary){var v;if(v=typeof _.dictionary=="string"?a.string2buf(_.dictionary):h.call(_.dictionary)==="[object ArrayBuffer]"?new Uint8Array(_.dictionary):_.dictionary,(y=r.deflateSetDictionary(this.strm,v))!==u)throw new Error(l[y]);this._dict_set=!0}}function b(f,_){var y=new m(_);if(y.push(f,!0),y.err)throw y.msg||l[y.err];return y.result}m.prototype.push=function(f,_){var y,v,w=this.strm,I=this.options.chunkSize;if(this.ended)return!1;v=_===~~_?_:_===!0?4:0,typeof f=="string"?w.input=a.string2buf(f):h.call(f)==="[object ArrayBuffer]"?w.input=new Uint8Array(f):w.input=f,w.next_in=0,w.avail_in=w.input.length;do{if(w.avail_out===0&&(w.output=new o.Buf8(I),w.next_out=0,w.avail_out=I),(y=r.deflate(w,v))!==1&&y!==u)return this.onEnd(y),!(this.ended=!0);w.avail_out!==0&&(w.avail_in!==0||v!==4&&v!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(w.output,w.next_out))):this.onData(o.shrinkBuf(w.output,w.next_out)))}while((0<w.avail_in||w.avail_out===0)&&y!==1);return v===4?(y=r.deflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===u):v!==2||(this.onEnd(u),!(w.avail_out=0))},m.prototype.onData=function(f){this.chunks.push(f)},m.prototype.onEnd=function(f){f===u&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=f,this.msg=this.strm.msg},i.Deflate=m,i.deflate=b,i.deflateRaw=function(f,_){return(_=_||{}).raw=!0,b(f,_)},i.gzip=function(f,_){return(_=_||{}).gzip=!0,b(f,_)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,s,i){var r=e("./zlib/inflate"),o=e("./utils/common"),a=e("./utils/strings"),l=e("./zlib/constants"),c=e("./zlib/messages"),h=e("./zlib/zstream"),u=e("./zlib/gzheader"),p=Object.prototype.toString;function d(m){if(!(this instanceof d))return new d(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var b=this.options;b.raw&&0<=b.windowBits&&b.windowBits<16&&(b.windowBits=-b.windowBits,b.windowBits===0&&(b.windowBits=-15)),!(0<=b.windowBits&&b.windowBits<16)||m&&m.windowBits||(b.windowBits+=32),15<b.windowBits&&b.windowBits<48&&(15&b.windowBits)==0&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var f=r.inflateInit2(this.strm,b.windowBits);if(f!==l.Z_OK)throw new Error(c[f]);this.header=new u,r.inflateGetHeader(this.strm,this.header)}function g(m,b){var f=new d(b);if(f.push(m,!0),f.err)throw f.msg||c[f.err];return f.result}d.prototype.push=function(m,b){var f,_,y,v,w,I,C=this.strm,A=this.options.chunkSize,S=this.options.dictionary,P=!1;if(this.ended)return!1;_=b===~~b?b:b===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof m=="string"?C.input=a.binstring2buf(m):p.call(m)==="[object ArrayBuffer]"?C.input=new Uint8Array(m):C.input=m,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new o.Buf8(A),C.next_out=0,C.avail_out=A),(f=r.inflate(C,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&S&&(I=typeof S=="string"?a.string2buf(S):p.call(S)==="[object ArrayBuffer]"?new Uint8Array(S):S,f=r.inflateSetDictionary(this.strm,I)),f===l.Z_BUF_ERROR&&P===!0&&(f=l.Z_OK,P=!1),f!==l.Z_STREAM_END&&f!==l.Z_OK)return this.onEnd(f),!(this.ended=!0);C.next_out&&(C.avail_out!==0&&f!==l.Z_STREAM_END&&(C.avail_in!==0||_!==l.Z_FINISH&&_!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(y=a.utf8border(C.output,C.next_out),v=C.next_out-y,w=a.buf2string(C.output,y),C.next_out=v,C.avail_out=A-v,v&&o.arraySet(C.output,C.output,y,v,0),this.onData(w)):this.onData(o.shrinkBuf(C.output,C.next_out)))),C.avail_in===0&&C.avail_out===0&&(P=!0)}while((0<C.avail_in||C.avail_out===0)&&f!==l.Z_STREAM_END);return f===l.Z_STREAM_END&&(_=l.Z_FINISH),_===l.Z_FINISH?(f=r.inflateEnd(this.strm),this.onEnd(f),this.ended=!0,f===l.Z_OK):_!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(C.avail_out=0))},d.prototype.onData=function(m){this.chunks.push(m)},d.prototype.onEnd=function(m){m===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},i.Inflate=d,i.inflate=g,i.inflateRaw=function(m,b){return(b=b||{}).raw=!0,g(m,b)},i.ungzip=g},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,s,i){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(l){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var h=c.shift();if(h){if(typeof h!="object")throw new TypeError(h+"must be non-object");for(var u in h)h.hasOwnProperty(u)&&(l[u]=h[u])}}return l},i.shrinkBuf=function(l,c){return l.length===c?l:l.subarray?l.subarray(0,c):(l.length=c,l)};var o={arraySet:function(l,c,h,u,p){if(c.subarray&&l.subarray)l.set(c.subarray(h,h+u),p);else for(var d=0;d<u;d++)l[p+d]=c[h+d]},flattenChunks:function(l){var c,h,u,p,d,g;for(c=u=0,h=l.length;c<h;c++)u+=l[c].length;for(g=new Uint8Array(u),c=p=0,h=l.length;c<h;c++)d=l[c],g.set(d,p),p+=d.length;return g}},a={arraySet:function(l,c,h,u,p){for(var d=0;d<u;d++)l[p+d]=c[h+d]},flattenChunks:function(l){return[].concat.apply([],l)}};i.setTyped=function(l){l?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(r)},{}],42:[function(e,s,i){var r=e("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var l=new r.Buf8(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function h(u,p){if(p<65537&&(u.subarray&&a||!u.subarray&&o))return String.fromCharCode.apply(null,r.shrinkBuf(u,p));for(var d="",g=0;g<p;g++)d+=String.fromCharCode(u[g]);return d}l[254]=l[254]=1,i.string2buf=function(u){var p,d,g,m,b,f=u.length,_=0;for(m=0;m<f;m++)(64512&(d=u.charCodeAt(m)))==55296&&m+1<f&&(64512&(g=u.charCodeAt(m+1)))==56320&&(d=65536+(d-55296<<10)+(g-56320),m++),_+=d<128?1:d<2048?2:d<65536?3:4;for(p=new r.Buf8(_),m=b=0;b<_;m++)(64512&(d=u.charCodeAt(m)))==55296&&m+1<f&&(64512&(g=u.charCodeAt(m+1)))==56320&&(d=65536+(d-55296<<10)+(g-56320),m++),d<128?p[b++]=d:(d<2048?p[b++]=192|d>>>6:(d<65536?p[b++]=224|d>>>12:(p[b++]=240|d>>>18,p[b++]=128|d>>>12&63),p[b++]=128|d>>>6&63),p[b++]=128|63&d);return p},i.buf2binstring=function(u){return h(u,u.length)},i.binstring2buf=function(u){for(var p=new r.Buf8(u.length),d=0,g=p.length;d<g;d++)p[d]=u.charCodeAt(d);return p},i.buf2string=function(u,p){var d,g,m,b,f=p||u.length,_=new Array(2*f);for(d=g=0;d<f;)if((m=u[d++])<128)_[g++]=m;else if(4<(b=l[m]))_[g++]=65533,d+=b-1;else{for(m&=b===2?31:b===3?15:7;1<b&&d<f;)m=m<<6|63&u[d++],b--;1<b?_[g++]=65533:m<65536?_[g++]=m:(m-=65536,_[g++]=55296|m>>10&1023,_[g++]=56320|1023&m)}return h(_,g)},i.utf8border=function(u,p){var d;for((p=p||u.length)>u.length&&(p=u.length),d=p-1;0<=d&&(192&u[d])==128;)d--;return d<0||d===0?p:d+l[u[d]]>p?d:p}},{"./common":41}],43:[function(e,s,i){s.exports=function(r,o,a,l){for(var c=65535&r|0,h=r>>>16&65535|0,u=0;a!==0;){for(a-=u=2e3<a?2e3:a;h=h+(c=c+o[l++]|0)|0,--u;);c%=65521,h%=65521}return c|h<<16|0}},{}],44:[function(e,s,i){s.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,s,i){var r=(function(){for(var o,a=[],l=0;l<256;l++){o=l;for(var c=0;c<8;c++)o=1&o?3988292384^o>>>1:o>>>1;a[l]=o}return a})();s.exports=function(o,a,l,c){var h=r,u=c+l;o^=-1;for(var p=c;p<u;p++)o=o>>>8^h[255&(o^a[p])];return-1^o}},{}],46:[function(e,s,i){var r,o=e("../utils/common"),a=e("./trees"),l=e("./adler32"),c=e("./crc32"),h=e("./messages"),u=0,p=4,d=0,g=-2,m=-1,b=4,f=2,_=8,y=9,v=286,w=30,I=19,C=2*v+1,A=15,S=3,P=258,M=P+S+1,T=42,L=113,E=1,N=2,W=3,V=4;function et(x,Z){return x.msg=h[Z],Z}function j(x){return(x<<1)-(4<x?9:0)}function nt(x){for(var Z=x.length;0<=--Z;)x[Z]=0}function H(x){var Z=x.state,Y=Z.pending;Y>x.avail_out&&(Y=x.avail_out),Y!==0&&(o.arraySet(x.output,Z.pending_buf,Z.pending_out,Y,x.next_out),x.next_out+=Y,Z.pending_out+=Y,x.total_out+=Y,x.avail_out-=Y,Z.pending-=Y,Z.pending===0&&(Z.pending_out=0))}function B(x,Z){a._tr_flush_block(x,0<=x.block_start?x.block_start:-1,x.strstart-x.block_start,Z),x.block_start=x.strstart,H(x.strm)}function rt(x,Z){x.pending_buf[x.pending++]=Z}function Q(x,Z){x.pending_buf[x.pending++]=Z>>>8&255,x.pending_buf[x.pending++]=255&Z}function st(x,Z){var Y,$,R=x.max_chain_length,U=x.strstart,tt=x.prev_length,K=x.nice_match,D=x.strstart>x.w_size-M?x.strstart-(x.w_size-M):0,J=x.window,it=x.w_mask,X=x.prev,lt=x.strstart+P,vt=J[U+tt-1],gt=J[U+tt];x.prev_length>=x.good_match&&(R>>=2),K>x.lookahead&&(K=x.lookahead);do if(J[(Y=Z)+tt]===gt&&J[Y+tt-1]===vt&&J[Y]===J[U]&&J[++Y]===J[U+1]){U+=2,Y++;do;while(J[++U]===J[++Y]&&J[++U]===J[++Y]&&J[++U]===J[++Y]&&J[++U]===J[++Y]&&J[++U]===J[++Y]&&J[++U]===J[++Y]&&J[++U]===J[++Y]&&J[++U]===J[++Y]&&U<lt);if($=P-(lt-U),U=lt-P,tt<$){if(x.match_start=Z,K<=(tt=$))break;vt=J[U+tt-1],gt=J[U+tt]}}while((Z=X[Z&it])>D&&--R!=0);return tt<=x.lookahead?tt:x.lookahead}function ct(x){var Z,Y,$,R,U,tt,K,D,J,it,X=x.w_size;do{if(R=x.window_size-x.lookahead-x.strstart,x.strstart>=X+(X-M)){for(o.arraySet(x.window,x.window,X,X,0),x.match_start-=X,x.strstart-=X,x.block_start-=X,Z=Y=x.hash_size;$=x.head[--Z],x.head[Z]=X<=$?$-X:0,--Y;);for(Z=Y=X;$=x.prev[--Z],x.prev[Z]=X<=$?$-X:0,--Y;);R+=X}if(x.strm.avail_in===0)break;if(tt=x.strm,K=x.window,D=x.strstart+x.lookahead,J=R,it=void 0,it=tt.avail_in,J<it&&(it=J),Y=it===0?0:(tt.avail_in-=it,o.arraySet(K,tt.input,tt.next_in,it,D),tt.state.wrap===1?tt.adler=l(tt.adler,K,it,D):tt.state.wrap===2&&(tt.adler=c(tt.adler,K,it,D)),tt.next_in+=it,tt.total_in+=it,it),x.lookahead+=Y,x.lookahead+x.insert>=S)for(U=x.strstart-x.insert,x.ins_h=x.window[U],x.ins_h=(x.ins_h<<x.hash_shift^x.window[U+1])&x.hash_mask;x.insert&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[U+S-1])&x.hash_mask,x.prev[U&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=U,U++,x.insert--,!(x.lookahead+x.insert<S)););}while(x.lookahead<M&&x.strm.avail_in!==0)}function _t(x,Z){for(var Y,$;;){if(x.lookahead<M){if(ct(x),x.lookahead<M&&Z===u)return E;if(x.lookahead===0)break}if(Y=0,x.lookahead>=S&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+S-1])&x.hash_mask,Y=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),Y!==0&&x.strstart-Y<=x.w_size-M&&(x.match_length=st(x,Y)),x.match_length>=S)if($=a._tr_tally(x,x.strstart-x.match_start,x.match_length-S),x.lookahead-=x.match_length,x.match_length<=x.max_lazy_match&&x.lookahead>=S){for(x.match_length--;x.strstart++,x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+S-1])&x.hash_mask,Y=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart,--x.match_length!=0;);x.strstart++}else x.strstart+=x.match_length,x.match_length=0,x.ins_h=x.window[x.strstart],x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+1])&x.hash_mask;else $=a._tr_tally(x,0,x.window[x.strstart]),x.lookahead--,x.strstart++;if($&&(B(x,!1),x.strm.avail_out===0))return E}return x.insert=x.strstart<S-1?x.strstart:S-1,Z===p?(B(x,!0),x.strm.avail_out===0?W:V):x.last_lit&&(B(x,!1),x.strm.avail_out===0)?E:N}function ut(x,Z){for(var Y,$,R;;){if(x.lookahead<M){if(ct(x),x.lookahead<M&&Z===u)return E;if(x.lookahead===0)break}if(Y=0,x.lookahead>=S&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+S-1])&x.hash_mask,Y=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),x.prev_length=x.match_length,x.prev_match=x.match_start,x.match_length=S-1,Y!==0&&x.prev_length<x.max_lazy_match&&x.strstart-Y<=x.w_size-M&&(x.match_length=st(x,Y),x.match_length<=5&&(x.strategy===1||x.match_length===S&&4096<x.strstart-x.match_start)&&(x.match_length=S-1)),x.prev_length>=S&&x.match_length<=x.prev_length){for(R=x.strstart+x.lookahead-S,$=a._tr_tally(x,x.strstart-1-x.prev_match,x.prev_length-S),x.lookahead-=x.prev_length-1,x.prev_length-=2;++x.strstart<=R&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+S-1])&x.hash_mask,Y=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),--x.prev_length!=0;);if(x.match_available=0,x.match_length=S-1,x.strstart++,$&&(B(x,!1),x.strm.avail_out===0))return E}else if(x.match_available){if(($=a._tr_tally(x,0,x.window[x.strstart-1]))&&B(x,!1),x.strstart++,x.lookahead--,x.strm.avail_out===0)return E}else x.match_available=1,x.strstart++,x.lookahead--}return x.match_available&&($=a._tr_tally(x,0,x.window[x.strstart-1]),x.match_available=0),x.insert=x.strstart<S-1?x.strstart:S-1,Z===p?(B(x,!0),x.strm.avail_out===0?W:V):x.last_lit&&(B(x,!1),x.strm.avail_out===0)?E:N}function pt(x,Z,Y,$,R){this.good_length=x,this.max_lazy=Z,this.nice_length=Y,this.max_chain=$,this.func=R}function bt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=_,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*C),this.dyn_dtree=new o.Buf16(2*(2*w+1)),this.bl_tree=new o.Buf16(2*(2*I+1)),nt(this.dyn_ltree),nt(this.dyn_dtree),nt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(A+1),this.heap=new o.Buf16(2*v+1),nt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*v+1),nt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function wt(x){var Z;return x&&x.state?(x.total_in=x.total_out=0,x.data_type=f,(Z=x.state).pending=0,Z.pending_out=0,Z.wrap<0&&(Z.wrap=-Z.wrap),Z.status=Z.wrap?T:L,x.adler=Z.wrap===2?0:1,Z.last_flush=u,a._tr_init(Z),d):et(x,g)}function St(x){var Z=wt(x);return Z===d&&(function(Y){Y.window_size=2*Y.w_size,nt(Y.head),Y.max_lazy_match=r[Y.level].max_lazy,Y.good_match=r[Y.level].good_length,Y.nice_match=r[Y.level].nice_length,Y.max_chain_length=r[Y.level].max_chain,Y.strstart=0,Y.block_start=0,Y.lookahead=0,Y.insert=0,Y.match_length=Y.prev_length=S-1,Y.match_available=0,Y.ins_h=0})(x.state),Z}function Rt(x,Z,Y,$,R,U){if(!x)return g;var tt=1;if(Z===m&&(Z=6),$<0?(tt=0,$=-$):15<$&&(tt=2,$-=16),R<1||y<R||Y!==_||$<8||15<$||Z<0||9<Z||U<0||b<U)return et(x,g);$===8&&($=9);var K=new bt;return(x.state=K).strm=x,K.wrap=tt,K.gzhead=null,K.w_bits=$,K.w_size=1<<K.w_bits,K.w_mask=K.w_size-1,K.hash_bits=R+7,K.hash_size=1<<K.hash_bits,K.hash_mask=K.hash_size-1,K.hash_shift=~~((K.hash_bits+S-1)/S),K.window=new o.Buf8(2*K.w_size),K.head=new o.Buf16(K.hash_size),K.prev=new o.Buf16(K.w_size),K.lit_bufsize=1<<R+6,K.pending_buf_size=4*K.lit_bufsize,K.pending_buf=new o.Buf8(K.pending_buf_size),K.d_buf=1*K.lit_bufsize,K.l_buf=3*K.lit_bufsize,K.level=Z,K.strategy=U,K.method=Y,St(x)}r=[new pt(0,0,0,0,function(x,Z){var Y=65535;for(Y>x.pending_buf_size-5&&(Y=x.pending_buf_size-5);;){if(x.lookahead<=1){if(ct(x),x.lookahead===0&&Z===u)return E;if(x.lookahead===0)break}x.strstart+=x.lookahead,x.lookahead=0;var $=x.block_start+Y;if((x.strstart===0||x.strstart>=$)&&(x.lookahead=x.strstart-$,x.strstart=$,B(x,!1),x.strm.avail_out===0)||x.strstart-x.block_start>=x.w_size-M&&(B(x,!1),x.strm.avail_out===0))return E}return x.insert=0,Z===p?(B(x,!0),x.strm.avail_out===0?W:V):(x.strstart>x.block_start&&(B(x,!1),x.strm.avail_out),E)}),new pt(4,4,8,4,_t),new pt(4,5,16,8,_t),new pt(4,6,32,32,_t),new pt(4,4,16,16,ut),new pt(8,16,32,32,ut),new pt(8,16,128,128,ut),new pt(8,32,128,256,ut),new pt(32,128,258,1024,ut),new pt(32,258,258,4096,ut)],i.deflateInit=function(x,Z){return Rt(x,Z,_,15,8,0)},i.deflateInit2=Rt,i.deflateReset=St,i.deflateResetKeep=wt,i.deflateSetHeader=function(x,Z){return x&&x.state?x.state.wrap!==2?g:(x.state.gzhead=Z,d):g},i.deflate=function(x,Z){var Y,$,R,U;if(!x||!x.state||5<Z||Z<0)return x?et(x,g):g;if($=x.state,!x.output||!x.input&&x.avail_in!==0||$.status===666&&Z!==p)return et(x,x.avail_out===0?-5:g);if($.strm=x,Y=$.last_flush,$.last_flush=Z,$.status===T)if($.wrap===2)x.adler=0,rt($,31),rt($,139),rt($,8),$.gzhead?(rt($,($.gzhead.text?1:0)+($.gzhead.hcrc?2:0)+($.gzhead.extra?4:0)+($.gzhead.name?8:0)+($.gzhead.comment?16:0)),rt($,255&$.gzhead.time),rt($,$.gzhead.time>>8&255),rt($,$.gzhead.time>>16&255),rt($,$.gzhead.time>>24&255),rt($,$.level===9?2:2<=$.strategy||$.level<2?4:0),rt($,255&$.gzhead.os),$.gzhead.extra&&$.gzhead.extra.length&&(rt($,255&$.gzhead.extra.length),rt($,$.gzhead.extra.length>>8&255)),$.gzhead.hcrc&&(x.adler=c(x.adler,$.pending_buf,$.pending,0)),$.gzindex=0,$.status=69):(rt($,0),rt($,0),rt($,0),rt($,0),rt($,0),rt($,$.level===9?2:2<=$.strategy||$.level<2?4:0),rt($,3),$.status=L);else{var tt=_+($.w_bits-8<<4)<<8;tt|=(2<=$.strategy||$.level<2?0:$.level<6?1:$.level===6?2:3)<<6,$.strstart!==0&&(tt|=32),tt+=31-tt%31,$.status=L,Q($,tt),$.strstart!==0&&(Q($,x.adler>>>16),Q($,65535&x.adler)),x.adler=1}if($.status===69)if($.gzhead.extra){for(R=$.pending;$.gzindex<(65535&$.gzhead.extra.length)&&($.pending!==$.pending_buf_size||($.gzhead.hcrc&&$.pending>R&&(x.adler=c(x.adler,$.pending_buf,$.pending-R,R)),H(x),R=$.pending,$.pending!==$.pending_buf_size));)rt($,255&$.gzhead.extra[$.gzindex]),$.gzindex++;$.gzhead.hcrc&&$.pending>R&&(x.adler=c(x.adler,$.pending_buf,$.pending-R,R)),$.gzindex===$.gzhead.extra.length&&($.gzindex=0,$.status=73)}else $.status=73;if($.status===73)if($.gzhead.name){R=$.pending;do{if($.pending===$.pending_buf_size&&($.gzhead.hcrc&&$.pending>R&&(x.adler=c(x.adler,$.pending_buf,$.pending-R,R)),H(x),R=$.pending,$.pending===$.pending_buf_size)){U=1;break}U=$.gzindex<$.gzhead.name.length?255&$.gzhead.name.charCodeAt($.gzindex++):0,rt($,U)}while(U!==0);$.gzhead.hcrc&&$.pending>R&&(x.adler=c(x.adler,$.pending_buf,$.pending-R,R)),U===0&&($.gzindex=0,$.status=91)}else $.status=91;if($.status===91)if($.gzhead.comment){R=$.pending;do{if($.pending===$.pending_buf_size&&($.gzhead.hcrc&&$.pending>R&&(x.adler=c(x.adler,$.pending_buf,$.pending-R,R)),H(x),R=$.pending,$.pending===$.pending_buf_size)){U=1;break}U=$.gzindex<$.gzhead.comment.length?255&$.gzhead.comment.charCodeAt($.gzindex++):0,rt($,U)}while(U!==0);$.gzhead.hcrc&&$.pending>R&&(x.adler=c(x.adler,$.pending_buf,$.pending-R,R)),U===0&&($.status=103)}else $.status=103;if($.status===103&&($.gzhead.hcrc?($.pending+2>$.pending_buf_size&&H(x),$.pending+2<=$.pending_buf_size&&(rt($,255&x.adler),rt($,x.adler>>8&255),x.adler=0,$.status=L)):$.status=L),$.pending!==0){if(H(x),x.avail_out===0)return $.last_flush=-1,d}else if(x.avail_in===0&&j(Z)<=j(Y)&&Z!==p)return et(x,-5);if($.status===666&&x.avail_in!==0)return et(x,-5);if(x.avail_in!==0||$.lookahead!==0||Z!==u&&$.status!==666){var K=$.strategy===2?(function(D,J){for(var it;;){if(D.lookahead===0&&(ct(D),D.lookahead===0)){if(J===u)return E;break}if(D.match_length=0,it=a._tr_tally(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++,it&&(B(D,!1),D.strm.avail_out===0))return E}return D.insert=0,J===p?(B(D,!0),D.strm.avail_out===0?W:V):D.last_lit&&(B(D,!1),D.strm.avail_out===0)?E:N})($,Z):$.strategy===3?(function(D,J){for(var it,X,lt,vt,gt=D.window;;){if(D.lookahead<=P){if(ct(D),D.lookahead<=P&&J===u)return E;if(D.lookahead===0)break}if(D.match_length=0,D.lookahead>=S&&0<D.strstart&&(X=gt[lt=D.strstart-1])===gt[++lt]&&X===gt[++lt]&&X===gt[++lt]){vt=D.strstart+P;do;while(X===gt[++lt]&&X===gt[++lt]&&X===gt[++lt]&&X===gt[++lt]&&X===gt[++lt]&&X===gt[++lt]&&X===gt[++lt]&&X===gt[++lt]&&lt<vt);D.match_length=P-(vt-lt),D.match_length>D.lookahead&&(D.match_length=D.lookahead)}if(D.match_length>=S?(it=a._tr_tally(D,1,D.match_length-S),D.lookahead-=D.match_length,D.strstart+=D.match_length,D.match_length=0):(it=a._tr_tally(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++),it&&(B(D,!1),D.strm.avail_out===0))return E}return D.insert=0,J===p?(B(D,!0),D.strm.avail_out===0?W:V):D.last_lit&&(B(D,!1),D.strm.avail_out===0)?E:N})($,Z):r[$.level].func($,Z);if(K!==W&&K!==V||($.status=666),K===E||K===W)return x.avail_out===0&&($.last_flush=-1),d;if(K===N&&(Z===1?a._tr_align($):Z!==5&&(a._tr_stored_block($,0,0,!1),Z===3&&(nt($.head),$.lookahead===0&&($.strstart=0,$.block_start=0,$.insert=0))),H(x),x.avail_out===0))return $.last_flush=-1,d}return Z!==p?d:$.wrap<=0?1:($.wrap===2?(rt($,255&x.adler),rt($,x.adler>>8&255),rt($,x.adler>>16&255),rt($,x.adler>>24&255),rt($,255&x.total_in),rt($,x.total_in>>8&255),rt($,x.total_in>>16&255),rt($,x.total_in>>24&255)):(Q($,x.adler>>>16),Q($,65535&x.adler)),H(x),0<$.wrap&&($.wrap=-$.wrap),$.pending!==0?d:1)},i.deflateEnd=function(x){var Z;return x&&x.state?(Z=x.state.status)!==T&&Z!==69&&Z!==73&&Z!==91&&Z!==103&&Z!==L&&Z!==666?et(x,g):(x.state=null,Z===L?et(x,-3):d):g},i.deflateSetDictionary=function(x,Z){var Y,$,R,U,tt,K,D,J,it=Z.length;if(!x||!x.state||(U=(Y=x.state).wrap)===2||U===1&&Y.status!==T||Y.lookahead)return g;for(U===1&&(x.adler=l(x.adler,Z,it,0)),Y.wrap=0,it>=Y.w_size&&(U===0&&(nt(Y.head),Y.strstart=0,Y.block_start=0,Y.insert=0),J=new o.Buf8(Y.w_size),o.arraySet(J,Z,it-Y.w_size,Y.w_size,0),Z=J,it=Y.w_size),tt=x.avail_in,K=x.next_in,D=x.input,x.avail_in=it,x.next_in=0,x.input=Z,ct(Y);Y.lookahead>=S;){for($=Y.strstart,R=Y.lookahead-(S-1);Y.ins_h=(Y.ins_h<<Y.hash_shift^Y.window[$+S-1])&Y.hash_mask,Y.prev[$&Y.w_mask]=Y.head[Y.ins_h],Y.head[Y.ins_h]=$,$++,--R;);Y.strstart=$,Y.lookahead=S-1,ct(Y)}return Y.strstart+=Y.lookahead,Y.block_start=Y.strstart,Y.insert=Y.lookahead,Y.lookahead=0,Y.match_length=Y.prev_length=S-1,Y.match_available=0,x.next_in=K,x.input=D,x.avail_in=tt,Y.wrap=U,d},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,s,i){s.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,s,i){s.exports=function(r,o){var a,l,c,h,u,p,d,g,m,b,f,_,y,v,w,I,C,A,S,P,M,T,L,E,N;a=r.state,l=r.next_in,E=r.input,c=l+(r.avail_in-5),h=r.next_out,N=r.output,u=h-(o-r.avail_out),p=h+(r.avail_out-257),d=a.dmax,g=a.wsize,m=a.whave,b=a.wnext,f=a.window,_=a.hold,y=a.bits,v=a.lencode,w=a.distcode,I=(1<<a.lenbits)-1,C=(1<<a.distbits)-1;t:do{y<15&&(_+=E[l++]<<y,y+=8,_+=E[l++]<<y,y+=8),A=v[_&I];e:for(;;){if(_>>>=S=A>>>24,y-=S,(S=A>>>16&255)===0)N[h++]=65535&A;else{if(!(16&S)){if((64&S)==0){A=v[(65535&A)+(_&(1<<S)-1)];continue e}if(32&S){a.mode=12;break t}r.msg="invalid literal/length code",a.mode=30;break t}P=65535&A,(S&=15)&&(y<S&&(_+=E[l++]<<y,y+=8),P+=_&(1<<S)-1,_>>>=S,y-=S),y<15&&(_+=E[l++]<<y,y+=8,_+=E[l++]<<y,y+=8),A=w[_&C];s:for(;;){if(_>>>=S=A>>>24,y-=S,!(16&(S=A>>>16&255))){if((64&S)==0){A=w[(65535&A)+(_&(1<<S)-1)];continue s}r.msg="invalid distance code",a.mode=30;break t}if(M=65535&A,y<(S&=15)&&(_+=E[l++]<<y,(y+=8)<S&&(_+=E[l++]<<y,y+=8)),d<(M+=_&(1<<S)-1)){r.msg="invalid distance too far back",a.mode=30;break t}if(_>>>=S,y-=S,(S=h-u)<M){if(m<(S=M-S)&&a.sane){r.msg="invalid distance too far back",a.mode=30;break t}if(L=f,(T=0)===b){if(T+=g-S,S<P){for(P-=S;N[h++]=f[T++],--S;);T=h-M,L=N}}else if(b<S){if(T+=g+b-S,(S-=b)<P){for(P-=S;N[h++]=f[T++],--S;);if(T=0,b<P){for(P-=S=b;N[h++]=f[T++],--S;);T=h-M,L=N}}}else if(T+=b-S,S<P){for(P-=S;N[h++]=f[T++],--S;);T=h-M,L=N}for(;2<P;)N[h++]=L[T++],N[h++]=L[T++],N[h++]=L[T++],P-=3;P&&(N[h++]=L[T++],1<P&&(N[h++]=L[T++]))}else{for(T=h-M;N[h++]=N[T++],N[h++]=N[T++],N[h++]=N[T++],2<(P-=3););P&&(N[h++]=N[T++],1<P&&(N[h++]=N[T++]))}break}}break}}while(l<c&&h<p);l-=P=y>>3,_&=(1<<(y-=P<<3))-1,r.next_in=l,r.next_out=h,r.avail_in=l<c?c-l+5:5-(l-c),r.avail_out=h<p?p-h+257:257-(h-p),a.hold=_,a.bits=y}},{}],49:[function(e,s,i){var r=e("../utils/common"),o=e("./adler32"),a=e("./crc32"),l=e("./inffast"),c=e("./inftrees"),h=1,u=2,p=0,d=-2,g=1,m=852,b=592;function f(T){return(T>>>24&255)+(T>>>8&65280)+((65280&T)<<8)+((255&T)<<24)}function _(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function y(T){var L;return T&&T.state?(L=T.state,T.total_in=T.total_out=L.total=0,T.msg="",L.wrap&&(T.adler=1&L.wrap),L.mode=g,L.last=0,L.havedict=0,L.dmax=32768,L.head=null,L.hold=0,L.bits=0,L.lencode=L.lendyn=new r.Buf32(m),L.distcode=L.distdyn=new r.Buf32(b),L.sane=1,L.back=-1,p):d}function v(T){var L;return T&&T.state?((L=T.state).wsize=0,L.whave=0,L.wnext=0,y(T)):d}function w(T,L){var E,N;return T&&T.state?(N=T.state,L<0?(E=0,L=-L):(E=1+(L>>4),L<48&&(L&=15)),L&&(L<8||15<L)?d:(N.window!==null&&N.wbits!==L&&(N.window=null),N.wrap=E,N.wbits=L,v(T))):d}function I(T,L){var E,N;return T?(N=new _,(T.state=N).window=null,(E=w(T,L))!==p&&(T.state=null),E):d}var C,A,S=!0;function P(T){if(S){var L;for(C=new r.Buf32(512),A=new r.Buf32(32),L=0;L<144;)T.lens[L++]=8;for(;L<256;)T.lens[L++]=9;for(;L<280;)T.lens[L++]=7;for(;L<288;)T.lens[L++]=8;for(c(h,T.lens,0,288,C,0,T.work,{bits:9}),L=0;L<32;)T.lens[L++]=5;c(u,T.lens,0,32,A,0,T.work,{bits:5}),S=!1}T.lencode=C,T.lenbits=9,T.distcode=A,T.distbits=5}function M(T,L,E,N){var W,V=T.state;return V.window===null&&(V.wsize=1<<V.wbits,V.wnext=0,V.whave=0,V.window=new r.Buf8(V.wsize)),N>=V.wsize?(r.arraySet(V.window,L,E-V.wsize,V.wsize,0),V.wnext=0,V.whave=V.wsize):(N<(W=V.wsize-V.wnext)&&(W=N),r.arraySet(V.window,L,E-N,W,V.wnext),(N-=W)?(r.arraySet(V.window,L,E-N,N,0),V.wnext=N,V.whave=V.wsize):(V.wnext+=W,V.wnext===V.wsize&&(V.wnext=0),V.whave<V.wsize&&(V.whave+=W))),0}i.inflateReset=v,i.inflateReset2=w,i.inflateResetKeep=y,i.inflateInit=function(T){return I(T,15)},i.inflateInit2=I,i.inflate=function(T,L){var E,N,W,V,et,j,nt,H,B,rt,Q,st,ct,_t,ut,pt,bt,wt,St,Rt,x,Z,Y,$,R=0,U=new r.Buf8(4),tt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!T||!T.state||!T.output||!T.input&&T.avail_in!==0)return d;(E=T.state).mode===12&&(E.mode=13),et=T.next_out,W=T.output,nt=T.avail_out,V=T.next_in,N=T.input,j=T.avail_in,H=E.hold,B=E.bits,rt=j,Q=nt,Z=p;t:for(;;)switch(E.mode){case g:if(E.wrap===0){E.mode=13;break}for(;B<16;){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}if(2&E.wrap&&H===35615){U[E.check=0]=255&H,U[1]=H>>>8&255,E.check=a(E.check,U,2,0),B=H=0,E.mode=2;break}if(E.flags=0,E.head&&(E.head.done=!1),!(1&E.wrap)||(((255&H)<<8)+(H>>8))%31){T.msg="incorrect header check",E.mode=30;break}if((15&H)!=8){T.msg="unknown compression method",E.mode=30;break}if(B-=4,x=8+(15&(H>>>=4)),E.wbits===0)E.wbits=x;else if(x>E.wbits){T.msg="invalid window size",E.mode=30;break}E.dmax=1<<x,T.adler=E.check=1,E.mode=512&H?10:12,B=H=0;break;case 2:for(;B<16;){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}if(E.flags=H,(255&E.flags)!=8){T.msg="unknown compression method",E.mode=30;break}if(57344&E.flags){T.msg="unknown header flags set",E.mode=30;break}E.head&&(E.head.text=H>>8&1),512&E.flags&&(U[0]=255&H,U[1]=H>>>8&255,E.check=a(E.check,U,2,0)),B=H=0,E.mode=3;case 3:for(;B<32;){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}E.head&&(E.head.time=H),512&E.flags&&(U[0]=255&H,U[1]=H>>>8&255,U[2]=H>>>16&255,U[3]=H>>>24&255,E.check=a(E.check,U,4,0)),B=H=0,E.mode=4;case 4:for(;B<16;){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}E.head&&(E.head.xflags=255&H,E.head.os=H>>8),512&E.flags&&(U[0]=255&H,U[1]=H>>>8&255,E.check=a(E.check,U,2,0)),B=H=0,E.mode=5;case 5:if(1024&E.flags){for(;B<16;){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}E.length=H,E.head&&(E.head.extra_len=H),512&E.flags&&(U[0]=255&H,U[1]=H>>>8&255,E.check=a(E.check,U,2,0)),B=H=0}else E.head&&(E.head.extra=null);E.mode=6;case 6:if(1024&E.flags&&(j<(st=E.length)&&(st=j),st&&(E.head&&(x=E.head.extra_len-E.length,E.head.extra||(E.head.extra=new Array(E.head.extra_len)),r.arraySet(E.head.extra,N,V,st,x)),512&E.flags&&(E.check=a(E.check,N,st,V)),j-=st,V+=st,E.length-=st),E.length))break t;E.length=0,E.mode=7;case 7:if(2048&E.flags){if(j===0)break t;for(st=0;x=N[V+st++],E.head&&x&&E.length<65536&&(E.head.name+=String.fromCharCode(x)),x&&st<j;);if(512&E.flags&&(E.check=a(E.check,N,st,V)),j-=st,V+=st,x)break t}else E.head&&(E.head.name=null);E.length=0,E.mode=8;case 8:if(4096&E.flags){if(j===0)break t;for(st=0;x=N[V+st++],E.head&&x&&E.length<65536&&(E.head.comment+=String.fromCharCode(x)),x&&st<j;);if(512&E.flags&&(E.check=a(E.check,N,st,V)),j-=st,V+=st,x)break t}else E.head&&(E.head.comment=null);E.mode=9;case 9:if(512&E.flags){for(;B<16;){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}if(H!==(65535&E.check)){T.msg="header crc mismatch",E.mode=30;break}B=H=0}E.head&&(E.head.hcrc=E.flags>>9&1,E.head.done=!0),T.adler=E.check=0,E.mode=12;break;case 10:for(;B<32;){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}T.adler=E.check=f(H),B=H=0,E.mode=11;case 11:if(E.havedict===0)return T.next_out=et,T.avail_out=nt,T.next_in=V,T.avail_in=j,E.hold=H,E.bits=B,2;T.adler=E.check=1,E.mode=12;case 12:if(L===5||L===6)break t;case 13:if(E.last){H>>>=7&B,B-=7&B,E.mode=27;break}for(;B<3;){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}switch(E.last=1&H,B-=1,3&(H>>>=1)){case 0:E.mode=14;break;case 1:if(P(E),E.mode=20,L!==6)break;H>>>=2,B-=2;break t;case 2:E.mode=17;break;case 3:T.msg="invalid block type",E.mode=30}H>>>=2,B-=2;break;case 14:for(H>>>=7&B,B-=7&B;B<32;){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}if((65535&H)!=(H>>>16^65535)){T.msg="invalid stored block lengths",E.mode=30;break}if(E.length=65535&H,B=H=0,E.mode=15,L===6)break t;case 15:E.mode=16;case 16:if(st=E.length){if(j<st&&(st=j),nt<st&&(st=nt),st===0)break t;r.arraySet(W,N,V,st,et),j-=st,V+=st,nt-=st,et+=st,E.length-=st;break}E.mode=12;break;case 17:for(;B<14;){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}if(E.nlen=257+(31&H),H>>>=5,B-=5,E.ndist=1+(31&H),H>>>=5,B-=5,E.ncode=4+(15&H),H>>>=4,B-=4,286<E.nlen||30<E.ndist){T.msg="too many length or distance symbols",E.mode=30;break}E.have=0,E.mode=18;case 18:for(;E.have<E.ncode;){for(;B<3;){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}E.lens[tt[E.have++]]=7&H,H>>>=3,B-=3}for(;E.have<19;)E.lens[tt[E.have++]]=0;if(E.lencode=E.lendyn,E.lenbits=7,Y={bits:E.lenbits},Z=c(0,E.lens,0,19,E.lencode,0,E.work,Y),E.lenbits=Y.bits,Z){T.msg="invalid code lengths set",E.mode=30;break}E.have=0,E.mode=19;case 19:for(;E.have<E.nlen+E.ndist;){for(;pt=(R=E.lencode[H&(1<<E.lenbits)-1])>>>16&255,bt=65535&R,!((ut=R>>>24)<=B);){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}if(bt<16)H>>>=ut,B-=ut,E.lens[E.have++]=bt;else{if(bt===16){for($=ut+2;B<$;){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}if(H>>>=ut,B-=ut,E.have===0){T.msg="invalid bit length repeat",E.mode=30;break}x=E.lens[E.have-1],st=3+(3&H),H>>>=2,B-=2}else if(bt===17){for($=ut+3;B<$;){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}B-=ut,x=0,st=3+(7&(H>>>=ut)),H>>>=3,B-=3}else{for($=ut+7;B<$;){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}B-=ut,x=0,st=11+(127&(H>>>=ut)),H>>>=7,B-=7}if(E.have+st>E.nlen+E.ndist){T.msg="invalid bit length repeat",E.mode=30;break}for(;st--;)E.lens[E.have++]=x}}if(E.mode===30)break;if(E.lens[256]===0){T.msg="invalid code -- missing end-of-block",E.mode=30;break}if(E.lenbits=9,Y={bits:E.lenbits},Z=c(h,E.lens,0,E.nlen,E.lencode,0,E.work,Y),E.lenbits=Y.bits,Z){T.msg="invalid literal/lengths set",E.mode=30;break}if(E.distbits=6,E.distcode=E.distdyn,Y={bits:E.distbits},Z=c(u,E.lens,E.nlen,E.ndist,E.distcode,0,E.work,Y),E.distbits=Y.bits,Z){T.msg="invalid distances set",E.mode=30;break}if(E.mode=20,L===6)break t;case 20:E.mode=21;case 21:if(6<=j&&258<=nt){T.next_out=et,T.avail_out=nt,T.next_in=V,T.avail_in=j,E.hold=H,E.bits=B,l(T,Q),et=T.next_out,W=T.output,nt=T.avail_out,V=T.next_in,N=T.input,j=T.avail_in,H=E.hold,B=E.bits,E.mode===12&&(E.back=-1);break}for(E.back=0;pt=(R=E.lencode[H&(1<<E.lenbits)-1])>>>16&255,bt=65535&R,!((ut=R>>>24)<=B);){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}if(pt&&(240&pt)==0){for(wt=ut,St=pt,Rt=bt;pt=(R=E.lencode[Rt+((H&(1<<wt+St)-1)>>wt)])>>>16&255,bt=65535&R,!(wt+(ut=R>>>24)<=B);){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}H>>>=wt,B-=wt,E.back+=wt}if(H>>>=ut,B-=ut,E.back+=ut,E.length=bt,pt===0){E.mode=26;break}if(32&pt){E.back=-1,E.mode=12;break}if(64&pt){T.msg="invalid literal/length code",E.mode=30;break}E.extra=15&pt,E.mode=22;case 22:if(E.extra){for($=E.extra;B<$;){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}E.length+=H&(1<<E.extra)-1,H>>>=E.extra,B-=E.extra,E.back+=E.extra}E.was=E.length,E.mode=23;case 23:for(;pt=(R=E.distcode[H&(1<<E.distbits)-1])>>>16&255,bt=65535&R,!((ut=R>>>24)<=B);){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}if((240&pt)==0){for(wt=ut,St=pt,Rt=bt;pt=(R=E.distcode[Rt+((H&(1<<wt+St)-1)>>wt)])>>>16&255,bt=65535&R,!(wt+(ut=R>>>24)<=B);){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}H>>>=wt,B-=wt,E.back+=wt}if(H>>>=ut,B-=ut,E.back+=ut,64&pt){T.msg="invalid distance code",E.mode=30;break}E.offset=bt,E.extra=15&pt,E.mode=24;case 24:if(E.extra){for($=E.extra;B<$;){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}E.offset+=H&(1<<E.extra)-1,H>>>=E.extra,B-=E.extra,E.back+=E.extra}if(E.offset>E.dmax){T.msg="invalid distance too far back",E.mode=30;break}E.mode=25;case 25:if(nt===0)break t;if(st=Q-nt,E.offset>st){if((st=E.offset-st)>E.whave&&E.sane){T.msg="invalid distance too far back",E.mode=30;break}ct=st>E.wnext?(st-=E.wnext,E.wsize-st):E.wnext-st,st>E.length&&(st=E.length),_t=E.window}else _t=W,ct=et-E.offset,st=E.length;for(nt<st&&(st=nt),nt-=st,E.length-=st;W[et++]=_t[ct++],--st;);E.length===0&&(E.mode=21);break;case 26:if(nt===0)break t;W[et++]=E.length,nt--,E.mode=21;break;case 27:if(E.wrap){for(;B<32;){if(j===0)break t;j--,H|=N[V++]<<B,B+=8}if(Q-=nt,T.total_out+=Q,E.total+=Q,Q&&(T.adler=E.check=E.flags?a(E.check,W,Q,et-Q):o(E.check,W,Q,et-Q)),Q=nt,(E.flags?H:f(H))!==E.check){T.msg="incorrect data check",E.mode=30;break}B=H=0}E.mode=28;case 28:if(E.wrap&&E.flags){for(;B<32;){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}if(H!==(4294967295&E.total)){T.msg="incorrect length check",E.mode=30;break}B=H=0}E.mode=29;case 29:Z=1;break t;case 30:Z=-3;break t;case 31:return-4;case 32:default:return d}return T.next_out=et,T.avail_out=nt,T.next_in=V,T.avail_in=j,E.hold=H,E.bits=B,(E.wsize||Q!==T.avail_out&&E.mode<30&&(E.mode<27||L!==4))&&M(T,T.output,T.next_out,Q-T.avail_out)?(E.mode=31,-4):(rt-=T.avail_in,Q-=T.avail_out,T.total_in+=rt,T.total_out+=Q,E.total+=Q,E.wrap&&Q&&(T.adler=E.check=E.flags?a(E.check,W,Q,T.next_out-Q):o(E.check,W,Q,T.next_out-Q)),T.data_type=E.bits+(E.last?64:0)+(E.mode===12?128:0)+(E.mode===20||E.mode===15?256:0),(rt==0&&Q===0||L===4)&&Z===p&&(Z=-5),Z)},i.inflateEnd=function(T){if(!T||!T.state)return d;var L=T.state;return L.window&&(L.window=null),T.state=null,p},i.inflateGetHeader=function(T,L){var E;return T&&T.state?(2&(E=T.state).wrap)==0?d:((E.head=L).done=!1,p):d},i.inflateSetDictionary=function(T,L){var E,N=L.length;return T&&T.state?(E=T.state).wrap!==0&&E.mode!==11?d:E.mode===11&&o(1,L,N,0)!==E.check?-3:M(T,L,N,N)?(E.mode=31,-4):(E.havedict=1,p):d},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,s,i){var r=e("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];s.exports=function(h,u,p,d,g,m,b,f){var _,y,v,w,I,C,A,S,P,M=f.bits,T=0,L=0,E=0,N=0,W=0,V=0,et=0,j=0,nt=0,H=0,B=null,rt=0,Q=new r.Buf16(16),st=new r.Buf16(16),ct=null,_t=0;for(T=0;T<=15;T++)Q[T]=0;for(L=0;L<d;L++)Q[u[p+L]]++;for(W=M,N=15;1<=N&&Q[N]===0;N--);if(N<W&&(W=N),N===0)return g[m++]=20971520,g[m++]=20971520,f.bits=1,0;for(E=1;E<N&&Q[E]===0;E++);for(W<E&&(W=E),T=j=1;T<=15;T++)if(j<<=1,(j-=Q[T])<0)return-1;if(0<j&&(h===0||N!==1))return-1;for(st[1]=0,T=1;T<15;T++)st[T+1]=st[T]+Q[T];for(L=0;L<d;L++)u[p+L]!==0&&(b[st[u[p+L]]++]=L);if(C=h===0?(B=ct=b,19):h===1?(B=o,rt-=257,ct=a,_t-=257,256):(B=l,ct=c,-1),T=E,I=m,et=L=H=0,v=-1,w=(nt=1<<(V=W))-1,h===1&&852<nt||h===2&&592<nt)return 1;for(;;){for(A=T-et,P=b[L]<C?(S=0,b[L]):b[L]>C?(S=ct[_t+b[L]],B[rt+b[L]]):(S=96,0),_=1<<T-et,E=y=1<<V;g[I+(H>>et)+(y-=_)]=A<<24|S<<16|P|0,y!==0;);for(_=1<<T-1;H&_;)_>>=1;if(_!==0?(H&=_-1,H+=_):H=0,L++,--Q[T]==0){if(T===N)break;T=u[p+b[L]]}if(W<T&&(H&w)!==v){for(et===0&&(et=W),I+=E,j=1<<(V=T-et);V+et<N&&!((j-=Q[V+et])<=0);)V++,j<<=1;if(nt+=1<<V,h===1&&852<nt||h===2&&592<nt)return 1;g[v=H&w]=W<<24|V<<16|I-m|0}}return H!==0&&(g[I+H]=T-et<<24|64<<16|0),f.bits=W,0}},{"../utils/common":41}],51:[function(e,s,i){s.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,s,i){var r=e("../utils/common"),o=0,a=1;function l(R){for(var U=R.length;0<=--U;)R[U]=0}var c=0,h=29,u=256,p=u+1+h,d=30,g=19,m=2*p+1,b=15,f=16,_=7,y=256,v=16,w=17,I=18,C=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],A=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],P=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],M=new Array(2*(p+2));l(M);var T=new Array(2*d);l(T);var L=new Array(512);l(L);var E=new Array(256);l(E);var N=new Array(h);l(N);var W,V,et,j=new Array(d);function nt(R,U,tt,K,D){this.static_tree=R,this.extra_bits=U,this.extra_base=tt,this.elems=K,this.max_length=D,this.has_stree=R&&R.length}function H(R,U){this.dyn_tree=R,this.max_code=0,this.stat_desc=U}function B(R){return R<256?L[R]:L[256+(R>>>7)]}function rt(R,U){R.pending_buf[R.pending++]=255&U,R.pending_buf[R.pending++]=U>>>8&255}function Q(R,U,tt){R.bi_valid>f-tt?(R.bi_buf|=U<<R.bi_valid&65535,rt(R,R.bi_buf),R.bi_buf=U>>f-R.bi_valid,R.bi_valid+=tt-f):(R.bi_buf|=U<<R.bi_valid&65535,R.bi_valid+=tt)}function st(R,U,tt){Q(R,tt[2*U],tt[2*U+1])}function ct(R,U){for(var tt=0;tt|=1&R,R>>>=1,tt<<=1,0<--U;);return tt>>>1}function _t(R,U,tt){var K,D,J=new Array(b+1),it=0;for(K=1;K<=b;K++)J[K]=it=it+tt[K-1]<<1;for(D=0;D<=U;D++){var X=R[2*D+1];X!==0&&(R[2*D]=ct(J[X]++,X))}}function ut(R){var U;for(U=0;U<p;U++)R.dyn_ltree[2*U]=0;for(U=0;U<d;U++)R.dyn_dtree[2*U]=0;for(U=0;U<g;U++)R.bl_tree[2*U]=0;R.dyn_ltree[2*y]=1,R.opt_len=R.static_len=0,R.last_lit=R.matches=0}function pt(R){8<R.bi_valid?rt(R,R.bi_buf):0<R.bi_valid&&(R.pending_buf[R.pending++]=R.bi_buf),R.bi_buf=0,R.bi_valid=0}function bt(R,U,tt,K){var D=2*U,J=2*tt;return R[D]<R[J]||R[D]===R[J]&&K[U]<=K[tt]}function wt(R,U,tt){for(var K=R.heap[tt],D=tt<<1;D<=R.heap_len&&(D<R.heap_len&&bt(U,R.heap[D+1],R.heap[D],R.depth)&&D++,!bt(U,K,R.heap[D],R.depth));)R.heap[tt]=R.heap[D],tt=D,D<<=1;R.heap[tt]=K}function St(R,U,tt){var K,D,J,it,X=0;if(R.last_lit!==0)for(;K=R.pending_buf[R.d_buf+2*X]<<8|R.pending_buf[R.d_buf+2*X+1],D=R.pending_buf[R.l_buf+X],X++,K===0?st(R,D,U):(st(R,(J=E[D])+u+1,U),(it=C[J])!==0&&Q(R,D-=N[J],it),st(R,J=B(--K),tt),(it=A[J])!==0&&Q(R,K-=j[J],it)),X<R.last_lit;);st(R,y,U)}function Rt(R,U){var tt,K,D,J=U.dyn_tree,it=U.stat_desc.static_tree,X=U.stat_desc.has_stree,lt=U.stat_desc.elems,vt=-1;for(R.heap_len=0,R.heap_max=m,tt=0;tt<lt;tt++)J[2*tt]!==0?(R.heap[++R.heap_len]=vt=tt,R.depth[tt]=0):J[2*tt+1]=0;for(;R.heap_len<2;)J[2*(D=R.heap[++R.heap_len]=vt<2?++vt:0)]=1,R.depth[D]=0,R.opt_len--,X&&(R.static_len-=it[2*D+1]);for(U.max_code=vt,tt=R.heap_len>>1;1<=tt;tt--)wt(R,J,tt);for(D=lt;tt=R.heap[1],R.heap[1]=R.heap[R.heap_len--],wt(R,J,1),K=R.heap[1],R.heap[--R.heap_max]=tt,R.heap[--R.heap_max]=K,J[2*D]=J[2*tt]+J[2*K],R.depth[D]=(R.depth[tt]>=R.depth[K]?R.depth[tt]:R.depth[K])+1,J[2*tt+1]=J[2*K+1]=D,R.heap[1]=D++,wt(R,J,1),2<=R.heap_len;);R.heap[--R.heap_max]=R.heap[1],(function(gt,Ft){var ue,Gt,ge,Pt,Ls,ci,ve=Ft.dyn_tree,yn=Ft.max_code,vn=Ft.stat_desc.static_tree,hi=Ft.stat_desc.has_stree,ys=Ft.stat_desc.extra_bits,$s=Ft.stat_desc.extra_base,Re=Ft.stat_desc.max_length,Ye=0;for(Pt=0;Pt<=b;Pt++)gt.bl_count[Pt]=0;for(ve[2*gt.heap[gt.heap_max]+1]=0,ue=gt.heap_max+1;ue<m;ue++)Re<(Pt=ve[2*ve[2*(Gt=gt.heap[ue])+1]+1]+1)&&(Pt=Re,Ye++),ve[2*Gt+1]=Pt,yn<Gt||(gt.bl_count[Pt]++,Ls=0,$s<=Gt&&(Ls=ys[Gt-$s]),ci=ve[2*Gt],gt.opt_len+=ci*(Pt+Ls),hi&&(gt.static_len+=ci*(vn[2*Gt+1]+Ls)));if(Ye!==0){do{for(Pt=Re-1;gt.bl_count[Pt]===0;)Pt--;gt.bl_count[Pt]--,gt.bl_count[Pt+1]+=2,gt.bl_count[Re]--,Ye-=2}while(0<Ye);for(Pt=Re;Pt!==0;Pt--)for(Gt=gt.bl_count[Pt];Gt!==0;)yn<(ge=gt.heap[--ue])||(ve[2*ge+1]!==Pt&&(gt.opt_len+=(Pt-ve[2*ge+1])*ve[2*ge],ve[2*ge+1]=Pt),Gt--)}})(R,U),_t(J,vt,R.bl_count)}function x(R,U,tt){var K,D,J=-1,it=U[1],X=0,lt=7,vt=4;for(it===0&&(lt=138,vt=3),U[2*(tt+1)+1]=65535,K=0;K<=tt;K++)D=it,it=U[2*(K+1)+1],++X<lt&&D===it||(X<vt?R.bl_tree[2*D]+=X:D!==0?(D!==J&&R.bl_tree[2*D]++,R.bl_tree[2*v]++):X<=10?R.bl_tree[2*w]++:R.bl_tree[2*I]++,J=D,vt=(X=0)===it?(lt=138,3):D===it?(lt=6,3):(lt=7,4))}function Z(R,U,tt){var K,D,J=-1,it=U[1],X=0,lt=7,vt=4;for(it===0&&(lt=138,vt=3),K=0;K<=tt;K++)if(D=it,it=U[2*(K+1)+1],!(++X<lt&&D===it)){if(X<vt)for(;st(R,D,R.bl_tree),--X!=0;);else D!==0?(D!==J&&(st(R,D,R.bl_tree),X--),st(R,v,R.bl_tree),Q(R,X-3,2)):X<=10?(st(R,w,R.bl_tree),Q(R,X-3,3)):(st(R,I,R.bl_tree),Q(R,X-11,7));J=D,vt=(X=0)===it?(lt=138,3):D===it?(lt=6,3):(lt=7,4)}}l(j);var Y=!1;function $(R,U,tt,K){Q(R,(c<<1)+(K?1:0),3),(function(D,J,it,X){pt(D),rt(D,it),rt(D,~it),r.arraySet(D.pending_buf,D.window,J,it,D.pending),D.pending+=it})(R,U,tt)}i._tr_init=function(R){Y||((function(){var U,tt,K,D,J,it=new Array(b+1);for(D=K=0;D<h-1;D++)for(N[D]=K,U=0;U<1<<C[D];U++)E[K++]=D;for(E[K-1]=D,D=J=0;D<16;D++)for(j[D]=J,U=0;U<1<<A[D];U++)L[J++]=D;for(J>>=7;D<d;D++)for(j[D]=J<<7,U=0;U<1<<A[D]-7;U++)L[256+J++]=D;for(tt=0;tt<=b;tt++)it[tt]=0;for(U=0;U<=143;)M[2*U+1]=8,U++,it[8]++;for(;U<=255;)M[2*U+1]=9,U++,it[9]++;for(;U<=279;)M[2*U+1]=7,U++,it[7]++;for(;U<=287;)M[2*U+1]=8,U++,it[8]++;for(_t(M,p+1,it),U=0;U<d;U++)T[2*U+1]=5,T[2*U]=ct(U,5);W=new nt(M,C,u+1,p,b),V=new nt(T,A,0,d,b),et=new nt(new Array(0),S,0,g,_)})(),Y=!0),R.l_desc=new H(R.dyn_ltree,W),R.d_desc=new H(R.dyn_dtree,V),R.bl_desc=new H(R.bl_tree,et),R.bi_buf=0,R.bi_valid=0,ut(R)},i._tr_stored_block=$,i._tr_flush_block=function(R,U,tt,K){var D,J,it=0;0<R.level?(R.strm.data_type===2&&(R.strm.data_type=(function(X){var lt,vt=4093624447;for(lt=0;lt<=31;lt++,vt>>>=1)if(1&vt&&X.dyn_ltree[2*lt]!==0)return o;if(X.dyn_ltree[18]!==0||X.dyn_ltree[20]!==0||X.dyn_ltree[26]!==0)return a;for(lt=32;lt<u;lt++)if(X.dyn_ltree[2*lt]!==0)return a;return o})(R)),Rt(R,R.l_desc),Rt(R,R.d_desc),it=(function(X){var lt;for(x(X,X.dyn_ltree,X.l_desc.max_code),x(X,X.dyn_dtree,X.d_desc.max_code),Rt(X,X.bl_desc),lt=g-1;3<=lt&&X.bl_tree[2*P[lt]+1]===0;lt--);return X.opt_len+=3*(lt+1)+5+5+4,lt})(R),D=R.opt_len+3+7>>>3,(J=R.static_len+3+7>>>3)<=D&&(D=J)):D=J=tt+5,tt+4<=D&&U!==-1?$(R,U,tt,K):R.strategy===4||J===D?(Q(R,2+(K?1:0),3),St(R,M,T)):(Q(R,4+(K?1:0),3),(function(X,lt,vt,gt){var Ft;for(Q(X,lt-257,5),Q(X,vt-1,5),Q(X,gt-4,4),Ft=0;Ft<gt;Ft++)Q(X,X.bl_tree[2*P[Ft]+1],3);Z(X,X.dyn_ltree,lt-1),Z(X,X.dyn_dtree,vt-1)})(R,R.l_desc.max_code+1,R.d_desc.max_code+1,it+1),St(R,R.dyn_ltree,R.dyn_dtree)),ut(R),K&&pt(R)},i._tr_tally=function(R,U,tt){return R.pending_buf[R.d_buf+2*R.last_lit]=U>>>8&255,R.pending_buf[R.d_buf+2*R.last_lit+1]=255&U,R.pending_buf[R.l_buf+R.last_lit]=255&tt,R.last_lit++,U===0?R.dyn_ltree[2*tt]++:(R.matches++,U--,R.dyn_ltree[2*(E[tt]+u+1)]++,R.dyn_dtree[2*B(U)]++),R.last_lit===R.lit_bufsize-1},i._tr_align=function(R){Q(R,2,3),st(R,y,M),(function(U){U.bi_valid===16?(rt(U,U.bi_buf),U.bi_buf=0,U.bi_valid=0):8<=U.bi_valid&&(U.pending_buf[U.pending++]=255&U.bi_buf,U.bi_buf>>=8,U.bi_valid-=8)})(R)}},{"../utils/common":41}],53:[function(e,s,i){s.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,s,i){(function(r){(function(o,a){if(!o.setImmediate){var l,c,h,u,p=1,d={},g=!1,m=o.document,b=Object.getPrototypeOf&&Object.getPrototypeOf(o);b=b&&b.setTimeout?b:o,l={}.toString.call(o.process)==="[object process]"?function(v){process.nextTick(function(){_(v)})}:(function(){if(o.postMessage&&!o.importScripts){var v=!0,w=o.onmessage;return o.onmessage=function(){v=!1},o.postMessage("","*"),o.onmessage=w,v}})()?(u="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",y,!1):o.attachEvent("onmessage",y),function(v){o.postMessage(u+v,"*")}):o.MessageChannel?((h=new MessageChannel).port1.onmessage=function(v){_(v.data)},function(v){h.port2.postMessage(v)}):m&&"onreadystatechange"in m.createElement("script")?(c=m.documentElement,function(v){var w=m.createElement("script");w.onreadystatechange=function(){_(v),w.onreadystatechange=null,c.removeChild(w),w=null},c.appendChild(w)}):function(v){setTimeout(_,0,v)},b.setImmediate=function(v){typeof v!="function"&&(v=new Function(""+v));for(var w=new Array(arguments.length-1),I=0;I<w.length;I++)w[I]=arguments[I+1];var C={callback:v,args:w};return d[p]=C,l(p),p++},b.clearImmediate=f}function f(v){delete d[v]}function _(v){if(g)setTimeout(_,0,v);else{var w=d[v];if(w){g=!0;try{(function(I){var C=I.callback,A=I.args;switch(A.length){case 0:C();break;case 1:C(A[0]);break;case 2:C(A[0],A[1]);break;case 3:C(A[0],A[1],A[2]);break;default:C.apply(a,A)}})(w)}finally{f(v),g=!1}}}}function y(v){v.source===o&&typeof v.data=="string"&&v.data.indexOf(u)===0&&_(+v.data.slice(u.length))}})(typeof self>"u"?r===void 0?this:r:self)}).call(this,typeof jp<"u"?jp:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(eA);var pk=eA.exports;const K1=CM(pk);class U0{constructor(t,e){k(this,"date",new Date),k(this,"author"),k(this,"guid",wi.create()),k(this,"viewpoint"),k(this,"modifiedAuthor"),k(this,"modifiedDate"),k(this,"topic"),k(this,"_components"),k(this,"_comment",""),this._components=t,this._comment=e;const s=this._components.get(We);this.author=s.config.author}set comment(t){var e;const s=this._components.get(We);this._comment=t,this.modifiedDate=new Date,this.modifiedAuthor=s.config.author,(e=this.topic)==null||e.comments.set(this.guid,this)}get comment(){return this._comment}toJSON(){var t,e;const s={guid:this.guid,date:this.date.toISOString(),author:this.author,comment:this.comment,topic_guid:(t=this.topic)==null?void 0:t.guid,viewpoint_guid:this.viewpoint,modified_date:(e=this.modifiedDate)==null?void 0:e.toISOString(),modified_author:this.modifiedAuthor};for(const[i,r]of Object.entries(s))r===void 0&&delete s[i];return s}}const sA=class ao{constructor(t){k(this,"guid",wi.create()),k(this,"title",ao.default.title),k(this,"creationDate",new Date),k(this,"creationAuthor",""),k(this,"viewpoints",new Bb),k(this,"relatedTopics",new Bb),k(this,"comments",new Ac),k(this,"documentReferences",new Bb),k(this,"customData",{}),k(this,"description"),k(this,"serverAssignedId"),k(this,"dueDate"),k(this,"modifiedAuthor"),k(this,"modifiedDate"),k(this,"index"),k(this,"_type",ao.default.type),k(this,"_status",ao.default.status),k(this,"_priority",ao.default.priority),k(this,"_stage",ao.default.stage),k(this,"_assignedTo",ao.default.assignedTo),k(this,"_labels",ao.default.labels??new Set),k(this,"_components"),this._components=t;const e=t.get(We);this.creationAuthor=e.config.author,this.relatedTopics.guard=s=>s!==this.guid}set type(t){const e=this._components.get(We),{strict:s,types:i}=e.config;(!s||i.has(t))&&(this._type=t)}get type(){return this._type}set status(t){const e=this._components.get(We),{strict:s,statuses:i}=e.config;(!s||i.has(t))&&(this._status=t)}get status(){return this._status}set priority(t){const e=this._components.get(We);if(t){const{strict:s,priorities:i}=e.config;if(!(s?i.has(t):!0))return;this._priority=t}else this._priority=t}get priority(){return this._priority}set stage(t){const e=this._components.get(We);if(t){const{strict:s,stages:i}=e.config;if(!(s?i.has(t):!0))return;this._stage=t}else this._stage=t}get stage(){return this._stage}set assignedTo(t){const e=this._components.get(We);if(t){const{strict:s,users:i}=e.config;if(!(s?i.has(t):!0))return;this._assignedTo=t}else this._assignedTo=t}get assignedTo(){return this._assignedTo}set labels(t){const e=this._components.get(We),{strict:s,labels:i}=e.config;if(s){const r=new Set;for(const o of t)(!s||i.has(o))&&r.add(o);this._labels=r}else this._labels=t}get labels(){return this._labels}get _managerVersion(){return this._components.get(We).config.version}set(t){const e=t,s=this;for(const r in t){if(r==="guid")continue;const o=e[r];r in this&&(s[r]=o)}return this._components.get(We).list.set(this.guid,this),this}createComment(t,e){const s=new U0(this._components,t);return s.viewpoint=e,s.topic=this,this.comments.set(s.guid,s),s}createLabelTags(){const t=[...this.labels];if(this._components.get(We).config.exportCustomDataAsLabels)for(const s in this.customData){const i=this.customData[s];typeof i=="string"&&t.push(i)}return t}createCommentTags(){return[...this.comments.values()].map(t=>{var e;return{$Guid:t.guid,Date:t.date.toISOString(),Author:t.author,Comment:t.comment,ModifiedAuthor:t.modifiedAuthor,ModifiedDate:(e=t.modifiedDate)==null?void 0:e.toISOString(),Viewpoint:t.viewpoint?{$Guid:t.viewpoint}:void 0}})}createViewpointTags(){const t=this._components.get(xi);return[...this.viewpoints].map(s=>t.list.get(s)).filter(s=>s).map(s=>{const i={$Guid:s.guid,Viewpoint:`${s.title??s.guid}.bcfv`};if(t.snapshots.get(s.snapshot)){const o=t.getSnapshotExtension(s.snapshot);i.Snapshot=`${s.snapshot}.${o}`}return i})}createRelatedTopicTags(){return[...this.relatedTopics].map(t=>({$Guid:t}))}createDocumentReferencesTag(t=this._managerVersion){const e=[];if(!(t==="3"||t==="2.1"))return e;const s=this._components.get(We);for(const i of this.documentReferences){const r=s.documents.get(i);if(!r)continue;let o={$Guid:wi.create(),Description:r.description};t==="2.1"&&(o={...o,$isExternal:r.type==="external"?!0:void 0,ReferencedDocument:r.type==="external"?r.url:`../${r.fileName}`}),t==="3"&&(o={...o,DocumentGuid:r.type==="internal"?i:void 0,Url:r.type==="external"?r.url:void 0}),Object.keys(o).length>0&&e.push(o)}return e}toJSON(){var t,e;const s={guid:this.guid,server_assigned_id:this.serverAssignedId,topic_type:this.type,topic_status:this.status,title:this.title,priority:this.priority,index:this.index,labels:[...this.labels],creation_date:this.creationDate.toISOString(),creation_author:this.creationAuthor,modified_date:(t=this.modifiedDate)==null?void 0:t.toISOString(),modified_author:this.modifiedAuthor,assigned_to:this.assignedTo,stage:this.stage,description:this.description,due_date:(e=this.dueDate)==null?void 0:e.toISOString(),comments:[...this.comments].map(([o,a])=>a.toJSON()),relatedTopics:[...this.relatedTopics].map(o=>({related_topic_guid:o}))},i=this._components.get(xi);for(const o of this.viewpoints){const a=i.list.get(o);a&&(s.viewpoints||(s.viewpoints=[]),s.viewpoints.push(a.toJSON()))}const r=this._components.get(We);for(const o of this.documentReferences){const a=r.documents.get(o);a&&(s.document_references||(s.document_references=[]),a.type==="external"?s.document_references.push({guid:wi.create(),description:a.description,url:a.url}):s.document_references.push({guid:wi.create(),description:a.description,document_guid:o}))}for(const[o,a]of Object.entries(s))(a===void 0||Array.isArray(a)&&a.length===0)&&delete s[o];return s}serialize(){var t,e;const s=this._managerVersion,i={$Guid:this.guid,$TopicType:this.type,$TopicStatus:this.status,$ServerAssignedId:this.serverAssignedId,Title:this.title,CreationAuthor:this.creationAuthor,CreationDate:this.creationDate.toISOString(),Priority:this.priority,Index:s==="2.1"?this.index:void 0,ModifiedDate:(t=this.modifiedDate)==null?void 0:t.toISOString(),ModifiedAuthor:this.modifiedAuthor,DueDate:(e=this.dueDate)==null?void 0:e.toISOString(),AssignedTo:this.assignedTo,Description:this.description,Stage:this.stage,DocumentReferences:s==="3"?{DocumentReference:this.createDocumentReferencesTag(s)}:void 0,RelatedTopics:s==="3"?{RelatedTopic:this.createRelatedTopicTags()}:void 0,RelatedTopic:s==="2.1"?this.createRelatedTopicTags():void 0,Labels:s==="3"?{Label:this.createLabelTags()}:void 0,Viewpoints:s==="3"?{ViewPoint:this.createViewpointTags()}:void 0,Comments:s==="3"?{Comment:this.createCommentTags()}:void 0};s==="2.1"&&(i.Labels=this.createLabelTags(),i.DocumentReference=this.createDocumentReferencesTag(s));const r={Markup:{Topic:i}};return s==="2.1"&&(r.Markup.Viewpoints=this.createViewpointTags(),r.Markup.Comment=this.createCommentTags()),`<?xml version="1.0" encoding="UTF-8"?>
    ${xg.builder.build(r)}`}};k(sA,"default",{title:"BCF Topic",type:"Issue",status:"Active"});let Jn=sA;const fk=(n,t)=>{if(t.trim()==="")return;const e=We.xmlParser.parse(t).Extensions;if(!e)return;const{Priorities:s,TopicStatuses:i,TopicTypes:r,Users:o}=e;if(s&&s.Priority){const a=Array.isArray(s.Priority)?s.Priority:[s.Priority];for(const l of a)n.config.priorities.add(l)}if(i&&i.TopicStatus){const a=Array.isArray(i.TopicStatus)?i.TopicStatus:[i.TopicStatus];for(const l of a)n.config.statuses.add(l)}if(r&&r.TopicType){const a=Array.isArray(r.TopicType)?r.TopicType:[r.TopicType];for(const l of a)n.config.types.add(l)}if(o&&o.User){const a=Array.isArray(o.User)?o.User:[o.User];for(const l of a)n.config.users.add(l)}};class mk extends Ud{constructor(){super(...arguments),k(this,"_config",{version:{type:"Select",options:new Set(["2.1","3"]),multiple:!1,value:""},author:{type:"Text",value:""},types:{type:"TextSet",value:new Set},statuses:{type:"TextSet",value:new Set},priorities:{type:"TextSet",value:new Set},labels:{type:"TextSet",value:new Set},stages:{type:"TextSet",value:new Set},users:{type:"TextSet",value:new Set},includeSelectionTag:{type:"Boolean",value:!1},updateExtensionsOnImport:{type:"Boolean",value:!1},strict:{type:"Boolean",value:!1},includeAllExtensionsOnExport:{type:"Boolean",value:!1},fallbackVersionOnImport:{type:"Select",multiple:!1,options:new Set(["2.1","3"]),value:""},ignoreIncompleteTopicsOnImport:{type:"Boolean",value:!1},exportCustomDataAsLabels:{type:"Boolean",value:!1}})}get version(){return this._config.version.value}set version(t){this._config.version.value=t}get author(){return this._config.author.value}set author(t){this._config.author.value=t}get types(){return this._config.types.value}set types(t){this._config.types.value=t}get statuses(){return this._config.statuses.value}set statuses(t){this._config.statuses.value=t}get priorities(){return this._config.priorities.value}set priorities(t){this._config.priorities.value=t}get labels(){return this._config.labels.value}set labels(t){this._config.labels.value=t}get stages(){return this._config.stages.value}set stages(t){this._config.stages.value=t}get users(){return this._config.users.value}set users(t){this._config.users.value=t}get includeSelectionTag(){return this._config.includeSelectionTag.value}set includeSelectionTag(t){this._config.includeSelectionTag.value=t}get updateExtensionsOnImport(){return this._config.updateExtensionsOnImport.value}set updateExtensionsOnImport(t){this._config.updateExtensionsOnImport.value=t}get strict(){return this._config.strict.value}set strict(t){this._config.strict.value=t}get includeAllExtensionsOnExport(){return this._config.includeAllExtensionsOnExport.value}set includeAllExtensionsOnExport(t){this._config.includeAllExtensionsOnExport.value=t}get fallbackVersionOnImport(){return this._config.fallbackVersionOnImport.value}set fallbackVersionOnImport(t){this._config.fallbackVersionOnImport.value=t}get ignoreIncompleteTopicsOnImport(){return this._config.ignoreIncompleteTopicsOnImport.value}set ignoreIncompleteTopicsOnImport(t){this._config.ignoreIncompleteTopicsOnImport.value=t}get exportCustomDataAsLabels(){return this._config.exportCustomDataAsLabels.value}set exportCustomDataAsLabels(t){this._config.exportCustomDataAsLabels.value=t}}const fv=class wu extends Fs{constructor(){super(...arguments),k(this,"enabled",!1),k(this,"_defaultConfig",{author:"jhon.doe@example.com",version:"2.1",types:new Set(["Clash","Failure","Fault","Inquiry","Issue","Remark","Request"]),statuses:new Set(["Active","In Progress","Done","In Review","Closed"]),priorities:new Set(["On hold","Minor","Normal","Major","Critical"]),labels:new Set,stages:new Set,users:new Set,includeSelectionTag:!1,updateExtensionsOnImport:!0,strict:!1,includeAllExtensionsOnExport:!0,fallbackVersionOnImport:"2.1",ignoreIncompleteTopicsOnImport:!1,exportCustomDataAsLabels:!1}),k(this,"config",new mk(this,this.components,"BCF Topics",wu.uuid)),k(this,"list",new Ac),k(this,"documents",new Ac),k(this,"onSetup",new It),k(this,"isSetup",!1),k(this,"onBCFImported",new It),k(this,"onDisposed",new It)}setup(t){if(this.isSetup)return;const e={...this._defaultConfig,...t};this.config.version=e.version,this.config.author=e.author,this.config.types=e.types,this.config.statuses=e.statuses,this.config.priorities=e.priorities,this.config.labels=e.labels,this.config.stages=e.stages,this.config.users=e.users,this.config.includeSelectionTag=e.includeSelectionTag,this.config.updateExtensionsOnImport=e.updateExtensionsOnImport,this.config.strict=e.strict,this.config.includeAllExtensionsOnExport=e.includeAllExtensionsOnExport,this.config.fallbackVersionOnImport=e.fallbackVersionOnImport||"",this.config.ignoreIncompleteTopicsOnImport=e.ignoreIncompleteTopicsOnImport,this.isSetup=!0,this.enabled=!0,this.onSetup.trigger()}create(t){const e=new Jn(this.components);return t?(e.guid=t.guid??e.guid,e.set(t)):this.list.set(e.guid,e),e}dispose(){this.list.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}get usedTypes(){const t=[...this.list].map(([e,s])=>s.type);return new Set(t)}get usedStatuses(){const t=[...this.list].map(([e,s])=>s.status);return new Set(t)}get usedPriorities(){const t=[...this.list].map(([e,s])=>s.priority).filter(e=>e);return new Set(t)}get usedStages(){const t=[...this.list].map(([e,s])=>s.stage).filter(e=>e);return new Set(t)}get usedUsers(){const t=[];for(const[e,s]of this.list){t.push(s.creationAuthor),s.assignedTo&&t.push(s.assignedTo),s.modifiedAuthor&&t.push(s.modifiedAuthor);for(const[i,r]of s.comments)t.push(r.author),r.modifiedAuthor&&t.push(r.modifiedAuthor)}return new Set(t)}get usedLabels(){const t=[];for(const[e,s]of this.list)t.push(...s.labels);return new Set(t)}updateExtensions(){for(const[t,e]of this.list){for(const s of e.labels)this.config.labels.add(s);this.config.types.add(e.type),e.priority&&this.config.priorities.add(e.priority),e.stage&&this.config.stages.add(e.stage),this.config.statuses.add(e.status),this.config.users.add(e.creationAuthor),e.assignedTo&&this.config.users.add(e.assignedTo),e.modifiedAuthor&&this.config.users.add(e.modifiedAuthor);for(const[s,i]of e.comments)this.config.users.add(i.author),i.modifiedAuthor&&this.config.users.add(i.modifiedAuthor)}}updateViewpointReferences(){const t=this.components.get(xi);for(const[e,s]of this.list)for(const i of s.viewpoints)t.list.has(i)||s.viewpoints.delete(i)}async export(t=this.list.values()){const e=new K1;e.file("bcf.version",`<?xml version="1.0" encoding="UTF-8"?>
    <Version VersionId="${this.config.version}" xsi:noNamespaceSchemaLocation="https://raw.githubusercontent.com/buildingSMART/BCF-XML/release_3_0/Schemas/version.xsd"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    </Version>`);for(const[r,o]of this.documents.entries())o.type!=="external"&&e.file(this.config.version==="2.1"?o.fileName:`documents/${r}`,o.data);if(this.config.version==="3"){const r=[];for(const[o,a]of this.documents.entries()){const{type:l,description:c}=a;l!=="external"&&r.push(`<Document Guid="${o}">
        <Filename>${a.fileName}</Filename>
        ${c?`<Description>${c}</Description>`:""}
      </Document>`)}r.length>0&&e.file("documents.xml",`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
  <DocumentInfo xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="documents.xsd">
    <Documents>
      ${r.join(`
`)}
    </Documents>
  </DocumentInfo>`)}e.file("bcf.extensions",this.serializeExtensions());const s=this.components.get(xi);for(const r of t){const o=e.folder(r.guid);o.file("markup.bcf",r.serialize());for(const a of r.viewpoints){const l=s.list.get(a);if(!l)continue;const c=l.title??l.guid;o.file(`${c}.bcfv`,await l.serialize());const h=s.snapshots.get(l.snapshot);if(!h)continue;const u=h?l.snapshot:l.guid,p=s.getSnapshotExtension(l.snapshot);o.file(`${u}.${p}`,h,{binary:!0})}}return await e.generateAsync({type:"blob"})}serializeExtensions(){const t=[...this.config.types].map(a=>`<TopicType>${a}</TopicType>`).join(`
`),e=[...this.config.statuses].map(a=>`<TopicStatus>${a}</TopicStatus>`).join(`
`),s=[...this.config.priorities].map(a=>`<Priority>${a}</Priority>`).join(`
`),i=[...this.config.labels].map(a=>`<TopicLabel>${a}</TopicLabel>`).join(`
`),r=[...this.config.stages].map(a=>`<Stage>${a}</Stage>`).join(`
`),o=[...this.config.users].map(a=>`<User>${a}</User>`).join(`
`);return`
      <?xml version="1.0" encoding="UTF-8"?>
      <Extensions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="your-schema-location.xsd">
        ${t.length!==0?`<TopicTypes>
${t}
</TopicTypes>`:""}
        ${e.length!==0?`<TopicStatuses>
${e}
</TopicStatuses>`:""}
        ${s.length!==0?`<Priorities>
${s}
</Priorities>`:""}
        ${i.length!==0?`<TopicLabels>
${i}
</TopicLabels>`:""}
        ${r.length!==0?`<Stages>
${r}
</Stages>`:""}
        ${o.length!==0?`<Users>
${o}
</Users>`:""}
      </Extensions>
    `}processMarkupComment(t){const{Guid:e,Date:s,Author:i,Comment:r,Viewpoint:o}=t;if(!(e&&s&&i&&(U0||o)))return null;const a=new U0(this.components,r??"");return a.guid=e,a.date=new Date(s),a.author=i,a.viewpoint=o?.Guid,a.modifiedAuthor=t.ModifiedAuthor,a.modifiedDate=t.ModifiedDate?new Date(t.ModifiedDate):void 0,a}getMarkupComments(t,e){var s;let i;if(e==="2.1"&&(i=t.Comment),e==="3"&&(i=(s=t.Topic.Comments)==null?void 0:s.Comment),!i)return[];i=Array.isArray(i)?i:[i];const r=i.map(a=>this.processMarkupComment(a)).filter(a=>a);return Array.isArray(r)?r:[r]}getMarkupLabels(t,e){var s;let i;return e==="2.1"&&(i=t.Topic.Labels),e==="3"&&(i=(s=t.Topic.Labels)==null?void 0:s.Label),i?Array.isArray(i)?i:[i]:[]}getMarkupViewpoints(t,e){var s;let i;return e==="2.1"&&(i=t.Viewpoints),e==="3"&&(i=(s=t.Topic.Viewpoints)==null?void 0:s.ViewPoint),i?(i=Array.isArray(i)?i:[i],i):[]}getMarkupRelatedTopics(t,e){var s;let i;return e==="2.1"&&(i=t.Topic.RelatedTopic),e==="3"&&(i=(s=t.Topic.RelatedTopics)==null?void 0:s.RelatedTopic),i?(Array.isArray(i)?i:[i]).map(o=>o.Guid):[]}getMarkupDocumentReferences(t,e){var s;let i;return e==="2.1"&&(i=t.Topic.DocumentReference),e==="3"&&(i=(s=t.Topic.DocumentReferences)==null?void 0:s.DocumentReference),i?Array.isArray(i)?i:[i]:[]}async load(t){var e,s,i;const{fallbackVersionOnImport:r,ignoreIncompleteTopicsOnImport:o,updateExtensionsOnImport:a}=this.config,l=new K1;await l.loadAsync(t);const c=Object.values(l.files);let h=r;const u=c.find(w=>w.name.endsWith(".version"));if(u){const w=await u.async("string"),I=wu.xmlParser.parse(w).Version.VersionId;h=String(I)}if(!(h&&(h==="2.1"||h==="3")))throw new Error(`BCFTopics: ${h} is not supported.`);const p=c.find(w=>w.name.endsWith(".extensions"));if(a&&p){const w=await p.async("string");fk(this,w)}const d=[],g=this.components.get(xi),m=c.filter(w=>w.name.endsWith(".bcfv"));for(const w of m){const I=await w.async("string"),C=wu.xmlParser.parse(I).VisualizationInfo;if(!C){console.warn("Missing VisualizationInfo in Viewpoint");continue}const A={},{Guid:S,ClippingPlanes:P,Components:M,OrthogonalCamera:T,PerspectiveCamera:L}=C;if(S&&(A.guid=S),M){const N={selection:[],coloring:[],visibility:{default_visibility:!1,exceptions:[],view_setup_hints:{spaces_visible:!1,space_boundaries_visible:!1,openings_visible:!1}}};A.components=N;const{Selection:W,Visibility:V}=M;if(W&&W.Component){const nt=Array.isArray(W.Component)?W.Component:[W.Component];N.selection=nt.map(H=>H.IfcGuid?{ifc_guid:H.IfcGuid}:null).filter(H=>H!==null)}if(V&&"DefaultVisibility"in V&&(N.visibility.default_visibility=V.DefaultVisibility),V&&V.Exceptions&&"Component"in V.Exceptions){const{Component:nt}=V.Exceptions,H=Array.isArray(nt)?nt:[nt];N.visibility.exceptions=H.map(B=>B.IfcGuid?{ifc_guid:B.IfcGuid}:null).filter(B=>B!==null)}let et;h==="2.1"&&(et=M.ViewSetupHints),h==="3"&&(et=(e=M.Visibility)==null?void 0:e.ViewSetupHints),et&&("OpeningsVisible"in et&&(N.visibility.view_setup_hints.openings_visible=et.OpeningsVisible),"SpacesVisible"in et&&(N.visibility.view_setup_hints.spaces_visible=et.SpacesVisible),"SpaceBoundariesVisible"in et&&(N.visibility.view_setup_hints.space_boundaries_visible=et.SpaceBoundariesVisible));const{Coloring:j}=M;if(j&&j.Color){const nt=Array.isArray(j.Color)?j.Color:[j.Color];for(const H of nt){const{Color:B,Component:rt}=H;if(!(B.length===6||B.length===8))continue;const Q=B.length===6?B:B.slice(2),ct=(Array.isArray(rt)?rt:[rt]).map(_t=>_t.IfcGuid?{ifc_guid:_t.IfcGuid}:null).filter(_t=>_t!==null);N.coloring.push({color:Q,components:ct})}}}if(T||L){const N=C.PerspectiveCamera??C.OrthogonalCamera,{CameraViewPoint:W,CameraDirection:V}=N,et=new F(Number(W.X),Number(W.Z),Number(-W.Y)),j=new F(Number(V.X),Number(V.Z),Number(-V.Y)),nt={camera_view_point:{x:et.x,y:et.y,z:et.z},camera_direction:{x:j.x,y:j.y,z:j.z},aspect_ratio:"AspectRatio"in N?N.AspectRatio:1,camera_up_vector:{x:0,y:0,z:0}};"ViewToWorldScale"in N&&(A.orthogonal_camera={...nt,view_to_world_scale:N.ViewToWorldScale}),"FieldOfView"in N&&(A.perspective_camera={...nt,field_of_view:N.FieldOfView})}if(P){const W=(Array.isArray(P.ClippingPlane)?P.ClippingPlane:[P.ClippingPlane]).map(({Location:V,Direction:et})=>({location:{x:V.x,y:V.y,z:V.z},direction:{x:et.x,y:et.y,z:et.z}}));A.clipping_planes=W}const E=new nA(this.components,A);d.push(E)}const b=w=>{const I=w.split("/"),C=I[I.length-1].split(".");return C.pop(),C.join(".")},f=c.filter(w=>w.name.endsWith(".png")||w.name.endsWith(".jpeg"));for(const w of f){const I=b(w.name),C=await w.async("arraybuffer"),A=new Uint8Array(C);g.snapshots.set(I,A)}const _={},y=[],v=c.filter(w=>w.name.endsWith(".bcf"));for(const w of v){const I=await w.async("string"),C=wu.xmlParser.parse(I).Markup,A=C.Topic,{Guid:S,TopicType:P,TopicStatus:M,Title:T,CreationDate:L,CreationAuthor:E}=A;if(o&&!(S&&P&&M&&T&&L&&E))continue;const N=new Jn(this.components);N.guid=S??N.guid;const W=this.getMarkupRelatedTopics(C,h);_[N.guid]=new Set(W),N.type=P??N.type,N.status=M??N.status,N.title=T??N.title,N.creationDate=L?new Date(L):N.creationDate,N.creationAuthor=E??N.creationAuthor,N.serverAssignedId=A.ServerAssignedId,N.priority=A.Priority,N.index=A.Index,N.modifiedDate=A.ModifiedDate?new Date(A.ModifiedDate):void 0,N.modifiedAuthor=A.ModifiedAuthor,N.dueDate=A.DueDate?new Date(A.DueDate):void 0,N.assignedTo=A.AssignedTo,N.description=A.Description,N.stage=A.Stage;const V=this.getMarkupLabels(C,h);for(const Q of V)N.labels.add(Q);const et=this.getMarkupComments(C,h);for(const Q of et)N.comments.set(Q.guid,Q);const j=this.getMarkupViewpoints(C,h);for(const Q of j){if(!(Q&&Q.Guid))continue;const st=g.list.get(Q.Guid);if(st){N.viewpoints.add(st.guid);const ct=b(Q.Snapshot);st.snapshot=ct??null}}const nt=this.getMarkupDocumentReferences(C,h),H=c.find(Q=>Q.name==="documents.xml");let B=[];const rt=await H?.async("string");if(rt){const Q=(i=(s=xg.parser.parse(rt).DocumentInfo)==null?void 0:s.Documents)==null?void 0:i.Document;B=Array.isArray(Q)?Q:[Q]}for(const Q of nt){const{Description:st,DocumentGuid:ct,Url:_t,isExternal:ut,ReferencedDocument:pt}=Q;if(ct&&B.length>0){const bt=B.find(({Guid:Z})=>Z===ct),wt=c.find(Z=>Z.name.endsWith(ct)),St=await wt?.async("uint8array");if(!(bt&&St))continue;const{Description:Rt,Filename:x}=bt;this.documents.set(ct,{type:"internal",fileName:x,description:Rt,data:St}),N.documentReferences.add(ct)}if(_t){const bt=this.documents.add({type:"external",url:_t,description:st});N.documentReferences.add(bt)}if(pt){let bt=null;if(ut)bt=this.documents.add({type:"external",url:pt,description:st});else{const wt=pt.split("/"),St=wt[wt.length-1],Rt=c.find(Z=>Z.name.endsWith(St)),x=await Rt?.async("uint8array");if(!x)continue;bt=this.documents.add({type:"internal",fileName:St,data:x,description:st})}N.documentReferences.add(bt)}}this.list.set(N.guid,N),y.push(N)}for(const w in _){const I=this.list.get(w);if(!I)continue;const C=_[w];for(const A of C)I.relatedTopics.add(A)}return this.onBCFImported.trigger(y),{viewpoints:d,topics:y}}};k(fv,"uuid","de977976-e4f6-4e4f-a01a-204727839802");k(fv,"xmlParser",new Eg.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",ignoreAttributes:!1,ignoreDeclaration:!0,ignorePiTags:!0,numberParseOptions:{leadingZeros:!0,hex:!0},parseAttributeValue:!0,preserveOrder:!1,processEntities:!1,removeNSPrefix:!0,trimValues:!0}));let We=fv;const aa=new el,Ns=new F,to=new F,Ae=new Pe,J1={X:new F(1,0,0),Y:new F(0,1,0),Z:new F(0,0,1)},o_={type:"change"},tE={type:"mouseDown",mode:null},eE={type:"mouseUp",mode:null},sE={type:"objectChange"};class gk extends dC{constructor(t,e=null){super(void 0,e);const s=new Ek(this);this._root=s;const i=new xk;this._gizmo=i,s.add(i);const r=new Ik;this._plane=r,s.add(r);const o=this;function a(y,v){let w=v;Object.defineProperty(o,y,{get:function(){return w!==void 0?w:v},set:function(I){w!==I&&(w=I,r[y]=I,i[y]=I,o.dispatchEvent({type:y+"-changed",value:I}),o.dispatchEvent(o_))}}),o[y]=v,r[y]=v,i[y]=v}a("camera",t),a("object",void 0),a("enabled",!0),a("axis",null),a("mode","translate"),a("translationSnap",null),a("rotationSnap",null),a("scaleSnap",null),a("space","world"),a("size",1),a("dragging",!1),a("showX",!0),a("showY",!0),a("showZ",!0),a("minX",-1/0),a("maxX",1/0),a("minY",-1/0),a("maxY",1/0),a("minZ",-1/0),a("maxZ",1/0);const l=new F,c=new F,h=new Pe,u=new Pe,p=new F,d=new Pe,g=new F,m=new F,b=new F,f=0,_=new F;a("worldPosition",l),a("worldPositionStart",c),a("worldQuaternion",h),a("worldQuaternionStart",u),a("cameraPosition",p),a("cameraQuaternion",d),a("pointStart",g),a("pointEnd",m),a("rotationAxis",b),a("rotationAngle",f),a("eye",_),this._offset=new F,this._startNorm=new F,this._endNorm=new F,this._cameraScale=new F,this._parentPosition=new F,this._parentQuaternion=new Pe,this._parentQuaternionInv=new Pe,this._parentScale=new F,this._worldScaleStart=new F,this._worldQuaternionInv=new Pe,this._worldScale=new F,this._positionStart=new F,this._quaternionStart=new Pe,this._scaleStart=new F,this._getPointer=bk.bind(this),this._onPointerDown=yk.bind(this),this._onPointerHover=_k.bind(this),this._onPointerMove=vk.bind(this),this._onPointerUp=wk.bind(this),e!==null&&this.connect(e)}connect(t){super.connect(t),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="auto"}getHelper(){return this._root}pointerHover(t){if(this.object===void 0||this.dragging===!0)return;t!==null&&aa.setFromCamera(t,this.camera);const e=a_(this._gizmo.picker[this.mode],aa);e?this.axis=e.object.name:this.axis=null}pointerDown(t){if(!(this.object===void 0||this.dragging===!0||t!=null&&t.button!==0)&&this.axis!==null){t!==null&&aa.setFromCamera(t,this.camera);const e=a_(this._plane,aa,!0);e&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(e.point).sub(this.worldPositionStart)),this.dragging=!0,tE.mode=this.mode,this.dispatchEvent(tE)}}pointerMove(t){const e=this.axis,s=this.mode,i=this.object;let r=this.space;if(s==="scale"?r="local":(e==="E"||e==="XYZE"||e==="XYZ")&&(r="world"),i===void 0||e===null||this.dragging===!1||t!==null&&t.button!==-1)return;t!==null&&aa.setFromCamera(t,this.camera);const o=a_(this._plane,aa,!0);if(o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),s==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),r==="local"&&e!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),e.indexOf("X")===-1&&(this._offset.x=0),e.indexOf("Y")===-1&&(this._offset.y=0),e.indexOf("Z")===-1&&(this._offset.z=0),r==="local"&&e!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(r==="local"&&(i.position.applyQuaternion(Ae.copy(this._quaternionStart).invert()),e.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),e.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),e.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),r==="world"&&(i.parent&&i.position.add(Ns.setFromMatrixPosition(i.parent.matrixWorld)),e.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),e.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),e.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(Ns.setFromMatrixPosition(i.parent.matrixWorld)))),i.position.x=Math.max(this.minX,Math.min(this.maxX,i.position.x)),i.position.y=Math.max(this.minY,Math.min(this.maxY,i.position.y)),i.position.z=Math.max(this.minZ,Math.min(this.maxZ,i.position.z));else if(s==="scale"){if(e.search("XYZ")!==-1){let a=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(a*=-1),to.set(a,a,a)}else Ns.copy(this.pointStart),to.copy(this.pointEnd),Ns.applyQuaternion(this._worldQuaternionInv),to.applyQuaternion(this._worldQuaternionInv),to.divide(Ns),e.search("X")===-1&&(to.x=1),e.search("Y")===-1&&(to.y=1),e.search("Z")===-1&&(to.z=1);i.scale.copy(this._scaleStart).multiply(to),this.scaleSnap&&(e.search("X")!==-1&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),e.search("Y")!==-1&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),e.search("Z")!==-1&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(s==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const a=20/this.worldPosition.distanceTo(Ns.setFromMatrixPosition(this.camera.matrixWorld));let l=!1;e==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Ns.copy(this.rotationAxis).cross(this.eye))*a):(e==="X"||e==="Y"||e==="Z")&&(this.rotationAxis.copy(J1[e]),Ns.copy(J1[e]),r==="local"&&Ns.applyQuaternion(this.worldQuaternion),Ns.cross(this.eye),Ns.length()===0?l=!0:this.rotationAngle=this._offset.dot(Ns.normalize())*a),(e==="E"||l)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),r==="local"&&e!=="E"&&e!=="XYZE"?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(Ae.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(Ae.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(o_),this.dispatchEvent(sE)}}pointerUp(t){t!==null&&t.button!==0||(this.dragging&&this.axis!==null&&(eE.mode=this.mode,this.dispatchEvent(eE)),this.dragging=!1,this.axis=null)}dispose(){this.disconnect(),this._root.dispose()}attach(t){return this.object=t,this._root.visible=!0,this}detach(){return this.object=void 0,this.axis=null,this._root.visible=!1,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(o_),this.dispatchEvent(sE),this.pointStart.copy(this.pointEnd))}getRaycaster(){return aa}getMode(){return this.mode}setMode(t){this.mode=t}setTranslationSnap(t){this.translationSnap=t}setRotationSnap(t){this.rotationSnap=t}setScaleSnap(t){this.scaleSnap=t}setSize(t){this.size=t}setSpace(t){this.space=t}}function bk(n){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:n.button};{const t=this.domElement.getBoundingClientRect();return{x:(n.clientX-t.left)/t.width*2-1,y:-(n.clientY-t.top)/t.height*2+1,button:n.button}}}function _k(n){if(this.enabled)switch(n.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(n));break}}function yk(n){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(n)),this.pointerDown(this._getPointer(n)))}function vk(n){this.enabled&&this.pointerMove(this._getPointer(n))}function wk(n){this.enabled&&(this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(n)))}function a_(n,t,e){const s=t.intersectObject(n,!0);for(let i=0;i<s.length;i++)if(s[i].object.visible||e)return s[i];return!1}const df=new fC,de=new F(0,1,0),iE=new F(0,0,0),nE=new xt,pf=new Pe,lm=new Pe,Wn=new F,rE=new xt,Eu=new F(1,0,0),ya=new F(0,1,0),xu=new F(0,0,1),ff=new F,Bh=new F,Uh=new F;class Ek extends Oi{constructor(t){super(),this.isTransformControlsRoot=!0,this.controls=t,this.visible=!1}updateMatrixWorld(t){const e=this.controls;e.object!==void 0&&(e.object.updateMatrixWorld(),e.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):e.object.parent.matrixWorld.decompose(e._parentPosition,e._parentQuaternion,e._parentScale),e.object.matrixWorld.decompose(e.worldPosition,e.worldQuaternion,e._worldScale),e._parentQuaternionInv.copy(e._parentQuaternion).invert(),e._worldQuaternionInv.copy(e.worldQuaternion).invert()),e.camera.updateMatrixWorld(),e.camera.matrixWorld.decompose(e.cameraPosition,e.cameraQuaternion,e._cameraScale),e.camera.isOrthographicCamera?e.camera.getWorldDirection(e.eye).negate():e.eye.copy(e.cameraPosition).sub(e.worldPosition).normalize(),super.updateMatrixWorld(t)}dispose(){this.traverse(function(t){t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()})}}class xk extends Oi{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const t=new qr({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),e=new dg({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),s=t.clone();s.opacity=.15;const i=e.clone();i.opacity=.5;const r=t.clone();r.color.setHex(16711680);const o=t.clone();o.color.setHex(65280);const a=t.clone();a.color.setHex(255);const l=t.clone();l.color.setHex(16711680),l.opacity=.5;const c=t.clone();c.color.setHex(65280),c.opacity=.5;const h=t.clone();h.color.setHex(255),h.opacity=.5;const u=t.clone();u.opacity=.25;const p=t.clone();p.color.setHex(16776960),p.opacity=.25,t.clone().color.setHex(16776960);const g=t.clone();g.color.setHex(7895160);const m=new re(0,.04,.1,12);m.translate(0,.05,0);const b=new ee(.08,.08,.08);b.translate(0,.04,0);const f=new Ce;f.setAttribute("position",new Si([0,0,0,1,0,0],3));const _=new re(.0075,.0075,.5,3);_.translate(0,.25,0);function y(N,W){const V=new ar(N,.0075,3,64,W*Math.PI*2);return V.rotateY(Math.PI/2),V.rotateX(Math.PI/2),V}function v(){const N=new Ce;return N.setAttribute("position",new Si([0,0,0,1,1,1],3)),N}const w={X:[[new ht(m,r),[.5,0,0],[0,0,-Math.PI/2]],[new ht(m,r),[-.5,0,0],[0,0,Math.PI/2]],[new ht(_,r),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new ht(m,o),[0,.5,0]],[new ht(m,o),[0,-.5,0],[Math.PI,0,0]],[new ht(_,o)]],Z:[[new ht(m,a),[0,0,.5],[Math.PI/2,0,0]],[new ht(m,a),[0,0,-.5],[-Math.PI/2,0,0]],[new ht(_,a),null,[Math.PI/2,0,0]]],XYZ:[[new ht(new xo(.1,0),u.clone()),[0,0,0]]],XY:[[new ht(new ee(.15,.15,.01),h.clone()),[.15,.15,0]]],YZ:[[new ht(new ee(.15,.15,.01),l.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ht(new ee(.15,.15,.01),c.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},I={X:[[new ht(new re(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new ht(new re(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new ht(new re(.2,0,.6,4),s),[0,.3,0]],[new ht(new re(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new ht(new re(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new ht(new re(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new ht(new xo(.2,0),s)]],XY:[[new ht(new ee(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new ht(new ee(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ht(new ee(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]]},C={START:[[new ht(new xo(.01,2),i),null,null,null,"helper"]],END:[[new ht(new xo(.01,2),i),null,null,null,"helper"]],DELTA:[[new fs(v(),i),null,null,null,"helper"]],X:[[new fs(f,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new fs(f,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new fs(f,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},A={XYZE:[[new ht(y(.5,1),g),null,[0,Math.PI/2,0]]],X:[[new ht(y(.5,.5),r)]],Y:[[new ht(y(.5,.5),o),null,[0,0,-Math.PI/2]]],Z:[[new ht(y(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new ht(y(.75,1),p),null,[0,Math.PI/2,0]]]},S={AXIS:[[new fs(f,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},P={XYZE:[[new ht(new pC(.25,10,8),s)]],X:[[new ht(new ar(.5,.1,4,24),s),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new ht(new ar(.5,.1,4,24),s),[0,0,0],[Math.PI/2,0,0]]],Z:[[new ht(new ar(.5,.1,4,24),s),[0,0,0],[0,0,-Math.PI/2]]],E:[[new ht(new ar(.75,.1,2,24),s)]]},M={X:[[new ht(b,r),[.5,0,0],[0,0,-Math.PI/2]],[new ht(_,r),[0,0,0],[0,0,-Math.PI/2]],[new ht(b,r),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new ht(b,o),[0,.5,0]],[new ht(_,o)],[new ht(b,o),[0,-.5,0],[0,0,Math.PI]]],Z:[[new ht(b,a),[0,0,.5],[Math.PI/2,0,0]],[new ht(_,a),[0,0,0],[Math.PI/2,0,0]],[new ht(b,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new ht(new ee(.15,.15,.01),h),[.15,.15,0]]],YZ:[[new ht(new ee(.15,.15,.01),l),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ht(new ee(.15,.15,.01),c),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new ht(new ee(.1,.1,.1),u.clone())]]},T={X:[[new ht(new re(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new ht(new re(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new ht(new re(.2,0,.6,4),s),[0,.3,0]],[new ht(new re(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new ht(new re(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new ht(new re(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new ht(new ee(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new ht(new ee(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ht(new ee(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new ht(new ee(.2,.2,.2),s),[0,0,0]]]},L={X:[[new fs(f,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new fs(f,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new fs(f,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function E(N){const W=new Oi;for(const V in N)for(let et=N[V].length;et--;){const j=N[V][et][0].clone(),nt=N[V][et][1],H=N[V][et][2],B=N[V][et][3],rt=N[V][et][4];j.name=V,j.tag=rt,nt&&j.position.set(nt[0],nt[1],nt[2]),H&&j.rotation.set(H[0],H[1],H[2]),B&&j.scale.set(B[0],B[1],B[2]),j.updateMatrix();const Q=j.geometry.clone();Q.applyMatrix4(j.matrix),j.geometry=Q,j.renderOrder=1/0,j.position.set(0,0,0),j.rotation.set(0,0,0),j.scale.set(1,1,1),W.add(j)}return W}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=E(w)),this.add(this.gizmo.rotate=E(A)),this.add(this.gizmo.scale=E(M)),this.add(this.picker.translate=E(I)),this.add(this.picker.rotate=E(P)),this.add(this.picker.scale=E(T)),this.add(this.helper.translate=E(C)),this.add(this.helper.rotate=E(S)),this.add(this.helper.scale=E(L)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(t){const s=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:lm;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let i=[];i=i.concat(this.picker[this.mode].children),i=i.concat(this.gizmo[this.mode].children),i=i.concat(this.helper[this.mode].children);for(let r=0;r<i.length;r++){const o=i[r];o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.worldPosition);let a;if(this.camera.isOrthographicCamera?a=(this.camera.top-this.camera.bottom)/this.camera.zoom:a=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),o.scale.set(1,1,1).multiplyScalar(a*this.size/4),o.tag==="helper"){o.visible=!1,o.name==="AXIS"?(o.visible=!!this.axis,this.axis==="X"&&(Ae.setFromEuler(df.set(0,0,0)),o.quaternion.copy(s).multiply(Ae),Math.abs(de.copy(Eu).applyQuaternion(s).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Y"&&(Ae.setFromEuler(df.set(0,0,Math.PI/2)),o.quaternion.copy(s).multiply(Ae),Math.abs(de.copy(ya).applyQuaternion(s).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Z"&&(Ae.setFromEuler(df.set(0,Math.PI/2,0)),o.quaternion.copy(s).multiply(Ae),Math.abs(de.copy(xu).applyQuaternion(s).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="XYZE"&&(Ae.setFromEuler(df.set(0,Math.PI/2,0)),de.copy(this.rotationAxis),o.quaternion.setFromRotationMatrix(nE.lookAt(iE,de,ya)),o.quaternion.multiply(Ae),o.visible=this.dragging),this.axis==="E"&&(o.visible=!1)):o.name==="START"?(o.position.copy(this.worldPositionStart),o.visible=this.dragging):o.name==="END"?(o.position.copy(this.worldPosition),o.visible=this.dragging):o.name==="DELTA"?(o.position.copy(this.worldPositionStart),o.quaternion.copy(this.worldQuaternionStart),Ns.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Ns.applyQuaternion(this.worldQuaternionStart.clone().invert()),o.scale.copy(Ns),o.visible=this.dragging):(o.quaternion.copy(s),this.dragging?o.position.copy(this.worldPositionStart):o.position.copy(this.worldPosition),this.axis&&(o.visible=this.axis.search(o.name)!==-1));continue}o.quaternion.copy(s),this.mode==="translate"||this.mode==="scale"?(o.name==="X"&&Math.abs(de.copy(Eu).applyQuaternion(s).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Y"&&Math.abs(de.copy(ya).applyQuaternion(s).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Z"&&Math.abs(de.copy(xu).applyQuaternion(s).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XY"&&Math.abs(de.copy(xu).applyQuaternion(s).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="YZ"&&Math.abs(de.copy(Eu).applyQuaternion(s).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XZ"&&Math.abs(de.copy(ya).applyQuaternion(s).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1)):this.mode==="rotate"&&(pf.copy(s),de.copy(this.eye).applyQuaternion(Ae.copy(s).invert()),o.name.search("E")!==-1&&o.quaternion.setFromRotationMatrix(nE.lookAt(this.eye,iE,ya)),o.name==="X"&&(Ae.setFromAxisAngle(Eu,Math.atan2(-de.y,de.z)),Ae.multiplyQuaternions(pf,Ae),o.quaternion.copy(Ae)),o.name==="Y"&&(Ae.setFromAxisAngle(ya,Math.atan2(de.x,de.z)),Ae.multiplyQuaternions(pf,Ae),o.quaternion.copy(Ae)),o.name==="Z"&&(Ae.setFromAxisAngle(xu,Math.atan2(de.y,de.x)),Ae.multiplyQuaternions(pf,Ae),o.quaternion.copy(Ae))),o.visible=o.visible&&(o.name.indexOf("X")===-1||this.showX),o.visible=o.visible&&(o.name.indexOf("Y")===-1||this.showY),o.visible=o.visible&&(o.name.indexOf("Z")===-1||this.showZ),o.visible=o.visible&&(o.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),o.material._color=o.material._color||o.material.color.clone(),o.material._opacity=o.material._opacity||o.material.opacity,o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.enabled&&this.axis&&(o.name===this.axis||this.axis.split("").some(function(l){return o.name===l}))&&(o.material.color.setHex(16776960),o.material.opacity=1)}super.updateMatrixWorld(t)}}class Ik extends ht{constructor(){super(new Zc(1e5,1e5,2,2),new qr({visible:!1,wireframe:!0,side:Pi,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(t){let e=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(e="local"),ff.copy(Eu).applyQuaternion(e==="local"?this.worldQuaternion:lm),Bh.copy(ya).applyQuaternion(e==="local"?this.worldQuaternion:lm),Uh.copy(xu).applyQuaternion(e==="local"?this.worldQuaternion:lm),de.copy(Bh),this.mode){case"translate":case"scale":switch(this.axis){case"X":de.copy(this.eye).cross(ff),Wn.copy(ff).cross(de);break;case"Y":de.copy(this.eye).cross(Bh),Wn.copy(Bh).cross(de);break;case"Z":de.copy(this.eye).cross(Uh),Wn.copy(Uh).cross(de);break;case"XY":Wn.copy(Uh);break;case"YZ":Wn.copy(ff);break;case"XZ":de.copy(Uh),Wn.copy(Bh);break;case"XYZ":case"E":Wn.set(0,0,0);break}break;case"rotate":default:Wn.set(0,0,0)}Wn.length()===0?this.quaternion.copy(this.cameraQuaternion):(rE.lookAt(Ns.set(0,0,0),Wn,de),this.quaternion.setFromRotationMatrix(rE)),super.updateMatrixWorld(t)}}class mv{constructor(t,e,s,i,r,o=5,a=!0){if(k(this,"onDraggingStarted",new It),k(this,"onDraggingEnded",new It),k(this,"onDisposed",new It),k(this,"normal"),k(this,"origin"),k(this,"three",new Wt),k(this,"components"),k(this,"world"),k(this,"type","default"),k(this,"_title","Clipping Plane"),k(this,"_helper"),k(this,"_visible",!0),k(this,"_enabled",!0),k(this,"_controlsActive",!1),k(this,"_arrowBoundBox",new ht),k(this,"_planeMesh"),k(this,"_controls"),k(this,"_hiddenMaterial",new qr({visible:!1})),k(this,"_visibilityBeforeDisabled",!0),k(this,"notifyManager",()=>{const l=this.components.get(nc),c=l.list.getKey(this);c&&l.list.set(c,this)}),k(this,"update",()=>{this._enabled&&this.three.setFromNormalAndCoplanarPoint(this.normal,this._helper.position)}),k(this,"changeDrag",l=>{this._visible=!l.value,this.preventCameraMovement(),this.notifyDraggingChanged(l)}),this.components=t,this.world=e,!e.renderer)throw new Error("The given world must have a renderer!");this.normal=i,this.origin=s,e.renderer.setPlane(!0,this.three),this._planeMesh=mv.newPlaneMesh(o,r),this._helper=this.newHelper(),this._controls=this.newTransformControls(),this.three.setFromNormalAndCoplanarPoint(i,s),a&&this.toggleControls(!0)}set title(t){this._title=t,this.notifyManager()}get title(){return this._title}get enabled(){return this._enabled}set enabled(t){if(!this.world.isDisposing){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");this._enabled=t,t?this.visible=this._visibilityBeforeDisabled:(this._visibilityBeforeDisabled=this.visible,this.visible=!1),this.world.renderer.setPlane(t,this.three),this.notifyManager()}}get visible(){return this._visible}set visible(t){this._visible=t,this._controls.getHelper().visible=t,this._helper.visible=t,this.toggleControls(t),this.notifyManager()}get meshes(){return[this._planeMesh,this._arrowBoundBox]}get planeMaterial(){return this._planeMesh.material}set planeMaterial(t){this._planeMesh.material=t}get size(){return this._planeMesh.scale.x}set size(t){this._planeMesh.scale.set(t,t,t)}get helper(){return this._helper}setFromNormalAndCoplanarPoint(t,e){this.reset(),this.normal.equals(t)||(this.normal.copy(t),this._helper.lookAt(t)),this.origin.copy(e),this._helper.position.copy(e),this._helper.updateMatrix(),this.update()}dispose(){this._enabled=!1,this.onDraggingStarted.reset(),this.onDraggingEnded.reset(),this._helper.removeFromParent(),this.world.renderer&&this.world.renderer.setPlane(!1,this.three),this._arrowBoundBox.removeFromParent(),this._arrowBoundBox.geometry.dispose(),this._planeMesh.geometry.dispose(),this._controls.getHelper().removeFromParent(),this._controls.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}reset(){const t=new F(1,0,0),e=new F;this.normal.equals(t)||(this.normal.copy(t),this._helper.lookAt(t)),this.origin.copy(e),this._helper.position.copy(e),this._helper.updateMatrix()}toggleControls(t){if(t){if(this._controlsActive)return;this._controls.addEventListener("change",this.update),this._controls.addEventListener("dragging-changed",this.changeDrag)}else this._controls.removeEventListener("change",this.update),this._controls.removeEventListener("dragging-changed",this.changeDrag);this._controlsActive=t}newTransformControls(){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");const t=this.world.camera.three,e=this.world.renderer.three.domElement,s=new gk(t,e);return this.initializeControls(s),this.world.scene.three.add(s.getHelper()),s}initializeControls(t){t.attach(this._helper),t.showX=!1,t.showY=!1,t.setSpace("local"),this.createArrowBoundingBox(),t.getHelper().children[0].children[0].add(this._arrowBoundBox)}createArrowBoundingBox(){this._arrowBoundBox.geometry=new re(.18,.18,1.2),this._arrowBoundBox.material=this._hiddenMaterial,this._arrowBoundBox.rotateX(Math.PI/2),this._arrowBoundBox.updateMatrix(),this._arrowBoundBox.geometry.applyMatrix4(this._arrowBoundBox.matrix)}notifyDraggingChanged(t){t.value?this.onDraggingStarted.trigger():this.onDraggingEnded.trigger()}preventCameraMovement(){this.world.camera.enabled=this._visible}newHelper(){const t=new Oi;return t.lookAt(this.normal),t.position.copy(this.origin),this._planeMesh.position.z+=.01,t.add(this._planeMesh),this.world.scene.three.add(t),t}static newPlaneMesh(t,e){const s=new Zc(1),i=new ht(s,e);return i.scale.set(t,t,t),i}}class Ck extends Ud{constructor(){super(...arguments),k(this,"_config",{enabled:{value:!0,type:"Boolean"},visible:{value:!0,type:"Boolean"},color:{value:new Dt,type:"Color"},opacity:{type:"Number",interpolable:!0,value:1,min:0,max:1},size:{type:"Number",interpolable:!0,value:2,min:0,max:100}})}get enabled(){return this._config.enabled.value}set enabled(t){this._config.enabled.value=t,this._component.enabled=t}get visible(){return this._config.visible.value}set visible(t){this._config.visible.value=t,this._component.visible=t}get color(){return this._config.color.value}set color(t){this._config.color.value=t,this._component.material.color.copy(t)}get opacity(){return this._config.opacity.value}set opacity(t){this._config.opacity.value=t,this._component.material.opacity=t}get size(){return this._config.size.value}set size(t){this._config.size.value=t,this._component.size=t}}const iA=class cm extends Fs{constructor(t){super(t),k(this,"onSetup",new It),k(this,"onBeforeDrag",new It),k(this,"onAfterDrag",new It),k(this,"onBeforeCreate",new It),k(this,"onBeforeCancel",new It),k(this,"onAfterCancel",new It),k(this,"onBeforeDelete",new It),k(this,"onAfterCreate",new It),k(this,"onAfterDelete",new It),k(this,"onDisposed",new It),k(this,"isSetup",!1),k(this,"orthogonalY",!1),k(this,"toleranceOrthogonalY",.7),k(this,"Type",mv),k(this,"list",new Yt),k(this,"config",new Ck(this,this.components,"Clipper",cm.uuid)),k(this,"_defaultConfig",{color:new Dt(12255487),opacity:.2,size:2}),k(this,"_material",new qr({color:12255487,side:Pi,transparent:!0,opacity:.2})),k(this,"_size",5),k(this,"_enabled",!1),k(this,"_visible",!0),k(this,"_onStartDragging",()=>{this.onBeforeDrag.trigger()}),k(this,"_onEndDragging",()=>{this.onAfterDrag.trigger()}),this.components.add(cm.uuid,this),this.setEvents()}get enabled(){return this._enabled}set enabled(t){this._enabled=t}get visible(){return this._visible}set visible(t){this._visible=t;for(const[e,s]of this.list)s.visible=t}get material(){return this._material}set material(t){this._material=t;for(const[e,s]of this.list)s.planeMaterial=t}get size(){return this._size}set size(t){this._size=t;for(const[e,s]of this.list)s.size=t}setEvents(){this.list.onBeforeDelete.add(({value:t})=>{if(!t.world.renderer)throw new Error("Renderer not found for this plane's world!");t.world.renderer.setPlane(!1,t.three),t.dispose(),this.updateMaterialsAndPlanes()})}dispose(){this._enabled=!1,this.components.get(Ig).list.delete(this.config.uuid),this.list.clear(),this._material.dispose(),this.onBeforeCreate.reset(),this.onBeforeCancel.reset(),this.onBeforeDelete.reset(),this.onBeforeDrag.reset(),this.onAfterCreate.reset(),this.onAfterCancel.reset(),this.onAfterDelete.reset(),this.onAfterDrag.reset(),this.onDisposed.trigger(cm.uuid),this.onDisposed.reset()}async create(t){const i=await this.components.get(L0).get(t).castRay();return i?this.createPlaneFromIntersection(t,i):null}createFromNormalAndCoplanarPoint(t,e,s){const i=this.newPlane(t,s,e);return this.updateMaterialsAndPlanes(),i}async delete(t,e){if(!e){const s=await this.pickPlane(t);if(!s)return;e=this.list.getKey(s)}e&&this.list.delete(e)}deleteAll(t){for(const[e,s]of this.list)(!t||t.has(s.type))&&this.list.delete(e)}setup(t){const e={...this._defaultConfig,...t};this.config.color=e.color,this.config.opacity=e.opacity,this.config.size=e.size,this.isSetup=!0,this.onSetup.trigger()}async pickPlane(t){const s=this.components.get(L0).get(t),i=this.getAllPlaneMeshes(),r=await s.castRay({items:i});if(r){const o=r.object;return[...this.list.values()].find(a=>a.meshes.includes(o))}}getAllPlaneMeshes(){const t=[];for(const[e,s]of this.list)t.push(...s.meshes);return t}createPlaneFromIntersection(t,e){var s;if(!t.renderer)throw new Error("The given world must have a renderer!");const i=e.point.distanceTo(new F(0,0,0)),r=e.normal||((s=e.face)==null?void 0:s.normal);if(!i||!r)return null;const o=this.getWorldNormal(e,r),a=this.newPlane(t,e.point,o.negate()),l=this.list.get(a);return l.visible=this._visible,l.size=this._size,t.renderer.setPlane(!0,l.three),this.updateMaterialsAndPlanes(),l}getWorldNormal(t,e){const s=t.object;let i=t.object.matrixWorld.clone();if(s instanceof Wy&&t.instanceId!==void 0){const l=new xt;s.getMatrixAt(t.instanceId,l),i=l.multiply(i)}const o=new cC().getNormalMatrix(i),a=e.clone().applyMatrix3(o).normalize();return this.normalizePlaneDirectionY(a),a}normalizePlaneDirectionY(t){this.orthogonalY&&(t.y>this.toleranceOrthogonalY&&(t.x=0,t.y=1,t.z=0),t.y<-this.toleranceOrthogonalY&&(t.x=0,t.y=-1,t.z=0))}newPlane(t,e,s){const i=new this.Type(this.components,t,e,s,this._material);i.onDraggingStarted.add(this._onStartDragging),i.onDraggingEnded.add(this._onEndDragging);const r=wi.create();return this.list.set(r,i),this.onAfterCreate.trigger(i),r}updateMaterialsAndPlanes(){const t=this.components.get(Vd);for(const[e,s]of t.list){if(!s.renderer)continue;s.renderer.updateClippingPlanes();const{clippingPlanes:i}=s.renderer;for(const r of s.meshes)if(r.material)if(Array.isArray(r.material))for(const o of r.material)o.clippingPlanes=i;else r.material.clippingPlanes=i}}};k(iA,"uuid","66290bc5-18c4-4cd1-9379-2e17a0617611");let nc=iA;class nA{constructor(t,e){k(this,"title"),k(this,"guid",wi.create()),k(this,"clippingPlanes",new fe),k(this,"camera",{aspect_ratio:1,field_of_view:60,camera_direction:{x:0,y:0,z:0},camera_view_point:{x:0,y:0,z:0},camera_up_vector:{x:0,y:1,z:0}}),k(this,"exceptionComponents",new fe),k(this,"selectionComponents",new fe),k(this,"componentColors",new Yt),k(this,"spacesVisible",!1),k(this,"spaceBoundariesVisible",!1),k(this,"openingsVisible",!1),k(this,"defaultVisibility",!0),k(this,"snapshot",this.guid),k(this,"_components"),k(this,"_world",null),k(this,"notifyUpdate",()=>{this._components.get(xi).list.set(this.guid,this)}),this._components=t,e&&(this.guid=e.guid??this.guid,this.set(e)),this.setEvents()}async getSelectionMap(){return await this._components.get(Nt).guidsToModelIdMap([...this.selectionComponents])}async getExceptionMap(){return await this._components.get(Nt).guidsToModelIdMap([...this.exceptionComponents])}get projection(){return"field_of_view"in this.camera?"Perspective":"Orthographic"}get position(){const t=this._components.get(Nt),{camera_view_point:e}=this.camera,{x:s,y:i,z:r}=e,o=new F(s,i,r);return t.applyBaseCoordinateSystem(o,new xt),o}set position(t){const e=t.clone(),s=this._components.get(Nt);t.clone().applyMatrix4(s.baseCoordinationMatrix.clone().invert()),this.camera.camera_view_point={x:e.x,y:e.y,z:e.z}}get direction(){const{camera_direction:t}=this.camera,{x:e,y:s,z:i}=t;return new F(e,s,i)}set world(t){this._world=t}get world(){return this._world}get _managerVersion(){return this._components.get(We).config.version}get topics(){return[...this._components.get(We).list.values()].filter(i=>i.viewpoints.has(this.guid))}setEvents(){this.selectionComponents.onUpdated.add(this.notifyUpdate),this.exceptionComponents.onUpdated.add(this.notifyUpdate),this.clippingPlanes.onUpdated.add(this.notifyUpdate),this.componentColors.onItemSet.add(this.notifyUpdate),this.componentColors.onItemDeleted.add(this.notifyUpdate),this.componentColors.onItemUpdated.add(this.notifyUpdate),this.componentColors.onCleared.add(this.notifyUpdate)}set(t){this.title=t.title;const{components:e,perspective_camera:s,orthogonal_camera:i,clipping_planes:r}=t;if(e){const{selection:o,visibility:a,coloring:l}=e;if(o){this.selectionComponents.clear();for(const{ifc_guid:c}of o)c&&this.selectionComponents.add(c)}if(a){const{default_visibility:c,exceptions:h,view_setup_hints:u}=a;if(c!==void 0&&(this.defaultVisibility=c),h){this.exceptionComponents.clear();for(const{ifc_guid:p}of h)p&&this.exceptionComponents.add(p)}if(u){const{spaces_visible:p,space_boundaries_visible:d,openings_visible:g}=u;p!==void 0&&(this.spacesVisible=p),d!==void 0&&(this.spaceBoundariesVisible=d),g!==void 0&&(this.openingsVisible=g)}}if(l){this.componentColors.clear();for(const c of l){const{color:h,components:u}=c,p=u.map(d=>d.ifc_guid).filter(d=>d!==null);this.componentColors.set(h,p)}}}if((s||i)&&(this.camera=s??i),r&&this.world){const o=this._components.get(nc);for(const a of r){const{location:l,direction:c}=a,h=new F(l.x,l.z,-l.y),u=new F(c.x,c.z,-c.y),p=o.createFromNormalAndCoplanarPoint(this.world,u,h);this.clippingPlanes.add(p),o.list.get(p).enabled=!1,o.list.get(p).visible=!1}}this.notifyUpdate()}async go(t){if(!this.world)return;const{camera:e}=this.world;if(!(e instanceof Ag))throw new Error("Viewpoint: the world's camera component must be of type OrthoPerspectiveCamera to switch between perspective and orthographic projections.");const{transition:s,applyClippings:i,applyVisibility:r,clippingsVisibility:o}={transition:!0,applyClippings:!0,applyVisibility:!0,clippingsVisibility:!0,...t};e.projection.set(this.projection);const a=new F(this.camera.camera_view_point.x,this.camera.camera_view_point.y,this.camera.camera_view_point.z),l=new F(this.camera.camera_direction.x,this.camera.camera_direction.y,this.camera.camera_direction.z);if(a.equals(new F)&&l.equals(new F))return;const c=this.position,h=this.direction,u=80,p={x:c.x+h.x*u,y:c.y+h.y*u,z:c.z+h.z*u},d=[];i&&this.setClippingState(!0),r&&d.push(this.applyVisibility()),this.setClippingVisibility(o),d.push(e.controls.setLookAt(c.x,c.y,c.z,p.x,p.y,p.z,s)),await Promise.all(d)}async updateCamera(t=!0){return new Promise(e=>{if(!this.world){e(!1);return}const{camera:s,renderer:i}=this.world;if(!i)throw new Error("Viewpoint: the world needs to have a renderer!");if(!s.hasCameraControls())throw new Error("Viewpoint: world's camera need camera controls!");const r=new F;s.controls.getPosition(r);const o=s.three,a=new F(0,0,-1).applyEuler(o.rotation),{width:l,height:c}=i.getSize();let h=l/c;Number.isNaN(h)&&(h=1);const u=this._components.get(Nt);r.applyMatrix4(u.baseCoordinationMatrix.clone().invert());const p={aspect_ratio:h,camera_view_point:{x:r.x,y:r.y,z:r.z},camera_direction:{x:a.x,y:a.y,z:a.z},camera_up_vector:{x:0,y:1,z:0}};if(o instanceof Md?this.camera={...p,field_of_view:o.fov}:o instanceof sl&&(this.camera={...p,view_to_world_scale:o.top-o.bottom}),t){const d=this._components.get(xi),g=i.three.domElement;i.three.render(this.world.scene.three,s.three),g.toBlob(async m=>{if(m){const b=await m.arrayBuffer(),f=new Uint8Array(b);d.snapshots.set(this.guid,f)}this.notifyUpdate(),e(!0)})}else this.notifyUpdate(),e(!0)})}takeSnapshot(){return new Promise(t=>{if(!this.world){t(!1);return}const{camera:e,renderer:s}=this.world;if(!s)throw new Error("Viewpoint: the world needs to have a renderer!");const i=this._components.get(xi),r=s.three.domElement;s.three.render(this.world.scene.three,e.three),r.toBlob(async o=>{if(o){const a=await o.arrayBuffer(),l=new Uint8Array(a);i.snapshots.set(this.guid,l)}this.notifyUpdate(),t(!0)})})}updateClippingPlanes(){this.clippingPlanes.clear();const t=this._components.get(nc);for(const[e,s]of t.list)s.enabled&&this.clippingPlanes.add(e)}async applyVisibility(){const t=this._components.get(H4);t.set(this.defaultVisibility);const e=await this.getExceptionMap();t.set(!this.defaultVisibility,e);const s=await this.getSelectionMap();t.set(!0,s)}async setColorizationState(t){const e=this._components.get(Nt),s=[];if(t)for(const[i,r]of this.componentColors){const o=`#${i}`,a=await e.guidsToModelIdMap(r);for(const[l,c]of Object.entries(a)){const h=e.list.get(l);h&&s.push(h.highlight([...c],{customId:o,color:new Dt(o),renderedFaces:il.ONE,opacity:1,transparent:!1}))}}else for(const[i,r]of this.componentColors){const o=await e.guidsToModelIdMap(r);for(const[a,l]of Object.entries(o)){const c=e.list.get(a);c&&s.push(c.resetHighlight([...l]))}}s.push(e.core.update(!0)),await Promise.all(s)}setClippingState(t){const e=this._components.get(nc);for(const[s,i]of e.list)i.enabled=t&&this.clippingPlanes.has(s)}setClippingVisibility(t){const e=this._components.get(nc);for(const s of this.clippingPlanes){const i=e.list.get(s);i&&(i.visible=t)}}async createComponentTags(t){var e;const s=this._components.get(Nt),i=this._components.get(We);let r="";if(i.config.includeSelectionTag){const o=t==="selection"?await this.getSelectionMap():await this.getExceptionMap();for(const a in o){const l=s.list.get(a);if(!l)continue;const c=o[a];for(const h of c){const u=l.getItem(h),p=await u.getGuid();if(!p)continue;const d=(e=await u.getAttributes())==null?void 0:e.getValue("Tag");let g=null;d&&(g=`AuthoringToolId="${d}"`),r+=`
<Component IfcGuid="${p}" ${g??""} />`}}}else r=[...this.selectionComponents].map(o=>`<Component IfcGuid="${o}" />`).join(`
`);return r}createColorTags(){let t="";for(const[e,s]of this.componentColors.entries()){const i=s.map(r=>`
<Component IfcGuid="${r}" />`).join(`
`);t+=`<Color Color="${e}">
${i}
</Color>`}return t.length!==0?`<Coloring>
${t}
</Coloring>`:"<Coloring />"}toJSON(){const t=this._components.get(nc),e={guid:this.guid,components:{selection:[...this.selectionComponents].map(r=>({ifc_guid:r,authoring_tool_id:null})),coloring:[...this.componentColors].map(([r,o])=>({color:r,components:o.map(a=>({ifc_guid:a,authoring_tool_id:null}))})),visibility:{default_visibility:this.defaultVisibility,exceptions:[...this.exceptionComponents].map(r=>({ifc_guid:r,authoring_tool_id:null})),view_setup_hints:{spaces_visible:this.spacesVisible,space_boundaries_visible:this.spaceBoundariesVisible,openings_visible:this.openingsVisible}}},clipping_planes:[...this.clippingPlanes].map(r=>{const o=t.list.get(r);if(!o)return null;const a=o._controls.worldPosition??o.origin,{normal:l}=o;return{location:{x:a.x,y:-a.z,z:a.y},direction:{x:l.x,y:-l.z,z:l.y}}}).filter(r=>r!==null)};"field_of_view"in this.camera?e.perspective_camera=this.camera:e.orthogonal_camera=this.camera;const s=this._components.get(xi),i=s.snapshots.get(this.snapshot);if(i){const r=i.toString(),o=btoa(r),a=s.getSnapshotExtension(this.snapshot);e.snapshot={snapshot_type:a,snapshot_data:o}}return e}async serialize(t=this._managerVersion){const e=this._components.get(Nt),s=this.position;s.applyMatrix4(e.baseCoordinationMatrix.clone().invert());const i=this.direction;i.normalize();const r=new xt().makeRotationX(Math.PI/2),o=i.clone().applyMatrix4(r);o.normalize();const a=`<CameraViewPoint>
      <X>${s.x}</X>
      <Y>${-s.z}</Y>
      <Z>${s.y}</Z>
    </CameraViewPoint>`,l=`<CameraDirection>
      <X>${i.x}</X>
      <Y>${-i.z}</Y>
      <Z>${i.y}</Z>
    </CameraDirection>`,c=`<CameraUpVector>
      <X>${o.x}</X>
      <Y>${-o.z}</Y>
      <Z>${o.y}</Z>
    </CameraUpVector>`,h=`<AspectRatio>${this.camera.aspect_ratio}</AspectRatio>`;let u="";"viewToWorld"in this.camera?u=`<OrthogonalCamera>
        ${a}
        ${l}
        ${c}
        ${h}
        <ViewToWorldScale>${this.camera.viewToWorld}</ViewToWorldScale>
      </OrthogonalCamera>`:"fov"in this.camera&&(u=`<PerspectiveCamera>
        ${a}
        ${l}
        ${c}
        ${h}
        <FieldOfView>${this.camera.fov}</FieldOfView>
      </PerspectiveCamera>`);const p=`<ViewSetupHints SpacesVisible="${this.spacesVisible??!1}" SpaceBoundariesVisible="${this.spaceBoundariesVisible??!1}" OpeningsVisible="${this.openingsVisible??!1}" />`,d=(await this.createComponentTags("selection")).trim(),g=(await this.createComponentTags("exception")).trim(),m=this.createColorTags();return`<?xml version="1.0" encoding="UTF-8"?>
    <VisualizationInfo Guid="${this.guid}">
      <Components>
        ${t==="2.1"?p:""}
        ${d.length!==0?`<Selection>${d}</Selection>`:""}
        <Visibility DefaultVisibility="${this.defaultVisibility}">
          ${t==="3"?p:""}
          ${g.length!==0?`<Exceptions>${g}</Exceptions>`:""}
        </Visibility>
        ${m}
      </Components>
      ${u}
    </VisualizationInfo>`}}class Tk extends Ud{constructor(){super(...arguments),k(this,"_config",{overwriteColors:{value:!1,type:"Boolean"}})}get overwriteColors(){return this._config.overwriteColors.value}set overwriteColors(t){this._config.overwriteColors.value=t}}const rA=class V0 extends Fs{constructor(t){super(t),k(this,"enabled",!0),k(this,"world",null),k(this,"list",new Yt),k(this,"snapshots",new Yt),k(this,"isSetup",!1),k(this,"onSetup",new It),k(this,"config",new Tk(this,this.components,"Viewpoints",V0.uuid)),k(this,"onDisposed",new It),t.add(V0.uuid,this)}create(t){const e=new nA(this.components,t);return e.world=this.world,t||this.list.set(e.guid,e),e}getSnapshotExtension(t){let e="jpeg";const s=this.snapshots.get(t);if(!s)return e;const i=s.subarray(0,4);let r="";for(let o=0;o<i.length;o++)r+=i[o].toString(16);return r.startsWith("89504e47")&&(e="png"),r.startsWith("ffd8ffe")&&(e="jpeg"),e}setup(){}dispose(){this.list.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}};k(rA,"uuid","ee867824-a796-408d-8aa0-4e5962a83c66");let xi=rA;class oE{constructor(t,e){k(this,"_components"),k(this,"_cameraOffset",10),k(this,"_planeHelper"),k(this,"_farPlaneHelper"),k(this,"_cameraHelper"),k(this,"onStateChanged",new It),k(this,"onUpdated",new It),k(this,"onDisposed",new It),k(this,"camera"),k(this,"plane",new Wt),k(this,"farPlane",new Wt),k(this,"id",wi.create()),k(this,"_open",!1),k(this,"_range",Ak.defaultRange),k(this,"_world",null),k(this,"_helpersVisible",!1),k(this,"_planesEnabled",!1),this._components=t,this.camera=new Ag(this._components);const{threeOrtho:s}=this.camera;if(e?.id&&(this.id=e.id),e?.normal&&e?.point){const{normal:i,point:r}=e;this.plane.setFromNormalAndCoplanarPoint(i,r)}this._cameraHelper=new gC(s),this._planeHelper=new Em(this.plane,50),this._farPlaneHelper=new Em(this.farPlane,50),this.farPlaneHelperColor=new Dt("blue"),this.update()}get _planeNormalOpposite(){return this.plane.normal.clone().negate()}get _planePosition(){return this.plane.normal.clone().multiplyScalar(-this.plane.constant)}get _cameraPosition(){return this._planePosition.addScaledVector(this._planeNormalOpposite,this._cameraOffset)}set open(t){this._open=t,this.onStateChanged.trigger(["open"])}get open(){return this._open}set planeHelperColor(t){!Array.isArray(this._planeHelper.material)&&"color"in this._planeHelper.material&&this._planeHelper.material.color instanceof Dt&&(this._planeHelper.material.color=t)}set farPlaneHelperColor(t){!Array.isArray(this._farPlaneHelper.material)&&"color"in this._farPlaneHelper.material&&this._farPlaneHelper.material.color instanceof Dt&&(this._farPlaneHelper.material.color=t)}set range(t){this._range=t,this.update()}get range(){return this._range}set distance(t){this.plane.constant=t,this.update()}get distance(){return this.plane.constant}set world(t){this._world=t,this.camera.currentWorld=t,t&&(this.camera.projection.set("Orthographic"),this.camera.set("Plan"),this.camera.controls.dollySpeed=6,this.camera.controls.restThreshold=.005,this.update())}get world(){return this._world}set helpersVisible(t){if(!t){this._helpersVisible=t,this._planeHelper.removeFromParent(),this._farPlaneHelper.removeFromParent(),this._cameraHelper.removeFromParent();return}this.world&&(this._helpersVisible=t,this.world.scene.three.add(this._planeHelper,this._farPlaneHelper))}get helpersVisible(){return this._helpersVisible}set planesEnabled(t){const{world:e}=this;if(!e)return;const{renderer:s}=e;s&&(s.setPlane(t,this.plane),s.setPlane(t,this.farPlane),this._planesEnabled=t)}get planesEnabled(){return this._planesEnabled}dispose(){this.helpersVisible=!1;const t=this._components.get(vg);t.destroy(this._planeHelper),t.destroy(this._farPlaneHelper),t.destroy(this._cameraHelper),this.camera.dispose(),this.onDisposed.trigger()}update(){if(this.world){const t=this._cameraPosition,e=this._planePosition;this.camera.controls.setLookAt(t.x,t.y,t.z,e.x,e.y,e.z,!1)}this.farPlane.normal.copy(this._planeNormalOpposite),this.farPlane.constant=this.range-this.plane.constant,this.onUpdated.trigger()}flip(){this.plane.normal.negate(),this.update()}}const gv=class oA extends Fs{constructor(t){super(t),k(this,"list",new Yt),k(this,"enabled",!0),k(this,"world",null),k(this,"_fragmentsUpdateEvent",()=>{this.components.get(Nt).core.update(!0)}),t.add(oA.uuid,this),this.setupEvents()}get hasOpenViews(){return[...this.list.values()].some(t=>t.open)}setupEvents(){this.list.onBeforeDelete.add(({key:t,value:e})=>{e.open&&this.close(t),e.dispose()})}create(t,e,s){const i=new oE(this.components,{id:s?.id,normal:t,point:e});return i.world=s?.world??this.world,this.list.set(i.id,i),i}createFromPlane(t,e){const s=new oE(this.components,{id:e?.id});return s.plane.copy(t),s.update(),s.world=e?.world??this.world,this.list.set(s.id,s),s}async createFromIfcStoreys(t){const e=[],s=this.components.get(Nt),i=t?.offset===void 0?.25:t.offset;for(const[r,o]of s.list){if(t&&t.modelIds&&!t.modelIds.some(u=>u.test(r)))continue;const a=Object.values(await o.getItemsOfCategories([/BUILDINGSTOREY/])).flat();if(a.length===0)continue;const l=await o.getItemsData(a),[,c]=await o.getCoordinates(),h=new F(0,-1,0);for(const u of l){if(!("value"in u.Name&&"value"in u.Elevation))continue;const{value:p}=u.Name;if(t?.storeyNames&&!t.storeyNames.some(b=>b.test(p)))continue;const d=u.Elevation.value+c+i,g=new Wt(h,d),m=this.createFromPlane(g,{id:p,world:t?.world});e.push(m)}}return e}createElevations(t){const e=[],s=this.components.get(Nt),i=t?.combine===void 0?!1:t.combine,r=t?.namingCallback??(a=>({front:`${i?"Front":`${a}: Front`}`,back:`${i?"Back":`${a}: Back`}`,left:`${i?"Left":`${a}: Left`}`,right:`${i?"Right":`${a}: Right`}`}));let o=[];for(const[a,l]of s.list)t&&t.modelIds&&!t.modelIds.some(c=>c.test(a))||o.push({id:a,box:l.box});if(i){const a=this.components.get(MT);a.list.clear(),a.list.add(...o.map(c=>c.box)),o=[{id:"combined",box:a.get()}]}for(const{id:a,box:l}of o){const{min:c,max:h}=l,u=Math.abs(h.x-c.x),p=Math.abs(h.z-c.z),d=new F;l.getCenter(d);const g=new Wt(new F(0,0,-1),h.z),m=new Wt(new F(0,0,1),-c.z),b=new Wt(new F(-1,0,0),h.x),f=new Wt(new F(1,0,0),-c.x),{front:_,back:y,left:v,right:w}=r(a),I=this.createFromPlane(g,{id:_,world:t?.world});I.range=p;const C=this.createFromPlane(m,{id:y,world:t?.world});C.range=p;const A=this.createFromPlane(b,{id:v,world:t?.world});A.range=u;const S=this.createFromPlane(f,{id:w,world:t?.world});S.range=u,e.push(I,C,A,S)}return e}open(t){const e=this.list.get(t);if(!e)throw new Error(`Views: the view with id ${t} doesn't exist.`);if(e.open)return;const{world:s}=e;if(!s)throw new Error(`Views: no world found for view with id ${t}.`);const{renderer:i}=s;if(!i)throw new Error(`Views: no renderer found for world with id ${s.uuid}.`);for(const[,r]of this.list)r.world===s&&this.close(r.id);i.setPlane(!0,e.plane),i.setPlane(!0,e.farPlane),e.camera.controls.addEventListener("rest",this._fragmentsUpdateEvent),s.camera=e.camera,e.open=!0}close(t){let e;if(t?e=this.list.get(t):e=[...this.list.values()].find(r=>r.open),t&&!e)throw new Error(`Views: the view with id ${t} doesn't exist.`);if(!e||!e.open)return;const{world:s}=e;if(!s)throw new Error(`Views: no world found for view with id ${t}.`);const{renderer:i}=s;if(!i)throw new Error(`Views: no renderer found for world with id ${s.uuid}.`);i.setPlane(!1,e.plane),i.setPlane(!1,e.farPlane),e.camera.controls.removeEventListener("rest",this._fragmentsUpdateEvent),s.useDefaultCamera(),e.open=!1}};k(gv,"uuid","fb22f1f5-6598-4664-a11d-de8963ae420f");k(gv,"defaultRange",15);let Ak=gv;class th{constructor(t){k(this,"cardinality","required"),k(this,"instructions"),k(this,"evalRequirement",(e,s,i,r)=>{const o={parameter:i,currentValue:e,requiredValue:s,pass:!1};r&&this.addCheckResult(o,r);let a=!1;if(s.type==="simple"&&(a=e===s.parameter),s.type==="enumeration"&&(a=s.parameter.includes(e)),s.type==="pattern"&&(a=new RegExp(s.parameter).test(String(e))),s.type==="length"){const{min:l,length:c,max:h}=s.parameter;c!==void 0&&(a=String(e).length===c),l!==void 0&&(a=String(e).length>=l),h!==void 0&&(a=String(e).length<=h)}if(s.type==="bounds"&&typeof e=="number"){const{min:l,minInclusive:c,max:h,maxInclusive:u}=s.parameter;let p=!0,d=!0;l!==void 0&&(p=c?e>=l:e>l),h!==void 0&&(d=u?e<=h:e<h),a=p&&d}return this.cardinality==="prohibited"&&(a=!a),this.cardinality==="optional"&&(a=!0),o.pass=a,o.pass}),this._components=t}addCheckResult(t,e){const s=e.findIndex(({parameter:i})=>i===t.parameter);s!==-1?e[s]=t:e.push(t)}getItemChecks(t,e,s){if(!("value"in s._localId&&typeof s._localId.value=="number"))return null;let i=t.get(e);i||(i=new Yt,t.set(e,i));let r=i.get(s._localId.value);if(r){if(!r.pass)return null}else{const l=[];r={guid:Array.isArray(s._guid)?void 0:s._guid.value,pass:!1,checks:l},Object.defineProperty(r,"pass",{get:()=>l.every(({pass:c})=>c)}),i.set(s._localId.value,r)}const o=[],a={facetType:this.facetType,cardinality:this.cardinality,checks:o,pass:!1};return Object.defineProperty(a,"pass",{get:()=>o.every(({pass:l})=>l)}),r.checks.push(a),a.checks}}const pr=(n,t)=>{let e="";if(!t)return e;if(t.type==="simple"&&(e=`<simpleValue>${t.parameter}</simpleValue>`),t.type==="enumeration"&&(e=`<xs:restriction base="xs:string">
    ${t.parameter.map(r=>`<xs:enumeration value="${r}" />`).join(`
`)}
    </xs:restriction>`),t.type==="pattern"&&(e=`<xs:restriction base="xs:string">
      <xs:pattern value="${t.parameter}" />
    </xs:restriction>`),t.type==="bounds"){const{min:i,minInclusive:r,max:o,maxInclusive:a}=t.parameter;let l="";i!==void 0&&(l=`<xs:min${r?"Inclusive":"Exclusive"} value="${i}">`);let c="";o!==void 0&&(c=`<xs:max${a?"Inclusive":"Exclusive"} value="${o}">`),e=`<xs:restriction base="xs:double">
      ${l}
      ${c}
    </xs:restriction>`}if(t.type==="length"){const{length:i,min:r,max:o}=t.parameter;let a="";i!==void 0&&r===void 0&&o===void 0&&(a=`<xs:length value="${i}" />`);let l="";r!==void 0&&i===void 0&&(l=`<xs:minLength value="${r}" />`);let c="";o!==void 0&&i===void 0&&(c=`<xs:maxLength value="${o}" />`),e=`<xs:restriction base="xs:string">
      ${a}
      ${l}
      ${c}
    </xs:restriction>`}return`<${n[0].toLowerCase()+n.slice(1)}>
    ${e}
  </${n[0].toLowerCase()+n.slice(1)}>`};class Sk extends th{constructor(t,e){super(t),k(this,"facetType","Attribute"),k(this,"name"),k(this,"value"),this.name=e}serialize(t){const e=pr("Name",this.name),s=pr("Value",this.value);let i="";return t==="requirement"&&(i+=`cardinality="${this.cardinality}"`,i+=this.instructions?`instructions="${this.instructions}"`:""),`<attribute ${i}>
  ${e}
  ${s}
</attribute>`}async getEntities(){}async test(t,e){const s=this._components.get(Nt);for(const[i,r]of Object.entries(t)){const o=s.list.get(i);if(!o)continue;const a=await o.getItemsData([...r]);for(const l of a){const c=this.getItemChecks(e,i,l);if(!c)continue;const u=Object.keys(l).filter(d=>{const g=this.evalRequirement(d,this.name,"Name");if(!g)return!1;const m=l[d];return Array.isArray(m)?!0:m===null||m.value===null?this.cardinality==="optional"||this.cardinality==="prohibited":Array.isArray(m.value)&&m.value.length===0||typeof m.value=="string"&&m.value.trim()===""?!1:g}),p=u.length>0;if(c.push({parameter:"Name",currentValue:p?u[0]:null,requiredValue:this.name,pass:this.cardinality==="prohibited"?!p:p}),this.value)if(u[0]){const d=l[u[0]];Array.isArray(d)?c.push({parameter:"Value",currentValue:null,requiredValue:this.value,pass:this.cardinality==="prohibited"}):Array.isArray(d.value)?c.push({parameter:"Value",currentValue:null,requiredValue:this.value,pass:this.cardinality==="prohibited"}):this.evalRequirement(d.value,this.value,"Value",c)}else c.push({parameter:"Value",currentValue:null,requiredValue:this.value,pass:this.cardinality==="prohibited"})}}}}class Ok extends th{constructor(t,e){super(t),k(this,"facetType","Classification"),k(this,"system"),k(this,"value"),k(this,"uri"),this.system=e}serialize(t){const e=pr("System",this.system),s=pr("Value",this.value);let i="";return t==="requirement"&&(i+=`cardinality="${this.cardinality}"`,i+=this.uri?`uri=${this.uri}`:"",i+=this.instructions?`instructions="${this.instructions}"`:""),`<classification ${i}>
  ${e}
  ${s}
</classification>`}async getEntities(t,e){}async test(t,e){}}class H0 extends th{constructor(t,e){super(t),k(this,"facetType","Entity"),k(this,"name"),k(this,"predefinedType"),this.name=e}serialize(t){const e=pr("Name",this.name),s=pr("Name",this.predefinedType);let i="";return t==="requirement"&&(i+=`cardinality="${this.cardinality}"`,i+=this.instructions?`instructions="${this.instructions}"`:""),`<entity ${i}>
  ${e}
  ${s}
</entity>`}async getEntities(t,e){const s=this._components.get(Nt),i=new Map;for(const[o,a]of s.list){if(!t.find(h=>h.test(o)))continue;const c=await a.getCategories();for(const h of c){if(!await this.evalName(h))continue;let p=i.get(o);p||(p=[],i.set(o,p)),p.push(h)}}const r={};if(await Promise.all(Array.from(i.entries()).map(async([o,a])=>{const l=s.list.get(o);if(!l)return;const c=a.map(p=>new RegExp(`^${p}$`)),h=await l.getItemsOfCategories(c),u=Object.values(h).flat();r[o]=new Set(u)})),!this.predefinedType){gs.add(e,r);return}for(const[o,a]of Object.entries(r)){const l=s.list.get(o);if(!l)continue;const c=await l.getItemsData([...a]);for(const h of c){if(!("value"in h._localId))continue;await this.evalPredefinedType(o,h)&&gs.append(e,o,h._localId.value)}}}async test(t,e){const s=this._components.get(Nt);for(const[i,r]of Object.entries(t)){const o=s.list.get(i);if(!o)continue;const a=await o.getItemsData([...r]);for(const l of a){if(!("value"in l._category))continue;const c=this.getItemChecks(e,i,l);c&&(await this.evalName(l._category.value,c),await this.evalPredefinedType(i,l,c))}}}async evalName(t,e){return this.evalRequirement(t,this.name,"Name",e)}async evalPredefinedType(t,e,s){if(!this.predefinedType||!("value"in e.PredefinedType))return null;const i=typeof this.predefinedType.parameter=="string"&&this.predefinedType.parameter==="USERDEFINED";let r=e.PredefinedType.value;if(r==="USERDEFINED"&&!i){const l=Object.keys(e).find(c=>/^((?!Predefined).)*Type$/.test(c));if(l){const c=e[l];"value"in c&&(r=c.value)}else r="USERDEFINED"}if(!r){const l=this._components.get(Nt).list.get(t);if(l&&"value"in e._localId){const[c]=await l.getItemsData([e._localId.value],{relations:{IsTypedBy:{attributes:!0,relations:!1}}});if(Array.isArray(c.IsTypedBy)){const h=c.IsTypedBy[0];if(h&&"value"in h.PredefinedType&&(r=h.PredefinedType.value,r==="USERDEFINED"&&!i)){const p=Object.keys(h).find(d=>/^((?!Predefined).)*Type$/.test(d));if(p){const d=h[p];"value"in d&&(r=d.value)}else r="USERDEFINED"}}}}return this.evalRequirement(r,this.predefinedType,"PredefinedType",s)}}class Pk extends th{constructor(t,e,s){super(t),k(this,"facetType","Property"),k(this,"propertySet"),k(this,"baseName"),k(this,"value"),k(this,"dataType"),k(this,"uri"),k(this,"_unsupportedTypes",["IFCCOMPLEXPROPERTY","IFCPHYSICALCOMPLEXQUANTITY"]),this.propertySet=e,this.baseName=s}serialize(t){const e=pr("PropertySet",this.propertySet),s=pr("BaseName",this.baseName),i=pr("Value",this.value),r=this.dataType?`dataType=${this.dataType}`:"";let o="";return t==="requirement"&&(o+=`cardinality="${this.cardinality}"`,o+=this.uri?`uri=${this.uri}`:"",o+=this.instructions?`instructions="${this.instructions}"`:""),`<property ${r} ${o}>
  ${e}
  ${s}
  ${i}
</property>`}async getEntities(t,e){const s=this._components.get(Nt);for(const[i,r]of s.list){if(!t.find(h=>h.test(i)))continue;const a=await r.getItemsOfCategories([/PROPERTYSET/,/ELEMENTQUANTITY/]),l=Object.values(a).flat();if(l.length===0)continue;const c=await r.getItemsData(l,{relations:{HasProperties:{attributes:!0,relations:!1},DefinesOcurrence:{attributes:!0,relations:!1}}});for(const h of c){if(!("value"in h._localId&&"value"in h._category&&"value"in h.Name&&Array.isArray(h.DefinesOcurrence))||!this.evalRequirement(h.Name.value,this.propertySet,"PropertySet"))continue;let p;if(h._category.value==="IFCPROPERTYSET"&&(p="HasProperties"),h._category.value==="IFCELEMENTQUANTITY"&&(p="Quantities"),!p)continue;const d=h[p];if(Array.isArray(d))for(const g of d){const m=Object.keys(g),b=m.find(v=>/Name/.test(v));if(!(b&&"value"in g[b]))continue;const f=g[b];if(!("value"in f)||!this.evalRequirement(f.value,this.baseName,"BaseName"))continue;if(this.value){const v=m.find(C=>/Value/.test(C));if(!v)continue;const w=g[v];if(!("value"in w)||!this.evalRequirement(w.value,this.value,"Value"))continue}const y=h.DefinesOcurrence.map(v=>"value"in v._localId&&typeof v._localId.value=="number"?v._localId.value:null).filter(v=>v!==null);gs.append(e,i,...y)}}}}async test(t,e){const s=this._components.get(Nt);for(const[i,r]of Object.entries(t)){const o=s.list.get(i);if(!o)continue;const a=await o.getItemsData([...r],{relations:{IsDefinedBy:{attributes:!0,relations:!0},IsTypedBy:{attributes:!0,relations:!1},HasPropertySets:{attributes:!0,relations:!0},DefinesOcurrence:{attributes:!1,relations:!1}}});for(const l of a){const c=this.getItemChecks(e,i,l);if(!c)continue;const u=(await this.getPsets(l)).filter(p=>!("value"in p.Name)||!this.evalRequirement(p.Name.value,this.propertySet,"PropertySet")?!1:(c.push({currentValue:p.Name.value,parameter:"PropertySet",pass:!0,requiredValue:this.propertySet}),!0));if(u.length===0){c.push({currentValue:null,parameter:"PropertySet",pass:!1,requiredValue:this.propertySet});continue}for(const p of u){const d=this.getPropertyListName(p);if(!d)continue;const g=p[d];if(!Array.isArray(g)){c.push({currentValue:null,parameter:"BaseName",pass:!1,requiredValue:this.baseName});continue}const m=g.filter(b=>!("value"in b._category&&"value"in b.Name)||this._unsupportedTypes.includes(b._category.value)||!this.evalRequirement(b.Name.value,this.baseName,"BaseName")?!1:(c.push({currentValue:b.Name.value,parameter:"BaseName",pass:!0,requiredValue:this.baseName}),!0));if(m.length===0){c.push({currentValue:null,parameter:"BaseName",pass:!1,requiredValue:this.baseName});continue}for(const b of m)this.evalValue(b,c),this.evalDataType(b,c),this.evalURI()}}}}getPropertyListName(t){let e;return"value"in t._category&&(t._category.value==="IFCPROPERTYSET"&&(e="HasProperties"),t._category.value==="IFCELEMENTQUANTITY"&&(e="Quantities")),e}getValueKey(t){return Object.keys(t).find(e=>/Value/.test(e)||/Values/.test(e))}getTypePsets(t){if(!Array.isArray(t.IsTypedBy))return[];const[e]=t.IsTypedBy;return e&&Array.isArray(e.HasPropertySets)?e.HasPropertySets:[]}async getPsets(t){const e=this.getTypePsets(t);if(!Array.isArray(t.IsDefinedBy))return e;const s=[];for(const i of t.IsDefinedBy){if(!("value"in i.Name))continue;const r=i.Name.value,o=this.getPropertyListName(i);if(!(r&&o))continue;const a=e.find(l=>"value"in l.Name?l.Name.value===r:!1);if(a&&Array.isArray(a.HasProperties)&&Array.isArray(i.HasProperties))for(const l of a.HasProperties){if(!("value"in l.Name))continue;const c=l.Name.value;i.HasProperties.find(u=>"value"in u.Name?u.Name.value===c:!1)||i.HasProperties.push(l)}s.push(i)}return s}evalValue(t,e){const s=this.getValueKey(t),i=t[s];if(!("value"in i))return!1;if(this.value){if(!s)return e?.push({parameter:"Value",currentValue:null,pass:!1,requiredValue:this.value}),!1;const r=structuredClone(this.value);return i.type==="IFCLABEL"&&r.type==="simple"&&(r.parameter=String(r.parameter)),this.evalRequirement(i.value,r,"Value",e)}return s&&typeof i.value=="string"&&i.value.trim()===""?(e?.push({parameter:"Value",currentValue:"",pass:!1,requiredValue:this.value}),!1):!0}evalDataType(t,e){if(!this.dataType)return!0;const s=this.getValueKey(t);if(!(s&&"value"in t[s]))return e?.push({parameter:"DataType",currentValue:null,pass:!1,requiredValue:this.dataType}),!1;const i=t[s];return this.evalRequirement(i.type??null,{type:"simple",parameter:this.dataType},"DataType",e)}evalURI(){return!0}}class Rk extends th{constructor(){super(...arguments),k(this,"_ifcMaterialEntities",[/^IFCMATERIALLAYERSETUSAGE$/,/^IFCMATERIALCONSTITUENTSET$/,/^IFCMATERIAL$/,/^IFCMATERIALLIST$/]),k(this,"facetType","Material"),k(this,"value"),k(this,"uri")}serialize(t){if(!(this.value&&this.uri))return"<material />";const e=pr("Value",this.value);let s="";return t==="requirement"&&(s+=`cardinality="${this.cardinality}"`,s+=this.uri?`uri=${this.uri}`:"",s+=this.instructions?`instructions="${this.instructions}"`:""),`<material ${s}>
  ${e}
</material>`}async getEntities(t,e){const s=this._components.get(Nt);for(const[i,r]of s.list){if(!t.find(h=>h.test(i)))continue;const a=await r.getItemsOfCategories(this._ifcMaterialEntities),l=Object.values(a).flat();if(l.length===0)continue;const c=await r.getItemsData(l,{relations:{AssociatedTo:{attributes:!0,relations:!1},MaterialConstituents:{attributes:!0,relations:!0},ForLayerSet:{attributes:!0,relations:!0},MaterialLayers:{attributes:!0,relations:!0},Materials:{attributes:!0,relations:!1}}});for(const h of c){if(!("value"in h._localId&&"value"in h._category&&Array.isArray(h.AssociatedTo))||!this.hasValidMaterial(h))continue;const p=h.AssociatedTo.map(d=>"value"in d._localId&&d._localId.value?d._localId.value:null).filter(d=>d!==null);gs.append(e,i,...p)}}}async test(t,e){const s=this._components.get(Nt);for(const[i,r]of Object.entries(t)){const o=s.list.get(i);if(!o)continue;const a=await o.getItemsData([[...r][0]],{relations:{AssociatedTo:{attributes:!1,relations:!1},HasAssociations:{attributes:!0,relations:!0},MaterialConstituents:{attributes:!0,relations:!0},ForLayerSet:{attributes:!0,relations:!0},MaterialLayers:{attributes:!0,relations:!0},Materials:{attributes:!0,relations:!1}}});for(const l of a){const c=this.getItemChecks(e,i,l);if(c){if(!Array.isArray(l.HasAssociations)){c.push({parameter:null,currentValue:null,requiredValue:this.value,pass:!1});continue}for(const h of l.HasAssociations){if(!this._ifcMaterialEntities.some(p=>"value"in h._category?p.test(h._category.value):!1))continue;if(this.hasValidMaterial(h,c))break}}}}}hasValidMaterial(t,e){let s=!1;if("value"in t._category&&t._category.value==="IFCMATERIAL")this.evalValue(t,e)&&(s=!0);else for(const[i,r]of Object.entries(t))if(["ForLayerSet","MaterialLayers","Material","MaterialConstituents","Materials"].includes(i)&&Array.isArray(r)){for(const o of r)if("value"in o._category&&o._category.value==="IFCMATERIAL"){if(this.evalValue(o,e)){s=!0;break}}else if(this.hasValidMaterial(o)){s=!0;break}}return s}evalValue(t,e){if(!this.value)return e?.push({parameter:null,currentValue:t.Name&&"value"in t.Name?t.Name.value:null,pass:!0}),!0;if(!("value"in t._category&&t._category.value==="IFCMATERIAL"))return null;let s=!1;return t.Name&&"value"in t.Name&&(s=this.evalRequirement(t.Name.value,this.value,"Value",e)),s||(t.Category&&"value"in t.Category&&(s=this.evalRequirement(t.Category.value,this.value,"Value",e)),s)}}class Fk extends th{constructor(t,e){super(t),k(this,"facetType","PartOf"),k(this,"_entityFacet"),k(this,"_entity"),k(this,"relation"),k(this,"cardinality","required"),this._entity=e,this._entityFacet=new H0(t,e.name),this._entityFacet.predefinedType=e.predefinedType}set entity(t){this._entity=t;const{name:e,predefinedType:s}=t;this._entityFacet=new H0(this._components,e),this._entityFacet.predefinedType=s}get entity(){return this._entity}serialize(){return""}async getEntities(t,e){}async test(t){}}class Lk{constructor(t,e,s){k(this,"name"),k(this,"ifcVersion",new Set),k(this,"identifier",wi.create()),k(this,"description"),k(this,"instructions"),k(this,"requirementsDescription"),k(this,"applicability",new fe),k(this,"requirements",new fe),k(this,"components"),this.components=t,this.name=e;for(const i of s)this.ifcVersion.add(i)}set(t){const e=t,s=this;for(const r in t){if(r==="identifier")continue;const o=e[r];r in this&&(s[r]=o)}return this.components.get($k).list.set(this.identifier,this),this}async test(t){const e=new Yt;if(this.requirements.size===0)return e;const s={},i=[];for(const o of this.applicability)i.push(o.getEntities(t,s));await Promise.all(i);const r=[];for(const o of this.requirements)r.push(o.test(s,e));return await Promise.all(r),e}serialize(){const t=`name="${this.name}"`,e=this.identifier?`identifier="${this.identifier}"`:"",s=this.description?`description="${this.description}"`:"",i=this.instructions?`instructions="${this.instructions}"`:"";return`<specification ifcVersion="${[...this.ifcVersion].join(" ")}" ${t} ${e} ${s} ${i}>
      <applicability minOccurs="1" maxOccurs="unbounded">
        ${[...this.applicability].map(o=>o.serialize("applicability")).join(`
`)}
      </applicability>
      <requirements>
        ${[...this.requirements].map(o=>o.serialize("requirement")).join(`
`)}
      </requirements>
    </specification>`}}const on=n=>{if(!n)return;const t={};if("simpleValue"in n&&(t.type="simple",t.parameter=n.simpleValue),"restriction"in n){const e=n.restriction,s=Object.keys(e);if("pattern"in e&&(t.type="pattern",t.parameter=e.pattern.value),"enumeration"in e){t.type="enumeration";const i=e.enumeration.map(({value:r})=>r);t.parameter=i}if(s.some(i=>["minInclusive","minExclusive","maxInclusive","maxExclusive"].includes(i))){t.type="bounds";const i={},r=s.find(a=>a.includes("min")),o=s.find(a=>a.includes("max"));r&&(i.minInclusive=r==="minInclusive",i.min=e[r].value),o&&(i.maxInclusive=o==="maxInclusive",i.max=e[o].value),t.parameter=i}if(s.some(i=>["minLength","length","maxLength"].includes(i))){t.type="length";const i={};e.length!==void 0&&(i.length=e.length.value),e.minLength!==void 0&&(i.min=e.minLength.value),e.maxLength!==void 0&&(i.max=e.maxLength.value),t.parameter=i}}if(t.parameter!==void 0)return t},aE=(n,t)=>{const e=[];for(const s of t){const i=s.name,r=on(i);if(!r)continue;const o=new H0(n,r);s.cardinality&&(o.cardinality=s.cardinality),o.predefinedType=on(s.predefinedType),o.instructions=s.instructions,e.push(o)}return e},lE=(n,t)=>{const e=[];for(const s of t){const i=s.name,r=on(i);if(!r)continue;const o=new Sk(n,r);s.cardinality&&(o.cardinality=s.cardinality),o.value=on(s.value),o.instructions=s.instructions,e.push(o)}return e},cE=(n,t)=>{const e=[];for(const s of t){const i=new Rk(n);s.cardinality&&(i.cardinality=s.cardinality);const r=on(s.value);r?.type==="enumeration"&&Array.isArray(r.parameter)&&(r.parameter=r.parameter.map(String)),i.value=r,i.uri=s.uri,i.instructions=s.instructions,e.push(i)}return e},hE=(n,t)=>{const e=[];for(const s of t){const i=s.propertySet,r=s.baseName,o=on(i),a=on(r);if(!(a&&o))continue;const l=new Pk(n,o,a);s.cardinality&&(l.cardinality=s.cardinality);const c=on(s.value);l.value=c,l.dataType=s.dataType,l.uri=s.uri,l.instructions=s.instructions,e.push(l)}return e},uE=(n,t)=>{const e=[];for(const s of t){const i=s.system,r=on(i);if(!r)continue;const o=new Ok(n,r);s.cardinality&&(o.cardinality=s.cardinality);const a=on(s.value);a?.type==="simple"&&(a.parameter=String(a.parameter)),a?.type==="enumeration"&&Array.isArray(a.parameter)&&(a.parameter=a.parameter.map(String)),o.value=a,o.uri=s.uri,o.instructions=s.instructions,e.push(o)}return e},dE=(n,t)=>{const e=[];for(const s of t){const i=on(s.entity.name);if(!i)continue;const r=on(s.entity.predefinedType),o=new Fk(n,{name:i,predefinedType:r});o.relation=s.relation,s.cardinality&&(o.cardinality=s.cardinality),o.instructions=s.instructions,e.push(o)}return e},bv=class j0 extends Fs{constructor(t){super(t),k(this,"enabled",!0),k(this,"list",new Ac),t.add(j0.uuid,this)}getModelIdMap(t){const e={},s={};for(const[i,r]of t){const a=[...r].filter(([,h])=>h.pass).map(([h])=>h);gs.append(e,i,...a);const c=[...r].filter(([,h])=>!h.pass).map(([h])=>h);gs.append(s,i,...c)}return{pass:e,fail:s}}create(t,e,s){const i=new Lk(this.components,t,e);return s&&(i.identifier=s),this.list.set(i.identifier,i),i}load(t){const e=[],s=j0.xmlParser.parse(t).ids,{specifications:i}=s;if(i&&i.specification){const r=Array.isArray(i.specification)?i.specification:[i.specification];for(const o of r){const{name:a,ifcVersion:l,description:c,instructions:h,identifier:u}=o;if(!(a&&l))continue;const p=[],d=[],{applicability:g,requirements:m}=o;if(g){const{maxOccurs:_,...y}=g,v=Array.isArray(y)?y:[y];for(const w of v)for(const I in w){const C=Array.isArray(w[I])?w[I]:[w[I]];if(I==="entity"){const A=aE(this.components,C);p.push(...A)}if(I==="attribute"){const A=lE(this.components,C);p.push(...A)}if(I==="material"){const A=cE(this.components,C);p.push(...A)}if(I==="classification"){const A=uE(this.components,C);p.push(...A)}if(I==="property"){const A=hE(this.components,C);p.push(...A)}if(I==="partOf"){const A=dE(this.components,C);p.push(...A)}}}let b;if(m){const{maxOccurs:_,...y}=m;b=m.description;const v=Array.isArray(y)?y:[y];for(const w of v)for(const I in w){const C=Array.isArray(w[I])?w[I]:[w[I]];if(I==="entity"){const A=aE(this.components,C);d.push(...A)}if(I==="attribute"){const A=lE(this.components,C);d.push(...A)}if(I==="material"){const A=cE(this.components,C);d.push(...A)}if(I==="classification"){const A=uE(this.components,C);d.push(...A)}if(I==="property"){const A=hE(this.components,C);d.push(...A)}if(I==="partOf"){const A=dE(this.components,C);d.push(...A)}}}const f=this.create(a,l.split(/\s+/),u);f.description=c,f.instructions=h,f.requirementsDescription=b,f.applicability.add(...p),f.requirements.add(...d),e.push(f)}}return e}export(t,e=this.list.values()){const s=e??this.list;return`<ids xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://standards.buildingsmart.org/IDS http://standards.buildingsmart.org/IDS/1.0/ids.xsd" xmlns:ids="http://standards.buildingsmart.org/IDS">
  <!-- Made with That Open Engine ${tA.release} (https://github.com/thatopen/engine_components) -->
  <info>
    <title>${t.title}</title>
    ${t.copyright?`<copyright>${t.copyright}</copyright>`:""}
    ${t.version?`<version>${t.version}</version>`:""}
    ${t.description?`<description>${t.description}</description>`:""}
    ${t.author?`<author>${t.author}</author>`:""}
    ${t.date?`<date>${t.date.toISOString().split("T")[0]}</date>`:""}
    ${t.purpose?`<purpose>${t.purpose}</purpose>`:""}
    ${t.milestone?`<milestone>${t.milestone}</milestone>`:""}
  </info>
  <specifications>
    ${[...s].map(r=>r.serialize()).join(`
`)}
  </specifications>
</ids>`}};k(bv,"uuid","9f0b9f78-9b2e-481a-b766-2fbfd01f342c");k(bv,"xmlParser",new Eg.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",ignoreAttributes:!1,ignoreDeclaration:!0,ignorePiTags:!0,numberParseOptions:{leadingZeros:!0,hex:!0},parseAttributeValue:!0,preserveOrder:!1,processEntities:!1,removeNSPrefix:!0,trimValues:!0}));let $k=bv;const Nk=class aA extends Fs{constructor(t){super(t),k(this,"enabled",!0),t.add(aA.uuid,this)}static distanceFromPointToLine(t,e,s,i=!1){const r=new qt,o=new F;return r.set(e,s),r.closestPointToPoint(t,i,o),o.distanceTo(t)}round(t){t.x=Math.trunc(t.x*1e3)/1e3,t.y=Math.trunc(t.y*1e3)/1e3,t.z=Math.trunc(t.z*1e3)/1e3}async getVolumeFromFragments(t){return console.warn("getVolumeFromFragments is deprecated. Use getItemsVolume instead."),this.getItemsVolume(t)}async getItemsVolume(t){let e=0;const s=this.components.get(Nt);for(const[i,r]of Object.entries(t)){const o=s.list.get(i);o&&(e+=await o.getItemsVolume([...r]))}return e}static convertUnits(t,e,s,i=2){const r={m:1,cm:.01,mm:.001,km:1e3,m2:1,cm2:1e-4,mm2:1e-6,km2:1e6,m3:1,cm3:1e-6,mm3:1e-9,km3:1e9};if(!r[e]||!r[s])throw new Error("Invalid units provided for conversion.");if(!Number.isInteger(i)||i<0||i>5)throw new Error("Precision must be an integer between 0 and 5.");let o=r[e]/r[s];e.endsWith("2")&&s.endsWith("2")?o**=2:e.endsWith("3")&&s.endsWith("3")&&(o**=3);const a=t*o,l=10**i;return Math.round(a*l)/l}};k(Nk,"uuid","267ca032-672f-4cb0-afa9-d24e904f39d6");var Mk=Object.defineProperty,Dk=(n,t,e)=>t in n?Mk(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,G=(n,t,e)=>(Dk(n,typeof t!="symbol"?t+"":t,e),e),kk=Object.defineProperty,zk=(n,t,e)=>t in n?kk(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,z=(n,t,e)=>(zk(n,typeof t!="symbol"?t+"":t,e),e);let yt=class{constructor(){z(this,"enabled",!0),z(this,"trigger",n=>{if(!this.enabled)return;const t=this.handlers.slice(0);for(const e of t)e(n)}),z(this,"handlers",[])}add(n){this.handlers.push(n)}remove(n){this.handlers=this.handlers.filter(t=>t!==n)}reset(){this.handlers.length=0}},_v=class{constructor(t){z(this,"isDisposeable",()=>"dispose"in this&&"onDisposed"in this),z(this,"isResizeable",()=>"resize"in this&&"getSize"in this),z(this,"isUpdateable",()=>"onAfterUpdate"in this&&"onBeforeUpdate"in this&&"update"in this),z(this,"isHideable",()=>"visible"in this),z(this,"isConfigurable",()=>"setup"in this&&"config"in this&&"onSetup"in this),this.components=t}},me=class extends _v{},lA=class extends _v{constructor(t){super(t),z(this,"worlds",new Yt),z(this,"onWorldChanged",new yt),z(this,"_currentWorld",null),this.onWorldChanged.add(({world:e,action:s})=>{s==="removed"&&this.worlds.delete(e.uuid)})}set currentWorld(t){this._currentWorld=t}get currentWorld(){return this._currentWorld}},Bk=class extends lA{constructor(){super(...arguments),z(this,"hasCameraControls",()=>"controls"in this)}},Uk=class extends lA{constructor(){super(...arguments),z(this,"onAfterUpdate",new yt),z(this,"onBeforeUpdate",new yt),z(this,"onDisposed",new yt),z(this,"onResize",new yt),z(this,"onClippingPlanesUpdated",new yt),z(this,"clippingPlanes",[])}updateClippingPlanes(){this.onClippingPlanesUpdated.trigger()}setPlane(t,e,s){e.isLocal=s;const i=this.clippingPlanes.indexOf(e);t&&i===-1?this.clippingPlanes.push(e):!t&&i>-1&&this.clippingPlanes.splice(i,1),this.three.clippingPlanes=this.clippingPlanes.filter(r=>!r.isLocal)}};const cA=class W0 extends me{constructor(t){super(t),z(this,"_disposedComponents",new Set),z(this,"enabled",!0),t.add(W0.uuid,this)}get(){return this._disposedComponents}destroy(t,e=!0,s=!0){t.removeFromParent();const i=t;i.dispose&&i.dispose(),this.disposeGeometryAndMaterials(t,e),s&&i.children&&i.children.length&&this.disposeChildren(i),t.children.length=0}disposeGeometry(t){t.boundsTree&&t.disposeBoundsTree&&t.disposeBoundsTree(),t.dispose()}disposeGeometryAndMaterials(t,e){const s=t;s.geometry&&this.disposeGeometry(s.geometry),e&&s.material&&W0.disposeMaterial(s),s.material=[],s.geometry=null}disposeChildren(t){for(const e of t.children)this.destroy(e)}static disposeMaterial(t){if(t.material)if(Array.isArray(t.material))for(const e of t.material)e.dispose();else t.material.dispose()}};z(cA,"uuid","76e9cd8e-ad8f-4753-9ef6-cbc60f7247fe");let mr=cA,l_=class extends Set{constructor(t){super(t),z(this,"onItemAdded",new yt),z(this,"onItemDeleted",new yt),z(this,"onCleared",new yt),z(this,"guard",()=>!0)}clear(){super.clear(),this.onCleared.trigger()}add(...t){for(const e of t)this.has(e)||!this.guard(e)||(super.add(e),this.onItemAdded||(this.onItemAdded=new yt),this.onItemAdded.trigger(e));return this}delete(t){const e=super.delete(t);return e&&this.onItemDeleted.trigger(),e}dispose(){this.clear(),this.onItemAdded.reset(),this.onItemDeleted.reset(),this.onCleared.reset()}};const yv=class cs{static create(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,s=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return`${cs._lut[t&255]+cs._lut[t>>8&255]+cs._lut[t>>16&255]+cs._lut[t>>24&255]}-${cs._lut[e&255]}${cs._lut[e>>8&255]}-${cs._lut[e>>16&15|64]}${cs._lut[e>>24&255]}-${cs._lut[s&63|128]}${cs._lut[s>>8&255]}-${cs._lut[s>>16&255]}${cs._lut[s>>24&255]}${cs._lut[i&255]}${cs._lut[i>>8&255]}${cs._lut[i>>16&255]}${cs._lut[i>>24&255]}`.toLowerCase()}static validate(t){if(!cs._pattern.test(t))throw new Error(`${t} is not a valid UUID v4.

- If you're the tool creator, you can take one from https://www.uuidgenerator.net/.

- If you're using a platform tool, verify the uuid isn't misspelled or contact the tool creator.`)}};z(yv,"_pattern",/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/);z(yv,"_lut",["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"]);let Ps=yv;var mf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Vk(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var hA={},Sg={};(function(n){const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",e=t+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",s="["+t+"]["+e+"]*",i=new RegExp("^"+s+"$"),r=function(a,l){const c=[];let h=l.exec(a);for(;h;){const u=[];u.startIndex=l.lastIndex-h[0].length;const p=h.length;for(let d=0;d<p;d++)u.push(h[d]);c.push(u),h=l.exec(a)}return c},o=function(a){const l=i.exec(a);return!(l===null||typeof l>"u")};n.isExist=function(a){return typeof a<"u"},n.isEmptyObject=function(a){return Object.keys(a).length===0},n.merge=function(a,l,c){if(l){const h=Object.keys(l),u=h.length;for(let p=0;p<u;p++)c==="strict"?a[h[p]]=[l[h[p]]]:a[h[p]]=l[h[p]]}},n.getValue=function(a){return n.isExist(a)?a:""},n.isName=o,n.getAllMatches=r,n.nameRegexp=s})(Sg);const vv=Sg,Hk={allowBooleanAttributes:!1,unpairedTags:[]};hA.validate=function(n,t){t=Object.assign({},Hk,t);const e=[];let s=!1,i=!1;n[0]==="\uFEFF"&&(n=n.substr(1));for(let r=0;r<n.length;r++)if(n[r]==="<"&&n[r+1]==="?"){if(r+=2,r=fE(n,r),r.err)return r}else if(n[r]==="<"){let o=r;if(r++,n[r]==="!"){r=mE(n,r);continue}else{let a=!1;n[r]==="/"&&(a=!0,r++);let l="";for(;r<n.length&&n[r]!==">"&&n[r]!==" "&&n[r]!=="	"&&n[r]!==`
`&&n[r]!=="\r";r++)l+=n[r];if(l=l.trim(),l[l.length-1]==="/"&&(l=l.substring(0,l.length-1),r--),!Qk(l)){let u;return l.trim().length===0?u="Invalid space after '<'.":u="Tag '"+l+"' is an invalid name.",qe("InvalidTag",u,Hs(n,r))}const c=Yk(n,r);if(c===!1)return qe("InvalidAttr","Attributes for '"+l+"' have open quote.",Hs(n,r));let h=c.value;if(r=c.index,h[h.length-1]==="/"){const u=r-h.length;h=h.substring(0,h.length-1);const p=gE(h,t);if(p===!0)s=!0;else return qe(p.err.code,p.err.msg,Hs(n,u+p.err.line))}else if(a)if(c.tagClosed){if(h.trim().length>0)return qe("InvalidTag","Closing tag '"+l+"' can't have attributes or invalid starting.",Hs(n,o));if(e.length===0)return qe("InvalidTag","Closing tag '"+l+"' has not been opened.",Hs(n,o));{const u=e.pop();if(l!==u.tagName){let p=Hs(n,u.tagStartPos);return qe("InvalidTag","Expected closing tag '"+u.tagName+"' (opened in line "+p.line+", col "+p.col+") instead of closing tag '"+l+"'.",Hs(n,o))}e.length==0&&(i=!0)}}else return qe("InvalidTag","Closing tag '"+l+"' doesn't have proper closing.",Hs(n,r));else{const u=gE(h,t);if(u!==!0)return qe(u.err.code,u.err.msg,Hs(n,r-h.length+u.err.line));if(i===!0)return qe("InvalidXml","Multiple possible root nodes found.",Hs(n,r));t.unpairedTags.indexOf(l)!==-1||e.push({tagName:l,tagStartPos:o}),s=!0}for(r++;r<n.length;r++)if(n[r]==="<")if(n[r+1]==="!"){r++,r=mE(n,r);continue}else if(n[r+1]==="?"){if(r=fE(n,++r),r.err)return r}else break;else if(n[r]==="&"){const u=Zk(n,r);if(u==-1)return qe("InvalidChar","char '&' is not expected.",Hs(n,r));r=u}else if(i===!0&&!pE(n[r]))return qe("InvalidXml","Extra text at the end",Hs(n,r));n[r]==="<"&&r--}}else{if(pE(n[r]))continue;return qe("InvalidChar","char '"+n[r]+"' is not expected.",Hs(n,r))}if(s){if(e.length==1)return qe("InvalidTag","Unclosed tag '"+e[0].tagName+"'.",Hs(n,e[0].tagStartPos));if(e.length>0)return qe("InvalidXml","Invalid '"+JSON.stringify(e.map(r=>r.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return qe("InvalidXml","Start tag expected.",1);return!0};function pE(n){return n===" "||n==="	"||n===`
`||n==="\r"}function fE(n,t){const e=t;for(;t<n.length;t++)if(n[t]=="?"||n[t]==" "){const s=n.substr(e,t-e);if(t>5&&s==="xml")return qe("InvalidXml","XML declaration allowed only at the start of the document.",Hs(n,t));if(n[t]=="?"&&n[t+1]==">"){t++;break}else continue}return t}function mE(n,t){if(n.length>t+5&&n[t+1]==="-"&&n[t+2]==="-"){for(t+=3;t<n.length;t++)if(n[t]==="-"&&n[t+1]==="-"&&n[t+2]===">"){t+=2;break}}else if(n.length>t+8&&n[t+1]==="D"&&n[t+2]==="O"&&n[t+3]==="C"&&n[t+4]==="T"&&n[t+5]==="Y"&&n[t+6]==="P"&&n[t+7]==="E"){let e=1;for(t+=8;t<n.length;t++)if(n[t]==="<")e++;else if(n[t]===">"&&(e--,e===0))break}else if(n.length>t+9&&n[t+1]==="["&&n[t+2]==="C"&&n[t+3]==="D"&&n[t+4]==="A"&&n[t+5]==="T"&&n[t+6]==="A"&&n[t+7]==="["){for(t+=8;t<n.length;t++)if(n[t]==="]"&&n[t+1]==="]"&&n[t+2]===">"){t+=2;break}}return t}const jk='"',Wk="'";function Yk(n,t){let e="",s="",i=!1;for(;t<n.length;t++){if(n[t]===jk||n[t]===Wk)s===""?s=n[t]:s!==n[t]||(s="");else if(n[t]===">"&&s===""){i=!0;break}e+=n[t]}return s!==""?!1:{value:e,index:t,tagClosed:i}}const Gk=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function gE(n,t){const e=vv.getAllMatches(n,Gk),s={};for(let i=0;i<e.length;i++){if(e[i][1].length===0)return qe("InvalidAttr","Attribute '"+e[i][2]+"' has no space in starting.",Vh(e[i]));if(e[i][3]!==void 0&&e[i][4]===void 0)return qe("InvalidAttr","Attribute '"+e[i][2]+"' is without value.",Vh(e[i]));if(e[i][3]===void 0&&!t.allowBooleanAttributes)return qe("InvalidAttr","boolean attribute '"+e[i][2]+"' is not allowed.",Vh(e[i]));const r=e[i][2];if(!Xk(r))return qe("InvalidAttr","Attribute '"+r+"' is an invalid name.",Vh(e[i]));if(!s.hasOwnProperty(r))s[r]=1;else return qe("InvalidAttr","Attribute '"+r+"' is repeated.",Vh(e[i]))}return!0}function qk(n,t){let e=/\d/;for(n[t]==="x"&&(t++,e=/[\da-fA-F]/);t<n.length;t++){if(n[t]===";")return t;if(!n[t].match(e))break}return-1}function Zk(n,t){if(t++,n[t]===";")return-1;if(n[t]==="#")return t++,qk(n,t);let e=0;for(;t<n.length;t++,e++)if(!(n[t].match(/\w/)&&e<20)){if(n[t]===";")break;return-1}return t}function qe(n,t,e){return{err:{code:n,msg:t,line:e.line||e,col:e.col}}}function Xk(n){return vv.isName(n)}function Qk(n){return vv.isName(n)}function Hs(n,t){const e=n.substring(0,t).split(/\r?\n/);return{line:e.length,col:e[e.length-1].length+1}}function Vh(n){return n.startIndex+n[1].length}var wv={};const uA={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(n,t){return t},attributeValueProcessor:function(n,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(n,t,e){return n}},Kk=function(n){return Object.assign({},uA,n)};wv.buildOptions=Kk;wv.defaultOptions=uA;let Jk=class{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,e){t==="__proto__"&&(t="#__proto__"),this.child.push({[t]:e})}addChild(t){t.tagname==="__proto__"&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,":@":t[":@"]}):this.child.push({[t.tagname]:t.child})}};var t6=Jk;const e6=Sg;function s6(n,t){const e={};if(n[t+3]==="O"&&n[t+4]==="C"&&n[t+5]==="T"&&n[t+6]==="Y"&&n[t+7]==="P"&&n[t+8]==="E"){t=t+9;let s=1,i=!1,r=!1,o="";for(;t<n.length;t++)if(n[t]==="<"&&!r){if(i&&r6(n,t))t+=7,[entityName,val,t]=i6(n,t+1),val.indexOf("&")===-1&&(e[c6(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(i&&o6(n,t))t+=8;else if(i&&a6(n,t))t+=8;else if(i&&l6(n,t))t+=9;else if(n6)r=!0;else throw new Error("Invalid DOCTYPE");s++,o=""}else if(n[t]===">"){if(r?n[t-1]==="-"&&n[t-2]==="-"&&(r=!1,s--):s--,s===0)break}else n[t]==="["?i=!0:o+=n[t];if(s!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:e,i:t}}function i6(n,t){let e="";for(;t<n.length&&n[t]!=="'"&&n[t]!=='"';t++)e+=n[t];if(e=e.trim(),e.indexOf(" ")!==-1)throw new Error("External entites are not supported");const s=n[t++];let i="";for(;t<n.length&&n[t]!==s;t++)i+=n[t];return[e,i,t]}function n6(n,t){return n[t+1]==="!"&&n[t+2]==="-"&&n[t+3]==="-"}function r6(n,t){return n[t+1]==="!"&&n[t+2]==="E"&&n[t+3]==="N"&&n[t+4]==="T"&&n[t+5]==="I"&&n[t+6]==="T"&&n[t+7]==="Y"}function o6(n,t){return n[t+1]==="!"&&n[t+2]==="E"&&n[t+3]==="L"&&n[t+4]==="E"&&n[t+5]==="M"&&n[t+6]==="E"&&n[t+7]==="N"&&n[t+8]==="T"}function a6(n,t){return n[t+1]==="!"&&n[t+2]==="A"&&n[t+3]==="T"&&n[t+4]==="T"&&n[t+5]==="L"&&n[t+6]==="I"&&n[t+7]==="S"&&n[t+8]==="T"}function l6(n,t){return n[t+1]==="!"&&n[t+2]==="N"&&n[t+3]==="O"&&n[t+4]==="T"&&n[t+5]==="A"&&n[t+6]==="T"&&n[t+7]==="I"&&n[t+8]==="O"&&n[t+9]==="N"}function c6(n){if(e6.isName(n))return n;throw new Error(`Invalid entity name ${n}`)}var h6=s6;const u6=/^[-+]?0x[a-fA-F0-9]+$/,d6=/^([\-\+])?(0*)([0-9]*(\.[0-9]*)?)$/,p6={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function f6(n,t={}){if(t=Object.assign({},p6,t),!n||typeof n!="string")return n;let e=n.trim();if(t.skipLike!==void 0&&t.skipLike.test(e))return n;if(n==="0")return 0;if(t.hex&&u6.test(e))return g6(e,16);if(e.search(/[eE]/)!==-1){const s=e.match(/^([-\+])?(0*)([0-9]*(\.[0-9]*)?[eE][-\+]?[0-9]+)$/);if(s){if(t.leadingZeros)e=(s[1]||"")+s[3];else if(!(s[2]==="0"&&s[3][0]==="."))return n;return t.eNotation?Number(e):n}else return n}else{const s=d6.exec(e);if(s){const i=s[1],r=s[2];let o=m6(s[3]);if(!t.leadingZeros&&r.length>0&&i&&e[2]!=="."||!t.leadingZeros&&r.length>0&&!i&&e[1]!==".")return n;if(t.leadingZeros&&r===n)return 0;{const a=Number(e),l=""+a;return l.search(/[eE]/)!==-1?t.eNotation?a:n:e.indexOf(".")!==-1?l==="0"&&o===""||l===o||i&&l==="-"+o?a:n:r?o===l||i+o===l?a:n:e===l||e===i+l?a:n}}else return n}}function m6(n){return n&&n.indexOf(".")!==-1&&(n=n.replace(/0+$/,""),n==="."?n="0":n[0]==="."?n="0"+n:n[n.length-1]==="."&&(n=n.substr(0,n.length-1))),n}function g6(n,t){if(parseInt)return parseInt(n,t);if(Number.parseInt)return Number.parseInt(n,t);if(window&&window.parseInt)return window.parseInt(n,t);throw new Error("parseInt, Number.parseInt, window.parseInt are not supported")}var b6=f6;const dA=Sg,Hh=t6,_6=h6,y6=b6;let v6=class{constructor(t){this.options=t,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(e,s)=>String.fromCharCode(Number.parseInt(s,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(e,s)=>String.fromCharCode(Number.parseInt(s,16))}},this.addExternalEntities=w6,this.parseXml=T6,this.parseTextData=E6,this.resolveNameSpace=x6,this.buildAttributesMap=C6,this.isItStopNode=P6,this.replaceEntitiesValue=S6,this.readStopNodeData=F6,this.saveTextToParentTag=O6,this.addChild=A6}};function w6(n){const t=Object.keys(n);for(let e=0;e<t.length;e++){const s=t[e];this.lastEntities[s]={regex:new RegExp("&"+s+";","g"),val:n[s]}}}function E6(n,t,e,s,i,r,o){if(n!==void 0&&(this.options.trimValues&&!s&&(n=n.trim()),n.length>0)){o||(n=this.replaceEntitiesValue(n));const a=this.options.tagValueProcessor(t,n,e,i,r);return a==null?n:typeof a!=typeof n||a!==n?a:this.options.trimValues?G0(n,this.options.parseTagValue,this.options.numberParseOptions):n.trim()===n?G0(n,this.options.parseTagValue,this.options.numberParseOptions):n}}function x6(n){if(this.options.removeNSPrefix){const t=n.split(":"),e=n.charAt(0)==="/"?"/":"";if(t[0]==="xmlns")return"";t.length===2&&(n=e+t[1])}return n}const I6=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function C6(n,t,e){if(!this.options.ignoreAttributes&&typeof n=="string"){const s=dA.getAllMatches(n,I6),i=s.length,r={};for(let o=0;o<i;o++){const a=this.resolveNameSpace(s[o][1]);let l=s[o][4],c=this.options.attributeNamePrefix+a;if(a.length)if(this.options.transformAttributeName&&(c=this.options.transformAttributeName(c)),c==="__proto__"&&(c="#__proto__"),l!==void 0){this.options.trimValues&&(l=l.trim()),l=this.replaceEntitiesValue(l);const h=this.options.attributeValueProcessor(a,l,t);h==null?r[c]=l:typeof h!=typeof l||h!==l?r[c]=h:r[c]=G0(l,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(r[c]=!0)}if(!Object.keys(r).length)return;if(this.options.attributesGroupName){const o={};return o[this.options.attributesGroupName]=r,o}return r}}const T6=function(n){n=n.replace(/\r\n?/g,`
`);const t=new Hh("!xml");let e=t,s="",i="";for(let r=0;r<n.length;r++)if(n[r]==="<")if(n[r+1]==="/"){const o=Ra(n,">",r,"Closing Tag is not closed.");let a=n.substring(r+2,o).trim();if(this.options.removeNSPrefix){const h=a.indexOf(":");h!==-1&&(a=a.substr(h+1))}this.options.transformTagName&&(a=this.options.transformTagName(a)),e&&(s=this.saveTextToParentTag(s,e,i));const l=i.substring(i.lastIndexOf(".")+1);if(a&&this.options.unpairedTags.indexOf(a)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${a}>`);let c=0;l&&this.options.unpairedTags.indexOf(l)!==-1?(c=i.lastIndexOf(".",i.lastIndexOf(".")-1),this.tagsNodeStack.pop()):c=i.lastIndexOf("."),i=i.substring(0,c),e=this.tagsNodeStack.pop(),s="",r=o}else if(n[r+1]==="?"){let o=Y0(n,r,!1,"?>");if(!o)throw new Error("Pi Tag is not closed.");if(s=this.saveTextToParentTag(s,e,i),!(this.options.ignoreDeclaration&&o.tagName==="?xml"||this.options.ignorePiTags)){const a=new Hh(o.tagName);a.add(this.options.textNodeName,""),o.tagName!==o.tagExp&&o.attrExpPresent&&(a[":@"]=this.buildAttributesMap(o.tagExp,i,o.tagName)),this.addChild(e,a,i)}r=o.closeIndex+1}else if(n.substr(r+1,3)==="!--"){const o=Ra(n,"-->",r+4,"Comment is not closed.");if(this.options.commentPropName){const a=n.substring(r+4,o-2);s=this.saveTextToParentTag(s,e,i),e.add(this.options.commentPropName,[{[this.options.textNodeName]:a}])}r=o}else if(n.substr(r+1,2)==="!D"){const o=_6(n,r);this.docTypeEntities=o.entities,r=o.i}else if(n.substr(r+1,2)==="!["){const o=Ra(n,"]]>",r,"CDATA is not closed.")-2,a=n.substring(r+9,o);s=this.saveTextToParentTag(s,e,i);let l=this.parseTextData(a,e.tagname,i,!0,!1,!0,!0);l==null&&(l=""),this.options.cdataPropName?e.add(this.options.cdataPropName,[{[this.options.textNodeName]:a}]):e.add(this.options.textNodeName,l),r=o+2}else{let o=Y0(n,r,this.options.removeNSPrefix),a=o.tagName;const l=o.rawTagName;let c=o.tagExp,h=o.attrExpPresent,u=o.closeIndex;this.options.transformTagName&&(a=this.options.transformTagName(a)),e&&s&&e.tagname!=="!xml"&&(s=this.saveTextToParentTag(s,e,i,!1));const p=e;if(p&&this.options.unpairedTags.indexOf(p.tagname)!==-1&&(e=this.tagsNodeStack.pop(),i=i.substring(0,i.lastIndexOf("."))),a!==t.tagname&&(i+=i?"."+a:a),this.isItStopNode(this.options.stopNodes,i,a)){let d="";if(c.length>0&&c.lastIndexOf("/")===c.length-1)a[a.length-1]==="/"?(a=a.substr(0,a.length-1),i=i.substr(0,i.length-1),c=a):c=c.substr(0,c.length-1),r=o.closeIndex;else if(this.options.unpairedTags.indexOf(a)!==-1)r=o.closeIndex;else{const m=this.readStopNodeData(n,l,u+1);if(!m)throw new Error(`Unexpected end of ${l}`);r=m.i,d=m.tagContent}const g=new Hh(a);a!==c&&h&&(g[":@"]=this.buildAttributesMap(c,i,a)),d&&(d=this.parseTextData(d,a,i,!0,h,!0,!0)),i=i.substr(0,i.lastIndexOf(".")),g.add(this.options.textNodeName,d),this.addChild(e,g,i)}else{if(c.length>0&&c.lastIndexOf("/")===c.length-1){a[a.length-1]==="/"?(a=a.substr(0,a.length-1),i=i.substr(0,i.length-1),c=a):c=c.substr(0,c.length-1),this.options.transformTagName&&(a=this.options.transformTagName(a));const d=new Hh(a);a!==c&&h&&(d[":@"]=this.buildAttributesMap(c,i,a)),this.addChild(e,d,i),i=i.substr(0,i.lastIndexOf("."))}else{const d=new Hh(a);this.tagsNodeStack.push(e),a!==c&&h&&(d[":@"]=this.buildAttributesMap(c,i,a)),this.addChild(e,d,i),e=d}s="",r=u}}else s+=n[r];return t.child};function A6(n,t,e){const s=this.options.updateTag(t.tagname,e,t[":@"]);s===!1||(typeof s=="string"&&(t.tagname=s),n.addChild(t))}const S6=function(n){if(this.options.processEntities){for(let t in this.docTypeEntities){const e=this.docTypeEntities[t];n=n.replace(e.regx,e.val)}for(let t in this.lastEntities){const e=this.lastEntities[t];n=n.replace(e.regex,e.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const e=this.htmlEntities[t];n=n.replace(e.regex,e.val)}n=n.replace(this.ampEntity.regex,this.ampEntity.val)}return n};function O6(n,t,e,s){return n&&(s===void 0&&(s=Object.keys(t.child).length===0),n=this.parseTextData(n,t.tagname,e,!1,t[":@"]?Object.keys(t[":@"]).length!==0:!1,s),n!==void 0&&n!==""&&t.add(this.options.textNodeName,n),n=""),n}function P6(n,t,e){const s="*."+e;for(const i in n){const r=n[i];if(s===r||t===r)return!0}return!1}function R6(n,t,e=">"){let s,i="";for(let r=t;r<n.length;r++){let o=n[r];if(s)o===s&&(s="");else if(o==='"'||o==="'")s=o;else if(o===e[0])if(e[1]){if(n[r+1]===e[1])return{data:i,index:r}}else return{data:i,index:r};else o==="	"&&(o=" ");i+=o}}function Ra(n,t,e,s){const i=n.indexOf(t,e);if(i===-1)throw new Error(s);return i+t.length-1}function Y0(n,t,e,s=">"){const i=R6(n,t+1,s);if(!i)return;let r=i.data;const o=i.index,a=r.search(/\s/);let l=r,c=!0;a!==-1&&(l=r.substring(0,a),r=r.substring(a+1).trimStart());const h=l;if(e){const u=l.indexOf(":");u!==-1&&(l=l.substr(u+1),c=l!==i.data.substr(u+1))}return{tagName:l,tagExp:r,closeIndex:o,attrExpPresent:c,rawTagName:h}}function F6(n,t,e){const s=e;let i=1;for(;e<n.length;e++)if(n[e]==="<")if(n[e+1]==="/"){const r=Ra(n,">",e,`${t} is not closed`);if(n.substring(e+2,r).trim()===t&&(i--,i===0))return{tagContent:n.substring(s,e),i:r};e=r}else if(n[e+1]==="?")e=Ra(n,"?>",e+1,"StopNode is not closed.");else if(n.substr(e+1,3)==="!--")e=Ra(n,"-->",e+3,"StopNode is not closed.");else if(n.substr(e+1,2)==="![")e=Ra(n,"]]>",e,"StopNode is not closed.")-2;else{const r=Y0(n,e,">");r&&((r&&r.tagName)===t&&r.tagExp[r.tagExp.length-1]!=="/"&&i++,e=r.closeIndex)}}function G0(n,t,e){if(t&&typeof n=="string"){const s=n.trim();return s==="true"?!0:s==="false"?!1:y6(n,e)}else return dA.isExist(n)?n:""}var L6=v6,pA={};function $6(n,t){return fA(n,t)}function fA(n,t,e){let s;const i={};for(let r=0;r<n.length;r++){const o=n[r],a=N6(o);let l="";if(e===void 0?l=a:l=e+"."+a,a===t.textNodeName)s===void 0?s=o[a]:s+=""+o[a];else{if(a===void 0)continue;if(o[a]){let c=fA(o[a],t,l);const h=D6(c,t);o[":@"]?M6(c,o[":@"],l,t):Object.keys(c).length===1&&c[t.textNodeName]!==void 0&&!t.alwaysCreateTextNode?c=c[t.textNodeName]:Object.keys(c).length===0&&(t.alwaysCreateTextNode?c[t.textNodeName]="":c=""),i[a]!==void 0&&i.hasOwnProperty(a)?(Array.isArray(i[a])||(i[a]=[i[a]]),i[a].push(c)):t.isArray(a,l,h)?i[a]=[c]:i[a]=c}}}return typeof s=="string"?s.length>0&&(i[t.textNodeName]=s):s!==void 0&&(i[t.textNodeName]=s),i}function N6(n){const t=Object.keys(n);for(let e=0;e<t.length;e++){const s=t[e];if(s!==":@")return s}}function M6(n,t,e,s){if(t){const i=Object.keys(t),r=i.length;for(let o=0;o<r;o++){const a=i[o];s.isArray(a,e+"."+a,!0,!0)?n[a]=[t[a]]:n[a]=t[a]}}}function D6(n,t){const{textNodeName:e}=t,s=Object.keys(n).length;return!!(s===0||s===1&&(n[e]||typeof n[e]=="boolean"||n[e]===0))}pA.prettify=$6;const{buildOptions:k6}=wv,z6=L6,{prettify:B6}=pA,U6=hA;let V6=class{constructor(t){this.externalEntities={},this.options=k6(t)}parse(t,e){if(typeof t!="string")if(t.toString)t=t.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(e){e===!0&&(e={});const r=U6.validate(t,e);if(r!==!0)throw Error(`${r.err.msg}:${r.err.line}:${r.err.col}`)}const s=new z6(this.options);s.addExternalEntities(this.externalEntities);const i=s.parseXml(t);return this.options.preserveOrder||i===void 0?i:B6(i,this.options)}addEntity(t,e){if(e.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(t.indexOf("&")!==-1||t.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(e==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[t]=e}};var H6=V6;const j6=`
`;function W6(n,t){let e="";return t.format&&t.indentBy.length>0&&(e=j6),mA(n,t,"",e)}function mA(n,t,e,s){let i="",r=!1;for(let o=0;o<n.length;o++){const a=n[o],l=Y6(a);if(l===void 0)continue;let c="";if(e.length===0?c=l:c=`${e}.${l}`,l===t.textNodeName){let g=a[l];G6(c,t)||(g=t.tagValueProcessor(l,g),g=gA(g,t)),r&&(i+=s),i+=g,r=!1;continue}else if(l===t.cdataPropName){r&&(i+=s),i+=`<![CDATA[${a[l][0][t.textNodeName]}]]>`,r=!1;continue}else if(l===t.commentPropName){i+=s+`<!--${a[l][0][t.textNodeName]}-->`,r=!0;continue}else if(l[0]==="?"){const g=bE(a[":@"],t),m=l==="?xml"?"":s;let b=a[l][0][t.textNodeName];b=b.length!==0?" "+b:"",i+=m+`<${l}${b}${g}?>`,r=!0;continue}let h=s;h!==""&&(h+=t.indentBy);const u=bE(a[":@"],t),p=s+`<${l}${u}`,d=mA(a[l],t,c,h);t.unpairedTags.indexOf(l)!==-1?t.suppressUnpairedNode?i+=p+">":i+=p+"/>":(!d||d.length===0)&&t.suppressEmptyNode?i+=p+"/>":d&&d.endsWith(">")?i+=p+`>${d}${s}</${l}>`:(i+=p+">",d&&s!==""&&(d.includes("/>")||d.includes("</"))?i+=s+t.indentBy+d+s:i+=d,i+=`</${l}>`),r=!0}return i}function Y6(n){const t=Object.keys(n);for(let e=0;e<t.length;e++){const s=t[e];if(n.hasOwnProperty(s)&&s!==":@")return s}}function bE(n,t){let e="";if(n&&!t.ignoreAttributes)for(let s in n){if(!n.hasOwnProperty(s))continue;let i=t.attributeValueProcessor(s,n[s]);i=gA(i,t),i===!0&&t.suppressBooleanAttributes?e+=` ${s.substr(t.attributeNamePrefix.length)}`:e+=` ${s.substr(t.attributeNamePrefix.length)}="${i}"`}return e}function G6(n,t){n=n.substr(0,n.length-t.textNodeName.length-1);let e=n.substr(n.lastIndexOf(".")+1);for(let s in t.stopNodes)if(t.stopNodes[s]===n||t.stopNodes[s]==="*."+e)return!0;return!1}function gA(n,t){if(n&&n.length>0&&t.processEntities)for(let e=0;e<t.entities.length;e++){const s=t.entities[e];n=n.replace(s.regex,s.val)}return n}var q6=W6;const Z6=q6,X6={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(n,t){return t},attributeValueProcessor:function(n,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function Zo(n){this.options=Object.assign({},X6,n),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=J6),this.processTextOrObjNode=Q6,this.options.format?(this.indentate=K6,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}Zo.prototype.build=function(n){return this.options.preserveOrder?Z6(n,this.options):(Array.isArray(n)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(n={[this.options.arrayNodeName]:n}),this.j2x(n,0).val)};Zo.prototype.j2x=function(n,t){let e="",s="";for(let i in n)if(Object.prototype.hasOwnProperty.call(n,i))if(typeof n[i]>"u")this.isAttribute(i)&&(s+="");else if(n[i]===null)this.isAttribute(i)?s+="":i[0]==="?"?s+=this.indentate(t)+"<"+i+"?"+this.tagEndChar:s+=this.indentate(t)+"<"+i+"/"+this.tagEndChar;else if(n[i]instanceof Date)s+=this.buildTextValNode(n[i],i,"",t);else if(typeof n[i]!="object"){const r=this.isAttribute(i);if(r)e+=this.buildAttrPairStr(r,""+n[i]);else if(i===this.options.textNodeName){let o=this.options.tagValueProcessor(i,""+n[i]);s+=this.replaceEntitiesValue(o)}else s+=this.buildTextValNode(n[i],i,"",t)}else if(Array.isArray(n[i])){const r=n[i].length;let o="",a="";for(let l=0;l<r;l++){const c=n[i][l];if(!(typeof c>"u"))if(c===null)i[0]==="?"?s+=this.indentate(t)+"<"+i+"?"+this.tagEndChar:s+=this.indentate(t)+"<"+i+"/"+this.tagEndChar;else if(typeof c=="object")if(this.options.oneListGroup){const h=this.j2x(c,t+1);o+=h.val,this.options.attributesGroupName&&c.hasOwnProperty(this.options.attributesGroupName)&&(a+=h.attrStr)}else o+=this.processTextOrObjNode(c,i,t);else if(this.options.oneListGroup){let h=this.options.tagValueProcessor(i,c);h=this.replaceEntitiesValue(h),o+=h}else o+=this.buildTextValNode(c,i,"",t)}this.options.oneListGroup&&(o=this.buildObjectNode(o,i,a,t)),s+=o}else if(this.options.attributesGroupName&&i===this.options.attributesGroupName){const r=Object.keys(n[i]),o=r.length;for(let a=0;a<o;a++)e+=this.buildAttrPairStr(r[a],""+n[i][r[a]])}else s+=this.processTextOrObjNode(n[i],i,t);return{attrStr:e,val:s}};Zo.prototype.buildAttrPairStr=function(n,t){return t=this.options.attributeValueProcessor(n,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&t==="true"?" "+n:" "+n+'="'+t+'"'};function Q6(n,t,e){const s=this.j2x(n,e+1);return n[this.options.textNodeName]!==void 0&&Object.keys(n).length===1?this.buildTextValNode(n[this.options.textNodeName],t,s.attrStr,e):this.buildObjectNode(s.val,t,s.attrStr,e)}Zo.prototype.buildObjectNode=function(n,t,e,s){if(n==="")return t[0]==="?"?this.indentate(s)+"<"+t+e+"?"+this.tagEndChar:this.indentate(s)+"<"+t+e+this.closeTag(t)+this.tagEndChar;{let i="</"+t+this.tagEndChar,r="";return t[0]==="?"&&(r="?",i=""),(e||e==="")&&n.indexOf("<")===-1?this.indentate(s)+"<"+t+e+r+">"+n+i:this.options.commentPropName!==!1&&t===this.options.commentPropName&&r.length===0?this.indentate(s)+`<!--${n}-->`+this.newLine:this.indentate(s)+"<"+t+e+r+this.tagEndChar+n+this.indentate(s)+i}};Zo.prototype.closeTag=function(n){let t="";return this.options.unpairedTags.indexOf(n)!==-1?this.options.suppressUnpairedNode||(t="/"):this.options.suppressEmptyNode?t="/":t=`></${n}`,t};Zo.prototype.buildTextValNode=function(n,t,e,s){if(this.options.cdataPropName!==!1&&t===this.options.cdataPropName)return this.indentate(s)+`<![CDATA[${n}]]>`+this.newLine;if(this.options.commentPropName!==!1&&t===this.options.commentPropName)return this.indentate(s)+`<!--${n}-->`+this.newLine;if(t[0]==="?")return this.indentate(s)+"<"+t+e+"?"+this.tagEndChar;{let i=this.options.tagValueProcessor(t,n);return i=this.replaceEntitiesValue(i),i===""?this.indentate(s)+"<"+t+e+this.closeTag(t)+this.tagEndChar:this.indentate(s)+"<"+t+e+">"+i+"</"+t+this.tagEndChar}};Zo.prototype.replaceEntitiesValue=function(n){if(n&&n.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){const e=this.options.entities[t];n=n.replace(e.regex,e.val)}return n};function K6(n){return this.options.indentBy.repeat(n)}function J6(n){return n.startsWith(this.options.attributeNamePrefix)&&n!==this.options.textNodeName?n.substr(this.attrPrefixLen):!1}var tz=Zo;const ez=H6,sz=tz;var Og={XMLParser:ez,XMLBuilder:sz};let Pg=class{};z(Pg,"parser",new Og.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",ignoreAttributes:!1,ignoreDeclaration:!0,ignorePiTags:!0,numberParseOptions:{leadingZeros:!0,hex:!0},parseAttributeValue:!0,preserveOrder:!1,processEntities:!1,removeNSPrefix:!0,trimValues:!0}));z(Pg,"builder",new Og.XMLBuilder({attributeNamePrefix:"$",ignoreAttributes:!1,suppressBooleanAttributes:!1}));let Qe=class hm{static join(t){const e={};for(const s of t)for(const i in s)if(!e[i])e[i]=new Set(s[i]);else for(const r of s[i])e[i].add(r);return e}static intersect(t){if(t.length===0)return{};let e=hm.clone(t[0]);for(let s=1;s<t.length;s++){const i=t[s],r={};for(const o in e)if(i[o]){const a=new Set;for(const l of e[o])i[o].has(l)&&a.add(l);a.size>0&&(r[o]=a)}e=r}return e}static clone(t){const e={};for(const s in t)e[s]=new Set(t[s]);return e}static remove(t,e,s=!1){s&&(t=hm.clone(t));for(const i in e)if(t[i]){for(const r of e[i])t[i].delete(r);t[i].size===0&&delete t[i]}}static add(t,e,s=!1){s&&(t=hm.clone(t));for(const i in e)if(!t[i])t[i]=new Set(e[i]);else for(const r of e[i])t[i].add(r)}static append(t,e,...s){let i=t[e];i||(i=new Set,t[e]=i);for(const r of s)i.add(r)}static isEqual(t,e){const s=Object.keys(t),i=Object.keys(e);if(s.length!==i.length)return!1;for(const r of s){if(!e[r]||t[r].size!==e[r].size)return!1;for(const o of t[r])if(!e[r].has(o))return!1}return!0}static isEmpty(t){return Object.values(t).reduce((e,s)=>e+s.size,0)===0}static toRaw(t){const e={};for(const s in t)e[s]=Array.from(t[s]);return e}static fromRaw(t){const e={};for(const s in t)e[s]=new Set(t[s]);return e}},Sc=class extends Map{constructor(t){super(t),z(this,"onItemSet",new yt),z(this,"onItemUpdated",new yt),z(this,"onItemDeleted",new yt),z(this,"onCleared",new yt),z(this,"guard",()=>!0)}clear(){super.clear(),this.onCleared.trigger()}set(t,e){const s=this.has(t);if(!(this.guard??(()=>!0))(t,e))return this;const i=super.set(t,e);return s?(this.onItemUpdated||(this.onItemUpdated=new yt),this.onItemUpdated.trigger({key:t,value:e})):(this.onItemSet||(this.onItemSet=new yt),this.onItemSet.trigger({key:t,value:e})),i}add(t){const e=Ps.create();return this.set(e,t),e}delete(t){const e=super.delete(t);return e&&this.onItemDeleted.trigger(t),e}dispose(){this.clear(),this.onItemSet.reset(),this.onItemDeleted.reset(),this.onCleared.reset()}},c_=class{static isEntry(t){return new Set(["Boolean","Color","Text","Number","Select","Vector3","TextSet","None"]).has(t.type)}static copySchema(t,e={}){for(const s in t){const i=t[s];this.isEntry(i)?e[s]=this.copyEntry(i):(e[s]={},this.copySchema(i,e[s]))}return e}static copyEntry(t){if(t.type==="Boolean"){const e=t;return{type:e.type,value:e.value}}if(t.type==="Color"){const e=t;return{type:e.type,value:e.value.clone()}}if(t.type==="Text"){const e=t;return{type:e.type,value:e.value}}if(t.type==="Number"){const e=t;return{type:e.type,value:e.value,min:e.min,max:e.max,interpolable:e.interpolable}}if(t.type==="Select"){const e=t;return{type:e.type,value:e.value,multiple:e.multiple,options:new Set(e.options)}}if(t.type==="Vector3"){const e=t;return{type:e.type,value:e.value.clone()}}if(t.type==="TextSet"){const e=t;return{type:e.type,value:new Set(e.value)}}if(t.type==="None"){const e=t;return{type:e.type,value:e.value}}throw new Error("Invalid entry!")}},iz=class{constructor(){z(this,"list",new Set)}add(t){for(const e of t)this.list.add(e)}remove(t){for(const e of t)this.list.delete(e)}set(t){for(const e of this.list)e.enabled=t}reset(){for(const t of this.list)t.reset()}},Rg=class{constructor(t,e,s,i){z(this,"_component"),z(this,"name"),z(this,"uuid"),this._component=t,this.name=s,this.uuid=i??Ps.create(),e.get(Ev).list.set(this.uuid,this)}get controls(){return c_.copySchema(this._config)}set(t){for(const e in t)if(e in this){const s=e;this[s]=t[e].value}}export(t=this._config,e={}){for(const s in t){const i=t[s];if(c_.isEntry(i))if(i.type==="Color"){const{r,g:o,b:a}=i.value;e[s]={...i,value:{r,g:o,b:a}}}else if(i.type==="Vector3"){const{x:r,y:o,z:a}=i.value;e[s]={...i,value:{x:r,y:o,z:a}}}else if(i.type==="TextSet"){const r=Array.from(i.value);e[s]={...i,value:r}}else if(i.type==="Select"){const r=Array.from(i.options);e[s]={...i,options:r}}else e[s]={...i};else e[s]={},this.export(i,e[s])}return e}import(t,e={},s=!0){for(const i in t){const r=t[i];if(c_.isEntry(r))if(r.type==="Color"){const{r:o,g:a,b:l}=r.value;e[i]={...r,value:new Dt(o,a,l)}}else if(r.type==="Vector3"){const{x:o,y:a,z:l}=r.value;e[i]={...r,value:new F(o,a,l)}}else r.type==="TextSet"?e[i]={...r,value:new Set(r.value)}:r.type==="Select"?e[i]={...r,options:new Set(r.options)}:e[i]={...r};else e[i]={},this.import(r,e[i],!1)}s&&this.set(e)}};const bA=class _A extends me{constructor(t){super(t),z(this,"list",new Sc),z(this,"enabled",!0),t.add(_A.uuid,this)}};z(bA,"uuid","b8c764e0-6b24-4e77-9a32-35fa728ee5b4");let Ev=bA,nz=class{constructor(t){z(this,"_event"),z(this,"_position",new Ut),z(this,"onDisposed",new yt),z(this,"updateMouseInfo",e=>{this._event=e}),this.dom=t,this.setupEvents(!0)}get position(){return this.updatePosition(!1),this._position.clone()}get rawPosition(){return this.updatePosition(!0),this._position.clone()}dispose(){this.setupEvents(!1),this.onDisposed.trigger(),this.onDisposed.reset()}updatePosition(t){if(this._event){const e=this.dom.getBoundingClientRect();this._position.x=this.getPositionX(e,this._event,t),this._position.y=this.getPositionY(e,this._event,t)}}getPositionY(t,e,s){const i=this.getDataObject(e);return s?i.clientY:-((i.clientY-t.top)/(t.bottom-t.top))*2+1}getPositionX(t,e,s){const i=this.getDataObject(e);return s?i.clientX:(i.clientX-t.left)/(t.right-t.left)*2-1}getDataObject(t){return t instanceof MouseEvent?t:t.touches[0]}setupEvents(t){t?(this.dom.addEventListener("pointermove",this.updateMouseInfo),this.dom.addEventListener("touchstart",this.updateMouseInfo)):(this.dom.removeEventListener("pointermove",this.updateMouseInfo),this.dom.removeEventListener("touchstart",this.updateMouseInfo))}};const yA=class vA extends me{constructor(t){super(t),z(this,"onDisposed",new yt),z(this,"onFragmentsLoaded",new yt),z(this,"baseCoordinationModel",""),z(this,"baseCoordinationMatrix",new xt),z(this,"enabled",!0),z(this,"initialized",!1),z(this,"_core"),this.components.add(vA.uuid,this)}get list(){return this.core.models.list}get core(){if(!this._core)throw new Error("FragmentsManager not initialized. Call init() first.");return this._core}dispose(){this._core&&(this.core.dispose(),this._core=void 0),this.baseCoordinationModel="",this.onFragmentsLoaded.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}init(t){this._core=new nv(t),this.initialized=!0,this.core.onModelLoaded.add(async e=>{this.list.size===1&&(this.baseCoordinationModel=e.modelId,this.baseCoordinationMatrix=await e.getCoordinationMatrix())}),this.list.onItemDeleted.add(()=>{this.list.size>0||(this.baseCoordinationModel="",this.baseCoordinationMatrix=new xt)})}async raycast(t){const e=[];for(const r of this.core.models.list.values())if(t.snappingClasses&&t.snappingClasses.length>0){const o=await r.raycastWithSnapping(t);if(o&&o.length>0)e.push(o[0]);else{const a=await r.raycast(t);a&&e.push(a)}}else{const o=await r.raycast(t);o&&e.push(o)}if(await Promise.all(e),e.length===0)return;let s=e[0],i=s.distance;for(let r=1;r<e.length;r++)e[r].distance<i&&(i=e[r].distance,s=e[r]);return s}async getPositions(t){const e=[],s=async(r,o)=>{const a=await r.getPositions(o);for(const l of a)e.push(l)},i=[];for(const r in t){const o=this.core.models.list.get(r);o&&i.push(s(o,Array.from(t[r])))}return await Promise.all(i),e}async getBBoxes(t){const e=[],s=async(r,o)=>{const a=await r.getBoxes(o);if(a)for(const l of a)e.push(l)},i=[];for(const r in t){const o=this.core.models.list.get(r);o&&i.push(s(o,Array.from(t[r])))}return await Promise.all(i),e}async highlight(t,e){await this.forEachModel(e,"highlight",t)}async getData(t,e){const s={};for(const[i,r]of Object.entries(t)){const o=this.list.get(i);if(!o)continue;const a=await o.getItemsData([...r],e);s[i]=a}return s}async resetHighlight(t){await this.forEachModel(t,"resetHighlight")}async forEachModel(t,e,...s){const i={};if(t)for(const o in t){const a=t[o];i[o]=Array.from(a)}else for(const o of this.core.models.list.keys())i[o]=void 0;const r=[];for(const o in i){const a=this.core.models.list.get(o);if(a){const l=i[o],c=a[e](l,...s);r.push(c)}}await Promise.all(r)}async guidsToModelIdMap(t){const e={};for(const[s,i]of this.list){const r=(await i.getLocalIdsByGuids([...t])).filter(o=>o!==null);e[s]=new Set(r)}return e}async modelIdMapToGuids(t){const e=[];for(const[s,i]of Object.entries(t)){const r=this.list.get(s);if(!r)continue;const o=(await r.getGuidsByLocalIds([...i])).filter(a=>a!==null);e.push(...o)}return e}applyBaseCoordinateSystem(t,e){const s=new xt;return e&&s.copy(e.clone()).invert(),s.multiply(this.baseCoordinationMatrix),t.applyMatrix4(s),s}};z(yA,"uuid","fef46874-46a3-461b-8c44-2922ab77c806");let Mt=yA,rz=class{constructor(){z(this,"wasm",{path:"",absolute:!1,logLevel:pg.LOG_LEVEL_OFF}),z(this,"webIfc",{COORDINATE_TO_ORIGIN:!0}),z(this,"autoSetWasm",!0),z(this,"customLocateFileHandler",null)}};const oz=class q0 extends me{constructor(t){super(t),z(this,"onDisposed",new yt),z(this,"onIfcStartedLoading",new yt),z(this,"onSetup",new yt),z(this,"settings",new rz),z(this,"webIfc",new Wa),z(this,"enabled",!0),this.components.add(q0.uuid,this)}dispose(){this.webIfc=null,this.onDisposed.trigger(q0.uuid),this.onDisposed.reset()}async setup(t){this.settings={...this.settings,...t},this.settings.autoSetWasm&&await this.autoSetWasm(),this.onSetup.trigger()}async load(t,e,s,i){const r=this.components.get(Mt);if(!r.initialized)throw new Error("You need to initialize fragments first.");this.settings.autoSetWasm&&await this.autoSetWasm(),r.core.settings.autoCoordinate=e;const o=new rv;o.wasm.path=this.settings.wasm.path,o.wasm.absolute=this.settings.wasm.absolute,i!=null&&i.instanceCallback&&i.instanceCallback(o);const a=await o.process({...i?.processData,bytes:t});return await r.core.load(a,{modelId:s,userData:i?.userData})}async readIfcFile(t){const{path:e,absolute:s,logLevel:i}=this.settings.wasm;return this.webIfc.SetWasmPath(e,s),await this.webIfc.Init(this.settings.customLocateFileHandler||void 0),i&&this.webIfc.SetLogLevel(i),this.webIfc.OpenModel(t,this.settings.webIfc)}cleanUp(){try{this.webIfc.Dispose()}catch{console.log("Web-ifc wasn't disposed.")}this.webIfc=null,this.webIfc=new Wa}async autoSetWasm(){const t=await fetch(`https://unpkg.com/@thatopen/components@${HA.release}/package.json`);if(!t.ok){console.warn("Couldn't get openbim-components package.json. Set wasm settings manually.");return}const e=await t.json();if(!("web-ifc"in e.peerDependencies))console.warn("Couldn't get web-ifc from peer dependencies in openbim-components. Set wasm settings manually.");else{const s=e.peerDependencies["web-ifc"];this.settings.wasm.path=`https://unpkg.com/web-ifc@${s}/`,this.settings.wasm.absolute=!0}}};z(oz,"uuid","a659add7-1418-4771-a0d6-7d4d438e4624");const wA=class EA extends me{constructor(t){super(t),z(this,"enabled",!0),this.components.add(EA.uuid,this)}async set(t,e){const s=this.components.get(Mt),i=[];if(e)for(const[r,o]of Object.entries(e)){const a=s.list.get(r);a&&i.push(a.setVisible([...o],t))}else for(const r of s.list.values())i.push(r.setVisible(void 0,t));await Promise.all(i),await s.core.update(!0)}async isolate(t){await Promise.all([this.set(!1),this.set(!0,t)])}async toggle(t){const e=[],s=this.components.get(Mt);for(const[i,r]of Object.entries(t)){const o=s.list.get(i);o&&e.push(o.toggleVisible([...r]))}await Promise.all(e),await s.core.update(!0)}async getVisibilityMap(t,e){const s=[],i=[],r=this.components.get(Mt);if(e)for(const l of e){const c=r.list.get(l);c&&(s.push(c.modelId),i.push(c.getItemsByVisibility(t)))}else for(const l of r.list.values())s.push(l.modelId),i.push(l.getItemsByVisibility(t));const o=await Promise.all(i),a={};for(const[l,c]of s.entries())a[c]=o[l];return a}};z(wA,"uuid","dd9ccf2d-8a21-4821-b7f6-2949add16a29");let az=wA;const xA=class Z0 extends me{constructor(t){super(t),z(this,"enabled",!0),z(this,"onDisposed",new yt),z(this,"list",new fe),this.components.add(Z0.uuid,this)}dispose(t=!0){this.list.clear(),this.onDisposed.trigger(Z0.uuid),t&&(this.onDisposed.reset(),this.list.eventsEnabled=!1,this.list.dispose())}get(){const t=new Tt;for(const e of this.list)t.union(e);return t}async addFromModelIdMap(t){const e=this.components.get(Mt),s=new Tt;for(const[i,r]of Object.entries(t)){const o=e.list.get(i);if(!o)continue;const a=await o.getMergedBox([...r]);s.union(a)}this.list.add(s)}addFromModels(t){const e=this.components.get(Mt);for(const[s,i]of e.list)t&&!t.some(r=>r.test(s))||this.list.add(i.box)}async getCenter(t){this.list.clear(),await this.addFromModelIdMap(t);const e=this.get();this.list.clear();const s=new F;return e.getCenter(s),s}async getCameraOrientation(t,e=1){const s=this.components.get(Mt);this.list.clear();for(const[c,h]of s.list)this.list.add(h.box);const i=this.get();this.list.clear();const r=new F;i.getCenter(r);const o=new F;i.getSize(o);const a=Math.max(o.x,o.y,o.z)*e,l=new F;switch(t){case"front":l.set(r.x,r.y,r.z+a);break;case"back":l.set(r.x,r.y,r.z-a);break;case"left":l.set(r.x-a,r.y,r.z);break;case"right":l.set(r.x+a,r.y,r.z);break;case"top":l.set(r.x,r.y+a,r.z);break;case"bottom":l.set(r.x,r.y-a,r.z);break;default:l.set(r.x,r.y,r.z+a)}return{position:l,target:r}}};z(xA,"uuid","d1444724-dba6-4cdd-a0c7-68ee1450d166");let Dm=xA,lz=class{constructor(t,e){z(this,"description"),z(this,"_components"),z(this,"_queries",[]),z(this,"_aggregation","exclusive"),z(this,"result",null),z(this,"cache",!0),z(this,"serializeQueryParameters",s=>{var i;return{categories:(i=s.categories)==null?void 0:i.map(r=>r.source),attributes:s.attributes?{aggregation:s.attributes.aggregation,queries:s.attributes.queries.map(this.serializeAttributeQuery)}:void 0,relation:s.relation?{name:s.relation.name,query:s.relation.query?this.serializeQueryParameters(s.relation.query):void 0}:void 0}}),z(this,"deserializeQueryParameters",s=>{var i;return{categories:(i=s.categories)==null?void 0:i.map(r=>new RegExp(r)),attributes:s.attributes?{aggregation:s.attributes.aggregation,queries:s.attributes.queries.map(this.deserializeAttributeQuery)}:void 0,relation:s.relation?{name:s.relation.name,query:s.relation.query?this.deserializeQueryParameters(s.relation.query):void 0}:void 0}}),this._components=t,this.queries=e}set queries(t){this._queries=t,this.clearCache()}get queries(){return this._queries}set aggregation(t){t!==this._aggregation&&this.clearCache(),this._aggregation=t}get aggregation(){return this._aggregation}async test(t){const{modelIds:e,force:s}={force:!1,...t};if(this.result&&!s)return this.result;const i=await this._components.get(um).getItems(this.queries,{modelIds:e,aggregation:this.aggregation});return this.cache&&(this.result=i),i}clearCache(){this.result=null}serializeAttributeQuery(t){let e;return Array.isArray(t.value)?e=t.value.map(s=>s.source):t.value instanceof RegExp?e=t.value.source:e=t.value,{name:t.name.source,value:e,type:t.type instanceof RegExp?t.type.source:t.type,negate:t.negate,itemIds:t.itemIds}}toJSON(){return{name:"Finder Query",description:this.description,queries:this.queries.map(this.serializeQueryParameters),aggregation:this.aggregation,cache:this.cache}}deserializeAttributeQuery(t){let e;return Array.isArray(t.value)?e=t.value.map(s=>new RegExp(s)):typeof t.value=="string"?e=new RegExp(t.value):e=t.value,{name:new RegExp(t.name),value:e,type:t.type?new RegExp(t.type):void 0,negate:t.negate,itemIds:t.itemIds}}fromJSON(t){return this.description=t.description,this.aggregation=t.aggregation,this.cache=t.cache,this.queries=t.queries.map(this.deserializeQueryParameters),this}};const IA=class CA extends me{constructor(t){super(t),z(this,"enabled",!0),z(this,"list",new Yt),t.add(CA.uuid,this)}async getItems(t,e){const{modelIds:s}=e??{},i=e?.aggregation??"exclusive",r=this.components.get(Mt),o=await Promise.all(t.map(async a=>{const l={};return await Promise.all(Array.from(r.list).map(async([c,h])=>{if(s&&!s.some(p=>p.test(c)))return;const u=await h.getItemsByQuery(a);l[c]=new Set(u)})),l}));return i==="inclusive"?Qe.join(o):Qe.intersect(o)}create(t,e){const s=new lz(this.components,e);return this.list.set(t,s),s}async addFromCategories(t){const e=new Set,s=this.components.get(Mt);for(const[i,r]of s.list){if(t&&!t.some(l=>l.test(i)))continue;const o=(await r.getItemsWithGeometryCategories()).filter(l=>l!==null),a=new Set(o);for(const l of a)this.list.has(l)||(this.create(l,[{categories:[new RegExp(`^${l}$`)]}]),e.add(l))}return[...e]}import(t){const{data:e}=t,s=[];if(!e)return s;for(const i of e){const{name:r,description:o,queries:a,aggregation:l,cache:c}=i,h=this.create(r,[]);h.fromJSON({description:o,queries:a,aggregation:l,cache:c}),s.push(h)}return s}export(){const t=[];for(const[e,s]of this.list.entries()){const i={...s.toJSON(),name:e};t.push(i)}return{data:t}}};z(IA,"uuid","0da7ad77-f734-42ca-942f-a074adfd1e3a");let um=IA;const TA=class AA extends me{constructor(t){super(t),z(this,"enabled",!0),z(this,"onDisposed",new yt),z(this,"list",new Yt),z(this,"defaultSaveFunction",e=>"value"in e.Name?e.Name.value:null),z(this,"onBeforeFragmentsDispose",async e=>{const{key:s,value:i}=e,r=await i.getLocalIds(),o={[s]:new Set(r)};this.removeItems(o)}),t.add(AA.uuid,this),this.setupEvents(),t.get(Mt).list.onBeforeDelete.add(this.onBeforeFragmentsDispose)}setupEvents(){this.list.onBeforeDelete.add(({value:t})=>t.dispose())}getClassificationGroups(t){let e=this.list.get(t);return e||(e=new Yt,this.list.set(t,e)),e}getModelItems(t,e,s){const{map:i}=this.getGroupData(t,e);let r=i[s];return r||(r=new Set,i[s]=r),r}getGroupData(t,e){const s=this.components.get(um),i=this.getClassificationGroups(t);let r=i.get(e);return r||(r={map:{},get(){return new Promise(o=>{if(!r){o({});return}if(r.query){const{name:a,config:l}=r.query,c=s.list.get(a);if(!c)throw new Error("Classifier: the query name associated with the group doesn't exist in the ItemsFinder component");c.test(l).then(h=>{if(!r){o({});return}const u=Qe.join([h,r.map]);o(u)})}else o(r.map)})}},i.set(e,r)),r}async aggregateItems(t,e,s){const i=s?.data??void 0,r=s?.aggregationCallback??this.defaultSaveFunction,o=this.components.get(Mt),a=await this.components.get(um).getItems([e],{modelIds:s?.modelIds});for(const[l,c]of Object.entries(a)){const h=o.list.get(l);if(!h)continue;const u=(d,...g)=>{const m=this.getModelItems(t,d,l);for(const b of g)m.add(b)},p=await h.getItemsData([...c],i);for(const d of p)r(d,u)}}addGroupItems(t,e,s){const{map:i}=this.getGroupData(t,e);Qe.add(i,s)}setGroupQuery(t,e,s){const i=this.getGroupData(t,e);i.query=s}async find(t){const e=[];for(const[s,i]of Object.entries(t)){const r=[],o=this.list.get(s);if(!o)continue;for(const l of i){const c=o.get(l);if(!c)continue;const h=await c.get();r.push(h)}const a=Qe.join(r);e.push(a)}return Qe.intersect(e)}async aggregateItemRelations(t,e,s,i){const r=i?.attribute??"Name",o={relations:{[s]:{attributes:!0,relations:!1}}};await this.aggregateItems(t,e,{modelIds:i?.modelIds,data:o,aggregationCallback:(a,l)=>{if(!(a!=null&&a[r]))return;const c=a[r];if(!("value"in c))return;const h=a[s];if(Array.isArray(h))for(const u of h)"value"in u._localId&&l(c.value,u._localId.value)}})}async byIfcBuildingStorey(t){await this.aggregateItemRelations(t?.classificationName??"Storeys",{categories:[/BUILDINGSTOREY/]},"ContainsElements",{modelIds:t?.modelIds})}async byCategory(t){const e=await this.components.get(um).addFromCategories(t?.modelIds);for(const s of e)this.setGroupQuery(t?.classificationName??"Categories",s,{name:s})}dispose(){this.list.clear(),this.components.get(Mt).list.onBeforeDelete.remove(this.onBeforeFragmentsDispose),this.onDisposed.trigger()}removeItems(t,e){if(e&&e.classificationName){const s=this.list.get(e.classificationName);if(!s||e.groupName&&!s.get(e.groupName))return;for(const[,i]of s)Qe.remove(i.map,t);return}for(const[,s]of this.list.entries())for(const[,i]of s)Qe.remove(i.map,t)}async byModel(t){const e=this.components.get(Mt),s=t?.classificationName??"Models";for(const[i,r]of e.list){if(t&&t.modelIds&&!t.modelIds.some(l=>l.test(i)))continue;const o=await r.getItemsIdsWithGeometry(),a={[i]:new Set(o)};this.getGroupData(s,i),this.addGroupItems(s,i,a)}}};z(TA,"uuid","e25a7f3c-46c4-4a14-9d3d-5115f24ebeb7");let cz=TA;class hz{constructor(t,e){z(this,"enabled",!0),z(this,"components"),z(this,"onDisposed",new yt),z(this,"mouse"),z(this,"three",new el),z(this,"world");const s=e.renderer;if(!s)throw new Error("A renderer is needed for the raycaster to work!");this.world=e,this.mouse=new nz(s.three.domElement),this.components=t}dispose(){this.mouse.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}castRayToObjects(t=Array.from(this.world.meshes),e=this.mouse.position){if(!this.world)throw new Error("A world is needed to cast rays!");const s=this.world.camera.three;return this.three.setFromCamera(e,s),this.intersect(t)}async castRay(t){const e=t?.snappingClasses,s=t?.items??Array.from(this.world.meshes),i=t?.position??this.mouse.position;if(!this.world)throw new Error("A world is needed to cast rays!");const r=this.world.camera.three,o=this.components.get(Mt),a=this.world.renderer.three.domElement,l=this.mouse.rawPosition;let c=null;if(o.initialized&&(c=await o.raycast({camera:r,dom:a,mouse:l,snappingClasses:e}),s.length===0))return c;this.three.setFromCamera(i,r);const h=this.intersect(s);return c?h&&h.distance<c.distance?h:c:h}intersect(t=Array.from(this.world.meshes)){const e=this.three.intersectObjects(t),s=this.filterClippingPlanes(e);return s.length>0?s[0]:null}filterClippingPlanes(t){if(!this.world.renderer)throw new Error("Renderer not found!");const e=this.world.renderer.three;if(!e.clippingPlanes)return t;const s=e.clippingPlanes;return t.length<=0||!s||s?.length<=0?t:t.filter(i=>s.every(r=>r.distanceToPoint(i.point)>0))}}const SA=class OA extends me{constructor(t){super(t),z(this,"enabled",!0),z(this,"list",new Map),z(this,"onDisposed",new yt),t.add(OA.uuid,this)}get(t){if(this.list.has(t.uuid))return this.list.get(t.uuid);const e=new hz(this.components,t);return this.list.set(t.uuid,e),t.onDisposed.add(()=>{this.delete(t)}),e}delete(t){const e=this.list.get(t.uuid);e&&e.dispose(),this.list.delete(t.uuid)}dispose(){for(const[t,e]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger()}};z(SA,"uuid","d5d8bdf0-db25-4952-b951-b643af207ace");let ln=SA;class uz extends _v{constructor(){super(...arguments),z(this,"onCameraChanged",new yt),z(this,"meshes",new Set),z(this,"onAfterUpdate",new yt),z(this,"onBeforeUpdate",new yt),z(this,"onDisposed",new yt),z(this,"isDisposing",!1),z(this,"enabled",!0),z(this,"_dynamicAnchor",!1),z(this,"uuid",Ps.create()),z(this,"name"),z(this,"_scene"),z(this,"_camera"),z(this,"_renderer",null),z(this,"onPointerDown",async t=>{if(!this.camera.hasCameraControls())throw new Error("World: can't set dynamic anchor if the camera doesn't have controls.");const e=await this.components.get(ln).get(this).castRay();e&&e.point&&t.button===0&&this.camera.controls.setOrbitPoint(e.point.x,e.point.y,e.point.z)}),z(this,"_defaultCamera")}set dynamicAnchor(t){var e;const s=(e=this.renderer)==null?void 0:e.three.domElement.parentElement;if(!s)throw new Error("World: the renderer must have a parentElement to set dynamic anchoring.");t?(this.camera.controls&&(this.camera.controls.minDistance=.01),s.addEventListener("pointerdown",this.onPointerDown)):s.removeEventListener("pointerdown",this.onPointerDown)}get dynamicAnchor(){return this._dynamicAnchor}get defaultCamera(){if(!this._defaultCamera)throw new Error("World: there is no default camera defined.");return this._defaultCamera}set defaultCamera(t){this._defaultCamera=t}get scene(){if(!this._scene)throw new Error("No scene initialized!");return this._scene}set scene(t){this._scene=t,t.worlds.set(this.uuid,this),t.currentWorld=this,t.onWorldChanged.trigger({world:this,action:"added"})}get camera(){if(!this._camera)throw new Error("No camera initialized!");return this._camera}set camera(t){this._camera||(this.defaultCamera=t),this._camera=t,t.currentWorld=this,this.onCameraChanged.trigger(t)}get renderer(){return this._renderer}set renderer(t){this._renderer=t,t&&(t.worlds.set(this.uuid,this),t.currentWorld=this,t.onWorldChanged.trigger({world:this,action:"added"}))}useDefaultCamera(){this.camera=this.defaultCamera}update(t){this.enabled&&(!this._scene||!this._camera||(this.scene.currentWorld=this,this.camera.currentWorld=this,this.renderer&&(this.renderer.currentWorld=this),this.onBeforeUpdate.trigger(),this.scene.isUpdateable()&&this.scene.update(t),this.camera.isUpdateable()&&this.camera.update(t),this.renderer&&this.renderer.update(t),this.onAfterUpdate.trigger()))}dispose(t=!0){if(this.enabled=!1,this.isDisposing=!0,this.scene.onWorldChanged.trigger({world:this,action:"removed"}),this.camera.onWorldChanged.trigger({world:this,action:"removed"}),this.renderer&&this.renderer.onWorldChanged.trigger({world:this,action:"removed"}),t){const e=this.components.get(mr);this.scene.dispose(),this.camera.isDisposeable()&&this.camera.dispose(),this.renderer&&this.renderer.dispose();for(const s of this.meshes)e.destroy(s);this.meshes.clear()}this._scene=null,this._camera=null,this._renderer=null,this.components.get($A).list.delete(this.uuid),this.onDisposed.trigger(),this.onDisposed.reset()}}class dz extends Uk{constructor(t,e,s){super(t),z(this,"enabled",!0),z(this,"container"),z(this,"three"),z(this,"_canvas"),z(this,"_parameters"),z(this,"_resizeObserver",null),z(this,"onContainerUpdated",new yt),z(this,"_resizing",!1),z(this,"resize",o=>{if(this._resizing)return;this._resizing=!0,this.onContainerUpdated.trigger();const a=o?o.x:this.container.clientWidth,l=o?o.y:this.container.clientHeight;this.three.setSize(a,l),this.onResize.trigger(new Ut(a,l)),this._resizing=!1}),z(this,"resizeEvent",()=>{this.resize()}),z(this,"onContextLost",o=>{o.preventDefault(),this.enabled=!1}),z(this,"onContextBack",()=>{this.three.setRenderTarget(null),this.three.dispose(),this.three=new wm({canvas:this._canvas,antialias:!0,alpha:!0,...this._parameters}),this.enabled=!0}),this.container=e,this._parameters=s,this.three=new wm({antialias:!0,alpha:!0,...s}),this.three.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.setupRenderer(),this.setupEvents(!0),this.resize(),this._canvas=this.three.domElement;const i=this.three.getContext(),{canvas:r}=i;r.addEventListener("webglcontextlost",this.onContextLost,!1),r.addEventListener("webglcontextrestored",this.onContextBack,!1)}update(){if(!this.enabled||!this.currentWorld)return;this.onBeforeUpdate.trigger(this);const t=this.currentWorld.scene.three,e=this.currentWorld.camera.three;this.three.render(t,e),this.onAfterUpdate.trigger(this)}dispose(){this.enabled=!1,this.setupEvents(!1),this.three.domElement.remove(),this.three.forceContextLoss(),this.three.dispose(),this.onResize.reset(),this.onAfterUpdate.reset(),this.onBeforeUpdate.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}getSize(){return new Ut(this.three.domElement.clientWidth,this.three.domElement.clientHeight)}setupEvents(t){const e=this.three.domElement.parentElement;if(!e)throw new Error("This renderer needs to have an HTML container!");this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null),window.removeEventListener("resize",this.resizeEvent),t&&(this._resizeObserver=new ResizeObserver(this.resizeEvent),this._resizeObserver.observe(e),window.addEventListener("resize",this.resizeEvent))}setupRenderer(){this.three.localClippingEnabled=!0,this.container&&this.container.appendChild(this.three.domElement),this.onContainerUpdated.trigger()}}/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const Le={LEFT:1,RIGHT:2,MIDDLE:4},at=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,SCREEN_PAN:4,OFFSET:8,DOLLY:16,ZOOM:32,TOUCH_ROTATE:64,TOUCH_TRUCK:128,TOUCH_SCREEN_PAN:256,TOUCH_OFFSET:512,TOUCH_DOLLY:1024,TOUCH_ZOOM:2048,TOUCH_DOLLY_TRUCK:4096,TOUCH_DOLLY_SCREEN_PAN:8192,TOUCH_DOLLY_OFFSET:16384,TOUCH_DOLLY_ROTATE:32768,TOUCH_ZOOM_TRUCK:65536,TOUCH_ZOOM_OFFSET:131072,TOUCH_ZOOM_SCREEN_PAN:262144,TOUCH_ZOOM_ROTATE:524288}),Ll={NONE:0,IN:1,OUT:-1};function la(n){return n.isPerspectiveCamera}function lo(n){return n.isOrthographicCamera}const $l=Math.PI*2,_E=Math.PI/2,PA=1e-5,jh=Math.PI/180;function An(n,t,e){return Math.max(t,Math.min(e,n))}function _e(n,t=PA){return Math.abs(n)<t}function ie(n,t,e=PA){return _e(n-t,e)}function yE(n,t){return Math.round(n/t)*t}function Wh(n){return isFinite(n)?n:n<0?-Number.MAX_VALUE:Number.MAX_VALUE}function Yh(n){return Math.abs(n)<Number.MAX_VALUE?n:n*(1/0)}function gf(n,t,e,s,i=1/0,r){s=Math.max(1e-4,s);const o=2/s,a=o*r,l=1/(1+a+.48*a*a+.235*a*a*a);let c=n-t;const h=t,u=i*s;c=An(c,-u,u),t=n-c;const p=(e.value+o*c)*r;e.value=(e.value-o*p)*l;let d=t+(c+p)*l;return h-n>0==d>h&&(d=h,e.value=(d-h)/r),d}function vE(n,t,e,s,i=1/0,r,o){s=Math.max(1e-4,s);const a=2/s,l=a*r,c=1/(1+l+.48*l*l+.235*l*l*l);let h=t.x,u=t.y,p=t.z,d=n.x-h,g=n.y-u,m=n.z-p;const b=h,f=u,_=p,y=i*s,v=y*y,w=d*d+g*g+m*m;if(w>v){const N=Math.sqrt(w);d=d/N*y,g=g/N*y,m=m/N*y}h=n.x-d,u=n.y-g,p=n.z-m;const I=(e.x+a*d)*r,C=(e.y+a*g)*r,A=(e.z+a*m)*r;e.x=(e.x-a*I)*c,e.y=(e.y-a*C)*c,e.z=(e.z-a*A)*c,o.x=h+(d+I)*c,o.y=u+(g+C)*c,o.z=p+(m+A)*c;const S=b-n.x,P=f-n.y,M=_-n.z,T=o.x-b,L=o.y-f,E=o.z-_;return S*T+P*L+M*E>0&&(o.x=b,o.y=f,o.z=_,e.x=(o.x-b)/r,e.y=(o.y-f)/r,e.z=(o.z-_)/r),o}function h_(n,t){t.set(0,0),n.forEach(e=>{t.x+=e.clientX,t.y+=e.clientY}),t.x/=n.length,t.y/=n.length}function u_(n,t){return lo(n)?(console.warn(`${t} is not supported in OrthographicCamera`),!0):!1}class pz{constructor(){this._listeners={}}addEventListener(t,e){const s=this._listeners;s[t]===void 0&&(s[t]=[]),s[t].indexOf(e)===-1&&s[t].push(e)}hasEventListener(t,e){const s=this._listeners;return s[t]!==void 0&&s[t].indexOf(e)!==-1}removeEventListener(t,e){const s=this._listeners[t];if(s!==void 0){const i=s.indexOf(e);i!==-1&&s.splice(i,1)}}removeAllEventListeners(t){if(!t){this._listeners={};return}Array.isArray(this._listeners[t])&&(this._listeners[t].length=0)}dispatchEvent(t){const e=this._listeners[t.type];if(e!==void 0){t.target=this;const s=e.slice(0);for(let i=0,r=s.length;i<r;i++)s[i].call(this,t)}}}var d_;const fz="2.10.1",bf=1/8,mz=/Mac/.test((d_=globalThis?.navigator)===null||d_===void 0?void 0:d_.platform);let $t,wE,_f,p_,Xs,Ht,Qt,Nl,Gh,Yn,Gn,ca,EE,xE,Mi,qh,Ml,IE,f_,CE,m_,g_,yf,_i=class X0 extends pz{static install(t){$t=t.THREE,wE=Object.freeze(new $t.Vector3(0,0,0)),_f=Object.freeze(new $t.Vector3(0,1,0)),p_=Object.freeze(new $t.Vector3(0,0,1)),Xs=new $t.Vector2,Ht=new $t.Vector3,Qt=new $t.Vector3,Nl=new $t.Vector3,Gh=new $t.Vector3,Yn=new $t.Vector3,Gn=new $t.Vector3,ca=new $t.Vector3,EE=new $t.Vector3,xE=new $t.Vector3,Mi=new $t.Spherical,qh=new $t.Spherical,Ml=new $t.Box3,IE=new $t.Box3,f_=new $t.Sphere,CE=new $t.Quaternion,m_=new $t.Quaternion,g_=new $t.Matrix4,yf=new $t.Raycaster}static get ACTION(){return at}set verticalDragToForward(t){console.warn("camera-controls: `verticalDragToForward` was removed. Use `mouseButtons.left = CameraControls.ACTION.SCREEN_PAN` instead.")}constructor(t,e){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=at.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=Ll.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new $t.Vector3,this._focalOffsetVelocity=new $t.Vector3,this._zoomVelocity={value:0},this._truckInternal=(f,_,y,v)=>{let w,I;if(la(this._camera)){const C=Ht.copy(this._camera.position).sub(this._target),A=this._camera.getEffectiveFOV()*jh,S=C.length()*Math.tan(A*.5);w=this.truckSpeed*f*S/this._elementRect.height,I=this.truckSpeed*_*S/this._elementRect.height}else if(lo(this._camera)){const C=this._camera;w=this.truckSpeed*f*(C.right-C.left)/C.zoom/this._elementRect.width,I=this.truckSpeed*_*(C.top-C.bottom)/C.zoom/this._elementRect.height}else return;v?(y?this.setFocalOffset(this._focalOffsetEnd.x+w,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(w,0,!0),this.forward(-I,!0)):y?this.setFocalOffset(this._focalOffsetEnd.x+w,this._focalOffsetEnd.y+I,this._focalOffsetEnd.z,!0):this.truck(w,I,!0)},this._rotateInternal=(f,_)=>{const y=$l*this.azimuthRotateSpeed*f/this._elementRect.height,v=$l*this.polarRotateSpeed*_/this._elementRect.height;this.rotate(y,v,!0)},this._dollyInternal=(f,_,y)=>{const v=Math.pow(.95,-f*this.dollySpeed),w=this._sphericalEnd.radius,I=this._sphericalEnd.radius*v,C=An(I,this.minDistance,this.maxDistance),A=C-I;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(I,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(A,!0),this._dollyToNoClamp(C,!0)):this._dollyToNoClamp(C,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?I:C)-w,this._dollyControlCoord.set(_,y)),this._lastDollyDirection=Math.sign(-f)},this._zoomInternal=(f,_,y)=>{const v=Math.pow(.95,f*this.dollySpeed),w=this._zoom,I=this._zoom*v;this.zoomTo(I,!0),this.dollyToCursor&&(this._changedZoom+=I-w,this._dollyControlCoord.set(_,y))},typeof $t>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=t,this._yAxisUpSpace=new $t.Quaternion().setFromUnitVectors(this._camera.up,_f),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=at.NONE,this._target=new $t.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new $t.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new $t.Spherical().setFromVector3(Ht.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new $t.Vector3,new $t.Vector3,new $t.Vector3,new $t.Vector3],this._updateNearPlaneCorners(),this._boundary=new $t.Box3(new $t.Vector3(-1/0,-1/0,-1/0),new $t.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new $t.Vector2,this.mouseButtons={left:at.ROTATE,middle:at.DOLLY,right:at.TRUCK,wheel:la(this._camera)?at.DOLLY:lo(this._camera)?at.ZOOM:at.NONE},this.touches={one:at.TOUCH_ROTATE,two:la(this._camera)?at.TOUCH_DOLLY_TRUCK:lo(this._camera)?at.TOUCH_ZOOM_TRUCK:at.NONE,three:at.TOUCH_TRUCK};const s=new $t.Vector2,i=new $t.Vector2,r=new $t.Vector2,o=f=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const v=this._domElement.getBoundingClientRect(),w=f.clientX/v.width,I=f.clientY/v.height;if(w<this._interactiveArea.left||w>this._interactiveArea.right||I<this._interactiveArea.top||I>this._interactiveArea.bottom)return}const _=f.pointerType!=="mouse"?null:(f.buttons&Le.LEFT)===Le.LEFT?Le.LEFT:(f.buttons&Le.MIDDLE)===Le.MIDDLE?Le.MIDDLE:(f.buttons&Le.RIGHT)===Le.RIGHT?Le.RIGHT:null;if(_!==null){const v=this._findPointerByMouseButton(_);v&&this._disposePointer(v)}if((f.buttons&Le.LEFT)===Le.LEFT&&this._lockedPointer)return;const y={pointerId:f.pointerId,clientX:f.clientX,clientY:f.clientY,deltaX:0,deltaY:0,mouseButton:_};this._activePointers.push(y),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),this._isDragging=!0,p(f)},a=f=>{f.cancelable&&f.preventDefault();const _=f.pointerId,y=this._lockedPointer||this._findPointerById(_);if(y){if(y.clientX=f.clientX,y.clientY=f.clientY,y.deltaX=f.movementX,y.deltaY=f.movementY,this._state=0,f.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(f.buttons&Le.LEFT)===Le.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(f.buttons&Le.MIDDLE)===Le.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(f.buttons&Le.RIGHT)===Le.RIGHT&&(this._state=this._state|this.mouseButtons.right);d()}},l=f=>{const _=this._findPointerById(f.pointerId);if(!(_&&_===this._lockedPointer)){if(_&&this._disposePointer(_),f.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=at.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=at.NONE;g()}};let c=-1;const h=f=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===at.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const I=this._domElement.getBoundingClientRect(),C=f.clientX/I.width,A=f.clientY/I.height;if(C<this._interactiveArea.left||C>this._interactiveArea.right||A<this._interactiveArea.top||A>this._interactiveArea.bottom)return}if(f.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===at.ROTATE||this.mouseButtons.wheel===at.TRUCK){const I=performance.now();c-I<1e3&&this._getClientRect(this._elementRect),c=I}const _=mz?-1:-3,y=f.deltaMode===1||f.ctrlKey?f.deltaY/_:f.deltaY/(_*10),v=this.dollyToCursor?(f.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,w=this.dollyToCursor?(f.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case at.ROTATE:{this._rotateInternal(f.deltaX,f.deltaY),this._isUserControllingRotate=!0;break}case at.TRUCK:{this._truckInternal(f.deltaX,f.deltaY,!1,!1),this._isUserControllingTruck=!0;break}case at.SCREEN_PAN:{this._truckInternal(f.deltaX,f.deltaY,!1,!0),this._isUserControllingTruck=!0;break}case at.OFFSET:{this._truckInternal(f.deltaX,f.deltaY,!0,!1),this._isUserControllingOffset=!0;break}case at.DOLLY:{this._dollyInternal(-y,v,w),this._isUserControllingDolly=!0;break}case at.ZOOM:{this._zoomInternal(-y,v,w),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},u=f=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===X0.ACTION.NONE){const _=f instanceof PointerEvent?f.pointerId:0,y=this._findPointerById(_);y&&this._disposePointer(y),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l);return}f.preventDefault()}},p=f=>{if(this._enabled){if(h_(this._activePointers,Xs),this._getClientRect(this._elementRect),s.copy(Xs),i.copy(Xs),this._activePointers.length>=2){const _=Xs.x-this._activePointers[1].clientX,y=Xs.y-this._activePointers[1].clientY,v=Math.sqrt(_*_+y*y);r.set(0,v);const w=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,I=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;i.set(w,I)}if(this._state=0,!f)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in f&&f.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(f.buttons&Le.LEFT)===Le.LEFT&&(this._state=this._state|this.mouseButtons.left),(f.buttons&Le.MIDDLE)===Le.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(f.buttons&Le.RIGHT)===Le.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&at.ROTATE)===at.ROTATE||(this._state&at.TOUCH_ROTATE)===at.TOUCH_ROTATE||(this._state&at.TOUCH_DOLLY_ROTATE)===at.TOUCH_DOLLY_ROTATE||(this._state&at.TOUCH_ZOOM_ROTATE)===at.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&at.TRUCK)===at.TRUCK||(this._state&at.SCREEN_PAN)===at.SCREEN_PAN||(this._state&at.TOUCH_TRUCK)===at.TOUCH_TRUCK||(this._state&at.TOUCH_SCREEN_PAN)===at.TOUCH_SCREEN_PAN||(this._state&at.TOUCH_DOLLY_TRUCK)===at.TOUCH_DOLLY_TRUCK||(this._state&at.TOUCH_DOLLY_SCREEN_PAN)===at.TOUCH_DOLLY_SCREEN_PAN||(this._state&at.TOUCH_ZOOM_TRUCK)===at.TOUCH_ZOOM_TRUCK||(this._state&at.TOUCH_ZOOM_SCREEN_PAN)===at.TOUCH_DOLLY_SCREEN_PAN)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&at.DOLLY)===at.DOLLY||(this._state&at.TOUCH_DOLLY)===at.TOUCH_DOLLY||(this._state&at.TOUCH_DOLLY_TRUCK)===at.TOUCH_DOLLY_TRUCK||(this._state&at.TOUCH_DOLLY_SCREEN_PAN)===at.TOUCH_DOLLY_SCREEN_PAN||(this._state&at.TOUCH_DOLLY_OFFSET)===at.TOUCH_DOLLY_OFFSET||(this._state&at.TOUCH_DOLLY_ROTATE)===at.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&at.ZOOM)===at.ZOOM||(this._state&at.TOUCH_ZOOM)===at.TOUCH_ZOOM||(this._state&at.TOUCH_ZOOM_TRUCK)===at.TOUCH_ZOOM_TRUCK||(this._state&at.TOUCH_ZOOM_SCREEN_PAN)===at.TOUCH_ZOOM_SCREEN_PAN||(this._state&at.TOUCH_ZOOM_OFFSET)===at.TOUCH_ZOOM_OFFSET||(this._state&at.TOUCH_ZOOM_ROTATE)===at.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&at.OFFSET)===at.OFFSET||(this._state&at.TOUCH_OFFSET)===at.TOUCH_OFFSET||(this._state&at.TOUCH_DOLLY_OFFSET)===at.TOUCH_DOLLY_OFFSET||(this._state&at.TOUCH_ZOOM_OFFSET)===at.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})}},d=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,h_(this._activePointers,Xs);const f=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,_=f?-f.deltaX:i.x-Xs.x,y=f?-f.deltaY:i.y-Xs.y;if(i.copy(Xs),((this._state&at.ROTATE)===at.ROTATE||(this._state&at.TOUCH_ROTATE)===at.TOUCH_ROTATE||(this._state&at.TOUCH_DOLLY_ROTATE)===at.TOUCH_DOLLY_ROTATE||(this._state&at.TOUCH_ZOOM_ROTATE)===at.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(_,y),this._isUserControllingRotate=!0),(this._state&at.DOLLY)===at.DOLLY||(this._state&at.ZOOM)===at.ZOOM){const v=this.dollyToCursor?(s.x-this._elementRect.x)/this._elementRect.width*2-1:0,w=this.dollyToCursor?(s.y-this._elementRect.y)/this._elementRect.height*-2+1:0,I=this.dollyDragInverted?-1:1;(this._state&at.DOLLY)===at.DOLLY?(this._dollyInternal(I*y*bf,v,w),this._isUserControllingDolly=!0):(this._zoomInternal(I*y*bf,v,w),this._isUserControllingZoom=!0)}if((this._state&at.TOUCH_DOLLY)===at.TOUCH_DOLLY||(this._state&at.TOUCH_ZOOM)===at.TOUCH_ZOOM||(this._state&at.TOUCH_DOLLY_TRUCK)===at.TOUCH_DOLLY_TRUCK||(this._state&at.TOUCH_ZOOM_TRUCK)===at.TOUCH_ZOOM_TRUCK||(this._state&at.TOUCH_DOLLY_SCREEN_PAN)===at.TOUCH_DOLLY_SCREEN_PAN||(this._state&at.TOUCH_ZOOM_SCREEN_PAN)===at.TOUCH_ZOOM_SCREEN_PAN||(this._state&at.TOUCH_DOLLY_OFFSET)===at.TOUCH_DOLLY_OFFSET||(this._state&at.TOUCH_ZOOM_OFFSET)===at.TOUCH_ZOOM_OFFSET||(this._state&at.TOUCH_DOLLY_ROTATE)===at.TOUCH_DOLLY_ROTATE||(this._state&at.TOUCH_ZOOM_ROTATE)===at.TOUCH_ZOOM_ROTATE){const v=Xs.x-this._activePointers[1].clientX,w=Xs.y-this._activePointers[1].clientY,I=Math.sqrt(v*v+w*w),C=r.y-I;r.set(0,I);const A=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,S=this.dollyToCursor?(i.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&at.TOUCH_DOLLY)===at.TOUCH_DOLLY||(this._state&at.TOUCH_DOLLY_ROTATE)===at.TOUCH_DOLLY_ROTATE||(this._state&at.TOUCH_DOLLY_TRUCK)===at.TOUCH_DOLLY_TRUCK||(this._state&at.TOUCH_DOLLY_SCREEN_PAN)===at.TOUCH_DOLLY_SCREEN_PAN||(this._state&at.TOUCH_DOLLY_OFFSET)===at.TOUCH_DOLLY_OFFSET?(this._dollyInternal(C*bf,A,S),this._isUserControllingDolly=!0):(this._zoomInternal(C*bf,A,S),this._isUserControllingZoom=!0)}((this._state&at.TRUCK)===at.TRUCK||(this._state&at.TOUCH_TRUCK)===at.TOUCH_TRUCK||(this._state&at.TOUCH_DOLLY_TRUCK)===at.TOUCH_DOLLY_TRUCK||(this._state&at.TOUCH_ZOOM_TRUCK)===at.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(_,y,!1,!1),this._isUserControllingTruck=!0),((this._state&at.SCREEN_PAN)===at.SCREEN_PAN||(this._state&at.TOUCH_SCREEN_PAN)===at.TOUCH_SCREEN_PAN||(this._state&at.TOUCH_DOLLY_SCREEN_PAN)===at.TOUCH_DOLLY_SCREEN_PAN||(this._state&at.TOUCH_ZOOM_SCREEN_PAN)===at.TOUCH_ZOOM_SCREEN_PAN)&&(this._truckInternal(_,y,!1,!0),this._isUserControllingTruck=!0),((this._state&at.OFFSET)===at.OFFSET||(this._state&at.TOUCH_OFFSET)===at.TOUCH_OFFSET||(this._state&at.TOUCH_DOLLY_OFFSET)===at.TOUCH_DOLLY_OFFSET||(this._state&at.TOUCH_ZOOM_OFFSET)===at.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(_,y,!0,!1),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},g=()=>{h_(this._activePointers,Xs),i.copy(Xs),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",m),this._domElement.ownerDocument.addEventListener("pointerlockerror",b),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",l),p())},this.unlockPointer=()=>{var f,_,y;this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),(f=this._domElement)===null||f===void 0||f.ownerDocument.exitPointerLock(),(_=this._domElement)===null||_===void 0||_.ownerDocument.removeEventListener("pointerlockchange",m),(y=this._domElement)===null||y===void 0||y.ownerDocument.removeEventListener("pointerlockerror",b),this.cancel()};const m=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},b=()=>{this.unlockPointer()};this._addAllEventListeners=f=>{this._domElement=f,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",o),this._domElement.addEventListener("pointercancel",l),this._domElement.addEventListener("wheel",h,{passive:!1}),this._domElement.addEventListener("contextmenu",u)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",o),this._domElement.removeEventListener("pointercancel",l),this._domElement.removeEventListener("wheel",h,{passive:!1}),this._domElement.removeEventListener("contextmenu",u),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",l),this._domElement.ownerDocument.removeEventListener("pointerlockchange",m),this._domElement.ownerDocument.removeEventListener("pointerlockerror",b))},this.cancel=()=>{this._state!==at.NONE&&(this._state=at.NONE,this._activePointers.length=0,g())},e&&this.connect(e),this.update(0)}get camera(){return this._camera}set camera(t){this._camera=t,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._domElement&&(t?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(t){this._spherical.radius===t&&this._sphericalEnd.radius===t||(this._spherical.radius=t,this._sphericalEnd.radius=t,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(t){this._spherical.theta===t&&this._sphericalEnd.theta===t||(this._spherical.theta=t,this._sphericalEnd.theta=t,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(t){this._spherical.phi===t&&this._sphericalEnd.phi===t||(this._spherical.phi=t,this._sphericalEnd.phi=t,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(t){this._boundaryEnclosesCamera=t,this._needsUpdate=!0}set interactiveArea(t){this._interactiveArea.width=An(t.width,0,1),this._interactiveArea.height=An(t.height,0,1),this._interactiveArea.x=An(t.x,0,1-this._interactiveArea.width),this._interactiveArea.y=An(t.y,0,1-this._interactiveArea.height)}addEventListener(t,e){super.addEventListener(t,e)}removeEventListener(t,e){super.removeEventListener(t,e)}rotate(t,e,s=!1){return this.rotateTo(this._sphericalEnd.theta+t,this._sphericalEnd.phi+e,s)}rotateAzimuthTo(t,e=!1){return this.rotateTo(t,this._sphericalEnd.phi,e)}rotatePolarTo(t,e=!1){return this.rotateTo(this._sphericalEnd.theta,t,e)}rotateTo(t,e,s=!1){this._isUserControllingRotate=!1;const i=An(t,this.minAzimuthAngle,this.maxAzimuthAngle),r=An(e,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=i,this._sphericalEnd.phi=r,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,s||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const o=!s||ie(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&ie(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(o)}dolly(t,e=!1){return this.dollyTo(this._sphericalEnd.radius-t,e)}dollyTo(t,e=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=Ll.NONE,this._changedDolly=0,this._dollyToNoClamp(An(t,this.minDistance,this.maxDistance),e)}_dollyToNoClamp(t,e=!1){const s=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const r=this._collisionTest(),o=ie(r,this._spherical.radius);if(!(s>t)&&o)return Promise.resolve();this._sphericalEnd.radius=Math.min(t,r)}else this._sphericalEnd.radius=t;this._needsUpdate=!0,e||(this._spherical.radius=this._sphericalEnd.radius);const i=!e||ie(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(i)}dollyInFixed(t,e=!1){this._targetEnd.add(this._getCameraDirection(Gh).multiplyScalar(t)),e||this._target.copy(this._targetEnd);const s=!e||ie(this._target.x,this._targetEnd.x,this.restThreshold)&&ie(this._target.y,this._targetEnd.y,this.restThreshold)&&ie(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}zoom(t,e=!1){return this.zoomTo(this._zoomEnd+t,e)}zoomTo(t,e=!1){this._isUserControllingZoom=!1,this._zoomEnd=An(t,this.minZoom,this.maxZoom),this._needsUpdate=!0,e||(this._zoom=this._zoomEnd);const s=!e||ie(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(s)}pan(t,e,s=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(t,e,s)}truck(t,e,s=!1){this._camera.updateMatrix(),Yn.setFromMatrixColumn(this._camera.matrix,0),Gn.setFromMatrixColumn(this._camera.matrix,1),Yn.multiplyScalar(t),Gn.multiplyScalar(-e);const i=Ht.copy(Yn).add(Gn),r=Qt.copy(this._targetEnd).add(i);return this.moveTo(r.x,r.y,r.z,s)}forward(t,e=!1){Ht.setFromMatrixColumn(this._camera.matrix,0),Ht.crossVectors(this._camera.up,Ht),Ht.multiplyScalar(t);const s=Qt.copy(this._targetEnd).add(Ht);return this.moveTo(s.x,s.y,s.z,e)}elevate(t,e=!1){return Ht.copy(this._camera.up).multiplyScalar(t),this.moveTo(this._targetEnd.x+Ht.x,this._targetEnd.y+Ht.y,this._targetEnd.z+Ht.z,e)}moveTo(t,e,s,i=!1){this._isUserControllingTruck=!1;const r=Ht.set(t,e,s).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,r,this.boundaryFriction),this._needsUpdate=!0,i||this._target.copy(this._targetEnd);const o=!i||ie(this._target.x,this._targetEnd.x,this.restThreshold)&&ie(this._target.y,this._targetEnd.y,this.restThreshold)&&ie(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(o)}lookInDirectionOf(t,e,s,i=!1){const r=Ht.set(t,e,s).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(r.x,r.y,r.z,i)}fitToBox(t,e,{cover:s=!1,paddingLeft:i=0,paddingRight:r=0,paddingBottom:o=0,paddingTop:a=0}={}){const l=[],c=t.isBox3?Ml.copy(t):Ml.setFromObject(t);c.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const h=yE(this._sphericalEnd.theta,_E),u=yE(this._sphericalEnd.phi,_E);l.push(this.rotateTo(h,u,e));const p=Ht.setFromSpherical(this._sphericalEnd).normalize(),d=CE.setFromUnitVectors(p,p_),g=ie(Math.abs(p.y),1);g&&d.multiply(m_.setFromAxisAngle(_f,h)),d.multiply(this._yAxisUpSpaceInverse);const m=IE.makeEmpty();Qt.copy(c.min).applyQuaternion(d),m.expandByPoint(Qt),Qt.copy(c.min).setX(c.max.x).applyQuaternion(d),m.expandByPoint(Qt),Qt.copy(c.min).setY(c.max.y).applyQuaternion(d),m.expandByPoint(Qt),Qt.copy(c.max).setZ(c.min.z).applyQuaternion(d),m.expandByPoint(Qt),Qt.copy(c.min).setZ(c.max.z).applyQuaternion(d),m.expandByPoint(Qt),Qt.copy(c.max).setY(c.min.y).applyQuaternion(d),m.expandByPoint(Qt),Qt.copy(c.max).setX(c.min.x).applyQuaternion(d),m.expandByPoint(Qt),Qt.copy(c.max).applyQuaternion(d),m.expandByPoint(Qt),m.min.x-=i,m.min.y-=o,m.max.x+=r,m.max.y+=a,d.setFromUnitVectors(p_,p),g&&d.premultiply(m_.invert()),d.premultiply(this._yAxisUpSpace);const b=m.getSize(Ht),f=m.getCenter(Qt).applyQuaternion(d);if(la(this._camera)){const _=this.getDistanceToFitBox(b.x,b.y,b.z,s);l.push(this.moveTo(f.x,f.y,f.z,e)),l.push(this.dollyTo(_,e)),l.push(this.setFocalOffset(0,0,0,e))}else if(lo(this._camera)){const _=this._camera,y=_.right-_.left,v=_.top-_.bottom,w=s?Math.max(y/b.x,v/b.y):Math.min(y/b.x,v/b.y);l.push(this.moveTo(f.x,f.y,f.z,e)),l.push(this.zoomTo(w,e)),l.push(this.setFocalOffset(0,0,0,e))}return Promise.all(l)}fitToSphere(t,e){const s=[],i="isObject3D"in t?X0.createBoundingSphere(t,f_):f_.copy(t);if(s.push(this.moveTo(i.center.x,i.center.y,i.center.z,e)),la(this._camera)){const r=this.getDistanceToFitSphere(i.radius);s.push(this.dollyTo(r,e))}else if(lo(this._camera)){const r=this._camera.right-this._camera.left,o=this._camera.top-this._camera.bottom,a=2*i.radius,l=Math.min(r/a,o/a);s.push(this.zoomTo(l,e))}return s.push(this.setFocalOffset(0,0,0,e)),Promise.all(s)}setLookAt(t,e,s,i,r,o,a=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Ll.NONE,this._changedDolly=0;const l=Qt.set(i,r,o),c=Ht.set(t,e,s);this._targetEnd.copy(l),this._sphericalEnd.setFromVector3(c.sub(l).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,a||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const h=!a||ie(this._target.x,this._targetEnd.x,this.restThreshold)&&ie(this._target.y,this._targetEnd.y,this.restThreshold)&&ie(this._target.z,this._targetEnd.z,this.restThreshold)&&ie(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&ie(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&ie(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(h)}lerpLookAt(t,e,s,i,r,o,a,l,c,h,u,p,d,g=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Ll.NONE,this._changedDolly=0;const m=Ht.set(i,r,o),b=Qt.set(t,e,s);Mi.setFromVector3(b.sub(m).applyQuaternion(this._yAxisUpSpace));const f=Nl.set(h,u,p),_=Qt.set(a,l,c);qh.setFromVector3(_.sub(f).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(m.lerp(f,d));const y=qh.theta-Mi.theta,v=qh.phi-Mi.phi,w=qh.radius-Mi.radius;this._sphericalEnd.set(Mi.radius+w*d,Mi.phi+v*d,Mi.theta+y*d),this.normalizeRotations(),this._needsUpdate=!0,g||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const I=!g||ie(this._target.x,this._targetEnd.x,this.restThreshold)&&ie(this._target.y,this._targetEnd.y,this.restThreshold)&&ie(this._target.z,this._targetEnd.z,this.restThreshold)&&ie(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&ie(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&ie(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(I)}setPosition(t,e,s,i=!1){return this.setLookAt(t,e,s,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,i)}setTarget(t,e,s,i=!1){const r=this.getPosition(Ht),o=this.setLookAt(r.x,r.y,r.z,t,e,s,i);return this._sphericalEnd.phi=An(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),o}setFocalOffset(t,e,s,i=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(t,e,s),this._needsUpdate=!0,i||this._focalOffset.copy(this._focalOffsetEnd);const r=!i||ie(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&ie(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&ie(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}setOrbitPoint(t,e,s){this._camera.updateMatrixWorld(),Yn.setFromMatrixColumn(this._camera.matrixWorldInverse,0),Gn.setFromMatrixColumn(this._camera.matrixWorldInverse,1),ca.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const i=Ht.set(t,e,s),r=i.distanceTo(this._camera.position),o=i.sub(this._camera.position);Yn.multiplyScalar(o.x),Gn.multiplyScalar(o.y),ca.multiplyScalar(o.z),Ht.copy(Yn).add(Gn).add(ca),Ht.z=Ht.z+r,this.dollyTo(r,!1),this.setFocalOffset(-Ht.x,Ht.y,-Ht.z,!1),this.moveTo(t,e,s,!1)}setBoundary(t){if(!t){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(t),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(t,e,s,i){if(t===null){this._viewport=null;return}this._viewport=this._viewport||new $t.Vector4,typeof t=="number"?this._viewport.set(t,e,s,i):this._viewport.copy(t)}getDistanceToFitBox(t,e,s,i=!1){if(u_(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const r=t/e,o=this._camera.getEffectiveFOV()*jh,a=this._camera.aspect;return((i?r>a:r<a)?e:t/a)*.5/Math.tan(o*.5)+s*.5}getDistanceToFitSphere(t){if(u_(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const e=this._camera.getEffectiveFOV()*jh,s=Math.atan(Math.tan(e*.5)*this._camera.aspect)*2,i=1<this._camera.aspect?e:s;return t/Math.sin(i*.5)}getTarget(t,e=!0){return(t&&t.isVector3?t:new $t.Vector3).copy(e?this._targetEnd:this._target)}getPosition(t,e=!0){return(t&&t.isVector3?t:new $t.Vector3).setFromSpherical(e?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(e?this._targetEnd:this._target)}getSpherical(t,e=!0){return(t||new $t.Spherical).copy(e?this._sphericalEnd:this._spherical)}getFocalOffset(t,e=!0){return(t&&t.isVector3?t:new $t.Vector3).copy(e?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%$l,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=$l),this._spherical.theta+=$l*Math.round((this._sphericalEnd.theta-this._spherical.theta)/$l)}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(t=!1){if(!ie(this._camera.up.x,this._cameraUp0.x)||!ie(this._camera.up.y,this._cameraUp0.y)||!ie(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const s=this.getPosition(Ht);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}const e=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,t),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,t),this.zoomTo(this._zoom0,t)];return Promise.all(e)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,_f),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const t=Ht.subVectors(this._target,this._camera.position).normalize(),e=Qt.crossVectors(t,this._camera.up);this._camera.up.crossVectors(e,t).normalize(),this._camera.updateMatrixWorld();const s=this.getPosition(Ht);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}update(t){const e=this._sphericalEnd.theta-this._spherical.theta,s=this._sphericalEnd.phi-this._spherical.phi,i=this._sphericalEnd.radius-this._spherical.radius,r=EE.subVectors(this._targetEnd,this._target),o=xE.subVectors(this._focalOffsetEnd,this._focalOffset),a=this._zoomEnd-this._zoom;if(_e(e))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const h=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=gf(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,h,1/0,t),this._needsUpdate=!0}if(_e(s))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const h=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=gf(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,h,1/0,t),this._needsUpdate=!0}if(_e(i))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const h=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=gf(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,h,this.maxSpeed,t),this._needsUpdate=!0}if(_e(r.x)&&_e(r.y)&&_e(r.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const h=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;vE(this._target,this._targetEnd,this._targetVelocity,h,this.maxSpeed,t,this._target),this._needsUpdate=!0}if(_e(o.x)&&_e(o.y)&&_e(o.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const h=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;vE(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,h,this.maxSpeed,t,this._focalOffset),this._needsUpdate=!0}if(_e(a))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const h=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=gf(this._zoom,this._zoomEnd,this._zoomVelocity,h,1/0,t)}if(this.dollyToCursor){if(la(this._camera)&&this._changedDolly!==0){const h=this._spherical.radius-this._lastDistance,u=this._camera,p=this._getCameraDirection(Gh),d=Ht.copy(p).cross(u.up).normalize();d.lengthSq()===0&&(d.x=1);const g=Qt.crossVectors(d,p),m=this._sphericalEnd.radius*Math.tan(u.getEffectiveFOV()*jh*.5),b=(this._sphericalEnd.radius-h-this._sphericalEnd.radius)/this._sphericalEnd.radius,f=Nl.copy(this._targetEnd).add(d.multiplyScalar(this._dollyControlCoord.x*m*u.aspect)).add(g.multiplyScalar(this._dollyControlCoord.y*m)),_=Ht.copy(this._targetEnd).lerp(f,b),y=this._lastDollyDirection===Ll.IN&&this._spherical.radius<=this.minDistance,v=this._lastDollyDirection===Ll.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(y||v)){this._sphericalEnd.radius-=h,this._spherical.radius-=h;const I=Qt.copy(p).multiplyScalar(-h);_.add(I)}this._boundary.clampPoint(_,_);const w=Qt.subVectors(_,this._targetEnd);this._targetEnd.copy(_),this._target.add(w),this._changedDolly-=h,_e(this._changedDolly)&&(this._changedDolly=0)}else if(lo(this._camera)&&this._changedZoom!==0){const h=this._zoom-this._lastZoom,u=this._camera,p=Ht.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(u.near+u.far)/(u.near-u.far)).unproject(u),d=Qt.set(0,0,-1).applyQuaternion(u.quaternion),g=Nl.copy(p).add(d.multiplyScalar(-p.dot(u.up))),m=-(this._zoom-h-this._zoom)/this._zoom,b=this._getCameraDirection(Gh),f=this._targetEnd.dot(b),_=Ht.copy(this._targetEnd).lerp(g,m),y=_.dot(b),v=b.multiplyScalar(y-f);_.sub(v),this._boundary.clampPoint(_,_);const w=Qt.subVectors(_,this._targetEnd);this._targetEnd.copy(_),this._target.add(w),this._changedZoom-=h,_e(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const l=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,l),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!_e(this._focalOffset.x)||!_e(this._focalOffset.y)||!_e(this._focalOffset.z))&&(Yn.setFromMatrixColumn(this._camera.matrix,0),Gn.setFromMatrixColumn(this._camera.matrix,1),ca.setFromMatrixColumn(this._camera.matrix,2),Yn.multiplyScalar(this._focalOffset.x),Gn.multiplyScalar(-this._focalOffset.y),ca.multiplyScalar(this._focalOffset.z),Ht.copy(Yn).add(Gn).add(ca),this._camera.position.add(Ht),this._camera.updateMatrixWorld()),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),Ht.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const c=this._needsUpdate;return c&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):c?(this.dispatchEvent({type:"update"}),_e(e,this.restThreshold)&&_e(s,this.restThreshold)&&_e(i,this.restThreshold)&&_e(r.x,this.restThreshold)&&_e(r.y,this.restThreshold)&&_e(r.z,this.restThreshold)&&_e(o.x,this.restThreshold)&&_e(o.y,this.restThreshold)&&_e(o.z,this.restThreshold)&&_e(a,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!c&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=c,this._needsUpdate=!1,c}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:Wh(this.maxDistance),minZoom:this.minZoom,maxZoom:Wh(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:Wh(this.maxPolarAngle),minAzimuthAngle:Wh(this.minAzimuthAngle),maxAzimuthAngle:Wh(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,target:this._targetEnd.toArray(),position:Ht.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(t,e=!1){const s=JSON.parse(t);this.enabled=s.enabled,this.minDistance=s.minDistance,this.maxDistance=Yh(s.maxDistance),this.minZoom=s.minZoom,this.maxZoom=Yh(s.maxZoom),this.minPolarAngle=s.minPolarAngle,this.maxPolarAngle=Yh(s.maxPolarAngle),this.minAzimuthAngle=Yh(s.minAzimuthAngle),this.maxAzimuthAngle=Yh(s.maxAzimuthAngle),this.smoothTime=s.smoothTime,this.draggingSmoothTime=s.draggingSmoothTime,this.dollySpeed=s.dollySpeed,this.truckSpeed=s.truckSpeed,this.dollyToCursor=s.dollyToCursor,this._target0.fromArray(s.target0),this._position0.fromArray(s.position0),this._zoom0=s.zoom0,this._focalOffset0.fromArray(s.focalOffset0),this.moveTo(s.target[0],s.target[1],s.target[2],e),Mi.setFromVector3(Ht.fromArray(s.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(Mi.theta,Mi.phi,e),this.dollyTo(Mi.radius,e),this.zoomTo(s.zoom,e),this.setFocalOffset(s.focalOffset[0],s.focalOffset[1],s.focalOffset[2],e),this._needsUpdate=!0}connect(t){if(this._domElement){console.warn("camera-controls is already connected.");return}t.setAttribute("data-camera-controls-version",fz),this._addAllEventListeners(t),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(t){return t.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(t){return this._getTargetDirection(t).negate()}_findPointerById(t){return this._activePointers.find(e=>e.pointerId===t)}_findPointerByMouseButton(t){return this._activePointers.find(e=>e.mouseButton===t)}_disposePointer(t){this._activePointers.splice(this._activePointers.indexOf(t),1)}_encloseToBoundary(t,e,s){const i=e.lengthSq();if(i===0)return t;const r=Qt.copy(e).add(t),o=this._boundary.clampPoint(r,Nl).sub(r),a=o.lengthSq();if(a===0)return t.add(e);if(a===i)return t;if(s===0)return t.add(e).add(o);{const l=1+s*a/e.dot(o);return t.add(Qt.copy(e).multiplyScalar(l)).add(o.multiplyScalar(1-s))}}_updateNearPlaneCorners(){if(la(this._camera)){const t=this._camera,e=t.near,s=t.getEffectiveFOV()*jh,i=Math.tan(s*.5)*e,r=i*t.aspect;this._nearPlaneCorners[0].set(-r,-i,0),this._nearPlaneCorners[1].set(r,-i,0),this._nearPlaneCorners[2].set(r,i,0),this._nearPlaneCorners[3].set(-r,i,0)}else if(lo(this._camera)){const t=this._camera,e=1/t.zoom,s=t.left*e,i=t.right*e,r=t.top*e,o=t.bottom*e;this._nearPlaneCorners[0].set(s,r,0),this._nearPlaneCorners[1].set(i,r,0),this._nearPlaneCorners[2].set(i,o,0),this._nearPlaneCorners[3].set(s,o,0)}}_collisionTest(){let t=1/0;if(!(this.colliderMeshes.length>=1)||u_(this._camera,"_collisionTest"))return t;const e=this._getTargetDirection(Gh);g_.lookAt(wE,e,this._camera.up);for(let s=0;s<4;s++){const i=Qt.copy(this._nearPlaneCorners[s]);i.applyMatrix4(g_);const r=Nl.addVectors(this._target,i);yf.set(r,e),yf.far=this._spherical.radius+1;const o=yf.intersectObjects(this.colliderMeshes);o.length!==0&&o[0].distance<t&&(t=o[0].distance)}return t}_getClientRect(t){if(!this._domElement)return;const e=this._domElement.getBoundingClientRect();return t.x=e.left,t.y=e.top,this._viewport?(t.x+=this._viewport.x,t.y+=e.height-this._viewport.w-this._viewport.y,t.width=this._viewport.z,t.height=this._viewport.w):(t.width=e.width,t.height=e.height),t}_createOnRestPromise(t){return t?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(e=>{const s=()=>{this.removeEventListener("rest",s),e()};this.addEventListener("rest",s)}))}_addAllEventListeners(t){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(t){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(t){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(t,e=new $t.Sphere){const s=e,i=s.center;Ml.makeEmpty(),t.traverseVisible(o=>{o.isMesh&&Ml.expandByObject(o)}),Ml.getCenter(i);let r=0;return t.traverseVisible(o=>{if(!o.isMesh)return;const a=o;if(!a.geometry)return;const l=a.geometry.clone();l.applyMatrix4(a.matrixWorld);const c=l.attributes.position;for(let h=0,u=c.count;h<u;h++)Ht.fromBufferAttribute(c,h),r=Math.max(r,i.distanceToSquared(Ht))}),s.radius=Math.sqrt(r),s}},Q0=class RA extends Bk{constructor(t){super(t),z(this,"onBeforeUpdate",new yt),z(this,"onAfterUpdate",new yt),z(this,"onAspectUpdated",new yt),z(this,"onDisposed",new yt),z(this,"three"),z(this,"_allControls",new Map),z(this,"updateAspect",()=>{var e;if(!(!this.currentWorld||!this.currentWorld.renderer)){if(this.three instanceof sl){this.onAspectUpdated.trigger();return}if((e=this.currentWorld.renderer)!=null&&e.isResizeable()){const s=this.currentWorld.renderer.getSize();this.three.aspect=s.width/s.height,this.three.updateProjectionMatrix(),this.onAspectUpdated.trigger()}}}),this.three=this.setupCamera(),this.setupEvents(!0),this.worlds.onItemSet.add(({value:e})=>{const s=this.newCameraControls();this._allControls.set(e.uuid,s)}),this.worlds.onBeforeDelete.add(({value:e})=>{const s=this._allControls.get(e.uuid);s&&(s.dispose(),this._allControls.delete(e.uuid))})}get controls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");const t=this._allControls.get(this.currentWorld.uuid);if(!t)throw new Error("Controls not found!");return t}get enabled(){return this.currentWorld===null?!1:this.controls.enabled}set enabled(t){this.currentWorld!==null&&(this.controls.enabled=t)}set currentWorld(t){super.currentWorld=t,t&&(this.worlds.get(t.uuid)||this.worlds.set(t.uuid,t))}get currentWorld(){return this._currentWorld}dispose(){this.setupEvents(!1),this.onAspectUpdated.reset(),this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.three.removeFromParent(),this.onDisposed.trigger(),this.onDisposed.reset();for(const[t,e]of this._allControls)e.dispose();this.worlds.clear()}async fitToItems(t){const e=await this.getItemsBounding(t);await this.controls.fitToSphere(e,!0)}async setOrbitToItems(t){const e=await this.getItemsBounding(t);this.controls.setOrbitPoint(e.center.x,e.center.y,e.center.z)}update(t){this.enabled&&(this.onBeforeUpdate.trigger(this),this.controls.update(t),this.onAfterUpdate.trigger(this))}async getItemsBounding(t){const e=this.components.get(Mt),s=this.components.get(Dm);s.list.clear();const i=new Us;if(t)await s.addFromModelIdMap(t);else for(const[,r]of e.list)s.list.add(r.box);return s.get().getBoundingSphere(i),s.list.clear(),i}setupCamera(){const t=window.innerWidth/window.innerHeight,e=new Md(60,t,1,1e3);return e.position.set(50,50,50),e.lookAt(new F(0,0,0)),e}newCameraControls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");if(!this.currentWorld.renderer)throw new Error("This camera needs a renderer to work!");_i.install({THREE:RA.getSubsetOfThree()});const{domElement:t}=this.currentWorld.renderer.three,e=new _i(this.three,t);return e.smoothTime=.2,e.dollyToCursor=!0,e.infinityDolly=!0,e.minDistance=6,e}setupEvents(t){t?window.addEventListener("resize",this.updateAspect):window.removeEventListener("resize",this.updateAspect)}static getSubsetOfThree(){return{MOUSE:uC,Vector2:Ut,Vector3:F,Vector4:un,Quaternion:Pe,Matrix4:xt,Spherical:hC,Box3:Tt,Sphere:Us,Raycaster:el,MathUtils:kd}}};const FA=class LA extends me{constructor(t){super(t),z(this,"onAfterUpdate",new yt),z(this,"onBeforeUpdate",new yt),z(this,"onDisposed",new yt),z(this,"list",new Sc),z(this,"enabled",!0),t.add(LA.uuid,this)}create(){const t=new uz(this.components),e=t.uuid;if(this.list.has(e))throw new Error("There is already a world with this name!");return this.list.set(e,t),t}delete(t){if(!this.list.has(t.uuid))throw new Error("The provided world is not found in the list!");this.list.delete(t.uuid),t.dispose()}dispose(){this.enabled=!1;for(const[t,e]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger()}update(t){if(this.enabled)for(const[e,s]of this.list)s.update(t)}};z(FA,"uuid","fdb61dc4-2ec1-4966-b83d-54ea795fad4a");let $A=FA;class gz extends Rg{constructor(){super(...arguments),z(this,"_config",{visible:{value:!0,type:"Boolean"},color:{value:new Dt,type:"Color"},primarySize:{type:"Number",interpolable:!0,value:1,min:0,max:1e3},secondarySize:{type:"Number",interpolable:!0,value:10,min:0,max:1e3},distance:{type:"Number",interpolable:!0,value:500,min:0,max:500}})}get visible(){return this._config.visible.value}set visible(t){this._config.visible.value=t,this._component.visible=t}get color(){return this._config.color.value}set color(t){this._config.color.value=t,this._component.material.uniforms.uColor.value=t,this._component.material.uniformsNeedUpdate=!0}get primarySize(){return this._config.primarySize.value}set primarySize(t){this._config.primarySize.value=t,this._component.material.uniforms.uSize1.value=t,this._component.material.uniformsNeedUpdate=!0}get secondarySize(){return this._config.secondarySize.value}set secondarySize(t){this._config.secondarySize.value=t,this._component.material.uniforms.uSize2.value=t,this._component.material.uniformsNeedUpdate=!0}get distance(){return this._config.distance.value}set distance(t){this._config.distance.value=t,this._component.material.uniforms.uDistance.value=t,this._component.material.uniformsNeedUpdate=!0}}class bz{constructor(t,e){z(this,"onDisposed",new yt),z(this,"onSetup",new yt),z(this,"isSetup",!1),z(this,"world"),z(this,"components"),z(this,"config"),z(this,"_defaultConfig",{visible:!0,color:new Dt(12303291),primarySize:1,secondarySize:10,distance:500}),z(this,"three"),z(this,"_fade",3),z(this,"updateZoom",()=>{this.world.camera instanceof Q0&&(this.material.uniforms.uZoom.value=this.world.camera.three.zoom)}),this.world=e;const{color:s,primarySize:i,secondarySize:r,distance:o}=this._defaultConfig;this.components=t,this.config=new gz(this,this.components,"Grid");const a=new Zc(2,2,1,1),l=new Dd({side:Pi,uniforms:{uSize1:{value:i},uSize2:{value:r},uColor:{value:s},uDistance:{value:o},uFade:{value:this._fade},uZoom:{value:1}},transparent:!0,vertexShader:`
            
            varying vec3 worldPosition;
            
            uniform float uDistance;
            
            void main() {
            
                    vec3 pos = position.xzy * uDistance;
                    pos.xz += cameraPosition.xz;
                    
                    worldPosition = pos;
                    
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
            
            }
            `,fragmentShader:`
            
            varying vec3 worldPosition;
            
            uniform float uZoom;
            uniform float uFade;
            uniform float uSize1;
            uniform float uSize2;
            uniform vec3 uColor;
            uniform float uDistance;
                
                
                
                float getGrid(float size) {
                
                    vec2 r = worldPosition.xz / size;
                    
                    
                    vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
                    float line = min(grid.x, grid.y);
                    
                
                    return 1.0 - min(line, 1.0);
                }
                
            void main() {
            
                    
                    float d = 1.0 - min(distance(cameraPosition.xz, worldPosition.xz) / uDistance, 1.0);
                    
                    float g1 = getGrid(uSize1);
                    float g2 = getGrid(uSize2);
                    
                    // Ortho camera fades the grid away when zooming out
                    float minZoom = step(0.2, uZoom);
                    float zoomFactor = pow(min(uZoom, 1.), 2.) * minZoom;
                    
                    gl_FragColor = vec4(uColor.rgb, mix(g2, g1, g1) * pow(d, uFade));
                    gl_FragColor.a = mix(0.5 * gl_FragColor.a, gl_FragColor.a, g2) * zoomFactor;
                    
                    if ( gl_FragColor.a <= 0.0 ) discard;
                    
            
            }
            
            `,extensions:{derivatives:!0}});this.three=new ht(a,l),this.three.frustumCulled=!1,e.scene.three.add(this.three),this.setupEvents(!0)}get visible(){return this.three.visible}set visible(t){this.three.visible=t,t?this.world.scene.three.add(this.three):this.three.removeFromParent()}get material(){return this.three.material}get fade(){return this._fade===3}set fade(t){this._fade=t?3:0,this.material.uniforms.uFade.value=this._fade}setup(t){const e={...this._defaultConfig,...t};this.config.visible=!0,this.config.color=e.color,this.config.primarySize=e.primarySize,this.config.secondarySize=e.secondarySize,this.config.distance=e.distance,this.isSetup=!0,this.onSetup.trigger()}dispose(){this.setupEvents(!1),this.components.get(Ev).list.delete(this.config.uuid),this.components.get(mr).destroy(this.three),this.onDisposed.trigger(),this.onDisposed.reset(),this.world=null,this.components=null}setupEvents(t){if(this.world.isDisposing||!(this.world.camera instanceof Q0))return;const e=this.world.camera.controls;t?e.addEventListener("update",this.updateZoom):e.removeEventListener("update",this.updateZoom)}}const _z=class NA extends me{constructor(t){super(t),z(this,"list",new Map),z(this,"onDisposed",new yt),z(this,"enabled",!0),t.add(NA.uuid,this)}create(t){if(this.list.has(t.uuid))throw new Error("This world already has a grid!");const e=new bz(this.components,t);return this.list.set(t.uuid,e),t.onDisposed.add(()=>{this.delete(t)}),e}delete(t){const e=this.list.get(t.uuid);e&&e.dispose(),this.list.delete(t.uuid)}dispose(){for(const[t,e]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger(),this.onDisposed.reset()}};z(_z,"uuid","d1e814d5-b81c-4452-87a2-f039375e0489");const MA=0,yz=1,vz=2,TE=2,b_=1.25,AE=1,dm=32,Fg=65535,wz=Math.pow(2,-24),__=Symbol("SKIP_GENERATION");function Ez(n){return n.index?n.index.count:n.attributes.position.count}function eh(n){return Ez(n)/3}function xz(n,t=ArrayBuffer){return n>65535?new Uint32Array(new t(4*n)):new Uint16Array(new t(2*n))}function Iz(n,t){if(!n.index){const e=n.attributes.position.count,s=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,i=xz(e,s);n.setIndex(new ze(i,1));for(let r=0;r<e;r++)i[r]=r}}function DA(n){const t=eh(n),e=n.drawRange,s=e.start/3,i=(e.start+e.count)/3,r=Math.max(0,s),o=Math.min(t,i)-r;return[{offset:Math.floor(r),count:Math.floor(o)}]}function kA(n){if(!n.groups||!n.groups.length)return DA(n);const t=[],e=new Set,s=n.drawRange,i=s.start/3,r=(s.start+s.count)/3;for(const a of n.groups){const l=a.start/3,c=(a.start+a.count)/3;e.add(Math.max(i,l)),e.add(Math.min(r,c))}const o=Array.from(e.values()).sort((a,l)=>a-l);for(let a=0;a<o.length-1;a++){const l=o[a],c=o[a+1];t.push({offset:Math.floor(l),count:Math.floor(c-l)})}return t}function Cz(n){if(n.groups.length===0)return!1;const t=eh(n),e=kA(n).sort((r,o)=>r.offset-o.offset),s=e[e.length-1];s.count=Math.min(t-s.offset,s.count);let i=0;return e.forEach(({count:r})=>i+=r),t!==i}function ke(n,t,e){return e.min.x=t[n],e.min.y=t[n+1],e.min.z=t[n+2],e.max.x=t[n+3],e.max.y=t[n+4],e.max.z=t[n+5],e}function Tz(n){n[0]=n[1]=n[2]=1/0,n[3]=n[4]=n[5]=-1/0}function SE(n){let t=-1,e=-1/0;for(let s=0;s<3;s++){const i=n[s+3]-n[s];i>e&&(e=i,t=s)}return t}function OE(n,t){t.set(n)}function PE(n,t,e){let s,i;for(let r=0;r<3;r++){const o=r+3;s=n[r],i=t[r],e[r]=s<i?s:i,s=n[o],i=t[o],e[o]=s>i?s:i}}function vf(n,t,e){for(let s=0;s<3;s++){const i=t[n+2*s],r=t[n+2*s+1],o=i-r,a=i+r;o<e[s]&&(e[s]=o),a>e[s+3]&&(e[s+3]=a)}}function Zh(n){const t=n[3]-n[0],e=n[4]-n[1],s=n[5]-n[2];return 2*(t*e+e*s+s*t)}function y_(n,t,e,s,i=null){let r=1/0,o=1/0,a=1/0,l=-1/0,c=-1/0,h=-1/0,u=1/0,p=1/0,d=1/0,g=-1/0,m=-1/0,b=-1/0;const f=i!==null;for(let _=t*6,y=(t+e)*6;_<y;_+=6){const v=n[_+0],w=n[_+1],I=v-w,C=v+w;I<r&&(r=I),C>l&&(l=C),f&&v<u&&(u=v),f&&v>g&&(g=v);const A=n[_+2],S=n[_+3],P=A-S,M=A+S;P<o&&(o=P),M>c&&(c=M),f&&A<p&&(p=A),f&&A>m&&(m=A);const T=n[_+4],L=n[_+5],E=T-L,N=T+L;E<a&&(a=E),N>h&&(h=N),f&&T<d&&(d=T),f&&T>b&&(b=T)}s[0]=r,s[1]=o,s[2]=a,s[3]=l,s[4]=c,s[5]=h,f&&(i[0]=u,i[1]=p,i[2]=d,i[3]=g,i[4]=m,i[5]=b)}function Az(n,t,e,s){let i=1/0,r=1/0,o=1/0,a=-1/0,l=-1/0,c=-1/0;for(let h=t*6,u=(t+e)*6;h<u;h+=6){const p=n[h+0];p<i&&(i=p),p>a&&(a=p);const d=n[h+2];d<r&&(r=d),d>l&&(l=d);const g=n[h+4];g<o&&(o=g),g>c&&(c=g)}s[0]=i,s[1]=r,s[2]=o,s[3]=a,s[4]=l,s[5]=c}function Sz(n,t){Tz(t);const e=n.attributes.position,s=n.index?n.index.array:null,i=eh(n),r=new Float32Array(i*6),o=e.normalized,a=e.array,l=e.offset||0;let c=3;e.isInterleavedBufferAttribute&&(c=e.data.stride);const h=["getX","getY","getZ"];for(let u=0;u<i;u++){const p=u*3,d=u*6;let g=p+0,m=p+1,b=p+2;s&&(g=s[g],m=s[m],b=s[b]),o||(g=g*c+l,m=m*c+l,b=b*c+l);for(let f=0;f<3;f++){let _,y,v;o?(_=e[h[f]](g),y=e[h[f]](m),v=e[h[f]](b)):(_=a[g+f],y=a[m+f],v=a[b+f]);let w=_;y<w&&(w=y),v<w&&(w=v);let I=_;y>I&&(I=y),v>I&&(I=v);const C=(I-w)/2,A=f*2;r[d+A+0]=w+C,r[d+A+1]=C+(Math.abs(w)+C)*wz,w<t[f]&&(t[f]=w),I>t[f+3]&&(t[f+3]=I)}}return r}const Or=32,Oz=(n,t)=>n.candidate-t.candidate,eo=new Array(Or).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),wf=new Float32Array(6);function Pz(n,t,e,s,i,r){let o=-1,a=0;if(r===MA)o=SE(t),o!==-1&&(a=(t[o]+t[o+3])/2);else if(r===yz)o=SE(n),o!==-1&&(a=Rz(e,s,i,o));else if(r===vz){const l=Zh(n);let c=b_*i;const h=s*6,u=(s+i)*6;for(let p=0;p<3;p++){const d=t[p],g=(t[p+3]-d)/Or;if(i<Or/4){const m=[...eo];m.length=i;let b=0;for(let _=h;_<u;_+=6,b++){const y=m[b];y.candidate=e[_+2*p],y.count=0;const{bounds:v,leftCacheBounds:w,rightCacheBounds:I}=y;for(let C=0;C<3;C++)I[C]=1/0,I[C+3]=-1/0,w[C]=1/0,w[C+3]=-1/0,v[C]=1/0,v[C+3]=-1/0;vf(_,e,v)}m.sort(Oz);let f=i;for(let _=0;_<f;_++){const y=m[_];for(;_+1<f&&m[_+1].candidate===y.candidate;)m.splice(_+1,1),f--}for(let _=h;_<u;_+=6){const y=e[_+2*p];for(let v=0;v<f;v++){const w=m[v];y>=w.candidate?vf(_,e,w.rightCacheBounds):(vf(_,e,w.leftCacheBounds),w.count++)}}for(let _=0;_<f;_++){const y=m[_],v=y.count,w=i-y.count,I=y.leftCacheBounds,C=y.rightCacheBounds;let A=0;v!==0&&(A=Zh(I)/l);let S=0;w!==0&&(S=Zh(C)/l);const P=AE+b_*(A*v+S*w);P<c&&(o=p,c=P,a=y.candidate)}}else{for(let f=0;f<Or;f++){const _=eo[f];_.count=0,_.candidate=d+g+f*g;const y=_.bounds;for(let v=0;v<3;v++)y[v]=1/0,y[v+3]=-1/0}for(let f=h;f<u;f+=6){let _=~~((e[f+2*p]-d)/g);_>=Or&&(_=Or-1);const y=eo[_];y.count++,vf(f,e,y.bounds)}const m=eo[Or-1];OE(m.bounds,m.rightCacheBounds);for(let f=Or-2;f>=0;f--){const _=eo[f],y=eo[f+1];PE(_.bounds,y.rightCacheBounds,_.rightCacheBounds)}let b=0;for(let f=0;f<Or-1;f++){const _=eo[f],y=_.count,v=_.bounds,w=eo[f+1].rightCacheBounds;y!==0&&(b===0?OE(v,wf):PE(v,wf,wf)),b+=y;let I=0,C=0;b!==0&&(I=Zh(wf)/l);const A=i-b;A!==0&&(C=Zh(w)/l);const S=AE+b_*(I*b+C*A);S<c&&(o=p,c=S,a=_.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${r} used.`);return{axis:o,pos:a}}function Rz(n,t,e,s){let i=0;for(let r=t,o=t+e;r<o;r++)i+=n[r*6+s*2];return i/e}let Ef=class{constructor(){}};function Fz(n,t,e,s,i,r){let o=s,a=s+i-1;const l=r.pos,c=r.axis*2;for(;;){for(;o<=a&&e[o*6+c]<l;)o++;for(;o<=a&&e[a*6+c]>=l;)a--;if(o<a){for(let h=0;h<3;h++){let u=t[o*3+h];t[o*3+h]=t[a*3+h],t[a*3+h]=u}for(let h=0;h<6;h++){let u=e[o*6+h];e[o*6+h]=e[a*6+h],e[a*6+h]=u}o++,a--}else return o}}function Lz(n,t,e,s,i,r){let o=s,a=s+i-1;const l=r.pos,c=r.axis*2;for(;;){for(;o<=a&&e[o*6+c]<l;)o++;for(;o<=a&&e[a*6+c]>=l;)a--;if(o<a){let h=n[o];n[o]=n[a],n[a]=h;for(let u=0;u<6;u++){let p=e[o*6+u];e[o*6+u]=e[a*6+u],e[a*6+u]=p}o++,a--}else return o}}function $z(n,t){const e=(n.index?n.index.count:n.attributes.position.count)/3,s=e>2**16,i=s?4:2,r=t?new SharedArrayBuffer(e*i):new ArrayBuffer(e*i),o=s?new Uint32Array(r):new Uint16Array(r);for(let a=0,l=o.length;a<l;a++)o[a]=a;return o}function Nz(n,t){const e=n.geometry,s=e.index?e.index.array:null,i=t.maxDepth,r=t.verbose,o=t.maxLeafTris,a=t.strategy,l=t.onProgress,c=eh(e),h=n._indirectBuffer;let u=!1;const p=new Float32Array(6),d=new Float32Array(6),g=Sz(e,p),m=t.indirect?Lz:Fz,b=[],f=t.indirect?DA(e):kA(e);if(f.length===1){const v=f[0],w=new Ef;w.boundingData=p,Az(g,v.offset,v.count,d),y(w,v.offset,v.count,d),b.push(w)}else for(let v of f){const w=new Ef;w.boundingData=new Float32Array(6),y_(g,v.offset,v.count,w.boundingData,d),y(w,v.offset,v.count,d),b.push(w)}return b;function _(v){l&&l(v/c)}function y(v,w,I,C=null,A=0){if(!u&&A>=i&&(u=!0,r&&(console.warn(`MeshBVH: Max depth of ${i} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),I<=o||A>=i)return _(w+I),v.offset=w,v.count=I,v;const S=Pz(v.boundingData,C,g,w,I,a);if(S.axis===-1)return _(w+I),v.offset=w,v.count=I,v;const P=m(h,s,g,w,I,S);if(P===w||P===w+I)_(w+I),v.offset=w,v.count=I;else{v.splitAxis=S.axis;const M=new Ef,T=w,L=P-w;v.left=M,M.boundingData=new Float32Array(6),y_(g,T,L,M.boundingData,d),y(M,T,L,d,A+1);const E=new Ef,N=P,W=I-L;v.right=E,E.boundingData=new Float32Array(6),y_(g,N,W,E.boundingData,d),y(E,N,W,d,A+1)}return v}}function Mz(n,t){const e=n.geometry;t.indirect&&(n._indirectBuffer=$z(e,t.useSharedArrayBuffer),Cz(e)&&!t.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),n._indirectBuffer||Iz(e,t);const s=Nz(n,t);let i,r,o;const a=[],l=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let u=0;u<s.length;u++){const p=s[u];let d=c(p);const g=new l(dm*d);i=new Float32Array(g),r=new Uint32Array(g),o=new Uint16Array(g),h(0,p),a.push(g)}n._roots=a;return;function c(u){return u.count?1:1+c(u.left)+c(u.right)}function h(u,p){const d=u/4,g=u/2,m=!!p.count,b=p.boundingData;for(let f=0;f<6;f++)i[d+f]=b[f];if(m){const f=p.offset,_=p.count;return r[d+6]=f,o[g+14]=_,o[g+15]=Fg,u+dm}else{const f=p.left,_=p.right,y=p.splitAxis;let v;if(v=h(u+dm,f),v/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return r[d+6]=v/4,v=h(v,_),r[d+7]=y,v}}}let Hr=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(t,e){let s=1/0,i=-1/0;for(let r=0,o=t.length;r<o;r++){const a=t[r][e];s=a<s?a:s,i=a>i?a:i}this.min=s,this.max=i}setFromPoints(t,e){let s=1/0,i=-1/0;for(let r=0,o=e.length;r<o;r++){const a=e[r],l=t.dot(a);s=l<s?l:s,i=l>i?l:i}this.min=s,this.max=i}isSeparated(t){return this.min>t.max||t.min>this.max}};Hr.prototype.setFromBox=(function(){const n=new F;return function(t,e){const s=e.min,i=e.max;let r=1/0,o=-1/0;for(let a=0;a<=1;a++)for(let l=0;l<=1;l++)for(let c=0;c<=1;c++){n.x=s.x*a+i.x*(1-a),n.y=s.y*l+i.y*(1-l),n.z=s.z*c+i.z*(1-c);const h=t.dot(n);r=Math.min(h,r),o=Math.max(h,o)}this.min=r,this.max=o}})();const Dz=(function(){const n=new F,t=new F,e=new F;return function(s,i,r){const o=s.start,a=n,l=i.start,c=t;e.subVectors(o,l),n.subVectors(s.end,s.start),t.subVectors(i.end,i.start);const h=e.dot(c),u=c.dot(a),p=c.dot(c),d=e.dot(a),g=a.dot(a)*p-u*u;let m,b;g!==0?m=(h*u-d*p)/g:m=0,b=(h+m*u)/p,r.x=m,r.y=b}})(),xv=(function(){const n=new Ut,t=new F,e=new F;return function(s,i,r,o){Dz(s,i,n);let a=n.x,l=n.y;if(a>=0&&a<=1&&l>=0&&l<=1){s.at(a,r),i.at(l,o);return}else if(a>=0&&a<=1){l<0?i.at(0,o):i.at(1,o),s.closestPointToPoint(o,!0,r);return}else if(l>=0&&l<=1){a<0?s.at(0,r):s.at(1,r),i.closestPointToPoint(r,!0,o);return}else{let c;a<0?c=s.start:c=s.end;let h;l<0?h=i.start:h=i.end;const u=t,p=e;if(s.closestPointToPoint(h,!0,t),i.closestPointToPoint(c,!0,e),u.distanceToSquared(h)<=p.distanceToSquared(c)){r.copy(u),o.copy(h);return}else{r.copy(c),o.copy(p);return}}}})(),kz=(function(){const n=new F,t=new F,e=new Wt,s=new qt;return function(i,r){const{radius:o,center:a}=i,{a:l,b:c,c:h}=r;if(s.start=l,s.end=c,s.closestPointToPoint(a,!0,n).distanceTo(a)<=o||(s.start=l,s.end=h,s.closestPointToPoint(a,!0,n).distanceTo(a)<=o)||(s.start=c,s.end=h,s.closestPointToPoint(a,!0,n).distanceTo(a)<=o))return!0;const u=r.getPlane(e);if(Math.abs(u.distanceToPoint(a))<=o){const p=u.projectPoint(a,t);if(r.containsPoint(p))return!0}return!1}})(),zz=1e-15;function v_(n){return Math.abs(n)<zz}let $n=class extends ns{constructor(...t){super(...t),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new F),this.satBounds=new Array(4).fill().map(()=>new Hr),this.points=[this.a,this.b,this.c],this.sphere=new Us,this.plane=new Wt,this.needsUpdate=!0}intersectsSphere(t){return kz(t,this)}update(){const t=this.a,e=this.b,s=this.c,i=this.points,r=this.satAxes,o=this.satBounds,a=r[0],l=o[0];this.getNormal(a),l.setFromPoints(a,i);const c=r[1],h=o[1];c.subVectors(t,e),h.setFromPoints(c,i);const u=r[2],p=o[2];u.subVectors(e,s),p.setFromPoints(u,i);const d=r[3],g=o[3];d.subVectors(s,t),g.setFromPoints(d,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,t),this.needsUpdate=!1}};$n.prototype.closestPointToSegment=(function(){const n=new F,t=new F,e=new qt;return function(s,i=null,r=null){const{start:o,end:a}=s,l=this.points;let c,h=1/0;for(let u=0;u<3;u++){const p=(u+1)%3;e.start.copy(l[u]),e.end.copy(l[p]),xv(e,s,n,t),c=n.distanceToSquared(t),c<h&&(h=c,i&&i.copy(n),r&&r.copy(t))}return this.closestPointToPoint(o,n),c=o.distanceToSquared(n),c<h&&(h=c,i&&i.copy(n),r&&r.copy(o)),this.closestPointToPoint(a,n),c=a.distanceToSquared(n),c<h&&(h=c,i&&i.copy(n),r&&r.copy(a)),Math.sqrt(h)}})();$n.prototype.intersectsTriangle=(function(){const n=new $n,t=new Array(3),e=new Array(3),s=new Hr,i=new Hr,r=new F,o=new F,a=new F,l=new F,c=new F,h=new qt,u=new qt,p=new qt,d=new F;function g(m,b,f){const _=m.points;let y=0,v=-1;for(let w=0;w<3;w++){const{start:I,end:C}=h;I.copy(_[w]),C.copy(_[(w+1)%3]),h.delta(o);const A=v_(b.distanceToPoint(I));if(v_(b.normal.dot(o))&&A){f.copy(h),y=2;break}const S=b.intersectLine(h,d);if(!S&&A&&d.copy(I),(S||A)&&!v_(d.distanceTo(C))){if(y<=1)(y===1?f.start:f.end).copy(d),A&&(v=y);else if(y>=2){(v===1?f.start:f.end).copy(d),y=2;break}if(y++,y===2&&v===-1)break}}return y}return function(m,b=null,f=!1){this.needsUpdate&&this.update(),m.isExtendedTriangle?m.needsUpdate&&m.update():(n.copy(m),n.update(),m=n);const _=this.plane,y=m.plane;if(Math.abs(_.normal.dot(y.normal))>1-1e-10){const v=this.satBounds,w=this.satAxes;e[0]=m.a,e[1]=m.b,e[2]=m.c;for(let A=0;A<4;A++){const S=v[A],P=w[A];if(s.setFromPoints(P,e),S.isSeparated(s))return!1}const I=m.satBounds,C=m.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let A=0;A<4;A++){const S=I[A],P=C[A];if(s.setFromPoints(P,t),S.isSeparated(s))return!1}for(let A=0;A<4;A++){const S=w[A];for(let P=0;P<4;P++){const M=C[P];if(r.crossVectors(S,M),s.setFromPoints(r,t),i.setFromPoints(r,e),s.isSeparated(i))return!1}}return b&&(f||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),b.start.set(0,0,0),b.end.set(0,0,0)),!0}else{const v=g(this,y,u);if(v===1&&m.containsPoint(u.end))return b&&(b.start.copy(u.end),b.end.copy(u.end)),!0;if(v!==2)return!1;const w=g(m,_,p);if(w===1&&this.containsPoint(p.end))return b&&(b.start.copy(p.end),b.end.copy(p.end)),!0;if(w!==2)return!1;if(u.delta(a),p.delta(l),a.dot(l)<0){let T=p.start;p.start=p.end,p.end=T}const I=u.start.dot(a),C=u.end.dot(a),A=p.start.dot(a),S=p.end.dot(a),P=C<A,M=I<S;return I!==S&&A!==C&&P===M?!1:(b&&(c.subVectors(u.start,p.start),c.dot(a)>0?b.start.copy(u.start):b.start.copy(p.start),c.subVectors(u.end,p.end),c.dot(a)<0?b.end.copy(u.end):b.end.copy(p.end)),!0)}}})();$n.prototype.distanceToPoint=(function(){const n=new F;return function(t){return this.closestPointToPoint(t,n),t.distanceTo(n)}})();$n.prototype.distanceToTriangle=(function(){const n=new F,t=new F,e=["a","b","c"],s=new qt,i=new qt;return function(r,o=null,a=null){const l=o||a?s:null;if(this.intersectsTriangle(r,l))return(o||a)&&(o&&l.getCenter(o),a&&l.getCenter(a)),0;let c=1/0;for(let h=0;h<3;h++){let u;const p=e[h],d=r[p];this.closestPointToPoint(d,n),u=d.distanceToSquared(n),u<c&&(c=u,o&&o.copy(n),a&&a.copy(d));const g=this[p];r.closestPointToPoint(g,n),u=g.distanceToSquared(n),u<c&&(c=u,o&&o.copy(g),a&&a.copy(n))}for(let h=0;h<3;h++){const u=e[h],p=e[(h+1)%3];s.set(this[u],this[p]);for(let d=0;d<3;d++){const g=e[d],m=e[(d+1)%3];i.set(r[g],r[m]),xv(s,i,n,t);const b=n.distanceToSquared(t);b<c&&(c=b,o&&o.copy(n),a&&a.copy(t))}}return Math.sqrt(c)}})();let qs=class{constructor(t,e,s){this.isOrientedBox=!0,this.min=new F,this.max=new F,this.matrix=new xt,this.invMatrix=new xt,this.points=new Array(8).fill().map(()=>new F),this.satAxes=new Array(3).fill().map(()=>new F),this.satBounds=new Array(3).fill().map(()=>new Hr),this.alignedSatBounds=new Array(3).fill().map(()=>new Hr),this.needsUpdate=!1,t&&this.min.copy(t),e&&this.max.copy(e),s&&this.matrix.copy(s)}set(t,e,s){this.min.copy(t),this.max.copy(e),this.matrix.copy(s),this.needsUpdate=!0}copy(t){this.min.copy(t.min),this.max.copy(t.max),this.matrix.copy(t.matrix),this.needsUpdate=!0}};qs.prototype.update=(function(){return function(){const n=this.matrix,t=this.min,e=this.max,s=this.points;for(let l=0;l<=1;l++)for(let c=0;c<=1;c++)for(let h=0;h<=1;h++){const u=1*l|2*c|4*h,p=s[u];p.x=l?e.x:t.x,p.y=c?e.y:t.y,p.z=h?e.z:t.z,p.applyMatrix4(n)}const i=this.satBounds,r=this.satAxes,o=s[0];for(let l=0;l<3;l++){const c=r[l],h=i[l],u=1<<l,p=s[u];c.subVectors(o,p),h.setFromPoints(c,s)}const a=this.alignedSatBounds;a[0].setFromPointsField(s,"x"),a[1].setFromPointsField(s,"y"),a[2].setFromPointsField(s,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}})();qs.prototype.intersectsBox=(function(){const n=new Hr;return function(t){this.needsUpdate&&this.update();const e=t.min,s=t.max,i=this.satBounds,r=this.satAxes,o=this.alignedSatBounds;if(n.min=e.x,n.max=s.x,o[0].isSeparated(n)||(n.min=e.y,n.max=s.y,o[1].isSeparated(n))||(n.min=e.z,n.max=s.z,o[2].isSeparated(n)))return!1;for(let a=0;a<3;a++){const l=r[a],c=i[a];if(n.setFromBox(l,t),c.isSeparated(n))return!1}return!0}})();qs.prototype.intersectsTriangle=(function(){const n=new $n,t=new Array(3),e=new Hr,s=new Hr,i=new F;return function(r){this.needsUpdate&&this.update(),r.isExtendedTriangle?r.needsUpdate&&r.update():(n.copy(r),n.update(),r=n);const o=this.satBounds,a=this.satAxes;t[0]=r.a,t[1]=r.b,t[2]=r.c;for(let u=0;u<3;u++){const p=o[u],d=a[u];if(e.setFromPoints(d,t),p.isSeparated(e))return!1}const l=r.satBounds,c=r.satAxes,h=this.points;for(let u=0;u<3;u++){const p=l[u],d=c[u];if(e.setFromPoints(d,h),p.isSeparated(e))return!1}for(let u=0;u<3;u++){const p=a[u];for(let d=0;d<4;d++){const g=c[d];if(i.crossVectors(p,g),e.setFromPoints(i,t),s.setFromPoints(i,h),e.isSeparated(s))return!1}}return!0}})();qs.prototype.closestPointToPoint=(function(){return function(n,t){return this.needsUpdate&&this.update(),t.copy(n).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}})();qs.prototype.distanceToPoint=(function(){const n=new F;return function(t){return this.closestPointToPoint(t,n),t.distanceTo(n)}})();qs.prototype.distanceToBox=(function(){const n=["x","y","z"],t=new Array(12).fill().map(()=>new qt),e=new Array(12).fill().map(()=>new qt),s=new F,i=new F;return function(r,o=0,a=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(r))return(a||l)&&(r.getCenter(i),this.closestPointToPoint(i,s),r.closestPointToPoint(s,i),a&&a.copy(s),l&&l.copy(i)),0;const c=o*o,h=r.min,u=r.max,p=this.points;let d=1/0;for(let m=0;m<8;m++){const b=p[m];i.copy(b).clamp(h,u);const f=b.distanceToSquared(i);if(f<d&&(d=f,a&&a.copy(b),l&&l.copy(i),f<c))return Math.sqrt(f)}let g=0;for(let m=0;m<3;m++)for(let b=0;b<=1;b++)for(let f=0;f<=1;f++){const _=(m+1)%3,y=(m+2)%3,v=b<<_|f<<y,w=1<<m|b<<_|f<<y,I=p[v],C=p[w];t[g].set(I,C);const A=n[m],S=n[_],P=n[y],M=e[g],T=M.start,L=M.end;T[A]=h[A],T[S]=b?h[S]:u[S],T[P]=f?h[P]:u[S],L[A]=u[A],L[S]=b?h[S]:u[S],L[P]=f?h[P]:u[S],g++}for(let m=0;m<=1;m++)for(let b=0;b<=1;b++)for(let f=0;f<=1;f++){i.x=m?u.x:h.x,i.y=b?u.y:h.y,i.z=f?u.z:h.z,this.closestPointToPoint(i,s);const _=i.distanceToSquared(s);if(_<d&&(d=_,a&&a.copy(s),l&&l.copy(i),_<c))return Math.sqrt(_)}for(let m=0;m<12;m++){const b=t[m];for(let f=0;f<12;f++){const _=e[f];xv(b,_,s,i);const y=s.distanceToSquared(i);if(y<d&&(d=y,a&&a.copy(s),l&&l.copy(i),y<c))return Math.sqrt(y)}}return Math.sqrt(d)}})();let Iv=class{constructor(t){this._getNewPrimitive=t,this._primitives=[]}getPrimitive(){const t=this._primitives;return t.length===0?this._getNewPrimitive():t.pop()}releasePrimitive(t){this._primitives.push(t)}};class Bz extends Iv{constructor(){super(()=>new $n)}}const en=new Bz;function yi(n,t){return t[n+15]===65535}function Ii(n,t){return t[n+6]}function sn(n,t){return t[n+14]}function nn(n){return n+8}function rn(n,t){return t[n+6]}function zA(n,t){return t[n+7]}class Uz{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const t=[];let e=null;this.setBuffer=s=>{e&&t.push(e),e=s,this.float32Array=new Float32Array(s),this.uint16Array=new Uint16Array(s),this.uint32Array=new Uint32Array(s)},this.clearBuffer=()=>{e=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,t.length!==0&&this.setBuffer(t.pop())}}}const Ie=new Uz;let Ao,gc;const Dl=[],xf=new Iv(()=>new Tt);function Vz(n,t,e,s,i,r){Ao=xf.getPrimitive(),gc=xf.getPrimitive(),Dl.push(Ao,gc),Ie.setBuffer(n._roots[t]);const o=K0(0,n.geometry,e,s,i,r);Ie.clearBuffer(),xf.releasePrimitive(Ao),xf.releasePrimitive(gc),Dl.pop(),Dl.pop();const a=Dl.length;return a>0&&(gc=Dl[a-1],Ao=Dl[a-2]),o}function K0(n,t,e,s,i=null,r=0,o=0){const{float32Array:a,uint16Array:l,uint32Array:c}=Ie;let h=n*2;if(yi(h,l)){const u=Ii(n,c),p=sn(h,l);return ke(n,a,Ao),s(u,p,!1,o,r+n,Ao)}else{let u=function(M){const{uint16Array:T,uint32Array:L}=Ie;let E=M*2;for(;!yi(E,T);)M=nn(M),E=M*2;return Ii(M,L)},p=function(M){const{uint16Array:T,uint32Array:L}=Ie;let E=M*2;for(;!yi(E,T);)M=rn(M,L),E=M*2;return Ii(M,L)+sn(E,T)};const d=nn(n),g=rn(n,c);let m=d,b=g,f,_,y,v;if(i&&(y=Ao,v=gc,ke(m,a,y),ke(b,a,v),f=i(y),_=i(v),_<f)){m=g,b=d;const M=f;f=_,_=M,y=v}y||(y=Ao,ke(m,a,y));const w=yi(m*2,l),I=e(y,w,f,o+1,r+m);let C;if(I===TE){const M=u(m),T=p(m)-M;C=s(M,T,!0,o+1,r+m,y)}else C=I&&K0(m,t,e,s,i,r,o+1);if(C)return!0;v=gc,ke(b,a,v);const A=yi(b*2,l),S=e(v,A,_,o+1,r+b);let P;if(S===TE){const M=u(b),T=p(b)-M;P=s(M,T,!0,o+1,r+b,v)}else P=S&&K0(b,t,e,s,i,r,o+1);return!!P}}const Xh=new F,w_=new F;function Hz(n,t,e={},s=0,i=1/0){const r=s*s,o=i*i;let a=1/0,l=null;if(n.shapecast({boundsTraverseOrder:h=>(Xh.copy(t).clamp(h.min,h.max),Xh.distanceToSquared(t)),intersectsBounds:(h,u,p)=>p<a&&p<o,intersectsTriangle:(h,u)=>{h.closestPointToPoint(t,Xh);const p=t.distanceToSquared(Xh);return p<a&&(w_.copy(Xh),a=p,l=u),p<r}}),a===1/0)return null;const c=Math.sqrt(a);return e.point?e.point.copy(w_):e.point=w_.clone(),e.distance=c,e.faceIndex=l,e}const kl=new F,zl=new F,Bl=new F,If=new Ut,Cf=new Ut,Tf=new Ut,RE=new F,FE=new F,LE=new F,Af=new F;function jz(n,t,e,s,i,r){let o;return r===Yy?o=n.intersectTriangle(s,e,t,!0,i):o=n.intersectTriangle(t,e,s,r!==Pi,i),o===null?null:{distance:n.origin.distanceTo(i),point:i.clone()}}function Wz(n,t,e,s,i,r,o,a,l){kl.fromBufferAttribute(t,r),zl.fromBufferAttribute(t,o),Bl.fromBufferAttribute(t,a);const c=jz(n,kl,zl,Bl,Af,l);if(c){s&&(If.fromBufferAttribute(s,r),Cf.fromBufferAttribute(s,o),Tf.fromBufferAttribute(s,a),c.uv=ns.getInterpolation(Af,kl,zl,Bl,If,Cf,Tf,new Ut)),i&&(If.fromBufferAttribute(i,r),Cf.fromBufferAttribute(i,o),Tf.fromBufferAttribute(i,a),c.uv1=ns.getInterpolation(Af,kl,zl,Bl,If,Cf,Tf,new Ut)),e&&(RE.fromBufferAttribute(e,r),FE.fromBufferAttribute(e,o),LE.fromBufferAttribute(e,a),c.normal=ns.getInterpolation(Af,kl,zl,Bl,RE,FE,LE,new F),c.normal.dot(n.direction)>0&&c.normal.multiplyScalar(-1));const h={a:r,b:o,c:a,normal:new F,materialIndex:0};ns.getNormal(kl,zl,Bl,h.normal),c.face=h,c.faceIndex=r}return c}function Lg(n,t,e,s,i){const r=s*3;let o=r+0,a=r+1,l=r+2;const c=n.index;n.index&&(o=c.getX(o),a=c.getX(a),l=c.getX(l));const{position:h,normal:u,uv:p,uv1:d}=n.attributes,g=Wz(e,h,u,p,d,o,a,l,t);return g?(g.faceIndex=s,i&&i.push(g),g):null}function es(n,t,e,s){const i=n.a,r=n.b,o=n.c;let a=t,l=t+1,c=t+2;e&&(a=e.getX(a),l=e.getX(l),c=e.getX(c)),i.x=s.getX(a),i.y=s.getY(a),i.z=s.getZ(a),r.x=s.getX(l),r.y=s.getY(l),r.z=s.getZ(l),o.x=s.getX(c),o.y=s.getY(c),o.z=s.getZ(c)}function Yz(n,t,e,s,i,r){const{geometry:o,_indirectBuffer:a}=n;for(let l=s,c=s+i;l<c;l++)Lg(o,t,e,l,r)}function Gz(n,t,e,s,i){const{geometry:r,_indirectBuffer:o}=n;let a=1/0,l=null;for(let c=s,h=s+i;c<h;c++){let u;u=Lg(r,t,e,c),u&&u.distance<a&&(l=u,a=u.distance)}return l}function qz(n,t,e,s,i,r,o){const{geometry:a}=e,{index:l}=a,c=a.attributes.position;for(let h=n,u=t+n;h<u;h++){let p;if(p=h,es(o,p*3,l,c),o.needsUpdate=!0,s(o,p,i,r))return!0}return!1}function Zz(n,t=null){t&&Array.isArray(t)&&(t=new Set(t));const e=n.geometry,s=e.index?e.index.array:null,i=e.attributes.position;let r,o,a,l,c=0;const h=n._roots;for(let p=0,d=h.length;p<d;p++)r=h[p],o=new Uint32Array(r),a=new Uint16Array(r),l=new Float32Array(r),u(0,c),c+=r.byteLength;function u(p,d,g=!1){const m=p*2;if(a[m+15]===Fg){const b=o[p+6],f=a[m+14];let _=1/0,y=1/0,v=1/0,w=-1/0,I=-1/0,C=-1/0;for(let A=3*b,S=3*(b+f);A<S;A++){let P=s[A];const M=i.getX(P),T=i.getY(P),L=i.getZ(P);M<_&&(_=M),M>w&&(w=M),T<y&&(y=T),T>I&&(I=T),L<v&&(v=L),L>C&&(C=L)}return l[p+0]!==_||l[p+1]!==y||l[p+2]!==v||l[p+3]!==w||l[p+4]!==I||l[p+5]!==C?(l[p+0]=_,l[p+1]=y,l[p+2]=v,l[p+3]=w,l[p+4]=I,l[p+5]=C,!0):!1}else{const b=p+8,f=o[p+6],_=b+d,y=f+d;let v=g,w=!1,I=!1;t?v||(w=t.has(_),I=t.has(y),v=!w&&!I):(w=!0,I=!0);const C=v||w,A=v||I;let S=!1;C&&(S=u(b,d,v));let P=!1;A&&(P=u(f,d,v));const M=S||P;if(M)for(let T=0;T<3;T++){const L=b+T,E=f+T,N=l[L],W=l[L+3],V=l[E],et=l[E+3];l[p+T]=N<V?N:V,l[p+T+3]=W>et?W:et}return M}}}const $E=new Tt;function Uo(n,t,e,s){return ke(n,t,$E),e.intersectBox($E,s)}function Xz(n,t,e,s,i,r){const{geometry:o,_indirectBuffer:a}=n;for(let l=s,c=s+i;l<c;l++){let h=a?a[l]:l;Lg(o,t,e,h,r)}}function Qz(n,t,e,s,i){const{geometry:r,_indirectBuffer:o}=n;let a=1/0,l=null;for(let c=s,h=s+i;c<h;c++){let u;u=Lg(r,t,e,o?o[c]:c),u&&u.distance<a&&(l=u,a=u.distance)}return l}function Kz(n,t,e,s,i,r,o){const{geometry:a}=e,{index:l}=a,c=a.attributes.position;for(let h=n,u=t+n;h<u;h++){let p;if(p=e.resolveTriangleIndex(h),es(o,p*3,l,c),o.needsUpdate=!0,s(o,p,i,r))return!0}return!1}const NE=new F;function Jz(n,t,e,s,i){Ie.setBuffer(n._roots[t]),J0(0,n,e,s,i),Ie.clearBuffer()}function J0(n,t,e,s,i){const{float32Array:r,uint16Array:o,uint32Array:a}=Ie,l=n*2;if(yi(l,o)){const c=Ii(n,a),h=sn(l,o);Yz(t,e,s,c,h,i)}else{const c=nn(n);Uo(c,r,s,NE)&&J0(c,t,e,s,i);const h=rn(n,a);Uo(h,r,s,NE)&&J0(h,t,e,s,i)}}const ME=new F,tB=["x","y","z"];function eB(n,t,e,s){Ie.setBuffer(n._roots[t]);const i=ty(0,n,e,s);return Ie.clearBuffer(),i}function ty(n,t,e,s){const{float32Array:i,uint16Array:r,uint32Array:o}=Ie;let a=n*2;if(yi(a,r)){const l=Ii(n,o),c=sn(a,r);return Gz(t,e,s,l,c)}else{const l=zA(n,o),c=tB[l],h=s.direction[c]>=0;let u,p;h?(u=nn(n),p=rn(n,o)):(u=rn(n,o),p=nn(n));const d=Uo(u,i,s,ME)?ty(u,t,e,s):null;if(d){const m=d.point[c];if(h?m<=i[p+l]:m>=i[p+l+3])return d}const g=Uo(p,i,s,ME)?ty(p,t,e,s):null;return d&&g?d.distance<=g.distance?d:g:d||g||null}}const Sf=new Tt,Ul=new $n,Vl=new $n,Qh=new xt,DE=new qs,Of=new qs;function sB(n,t,e,s){Ie.setBuffer(n._roots[t]);const i=ey(0,n,e,s);return Ie.clearBuffer(),i}function ey(n,t,e,s,i=null){const{float32Array:r,uint16Array:o,uint32Array:a}=Ie;let l=n*2;if(i===null&&(e.boundingBox||e.computeBoundingBox(),DE.set(e.boundingBox.min,e.boundingBox.max,s),i=DE),yi(l,o)){const c=t.geometry,h=c.index,u=c.attributes.position,p=e.index,d=e.attributes.position,g=Ii(n,a),m=sn(l,o);if(Qh.copy(s).invert(),e.boundsTree)return ke(n,r,Of),Of.matrix.copy(Qh),Of.needsUpdate=!0,e.boundsTree.shapecast({intersectsBounds:b=>Of.intersectsBox(b),intersectsTriangle:b=>{b.a.applyMatrix4(s),b.b.applyMatrix4(s),b.c.applyMatrix4(s),b.needsUpdate=!0;for(let f=g*3,_=(m+g)*3;f<_;f+=3)if(es(Vl,f,h,u),Vl.needsUpdate=!0,b.intersectsTriangle(Vl))return!0;return!1}});for(let b=g*3,f=(m+g)*3;b<f;b+=3){es(Ul,b,h,u),Ul.a.applyMatrix4(Qh),Ul.b.applyMatrix4(Qh),Ul.c.applyMatrix4(Qh),Ul.needsUpdate=!0;for(let _=0,y=p.count;_<y;_+=3)if(es(Vl,_,p,d),Vl.needsUpdate=!0,Ul.intersectsTriangle(Vl))return!0}}else{const c=n+8,h=a[n+6];return ke(c,r,Sf),!!(i.intersectsBox(Sf)&&ey(c,t,e,s,i)||(ke(h,r,Sf),i.intersectsBox(Sf)&&ey(h,t,e,s,i)))}}const Pf=new xt,E_=new qs,Kh=new qs,iB=new F,nB=new F,rB=new F,oB=new F;function aB(n,t,e,s={},i={},r=0,o=1/0){t.boundingBox||t.computeBoundingBox(),E_.set(t.boundingBox.min,t.boundingBox.max,e),E_.needsUpdate=!0;const a=n.geometry,l=a.attributes.position,c=a.index,h=t.attributes.position,u=t.index,p=en.getPrimitive(),d=en.getPrimitive();let g=iB,m=nB,b=null,f=null;i&&(b=rB,f=oB);let _=1/0,y=null,v=null;return Pf.copy(e).invert(),Kh.matrix.copy(Pf),n.shapecast({boundsTraverseOrder:w=>E_.distanceToBox(w),intersectsBounds:(w,I,C)=>C<_&&C<o?(I&&(Kh.min.copy(w.min),Kh.max.copy(w.max),Kh.needsUpdate=!0),!0):!1,intersectsRange:(w,I)=>{if(t.boundsTree)return t.boundsTree.shapecast({boundsTraverseOrder:C=>Kh.distanceToBox(C),intersectsBounds:(C,A,S)=>S<_&&S<o,intersectsRange:(C,A)=>{for(let S=C,P=C+A;S<P;S++){es(d,3*S,u,h),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let M=w,T=w+I;M<T;M++){es(p,3*M,c,l),p.needsUpdate=!0;const L=p.distanceToTriangle(d,g,b);if(L<_&&(m.copy(g),f&&f.copy(b),_=L,y=M,v=S),L<r)return!0}}}});{const C=eh(t);for(let A=0,S=C;A<S;A++){es(d,3*A,u,h),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let P=w,M=w+I;P<M;P++){es(p,3*P,c,l),p.needsUpdate=!0;const T=p.distanceToTriangle(d,g,b);if(T<_&&(m.copy(g),f&&f.copy(b),_=T,y=P,v=A),T<r)return!0}}}}}),en.releasePrimitive(p),en.releasePrimitive(d),_===1/0?null:(s.point?s.point.copy(m):s.point=m.clone(),s.distance=_,s.faceIndex=y,i&&(i.point?i.point.copy(f):i.point=f.clone(),i.point.applyMatrix4(Pf),m.applyMatrix4(Pf),i.distance=m.sub(i.point).length(),i.faceIndex=v),s)}function lB(n,t=null){t&&Array.isArray(t)&&(t=new Set(t));const e=n.geometry,s=e.index?e.index.array:null,i=e.attributes.position;let r,o,a,l,c=0;const h=n._roots;for(let p=0,d=h.length;p<d;p++)r=h[p],o=new Uint32Array(r),a=new Uint16Array(r),l=new Float32Array(r),u(0,c),c+=r.byteLength;function u(p,d,g=!1){const m=p*2;if(a[m+15]===Fg){const b=o[p+6],f=a[m+14];let _=1/0,y=1/0,v=1/0,w=-1/0,I=-1/0,C=-1/0;for(let A=b,S=b+f;A<S;A++){const P=3*n.resolveTriangleIndex(A);for(let M=0;M<3;M++){let T=P+M;T=s?s[T]:T;const L=i.getX(T),E=i.getY(T),N=i.getZ(T);L<_&&(_=L),L>w&&(w=L),E<y&&(y=E),E>I&&(I=E),N<v&&(v=N),N>C&&(C=N)}}return l[p+0]!==_||l[p+1]!==y||l[p+2]!==v||l[p+3]!==w||l[p+4]!==I||l[p+5]!==C?(l[p+0]=_,l[p+1]=y,l[p+2]=v,l[p+3]=w,l[p+4]=I,l[p+5]=C,!0):!1}else{const b=p+8,f=o[p+6],_=b+d,y=f+d;let v=g,w=!1,I=!1;t?v||(w=t.has(_),I=t.has(y),v=!w&&!I):(w=!0,I=!0);const C=v||w,A=v||I;let S=!1;C&&(S=u(b,d,v));let P=!1;A&&(P=u(f,d,v));const M=S||P;if(M)for(let T=0;T<3;T++){const L=b+T,E=f+T,N=l[L],W=l[L+3],V=l[E],et=l[E+3];l[p+T]=N<V?N:V,l[p+T+3]=W>et?W:et}return M}}}const kE=new F;function cB(n,t,e,s,i){Ie.setBuffer(n._roots[t]),sy(0,n,e,s,i),Ie.clearBuffer()}function sy(n,t,e,s,i){const{float32Array:r,uint16Array:o,uint32Array:a}=Ie,l=n*2;if(yi(l,o)){const c=Ii(n,a),h=sn(l,o);Xz(t,e,s,c,h,i)}else{const c=nn(n);Uo(c,r,s,kE)&&sy(c,t,e,s,i);const h=rn(n,a);Uo(h,r,s,kE)&&sy(h,t,e,s,i)}}const zE=new F,hB=["x","y","z"];function uB(n,t,e,s){Ie.setBuffer(n._roots[t]);const i=iy(0,n,e,s);return Ie.clearBuffer(),i}function iy(n,t,e,s){const{float32Array:i,uint16Array:r,uint32Array:o}=Ie;let a=n*2;if(yi(a,r)){const l=Ii(n,o),c=sn(a,r);return Qz(t,e,s,l,c)}else{const l=zA(n,o),c=hB[l],h=s.direction[c]>=0;let u,p;h?(u=nn(n),p=rn(n,o)):(u=rn(n,o),p=nn(n));const d=Uo(u,i,s,zE)?iy(u,t,e,s):null;if(d){const m=d.point[c];if(h?m<=i[p+l]:m>=i[p+l+3])return d}const g=Uo(p,i,s,zE)?iy(p,t,e,s):null;return d&&g?d.distance<=g.distance?d:g:d||g||null}}const Rf=new Tt,Hl=new $n,jl=new $n,Jh=new xt,BE=new qs,Ff=new qs;function dB(n,t,e,s){Ie.setBuffer(n._roots[t]);const i=ny(0,n,e,s);return Ie.clearBuffer(),i}function ny(n,t,e,s,i=null){const{float32Array:r,uint16Array:o,uint32Array:a}=Ie;let l=n*2;if(i===null&&(e.boundingBox||e.computeBoundingBox(),BE.set(e.boundingBox.min,e.boundingBox.max,s),i=BE),yi(l,o)){const c=t.geometry,h=c.index,u=c.attributes.position,p=e.index,d=e.attributes.position,g=Ii(n,a),m=sn(l,o);if(Jh.copy(s).invert(),e.boundsTree)return ke(n,r,Ff),Ff.matrix.copy(Jh),Ff.needsUpdate=!0,e.boundsTree.shapecast({intersectsBounds:b=>Ff.intersectsBox(b),intersectsTriangle:b=>{b.a.applyMatrix4(s),b.b.applyMatrix4(s),b.c.applyMatrix4(s),b.needsUpdate=!0;for(let f=g,_=m+g;f<_;f++)if(es(jl,3*t.resolveTriangleIndex(f),h,u),jl.needsUpdate=!0,b.intersectsTriangle(jl))return!0;return!1}});for(let b=g,f=m+g;b<f;b++){const _=t.resolveTriangleIndex(b);es(Hl,3*_,h,u),Hl.a.applyMatrix4(Jh),Hl.b.applyMatrix4(Jh),Hl.c.applyMatrix4(Jh),Hl.needsUpdate=!0;for(let y=0,v=p.count;y<v;y+=3)if(es(jl,y,p,d),jl.needsUpdate=!0,Hl.intersectsTriangle(jl))return!0}}else{const c=n+8,h=a[n+6];return ke(c,r,Rf),!!(i.intersectsBox(Rf)&&ny(c,t,e,s,i)||(ke(h,r,Rf),i.intersectsBox(Rf)&&ny(h,t,e,s,i)))}}const Lf=new xt,x_=new qs,tu=new qs,pB=new F,fB=new F,mB=new F,gB=new F;function bB(n,t,e,s={},i={},r=0,o=1/0){t.boundingBox||t.computeBoundingBox(),x_.set(t.boundingBox.min,t.boundingBox.max,e),x_.needsUpdate=!0;const a=n.geometry,l=a.attributes.position,c=a.index,h=t.attributes.position,u=t.index,p=en.getPrimitive(),d=en.getPrimitive();let g=pB,m=fB,b=null,f=null;i&&(b=mB,f=gB);let _=1/0,y=null,v=null;return Lf.copy(e).invert(),tu.matrix.copy(Lf),n.shapecast({boundsTraverseOrder:w=>x_.distanceToBox(w),intersectsBounds:(w,I,C)=>C<_&&C<o?(I&&(tu.min.copy(w.min),tu.max.copy(w.max),tu.needsUpdate=!0),!0):!1,intersectsRange:(w,I)=>{if(t.boundsTree){const C=t.boundsTree;return C.shapecast({boundsTraverseOrder:A=>tu.distanceToBox(A),intersectsBounds:(A,S,P)=>P<_&&P<o,intersectsRange:(A,S)=>{for(let P=A,M=A+S;P<M;P++){const T=C.resolveTriangleIndex(P);es(d,3*T,u,h),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let L=w,E=w+I;L<E;L++){const N=n.resolveTriangleIndex(L);es(p,3*N,c,l),p.needsUpdate=!0;const W=p.distanceToTriangle(d,g,b);if(W<_&&(m.copy(g),f&&f.copy(b),_=W,y=L,v=P),W<r)return!0}}}})}else{const C=eh(t);for(let A=0,S=C;A<S;A++){es(d,3*A,u,h),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let P=w,M=w+I;P<M;P++){const T=n.resolveTriangleIndex(P);es(p,3*T,c,l),p.needsUpdate=!0;const L=p.distanceToTriangle(d,g,b);if(L<_&&(m.copy(g),f&&f.copy(b),_=L,y=P,v=A),L<r)return!0}}}}}),en.releasePrimitive(p),en.releasePrimitive(d),_===1/0?null:(s.point?s.point.copy(m):s.point=m.clone(),s.distance=_,s.faceIndex=y,i&&(i.point?i.point.copy(f):i.point=f.clone(),i.point.applyMatrix4(Lf),m.applyMatrix4(Lf),i.distance=m.sub(i.point).length(),i.faceIndex=v),s)}function _B(){return typeof SharedArrayBuffer<"u"}const Yu=new Ie.constructor,km=new Ie.constructor,go=new Iv(()=>new Tt),Wl=new Tt,Yl=new Tt,I_=new Tt,C_=new Tt;let T_=!1;function yB(n,t,e,s){if(T_)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");T_=!0;const i=n._roots,r=t._roots;let o,a=0,l=0;const c=new xt().copy(e).invert();for(let h=0,u=i.length;h<u;h++){Yu.setBuffer(i[h]),l=0;const p=go.getPrimitive();ke(0,Yu.float32Array,p),p.applyMatrix4(c);for(let d=0,g=r.length;d<g&&(km.setBuffer(r[h]),o=Sn(0,0,e,c,s,a,l,0,0,p),km.clearBuffer(),l+=r[d].length,!o);d++);if(go.releasePrimitive(p),Yu.clearBuffer(),a+=i[h].length,o)break}return T_=!1,o}function Sn(n,t,e,s,i,r=0,o=0,a=0,l=0,c=null,h=!1){let u,p;h?(u=km,p=Yu):(u=Yu,p=km);const d=u.float32Array,g=u.uint32Array,m=u.uint16Array,b=p.float32Array,f=p.uint32Array,_=p.uint16Array,y=n*2,v=t*2,w=yi(y,m),I=yi(v,_);let C=!1;if(I&&w)h?C=i(Ii(t,f),sn(t*2,_),Ii(n,g),sn(n*2,m),l,o+t,a,r+n):C=i(Ii(n,g),sn(n*2,m),Ii(t,f),sn(t*2,_),a,r+n,l,o+t);else if(I){const A=go.getPrimitive();ke(t,b,A),A.applyMatrix4(e);const S=nn(n),P=rn(n,g);ke(S,d,Wl),ke(P,d,Yl);const M=A.intersectsBox(Wl),T=A.intersectsBox(Yl);C=M&&Sn(t,S,s,e,i,o,r,l,a+1,A,!h)||T&&Sn(t,P,s,e,i,o,r,l,a+1,A,!h),go.releasePrimitive(A)}else{const A=nn(t),S=rn(t,f);ke(A,b,I_),ke(S,b,C_);const P=c.intersectsBox(I_),M=c.intersectsBox(C_);if(P&&M)C=Sn(n,A,e,s,i,r,o,a,l+1,c,h)||Sn(n,S,e,s,i,r,o,a,l+1,c,h);else if(P)if(w)C=Sn(n,A,e,s,i,r,o,a,l+1,c,h);else{const T=go.getPrimitive();T.copy(I_).applyMatrix4(e);const L=nn(n),E=rn(n,g);ke(L,d,Wl),ke(E,d,Yl);const N=T.intersectsBox(Wl),W=T.intersectsBox(Yl);C=N&&Sn(A,L,s,e,i,o,r,l,a+1,T,!h)||W&&Sn(A,E,s,e,i,o,r,l,a+1,T,!h),go.releasePrimitive(T)}else if(M)if(w)C=Sn(n,S,e,s,i,r,o,a,l+1,c,h);else{const T=go.getPrimitive();T.copy(C_).applyMatrix4(e);const L=nn(n),E=rn(n,g);ke(L,d,Wl),ke(E,d,Yl);const N=T.intersectsBox(Wl),W=T.intersectsBox(Yl);C=N&&Sn(S,L,s,e,i,o,r,l,a+1,T,!h)||W&&Sn(S,E,s,e,i,o,r,l,a+1,T,!h),go.releasePrimitive(T)}}return C}const $f=new qs,UE=new Tt;let vB=class BA{static serialize(t,e={}){e={cloneBuffers:!0,...e};const s=t.geometry,i=t._roots,r=t._indirectBuffer,o=s.getIndex();let a;return e.cloneBuffers?a={roots:i.map(l=>l.slice()),index:o.array.slice(),indirectBuffer:r?r.slice():null}:a={roots:i,index:o.array,indirectBuffer:r},a}static deserialize(t,e,s={}){s={setIndex:!0,indirect:!!t.indirectBuffer,...s};const{index:i,roots:r,indirectBuffer:o}=t,a=new BA(e,{...s,[__]:!0});if(a._roots=r,a._indirectBuffer=o||null,s.setIndex){const l=e.getIndex();if(l===null){const c=new ze(t.index,1,!1);e.setIndex(c)}else l.array!==i&&(l.array.set(i),l.needsUpdate=!0)}return a}get indirect(){return!!this._indirectBuffer}constructor(t,e={}){if(t.isBufferGeometry){if(t.index&&t.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e=Object.assign({strategy:MA,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,[__]:!1},e),e.useSharedArrayBuffer&&!_B())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=t,this._roots=null,this._indirectBuffer=null,e[__]||(Mz(this,e),!t.boundingBox&&e.setBoundingBox&&(t.boundingBox=this.getBoundingBox(new Tt)));const{_indirectBuffer:s}=this;this.resolveTriangleIndex=e.indirect?i=>s[i]:i=>i}refit(t=null){return(this.indirect?lB:Zz)(this,t)}traverse(t,e=0){const s=this._roots[e],i=new Uint32Array(s),r=new Uint16Array(s);o(0);function o(a,l=0){const c=a*2,h=r[c+15]===Fg;if(h){const u=i[a+6],p=r[c+14];t(l,h,new Float32Array(s,a*4,6),u,p)}else{const u=a+dm/4,p=i[a+6],d=i[a+7];t(l,h,new Float32Array(s,a*4,6),d)||(o(u,l+1),o(p,l+1))}}}raycast(t,e=Ic){const s=this._roots,i=this.geometry,r=[],o=e.isMaterial,a=Array.isArray(e),l=i.groups,c=o?e.side:e,h=this.indirect?cB:Jz;for(let u=0,p=s.length;u<p;u++){const d=a?e[l[u].materialIndex].side:c,g=r.length;if(h(this,u,d,t,r),a){const m=l[u].materialIndex;for(let b=g,f=r.length;b<f;b++)r[b].face.materialIndex=m}}return r}raycastFirst(t,e=Ic){const s=this._roots,i=this.geometry,r=e.isMaterial,o=Array.isArray(e);let a=null;const l=i.groups,c=r?e.side:e,h=this.indirect?uB:eB;for(let u=0,p=s.length;u<p;u++){const d=o?e[l[u].materialIndex].side:c,g=h(this,u,d,t);g!=null&&(a==null||g.distance<a.distance)&&(a=g,o&&(g.face.materialIndex=l[u].materialIndex))}return a}intersectsGeometry(t,e){let s=!1;const i=this._roots,r=this.indirect?dB:sB;for(let o=0,a=i.length;o<a&&(s=r(this,o,t,e),!s);o++);return s}shapecast(t){const e=en.getPrimitive(),s=this.indirect?Kz:qz;let{boundsTraverseOrder:i,intersectsBounds:r,intersectsRange:o,intersectsTriangle:a}=t;if(o&&a){const u=o;o=(p,d,g,m,b)=>u(p,d,g,m,b)?!0:s(p,d,this,a,g,m,e)}else o||(a?o=(u,p,d,g)=>s(u,p,this,a,d,g,e):o=(u,p,d)=>d);let l=!1,c=0;const h=this._roots;for(let u=0,p=h.length;u<p;u++){const d=h[u];if(l=Vz(this,u,r,o,i,c),l)break;c+=d.byteLength}return en.releasePrimitive(e),l}bvhcast(t,e,s){let{intersectsRanges:i,intersectsTriangles:r}=s;const o=en.getPrimitive(),a=this.geometry.index,l=this.geometry.attributes.position,c=this.indirect?g=>{const m=this.resolveTriangleIndex(g);es(o,m*3,a,l)}:g=>{es(o,g*3,a,l)},h=en.getPrimitive(),u=t.geometry.index,p=t.geometry.attributes.position,d=t.indirect?g=>{const m=t.resolveTriangleIndex(g);es(h,m*3,u,p)}:g=>{es(h,g*3,u,p)};if(r){const g=(m,b,f,_,y,v,w,I)=>{for(let C=f,A=f+_;C<A;C++){d(C),h.a.applyMatrix4(e),h.b.applyMatrix4(e),h.c.applyMatrix4(e),h.needsUpdate=!0;for(let S=m,P=m+b;S<P;S++)if(c(S),o.needsUpdate=!0,r(o,h,S,C,y,v,w,I))return!0}return!1};if(i){const m=i;i=function(b,f,_,y,v,w,I,C){return m(b,f,_,y,v,w,I,C)?!0:g(b,f,_,y,v,w,I,C)}}else i=g}return yB(this,t,e,i)}intersectsBox(t,e){return $f.set(t.min,t.max,e),$f.needsUpdate=!0,this.shapecast({intersectsBounds:s=>$f.intersectsBox(s),intersectsTriangle:s=>$f.intersectsTriangle(s)})}intersectsSphere(t){return this.shapecast({intersectsBounds:e=>t.intersectsBox(e),intersectsTriangle:e=>e.intersectsSphere(t)})}closestPointToGeometry(t,e,s={},i={},r=0,o=1/0){return(this.indirect?bB:aB)(this,t,e,s,i,r,o)}closestPointToPoint(t,e={},s=0,i=1/0){return Hz(this,t,e,s,i)}getBoundingBox(t){return t.makeEmpty(),this._roots.forEach(e=>{ke(0,new Float32Array(e),UE),t.union(UE)}),t}};function VE(n,t,e){return n===null||(n.point.applyMatrix4(t.matrixWorld),n.distance=n.point.distanceTo(e.ray.origin),n.object=t,n.distance<e.near||n.distance>e.far)?null:n}const A_=new $o,HE=new xt,wB=ht.prototype.raycast;function EB(n,t){if(this.geometry.boundsTree){if(this.material===void 0)return;HE.copy(this.matrixWorld).invert(),A_.copy(n.ray).applyMatrix4(HE);const e=this.geometry.boundsTree;if(n.firstHitOnly===!0){const s=VE(e.raycastFirst(A_,this.material),this,n);s&&t.push(s)}else{const s=e.raycast(A_,this.material);for(let i=0,r=s.length;i<r;i++){const o=VE(s[i],this,n);o&&t.push(o)}}}else wB.call(this,n,t)}function xB(n){return this.boundsTree=new vB(this,n),this.boundsTree}function IB(){this.boundsTree=null}const UA=class VA{constructor(){z(this,"onDisposed",new yt),z(this,"list",new Yt),z(this,"enabled",!1),z(this,"_clock"),z(this,"onInit",new yt),z(this,"update",()=>{if(!this.enabled)return;const t=this._clock.getDelta();for(const[e,s]of this.list)s.enabled&&s.isUpdateable()&&s.update(t);requestAnimationFrame(this.update)}),this._clock=new lC,VA.setupBVH()}add(t,e){if(this.list.has(t))throw new Error("You're trying to add a component that already exists in the components instance. Use Components.get() instead.");Ps.validate(t),this.list.set(t,e)}get(t){const e=t.uuid;if(!this.list.has(e)){const s=new t(this);return s.isDisposeable()&&s.onDisposed.add(()=>this.list.delete(e)),this.list.has(e)||this.add(e,s),s}return this.list.get(e)}init(){this.enabled=!0;for(const[t,e]of this.list.entries())e.enabled=!0;this._clock.start(),this.update(),this.onInit.trigger()}dispose(){this.enabled=!1;let t;for(const[e,s]of this.list){if(s.enabled=!1,e===Mt.uuid){t=s;continue}s.isDisposeable()&&s.dispose()}t?.dispose(),this._clock.stop(),this.onDisposed.trigger()}static setupBVH(){Ce.prototype.computeBoundsTree=xB,Ce.prototype.disposeBoundsTree=IB,ht.prototype.raycast=EB}};z(UA,"release","2.4.3");let HA=UA,CB=class{constructor(t){z(this,"enabled",!1),z(this,"id","FirstPerson"),this.camera=t}set(t){if(this.enabled=t,t){if(this.camera.projection.current!=="Perspective"){this.camera.set("Orbit");return}this.setupFirstPersonCamera()}}setupFirstPersonCamera(){const t=this.camera.controls,e=new F;t.distance--,t.getPosition(e),t.minDistance=1,t.maxDistance=1,t.distance=1,t.moveTo(e.x,e.y,e.z),t.truckSpeed=50,t.mouseButtons.wheel=_i.ACTION.DOLLY,t.touches.two=_i.ACTION.TOUCH_ZOOM_TRUCK}},TB=class{constructor(t){z(this,"enabled",!0),z(this,"id","Orbit"),this.camera=t,this.activateOrbitControls()}set(t){this.enabled=t,t&&this.activateOrbitControls()}activateOrbitControls(){const t=this.camera.controls;t.minDistance=1,t.maxDistance=300;const e=new F;t.getPosition(e);const s=e.length();t.distance=s,t.truckSpeed=2;const{rotation:i}=this.camera.three,r=new F(0,0,-1).applyEuler(i),o=e.addScaledVector(r,s);t.moveTo(o.x,o.y,o.z)}},AB=class{constructor(t){z(this,"enabled",!1),z(this,"id","Plan"),z(this,"mouseAction1"),z(this,"mouseAction2"),z(this,"mouseInitialized",!1),z(this,"defaultAzimuthSpeed"),z(this,"defaultPolarSpeed"),this.camera=t,this.defaultAzimuthSpeed=t.controls.azimuthRotateSpeed,this.defaultPolarSpeed=t.controls.polarRotateSpeed}set(t){this.enabled=t;const e=this.camera.controls;e.azimuthRotateSpeed=t?0:this.defaultAzimuthSpeed,e.polarRotateSpeed=t?0:this.defaultPolarSpeed,this.mouseInitialized||(this.mouseAction1=e.touches.one,this.mouseAction2=e.touches.two,this.mouseInitialized=!0),t?(e.mouseButtons.left=_i.ACTION.TRUCK,e.touches.one=_i.ACTION.TOUCH_TRUCK,e.touches.two=_i.ACTION.TOUCH_ZOOM):(e.mouseButtons.left=_i.ACTION.ROTATE,e.touches.one=this.mouseAction1,e.touches.two=this.mouseAction2)}},SB=class{constructor(t){z(this,"onChanged",new yt),z(this,"current","Perspective"),z(this,"camera"),z(this,"matchOrthoDistanceEnabled",!1),z(this,"_component"),z(this,"_previousDistance",-1),this._component=t,this.camera=t.three}async set(t){this.current!==t&&(t==="Orthographic"?this.setOrthoCamera():await this.setPerspectiveCamera(),this.onChanged.trigger(this.camera))}async toggle(){const t=this.current==="Perspective"?"Orthographic":"Perspective";await this.set(t)}setOrthoCamera(){if(this._component.mode===null||this._component.mode.id==="FirstPerson")return;this._previousDistance=this._component.controls.distance,this._component.controls.distance=200;const t=this.getPerspectiveDims();if(!t)return;const{width:e,height:s}=t;this.setupOrthoCamera(s,e),this.camera=this._component.threeOrtho,this.current="Orthographic"}getPerspectiveDims(){const t=this._component.currentWorld;if(!t||!t.renderer)return null;const e=new F;this._component.threePersp.getWorldDirection(e);const s=new F;this._component.controls.getTarget(s);const i=s.clone().sub(this._component.threePersp.position).dot(e),r=t.renderer.getSize(),o=r.x/r.y,a=this._component.threePersp,l=i*2*Math.atan(a.fov*(Math.PI/180)/2);return{width:l*o,height:l}}setupOrthoCamera(t,e){this._component.controls.mouseButtons.wheel=_i.ACTION.ZOOM,this._component.controls.mouseButtons.middle=_i.ACTION.ZOOM;const s=this._component.threePersp,i=this._component.threeOrtho;i.zoom=1,i.left=e/-2,i.right=e/2,i.top=t/2,i.bottom=t/-2,i.updateProjectionMatrix(),i.position.copy(s.position),i.quaternion.copy(s.quaternion),this._component.controls.camera=i}getDistance(){const t=this._component.threePersp,e=this._component.threeOrtho;return(e.top-e.bottom)/e.zoom/(2*Math.atan(t.fov*(Math.PI/180)/2))}async setPerspectiveCamera(){this._component.controls.mouseButtons.wheel=_i.ACTION.DOLLY,this._component.controls.mouseButtons.middle=_i.ACTION.DOLLY;const t=this._component.threePersp,e=this._component.threeOrtho;t.position.copy(e.position),t.quaternion.copy(e.quaternion),this._component.controls.mouseButtons.wheel=_i.ACTION.DOLLY,this.matchOrthoDistanceEnabled?this._component.controls.distance=this.getDistance():this._component.controls.distance=this._previousDistance,await this._component.controls.zoomTo(1),t.updateProjectionMatrix(),this._component.controls.camera=t,this.camera=t,this.current="Perspective"}},jA=class extends Q0{constructor(t){super(t),z(this,"projection"),z(this,"threeOrtho"),z(this,"threePersp"),z(this,"_userInputButtons",{}),z(this,"_frustumSize",50),z(this,"_navigationModes",new Map),z(this,"_mode",null),z(this,"previousSize",null),this.threePersp=this.three,this.threeOrtho=this.newOrthoCamera(),this.projection=new SB(this),this.onAspectUpdated.add(()=>{this.setOrthoPerspCameraAspect()}),this.projection.onChanged.add(e=>{this.three=e,this.updateAspect()}),this.worlds.onItemSet.add(()=>{this._navigationModes.clear(),this._navigationModes.set("Orbit",new TB(this)),this._navigationModes.set("FirstPerson",new CB(this)),this._navigationModes.set("Plan",new AB(this)),this._mode=this._navigationModes.get("Orbit"),this.mode.set(!0,{preventTargetAdjustment:!0}),this.currentWorld&&this.currentWorld.renderer&&(this.previousSize=this.currentWorld.renderer.getSize().clone())}),this.worlds.onItemDeleted.add(()=>{this._navigationModes.clear()})}get mode(){if(!this._mode)throw new Error("Mode not found, camera not initialized");return this._mode}dispose(){super.dispose(),this.threeOrtho.removeFromParent()}set(t){if(this.mode!==null&&this.mode.id!==t){if(this.mode.set(!1),!this._navigationModes.has(t))throw new Error("The specified mode does not exist!");this._mode=this._navigationModes.get(t),this.mode.set(!0)}}async fit(t,e=1.5){if(!this.enabled)return;const s=Number.MAX_VALUE,i=Number.MIN_VALUE,r=new F(s,s,s),o=new F(i,i,i);for(const d of t){const g=new Tt().setFromObject(d);g.min.x<r.x&&(r.x=g.min.x),g.min.y<r.y&&(r.y=g.min.y),g.min.z<r.z&&(r.z=g.min.z),g.max.x>o.x&&(o.x=g.max.x),g.max.y>o.y&&(o.y=g.max.y),g.max.z>o.z&&(o.z=g.max.z)}const a=new Tt(r,o),l=this.components.get(Mt);if(l.initialized)for(const[,d]of l.list){const g=d.box;g.min.x<r.x&&(r.x=g.min.x),g.min.y<r.y&&(r.y=g.min.y),g.min.z<r.z&&(r.z=g.min.z),g.max.x>o.x&&(o.x=g.max.x),g.max.y>o.y&&(o.y=g.max.y),g.max.z>o.z&&(o.z=g.max.z)}const c=new F;a.getSize(c);const h=new F;a.getCenter(h);const u=Math.max(c.x,c.y,c.z)*e,p=new Us(h,u);await this.controls.fitToSphere(p,!0)}setUserInput(t){t?this.enableUserInput():this.disableUserInput()}disableUserInput(){this._userInputButtons.left=this.controls.mouseButtons.left,this._userInputButtons.right=this.controls.mouseButtons.right,this._userInputButtons.middle=this.controls.mouseButtons.middle,this._userInputButtons.wheel=this.controls.mouseButtons.wheel,this.controls.mouseButtons.left=0,this.controls.mouseButtons.right=0,this.controls.mouseButtons.middle=0,this.controls.mouseButtons.wheel=0}enableUserInput(){Object.keys(this._userInputButtons).length!==0&&(this.controls.mouseButtons.left=this._userInputButtons.left,this.controls.mouseButtons.right=this._userInputButtons.right,this.controls.mouseButtons.middle=this._userInputButtons.middle,this.controls.mouseButtons.wheel=this._userInputButtons.wheel)}newOrthoCamera(){const t=window.innerWidth/window.innerHeight;return new sl(this._frustumSize*t/-2,this._frustumSize*t/2,this._frustumSize/2,this._frustumSize/-2,.1,1e3)}setOrthoPerspCameraAspect(){if(!this.currentWorld||!this.currentWorld.renderer||!this.previousSize)return;const t=this.currentWorld.renderer.getSize(),e=this.threeOrtho.top,s=this.threeOrtho.right,i=t.y/this.previousSize.y,r=t.x/this.previousSize.x,o=e*i,a=s*r;this.threeOrtho.left=-a,this.threeOrtho.right=a,this.threeOrtho.top=o,this.threeOrtho.bottom=-o,this.threeOrtho.updateProjectionMatrix(),this.previousSize.copy(t)}};function Nf(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var WA={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(n,t){(function(e){n.exports=e()})(function(){return(function e(s,i,r){function o(c,h){if(!i[c]){if(!s[c]){var u=typeof Nf=="function"&&Nf;if(!h&&u)return u(c,!0);if(a)return a(c,!0);var p=new Error("Cannot find module '"+c+"'");throw p.code="MODULE_NOT_FOUND",p}var d=i[c]={exports:{}};s[c][0].call(d.exports,function(g){var m=s[c][1][g];return o(m||g)},d,d.exports,e,s,i,r)}return i[c].exports}for(var a=typeof Nf=="function"&&Nf,l=0;l<r.length;l++)o(r[l]);return o})({1:[function(e,s,i){var r=e("./utils"),o=e("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(l){for(var c,h,u,p,d,g,m,b=[],f=0,_=l.length,y=_,v=r.getTypeOf(l)!=="string";f<l.length;)y=_-f,u=v?(c=l[f++],h=f<_?l[f++]:0,f<_?l[f++]:0):(c=l.charCodeAt(f++),h=f<_?l.charCodeAt(f++):0,f<_?l.charCodeAt(f++):0),p=c>>2,d=(3&c)<<4|h>>4,g=1<y?(15&h)<<2|u>>6:64,m=2<y?63&u:64,b.push(a.charAt(p)+a.charAt(d)+a.charAt(g)+a.charAt(m));return b.join("")},i.decode=function(l){var c,h,u,p,d,g,m=0,b=0,f="data:";if(l.substr(0,f.length)===f)throw new Error("Invalid base64 input, it looks like a data url.");var _,y=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===a.charAt(64)&&y--,l.charAt(l.length-2)===a.charAt(64)&&y--,y%1!=0)throw new Error("Invalid base64 input, bad content length.");for(_=o.uint8array?new Uint8Array(0|y):new Array(0|y);m<l.length;)c=a.indexOf(l.charAt(m++))<<2|(p=a.indexOf(l.charAt(m++)))>>4,h=(15&p)<<4|(d=a.indexOf(l.charAt(m++)))>>2,u=(3&d)<<6|(g=a.indexOf(l.charAt(m++))),_[b++]=c,d!==64&&(_[b++]=h),g!==64&&(_[b++]=u);return _}},{"./support":30,"./utils":32}],2:[function(e,s,i){var r=e("./external"),o=e("./stream/DataWorker"),a=e("./stream/Crc32Probe"),l=e("./stream/DataLengthProbe");function c(h,u,p,d,g){this.compressedSize=h,this.uncompressedSize=u,this.crc32=p,this.compression=d,this.compressedContent=g}c.prototype={getContentWorker:function(){var h=new o(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),u=this;return h.on("end",function(){if(this.streamInfo.data_length!==u.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),h},getCompressedWorker:function(){return new o(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(h,u,p){return h.pipe(new a).pipe(new l("uncompressedSize")).pipe(u.compressWorker(p)).pipe(new l("compressedSize")).withStreamInfo("compression",u)},s.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,s,i){var r=e("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},i.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,s,i){var r=e("./utils"),o=(function(){for(var a,l=[],c=0;c<256;c++){a=c;for(var h=0;h<8;h++)a=1&a?3988292384^a>>>1:a>>>1;l[c]=a}return l})();s.exports=function(a,l){return a!==void 0&&a.length?r.getTypeOf(a)!=="string"?(function(c,h,u,p){var d=o,g=p+u;c^=-1;for(var m=p;m<g;m++)c=c>>>8^d[255&(c^h[m])];return-1^c})(0|l,a,a.length,0):(function(c,h,u,p){var d=o,g=p+u;c^=-1;for(var m=p;m<g;m++)c=c>>>8^d[255&(c^h.charCodeAt(m))];return-1^c})(0|l,a,a.length,0):0}},{"./utils":32}],5:[function(e,s,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(e,s,i){var r=null;r=typeof Promise<"u"?Promise:e("lie"),s.exports={Promise:r}},{lie:37}],7:[function(e,s,i){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=e("pako"),a=e("./utils"),l=e("./stream/GenericWorker"),c=r?"uint8array":"array";function h(u,p){l.call(this,"FlateWorker/"+u),this._pako=null,this._pakoAction=u,this._pakoOptions=p,this.meta={}}i.magic="\b\0",a.inherits(h,l),h.prototype.processChunk=function(u){this.meta=u.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(c,u.data),!1)},h.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},h.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},h.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var u=this;this._pako.onData=function(p){u.push({data:p,meta:u.meta})}},i.compressWorker=function(u){return new h("Deflate",u)},i.uncompressWorker=function(){return new h("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,s,i){function r(d,g){var m,b="";for(m=0;m<g;m++)b+=String.fromCharCode(255&d),d>>>=8;return b}function o(d,g,m,b,f,_){var y,v,w=d.file,I=d.compression,C=_!==c.utf8encode,A=a.transformTo("string",_(w.name)),S=a.transformTo("string",c.utf8encode(w.name)),P=w.comment,M=a.transformTo("string",_(P)),T=a.transformTo("string",c.utf8encode(P)),L=S.length!==w.name.length,E=T.length!==P.length,N="",W="",V="",et=w.dir,j=w.date,nt={crc32:0,compressedSize:0,uncompressedSize:0};g&&!m||(nt.crc32=d.crc32,nt.compressedSize=d.compressedSize,nt.uncompressedSize=d.uncompressedSize);var H=0;g&&(H|=8),C||!L&&!E||(H|=2048);var B=0,rt=0;et&&(B|=16),f==="UNIX"?(rt=798,B|=(function(st,ct){var _t=st;return st||(_t=ct?16893:33204),(65535&_t)<<16})(w.unixPermissions,et)):(rt=20,B|=(function(st){return 63&(st||0)})(w.dosPermissions)),y=j.getUTCHours(),y<<=6,y|=j.getUTCMinutes(),y<<=5,y|=j.getUTCSeconds()/2,v=j.getUTCFullYear()-1980,v<<=4,v|=j.getUTCMonth()+1,v<<=5,v|=j.getUTCDate(),L&&(W=r(1,1)+r(h(A),4)+S,N+="up"+r(W.length,2)+W),E&&(V=r(1,1)+r(h(M),4)+T,N+="uc"+r(V.length,2)+V);var Q="";return Q+=`
\0`,Q+=r(H,2),Q+=I.magic,Q+=r(y,2),Q+=r(v,2),Q+=r(nt.crc32,4),Q+=r(nt.compressedSize,4),Q+=r(nt.uncompressedSize,4),Q+=r(A.length,2),Q+=r(N.length,2),{fileRecord:u.LOCAL_FILE_HEADER+Q+A+N,dirRecord:u.CENTRAL_FILE_HEADER+r(rt,2)+Q+r(M.length,2)+"\0\0\0\0"+r(B,4)+r(b,4)+A+N+M}}var a=e("../utils"),l=e("../stream/GenericWorker"),c=e("../utf8"),h=e("../crc32"),u=e("../signature");function p(d,g,m,b){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=g,this.zipPlatform=m,this.encodeFileName=b,this.streamFiles=d,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(p,l),p.prototype.push=function(d){var g=d.meta.percent||0,m=this.entriesCount,b=this._sources.length;this.accumulate?this.contentBuffer.push(d):(this.bytesWritten+=d.data.length,l.prototype.push.call(this,{data:d.data,meta:{currentFile:this.currentFile,percent:m?(g+100*(m-b-1))/m:100}}))},p.prototype.openedSource=function(d){this.currentSourceOffset=this.bytesWritten,this.currentFile=d.file.name;var g=this.streamFiles&&!d.file.dir;if(g){var m=o(d,g,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},p.prototype.closedSource=function(d){this.accumulate=!1;var g=this.streamFiles&&!d.file.dir,m=o(d,g,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),g)this.push({data:(function(b){return u.DATA_DESCRIPTOR+r(b.crc32,4)+r(b.compressedSize,4)+r(b.uncompressedSize,4)})(d),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},p.prototype.flush=function(){for(var d=this.bytesWritten,g=0;g<this.dirRecords.length;g++)this.push({data:this.dirRecords[g],meta:{percent:100}});var m=this.bytesWritten-d,b=(function(f,_,y,v,w){var I=a.transformTo("string",w(v));return u.CENTRAL_DIRECTORY_END+"\0\0\0\0"+r(f,2)+r(f,2)+r(_,4)+r(y,4)+r(I.length,2)+I})(this.dirRecords.length,m,d,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})},p.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},p.prototype.registerPrevious=function(d){this._sources.push(d);var g=this;return d.on("data",function(m){g.processChunk(m)}),d.on("end",function(){g.closedSource(g.previous.streamInfo),g._sources.length?g.prepareNextSource():g.end()}),d.on("error",function(m){g.error(m)}),this},p.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},p.prototype.error=function(d){var g=this._sources;if(!l.prototype.error.call(this,d))return!1;for(var m=0;m<g.length;m++)try{g[m].error(d)}catch{}return!0},p.prototype.lock=function(){l.prototype.lock.call(this);for(var d=this._sources,g=0;g<d.length;g++)d[g].lock()},s.exports=p},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,s,i){var r=e("../compressions"),o=e("./ZipFileWorker");i.generateWorker=function(a,l,c){var h=new o(l.streamFiles,c,l.platform,l.encodeFileName),u=0;try{a.forEach(function(p,d){u++;var g=(function(_,y){var v=_||y,w=r[v];if(!w)throw new Error(v+" is not a valid compression method !");return w})(d.options.compression,l.compression),m=d.options.compressionOptions||l.compressionOptions||{},b=d.dir,f=d.date;d._compressWorker(g,m).withStreamInfo("file",{name:p,dir:b,date:f,comment:d.comment||"",unixPermissions:d.unixPermissions,dosPermissions:d.dosPermissions}).pipe(h)}),h.entriesCount=u}catch(p){h.error(p)}return h}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,s,i){function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new r;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(r.prototype=e("./object")).loadAsync=e("./load"),r.support=e("./support"),r.defaults=e("./defaults"),r.version="3.10.1",r.loadAsync=function(o,a){return new r().loadAsync(o,a)},r.external=e("./external"),s.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,s,i){var r=e("./utils"),o=e("./external"),a=e("./utf8"),l=e("./zipEntries"),c=e("./stream/Crc32Probe"),h=e("./nodejsUtils");function u(p){return new o.Promise(function(d,g){var m=p.decompressed.getContentWorker().pipe(new c);m.on("error",function(b){g(b)}).on("end",function(){m.streamInfo.crc32!==p.decompressed.crc32?g(new Error("Corrupted zip : CRC32 mismatch")):d()}).resume()})}s.exports=function(p,d){var g=this;return d=r.extend(d||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),h.isNode&&h.isStream(p)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",p,!0,d.optimizedBinaryString,d.base64).then(function(m){var b=new l(d);return b.load(m),b}).then(function(m){var b=[o.Promise.resolve(m)],f=m.files;if(d.checkCRC32)for(var _=0;_<f.length;_++)b.push(u(f[_]));return o.Promise.all(b)}).then(function(m){for(var b=m.shift(),f=b.files,_=0;_<f.length;_++){var y=f[_],v=y.fileNameStr,w=r.resolve(y.fileNameStr);g.file(w,y.decompressed,{binary:!0,optimizedBinaryString:!0,date:y.date,dir:y.dir,comment:y.fileCommentStr.length?y.fileCommentStr:null,unixPermissions:y.unixPermissions,dosPermissions:y.dosPermissions,createFolders:d.createFolders}),y.dir||(g.file(w).unsafeOriginalName=v)}return b.zipComment.length&&(g.comment=b.zipComment),g})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,s,i){var r=e("../utils"),o=e("../stream/GenericWorker");function a(l,c){o.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(c)}r.inherits(a,o),a.prototype._bindStream=function(l){var c=this;(this._stream=l).pause(),l.on("data",function(h){c.push({data:h,meta:{percent:0}})}).on("error",function(h){c.isPaused?this.generatedError=h:c.error(h)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},s.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,s,i){var r=e("readable-stream").Readable;function o(a,l,c){r.call(this,l),this._helper=a;var h=this;a.on("data",function(u,p){h.push(u)||h._helper.pause(),c&&c(p)}).on("error",function(u){h.emit("error",u)}).on("end",function(){h.push(null)})}e("../utils").inherits(o,r),o.prototype._read=function(){this._helper.resume()},s.exports=o},{"../utils":32,"readable-stream":16}],14:[function(e,s,i){s.exports={isNode:typeof Buffer<"u",newBufferFrom:function(r,o){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(r,o);if(typeof r=="number")throw new Error('The "data" argument must not be a number');return new Buffer(r,o)},allocBuffer:function(r){if(Buffer.alloc)return Buffer.alloc(r);var o=new Buffer(r);return o.fill(0),o},isBuffer:function(r){return Buffer.isBuffer(r)},isStream:function(r){return r&&typeof r.on=="function"&&typeof r.pause=="function"&&typeof r.resume=="function"}}},{}],15:[function(e,s,i){function r(w,I,C){var A,S=a.getTypeOf(I),P=a.extend(C||{},h);P.date=P.date||new Date,P.compression!==null&&(P.compression=P.compression.toUpperCase()),typeof P.unixPermissions=="string"&&(P.unixPermissions=parseInt(P.unixPermissions,8)),P.unixPermissions&&16384&P.unixPermissions&&(P.dir=!0),P.dosPermissions&&16&P.dosPermissions&&(P.dir=!0),P.dir&&(w=f(w)),P.createFolders&&(A=b(w))&&_.call(this,A,!0);var M=S==="string"&&P.binary===!1&&P.base64===!1;C&&C.binary!==void 0||(P.binary=!M),(I instanceof u&&I.uncompressedSize===0||P.dir||!I||I.length===0)&&(P.base64=!1,P.binary=!0,I="",P.compression="STORE",S="string");var T=null;T=I instanceof u||I instanceof l?I:g.isNode&&g.isStream(I)?new m(w,I):a.prepareContent(w,I,P.binary,P.optimizedBinaryString,P.base64);var L=new p(w,T,P);this.files[w]=L}var o=e("./utf8"),a=e("./utils"),l=e("./stream/GenericWorker"),c=e("./stream/StreamHelper"),h=e("./defaults"),u=e("./compressedObject"),p=e("./zipObject"),d=e("./generate"),g=e("./nodejsUtils"),m=e("./nodejs/NodejsStreamInputAdapter"),b=function(w){w.slice(-1)==="/"&&(w=w.substring(0,w.length-1));var I=w.lastIndexOf("/");return 0<I?w.substring(0,I):""},f=function(w){return w.slice(-1)!=="/"&&(w+="/"),w},_=function(w,I){return I=I!==void 0?I:h.createFolders,w=f(w),this.files[w]||r.call(this,w,null,{dir:!0,createFolders:I}),this.files[w]};function y(w){return Object.prototype.toString.call(w)==="[object RegExp]"}var v={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(w){var I,C,A;for(I in this.files)A=this.files[I],(C=I.slice(this.root.length,I.length))&&I.slice(0,this.root.length)===this.root&&w(C,A)},filter:function(w){var I=[];return this.forEach(function(C,A){w(C,A)&&I.push(A)}),I},file:function(w,I,C){if(arguments.length!==1)return w=this.root+w,r.call(this,w,I,C),this;if(y(w)){var A=w;return this.filter(function(P,M){return!M.dir&&A.test(P)})}var S=this.files[this.root+w];return S&&!S.dir?S:null},folder:function(w){if(!w)return this;if(y(w))return this.filter(function(S,P){return P.dir&&w.test(S)});var I=this.root+w,C=_.call(this,I),A=this.clone();return A.root=C.name,A},remove:function(w){w=this.root+w;var I=this.files[w];if(I||(w.slice(-1)!=="/"&&(w+="/"),I=this.files[w]),I&&!I.dir)delete this.files[w];else for(var C=this.filter(function(S,P){return P.name.slice(0,w.length)===w}),A=0;A<C.length;A++)delete this.files[C[A].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(w){var I,C={};try{if((C=a.extend(w||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=C.type.toLowerCase(),C.compression=C.compression.toUpperCase(),C.type==="binarystring"&&(C.type="string"),!C.type)throw new Error("No output type specified.");a.checkSupport(C.type),C.platform!=="darwin"&&C.platform!=="freebsd"&&C.platform!=="linux"&&C.platform!=="sunos"||(C.platform="UNIX"),C.platform==="win32"&&(C.platform="DOS");var A=C.comment||this.comment||"";I=d.generateWorker(this,C,A)}catch(S){(I=new l("error")).error(S)}return new c(I,C.type||"string",C.mimeType)},generateAsync:function(w,I){return this.generateInternalStream(w).accumulate(I)},generateNodeStream:function(w,I){return(w=w||{}).type||(w.type="nodebuffer"),this.generateInternalStream(w).toNodejsStream(I)}};s.exports=v},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,s,i){s.exports=e("stream")},{stream:void 0}],17:[function(e,s,i){var r=e("./DataReader");function o(a){r.call(this,a);for(var l=0;l<this.data.length;l++)a[l]=255&a[l]}e("../utils").inherits(o,r),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var l=a.charCodeAt(0),c=a.charCodeAt(1),h=a.charCodeAt(2),u=a.charCodeAt(3),p=this.length-4;0<=p;--p)if(this.data[p]===l&&this.data[p+1]===c&&this.data[p+2]===h&&this.data[p+3]===u)return p-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var l=a.charCodeAt(0),c=a.charCodeAt(1),h=a.charCodeAt(2),u=a.charCodeAt(3),p=this.readData(4);return l===p[0]&&c===p[1]&&h===p[2]&&u===p[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},s.exports=o},{"../utils":32,"./DataReader":18}],18:[function(e,s,i){var r=e("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var l,c=0;for(this.checkOffset(a),l=this.index+a-1;l>=this.index;l--)c=(c<<8)+this.byteAt(l);return this.index+=a,c},readString:function(a){return r.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},s.exports=o},{"../utils":32}],19:[function(e,s,i){var r=e("./Uint8ArrayReader");function o(a){r.call(this,a)}e("../utils").inherits(o,r),o.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},s.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,s,i){var r=e("./DataReader");function o(a){r.call(this,a)}e("../utils").inherits(o,r),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},s.exports=o},{"../utils":32,"./DataReader":18}],21:[function(e,s,i){var r=e("./ArrayReader");function o(a){r.call(this,a)}e("../utils").inherits(o,r),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},s.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(e,s,i){var r=e("../utils"),o=e("../support"),a=e("./ArrayReader"),l=e("./StringReader"),c=e("./NodeBufferReader"),h=e("./Uint8ArrayReader");s.exports=function(u){var p=r.getTypeOf(u);return r.checkSupport(p),p!=="string"||o.uint8array?p==="nodebuffer"?new c(u):o.uint8array?new h(r.transformTo("uint8array",u)):new a(r.transformTo("array",u)):new l(u)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,s,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,s,i){var r=e("./GenericWorker"),o=e("../utils");function a(l){r.call(this,"ConvertWorker to "+l),this.destType=l}o.inherits(a,r),a.prototype.processChunk=function(l){this.push({data:o.transformTo(this.destType,l.data),meta:l.meta})},s.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(e,s,i){var r=e("./GenericWorker"),o=e("../crc32");function a(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(a,r),a.prototype.processChunk=function(l){this.streamInfo.crc32=o(l.data,this.streamInfo.crc32||0),this.push(l)},s.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,s,i){var r=e("../utils"),o=e("./GenericWorker");function a(l){o.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}r.inherits(a,o),a.prototype.processChunk=function(l){if(l){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+l.data.length}o.prototype.processChunk.call(this,l)},s.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(e,s,i){var r=e("../utils"),o=e("./GenericWorker");function a(l){o.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(h){c.dataIsReady=!0,c.data=h,c.max=h&&h.length||0,c.type=r.getTypeOf(h),c.isPaused||c._tickAndRepeat()},function(h){c.error(h)})}r.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,c);break;case"uint8array":l=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":l=this.data.slice(this.index,c)}return this.index=c,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},s.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(e,s,i){function r(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var l=0;l<this._listeners[o].length;l++)this._listeners[o][l].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(l){a.processChunk(l)}),o.on("end",function(){a.end()}),o.on("error",function(l){a.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},s.exports=r},{}],29:[function(e,s,i){var r=e("../utils"),o=e("./ConvertWorker"),a=e("./GenericWorker"),l=e("../base64"),c=e("../support"),h=e("../external"),u=null;if(c.nodestream)try{u=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function p(g,m){return new h.Promise(function(b,f){var _=[],y=g._internalType,v=g._outputType,w=g._mimeType;g.on("data",function(I,C){_.push(I),m&&m(C)}).on("error",function(I){_=[],f(I)}).on("end",function(){try{var I=(function(C,A,S){switch(C){case"blob":return r.newBlob(r.transformTo("arraybuffer",A),S);case"base64":return l.encode(A);default:return r.transformTo(C,A)}})(v,(function(C,A){var S,P=0,M=null,T=0;for(S=0;S<A.length;S++)T+=A[S].length;switch(C){case"string":return A.join("");case"array":return Array.prototype.concat.apply([],A);case"uint8array":for(M=new Uint8Array(T),S=0;S<A.length;S++)M.set(A[S],P),P+=A[S].length;return M;case"nodebuffer":return Buffer.concat(A);default:throw new Error("concat : unsupported type '"+C+"'")}})(y,_),w);b(I)}catch(C){f(C)}_=[]}).resume()})}function d(g,m,b){var f=m;switch(m){case"blob":case"arraybuffer":f="uint8array";break;case"base64":f="string"}try{this._internalType=f,this._outputType=m,this._mimeType=b,r.checkSupport(f),this._worker=g.pipe(new o(f)),g.lock()}catch(_){this._worker=new a("error"),this._worker.error(_)}}d.prototype={accumulate:function(g){return p(this,g)},on:function(g,m){var b=this;return g==="data"?this._worker.on(g,function(f){m.call(b,f.data,f.meta)}):this._worker.on(g,function(){r.delay(m,arguments,b)}),this},resume:function(){return r.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(g){if(r.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new u(this,{objectMode:this._outputType!=="nodebuffer"},g)}},s.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,s,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var r=new ArrayBuffer(0);try{i.blob=new Blob([r],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(r),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!e("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(e,s,i){for(var r=e("./utils"),o=e("./support"),a=e("./nodejsUtils"),l=e("./stream/GenericWorker"),c=new Array(256),h=0;h<256;h++)c[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;c[254]=c[254]=1;function u(){l.call(this,"utf-8 decode"),this.leftOver=null}function p(){l.call(this,"utf-8 encode")}i.utf8encode=function(d){return o.nodebuffer?a.newBufferFrom(d,"utf-8"):(function(g){var m,b,f,_,y,v=g.length,w=0;for(_=0;_<v;_++)(64512&(b=g.charCodeAt(_)))==55296&&_+1<v&&(64512&(f=g.charCodeAt(_+1)))==56320&&(b=65536+(b-55296<<10)+(f-56320),_++),w+=b<128?1:b<2048?2:b<65536?3:4;for(m=o.uint8array?new Uint8Array(w):new Array(w),_=y=0;y<w;_++)(64512&(b=g.charCodeAt(_)))==55296&&_+1<v&&(64512&(f=g.charCodeAt(_+1)))==56320&&(b=65536+(b-55296<<10)+(f-56320),_++),b<128?m[y++]=b:(b<2048?m[y++]=192|b>>>6:(b<65536?m[y++]=224|b>>>12:(m[y++]=240|b>>>18,m[y++]=128|b>>>12&63),m[y++]=128|b>>>6&63),m[y++]=128|63&b);return m})(d)},i.utf8decode=function(d){return o.nodebuffer?r.transformTo("nodebuffer",d).toString("utf-8"):(function(g){var m,b,f,_,y=g.length,v=new Array(2*y);for(m=b=0;m<y;)if((f=g[m++])<128)v[b++]=f;else if(4<(_=c[f]))v[b++]=65533,m+=_-1;else{for(f&=_===2?31:_===3?15:7;1<_&&m<y;)f=f<<6|63&g[m++],_--;1<_?v[b++]=65533:f<65536?v[b++]=f:(f-=65536,v[b++]=55296|f>>10&1023,v[b++]=56320|1023&f)}return v.length!==b&&(v.subarray?v=v.subarray(0,b):v.length=b),r.applyFromCharCode(v)})(d=r.transformTo(o.uint8array?"uint8array":"array",d))},r.inherits(u,l),u.prototype.processChunk=function(d){var g=r.transformTo(o.uint8array?"uint8array":"array",d.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=g;(g=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),g.set(m,this.leftOver.length)}else g=this.leftOver.concat(g);this.leftOver=null}var b=(function(_,y){var v;for((y=y||_.length)>_.length&&(y=_.length),v=y-1;0<=v&&(192&_[v])==128;)v--;return v<0||v===0?y:v+c[_[v]]>y?v:y})(g),f=g;b!==g.length&&(o.uint8array?(f=g.subarray(0,b),this.leftOver=g.subarray(b,g.length)):(f=g.slice(0,b),this.leftOver=g.slice(b,g.length))),this.push({data:i.utf8decode(f),meta:d.meta})},u.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=u,r.inherits(p,l),p.prototype.processChunk=function(d){this.push({data:i.utf8encode(d.data),meta:d.meta})},i.Utf8EncodeWorker=p},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,s,i){var r=e("./support"),o=e("./base64"),a=e("./nodejsUtils"),l=e("./external");function c(m){return m}function h(m,b){for(var f=0;f<m.length;++f)b[f]=255&m.charCodeAt(f);return b}e("setimmediate"),i.newBlob=function(m,b){i.checkSupport("blob");try{return new Blob([m],{type:b})}catch{try{var f=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return f.append(m),f.getBlob(b)}catch{throw new Error("Bug : can't construct the Blob.")}}};var u={stringifyByChunk:function(m,b,f){var _=[],y=0,v=m.length;if(v<=f)return String.fromCharCode.apply(null,m);for(;y<v;)b==="array"||b==="nodebuffer"?_.push(String.fromCharCode.apply(null,m.slice(y,Math.min(y+f,v)))):_.push(String.fromCharCode.apply(null,m.subarray(y,Math.min(y+f,v)))),y+=f;return _.join("")},stringifyByChar:function(m){for(var b="",f=0;f<m.length;f++)b+=String.fromCharCode(m[f]);return b},applyCanBeUsed:{uint8array:(function(){try{return r.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return r.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}})()}};function p(m){var b=65536,f=i.getTypeOf(m),_=!0;if(f==="uint8array"?_=u.applyCanBeUsed.uint8array:f==="nodebuffer"&&(_=u.applyCanBeUsed.nodebuffer),_)for(;1<b;)try{return u.stringifyByChunk(m,f,b)}catch{b=Math.floor(b/2)}return u.stringifyByChar(m)}function d(m,b){for(var f=0;f<m.length;f++)b[f]=m[f];return b}i.applyFromCharCode=p;var g={};g.string={string:c,array:function(m){return h(m,new Array(m.length))},arraybuffer:function(m){return g.string.uint8array(m).buffer},uint8array:function(m){return h(m,new Uint8Array(m.length))},nodebuffer:function(m){return h(m,a.allocBuffer(m.length))}},g.array={string:p,array:c,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},g.arraybuffer={string:function(m){return p(new Uint8Array(m))},array:function(m){return d(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:c,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},g.uint8array={string:p,array:function(m){return d(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:c,nodebuffer:function(m){return a.newBufferFrom(m)}},g.nodebuffer={string:p,array:function(m){return d(m,new Array(m.length))},arraybuffer:function(m){return g.nodebuffer.uint8array(m).buffer},uint8array:function(m){return d(m,new Uint8Array(m.length))},nodebuffer:c},i.transformTo=function(m,b){if(b=b||"",!m)return b;i.checkSupport(m);var f=i.getTypeOf(b);return g[f][m](b)},i.resolve=function(m){for(var b=m.split("/"),f=[],_=0;_<b.length;_++){var y=b[_];y==="."||y===""&&_!==0&&_!==b.length-1||(y===".."?f.pop():f.push(y))}return f.join("/")},i.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":r.nodebuffer&&a.isBuffer(m)?"nodebuffer":r.uint8array&&m instanceof Uint8Array?"uint8array":r.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(m){if(!r[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(m){var b,f,_="";for(f=0;f<(m||"").length;f++)_+="\\x"+((b=m.charCodeAt(f))<16?"0":"")+b.toString(16).toUpperCase();return _},i.delay=function(m,b,f){setImmediate(function(){m.apply(f||null,b||[])})},i.inherits=function(m,b){function f(){}f.prototype=b.prototype,m.prototype=new f},i.extend=function(){var m,b,f={};for(m=0;m<arguments.length;m++)for(b in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],b)&&f[b]===void 0&&(f[b]=arguments[m][b]);return f},i.prepareContent=function(m,b,f,_,y){return l.Promise.resolve(b).then(function(v){return r.blob&&(v instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(v))!==-1)&&typeof FileReader<"u"?new l.Promise(function(w,I){var C=new FileReader;C.onload=function(A){w(A.target.result)},C.onerror=function(A){I(A.target.error)},C.readAsArrayBuffer(v)}):v}).then(function(v){var w=i.getTypeOf(v);return w?(w==="arraybuffer"?v=i.transformTo("uint8array",v):w==="string"&&(y?v=o.decode(v):f&&_!==!0&&(v=(function(I){return h(I,r.uint8array?new Uint8Array(I.length):new Array(I.length))})(v))),v):l.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,s,i){var r=e("./reader/readerFor"),o=e("./utils"),a=e("./signature"),l=e("./zipEntry"),c=e("./support");function h(u){this.files=[],this.loadOptions=u}h.prototype={checkSignature:function(u){if(!this.reader.readAndCheckSignature(u)){this.reader.index-=4;var p=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(p)+", expected "+o.pretty(u)+")")}},isSignature:function(u,p){var d=this.reader.index;this.reader.setIndex(u);var g=this.reader.readString(4)===p;return this.reader.setIndex(d),g},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var u=this.reader.readData(this.zipCommentLength),p=c.uint8array?"uint8array":"array",d=o.transformTo(p,u);this.zipComment=this.loadOptions.decodeFileName(d)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var u,p,d,g=this.zip64EndOfCentralSize-44;0<g;)u=this.reader.readInt(2),p=this.reader.readInt(4),d=this.reader.readData(p),this.zip64ExtensibleData[u]={id:u,length:p,value:d}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var u,p;for(u=0;u<this.files.length;u++)p=this.files[u],this.reader.setIndex(p.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),p.readLocalPart(this.reader),p.handleUTF8(),p.processAttributes()},readCentralDir:function(){var u;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(u=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(u);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var u=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(u<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(u);var p=u;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(u=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(u),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var g=p-d;if(0<g)this.isSignature(p,a.CENTRAL_FILE_HEADER)||(this.reader.zero=g);else if(g<0)throw new Error("Corrupted zip: missing "+Math.abs(g)+" bytes.")},prepareReader:function(u){this.reader=r(u)},load:function(u){this.prepareReader(u),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},s.exports=h},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,s,i){var r=e("./reader/readerFor"),o=e("./utils"),a=e("./compressedObject"),l=e("./crc32"),c=e("./utf8"),h=e("./compressions"),u=e("./support");function p(d,g){this.options=d,this.loadOptions=g}p.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(d){var g,m;if(d.skip(22),this.fileNameLength=d.readInt(2),m=d.readInt(2),this.fileName=d.readData(this.fileNameLength),d.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((g=(function(b){for(var f in h)if(Object.prototype.hasOwnProperty.call(h,f)&&h[f].magic===b)return h[f];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,g,d.readData(this.compressedSize))},readCentralPart:function(d){this.versionMadeBy=d.readInt(2),d.skip(2),this.bitFlag=d.readInt(2),this.compressionMethod=d.readString(2),this.date=d.readDate(),this.crc32=d.readInt(4),this.compressedSize=d.readInt(4),this.uncompressedSize=d.readInt(4);var g=d.readInt(2);if(this.extraFieldsLength=d.readInt(2),this.fileCommentLength=d.readInt(2),this.diskNumberStart=d.readInt(2),this.internalFileAttributes=d.readInt(2),this.externalFileAttributes=d.readInt(4),this.localHeaderOffset=d.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");d.skip(g),this.readExtraFields(d),this.parseZIP64ExtraField(d),this.fileComment=d.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var d=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),d==0&&(this.dosPermissions=63&this.externalFileAttributes),d==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var d=r(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=d.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=d.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=d.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=d.readInt(4))}},readExtraFields:function(d){var g,m,b,f=d.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});d.index+4<f;)g=d.readInt(2),m=d.readInt(2),b=d.readData(m),this.extraFields[g]={id:g,length:m,value:b};d.setIndex(f)},handleUTF8:function(){var d=u.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var g=this.findExtraFieldUnicodePath();if(g!==null)this.fileNameStr=g;else{var m=o.transformTo(d,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var b=this.findExtraFieldUnicodeComment();if(b!==null)this.fileCommentStr=b;else{var f=o.transformTo(d,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(f)}}},findExtraFieldUnicodePath:function(){var d=this.extraFields[28789];if(d){var g=r(d.value);return g.readInt(1)!==1||l(this.fileName)!==g.readInt(4)?null:c.utf8decode(g.readData(d.length-5))}return null},findExtraFieldUnicodeComment:function(){var d=this.extraFields[25461];if(d){var g=r(d.value);return g.readInt(1)!==1||l(this.fileComment)!==g.readInt(4)?null:c.utf8decode(g.readData(d.length-5))}return null}},s.exports=p},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,s,i){function r(g,m,b){this.name=g,this.dir=b.dir,this.date=b.date,this.comment=b.comment,this.unixPermissions=b.unixPermissions,this.dosPermissions=b.dosPermissions,this._data=m,this._dataBinary=b.binary,this.options={compression:b.compression,compressionOptions:b.compressionOptions}}var o=e("./stream/StreamHelper"),a=e("./stream/DataWorker"),l=e("./utf8"),c=e("./compressedObject"),h=e("./stream/GenericWorker");r.prototype={internalStream:function(g){var m=null,b="string";try{if(!g)throw new Error("No output type specified.");var f=(b=g.toLowerCase())==="string"||b==="text";b!=="binarystring"&&b!=="text"||(b="string"),m=this._decompressWorker();var _=!this._dataBinary;_&&!f&&(m=m.pipe(new l.Utf8EncodeWorker)),!_&&f&&(m=m.pipe(new l.Utf8DecodeWorker))}catch(y){(m=new h("error")).error(y)}return new o(m,b,"")},async:function(g,m){return this.internalStream(g).accumulate(m)},nodeStream:function(g,m){return this.internalStream(g||"nodebuffer").toNodejsStream(m)},_compressWorker:function(g,m){if(this._data instanceof c&&this._data.compression.magic===g.magic)return this._data.getCompressedWorker();var b=this._decompressWorker();return this._dataBinary||(b=b.pipe(new l.Utf8EncodeWorker)),c.createWorkerFrom(b,g,m)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof h?this._data:new a(this._data)}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],p=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<u.length;d++)r.prototype[u[d]]=p;s.exports=r},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,s,i){(function(r){var o,a,l=r.MutationObserver||r.WebKitMutationObserver;if(l){var c=0,h=new l(g),u=r.document.createTextNode("");h.observe(u,{characterData:!0}),o=function(){u.data=c=++c%2}}else if(r.setImmediate||r.MessageChannel===void 0)o="document"in r&&"onreadystatechange"in r.document.createElement("script")?function(){var m=r.document.createElement("script");m.onreadystatechange=function(){g(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},r.document.documentElement.appendChild(m)}:function(){setTimeout(g,0)};else{var p=new r.MessageChannel;p.port1.onmessage=g,o=function(){p.port2.postMessage(0)}}var d=[];function g(){var m,b;a=!0;for(var f=d.length;f;){for(b=d,d=[],m=-1;++m<f;)b[m]();f=d.length}a=!1}s.exports=function(m){d.push(m)!==1||a||o()}}).call(this,typeof mf<"u"?mf:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,s,i){var r=e("immediate");function o(){}var a={},l=["REJECTED"],c=["FULFILLED"],h=["PENDING"];function u(f){if(typeof f!="function")throw new TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,f!==o&&m(this,f)}function p(f,_,y){this.promise=f,typeof _=="function"&&(this.onFulfilled=_,this.callFulfilled=this.otherCallFulfilled),typeof y=="function"&&(this.onRejected=y,this.callRejected=this.otherCallRejected)}function d(f,_,y){r(function(){var v;try{v=_(y)}catch(w){return a.reject(f,w)}v===f?a.reject(f,new TypeError("Cannot resolve promise with itself")):a.resolve(f,v)})}function g(f){var _=f&&f.then;if(f&&(typeof f=="object"||typeof f=="function")&&typeof _=="function")return function(){_.apply(f,arguments)}}function m(f,_){var y=!1;function v(C){y||(y=!0,a.reject(f,C))}function w(C){y||(y=!0,a.resolve(f,C))}var I=b(function(){_(w,v)});I.status==="error"&&v(I.value)}function b(f,_){var y={};try{y.value=f(_),y.status="success"}catch(v){y.status="error",y.value=v}return y}(s.exports=u).prototype.finally=function(f){if(typeof f!="function")return this;var _=this.constructor;return this.then(function(y){return _.resolve(f()).then(function(){return y})},function(y){return _.resolve(f()).then(function(){throw y})})},u.prototype.catch=function(f){return this.then(null,f)},u.prototype.then=function(f,_){if(typeof f!="function"&&this.state===c||typeof _!="function"&&this.state===l)return this;var y=new this.constructor(o);return this.state!==h?d(y,this.state===c?f:_,this.outcome):this.queue.push(new p(y,f,_)),y},p.prototype.callFulfilled=function(f){a.resolve(this.promise,f)},p.prototype.otherCallFulfilled=function(f){d(this.promise,this.onFulfilled,f)},p.prototype.callRejected=function(f){a.reject(this.promise,f)},p.prototype.otherCallRejected=function(f){d(this.promise,this.onRejected,f)},a.resolve=function(f,_){var y=b(g,_);if(y.status==="error")return a.reject(f,y.value);var v=y.value;if(v)m(f,v);else{f.state=c,f.outcome=_;for(var w=-1,I=f.queue.length;++w<I;)f.queue[w].callFulfilled(_)}return f},a.reject=function(f,_){f.state=l,f.outcome=_;for(var y=-1,v=f.queue.length;++y<v;)f.queue[y].callRejected(_);return f},u.resolve=function(f){return f instanceof this?f:a.resolve(new this(o),f)},u.reject=function(f){var _=new this(o);return a.reject(_,f)},u.all=function(f){var _=this;if(Object.prototype.toString.call(f)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=f.length,v=!1;if(!y)return this.resolve([]);for(var w=new Array(y),I=0,C=-1,A=new this(o);++C<y;)S(f[C],C);return A;function S(P,M){_.resolve(P).then(function(T){w[M]=T,++I!==y||v||(v=!0,a.resolve(A,w))},function(T){v||(v=!0,a.reject(A,T))})}},u.race=function(f){var _=this;if(Object.prototype.toString.call(f)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=f.length,v=!1;if(!y)return this.resolve([]);for(var w=-1,I=new this(o);++w<y;)C=f[w],_.resolve(C).then(function(A){v||(v=!0,a.resolve(I,A))},function(A){v||(v=!0,a.reject(I,A))});var C;return I}},{immediate:36}],38:[function(e,s,i){var r={};(0,e("./lib/utils/common").assign)(r,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),s.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,s,i){var r=e("./zlib/deflate"),o=e("./utils/common"),a=e("./utils/strings"),l=e("./zlib/messages"),c=e("./zlib/zstream"),h=Object.prototype.toString,u=0,p=-1,d=0,g=8;function m(f){if(!(this instanceof m))return new m(f);this.options=o.assign({level:p,method:g,chunkSize:16384,windowBits:15,memLevel:8,strategy:d,to:""},f||{});var _=this.options;_.raw&&0<_.windowBits?_.windowBits=-_.windowBits:_.gzip&&0<_.windowBits&&_.windowBits<16&&(_.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var y=r.deflateInit2(this.strm,_.level,_.method,_.windowBits,_.memLevel,_.strategy);if(y!==u)throw new Error(l[y]);if(_.header&&r.deflateSetHeader(this.strm,_.header),_.dictionary){var v;if(v=typeof _.dictionary=="string"?a.string2buf(_.dictionary):h.call(_.dictionary)==="[object ArrayBuffer]"?new Uint8Array(_.dictionary):_.dictionary,(y=r.deflateSetDictionary(this.strm,v))!==u)throw new Error(l[y]);this._dict_set=!0}}function b(f,_){var y=new m(_);if(y.push(f,!0),y.err)throw y.msg||l[y.err];return y.result}m.prototype.push=function(f,_){var y,v,w=this.strm,I=this.options.chunkSize;if(this.ended)return!1;v=_===~~_?_:_===!0?4:0,typeof f=="string"?w.input=a.string2buf(f):h.call(f)==="[object ArrayBuffer]"?w.input=new Uint8Array(f):w.input=f,w.next_in=0,w.avail_in=w.input.length;do{if(w.avail_out===0&&(w.output=new o.Buf8(I),w.next_out=0,w.avail_out=I),(y=r.deflate(w,v))!==1&&y!==u)return this.onEnd(y),!(this.ended=!0);w.avail_out!==0&&(w.avail_in!==0||v!==4&&v!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(w.output,w.next_out))):this.onData(o.shrinkBuf(w.output,w.next_out)))}while((0<w.avail_in||w.avail_out===0)&&y!==1);return v===4?(y=r.deflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===u):v!==2||(this.onEnd(u),!(w.avail_out=0))},m.prototype.onData=function(f){this.chunks.push(f)},m.prototype.onEnd=function(f){f===u&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=f,this.msg=this.strm.msg},i.Deflate=m,i.deflate=b,i.deflateRaw=function(f,_){return(_=_||{}).raw=!0,b(f,_)},i.gzip=function(f,_){return(_=_||{}).gzip=!0,b(f,_)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,s,i){var r=e("./zlib/inflate"),o=e("./utils/common"),a=e("./utils/strings"),l=e("./zlib/constants"),c=e("./zlib/messages"),h=e("./zlib/zstream"),u=e("./zlib/gzheader"),p=Object.prototype.toString;function d(m){if(!(this instanceof d))return new d(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var b=this.options;b.raw&&0<=b.windowBits&&b.windowBits<16&&(b.windowBits=-b.windowBits,b.windowBits===0&&(b.windowBits=-15)),!(0<=b.windowBits&&b.windowBits<16)||m&&m.windowBits||(b.windowBits+=32),15<b.windowBits&&b.windowBits<48&&!(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var f=r.inflateInit2(this.strm,b.windowBits);if(f!==l.Z_OK)throw new Error(c[f]);this.header=new u,r.inflateGetHeader(this.strm,this.header)}function g(m,b){var f=new d(b);if(f.push(m,!0),f.err)throw f.msg||c[f.err];return f.result}d.prototype.push=function(m,b){var f,_,y,v,w,I,C=this.strm,A=this.options.chunkSize,S=this.options.dictionary,P=!1;if(this.ended)return!1;_=b===~~b?b:b===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof m=="string"?C.input=a.binstring2buf(m):p.call(m)==="[object ArrayBuffer]"?C.input=new Uint8Array(m):C.input=m,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new o.Buf8(A),C.next_out=0,C.avail_out=A),(f=r.inflate(C,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&S&&(I=typeof S=="string"?a.string2buf(S):p.call(S)==="[object ArrayBuffer]"?new Uint8Array(S):S,f=r.inflateSetDictionary(this.strm,I)),f===l.Z_BUF_ERROR&&P===!0&&(f=l.Z_OK,P=!1),f!==l.Z_STREAM_END&&f!==l.Z_OK)return this.onEnd(f),!(this.ended=!0);C.next_out&&(C.avail_out!==0&&f!==l.Z_STREAM_END&&(C.avail_in!==0||_!==l.Z_FINISH&&_!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(y=a.utf8border(C.output,C.next_out),v=C.next_out-y,w=a.buf2string(C.output,y),C.next_out=v,C.avail_out=A-v,v&&o.arraySet(C.output,C.output,y,v,0),this.onData(w)):this.onData(o.shrinkBuf(C.output,C.next_out)))),C.avail_in===0&&C.avail_out===0&&(P=!0)}while((0<C.avail_in||C.avail_out===0)&&f!==l.Z_STREAM_END);return f===l.Z_STREAM_END&&(_=l.Z_FINISH),_===l.Z_FINISH?(f=r.inflateEnd(this.strm),this.onEnd(f),this.ended=!0,f===l.Z_OK):_!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(C.avail_out=0))},d.prototype.onData=function(m){this.chunks.push(m)},d.prototype.onEnd=function(m){m===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},i.Inflate=d,i.inflate=g,i.inflateRaw=function(m,b){return(b=b||{}).raw=!0,g(m,b)},i.ungzip=g},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,s,i){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(l){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var h=c.shift();if(h){if(typeof h!="object")throw new TypeError(h+"must be non-object");for(var u in h)h.hasOwnProperty(u)&&(l[u]=h[u])}}return l},i.shrinkBuf=function(l,c){return l.length===c?l:l.subarray?l.subarray(0,c):(l.length=c,l)};var o={arraySet:function(l,c,h,u,p){if(c.subarray&&l.subarray)l.set(c.subarray(h,h+u),p);else for(var d=0;d<u;d++)l[p+d]=c[h+d]},flattenChunks:function(l){var c,h,u,p,d,g;for(c=u=0,h=l.length;c<h;c++)u+=l[c].length;for(g=new Uint8Array(u),c=p=0,h=l.length;c<h;c++)d=l[c],g.set(d,p),p+=d.length;return g}},a={arraySet:function(l,c,h,u,p){for(var d=0;d<u;d++)l[p+d]=c[h+d]},flattenChunks:function(l){return[].concat.apply([],l)}};i.setTyped=function(l){l?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(r)},{}],42:[function(e,s,i){var r=e("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var l=new r.Buf8(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function h(u,p){if(p<65537&&(u.subarray&&a||!u.subarray&&o))return String.fromCharCode.apply(null,r.shrinkBuf(u,p));for(var d="",g=0;g<p;g++)d+=String.fromCharCode(u[g]);return d}l[254]=l[254]=1,i.string2buf=function(u){var p,d,g,m,b,f=u.length,_=0;for(m=0;m<f;m++)(64512&(d=u.charCodeAt(m)))==55296&&m+1<f&&(64512&(g=u.charCodeAt(m+1)))==56320&&(d=65536+(d-55296<<10)+(g-56320),m++),_+=d<128?1:d<2048?2:d<65536?3:4;for(p=new r.Buf8(_),m=b=0;b<_;m++)(64512&(d=u.charCodeAt(m)))==55296&&m+1<f&&(64512&(g=u.charCodeAt(m+1)))==56320&&(d=65536+(d-55296<<10)+(g-56320),m++),d<128?p[b++]=d:(d<2048?p[b++]=192|d>>>6:(d<65536?p[b++]=224|d>>>12:(p[b++]=240|d>>>18,p[b++]=128|d>>>12&63),p[b++]=128|d>>>6&63),p[b++]=128|63&d);return p},i.buf2binstring=function(u){return h(u,u.length)},i.binstring2buf=function(u){for(var p=new r.Buf8(u.length),d=0,g=p.length;d<g;d++)p[d]=u.charCodeAt(d);return p},i.buf2string=function(u,p){var d,g,m,b,f=p||u.length,_=new Array(2*f);for(d=g=0;d<f;)if((m=u[d++])<128)_[g++]=m;else if(4<(b=l[m]))_[g++]=65533,d+=b-1;else{for(m&=b===2?31:b===3?15:7;1<b&&d<f;)m=m<<6|63&u[d++],b--;1<b?_[g++]=65533:m<65536?_[g++]=m:(m-=65536,_[g++]=55296|m>>10&1023,_[g++]=56320|1023&m)}return h(_,g)},i.utf8border=function(u,p){var d;for((p=p||u.length)>u.length&&(p=u.length),d=p-1;0<=d&&(192&u[d])==128;)d--;return d<0||d===0?p:d+l[u[d]]>p?d:p}},{"./common":41}],43:[function(e,s,i){s.exports=function(r,o,a,l){for(var c=65535&r|0,h=r>>>16&65535|0,u=0;a!==0;){for(a-=u=2e3<a?2e3:a;h=h+(c=c+o[l++]|0)|0,--u;);c%=65521,h%=65521}return c|h<<16|0}},{}],44:[function(e,s,i){s.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,s,i){var r=(function(){for(var o,a=[],l=0;l<256;l++){o=l;for(var c=0;c<8;c++)o=1&o?3988292384^o>>>1:o>>>1;a[l]=o}return a})();s.exports=function(o,a,l,c){var h=r,u=c+l;o^=-1;for(var p=c;p<u;p++)o=o>>>8^h[255&(o^a[p])];return-1^o}},{}],46:[function(e,s,i){var r,o=e("../utils/common"),a=e("./trees"),l=e("./adler32"),c=e("./crc32"),h=e("./messages"),u=0,p=4,d=0,g=-2,m=-1,b=4,f=2,_=8,y=9,v=286,w=30,I=19,C=2*v+1,A=15,S=3,P=258,M=P+S+1,T=42,L=113,E=1,N=2,W=3,V=4;function et(x,Z){return x.msg=h[Z],Z}function j(x){return(x<<1)-(4<x?9:0)}function nt(x){for(var Z=x.length;0<=--Z;)x[Z]=0}function H(x){var Z=x.state,Y=Z.pending;Y>x.avail_out&&(Y=x.avail_out),Y!==0&&(o.arraySet(x.output,Z.pending_buf,Z.pending_out,Y,x.next_out),x.next_out+=Y,Z.pending_out+=Y,x.total_out+=Y,x.avail_out-=Y,Z.pending-=Y,Z.pending===0&&(Z.pending_out=0))}function B(x,Z){a._tr_flush_block(x,0<=x.block_start?x.block_start:-1,x.strstart-x.block_start,Z),x.block_start=x.strstart,H(x.strm)}function rt(x,Z){x.pending_buf[x.pending++]=Z}function Q(x,Z){x.pending_buf[x.pending++]=Z>>>8&255,x.pending_buf[x.pending++]=255&Z}function st(x,Z){var Y,$,R=x.max_chain_length,U=x.strstart,tt=x.prev_length,K=x.nice_match,D=x.strstart>x.w_size-M?x.strstart-(x.w_size-M):0,J=x.window,it=x.w_mask,X=x.prev,lt=x.strstart+P,vt=J[U+tt-1],gt=J[U+tt];x.prev_length>=x.good_match&&(R>>=2),K>x.lookahead&&(K=x.lookahead);do if(J[(Y=Z)+tt]===gt&&J[Y+tt-1]===vt&&J[Y]===J[U]&&J[++Y]===J[U+1]){U+=2,Y++;do;while(J[++U]===J[++Y]&&J[++U]===J[++Y]&&J[++U]===J[++Y]&&J[++U]===J[++Y]&&J[++U]===J[++Y]&&J[++U]===J[++Y]&&J[++U]===J[++Y]&&J[++U]===J[++Y]&&U<lt);if($=P-(lt-U),U=lt-P,tt<$){if(x.match_start=Z,K<=(tt=$))break;vt=J[U+tt-1],gt=J[U+tt]}}while((Z=X[Z&it])>D&&--R!=0);return tt<=x.lookahead?tt:x.lookahead}function ct(x){var Z,Y,$,R,U,tt,K,D,J,it,X=x.w_size;do{if(R=x.window_size-x.lookahead-x.strstart,x.strstart>=X+(X-M)){for(o.arraySet(x.window,x.window,X,X,0),x.match_start-=X,x.strstart-=X,x.block_start-=X,Z=Y=x.hash_size;$=x.head[--Z],x.head[Z]=X<=$?$-X:0,--Y;);for(Z=Y=X;$=x.prev[--Z],x.prev[Z]=X<=$?$-X:0,--Y;);R+=X}if(x.strm.avail_in===0)break;if(tt=x.strm,K=x.window,D=x.strstart+x.lookahead,J=R,it=void 0,it=tt.avail_in,J<it&&(it=J),Y=it===0?0:(tt.avail_in-=it,o.arraySet(K,tt.input,tt.next_in,it,D),tt.state.wrap===1?tt.adler=l(tt.adler,K,it,D):tt.state.wrap===2&&(tt.adler=c(tt.adler,K,it,D)),tt.next_in+=it,tt.total_in+=it,it),x.lookahead+=Y,x.lookahead+x.insert>=S)for(U=x.strstart-x.insert,x.ins_h=x.window[U],x.ins_h=(x.ins_h<<x.hash_shift^x.window[U+1])&x.hash_mask;x.insert&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[U+S-1])&x.hash_mask,x.prev[U&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=U,U++,x.insert--,!(x.lookahead+x.insert<S)););}while(x.lookahead<M&&x.strm.avail_in!==0)}function _t(x,Z){for(var Y,$;;){if(x.lookahead<M){if(ct(x),x.lookahead<M&&Z===u)return E;if(x.lookahead===0)break}if(Y=0,x.lookahead>=S&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+S-1])&x.hash_mask,Y=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),Y!==0&&x.strstart-Y<=x.w_size-M&&(x.match_length=st(x,Y)),x.match_length>=S)if($=a._tr_tally(x,x.strstart-x.match_start,x.match_length-S),x.lookahead-=x.match_length,x.match_length<=x.max_lazy_match&&x.lookahead>=S){for(x.match_length--;x.strstart++,x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+S-1])&x.hash_mask,Y=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart,--x.match_length!=0;);x.strstart++}else x.strstart+=x.match_length,x.match_length=0,x.ins_h=x.window[x.strstart],x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+1])&x.hash_mask;else $=a._tr_tally(x,0,x.window[x.strstart]),x.lookahead--,x.strstart++;if($&&(B(x,!1),x.strm.avail_out===0))return E}return x.insert=x.strstart<S-1?x.strstart:S-1,Z===p?(B(x,!0),x.strm.avail_out===0?W:V):x.last_lit&&(B(x,!1),x.strm.avail_out===0)?E:N}function ut(x,Z){for(var Y,$,R;;){if(x.lookahead<M){if(ct(x),x.lookahead<M&&Z===u)return E;if(x.lookahead===0)break}if(Y=0,x.lookahead>=S&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+S-1])&x.hash_mask,Y=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),x.prev_length=x.match_length,x.prev_match=x.match_start,x.match_length=S-1,Y!==0&&x.prev_length<x.max_lazy_match&&x.strstart-Y<=x.w_size-M&&(x.match_length=st(x,Y),x.match_length<=5&&(x.strategy===1||x.match_length===S&&4096<x.strstart-x.match_start)&&(x.match_length=S-1)),x.prev_length>=S&&x.match_length<=x.prev_length){for(R=x.strstart+x.lookahead-S,$=a._tr_tally(x,x.strstart-1-x.prev_match,x.prev_length-S),x.lookahead-=x.prev_length-1,x.prev_length-=2;++x.strstart<=R&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+S-1])&x.hash_mask,Y=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),--x.prev_length!=0;);if(x.match_available=0,x.match_length=S-1,x.strstart++,$&&(B(x,!1),x.strm.avail_out===0))return E}else if(x.match_available){if(($=a._tr_tally(x,0,x.window[x.strstart-1]))&&B(x,!1),x.strstart++,x.lookahead--,x.strm.avail_out===0)return E}else x.match_available=1,x.strstart++,x.lookahead--}return x.match_available&&($=a._tr_tally(x,0,x.window[x.strstart-1]),x.match_available=0),x.insert=x.strstart<S-1?x.strstart:S-1,Z===p?(B(x,!0),x.strm.avail_out===0?W:V):x.last_lit&&(B(x,!1),x.strm.avail_out===0)?E:N}function pt(x,Z,Y,$,R){this.good_length=x,this.max_lazy=Z,this.nice_length=Y,this.max_chain=$,this.func=R}function bt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=_,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*C),this.dyn_dtree=new o.Buf16(2*(2*w+1)),this.bl_tree=new o.Buf16(2*(2*I+1)),nt(this.dyn_ltree),nt(this.dyn_dtree),nt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(A+1),this.heap=new o.Buf16(2*v+1),nt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*v+1),nt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function wt(x){var Z;return x&&x.state?(x.total_in=x.total_out=0,x.data_type=f,(Z=x.state).pending=0,Z.pending_out=0,Z.wrap<0&&(Z.wrap=-Z.wrap),Z.status=Z.wrap?T:L,x.adler=Z.wrap===2?0:1,Z.last_flush=u,a._tr_init(Z),d):et(x,g)}function St(x){var Z=wt(x);return Z===d&&(function(Y){Y.window_size=2*Y.w_size,nt(Y.head),Y.max_lazy_match=r[Y.level].max_lazy,Y.good_match=r[Y.level].good_length,Y.nice_match=r[Y.level].nice_length,Y.max_chain_length=r[Y.level].max_chain,Y.strstart=0,Y.block_start=0,Y.lookahead=0,Y.insert=0,Y.match_length=Y.prev_length=S-1,Y.match_available=0,Y.ins_h=0})(x.state),Z}function Rt(x,Z,Y,$,R,U){if(!x)return g;var tt=1;if(Z===m&&(Z=6),$<0?(tt=0,$=-$):15<$&&(tt=2,$-=16),R<1||y<R||Y!==_||$<8||15<$||Z<0||9<Z||U<0||b<U)return et(x,g);$===8&&($=9);var K=new bt;return(x.state=K).strm=x,K.wrap=tt,K.gzhead=null,K.w_bits=$,K.w_size=1<<K.w_bits,K.w_mask=K.w_size-1,K.hash_bits=R+7,K.hash_size=1<<K.hash_bits,K.hash_mask=K.hash_size-1,K.hash_shift=~~((K.hash_bits+S-1)/S),K.window=new o.Buf8(2*K.w_size),K.head=new o.Buf16(K.hash_size),K.prev=new o.Buf16(K.w_size),K.lit_bufsize=1<<R+6,K.pending_buf_size=4*K.lit_bufsize,K.pending_buf=new o.Buf8(K.pending_buf_size),K.d_buf=1*K.lit_bufsize,K.l_buf=3*K.lit_bufsize,K.level=Z,K.strategy=U,K.method=Y,St(x)}r=[new pt(0,0,0,0,function(x,Z){var Y=65535;for(Y>x.pending_buf_size-5&&(Y=x.pending_buf_size-5);;){if(x.lookahead<=1){if(ct(x),x.lookahead===0&&Z===u)return E;if(x.lookahead===0)break}x.strstart+=x.lookahead,x.lookahead=0;var $=x.block_start+Y;if((x.strstart===0||x.strstart>=$)&&(x.lookahead=x.strstart-$,x.strstart=$,B(x,!1),x.strm.avail_out===0)||x.strstart-x.block_start>=x.w_size-M&&(B(x,!1),x.strm.avail_out===0))return E}return x.insert=0,Z===p?(B(x,!0),x.strm.avail_out===0?W:V):(x.strstart>x.block_start&&(B(x,!1),x.strm.avail_out),E)}),new pt(4,4,8,4,_t),new pt(4,5,16,8,_t),new pt(4,6,32,32,_t),new pt(4,4,16,16,ut),new pt(8,16,32,32,ut),new pt(8,16,128,128,ut),new pt(8,32,128,256,ut),new pt(32,128,258,1024,ut),new pt(32,258,258,4096,ut)],i.deflateInit=function(x,Z){return Rt(x,Z,_,15,8,0)},i.deflateInit2=Rt,i.deflateReset=St,i.deflateResetKeep=wt,i.deflateSetHeader=function(x,Z){return x&&x.state?x.state.wrap!==2?g:(x.state.gzhead=Z,d):g},i.deflate=function(x,Z){var Y,$,R,U;if(!x||!x.state||5<Z||Z<0)return x?et(x,g):g;if($=x.state,!x.output||!x.input&&x.avail_in!==0||$.status===666&&Z!==p)return et(x,x.avail_out===0?-5:g);if($.strm=x,Y=$.last_flush,$.last_flush=Z,$.status===T)if($.wrap===2)x.adler=0,rt($,31),rt($,139),rt($,8),$.gzhead?(rt($,($.gzhead.text?1:0)+($.gzhead.hcrc?2:0)+($.gzhead.extra?4:0)+($.gzhead.name?8:0)+($.gzhead.comment?16:0)),rt($,255&$.gzhead.time),rt($,$.gzhead.time>>8&255),rt($,$.gzhead.time>>16&255),rt($,$.gzhead.time>>24&255),rt($,$.level===9?2:2<=$.strategy||$.level<2?4:0),rt($,255&$.gzhead.os),$.gzhead.extra&&$.gzhead.extra.length&&(rt($,255&$.gzhead.extra.length),rt($,$.gzhead.extra.length>>8&255)),$.gzhead.hcrc&&(x.adler=c(x.adler,$.pending_buf,$.pending,0)),$.gzindex=0,$.status=69):(rt($,0),rt($,0),rt($,0),rt($,0),rt($,0),rt($,$.level===9?2:2<=$.strategy||$.level<2?4:0),rt($,3),$.status=L);else{var tt=_+($.w_bits-8<<4)<<8;tt|=(2<=$.strategy||$.level<2?0:$.level<6?1:$.level===6?2:3)<<6,$.strstart!==0&&(tt|=32),tt+=31-tt%31,$.status=L,Q($,tt),$.strstart!==0&&(Q($,x.adler>>>16),Q($,65535&x.adler)),x.adler=1}if($.status===69)if($.gzhead.extra){for(R=$.pending;$.gzindex<(65535&$.gzhead.extra.length)&&($.pending!==$.pending_buf_size||($.gzhead.hcrc&&$.pending>R&&(x.adler=c(x.adler,$.pending_buf,$.pending-R,R)),H(x),R=$.pending,$.pending!==$.pending_buf_size));)rt($,255&$.gzhead.extra[$.gzindex]),$.gzindex++;$.gzhead.hcrc&&$.pending>R&&(x.adler=c(x.adler,$.pending_buf,$.pending-R,R)),$.gzindex===$.gzhead.extra.length&&($.gzindex=0,$.status=73)}else $.status=73;if($.status===73)if($.gzhead.name){R=$.pending;do{if($.pending===$.pending_buf_size&&($.gzhead.hcrc&&$.pending>R&&(x.adler=c(x.adler,$.pending_buf,$.pending-R,R)),H(x),R=$.pending,$.pending===$.pending_buf_size)){U=1;break}U=$.gzindex<$.gzhead.name.length?255&$.gzhead.name.charCodeAt($.gzindex++):0,rt($,U)}while(U!==0);$.gzhead.hcrc&&$.pending>R&&(x.adler=c(x.adler,$.pending_buf,$.pending-R,R)),U===0&&($.gzindex=0,$.status=91)}else $.status=91;if($.status===91)if($.gzhead.comment){R=$.pending;do{if($.pending===$.pending_buf_size&&($.gzhead.hcrc&&$.pending>R&&(x.adler=c(x.adler,$.pending_buf,$.pending-R,R)),H(x),R=$.pending,$.pending===$.pending_buf_size)){U=1;break}U=$.gzindex<$.gzhead.comment.length?255&$.gzhead.comment.charCodeAt($.gzindex++):0,rt($,U)}while(U!==0);$.gzhead.hcrc&&$.pending>R&&(x.adler=c(x.adler,$.pending_buf,$.pending-R,R)),U===0&&($.status=103)}else $.status=103;if($.status===103&&($.gzhead.hcrc?($.pending+2>$.pending_buf_size&&H(x),$.pending+2<=$.pending_buf_size&&(rt($,255&x.adler),rt($,x.adler>>8&255),x.adler=0,$.status=L)):$.status=L),$.pending!==0){if(H(x),x.avail_out===0)return $.last_flush=-1,d}else if(x.avail_in===0&&j(Z)<=j(Y)&&Z!==p)return et(x,-5);if($.status===666&&x.avail_in!==0)return et(x,-5);if(x.avail_in!==0||$.lookahead!==0||Z!==u&&$.status!==666){var K=$.strategy===2?(function(D,J){for(var it;;){if(D.lookahead===0&&(ct(D),D.lookahead===0)){if(J===u)return E;break}if(D.match_length=0,it=a._tr_tally(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++,it&&(B(D,!1),D.strm.avail_out===0))return E}return D.insert=0,J===p?(B(D,!0),D.strm.avail_out===0?W:V):D.last_lit&&(B(D,!1),D.strm.avail_out===0)?E:N})($,Z):$.strategy===3?(function(D,J){for(var it,X,lt,vt,gt=D.window;;){if(D.lookahead<=P){if(ct(D),D.lookahead<=P&&J===u)return E;if(D.lookahead===0)break}if(D.match_length=0,D.lookahead>=S&&0<D.strstart&&(X=gt[lt=D.strstart-1])===gt[++lt]&&X===gt[++lt]&&X===gt[++lt]){vt=D.strstart+P;do;while(X===gt[++lt]&&X===gt[++lt]&&X===gt[++lt]&&X===gt[++lt]&&X===gt[++lt]&&X===gt[++lt]&&X===gt[++lt]&&X===gt[++lt]&&lt<vt);D.match_length=P-(vt-lt),D.match_length>D.lookahead&&(D.match_length=D.lookahead)}if(D.match_length>=S?(it=a._tr_tally(D,1,D.match_length-S),D.lookahead-=D.match_length,D.strstart+=D.match_length,D.match_length=0):(it=a._tr_tally(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++),it&&(B(D,!1),D.strm.avail_out===0))return E}return D.insert=0,J===p?(B(D,!0),D.strm.avail_out===0?W:V):D.last_lit&&(B(D,!1),D.strm.avail_out===0)?E:N})($,Z):r[$.level].func($,Z);if(K!==W&&K!==V||($.status=666),K===E||K===W)return x.avail_out===0&&($.last_flush=-1),d;if(K===N&&(Z===1?a._tr_align($):Z!==5&&(a._tr_stored_block($,0,0,!1),Z===3&&(nt($.head),$.lookahead===0&&($.strstart=0,$.block_start=0,$.insert=0))),H(x),x.avail_out===0))return $.last_flush=-1,d}return Z!==p?d:$.wrap<=0?1:($.wrap===2?(rt($,255&x.adler),rt($,x.adler>>8&255),rt($,x.adler>>16&255),rt($,x.adler>>24&255),rt($,255&x.total_in),rt($,x.total_in>>8&255),rt($,x.total_in>>16&255),rt($,x.total_in>>24&255)):(Q($,x.adler>>>16),Q($,65535&x.adler)),H(x),0<$.wrap&&($.wrap=-$.wrap),$.pending!==0?d:1)},i.deflateEnd=function(x){var Z;return x&&x.state?(Z=x.state.status)!==T&&Z!==69&&Z!==73&&Z!==91&&Z!==103&&Z!==L&&Z!==666?et(x,g):(x.state=null,Z===L?et(x,-3):d):g},i.deflateSetDictionary=function(x,Z){var Y,$,R,U,tt,K,D,J,it=Z.length;if(!x||!x.state||(U=(Y=x.state).wrap)===2||U===1&&Y.status!==T||Y.lookahead)return g;for(U===1&&(x.adler=l(x.adler,Z,it,0)),Y.wrap=0,it>=Y.w_size&&(U===0&&(nt(Y.head),Y.strstart=0,Y.block_start=0,Y.insert=0),J=new o.Buf8(Y.w_size),o.arraySet(J,Z,it-Y.w_size,Y.w_size,0),Z=J,it=Y.w_size),tt=x.avail_in,K=x.next_in,D=x.input,x.avail_in=it,x.next_in=0,x.input=Z,ct(Y);Y.lookahead>=S;){for($=Y.strstart,R=Y.lookahead-(S-1);Y.ins_h=(Y.ins_h<<Y.hash_shift^Y.window[$+S-1])&Y.hash_mask,Y.prev[$&Y.w_mask]=Y.head[Y.ins_h],Y.head[Y.ins_h]=$,$++,--R;);Y.strstart=$,Y.lookahead=S-1,ct(Y)}return Y.strstart+=Y.lookahead,Y.block_start=Y.strstart,Y.insert=Y.lookahead,Y.lookahead=0,Y.match_length=Y.prev_length=S-1,Y.match_available=0,x.next_in=K,x.input=D,x.avail_in=tt,Y.wrap=U,d},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,s,i){s.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,s,i){s.exports=function(r,o){var a,l,c,h,u,p,d,g,m,b,f,_,y,v,w,I,C,A,S,P,M,T,L,E,N;a=r.state,l=r.next_in,E=r.input,c=l+(r.avail_in-5),h=r.next_out,N=r.output,u=h-(o-r.avail_out),p=h+(r.avail_out-257),d=a.dmax,g=a.wsize,m=a.whave,b=a.wnext,f=a.window,_=a.hold,y=a.bits,v=a.lencode,w=a.distcode,I=(1<<a.lenbits)-1,C=(1<<a.distbits)-1;t:do{y<15&&(_+=E[l++]<<y,y+=8,_+=E[l++]<<y,y+=8),A=v[_&I];e:for(;;){if(_>>>=S=A>>>24,y-=S,(S=A>>>16&255)===0)N[h++]=65535&A;else{if(!(16&S)){if(!(64&S)){A=v[(65535&A)+(_&(1<<S)-1)];continue e}if(32&S){a.mode=12;break t}r.msg="invalid literal/length code",a.mode=30;break t}P=65535&A,(S&=15)&&(y<S&&(_+=E[l++]<<y,y+=8),P+=_&(1<<S)-1,_>>>=S,y-=S),y<15&&(_+=E[l++]<<y,y+=8,_+=E[l++]<<y,y+=8),A=w[_&C];s:for(;;){if(_>>>=S=A>>>24,y-=S,!(16&(S=A>>>16&255))){if(!(64&S)){A=w[(65535&A)+(_&(1<<S)-1)];continue s}r.msg="invalid distance code",a.mode=30;break t}if(M=65535&A,y<(S&=15)&&(_+=E[l++]<<y,(y+=8)<S&&(_+=E[l++]<<y,y+=8)),d<(M+=_&(1<<S)-1)){r.msg="invalid distance too far back",a.mode=30;break t}if(_>>>=S,y-=S,(S=h-u)<M){if(m<(S=M-S)&&a.sane){r.msg="invalid distance too far back",a.mode=30;break t}if(L=f,(T=0)===b){if(T+=g-S,S<P){for(P-=S;N[h++]=f[T++],--S;);T=h-M,L=N}}else if(b<S){if(T+=g+b-S,(S-=b)<P){for(P-=S;N[h++]=f[T++],--S;);if(T=0,b<P){for(P-=S=b;N[h++]=f[T++],--S;);T=h-M,L=N}}}else if(T+=b-S,S<P){for(P-=S;N[h++]=f[T++],--S;);T=h-M,L=N}for(;2<P;)N[h++]=L[T++],N[h++]=L[T++],N[h++]=L[T++],P-=3;P&&(N[h++]=L[T++],1<P&&(N[h++]=L[T++]))}else{for(T=h-M;N[h++]=N[T++],N[h++]=N[T++],N[h++]=N[T++],2<(P-=3););P&&(N[h++]=N[T++],1<P&&(N[h++]=N[T++]))}break}}break}}while(l<c&&h<p);l-=P=y>>3,_&=(1<<(y-=P<<3))-1,r.next_in=l,r.next_out=h,r.avail_in=l<c?c-l+5:5-(l-c),r.avail_out=h<p?p-h+257:257-(h-p),a.hold=_,a.bits=y}},{}],49:[function(e,s,i){var r=e("../utils/common"),o=e("./adler32"),a=e("./crc32"),l=e("./inffast"),c=e("./inftrees"),h=1,u=2,p=0,d=-2,g=1,m=852,b=592;function f(T){return(T>>>24&255)+(T>>>8&65280)+((65280&T)<<8)+((255&T)<<24)}function _(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function y(T){var L;return T&&T.state?(L=T.state,T.total_in=T.total_out=L.total=0,T.msg="",L.wrap&&(T.adler=1&L.wrap),L.mode=g,L.last=0,L.havedict=0,L.dmax=32768,L.head=null,L.hold=0,L.bits=0,L.lencode=L.lendyn=new r.Buf32(m),L.distcode=L.distdyn=new r.Buf32(b),L.sane=1,L.back=-1,p):d}function v(T){var L;return T&&T.state?((L=T.state).wsize=0,L.whave=0,L.wnext=0,y(T)):d}function w(T,L){var E,N;return T&&T.state?(N=T.state,L<0?(E=0,L=-L):(E=1+(L>>4),L<48&&(L&=15)),L&&(L<8||15<L)?d:(N.window!==null&&N.wbits!==L&&(N.window=null),N.wrap=E,N.wbits=L,v(T))):d}function I(T,L){var E,N;return T?(N=new _,(T.state=N).window=null,(E=w(T,L))!==p&&(T.state=null),E):d}var C,A,S=!0;function P(T){if(S){var L;for(C=new r.Buf32(512),A=new r.Buf32(32),L=0;L<144;)T.lens[L++]=8;for(;L<256;)T.lens[L++]=9;for(;L<280;)T.lens[L++]=7;for(;L<288;)T.lens[L++]=8;for(c(h,T.lens,0,288,C,0,T.work,{bits:9}),L=0;L<32;)T.lens[L++]=5;c(u,T.lens,0,32,A,0,T.work,{bits:5}),S=!1}T.lencode=C,T.lenbits=9,T.distcode=A,T.distbits=5}function M(T,L,E,N){var W,V=T.state;return V.window===null&&(V.wsize=1<<V.wbits,V.wnext=0,V.whave=0,V.window=new r.Buf8(V.wsize)),N>=V.wsize?(r.arraySet(V.window,L,E-V.wsize,V.wsize,0),V.wnext=0,V.whave=V.wsize):(N<(W=V.wsize-V.wnext)&&(W=N),r.arraySet(V.window,L,E-N,W,V.wnext),(N-=W)?(r.arraySet(V.window,L,E-N,N,0),V.wnext=N,V.whave=V.wsize):(V.wnext+=W,V.wnext===V.wsize&&(V.wnext=0),V.whave<V.wsize&&(V.whave+=W))),0}i.inflateReset=v,i.inflateReset2=w,i.inflateResetKeep=y,i.inflateInit=function(T){return I(T,15)},i.inflateInit2=I,i.inflate=function(T,L){var E,N,W,V,et,j,nt,H,B,rt,Q,st,ct,_t,ut,pt,bt,wt,St,Rt,x,Z,Y,$,R=0,U=new r.Buf8(4),tt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!T||!T.state||!T.output||!T.input&&T.avail_in!==0)return d;(E=T.state).mode===12&&(E.mode=13),et=T.next_out,W=T.output,nt=T.avail_out,V=T.next_in,N=T.input,j=T.avail_in,H=E.hold,B=E.bits,rt=j,Q=nt,Z=p;t:for(;;)switch(E.mode){case g:if(E.wrap===0){E.mode=13;break}for(;B<16;){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}if(2&E.wrap&&H===35615){U[E.check=0]=255&H,U[1]=H>>>8&255,E.check=a(E.check,U,2,0),B=H=0,E.mode=2;break}if(E.flags=0,E.head&&(E.head.done=!1),!(1&E.wrap)||(((255&H)<<8)+(H>>8))%31){T.msg="incorrect header check",E.mode=30;break}if((15&H)!=8){T.msg="unknown compression method",E.mode=30;break}if(B-=4,x=8+(15&(H>>>=4)),E.wbits===0)E.wbits=x;else if(x>E.wbits){T.msg="invalid window size",E.mode=30;break}E.dmax=1<<x,T.adler=E.check=1,E.mode=512&H?10:12,B=H=0;break;case 2:for(;B<16;){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}if(E.flags=H,(255&E.flags)!=8){T.msg="unknown compression method",E.mode=30;break}if(57344&E.flags){T.msg="unknown header flags set",E.mode=30;break}E.head&&(E.head.text=H>>8&1),512&E.flags&&(U[0]=255&H,U[1]=H>>>8&255,E.check=a(E.check,U,2,0)),B=H=0,E.mode=3;case 3:for(;B<32;){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}E.head&&(E.head.time=H),512&E.flags&&(U[0]=255&H,U[1]=H>>>8&255,U[2]=H>>>16&255,U[3]=H>>>24&255,E.check=a(E.check,U,4,0)),B=H=0,E.mode=4;case 4:for(;B<16;){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}E.head&&(E.head.xflags=255&H,E.head.os=H>>8),512&E.flags&&(U[0]=255&H,U[1]=H>>>8&255,E.check=a(E.check,U,2,0)),B=H=0,E.mode=5;case 5:if(1024&E.flags){for(;B<16;){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}E.length=H,E.head&&(E.head.extra_len=H),512&E.flags&&(U[0]=255&H,U[1]=H>>>8&255,E.check=a(E.check,U,2,0)),B=H=0}else E.head&&(E.head.extra=null);E.mode=6;case 6:if(1024&E.flags&&(j<(st=E.length)&&(st=j),st&&(E.head&&(x=E.head.extra_len-E.length,E.head.extra||(E.head.extra=new Array(E.head.extra_len)),r.arraySet(E.head.extra,N,V,st,x)),512&E.flags&&(E.check=a(E.check,N,st,V)),j-=st,V+=st,E.length-=st),E.length))break t;E.length=0,E.mode=7;case 7:if(2048&E.flags){if(j===0)break t;for(st=0;x=N[V+st++],E.head&&x&&E.length<65536&&(E.head.name+=String.fromCharCode(x)),x&&st<j;);if(512&E.flags&&(E.check=a(E.check,N,st,V)),j-=st,V+=st,x)break t}else E.head&&(E.head.name=null);E.length=0,E.mode=8;case 8:if(4096&E.flags){if(j===0)break t;for(st=0;x=N[V+st++],E.head&&x&&E.length<65536&&(E.head.comment+=String.fromCharCode(x)),x&&st<j;);if(512&E.flags&&(E.check=a(E.check,N,st,V)),j-=st,V+=st,x)break t}else E.head&&(E.head.comment=null);E.mode=9;case 9:if(512&E.flags){for(;B<16;){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}if(H!==(65535&E.check)){T.msg="header crc mismatch",E.mode=30;break}B=H=0}E.head&&(E.head.hcrc=E.flags>>9&1,E.head.done=!0),T.adler=E.check=0,E.mode=12;break;case 10:for(;B<32;){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}T.adler=E.check=f(H),B=H=0,E.mode=11;case 11:if(E.havedict===0)return T.next_out=et,T.avail_out=nt,T.next_in=V,T.avail_in=j,E.hold=H,E.bits=B,2;T.adler=E.check=1,E.mode=12;case 12:if(L===5||L===6)break t;case 13:if(E.last){H>>>=7&B,B-=7&B,E.mode=27;break}for(;B<3;){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}switch(E.last=1&H,B-=1,3&(H>>>=1)){case 0:E.mode=14;break;case 1:if(P(E),E.mode=20,L!==6)break;H>>>=2,B-=2;break t;case 2:E.mode=17;break;case 3:T.msg="invalid block type",E.mode=30}H>>>=2,B-=2;break;case 14:for(H>>>=7&B,B-=7&B;B<32;){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}if((65535&H)!=(H>>>16^65535)){T.msg="invalid stored block lengths",E.mode=30;break}if(E.length=65535&H,B=H=0,E.mode=15,L===6)break t;case 15:E.mode=16;case 16:if(st=E.length){if(j<st&&(st=j),nt<st&&(st=nt),st===0)break t;r.arraySet(W,N,V,st,et),j-=st,V+=st,nt-=st,et+=st,E.length-=st;break}E.mode=12;break;case 17:for(;B<14;){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}if(E.nlen=257+(31&H),H>>>=5,B-=5,E.ndist=1+(31&H),H>>>=5,B-=5,E.ncode=4+(15&H),H>>>=4,B-=4,286<E.nlen||30<E.ndist){T.msg="too many length or distance symbols",E.mode=30;break}E.have=0,E.mode=18;case 18:for(;E.have<E.ncode;){for(;B<3;){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}E.lens[tt[E.have++]]=7&H,H>>>=3,B-=3}for(;E.have<19;)E.lens[tt[E.have++]]=0;if(E.lencode=E.lendyn,E.lenbits=7,Y={bits:E.lenbits},Z=c(0,E.lens,0,19,E.lencode,0,E.work,Y),E.lenbits=Y.bits,Z){T.msg="invalid code lengths set",E.mode=30;break}E.have=0,E.mode=19;case 19:for(;E.have<E.nlen+E.ndist;){for(;pt=(R=E.lencode[H&(1<<E.lenbits)-1])>>>16&255,bt=65535&R,!((ut=R>>>24)<=B);){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}if(bt<16)H>>>=ut,B-=ut,E.lens[E.have++]=bt;else{if(bt===16){for($=ut+2;B<$;){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}if(H>>>=ut,B-=ut,E.have===0){T.msg="invalid bit length repeat",E.mode=30;break}x=E.lens[E.have-1],st=3+(3&H),H>>>=2,B-=2}else if(bt===17){for($=ut+3;B<$;){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}B-=ut,x=0,st=3+(7&(H>>>=ut)),H>>>=3,B-=3}else{for($=ut+7;B<$;){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}B-=ut,x=0,st=11+(127&(H>>>=ut)),H>>>=7,B-=7}if(E.have+st>E.nlen+E.ndist){T.msg="invalid bit length repeat",E.mode=30;break}for(;st--;)E.lens[E.have++]=x}}if(E.mode===30)break;if(E.lens[256]===0){T.msg="invalid code -- missing end-of-block",E.mode=30;break}if(E.lenbits=9,Y={bits:E.lenbits},Z=c(h,E.lens,0,E.nlen,E.lencode,0,E.work,Y),E.lenbits=Y.bits,Z){T.msg="invalid literal/lengths set",E.mode=30;break}if(E.distbits=6,E.distcode=E.distdyn,Y={bits:E.distbits},Z=c(u,E.lens,E.nlen,E.ndist,E.distcode,0,E.work,Y),E.distbits=Y.bits,Z){T.msg="invalid distances set",E.mode=30;break}if(E.mode=20,L===6)break t;case 20:E.mode=21;case 21:if(6<=j&&258<=nt){T.next_out=et,T.avail_out=nt,T.next_in=V,T.avail_in=j,E.hold=H,E.bits=B,l(T,Q),et=T.next_out,W=T.output,nt=T.avail_out,V=T.next_in,N=T.input,j=T.avail_in,H=E.hold,B=E.bits,E.mode===12&&(E.back=-1);break}for(E.back=0;pt=(R=E.lencode[H&(1<<E.lenbits)-1])>>>16&255,bt=65535&R,!((ut=R>>>24)<=B);){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}if(pt&&!(240&pt)){for(wt=ut,St=pt,Rt=bt;pt=(R=E.lencode[Rt+((H&(1<<wt+St)-1)>>wt)])>>>16&255,bt=65535&R,!(wt+(ut=R>>>24)<=B);){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}H>>>=wt,B-=wt,E.back+=wt}if(H>>>=ut,B-=ut,E.back+=ut,E.length=bt,pt===0){E.mode=26;break}if(32&pt){E.back=-1,E.mode=12;break}if(64&pt){T.msg="invalid literal/length code",E.mode=30;break}E.extra=15&pt,E.mode=22;case 22:if(E.extra){for($=E.extra;B<$;){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}E.length+=H&(1<<E.extra)-1,H>>>=E.extra,B-=E.extra,E.back+=E.extra}E.was=E.length,E.mode=23;case 23:for(;pt=(R=E.distcode[H&(1<<E.distbits)-1])>>>16&255,bt=65535&R,!((ut=R>>>24)<=B);){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}if(!(240&pt)){for(wt=ut,St=pt,Rt=bt;pt=(R=E.distcode[Rt+((H&(1<<wt+St)-1)>>wt)])>>>16&255,bt=65535&R,!(wt+(ut=R>>>24)<=B);){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}H>>>=wt,B-=wt,E.back+=wt}if(H>>>=ut,B-=ut,E.back+=ut,64&pt){T.msg="invalid distance code",E.mode=30;break}E.offset=bt,E.extra=15&pt,E.mode=24;case 24:if(E.extra){for($=E.extra;B<$;){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}E.offset+=H&(1<<E.extra)-1,H>>>=E.extra,B-=E.extra,E.back+=E.extra}if(E.offset>E.dmax){T.msg="invalid distance too far back",E.mode=30;break}E.mode=25;case 25:if(nt===0)break t;if(st=Q-nt,E.offset>st){if((st=E.offset-st)>E.whave&&E.sane){T.msg="invalid distance too far back",E.mode=30;break}ct=st>E.wnext?(st-=E.wnext,E.wsize-st):E.wnext-st,st>E.length&&(st=E.length),_t=E.window}else _t=W,ct=et-E.offset,st=E.length;for(nt<st&&(st=nt),nt-=st,E.length-=st;W[et++]=_t[ct++],--st;);E.length===0&&(E.mode=21);break;case 26:if(nt===0)break t;W[et++]=E.length,nt--,E.mode=21;break;case 27:if(E.wrap){for(;B<32;){if(j===0)break t;j--,H|=N[V++]<<B,B+=8}if(Q-=nt,T.total_out+=Q,E.total+=Q,Q&&(T.adler=E.check=E.flags?a(E.check,W,Q,et-Q):o(E.check,W,Q,et-Q)),Q=nt,(E.flags?H:f(H))!==E.check){T.msg="incorrect data check",E.mode=30;break}B=H=0}E.mode=28;case 28:if(E.wrap&&E.flags){for(;B<32;){if(j===0)break t;j--,H+=N[V++]<<B,B+=8}if(H!==(4294967295&E.total)){T.msg="incorrect length check",E.mode=30;break}B=H=0}E.mode=29;case 29:Z=1;break t;case 30:Z=-3;break t;case 31:return-4;case 32:default:return d}return T.next_out=et,T.avail_out=nt,T.next_in=V,T.avail_in=j,E.hold=H,E.bits=B,(E.wsize||Q!==T.avail_out&&E.mode<30&&(E.mode<27||L!==4))&&M(T,T.output,T.next_out,Q-T.avail_out)?(E.mode=31,-4):(rt-=T.avail_in,Q-=T.avail_out,T.total_in+=rt,T.total_out+=Q,E.total+=Q,E.wrap&&Q&&(T.adler=E.check=E.flags?a(E.check,W,Q,T.next_out-Q):o(E.check,W,Q,T.next_out-Q)),T.data_type=E.bits+(E.last?64:0)+(E.mode===12?128:0)+(E.mode===20||E.mode===15?256:0),(rt==0&&Q===0||L===4)&&Z===p&&(Z=-5),Z)},i.inflateEnd=function(T){if(!T||!T.state)return d;var L=T.state;return L.window&&(L.window=null),T.state=null,p},i.inflateGetHeader=function(T,L){var E;return T&&T.state&&2&(E=T.state).wrap?((E.head=L).done=!1,p):d},i.inflateSetDictionary=function(T,L){var E,N=L.length;return T&&T.state?(E=T.state).wrap!==0&&E.mode!==11?d:E.mode===11&&o(1,L,N,0)!==E.check?-3:M(T,L,N,N)?(E.mode=31,-4):(E.havedict=1,p):d},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,s,i){var r=e("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];s.exports=function(h,u,p,d,g,m,b,f){var _,y,v,w,I,C,A,S,P,M=f.bits,T=0,L=0,E=0,N=0,W=0,V=0,et=0,j=0,nt=0,H=0,B=null,rt=0,Q=new r.Buf16(16),st=new r.Buf16(16),ct=null,_t=0;for(T=0;T<=15;T++)Q[T]=0;for(L=0;L<d;L++)Q[u[p+L]]++;for(W=M,N=15;1<=N&&Q[N]===0;N--);if(N<W&&(W=N),N===0)return g[m++]=20971520,g[m++]=20971520,f.bits=1,0;for(E=1;E<N&&Q[E]===0;E++);for(W<E&&(W=E),T=j=1;T<=15;T++)if(j<<=1,(j-=Q[T])<0)return-1;if(0<j&&(h===0||N!==1))return-1;for(st[1]=0,T=1;T<15;T++)st[T+1]=st[T]+Q[T];for(L=0;L<d;L++)u[p+L]!==0&&(b[st[u[p+L]]++]=L);if(C=h===0?(B=ct=b,19):h===1?(B=o,rt-=257,ct=a,_t-=257,256):(B=l,ct=c,-1),T=E,I=m,et=L=H=0,v=-1,w=(nt=1<<(V=W))-1,h===1&&852<nt||h===2&&592<nt)return 1;for(;;){for(A=T-et,P=b[L]<C?(S=0,b[L]):b[L]>C?(S=ct[_t+b[L]],B[rt+b[L]]):(S=96,0),_=1<<T-et,E=y=1<<V;g[I+(H>>et)+(y-=_)]=A<<24|S<<16|P|0,y!==0;);for(_=1<<T-1;H&_;)_>>=1;if(_!==0?(H&=_-1,H+=_):H=0,L++,--Q[T]==0){if(T===N)break;T=u[p+b[L]]}if(W<T&&(H&w)!==v){for(et===0&&(et=W),I+=E,j=1<<(V=T-et);V+et<N&&!((j-=Q[V+et])<=0);)V++,j<<=1;if(nt+=1<<V,h===1&&852<nt||h===2&&592<nt)return 1;g[v=H&w]=W<<24|V<<16|I-m|0}}return H!==0&&(g[I+H]=T-et<<24|64<<16|0),f.bits=W,0}},{"../utils/common":41}],51:[function(e,s,i){s.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,s,i){var r=e("../utils/common"),o=0,a=1;function l(R){for(var U=R.length;0<=--U;)R[U]=0}var c=0,h=29,u=256,p=u+1+h,d=30,g=19,m=2*p+1,b=15,f=16,_=7,y=256,v=16,w=17,I=18,C=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],A=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],P=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],M=new Array(2*(p+2));l(M);var T=new Array(2*d);l(T);var L=new Array(512);l(L);var E=new Array(256);l(E);var N=new Array(h);l(N);var W,V,et,j=new Array(d);function nt(R,U,tt,K,D){this.static_tree=R,this.extra_bits=U,this.extra_base=tt,this.elems=K,this.max_length=D,this.has_stree=R&&R.length}function H(R,U){this.dyn_tree=R,this.max_code=0,this.stat_desc=U}function B(R){return R<256?L[R]:L[256+(R>>>7)]}function rt(R,U){R.pending_buf[R.pending++]=255&U,R.pending_buf[R.pending++]=U>>>8&255}function Q(R,U,tt){R.bi_valid>f-tt?(R.bi_buf|=U<<R.bi_valid&65535,rt(R,R.bi_buf),R.bi_buf=U>>f-R.bi_valid,R.bi_valid+=tt-f):(R.bi_buf|=U<<R.bi_valid&65535,R.bi_valid+=tt)}function st(R,U,tt){Q(R,tt[2*U],tt[2*U+1])}function ct(R,U){for(var tt=0;tt|=1&R,R>>>=1,tt<<=1,0<--U;);return tt>>>1}function _t(R,U,tt){var K,D,J=new Array(b+1),it=0;for(K=1;K<=b;K++)J[K]=it=it+tt[K-1]<<1;for(D=0;D<=U;D++){var X=R[2*D+1];X!==0&&(R[2*D]=ct(J[X]++,X))}}function ut(R){var U;for(U=0;U<p;U++)R.dyn_ltree[2*U]=0;for(U=0;U<d;U++)R.dyn_dtree[2*U]=0;for(U=0;U<g;U++)R.bl_tree[2*U]=0;R.dyn_ltree[2*y]=1,R.opt_len=R.static_len=0,R.last_lit=R.matches=0}function pt(R){8<R.bi_valid?rt(R,R.bi_buf):0<R.bi_valid&&(R.pending_buf[R.pending++]=R.bi_buf),R.bi_buf=0,R.bi_valid=0}function bt(R,U,tt,K){var D=2*U,J=2*tt;return R[D]<R[J]||R[D]===R[J]&&K[U]<=K[tt]}function wt(R,U,tt){for(var K=R.heap[tt],D=tt<<1;D<=R.heap_len&&(D<R.heap_len&&bt(U,R.heap[D+1],R.heap[D],R.depth)&&D++,!bt(U,K,R.heap[D],R.depth));)R.heap[tt]=R.heap[D],tt=D,D<<=1;R.heap[tt]=K}function St(R,U,tt){var K,D,J,it,X=0;if(R.last_lit!==0)for(;K=R.pending_buf[R.d_buf+2*X]<<8|R.pending_buf[R.d_buf+2*X+1],D=R.pending_buf[R.l_buf+X],X++,K===0?st(R,D,U):(st(R,(J=E[D])+u+1,U),(it=C[J])!==0&&Q(R,D-=N[J],it),st(R,J=B(--K),tt),(it=A[J])!==0&&Q(R,K-=j[J],it)),X<R.last_lit;);st(R,y,U)}function Rt(R,U){var tt,K,D,J=U.dyn_tree,it=U.stat_desc.static_tree,X=U.stat_desc.has_stree,lt=U.stat_desc.elems,vt=-1;for(R.heap_len=0,R.heap_max=m,tt=0;tt<lt;tt++)J[2*tt]!==0?(R.heap[++R.heap_len]=vt=tt,R.depth[tt]=0):J[2*tt+1]=0;for(;R.heap_len<2;)J[2*(D=R.heap[++R.heap_len]=vt<2?++vt:0)]=1,R.depth[D]=0,R.opt_len--,X&&(R.static_len-=it[2*D+1]);for(U.max_code=vt,tt=R.heap_len>>1;1<=tt;tt--)wt(R,J,tt);for(D=lt;tt=R.heap[1],R.heap[1]=R.heap[R.heap_len--],wt(R,J,1),K=R.heap[1],R.heap[--R.heap_max]=tt,R.heap[--R.heap_max]=K,J[2*D]=J[2*tt]+J[2*K],R.depth[D]=(R.depth[tt]>=R.depth[K]?R.depth[tt]:R.depth[K])+1,J[2*tt+1]=J[2*K+1]=D,R.heap[1]=D++,wt(R,J,1),2<=R.heap_len;);R.heap[--R.heap_max]=R.heap[1],(function(gt,Ft){var ue,Gt,ge,Pt,Ls,ci,ve=Ft.dyn_tree,yn=Ft.max_code,vn=Ft.stat_desc.static_tree,hi=Ft.stat_desc.has_stree,ys=Ft.stat_desc.extra_bits,$s=Ft.stat_desc.extra_base,Re=Ft.stat_desc.max_length,Ye=0;for(Pt=0;Pt<=b;Pt++)gt.bl_count[Pt]=0;for(ve[2*gt.heap[gt.heap_max]+1]=0,ue=gt.heap_max+1;ue<m;ue++)Re<(Pt=ve[2*ve[2*(Gt=gt.heap[ue])+1]+1]+1)&&(Pt=Re,Ye++),ve[2*Gt+1]=Pt,yn<Gt||(gt.bl_count[Pt]++,Ls=0,$s<=Gt&&(Ls=ys[Gt-$s]),ci=ve[2*Gt],gt.opt_len+=ci*(Pt+Ls),hi&&(gt.static_len+=ci*(vn[2*Gt+1]+Ls)));if(Ye!==0){do{for(Pt=Re-1;gt.bl_count[Pt]===0;)Pt--;gt.bl_count[Pt]--,gt.bl_count[Pt+1]+=2,gt.bl_count[Re]--,Ye-=2}while(0<Ye);for(Pt=Re;Pt!==0;Pt--)for(Gt=gt.bl_count[Pt];Gt!==0;)yn<(ge=gt.heap[--ue])||(ve[2*ge+1]!==Pt&&(gt.opt_len+=(Pt-ve[2*ge+1])*ve[2*ge],ve[2*ge+1]=Pt),Gt--)}})(R,U),_t(J,vt,R.bl_count)}function x(R,U,tt){var K,D,J=-1,it=U[1],X=0,lt=7,vt=4;for(it===0&&(lt=138,vt=3),U[2*(tt+1)+1]=65535,K=0;K<=tt;K++)D=it,it=U[2*(K+1)+1],++X<lt&&D===it||(X<vt?R.bl_tree[2*D]+=X:D!==0?(D!==J&&R.bl_tree[2*D]++,R.bl_tree[2*v]++):X<=10?R.bl_tree[2*w]++:R.bl_tree[2*I]++,J=D,vt=(X=0)===it?(lt=138,3):D===it?(lt=6,3):(lt=7,4))}function Z(R,U,tt){var K,D,J=-1,it=U[1],X=0,lt=7,vt=4;for(it===0&&(lt=138,vt=3),K=0;K<=tt;K++)if(D=it,it=U[2*(K+1)+1],!(++X<lt&&D===it)){if(X<vt)for(;st(R,D,R.bl_tree),--X!=0;);else D!==0?(D!==J&&(st(R,D,R.bl_tree),X--),st(R,v,R.bl_tree),Q(R,X-3,2)):X<=10?(st(R,w,R.bl_tree),Q(R,X-3,3)):(st(R,I,R.bl_tree),Q(R,X-11,7));J=D,vt=(X=0)===it?(lt=138,3):D===it?(lt=6,3):(lt=7,4)}}l(j);var Y=!1;function $(R,U,tt,K){Q(R,(c<<1)+(K?1:0),3),(function(D,J,it,X){pt(D),rt(D,it),rt(D,~it),r.arraySet(D.pending_buf,D.window,J,it,D.pending),D.pending+=it})(R,U,tt)}i._tr_init=function(R){Y||((function(){var U,tt,K,D,J,it=new Array(b+1);for(D=K=0;D<h-1;D++)for(N[D]=K,U=0;U<1<<C[D];U++)E[K++]=D;for(E[K-1]=D,D=J=0;D<16;D++)for(j[D]=J,U=0;U<1<<A[D];U++)L[J++]=D;for(J>>=7;D<d;D++)for(j[D]=J<<7,U=0;U<1<<A[D]-7;U++)L[256+J++]=D;for(tt=0;tt<=b;tt++)it[tt]=0;for(U=0;U<=143;)M[2*U+1]=8,U++,it[8]++;for(;U<=255;)M[2*U+1]=9,U++,it[9]++;for(;U<=279;)M[2*U+1]=7,U++,it[7]++;for(;U<=287;)M[2*U+1]=8,U++,it[8]++;for(_t(M,p+1,it),U=0;U<d;U++)T[2*U+1]=5,T[2*U]=ct(U,5);W=new nt(M,C,u+1,p,b),V=new nt(T,A,0,d,b),et=new nt(new Array(0),S,0,g,_)})(),Y=!0),R.l_desc=new H(R.dyn_ltree,W),R.d_desc=new H(R.dyn_dtree,V),R.bl_desc=new H(R.bl_tree,et),R.bi_buf=0,R.bi_valid=0,ut(R)},i._tr_stored_block=$,i._tr_flush_block=function(R,U,tt,K){var D,J,it=0;0<R.level?(R.strm.data_type===2&&(R.strm.data_type=(function(X){var lt,vt=4093624447;for(lt=0;lt<=31;lt++,vt>>>=1)if(1&vt&&X.dyn_ltree[2*lt]!==0)return o;if(X.dyn_ltree[18]!==0||X.dyn_ltree[20]!==0||X.dyn_ltree[26]!==0)return a;for(lt=32;lt<u;lt++)if(X.dyn_ltree[2*lt]!==0)return a;return o})(R)),Rt(R,R.l_desc),Rt(R,R.d_desc),it=(function(X){var lt;for(x(X,X.dyn_ltree,X.l_desc.max_code),x(X,X.dyn_dtree,X.d_desc.max_code),Rt(X,X.bl_desc),lt=g-1;3<=lt&&X.bl_tree[2*P[lt]+1]===0;lt--);return X.opt_len+=3*(lt+1)+5+5+4,lt})(R),D=R.opt_len+3+7>>>3,(J=R.static_len+3+7>>>3)<=D&&(D=J)):D=J=tt+5,tt+4<=D&&U!==-1?$(R,U,tt,K):R.strategy===4||J===D?(Q(R,2+(K?1:0),3),St(R,M,T)):(Q(R,4+(K?1:0),3),(function(X,lt,vt,gt){var Ft;for(Q(X,lt-257,5),Q(X,vt-1,5),Q(X,gt-4,4),Ft=0;Ft<gt;Ft++)Q(X,X.bl_tree[2*P[Ft]+1],3);Z(X,X.dyn_ltree,lt-1),Z(X,X.dyn_dtree,vt-1)})(R,R.l_desc.max_code+1,R.d_desc.max_code+1,it+1),St(R,R.dyn_ltree,R.dyn_dtree)),ut(R),K&&pt(R)},i._tr_tally=function(R,U,tt){return R.pending_buf[R.d_buf+2*R.last_lit]=U>>>8&255,R.pending_buf[R.d_buf+2*R.last_lit+1]=255&U,R.pending_buf[R.l_buf+R.last_lit]=255&tt,R.last_lit++,U===0?R.dyn_ltree[2*tt]++:(R.matches++,U--,R.dyn_ltree[2*(E[tt]+u+1)]++,R.dyn_dtree[2*B(U)]++),R.last_lit===R.lit_bufsize-1},i._tr_align=function(R){Q(R,2,3),st(R,y,M),(function(U){U.bi_valid===16?(rt(U,U.bi_buf),U.bi_buf=0,U.bi_valid=0):8<=U.bi_valid&&(U.pending_buf[U.pending++]=255&U.bi_buf,U.bi_buf>>=8,U.bi_valid-=8)})(R)}},{"../utils/common":41}],53:[function(e,s,i){s.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,s,i){(function(r){(function(o,a){if(!o.setImmediate){var l,c,h,u,p=1,d={},g=!1,m=o.document,b=Object.getPrototypeOf&&Object.getPrototypeOf(o);b=b&&b.setTimeout?b:o,l={}.toString.call(o.process)==="[object process]"?function(v){process.nextTick(function(){_(v)})}:(function(){if(o.postMessage&&!o.importScripts){var v=!0,w=o.onmessage;return o.onmessage=function(){v=!1},o.postMessage("","*"),o.onmessage=w,v}})()?(u="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",y,!1):o.attachEvent("onmessage",y),function(v){o.postMessage(u+v,"*")}):o.MessageChannel?((h=new MessageChannel).port1.onmessage=function(v){_(v.data)},function(v){h.port2.postMessage(v)}):m&&"onreadystatechange"in m.createElement("script")?(c=m.documentElement,function(v){var w=m.createElement("script");w.onreadystatechange=function(){_(v),w.onreadystatechange=null,c.removeChild(w),w=null},c.appendChild(w)}):function(v){setTimeout(_,0,v)},b.setImmediate=function(v){typeof v!="function"&&(v=new Function(""+v));for(var w=new Array(arguments.length-1),I=0;I<w.length;I++)w[I]=arguments[I+1];var C={callback:v,args:w};return d[p]=C,l(p),p++},b.clearImmediate=f}function f(v){delete d[v]}function _(v){if(g)setTimeout(_,0,v);else{var w=d[v];if(w){g=!0;try{(function(I){var C=I.callback,A=I.args;switch(A.length){case 0:C();break;case 1:C(A[0]);break;case 2:C(A[0],A[1]);break;case 3:C(A[0],A[1],A[2]);break;default:C.apply(a,A)}})(w)}finally{f(v),g=!1}}}}function y(v){v.source===o&&typeof v.data=="string"&&v.data.indexOf(u)===0&&_(+v.data.slice(u.length))}})(typeof self>"u"?r===void 0?this:r:self)}).call(this,typeof mf<"u"?mf:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(WA);var OB=WA.exports;const jE=Vk(OB);let ry=class{constructor(t,e){z(this,"date",new Date),z(this,"author"),z(this,"guid",Ps.create()),z(this,"viewpoint"),z(this,"modifiedAuthor"),z(this,"modifiedDate"),z(this,"topic"),z(this,"_components"),z(this,"_comment",""),this._components=t,this._comment=e;const s=this._components.get(us);this.author=s.config.author}set comment(t){var e;const s=this._components.get(us);this._comment=t,this.modifiedDate=new Date,this.modifiedAuthor=s.config.author,(e=this.topic)==null||e.comments.set(this.guid,this)}get comment(){return this._comment}toJSON(){var t,e;const s={guid:this.guid,date:this.date.toISOString(),author:this.author,comment:this.comment,topic_guid:(t=this.topic)==null?void 0:t.guid,viewpoint_guid:this.viewpoint,modified_date:(e=this.modifiedDate)==null?void 0:e.toISOString(),modified_author:this.modifiedAuthor};for(const[i,r]of Object.entries(s))r===void 0&&delete s[i];return s}};const YA=class co{constructor(t){z(this,"guid",Ps.create()),z(this,"title",co.default.title),z(this,"creationDate",new Date),z(this,"creationAuthor",""),z(this,"viewpoints",new l_),z(this,"relatedTopics",new l_),z(this,"comments",new Sc),z(this,"documentReferences",new l_),z(this,"customData",{}),z(this,"description"),z(this,"serverAssignedId"),z(this,"dueDate"),z(this,"modifiedAuthor"),z(this,"modifiedDate"),z(this,"index"),z(this,"_type",co.default.type),z(this,"_status",co.default.status),z(this,"_priority",co.default.priority),z(this,"_stage",co.default.stage),z(this,"_assignedTo",co.default.assignedTo),z(this,"_labels",co.default.labels??new Set),z(this,"_components"),this._components=t;const e=t.get(us);this.creationAuthor=e.config.author,this.relatedTopics.guard=s=>s!==this.guid}set type(t){const e=this._components.get(us),{strict:s,types:i}=e.config;(!s||i.has(t))&&(this._type=t)}get type(){return this._type}set status(t){const e=this._components.get(us),{strict:s,statuses:i}=e.config;(!s||i.has(t))&&(this._status=t)}get status(){return this._status}set priority(t){const e=this._components.get(us);if(t){const{strict:s,priorities:i}=e.config;if(!(!s||i.has(t)))return;this._priority=t}else this._priority=t}get priority(){return this._priority}set stage(t){const e=this._components.get(us);if(t){const{strict:s,stages:i}=e.config;if(!(!s||i.has(t)))return;this._stage=t}else this._stage=t}get stage(){return this._stage}set assignedTo(t){const e=this._components.get(us);if(t){const{strict:s,users:i}=e.config;if(!(!s||i.has(t)))return;this._assignedTo=t}else this._assignedTo=t}get assignedTo(){return this._assignedTo}set labels(t){const e=this._components.get(us),{strict:s,labels:i}=e.config;if(s){const r=new Set;for(const o of t)(!s||i.has(o))&&r.add(o);this._labels=r}else this._labels=t}get labels(){return this._labels}get _managerVersion(){return this._components.get(us).config.version}set(t){const e=t,s=this;for(const i in t){if(i==="guid")continue;const r=e[i];i in this&&(s[i]=r)}return this._components.get(us).list.set(this.guid,this),this}createComment(t,e){const s=new ry(this._components,t);return s.viewpoint=e,s.topic=this,this.comments.set(s.guid,s),s}createLabelTags(){const t=[...this.labels];if(this._components.get(us).config.exportCustomDataAsLabels)for(const e in this.customData){const s=this.customData[e];typeof s=="string"&&t.push(s)}return t}createCommentTags(){return[...this.comments.values()].map(t=>{var e;return{$Guid:t.guid,Date:t.date.toISOString(),Author:t.author,Comment:t.comment,ModifiedAuthor:t.modifiedAuthor,ModifiedDate:(e=t.modifiedDate)==null?void 0:e.toISOString(),Viewpoint:t.viewpoint?{$Guid:t.viewpoint}:void 0}})}createViewpointTags(){const t=this._components.get(Nr);return[...this.viewpoints].map(e=>t.list.get(e)).filter(e=>e).map(e=>{const s={$Guid:e.guid,Viewpoint:`${e.title??e.guid}.bcfv`};if(t.snapshots.get(e.snapshot)){const i=t.getSnapshotExtension(e.snapshot);s.Snapshot=`${e.snapshot}.${i}`}return s})}createRelatedTopicTags(){return[...this.relatedTopics].map(t=>({$Guid:t}))}createDocumentReferencesTag(t=this._managerVersion){const e=[];if(!(t==="3"||t==="2.1"))return e;const s=this._components.get(us);for(const i of this.documentReferences){const r=s.documents.get(i);if(!r)continue;let o={$Guid:Ps.create(),Description:r.description};t==="2.1"&&(o={...o,$isExternal:r.type==="external"?!0:void 0,ReferencedDocument:r.type==="external"?r.url:`../${r.fileName}`}),t==="3"&&(o={...o,DocumentGuid:r.type==="internal"?i:void 0,Url:r.type==="external"?r.url:void 0}),Object.keys(o).length>0&&e.push(o)}return e}toJSON(){var t,e;const s={guid:this.guid,server_assigned_id:this.serverAssignedId,topic_type:this.type,topic_status:this.status,title:this.title,priority:this.priority,index:this.index,labels:[...this.labels],creation_date:this.creationDate.toISOString(),creation_author:this.creationAuthor,modified_date:(t=this.modifiedDate)==null?void 0:t.toISOString(),modified_author:this.modifiedAuthor,assigned_to:this.assignedTo,stage:this.stage,description:this.description,due_date:(e=this.dueDate)==null?void 0:e.toISOString(),comments:[...this.comments].map(([o,a])=>a.toJSON()),relatedTopics:[...this.relatedTopics].map(o=>({related_topic_guid:o}))},i=this._components.get(Nr);for(const o of this.viewpoints){const a=i.list.get(o);a&&(s.viewpoints||(s.viewpoints=[]),s.viewpoints.push(a.toJSON()))}const r=this._components.get(us);for(const o of this.documentReferences){const a=r.documents.get(o);a&&(s.document_references||(s.document_references=[]),a.type==="external"?s.document_references.push({guid:Ps.create(),description:a.description,url:a.url}):s.document_references.push({guid:Ps.create(),description:a.description,document_guid:o}))}for(const[o,a]of Object.entries(s))(a===void 0||Array.isArray(a)&&a.length===0)&&delete s[o];return s}serialize(){var t,e;const s=this._managerVersion,i={$Guid:this.guid,$TopicType:this.type,$TopicStatus:this.status,$ServerAssignedId:this.serverAssignedId,Title:this.title,CreationAuthor:this.creationAuthor,CreationDate:this.creationDate.toISOString(),Priority:this.priority,Index:s==="2.1"?this.index:void 0,ModifiedDate:(t=this.modifiedDate)==null?void 0:t.toISOString(),ModifiedAuthor:this.modifiedAuthor,DueDate:(e=this.dueDate)==null?void 0:e.toISOString(),AssignedTo:this.assignedTo,Description:this.description,Stage:this.stage,DocumentReferences:s==="3"?{DocumentReference:this.createDocumentReferencesTag(s)}:void 0,RelatedTopics:s==="3"?{RelatedTopic:this.createRelatedTopicTags()}:void 0,RelatedTopic:s==="2.1"?this.createRelatedTopicTags():void 0,Labels:s==="3"?{Label:this.createLabelTags()}:void 0,Viewpoints:s==="3"?{ViewPoint:this.createViewpointTags()}:void 0,Comments:s==="3"?{Comment:this.createCommentTags()}:void 0};s==="2.1"&&(i.Labels=this.createLabelTags(),i.DocumentReference=this.createDocumentReferencesTag(s));const r={Markup:{Topic:i}};return s==="2.1"&&(r.Markup.Viewpoints=this.createViewpointTags(),r.Markup.Comment=this.createCommentTags()),`<?xml version="1.0" encoding="UTF-8"?>
    ${Pg.builder.build(r)}`}};z(YA,"default",{title:"BCF Topic",type:"Issue",status:"Active"});let WE=YA;const PB=(n,t)=>{if(t.trim()==="")return;const e=us.xmlParser.parse(t).Extensions;if(!e)return;const{Priorities:s,TopicStatuses:i,TopicTypes:r,Users:o}=e;if(s&&s.Priority){const a=Array.isArray(s.Priority)?s.Priority:[s.Priority];for(const l of a)n.config.priorities.add(l)}if(i&&i.TopicStatus){const a=Array.isArray(i.TopicStatus)?i.TopicStatus:[i.TopicStatus];for(const l of a)n.config.statuses.add(l)}if(r&&r.TopicType){const a=Array.isArray(r.TopicType)?r.TopicType:[r.TopicType];for(const l of a)n.config.types.add(l)}if(o&&o.User){const a=Array.isArray(o.User)?o.User:[o.User];for(const l of a)n.config.users.add(l)}};let RB=class extends Rg{constructor(){super(...arguments),z(this,"_config",{version:{type:"Select",options:new Set(["2.1","3"]),multiple:!1,value:""},author:{type:"Text",value:""},types:{type:"TextSet",value:new Set},statuses:{type:"TextSet",value:new Set},priorities:{type:"TextSet",value:new Set},labels:{type:"TextSet",value:new Set},stages:{type:"TextSet",value:new Set},users:{type:"TextSet",value:new Set},includeSelectionTag:{type:"Boolean",value:!1},updateExtensionsOnImport:{type:"Boolean",value:!1},strict:{type:"Boolean",value:!1},includeAllExtensionsOnExport:{type:"Boolean",value:!1},fallbackVersionOnImport:{type:"Select",multiple:!1,options:new Set(["2.1","3"]),value:""},ignoreIncompleteTopicsOnImport:{type:"Boolean",value:!1},exportCustomDataAsLabels:{type:"Boolean",value:!1}})}get version(){return this._config.version.value}set version(t){this._config.version.value=t}get author(){return this._config.author.value}set author(t){this._config.author.value=t}get types(){return this._config.types.value}set types(t){this._config.types.value=t}get statuses(){return this._config.statuses.value}set statuses(t){this._config.statuses.value=t}get priorities(){return this._config.priorities.value}set priorities(t){this._config.priorities.value=t}get labels(){return this._config.labels.value}set labels(t){this._config.labels.value=t}get stages(){return this._config.stages.value}set stages(t){this._config.stages.value=t}get users(){return this._config.users.value}set users(t){this._config.users.value=t}get includeSelectionTag(){return this._config.includeSelectionTag.value}set includeSelectionTag(t){this._config.includeSelectionTag.value=t}get updateExtensionsOnImport(){return this._config.updateExtensionsOnImport.value}set updateExtensionsOnImport(t){this._config.updateExtensionsOnImport.value=t}get strict(){return this._config.strict.value}set strict(t){this._config.strict.value=t}get includeAllExtensionsOnExport(){return this._config.includeAllExtensionsOnExport.value}set includeAllExtensionsOnExport(t){this._config.includeAllExtensionsOnExport.value=t}get fallbackVersionOnImport(){return this._config.fallbackVersionOnImport.value}set fallbackVersionOnImport(t){this._config.fallbackVersionOnImport.value=t}get ignoreIncompleteTopicsOnImport(){return this._config.ignoreIncompleteTopicsOnImport.value}set ignoreIncompleteTopicsOnImport(t){this._config.ignoreIncompleteTopicsOnImport.value=t}get exportCustomDataAsLabels(){return this._config.exportCustomDataAsLabels.value}set exportCustomDataAsLabels(t){this._config.exportCustomDataAsLabels.value=t}};const Cv=class Iu extends me{constructor(){super(...arguments),z(this,"enabled",!1),z(this,"_defaultConfig",{author:"jhon.doe@example.com",version:"2.1",types:new Set(["Clash","Failure","Fault","Inquiry","Issue","Remark","Request"]),statuses:new Set(["Active","In Progress","Done","In Review","Closed"]),priorities:new Set(["On hold","Minor","Normal","Major","Critical"]),labels:new Set,stages:new Set,users:new Set,includeSelectionTag:!1,updateExtensionsOnImport:!0,strict:!1,includeAllExtensionsOnExport:!0,fallbackVersionOnImport:"2.1",ignoreIncompleteTopicsOnImport:!1,exportCustomDataAsLabels:!1}),z(this,"config",new RB(this,this.components,"BCF Topics",Iu.uuid)),z(this,"list",new Sc),z(this,"documents",new Sc),z(this,"onSetup",new yt),z(this,"isSetup",!1),z(this,"onBCFImported",new yt),z(this,"onDisposed",new yt)}setup(t){if(this.isSetup)return;const e={...this._defaultConfig,...t};this.config.version=e.version,this.config.author=e.author,this.config.types=e.types,this.config.statuses=e.statuses,this.config.priorities=e.priorities,this.config.labels=e.labels,this.config.stages=e.stages,this.config.users=e.users,this.config.includeSelectionTag=e.includeSelectionTag,this.config.updateExtensionsOnImport=e.updateExtensionsOnImport,this.config.strict=e.strict,this.config.includeAllExtensionsOnExport=e.includeAllExtensionsOnExport,this.config.fallbackVersionOnImport=e.fallbackVersionOnImport||"",this.config.ignoreIncompleteTopicsOnImport=e.ignoreIncompleteTopicsOnImport,this.isSetup=!0,this.enabled=!0,this.onSetup.trigger()}create(t){const e=new WE(this.components);return t?(e.guid=t.guid??e.guid,e.set(t)):this.list.set(e.guid,e),e}dispose(){this.list.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}get usedTypes(){const t=[...this.list].map(([e,s])=>s.type);return new Set(t)}get usedStatuses(){const t=[...this.list].map(([e,s])=>s.status);return new Set(t)}get usedPriorities(){const t=[...this.list].map(([e,s])=>s.priority).filter(e=>e);return new Set(t)}get usedStages(){const t=[...this.list].map(([e,s])=>s.stage).filter(e=>e);return new Set(t)}get usedUsers(){const t=[];for(const[e,s]of this.list){t.push(s.creationAuthor),s.assignedTo&&t.push(s.assignedTo),s.modifiedAuthor&&t.push(s.modifiedAuthor);for(const[i,r]of s.comments)t.push(r.author),r.modifiedAuthor&&t.push(r.modifiedAuthor)}return new Set(t)}get usedLabels(){const t=[];for(const[e,s]of this.list)t.push(...s.labels);return new Set(t)}updateExtensions(){for(const[t,e]of this.list){for(const s of e.labels)this.config.labels.add(s);this.config.types.add(e.type),e.priority&&this.config.priorities.add(e.priority),e.stage&&this.config.stages.add(e.stage),this.config.statuses.add(e.status),this.config.users.add(e.creationAuthor),e.assignedTo&&this.config.users.add(e.assignedTo),e.modifiedAuthor&&this.config.users.add(e.modifiedAuthor);for(const[s,i]of e.comments)this.config.users.add(i.author),i.modifiedAuthor&&this.config.users.add(i.modifiedAuthor)}}updateViewpointReferences(){const t=this.components.get(Nr);for(const[e,s]of this.list)for(const i of s.viewpoints)t.list.has(i)||s.viewpoints.delete(i)}async export(t=this.list.values()){const e=new jE;e.file("bcf.version",`<?xml version="1.0" encoding="UTF-8"?>
    <Version VersionId="${this.config.version}" xsi:noNamespaceSchemaLocation="https://raw.githubusercontent.com/buildingSMART/BCF-XML/release_3_0/Schemas/version.xsd"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    </Version>`);for(const[i,r]of this.documents.entries())r.type!=="external"&&e.file(this.config.version==="2.1"?r.fileName:`documents/${i}`,r.data);if(this.config.version==="3"){const i=[];for(const[r,o]of this.documents.entries()){const{type:a,description:l}=o;a!=="external"&&i.push(`<Document Guid="${r}">
        <Filename>${o.fileName}</Filename>
        ${l?`<Description>${l}</Description>`:""}
      </Document>`)}i.length>0&&e.file("documents.xml",`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
  <DocumentInfo xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="documents.xsd">
    <Documents>
      ${i.join(`
`)}
    </Documents>
  </DocumentInfo>`)}e.file("bcf.extensions",this.serializeExtensions());const s=this.components.get(Nr);for(const i of t){const r=e.folder(i.guid);r.file("markup.bcf",i.serialize());for(const o of i.viewpoints){const a=s.list.get(o);if(!a)continue;const l=a.title??a.guid;r.file(`${l}.bcfv`,await a.serialize());const c=s.snapshots.get(a.snapshot);if(!c)continue;const h=c?a.snapshot:a.guid,u=s.getSnapshotExtension(a.snapshot);r.file(`${h}.${u}`,c,{binary:!0})}}return await e.generateAsync({type:"blob"})}serializeExtensions(){const t=[...this.config.types].map(a=>`<TopicType>${a}</TopicType>`).join(`
`),e=[...this.config.statuses].map(a=>`<TopicStatus>${a}</TopicStatus>`).join(`
`),s=[...this.config.priorities].map(a=>`<Priority>${a}</Priority>`).join(`
`),i=[...this.config.labels].map(a=>`<TopicLabel>${a}</TopicLabel>`).join(`
`),r=[...this.config.stages].map(a=>`<Stage>${a}</Stage>`).join(`
`),o=[...this.config.users].map(a=>`<User>${a}</User>`).join(`
`);return`
      <?xml version="1.0" encoding="UTF-8"?>
      <Extensions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="your-schema-location.xsd">
        ${t.length!==0?`<TopicTypes>
${t}
</TopicTypes>`:""}
        ${e.length!==0?`<TopicStatuses>
${e}
</TopicStatuses>`:""}
        ${s.length!==0?`<Priorities>
${s}
</Priorities>`:""}
        ${i.length!==0?`<TopicLabels>
${i}
</TopicLabels>`:""}
        ${r.length!==0?`<Stages>
${r}
</Stages>`:""}
        ${o.length!==0?`<Users>
${o}
</Users>`:""}
      </Extensions>
    `}processMarkupComment(t){const{Guid:e,Date:s,Author:i,Comment:r,Viewpoint:o}=t;if(!(e&&s&&i&&(ry||o)))return null;const a=new ry(this.components,r??"");return a.guid=e,a.date=new Date(s),a.author=i,a.viewpoint=o?.Guid,a.modifiedAuthor=t.ModifiedAuthor,a.modifiedDate=t.ModifiedDate?new Date(t.ModifiedDate):void 0,a}getMarkupComments(t,e){var s;let i;if(e==="2.1"&&(i=t.Comment),e==="3"&&(i=(s=t.Topic.Comments)==null?void 0:s.Comment),!i)return[];i=Array.isArray(i)?i:[i];const r=i.map(o=>this.processMarkupComment(o)).filter(o=>o);return Array.isArray(r)?r:[r]}getMarkupLabels(t,e){var s;let i;return e==="2.1"&&(i=t.Topic.Labels),e==="3"&&(i=(s=t.Topic.Labels)==null?void 0:s.Label),i?Array.isArray(i)?i:[i]:[]}getMarkupViewpoints(t,e){var s;let i;return e==="2.1"&&(i=t.Viewpoints),e==="3"&&(i=(s=t.Topic.Viewpoints)==null?void 0:s.ViewPoint),i?(i=Array.isArray(i)?i:[i],i):[]}getMarkupRelatedTopics(t,e){var s;let i;return e==="2.1"&&(i=t.Topic.RelatedTopic),e==="3"&&(i=(s=t.Topic.RelatedTopics)==null?void 0:s.RelatedTopic),i?(Array.isArray(i)?i:[i]).map(r=>r.Guid):[]}getMarkupDocumentReferences(t,e){var s;let i;return e==="2.1"&&(i=t.Topic.DocumentReference),e==="3"&&(i=(s=t.Topic.DocumentReferences)==null?void 0:s.DocumentReference),i?Array.isArray(i)?i:[i]:[]}async load(t){var e,s,i;const{fallbackVersionOnImport:r,ignoreIncompleteTopicsOnImport:o,updateExtensionsOnImport:a}=this.config,l=new jE;await l.loadAsync(t);const c=Object.values(l.files);let h=r;const u=c.find(w=>w.name.endsWith(".version"));if(u){const w=await u.async("string"),I=Iu.xmlParser.parse(w).Version.VersionId;h=String(I)}if(!(h&&(h==="2.1"||h==="3")))throw new Error(`BCFTopics: ${h} is not supported.`);const p=c.find(w=>w.name.endsWith(".extensions"));if(a&&p){const w=await p.async("string");PB(this,w)}const d=[],g=this.components.get(Nr),m=c.filter(w=>w.name.endsWith(".bcfv"));for(const w of m){const I=await w.async("string"),C=Iu.xmlParser.parse(I).VisualizationInfo;if(!C){console.warn("Missing VisualizationInfo in Viewpoint");continue}const A={},{Guid:S,ClippingPlanes:P,Components:M,OrthogonalCamera:T,PerspectiveCamera:L}=C;if(S&&(A.guid=S),M){const N={selection:[],coloring:[],visibility:{default_visibility:!1,exceptions:[],view_setup_hints:{spaces_visible:!1,space_boundaries_visible:!1,openings_visible:!1}}};A.components=N;const{Selection:W,Visibility:V}=M;if(W&&W.Component){const nt=Array.isArray(W.Component)?W.Component:[W.Component];N.selection=nt.map(H=>H.IfcGuid?{ifc_guid:H.IfcGuid}:null).filter(H=>H!==null)}if(V&&"DefaultVisibility"in V&&(N.visibility.default_visibility=V.DefaultVisibility),V&&V.Exceptions&&"Component"in V.Exceptions){const{Component:nt}=V.Exceptions,H=Array.isArray(nt)?nt:[nt];N.visibility.exceptions=H.map(B=>B.IfcGuid?{ifc_guid:B.IfcGuid}:null).filter(B=>B!==null)}let et;h==="2.1"&&(et=M.ViewSetupHints),h==="3"&&(et=(e=M.Visibility)==null?void 0:e.ViewSetupHints),et&&("OpeningsVisible"in et&&(N.visibility.view_setup_hints.openings_visible=et.OpeningsVisible),"SpacesVisible"in et&&(N.visibility.view_setup_hints.spaces_visible=et.SpacesVisible),"SpaceBoundariesVisible"in et&&(N.visibility.view_setup_hints.space_boundaries_visible=et.SpaceBoundariesVisible));const{Coloring:j}=M;if(j&&j.Color){const nt=Array.isArray(j.Color)?j.Color:[j.Color];for(const H of nt){const{Color:B,Component:rt}=H;if(!(B.length===6||B.length===8))continue;const Q=B.length===6?B:B.slice(2),st=(Array.isArray(rt)?rt:[rt]).map(ct=>ct.IfcGuid?{ifc_guid:ct.IfcGuid}:null).filter(ct=>ct!==null);N.coloring.push({color:Q,components:st})}}}if(T||L){const N=C.PerspectiveCamera??C.OrthogonalCamera,{CameraViewPoint:W,CameraDirection:V}=N,et=new F(Number(W.X),Number(W.Z),Number(-W.Y)),j=new F(Number(V.X),Number(V.Z),Number(-V.Y)),nt={camera_view_point:{x:et.x,y:et.y,z:et.z},camera_direction:{x:j.x,y:j.y,z:j.z},aspect_ratio:"AspectRatio"in N?N.AspectRatio:1,camera_up_vector:{x:0,y:0,z:0}};"ViewToWorldScale"in N&&(A.orthogonal_camera={...nt,view_to_world_scale:N.ViewToWorldScale}),"FieldOfView"in N&&(A.perspective_camera={...nt,field_of_view:N.FieldOfView})}if(P){const N=(Array.isArray(P.ClippingPlane)?P.ClippingPlane:[P.ClippingPlane]).map(({Location:W,Direction:V})=>({location:{x:W.x,y:W.y,z:W.z},direction:{x:V.x,y:V.y,z:V.z}}));A.clipping_planes=N}const E=new ZA(this.components,A);d.push(E)}const b=w=>{const I=w.split("/"),C=I[I.length-1].split(".");return C.pop(),C.join(".")},f=c.filter(w=>w.name.endsWith(".png")||w.name.endsWith(".jpeg"));for(const w of f){const I=b(w.name),C=await w.async("arraybuffer"),A=new Uint8Array(C);g.snapshots.set(I,A)}const _={},y=[],v=c.filter(w=>w.name.endsWith(".bcf"));for(const w of v){const I=await w.async("string"),C=Iu.xmlParser.parse(I).Markup,A=C.Topic,{Guid:S,TopicType:P,TopicStatus:M,Title:T,CreationDate:L,CreationAuthor:E}=A;if(o&&!(S&&P&&M&&T&&L&&E))continue;const N=new WE(this.components);N.guid=S??N.guid;const W=this.getMarkupRelatedTopics(C,h);_[N.guid]=new Set(W),N.type=P??N.type,N.status=M??N.status,N.title=T??N.title,N.creationDate=L?new Date(L):N.creationDate,N.creationAuthor=E??N.creationAuthor,N.serverAssignedId=A.ServerAssignedId,N.priority=A.Priority,N.index=A.Index,N.modifiedDate=A.ModifiedDate?new Date(A.ModifiedDate):void 0,N.modifiedAuthor=A.ModifiedAuthor,N.dueDate=A.DueDate?new Date(A.DueDate):void 0,N.assignedTo=A.AssignedTo,N.description=A.Description,N.stage=A.Stage;const V=this.getMarkupLabels(C,h);for(const Q of V)N.labels.add(Q);const et=this.getMarkupComments(C,h);for(const Q of et)N.comments.set(Q.guid,Q);const j=this.getMarkupViewpoints(C,h);for(const Q of j){if(!(Q&&Q.Guid))continue;const st=g.list.get(Q.Guid);if(st){N.viewpoints.add(st.guid);const ct=b(Q.Snapshot);st.snapshot=ct??null}}const nt=this.getMarkupDocumentReferences(C,h),H=c.find(Q=>Q.name==="documents.xml");let B=[];const rt=await H?.async("string");if(rt){const Q=(i=(s=Pg.parser.parse(rt).DocumentInfo)==null?void 0:s.Documents)==null?void 0:i.Document;B=Array.isArray(Q)?Q:[Q]}for(const Q of nt){const{Description:st,DocumentGuid:ct,Url:_t,isExternal:ut,ReferencedDocument:pt}=Q;if(ct&&B.length>0){const bt=B.find(({Guid:Z})=>Z===ct),wt=c.find(Z=>Z.name.endsWith(ct)),St=await wt?.async("uint8array");if(!(bt&&St))continue;const{Description:Rt,Filename:x}=bt;this.documents.set(ct,{type:"internal",fileName:x,description:Rt,data:St}),N.documentReferences.add(ct)}if(_t){const bt=this.documents.add({type:"external",url:_t,description:st});N.documentReferences.add(bt)}if(pt){let bt=null;if(ut)bt=this.documents.add({type:"external",url:pt,description:st});else{const wt=pt.split("/"),St=wt[wt.length-1],Rt=c.find(Z=>Z.name.endsWith(St)),x=await Rt?.async("uint8array");if(!x)continue;bt=this.documents.add({type:"internal",fileName:St,data:x,description:st})}N.documentReferences.add(bt)}}this.list.set(N.guid,N),y.push(N)}for(const w in _){const I=this.list.get(w);if(!I)continue;const C=_[w];for(const A of C)I.relatedTopics.add(A)}return this.onBCFImported.trigger(y),{viewpoints:d,topics:y}}};z(Cv,"uuid","de977976-e4f6-4e4f-a01a-204727839802");z(Cv,"xmlParser",new Og.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",ignoreAttributes:!1,ignoreDeclaration:!0,ignorePiTags:!0,numberParseOptions:{leadingZeros:!0,hex:!0},parseAttributeValue:!0,preserveOrder:!1,processEntities:!1,removeNSPrefix:!0,trimValues:!0}));let us=Cv;const ha=new el,Ms=new F,so=new F,Se=new Pe,YE={X:new F(1,0,0),Y:new F(0,1,0),Z:new F(0,0,1)},S_={type:"change"},GE={type:"mouseDown",mode:null},qE={type:"mouseUp",mode:null},ZE={type:"objectChange"};let FB=class extends dC{constructor(t,e=null){super(void 0,e);const s=new kB(this);this._root=s;const i=new zB;this._gizmo=i,s.add(i);const r=new BB;this._plane=r,s.add(r);const o=this;function a(y,v){let w=v;Object.defineProperty(o,y,{get:function(){return w!==void 0?w:v},set:function(I){w!==I&&(w=I,r[y]=I,i[y]=I,o.dispatchEvent({type:y+"-changed",value:I}),o.dispatchEvent(S_))}}),o[y]=v,r[y]=v,i[y]=v}a("camera",t),a("object",void 0),a("enabled",!0),a("axis",null),a("mode","translate"),a("translationSnap",null),a("rotationSnap",null),a("scaleSnap",null),a("space","world"),a("size",1),a("dragging",!1),a("showX",!0),a("showY",!0),a("showZ",!0),a("minX",-1/0),a("maxX",1/0),a("minY",-1/0),a("maxY",1/0),a("minZ",-1/0),a("maxZ",1/0);const l=new F,c=new F,h=new Pe,u=new Pe,p=new F,d=new Pe,g=new F,m=new F,b=new F,f=0,_=new F;a("worldPosition",l),a("worldPositionStart",c),a("worldQuaternion",h),a("worldQuaternionStart",u),a("cameraPosition",p),a("cameraQuaternion",d),a("pointStart",g),a("pointEnd",m),a("rotationAxis",b),a("rotationAngle",f),a("eye",_),this._offset=new F,this._startNorm=new F,this._endNorm=new F,this._cameraScale=new F,this._parentPosition=new F,this._parentQuaternion=new Pe,this._parentQuaternionInv=new Pe,this._parentScale=new F,this._worldScaleStart=new F,this._worldQuaternionInv=new Pe,this._worldScale=new F,this._positionStart=new F,this._quaternionStart=new Pe,this._scaleStart=new F,this._getPointer=LB.bind(this),this._onPointerDown=NB.bind(this),this._onPointerHover=$B.bind(this),this._onPointerMove=MB.bind(this),this._onPointerUp=DB.bind(this),e!==null&&this.connect(e)}connect(t){super.connect(t),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="auto"}getHelper(){return this._root}pointerHover(t){if(this.object===void 0||this.dragging===!0)return;t!==null&&ha.setFromCamera(t,this.camera);const e=O_(this._gizmo.picker[this.mode],ha);e?this.axis=e.object.name:this.axis=null}pointerDown(t){if(!(this.object===void 0||this.dragging===!0||t!=null&&t.button!==0)&&this.axis!==null){t!==null&&ha.setFromCamera(t,this.camera);const e=O_(this._plane,ha,!0);e&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(e.point).sub(this.worldPositionStart)),this.dragging=!0,GE.mode=this.mode,this.dispatchEvent(GE)}}pointerMove(t){const e=this.axis,s=this.mode,i=this.object;let r=this.space;if(s==="scale"?r="local":(e==="E"||e==="XYZE"||e==="XYZ")&&(r="world"),i===void 0||e===null||this.dragging===!1||t!==null&&t.button!==-1)return;t!==null&&ha.setFromCamera(t,this.camera);const o=O_(this._plane,ha,!0);if(o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),s==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),r==="local"&&e!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),e.indexOf("X")===-1&&(this._offset.x=0),e.indexOf("Y")===-1&&(this._offset.y=0),e.indexOf("Z")===-1&&(this._offset.z=0),r==="local"&&e!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(r==="local"&&(i.position.applyQuaternion(Se.copy(this._quaternionStart).invert()),e.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),e.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),e.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),r==="world"&&(i.parent&&i.position.add(Ms.setFromMatrixPosition(i.parent.matrixWorld)),e.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),e.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),e.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(Ms.setFromMatrixPosition(i.parent.matrixWorld)))),i.position.x=Math.max(this.minX,Math.min(this.maxX,i.position.x)),i.position.y=Math.max(this.minY,Math.min(this.maxY,i.position.y)),i.position.z=Math.max(this.minZ,Math.min(this.maxZ,i.position.z));else if(s==="scale"){if(e.search("XYZ")!==-1){let a=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(a*=-1),so.set(a,a,a)}else Ms.copy(this.pointStart),so.copy(this.pointEnd),Ms.applyQuaternion(this._worldQuaternionInv),so.applyQuaternion(this._worldQuaternionInv),so.divide(Ms),e.search("X")===-1&&(so.x=1),e.search("Y")===-1&&(so.y=1),e.search("Z")===-1&&(so.z=1);i.scale.copy(this._scaleStart).multiply(so),this.scaleSnap&&(e.search("X")!==-1&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),e.search("Y")!==-1&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),e.search("Z")!==-1&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(s==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const a=20/this.worldPosition.distanceTo(Ms.setFromMatrixPosition(this.camera.matrixWorld));let l=!1;e==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Ms.copy(this.rotationAxis).cross(this.eye))*a):(e==="X"||e==="Y"||e==="Z")&&(this.rotationAxis.copy(YE[e]),Ms.copy(YE[e]),r==="local"&&Ms.applyQuaternion(this.worldQuaternion),Ms.cross(this.eye),Ms.length()===0?l=!0:this.rotationAngle=this._offset.dot(Ms.normalize())*a),(e==="E"||l)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),r==="local"&&e!=="E"&&e!=="XYZE"?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(Se.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(Se.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(S_),this.dispatchEvent(ZE)}}pointerUp(t){t!==null&&t.button!==0||(this.dragging&&this.axis!==null&&(qE.mode=this.mode,this.dispatchEvent(qE)),this.dragging=!1,this.axis=null)}dispose(){this.disconnect(),this._root.dispose()}attach(t){return this.object=t,this._root.visible=!0,this}detach(){return this.object=void 0,this.axis=null,this._root.visible=!1,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(S_),this.dispatchEvent(ZE),this.pointStart.copy(this.pointEnd))}getRaycaster(){return ha}getMode(){return this.mode}setMode(t){this.mode=t}setTranslationSnap(t){this.translationSnap=t}setRotationSnap(t){this.rotationSnap=t}setScaleSnap(t){this.scaleSnap=t}setSize(t){this.size=t}setSpace(t){this.space=t}};function LB(n){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:n.button};{const t=this.domElement.getBoundingClientRect();return{x:(n.clientX-t.left)/t.width*2-1,y:-(n.clientY-t.top)/t.height*2+1,button:n.button}}}function $B(n){if(this.enabled)switch(n.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(n));break}}function NB(n){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(n)),this.pointerDown(this._getPointer(n)))}function MB(n){this.enabled&&this.pointerMove(this._getPointer(n))}function DB(n){this.enabled&&(this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(n)))}function O_(n,t,e){const s=t.intersectObject(n,!0);for(let i=0;i<s.length;i++)if(s[i].object.visible||e)return s[i];return!1}const Mf=new fC,pe=new F(0,1,0),XE=new F(0,0,0),QE=new xt,Df=new Pe,pm=new Pe,qn=new F,KE=new xt,Cu=new F(1,0,0),va=new F(0,1,0),Tu=new F(0,0,1),kf=new F,eu=new F,su=new F;let kB=class extends Oi{constructor(t){super(),this.isTransformControlsRoot=!0,this.controls=t,this.visible=!1}updateMatrixWorld(t){const e=this.controls;e.object!==void 0&&(e.object.updateMatrixWorld(),e.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):e.object.parent.matrixWorld.decompose(e._parentPosition,e._parentQuaternion,e._parentScale),e.object.matrixWorld.decompose(e.worldPosition,e.worldQuaternion,e._worldScale),e._parentQuaternionInv.copy(e._parentQuaternion).invert(),e._worldQuaternionInv.copy(e.worldQuaternion).invert()),e.camera.updateMatrixWorld(),e.camera.matrixWorld.decompose(e.cameraPosition,e.cameraQuaternion,e._cameraScale),e.camera.isOrthographicCamera?e.camera.getWorldDirection(e.eye).negate():e.eye.copy(e.cameraPosition).sub(e.worldPosition).normalize(),super.updateMatrixWorld(t)}dispose(){this.traverse(function(t){t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()})}},zB=class extends Oi{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const t=new qr({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),e=new dg({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),s=t.clone();s.opacity=.15;const i=e.clone();i.opacity=.5;const r=t.clone();r.color.setHex(16711680);const o=t.clone();o.color.setHex(65280);const a=t.clone();a.color.setHex(255);const l=t.clone();l.color.setHex(16711680),l.opacity=.5;const c=t.clone();c.color.setHex(65280),c.opacity=.5;const h=t.clone();h.color.setHex(255),h.opacity=.5;const u=t.clone();u.opacity=.25;const p=t.clone();p.color.setHex(16776960),p.opacity=.25,t.clone().color.setHex(16776960);const d=t.clone();d.color.setHex(7895160);const g=new re(0,.04,.1,12);g.translate(0,.05,0);const m=new ee(.08,.08,.08);m.translate(0,.04,0);const b=new Ce;b.setAttribute("position",new Si([0,0,0,1,0,0],3));const f=new re(.0075,.0075,.5,3);f.translate(0,.25,0);function _(E,N){const W=new ar(E,.0075,3,64,N*Math.PI*2);return W.rotateY(Math.PI/2),W.rotateX(Math.PI/2),W}function y(){const E=new Ce;return E.setAttribute("position",new Si([0,0,0,1,1,1],3)),E}const v={X:[[new ht(g,r),[.5,0,0],[0,0,-Math.PI/2]],[new ht(g,r),[-.5,0,0],[0,0,Math.PI/2]],[new ht(f,r),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new ht(g,o),[0,.5,0]],[new ht(g,o),[0,-.5,0],[Math.PI,0,0]],[new ht(f,o)]],Z:[[new ht(g,a),[0,0,.5],[Math.PI/2,0,0]],[new ht(g,a),[0,0,-.5],[-Math.PI/2,0,0]],[new ht(f,a),null,[Math.PI/2,0,0]]],XYZ:[[new ht(new xo(.1,0),u.clone()),[0,0,0]]],XY:[[new ht(new ee(.15,.15,.01),h.clone()),[.15,.15,0]]],YZ:[[new ht(new ee(.15,.15,.01),l.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ht(new ee(.15,.15,.01),c.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},w={X:[[new ht(new re(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new ht(new re(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new ht(new re(.2,0,.6,4),s),[0,.3,0]],[new ht(new re(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new ht(new re(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new ht(new re(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new ht(new xo(.2,0),s)]],XY:[[new ht(new ee(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new ht(new ee(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ht(new ee(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]]},I={START:[[new ht(new xo(.01,2),i),null,null,null,"helper"]],END:[[new ht(new xo(.01,2),i),null,null,null,"helper"]],DELTA:[[new fs(y(),i),null,null,null,"helper"]],X:[[new fs(b,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new fs(b,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new fs(b,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},C={XYZE:[[new ht(_(.5,1),d),null,[0,Math.PI/2,0]]],X:[[new ht(_(.5,.5),r)]],Y:[[new ht(_(.5,.5),o),null,[0,0,-Math.PI/2]]],Z:[[new ht(_(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new ht(_(.75,1),p),null,[0,Math.PI/2,0]]]},A={AXIS:[[new fs(b,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},S={XYZE:[[new ht(new pC(.25,10,8),s)]],X:[[new ht(new ar(.5,.1,4,24),s),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new ht(new ar(.5,.1,4,24),s),[0,0,0],[Math.PI/2,0,0]]],Z:[[new ht(new ar(.5,.1,4,24),s),[0,0,0],[0,0,-Math.PI/2]]],E:[[new ht(new ar(.75,.1,2,24),s)]]},P={X:[[new ht(m,r),[.5,0,0],[0,0,-Math.PI/2]],[new ht(f,r),[0,0,0],[0,0,-Math.PI/2]],[new ht(m,r),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new ht(m,o),[0,.5,0]],[new ht(f,o)],[new ht(m,o),[0,-.5,0],[0,0,Math.PI]]],Z:[[new ht(m,a),[0,0,.5],[Math.PI/2,0,0]],[new ht(f,a),[0,0,0],[Math.PI/2,0,0]],[new ht(m,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new ht(new ee(.15,.15,.01),h),[.15,.15,0]]],YZ:[[new ht(new ee(.15,.15,.01),l),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ht(new ee(.15,.15,.01),c),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new ht(new ee(.1,.1,.1),u.clone())]]},M={X:[[new ht(new re(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new ht(new re(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new ht(new re(.2,0,.6,4),s),[0,.3,0]],[new ht(new re(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new ht(new re(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new ht(new re(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new ht(new ee(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new ht(new ee(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ht(new ee(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new ht(new ee(.2,.2,.2),s),[0,0,0]]]},T={X:[[new fs(b,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new fs(b,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new fs(b,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function L(E){const N=new Oi;for(const W in E)for(let V=E[W].length;V--;){const et=E[W][V][0].clone(),j=E[W][V][1],nt=E[W][V][2],H=E[W][V][3],B=E[W][V][4];et.name=W,et.tag=B,j&&et.position.set(j[0],j[1],j[2]),nt&&et.rotation.set(nt[0],nt[1],nt[2]),H&&et.scale.set(H[0],H[1],H[2]),et.updateMatrix();const rt=et.geometry.clone();rt.applyMatrix4(et.matrix),et.geometry=rt,et.renderOrder=1/0,et.position.set(0,0,0),et.rotation.set(0,0,0),et.scale.set(1,1,1),N.add(et)}return N}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=L(v)),this.add(this.gizmo.rotate=L(C)),this.add(this.gizmo.scale=L(P)),this.add(this.picker.translate=L(w)),this.add(this.picker.rotate=L(S)),this.add(this.picker.scale=L(M)),this.add(this.helper.translate=L(I)),this.add(this.helper.rotate=L(A)),this.add(this.helper.scale=L(T)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(t){const e=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:pm;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(let i=0;i<s.length;i++){const r=s[i];r.visible=!0,r.rotation.set(0,0,0),r.position.copy(this.worldPosition);let o;if(this.camera.isOrthographicCamera?o=(this.camera.top-this.camera.bottom)/this.camera.zoom:o=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),r.scale.set(1,1,1).multiplyScalar(o*this.size/4),r.tag==="helper"){r.visible=!1,r.name==="AXIS"?(r.visible=!!this.axis,this.axis==="X"&&(Se.setFromEuler(Mf.set(0,0,0)),r.quaternion.copy(e).multiply(Se),Math.abs(pe.copy(Cu).applyQuaternion(e).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="Y"&&(Se.setFromEuler(Mf.set(0,0,Math.PI/2)),r.quaternion.copy(e).multiply(Se),Math.abs(pe.copy(va).applyQuaternion(e).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="Z"&&(Se.setFromEuler(Mf.set(0,Math.PI/2,0)),r.quaternion.copy(e).multiply(Se),Math.abs(pe.copy(Tu).applyQuaternion(e).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="XYZE"&&(Se.setFromEuler(Mf.set(0,Math.PI/2,0)),pe.copy(this.rotationAxis),r.quaternion.setFromRotationMatrix(QE.lookAt(XE,pe,va)),r.quaternion.multiply(Se),r.visible=this.dragging),this.axis==="E"&&(r.visible=!1)):r.name==="START"?(r.position.copy(this.worldPositionStart),r.visible=this.dragging):r.name==="END"?(r.position.copy(this.worldPosition),r.visible=this.dragging):r.name==="DELTA"?(r.position.copy(this.worldPositionStart),r.quaternion.copy(this.worldQuaternionStart),Ms.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Ms.applyQuaternion(this.worldQuaternionStart.clone().invert()),r.scale.copy(Ms),r.visible=this.dragging):(r.quaternion.copy(e),this.dragging?r.position.copy(this.worldPositionStart):r.position.copy(this.worldPosition),this.axis&&(r.visible=this.axis.search(r.name)!==-1));continue}r.quaternion.copy(e),this.mode==="translate"||this.mode==="scale"?(r.name==="X"&&Math.abs(pe.copy(Cu).applyQuaternion(e).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="Y"&&Math.abs(pe.copy(va).applyQuaternion(e).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="Z"&&Math.abs(pe.copy(Tu).applyQuaternion(e).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="XY"&&Math.abs(pe.copy(Tu).applyQuaternion(e).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="YZ"&&Math.abs(pe.copy(Cu).applyQuaternion(e).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="XZ"&&Math.abs(pe.copy(va).applyQuaternion(e).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1)):this.mode==="rotate"&&(Df.copy(e),pe.copy(this.eye).applyQuaternion(Se.copy(e).invert()),r.name.search("E")!==-1&&r.quaternion.setFromRotationMatrix(QE.lookAt(this.eye,XE,va)),r.name==="X"&&(Se.setFromAxisAngle(Cu,Math.atan2(-pe.y,pe.z)),Se.multiplyQuaternions(Df,Se),r.quaternion.copy(Se)),r.name==="Y"&&(Se.setFromAxisAngle(va,Math.atan2(pe.x,pe.z)),Se.multiplyQuaternions(Df,Se),r.quaternion.copy(Se)),r.name==="Z"&&(Se.setFromAxisAngle(Tu,Math.atan2(pe.y,pe.x)),Se.multiplyQuaternions(Df,Se),r.quaternion.copy(Se))),r.visible=r.visible&&(r.name.indexOf("X")===-1||this.showX),r.visible=r.visible&&(r.name.indexOf("Y")===-1||this.showY),r.visible=r.visible&&(r.name.indexOf("Z")===-1||this.showZ),r.visible=r.visible&&(r.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),r.material._color=r.material._color||r.material.color.clone(),r.material._opacity=r.material._opacity||r.material.opacity,r.material.color.copy(r.material._color),r.material.opacity=r.material._opacity,this.enabled&&this.axis&&(r.name===this.axis||this.axis.split("").some(function(a){return r.name===a}))&&(r.material.color.setHex(16776960),r.material.opacity=1)}super.updateMatrixWorld(t)}},BB=class extends ht{constructor(){super(new Zc(1e5,1e5,2,2),new qr({visible:!1,wireframe:!0,side:Pi,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(t){let e=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(e="local"),kf.copy(Cu).applyQuaternion(e==="local"?this.worldQuaternion:pm),eu.copy(va).applyQuaternion(e==="local"?this.worldQuaternion:pm),su.copy(Tu).applyQuaternion(e==="local"?this.worldQuaternion:pm),pe.copy(eu),this.mode){case"translate":case"scale":switch(this.axis){case"X":pe.copy(this.eye).cross(kf),qn.copy(kf).cross(pe);break;case"Y":pe.copy(this.eye).cross(eu),qn.copy(eu).cross(pe);break;case"Z":pe.copy(this.eye).cross(su),qn.copy(su).cross(pe);break;case"XY":qn.copy(su);break;case"YZ":qn.copy(kf);break;case"XZ":pe.copy(su),qn.copy(eu);break;case"XYZ":case"E":qn.set(0,0,0);break}break;case"rotate":default:qn.set(0,0,0)}qn.length()===0?this.quaternion.copy(this.cameraQuaternion):(KE.lookAt(Ms.set(0,0,0),qn,pe),this.quaternion.setFromRotationMatrix(KE)),super.updateMatrixWorld(t)}},UB=class GA{constructor(t,e,s,i,r,o=5,a=!0){if(z(this,"onDraggingStarted",new yt),z(this,"onDraggingEnded",new yt),z(this,"onDisposed",new yt),z(this,"normal"),z(this,"origin"),z(this,"three",new Wt),z(this,"components"),z(this,"world"),z(this,"type","default"),z(this,"_title","Clipping Plane"),z(this,"_helper"),z(this,"_visible",!0),z(this,"_enabled",!0),z(this,"_controlsActive",!1),z(this,"_arrowBoundBox",new ht),z(this,"_planeMesh"),z(this,"_controls"),z(this,"_hiddenMaterial",new qr({visible:!1})),z(this,"_visibilityBeforeDisabled",!0),z(this,"notifyManager",()=>{const l=this.components.get(yo),c=l.list.getKey(this);c&&l.list.set(c,this)}),z(this,"update",()=>{this._enabled&&this.three.setFromNormalAndCoplanarPoint(this.normal,this._helper.position)}),z(this,"changeDrag",l=>{this._visible=!l.value,this.preventCameraMovement(),this.notifyDraggingChanged(l)}),this.components=t,this.world=e,!e.renderer)throw new Error("The given world must have a renderer!");this.normal=i,this.origin=s,e.renderer.setPlane(!0,this.three),this._planeMesh=GA.newPlaneMesh(o,r),this._helper=this.newHelper(),this._controls=this.newTransformControls(),this.three.setFromNormalAndCoplanarPoint(i,s),a&&this.toggleControls(!0)}set title(t){this._title=t,this.notifyManager()}get title(){return this._title}get enabled(){return this._enabled}set enabled(t){if(!this.world.isDisposing){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");this._enabled=t,t?this.visible=this._visibilityBeforeDisabled:(this._visibilityBeforeDisabled=this.visible,this.visible=!1),this.world.renderer.setPlane(t,this.three),this.notifyManager()}}get visible(){return this._visible}set visible(t){this._visible=t,this._controls.getHelper().visible=t,this._helper.visible=t,this.toggleControls(t),this.notifyManager()}get meshes(){return[this._planeMesh,this._arrowBoundBox]}get planeMaterial(){return this._planeMesh.material}set planeMaterial(t){this._planeMesh.material=t}get size(){return this._planeMesh.scale.x}set size(t){this._planeMesh.scale.set(t,t,t)}get helper(){return this._helper}setFromNormalAndCoplanarPoint(t,e){this.reset(),this.normal.equals(t)||(this.normal.copy(t),this._helper.lookAt(t)),this.origin.copy(e),this._helper.position.copy(e),this._helper.updateMatrix(),this.update()}dispose(){this._enabled=!1,this.onDraggingStarted.reset(),this.onDraggingEnded.reset(),this._helper.removeFromParent(),this.world.renderer&&this.world.renderer.setPlane(!1,this.three),this._arrowBoundBox.removeFromParent(),this._arrowBoundBox.geometry.dispose(),this._planeMesh.geometry.dispose(),this._controls.getHelper().removeFromParent(),this._controls.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}reset(){const t=new F(1,0,0),e=new F;this.normal.equals(t)||(this.normal.copy(t),this._helper.lookAt(t)),this.origin.copy(e),this._helper.position.copy(e),this._helper.updateMatrix()}toggleControls(t){if(t){if(this._controlsActive)return;this._controls.addEventListener("change",this.update),this._controls.addEventListener("dragging-changed",this.changeDrag)}else this._controls.removeEventListener("change",this.update),this._controls.removeEventListener("dragging-changed",this.changeDrag);this._controlsActive=t}newTransformControls(){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");const t=this.world.camera.three,e=this.world.renderer.three.domElement,s=new FB(t,e);return this.initializeControls(s),this.world.scene.three.add(s.getHelper()),s}initializeControls(t){t.attach(this._helper),t.showX=!1,t.showY=!1,t.setSpace("local"),this.createArrowBoundingBox(),t.getHelper().children[0].children[0].add(this._arrowBoundBox)}createArrowBoundingBox(){this._arrowBoundBox.geometry=new re(.18,.18,1.2),this._arrowBoundBox.material=this._hiddenMaterial,this._arrowBoundBox.rotateX(Math.PI/2),this._arrowBoundBox.updateMatrix(),this._arrowBoundBox.geometry.applyMatrix4(this._arrowBoundBox.matrix)}notifyDraggingChanged(t){t.value?this.onDraggingStarted.trigger():this.onDraggingEnded.trigger()}preventCameraMovement(){this.world.camera.enabled=this._visible}newHelper(){const t=new Oi;return t.lookAt(this.normal),t.position.copy(this.origin),this._planeMesh.position.z+=.01,t.add(this._planeMesh),this.world.scene.three.add(t),t}static newPlaneMesh(t,e){const s=new Zc(1),i=new ht(s,e);return i.scale.set(t,t,t),i}},VB=class extends Rg{constructor(){super(...arguments),z(this,"_config",{enabled:{value:!0,type:"Boolean"},visible:{value:!0,type:"Boolean"},color:{value:new Dt,type:"Color"},opacity:{type:"Number",interpolable:!0,value:1,min:0,max:1},size:{type:"Number",interpolable:!0,value:2,min:0,max:100}})}get enabled(){return this._config.enabled.value}set enabled(t){this._config.enabled.value=t,this._component.enabled=t}get visible(){return this._config.visible.value}set visible(t){this._config.visible.value=t,this._component.visible=t}get color(){return this._config.color.value}set color(t){this._config.color.value=t,this._component.material.color.copy(t)}get opacity(){return this._config.opacity.value}set opacity(t){this._config.opacity.value=t,this._component.material.opacity=t}get size(){return this._config.size.value}set size(t){this._config.size.value=t,this._component.size=t}};const qA=class fm extends me{constructor(t){super(t),z(this,"onSetup",new yt),z(this,"onBeforeDrag",new yt),z(this,"onAfterDrag",new yt),z(this,"onBeforeCreate",new yt),z(this,"onBeforeCancel",new yt),z(this,"onAfterCancel",new yt),z(this,"onBeforeDelete",new yt),z(this,"onAfterCreate",new yt),z(this,"onAfterDelete",new yt),z(this,"onDisposed",new yt),z(this,"isSetup",!1),z(this,"orthogonalY",!1),z(this,"toleranceOrthogonalY",.7),z(this,"Type",UB),z(this,"list",new Yt),z(this,"config",new VB(this,this.components,"Clipper",fm.uuid)),z(this,"_defaultConfig",{color:new Dt(12255487),opacity:.2,size:2}),z(this,"_material",new qr({color:12255487,side:Pi,transparent:!0,opacity:.2})),z(this,"_size",5),z(this,"_enabled",!1),z(this,"_visible",!0),z(this,"_onStartDragging",()=>{this.onBeforeDrag.trigger()}),z(this,"_onEndDragging",()=>{this.onAfterDrag.trigger()}),this.components.add(fm.uuid,this),this.setEvents()}get enabled(){return this._enabled}set enabled(t){this._enabled=t}get visible(){return this._visible}set visible(t){this._visible=t;for(const[e,s]of this.list)s.visible=t}get material(){return this._material}set material(t){this._material=t;for(const[e,s]of this.list)s.planeMaterial=t}get size(){return this._size}set size(t){this._size=t;for(const[e,s]of this.list)s.size=t}setEvents(){this.list.onBeforeDelete.add(({value:t})=>{if(!t.world.renderer)throw new Error("Renderer not found for this plane's world!");t.world.renderer.setPlane(!1,t.three),t.dispose(),this.updateMaterialsAndPlanes()})}dispose(){this._enabled=!1,this.components.get(Ev).list.delete(this.config.uuid),this.list.clear(),this._material.dispose(),this.onBeforeCreate.reset(),this.onBeforeCancel.reset(),this.onBeforeDelete.reset(),this.onBeforeDrag.reset(),this.onAfterCreate.reset(),this.onAfterCancel.reset(),this.onAfterDelete.reset(),this.onAfterDrag.reset(),this.onDisposed.trigger(fm.uuid),this.onDisposed.reset()}async create(t){const e=await this.components.get(ln).get(t).castRay();return e?this.createPlaneFromIntersection(t,e):null}createFromNormalAndCoplanarPoint(t,e,s){const i=this.newPlane(t,s,e);return this.updateMaterialsAndPlanes(),i}async delete(t,e){if(!e){const s=await this.pickPlane(t);if(!s)return;e=this.list.getKey(s)}e&&this.list.delete(e)}deleteAll(t){for(const[e,s]of this.list)(!t||t.has(s.type))&&this.list.delete(e)}setup(t){const e={...this._defaultConfig,...t};this.config.color=e.color,this.config.opacity=e.opacity,this.config.size=e.size,this.isSetup=!0,this.onSetup.trigger()}async pickPlane(t){const e=this.components.get(ln).get(t),s=this.getAllPlaneMeshes(),i=await e.castRay({items:s});if(i){const r=i.object;return[...this.list.values()].find(o=>o.meshes.includes(r))}}getAllPlaneMeshes(){const t=[];for(const[e,s]of this.list)t.push(...s.meshes);return t}createPlaneFromIntersection(t,e){var s;if(!t.renderer)throw new Error("The given world must have a renderer!");const i=e.point.distanceTo(new F(0,0,0)),r=e.normal||((s=e.face)==null?void 0:s.normal);if(!i||!r)return null;const o=this.getWorldNormal(e,r),a=this.newPlane(t,e.point,o.negate()),l=this.list.get(a);return l.visible=this._visible,l.size=this._size,t.renderer.setPlane(!0,l.three),this.updateMaterialsAndPlanes(),l}getWorldNormal(t,e){const s=t.object;let i=t.object.matrixWorld.clone();if(s instanceof Wy&&t.instanceId!==void 0){const a=new xt;s.getMatrixAt(t.instanceId,a),i=a.multiply(i)}const r=new cC().getNormalMatrix(i),o=e.clone().applyMatrix3(r).normalize();return this.normalizePlaneDirectionY(o),o}normalizePlaneDirectionY(t){this.orthogonalY&&(t.y>this.toleranceOrthogonalY&&(t.x=0,t.y=1,t.z=0),t.y<-this.toleranceOrthogonalY&&(t.x=0,t.y=-1,t.z=0))}newPlane(t,e,s){const i=new this.Type(this.components,t,e,s,this._material);i.onDraggingStarted.add(this._onStartDragging),i.onDraggingEnded.add(this._onEndDragging);const r=Ps.create();return this.list.set(r,i),this.onAfterCreate.trigger(i),r}updateMaterialsAndPlanes(){const t=this.components.get($A);for(const[e,s]of t.list){if(!s.renderer)continue;s.renderer.updateClippingPlanes();const{clippingPlanes:i}=s.renderer;for(const r of s.meshes)if(r.material)if(Array.isArray(r.material))for(const o of r.material)o.clippingPlanes=i;else r.material.clippingPlanes=i}}};z(qA,"uuid","66290bc5-18c4-4cd1-9379-2e17a0617611");let yo=qA,ZA=class{constructor(t,e){z(this,"title"),z(this,"guid",Ps.create()),z(this,"clippingPlanes",new fe),z(this,"camera",{aspect_ratio:1,field_of_view:60,camera_direction:{x:0,y:0,z:0},camera_view_point:{x:0,y:0,z:0},camera_up_vector:{x:0,y:1,z:0}}),z(this,"exceptionComponents",new fe),z(this,"selectionComponents",new fe),z(this,"componentColors",new Yt),z(this,"spacesVisible",!1),z(this,"spaceBoundariesVisible",!1),z(this,"openingsVisible",!1),z(this,"defaultVisibility",!0),z(this,"snapshot",this.guid),z(this,"_components"),z(this,"_world",null),z(this,"notifyUpdate",()=>{this._components.get(Nr).list.set(this.guid,this)}),this._components=t,e&&(this.guid=e.guid??this.guid,this.set(e)),this.setEvents()}async getSelectionMap(){return await this._components.get(Mt).guidsToModelIdMap([...this.selectionComponents])}async getExceptionMap(){return await this._components.get(Mt).guidsToModelIdMap([...this.exceptionComponents])}get projection(){return"field_of_view"in this.camera?"Perspective":"Orthographic"}get position(){const t=this._components.get(Mt),{camera_view_point:e}=this.camera,{x:s,y:i,z:r}=e,o=new F(s,i,r);return t.applyBaseCoordinateSystem(o,new xt),o}set position(t){const e=t.clone(),s=this._components.get(Mt);t.clone().applyMatrix4(s.baseCoordinationMatrix.clone().invert()),this.camera.camera_view_point={x:e.x,y:e.y,z:e.z}}get direction(){const{camera_direction:t}=this.camera,{x:e,y:s,z:i}=t;return new F(e,s,i)}set world(t){this._world=t}get world(){return this._world}get _managerVersion(){return this._components.get(us).config.version}get topics(){return[...this._components.get(us).list.values()].filter(t=>t.viewpoints.has(this.guid))}setEvents(){this.selectionComponents.onUpdated.add(this.notifyUpdate),this.exceptionComponents.onUpdated.add(this.notifyUpdate),this.clippingPlanes.onUpdated.add(this.notifyUpdate),this.componentColors.onItemSet.add(this.notifyUpdate),this.componentColors.onItemDeleted.add(this.notifyUpdate),this.componentColors.onItemUpdated.add(this.notifyUpdate),this.componentColors.onCleared.add(this.notifyUpdate)}set(t){this.title=t.title;const{components:e,perspective_camera:s,orthogonal_camera:i,clipping_planes:r}=t;if(e){const{selection:o,visibility:a,coloring:l}=e;if(o){this.selectionComponents.clear();for(const{ifc_guid:c}of o)c&&this.selectionComponents.add(c)}if(a){const{default_visibility:c,exceptions:h,view_setup_hints:u}=a;if(c!==void 0&&(this.defaultVisibility=c),h){this.exceptionComponents.clear();for(const{ifc_guid:p}of h)p&&this.exceptionComponents.add(p)}if(u){const{spaces_visible:p,space_boundaries_visible:d,openings_visible:g}=u;p!==void 0&&(this.spacesVisible=p),d!==void 0&&(this.spaceBoundariesVisible=d),g!==void 0&&(this.openingsVisible=g)}}if(l){this.componentColors.clear();for(const c of l){const{color:h,components:u}=c,p=u.map(d=>d.ifc_guid).filter(d=>d!==null);this.componentColors.set(h,p)}}}if((s||i)&&(this.camera=s??i),r&&this.world){const o=this._components.get(yo);for(const a of r){const{location:l,direction:c}=a,h=new F(l.x,l.z,-l.y),u=new F(c.x,c.z,-c.y),p=o.createFromNormalAndCoplanarPoint(this.world,u,h);this.clippingPlanes.add(p),o.list.get(p).enabled=!1,o.list.get(p).visible=!1}}this.notifyUpdate()}async go(t){if(!this.world)return;const{camera:e}=this.world;if(!(e instanceof jA))throw new Error("Viewpoint: the world's camera component must be of type OrthoPerspectiveCamera to switch between perspective and orthographic projections.");const{transition:s,applyClippings:i,applyVisibility:r,clippingsVisibility:o}={transition:!0,applyClippings:!0,applyVisibility:!0,clippingsVisibility:!0,...t};e.projection.set(this.projection);const a=new F(this.camera.camera_view_point.x,this.camera.camera_view_point.y,this.camera.camera_view_point.z),l=new F(this.camera.camera_direction.x,this.camera.camera_direction.y,this.camera.camera_direction.z);if(a.equals(new F)&&l.equals(new F))return;const c=this.position,h=this.direction,u=80,p={x:c.x+h.x*u,y:c.y+h.y*u,z:c.z+h.z*u},d=[];i&&this.setClippingState(!0),r&&d.push(this.applyVisibility()),this.setClippingVisibility(o),d.push(e.controls.setLookAt(c.x,c.y,c.z,p.x,p.y,p.z,s)),await Promise.all(d)}async updateCamera(t=!0){return new Promise(e=>{if(!this.world){e(!1);return}const{camera:s,renderer:i}=this.world;if(!i)throw new Error("Viewpoint: the world needs to have a renderer!");if(!s.hasCameraControls())throw new Error("Viewpoint: world's camera need camera controls!");const r=new F;s.controls.getPosition(r);const o=s.three,a=new F(0,0,-1).applyEuler(o.rotation),{width:l,height:c}=i.getSize();let h=l/c;Number.isNaN(h)&&(h=1);const u=this._components.get(Mt);r.applyMatrix4(u.baseCoordinationMatrix.clone().invert());const p={aspect_ratio:h,camera_view_point:{x:r.x,y:r.y,z:r.z},camera_direction:{x:a.x,y:a.y,z:a.z},camera_up_vector:{x:0,y:1,z:0}};if(o instanceof Md?this.camera={...p,field_of_view:o.fov}:o instanceof sl&&(this.camera={...p,view_to_world_scale:o.top-o.bottom}),t){const d=this._components.get(Nr),g=i.three.domElement;i.three.render(this.world.scene.three,s.three),g.toBlob(async m=>{if(m){const b=await m.arrayBuffer(),f=new Uint8Array(b);d.snapshots.set(this.guid,f)}this.notifyUpdate(),e(!0)})}else this.notifyUpdate(),e(!0)})}takeSnapshot(){return new Promise(t=>{if(!this.world){t(!1);return}const{camera:e,renderer:s}=this.world;if(!s)throw new Error("Viewpoint: the world needs to have a renderer!");const i=this._components.get(Nr),r=s.three.domElement;s.three.render(this.world.scene.three,e.three),r.toBlob(async o=>{if(o){const a=await o.arrayBuffer(),l=new Uint8Array(a);i.snapshots.set(this.guid,l)}this.notifyUpdate(),t(!0)})})}updateClippingPlanes(){this.clippingPlanes.clear();const t=this._components.get(yo);for(const[e,s]of t.list)s.enabled&&this.clippingPlanes.add(e)}async applyVisibility(){const t=this._components.get(az);t.set(this.defaultVisibility);const e=await this.getExceptionMap();t.set(!this.defaultVisibility,e);const s=await this.getSelectionMap();t.set(!0,s)}async setColorizationState(t){const e=this._components.get(Mt),s=[];if(t)for(const[i,r]of this.componentColors){const o=`#${i}`,a=await e.guidsToModelIdMap(r);for(const[l,c]of Object.entries(a)){const h=e.list.get(l);h&&s.push(h.highlight([...c],{customId:o,color:new Dt(o),renderedFaces:il.ONE,opacity:1,transparent:!1}))}}else for(const[i,r]of this.componentColors){const o=await e.guidsToModelIdMap(r);for(const[a,l]of Object.entries(o)){const c=e.list.get(a);c&&s.push(c.resetHighlight([...l]))}}s.push(e.core.update(!0)),await Promise.all(s)}setClippingState(t){const e=this._components.get(yo);for(const[s,i]of e.list)i.enabled=t&&this.clippingPlanes.has(s)}setClippingVisibility(t){const e=this._components.get(yo);for(const s of this.clippingPlanes){const i=e.list.get(s);i&&(i.visible=t)}}async createComponentTags(t){var e;const s=this._components.get(Mt),i=this._components.get(us);let r="";if(i.config.includeSelectionTag){const o=t==="selection"?await this.getSelectionMap():await this.getExceptionMap();for(const a in o){const l=s.list.get(a);if(!l)continue;const c=o[a];for(const h of c){const u=l.getItem(h),p=await u.getGuid();if(!p)continue;const d=(e=await u.getAttributes())==null?void 0:e.getValue("Tag");let g=null;d&&(g=`AuthoringToolId="${d}"`),r+=`
<Component IfcGuid="${p}" ${g??""} />`}}}else r=[...this.selectionComponents].map(o=>`<Component IfcGuid="${o}" />`).join(`
`);return r}createColorTags(){let t="";for(const[e,s]of this.componentColors.entries()){const i=s.map(r=>`
<Component IfcGuid="${r}" />`).join(`
`);t+=`<Color Color="${e}">
${i}
</Color>`}return t.length!==0?`<Coloring>
${t}
</Coloring>`:"<Coloring />"}toJSON(){const t=this._components.get(yo),e={guid:this.guid,components:{selection:[...this.selectionComponents].map(r=>({ifc_guid:r,authoring_tool_id:null})),coloring:[...this.componentColors].map(([r,o])=>({color:r,components:o.map(a=>({ifc_guid:a,authoring_tool_id:null}))})),visibility:{default_visibility:this.defaultVisibility,exceptions:[...this.exceptionComponents].map(r=>({ifc_guid:r,authoring_tool_id:null})),view_setup_hints:{spaces_visible:this.spacesVisible,space_boundaries_visible:this.spaceBoundariesVisible,openings_visible:this.openingsVisible}}},clipping_planes:[...this.clippingPlanes].map(r=>{const o=t.list.get(r);if(!o)return null;const a=o._controls.worldPosition??o.origin,{normal:l}=o;return{location:{x:a.x,y:-a.z,z:a.y},direction:{x:l.x,y:-l.z,z:l.y}}}).filter(r=>r!==null)};"field_of_view"in this.camera?e.perspective_camera=this.camera:e.orthogonal_camera=this.camera;const s=this._components.get(Nr),i=s.snapshots.get(this.snapshot);if(i){const r=i.toString(),o=btoa(r),a=s.getSnapshotExtension(this.snapshot);e.snapshot={snapshot_type:a,snapshot_data:o}}return e}async serialize(t=this._managerVersion){const e=this._components.get(Mt),s=this.position;s.applyMatrix4(e.baseCoordinationMatrix.clone().invert());const i=this.direction;i.normalize();const r=new xt().makeRotationX(Math.PI/2),o=i.clone().applyMatrix4(r);o.normalize();const a=`<CameraViewPoint>
      <X>${s.x}</X>
      <Y>${-s.z}</Y>
      <Z>${s.y}</Z>
    </CameraViewPoint>`,l=`<CameraDirection>
      <X>${i.x}</X>
      <Y>${-i.z}</Y>
      <Z>${i.y}</Z>
    </CameraDirection>`,c=`<CameraUpVector>
      <X>${o.x}</X>
      <Y>${-o.z}</Y>
      <Z>${o.y}</Z>
    </CameraUpVector>`,h=`<AspectRatio>${this.camera.aspect_ratio}</AspectRatio>`;let u="";"viewToWorld"in this.camera?u=`<OrthogonalCamera>
        ${a}
        ${l}
        ${c}
        ${h}
        <ViewToWorldScale>${this.camera.viewToWorld}</ViewToWorldScale>
      </OrthogonalCamera>`:"fov"in this.camera&&(u=`<PerspectiveCamera>
        ${a}
        ${l}
        ${c}
        ${h}
        <FieldOfView>${this.camera.fov}</FieldOfView>
      </PerspectiveCamera>`);const p=`<ViewSetupHints SpacesVisible="${this.spacesVisible??!1}" SpaceBoundariesVisible="${this.spaceBoundariesVisible??!1}" OpeningsVisible="${this.openingsVisible??!1}" />`,d=(await this.createComponentTags("selection")).trim(),g=(await this.createComponentTags("exception")).trim(),m=this.createColorTags();return`<?xml version="1.0" encoding="UTF-8"?>
    <VisualizationInfo Guid="${this.guid}">
      <Components>
        ${t==="2.1"?p:""}
        ${d.length!==0?`<Selection>${d}</Selection>`:""}
        <Visibility DefaultVisibility="${this.defaultVisibility}">
          ${t==="3"?p:""}
          ${g.length!==0?`<Exceptions>${g}</Exceptions>`:""}
        </Visibility>
        ${m}
      </Components>
      ${u}
    </VisualizationInfo>`}},HB=class extends Rg{constructor(){super(...arguments),z(this,"_config",{overwriteColors:{value:!1,type:"Boolean"}})}get overwriteColors(){return this._config.overwriteColors.value}set overwriteColors(t){this._config.overwriteColors.value=t}};const XA=class oy extends me{constructor(t){super(t),z(this,"enabled",!0),z(this,"world",null),z(this,"list",new Yt),z(this,"snapshots",new Yt),z(this,"isSetup",!1),z(this,"onSetup",new yt),z(this,"config",new HB(this,this.components,"Viewpoints",oy.uuid)),z(this,"onDisposed",new yt),t.add(oy.uuid,this)}create(t){const e=new ZA(this.components,t);return e.world=this.world,t||this.list.set(e.guid,e),e}getSnapshotExtension(t){let e="jpeg";const s=this.snapshots.get(t);if(!s)return e;const i=s.subarray(0,4);let r="";for(let o=0;o<i.length;o++)r+=i[o].toString(16);return r.startsWith("89504e47")&&(e="png"),r.startsWith("ffd8ffe")&&(e="jpeg"),e}setup(){}dispose(){this.list.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}};z(XA,"uuid","ee867824-a796-408d-8aa0-4e5962a83c66");let Nr=XA,JE=class{constructor(t,e){z(this,"_components"),z(this,"_cameraOffset",10),z(this,"_planeHelper"),z(this,"_farPlaneHelper"),z(this,"_cameraHelper"),z(this,"onStateChanged",new yt),z(this,"onUpdated",new yt),z(this,"onDisposed",new yt),z(this,"camera"),z(this,"plane",new Wt),z(this,"farPlane",new Wt),z(this,"id",Ps.create()),z(this,"_open",!1),z(this,"_range",jB.defaultRange),z(this,"_world",null),z(this,"_helpersVisible",!1),z(this,"_planesEnabled",!1),this._components=t,this.camera=new jA(this._components);const{threeOrtho:s}=this.camera;if(e!=null&&e.id&&(this.id=e.id),e!=null&&e.normal&&e!=null&&e.point){const{normal:i,point:r}=e;this.plane.setFromNormalAndCoplanarPoint(i,r)}this._cameraHelper=new gC(s),this._planeHelper=new Em(this.plane,50),this._farPlaneHelper=new Em(this.farPlane,50),this.farPlaneHelperColor=new Dt("blue"),this.update()}get _planeNormalOpposite(){return this.plane.normal.clone().negate()}get _planePosition(){return this.plane.normal.clone().multiplyScalar(-this.plane.constant)}get _cameraPosition(){return this._planePosition.addScaledVector(this._planeNormalOpposite,this._cameraOffset)}set open(t){this._open=t,this.onStateChanged.trigger(["open"])}get open(){return this._open}set planeHelperColor(t){!Array.isArray(this._planeHelper.material)&&"color"in this._planeHelper.material&&this._planeHelper.material.color instanceof Dt&&(this._planeHelper.material.color=t)}set farPlaneHelperColor(t){!Array.isArray(this._farPlaneHelper.material)&&"color"in this._farPlaneHelper.material&&this._farPlaneHelper.material.color instanceof Dt&&(this._farPlaneHelper.material.color=t)}set range(t){this._range=t,this.update()}get range(){return this._range}set distance(t){this.plane.constant=t,this.update()}get distance(){return this.plane.constant}set world(t){this._world=t,this.camera.currentWorld=t,t&&(this.camera.projection.set("Orthographic"),this.camera.set("Plan"),this.camera.controls.dollySpeed=6,this.camera.controls.restThreshold=.005,this.update())}get world(){return this._world}set helpersVisible(t){if(!t){this._helpersVisible=t,this._planeHelper.removeFromParent(),this._farPlaneHelper.removeFromParent(),this._cameraHelper.removeFromParent();return}this.world&&(this._helpersVisible=t,this.world.scene.three.add(this._planeHelper,this._farPlaneHelper))}get helpersVisible(){return this._helpersVisible}set planesEnabled(t){const{world:e}=this;if(!e)return;const{renderer:s}=e;s&&(s.setPlane(t,this.plane),s.setPlane(t,this.farPlane),this._planesEnabled=t)}get planesEnabled(){return this._planesEnabled}dispose(){this.helpersVisible=!1;const t=this._components.get(mr);t.destroy(this._planeHelper),t.destroy(this._farPlaneHelper),t.destroy(this._cameraHelper),this.camera.dispose(),this.onDisposed.trigger()}update(){if(this.world){const t=this._cameraPosition,e=this._planePosition;this.camera.controls.setLookAt(t.x,t.y,t.z,e.x,e.y,e.z,!1)}this.farPlane.normal.copy(this._planeNormalOpposite),this.farPlane.constant=this.range-this.plane.constant,this.onUpdated.trigger()}flip(){this.plane.normal.negate(),this.update()}};const Tv=class QA extends me{constructor(t){super(t),z(this,"list",new Yt),z(this,"enabled",!0),z(this,"world",null),z(this,"_fragmentsUpdateEvent",()=>{this.components.get(Mt).core.update(!0)}),t.add(QA.uuid,this),this.setupEvents()}get hasOpenViews(){return[...this.list.values()].some(t=>t.open)}setupEvents(){this.list.onBeforeDelete.add(({key:t,value:e})=>{e.open&&this.close(t),e.dispose()})}create(t,e,s){const i=new JE(this.components,{id:s?.id,normal:t,point:e});return i.world=s?.world??this.world,this.list.set(i.id,i),i}createFromPlane(t,e){const s=new JE(this.components,{id:e?.id});return s.plane.copy(t),s.update(),s.world=e?.world??this.world,this.list.set(s.id,s),s}async createFromIfcStoreys(t){const e=[],s=this.components.get(Mt),i=t?.offset===void 0?.25:t.offset;for(const[r,o]of s.list){if(t&&t.modelIds&&!t.modelIds.some(u=>u.test(r)))continue;const a=Object.values(await o.getItemsOfCategories([/BUILDINGSTOREY/])).flat();if(a.length===0)continue;const l=await o.getItemsData(a),[,c]=await o.getCoordinates(),h=new F(0,-1,0);for(const u of l){if(!("value"in u.Name&&"value"in u.Elevation))continue;const{value:p}=u.Name;if(t!=null&&t.storeyNames&&!t.storeyNames.some(b=>b.test(p)))continue;const d=u.Elevation.value+c+i,g=new Wt(h,d),m=this.createFromPlane(g,{id:p,world:t?.world});e.push(m)}}return e}createElevations(t){const e=[],s=this.components.get(Mt),i=t?.combine===void 0?!1:t.combine,r=t?.namingCallback??(a=>({front:`${i?"Front":`${a}: Front`}`,back:`${i?"Back":`${a}: Back`}`,left:`${i?"Left":`${a}: Left`}`,right:`${i?"Right":`${a}: Right`}`}));let o=[];for(const[a,l]of s.list)t&&t.modelIds&&!t.modelIds.some(c=>c.test(a))||o.push({id:a,box:l.box});if(i){const a=this.components.get(Dm);a.list.clear(),a.list.add(...o.map(l=>l.box)),o=[{id:"combined",box:a.get()}]}for(const{id:a,box:l}of o){const{min:c,max:h}=l,u=Math.abs(h.x-c.x),p=Math.abs(h.z-c.z),d=new F;l.getCenter(d);const g=new Wt(new F(0,0,-1),h.z),m=new Wt(new F(0,0,1),-c.z),b=new Wt(new F(-1,0,0),h.x),f=new Wt(new F(1,0,0),-c.x),{front:_,back:y,left:v,right:w}=r(a),I=this.createFromPlane(g,{id:_,world:t?.world});I.range=p;const C=this.createFromPlane(m,{id:y,world:t?.world});C.range=p;const A=this.createFromPlane(b,{id:v,world:t?.world});A.range=u;const S=this.createFromPlane(f,{id:w,world:t?.world});S.range=u,e.push(I,C,A,S)}return e}open(t){const e=this.list.get(t);if(!e)throw new Error(`Views: the view with id ${t} doesn't exist.`);if(e.open)return;const{world:s}=e;if(!s)throw new Error(`Views: no world found for view with id ${t}.`);const{renderer:i}=s;if(!i)throw new Error(`Views: no renderer found for world with id ${s.uuid}.`);for(const[,r]of this.list)r.world===s&&this.close(r.id);i.setPlane(!0,e.plane),i.setPlane(!0,e.farPlane),e.camera.controls.addEventListener("rest",this._fragmentsUpdateEvent),s.camera=e.camera,e.open=!0}close(t){let e;if(t?e=this.list.get(t):e=[...this.list.values()].find(r=>r.open),t&&!e)throw new Error(`Views: the view with id ${t} doesn't exist.`);if(!e||!e.open)return;const{world:s}=e;if(!s)throw new Error(`Views: no world found for view with id ${t}.`);const{renderer:i}=s;if(!i)throw new Error(`Views: no renderer found for world with id ${s.uuid}.`);i.setPlane(!1,e.plane),i.setPlane(!1,e.farPlane),e.camera.controls.removeEventListener("rest",this._fragmentsUpdateEvent),s.useDefaultCamera(),e.open=!1}};z(Tv,"uuid","fb22f1f5-6598-4664-a11d-de8963ae420f");z(Tv,"defaultRange",15);let jB=Tv,sh=class{constructor(t){z(this,"cardinality","required"),z(this,"instructions"),z(this,"evalRequirement",(e,s,i,r)=>{const o={parameter:i,currentValue:e,requiredValue:s,pass:!1};r&&this.addCheckResult(o,r);let a=!1;if(s.type==="simple"&&(a=e===s.parameter),s.type==="enumeration"&&(a=s.parameter.includes(e)),s.type==="pattern"&&(a=new RegExp(s.parameter).test(String(e))),s.type==="length"){const{min:l,length:c,max:h}=s.parameter;c!==void 0&&(a=String(e).length===c),l!==void 0&&(a=String(e).length>=l),h!==void 0&&(a=String(e).length<=h)}if(s.type==="bounds"&&typeof e=="number"){const{min:l,minInclusive:c,max:h,maxInclusive:u}=s.parameter;let p=!0,d=!0;l!==void 0&&(p=c?e>=l:e>l),h!==void 0&&(d=u?e<=h:e<h),a=p&&d}return this.cardinality==="prohibited"&&(a=!a),this.cardinality==="optional"&&(a=!0),o.pass=a,o.pass}),this._components=t}addCheckResult(t,e){const s=e.findIndex(({parameter:i})=>i===t.parameter);s!==-1?e[s]=t:e.push(t)}getItemChecks(t,e,s){if(!("value"in s._localId&&typeof s._localId.value=="number"))return null;let i=t.get(e);i||(i=new Yt,t.set(e,i));let r=i.get(s._localId.value);if(r){if(!r.pass)return null}else{const l=[];r={guid:Array.isArray(s._guid)?void 0:s._guid.value,pass:!1,checks:l},Object.defineProperty(r,"pass",{get:()=>l.every(({pass:c})=>c)}),i.set(s._localId.value,r)}const o=[],a={facetType:this.facetType,cardinality:this.cardinality,checks:o,pass:!1};return Object.defineProperty(a,"pass",{get:()=>o.every(({pass:l})=>l)}),r.checks.push(a),a.checks}};const fr=(n,t)=>{let e="";if(!t)return e;if(t.type==="simple"&&(e=`<simpleValue>${t.parameter}</simpleValue>`),t.type==="enumeration"&&(e=`<xs:restriction base="xs:string">
    ${t.parameter.map(s=>`<xs:enumeration value="${s}" />`).join(`
`)}
    </xs:restriction>`),t.type==="pattern"&&(e=`<xs:restriction base="xs:string">
      <xs:pattern value="${t.parameter}" />
    </xs:restriction>`),t.type==="bounds"){const{min:s,minInclusive:i,max:r,maxInclusive:o}=t.parameter;let a="";s!==void 0&&(a=`<xs:min${i?"Inclusive":"Exclusive"} value="${s}">`);let l="";r!==void 0&&(l=`<xs:max${o?"Inclusive":"Exclusive"} value="${r}">`),e=`<xs:restriction base="xs:double">
      ${a}
      ${l}
    </xs:restriction>`}if(t.type==="length"){const{length:s,min:i,max:r}=t.parameter;let o="";s!==void 0&&i===void 0&&r===void 0&&(o=`<xs:length value="${s}" />`);let a="";i!==void 0&&s===void 0&&(a=`<xs:minLength value="${i}" />`);let l="";r!==void 0&&s===void 0&&(l=`<xs:maxLength value="${r}" />`),e=`<xs:restriction base="xs:string">
      ${o}
      ${a}
      ${l}
    </xs:restriction>`}return`<${n[0].toLowerCase()+n.slice(1)}>
    ${e}
  </${n[0].toLowerCase()+n.slice(1)}>`};let WB=class extends sh{constructor(t,e){super(t),z(this,"facetType","Attribute"),z(this,"name"),z(this,"value"),this.name=e}serialize(t){const e=fr("Name",this.name),s=fr("Value",this.value);let i="";return t==="requirement"&&(i+=`cardinality="${this.cardinality}"`,i+=this.instructions?`instructions="${this.instructions}"`:""),`<attribute ${i}>
  ${e}
  ${s}
</attribute>`}async getEntities(){}async test(t,e){const s=this._components.get(Mt);for(const[i,r]of Object.entries(t)){const o=s.list.get(i);if(!o)continue;const a=await o.getItemsData([...r]);for(const l of a){const c=this.getItemChecks(e,i,l);if(!c)continue;const h=Object.keys(l).filter(p=>{const d=this.evalRequirement(p,this.name,"Name");if(!d)return!1;const g=l[p];return Array.isArray(g)?!0:g===null||g.value===null?this.cardinality==="optional"||this.cardinality==="prohibited":Array.isArray(g.value)&&g.value.length===0||typeof g.value=="string"&&g.value.trim()===""?!1:d}),u=h.length>0;if(c.push({parameter:"Name",currentValue:u?h[0]:null,requiredValue:this.name,pass:this.cardinality==="prohibited"?!u:u}),this.value)if(h[0]){const p=l[h[0]];Array.isArray(p)?c.push({parameter:"Value",currentValue:null,requiredValue:this.value,pass:this.cardinality==="prohibited"}):Array.isArray(p.value)?c.push({parameter:"Value",currentValue:null,requiredValue:this.value,pass:this.cardinality==="prohibited"}):this.evalRequirement(p.value,this.value,"Value",c)}else c.push({parameter:"Value",currentValue:null,requiredValue:this.value,pass:this.cardinality==="prohibited"})}}}},YB=class extends sh{constructor(t,e){super(t),z(this,"facetType","Classification"),z(this,"system"),z(this,"value"),z(this,"uri"),this.system=e}serialize(t){const e=fr("System",this.system),s=fr("Value",this.value);let i="";return t==="requirement"&&(i+=`cardinality="${this.cardinality}"`,i+=this.uri?`uri=${this.uri}`:"",i+=this.instructions?`instructions="${this.instructions}"`:""),`<classification ${i}>
  ${e}
  ${s}
</classification>`}async getEntities(t,e){}async test(t,e){}},ay=class extends sh{constructor(t,e){super(t),z(this,"facetType","Entity"),z(this,"name"),z(this,"predefinedType"),this.name=e}serialize(t){const e=fr("Name",this.name),s=fr("Name",this.predefinedType);let i="";return t==="requirement"&&(i+=`cardinality="${this.cardinality}"`,i+=this.instructions?`instructions="${this.instructions}"`:""),`<entity ${i}>
  ${e}
  ${s}
</entity>`}async getEntities(t,e){const s=this._components.get(Mt),i=new Map;for(const[o,a]of s.list){if(!t.find(c=>c.test(o)))continue;const l=await a.getCategories();for(const c of l){if(!await this.evalName(c))continue;let h=i.get(o);h||(h=[],i.set(o,h)),h.push(c)}}const r={};if(await Promise.all(Array.from(i.entries()).map(async([o,a])=>{const l=s.list.get(o);if(!l)return;const c=a.map(p=>new RegExp(`^${p}$`)),h=await l.getItemsOfCategories(c),u=Object.values(h).flat();r[o]=new Set(u)})),!this.predefinedType){Qe.add(e,r);return}for(const[o,a]of Object.entries(r)){const l=s.list.get(o);if(!l)continue;const c=await l.getItemsData([...a]);for(const h of c)"value"in h._localId&&await this.evalPredefinedType(o,h)&&Qe.append(e,o,h._localId.value)}}async test(t,e){const s=this._components.get(Mt);for(const[i,r]of Object.entries(t)){const o=s.list.get(i);if(!o)continue;const a=await o.getItemsData([...r]);for(const l of a){if(!("value"in l._category))continue;const c=this.getItemChecks(e,i,l);c&&(await this.evalName(l._category.value,c),await this.evalPredefinedType(i,l,c))}}}async evalName(t,e){return this.evalRequirement(t,this.name,"Name",e)}async evalPredefinedType(t,e,s){if(!this.predefinedType||!("value"in e.PredefinedType))return null;const i=typeof this.predefinedType.parameter=="string"&&this.predefinedType.parameter==="USERDEFINED";let r=e.PredefinedType.value;if(r==="USERDEFINED"&&!i){const o=Object.keys(e).find(a=>/^((?!Predefined).)*Type$/.test(a));if(o){const a=e[o];"value"in a&&(r=a.value)}else r="USERDEFINED"}if(!r){const o=this._components.get(Mt).list.get(t);if(o&&"value"in e._localId){const[a]=await o.getItemsData([e._localId.value],{relations:{IsTypedBy:{attributes:!0,relations:!1}}});if(Array.isArray(a.IsTypedBy)){const l=a.IsTypedBy[0];if(l&&"value"in l.PredefinedType&&(r=l.PredefinedType.value,r==="USERDEFINED"&&!i)){const c=Object.keys(l).find(h=>/^((?!Predefined).)*Type$/.test(h));if(c){const h=l[c];"value"in h&&(r=h.value)}else r="USERDEFINED"}}}}return this.evalRequirement(r,this.predefinedType,"PredefinedType",s)}},GB=class extends sh{constructor(t,e,s){super(t),z(this,"facetType","Property"),z(this,"propertySet"),z(this,"baseName"),z(this,"value"),z(this,"dataType"),z(this,"uri"),z(this,"_unsupportedTypes",["IFCCOMPLEXPROPERTY","IFCPHYSICALCOMPLEXQUANTITY"]),this.propertySet=e,this.baseName=s}serialize(t){const e=fr("PropertySet",this.propertySet),s=fr("BaseName",this.baseName),i=fr("Value",this.value),r=this.dataType?`dataType=${this.dataType}`:"";let o="";return t==="requirement"&&(o+=`cardinality="${this.cardinality}"`,o+=this.uri?`uri=${this.uri}`:"",o+=this.instructions?`instructions="${this.instructions}"`:""),`<property ${r} ${o}>
  ${e}
  ${s}
  ${i}
</property>`}async getEntities(t,e){const s=this._components.get(Mt);for(const[i,r]of s.list){if(!t.find(c=>c.test(i)))continue;const o=await r.getItemsOfCategories([/PROPERTYSET/,/ELEMENTQUANTITY/]),a=Object.values(o).flat();if(a.length===0)continue;const l=await r.getItemsData(a,{relations:{HasProperties:{attributes:!0,relations:!1},DefinesOcurrence:{attributes:!0,relations:!1}}});for(const c of l){if(!("value"in c._localId&&"value"in c._category&&"value"in c.Name&&Array.isArray(c.DefinesOcurrence))||!this.evalRequirement(c.Name.value,this.propertySet,"PropertySet"))continue;let h;if(c._category.value==="IFCPROPERTYSET"&&(h="HasProperties"),c._category.value==="IFCELEMENTQUANTITY"&&(h="Quantities"),!h)continue;const u=c[h];if(Array.isArray(u))for(const p of u){const d=Object.keys(p),g=d.find(f=>/Name/.test(f));if(!(g&&"value"in p[g]))continue;const m=p[g];if(!("value"in m)||!this.evalRequirement(m.value,this.baseName,"BaseName"))continue;if(this.value){const f=d.find(y=>/Value/.test(y));if(!f)continue;const _=p[f];if(!("value"in _)||!this.evalRequirement(_.value,this.value,"Value"))continue}const b=c.DefinesOcurrence.map(f=>"value"in f._localId&&typeof f._localId.value=="number"?f._localId.value:null).filter(f=>f!==null);Qe.append(e,i,...b)}}}}async test(t,e){const s=this._components.get(Mt);for(const[i,r]of Object.entries(t)){const o=s.list.get(i);if(!o)continue;const a=await o.getItemsData([...r],{relations:{IsDefinedBy:{attributes:!0,relations:!0},IsTypedBy:{attributes:!0,relations:!1},HasPropertySets:{attributes:!0,relations:!0},DefinesOcurrence:{attributes:!1,relations:!1}}});for(const l of a){const c=this.getItemChecks(e,i,l);if(!c)continue;const h=(await this.getPsets(l)).filter(u=>!("value"in u.Name)||!this.evalRequirement(u.Name.value,this.propertySet,"PropertySet")?!1:(c.push({currentValue:u.Name.value,parameter:"PropertySet",pass:!0,requiredValue:this.propertySet}),!0));if(h.length===0){c.push({currentValue:null,parameter:"PropertySet",pass:!1,requiredValue:this.propertySet});continue}for(const u of h){const p=this.getPropertyListName(u);if(!p)continue;const d=u[p];if(!Array.isArray(d)){c.push({currentValue:null,parameter:"BaseName",pass:!1,requiredValue:this.baseName});continue}const g=d.filter(m=>!("value"in m._category&&"value"in m.Name)||this._unsupportedTypes.includes(m._category.value)||!this.evalRequirement(m.Name.value,this.baseName,"BaseName")?!1:(c.push({currentValue:m.Name.value,parameter:"BaseName",pass:!0,requiredValue:this.baseName}),!0));if(g.length===0){c.push({currentValue:null,parameter:"BaseName",pass:!1,requiredValue:this.baseName});continue}for(const m of g)this.evalValue(m,c),this.evalDataType(m,c),this.evalURI()}}}}getPropertyListName(t){let e;return"value"in t._category&&(t._category.value==="IFCPROPERTYSET"&&(e="HasProperties"),t._category.value==="IFCELEMENTQUANTITY"&&(e="Quantities")),e}getValueKey(t){return Object.keys(t).find(e=>/Value/.test(e)||/Values/.test(e))}getTypePsets(t){if(!Array.isArray(t.IsTypedBy))return[];const[e]=t.IsTypedBy;return e&&Array.isArray(e.HasPropertySets)?e.HasPropertySets:[]}async getPsets(t){const e=this.getTypePsets(t);if(!Array.isArray(t.IsDefinedBy))return e;const s=[];for(const i of t.IsDefinedBy){if(!("value"in i.Name))continue;const r=i.Name.value,o=this.getPropertyListName(i);if(!(r&&o))continue;const a=e.find(l=>"value"in l.Name?l.Name.value===r:!1);if(a&&Array.isArray(a.HasProperties)&&Array.isArray(i.HasProperties))for(const l of a.HasProperties){if(!("value"in l.Name))continue;const c=l.Name.value;i.HasProperties.find(h=>"value"in h.Name?h.Name.value===c:!1)||i.HasProperties.push(l)}s.push(i)}return s}evalValue(t,e){const s=this.getValueKey(t),i=t[s];if(!("value"in i))return!1;if(this.value){if(!s)return e?.push({parameter:"Value",currentValue:null,pass:!1,requiredValue:this.value}),!1;const r=structuredClone(this.value);return i.type==="IFCLABEL"&&r.type==="simple"&&(r.parameter=String(r.parameter)),this.evalRequirement(i.value,r,"Value",e)}return s&&typeof i.value=="string"&&i.value.trim()===""?(e?.push({parameter:"Value",currentValue:"",pass:!1,requiredValue:this.value}),!1):!0}evalDataType(t,e){if(!this.dataType)return!0;const s=this.getValueKey(t);if(!(s&&"value"in t[s]))return e?.push({parameter:"DataType",currentValue:null,pass:!1,requiredValue:this.dataType}),!1;const i=t[s];return this.evalRequirement(i.type??null,{type:"simple",parameter:this.dataType},"DataType",e)}evalURI(){return!0}},qB=class extends sh{constructor(){super(...arguments),z(this,"_ifcMaterialEntities",[/^IFCMATERIALLAYERSETUSAGE$/,/^IFCMATERIALCONSTITUENTSET$/,/^IFCMATERIAL$/,/^IFCMATERIALLIST$/]),z(this,"facetType","Material"),z(this,"value"),z(this,"uri")}serialize(t){if(!(this.value&&this.uri))return"<material />";const e=fr("Value",this.value);let s="";return t==="requirement"&&(s+=`cardinality="${this.cardinality}"`,s+=this.uri?`uri=${this.uri}`:"",s+=this.instructions?`instructions="${this.instructions}"`:""),`<material ${s}>
  ${e}
</material>`}async getEntities(t,e){const s=this._components.get(Mt);for(const[i,r]of s.list){if(!t.find(c=>c.test(i)))continue;const o=await r.getItemsOfCategories(this._ifcMaterialEntities),a=Object.values(o).flat();if(a.length===0)continue;const l=await r.getItemsData(a,{relations:{AssociatedTo:{attributes:!0,relations:!1},MaterialConstituents:{attributes:!0,relations:!0},ForLayerSet:{attributes:!0,relations:!0},MaterialLayers:{attributes:!0,relations:!0},Materials:{attributes:!0,relations:!1}}});for(const c of l){if(!("value"in c._localId&&"value"in c._category&&Array.isArray(c.AssociatedTo))||!this.hasValidMaterial(c))continue;const h=c.AssociatedTo.map(u=>"value"in u._localId&&u._localId.value?u._localId.value:null).filter(u=>u!==null);Qe.append(e,i,...h)}}}async test(t,e){const s=this._components.get(Mt);for(const[i,r]of Object.entries(t)){const o=s.list.get(i);if(!o)continue;const a=await o.getItemsData([[...r][0]],{relations:{AssociatedTo:{attributes:!1,relations:!1},HasAssociations:{attributes:!0,relations:!0},MaterialConstituents:{attributes:!0,relations:!0},ForLayerSet:{attributes:!0,relations:!0},MaterialLayers:{attributes:!0,relations:!0},Materials:{attributes:!0,relations:!1}}});for(const l of a){const c=this.getItemChecks(e,i,l);if(c){if(!Array.isArray(l.HasAssociations)){c.push({parameter:null,currentValue:null,requiredValue:this.value,pass:!1});continue}for(const h of l.HasAssociations)if(this._ifcMaterialEntities.some(u=>"value"in h._category?u.test(h._category.value):!1)&&this.hasValidMaterial(h,c))break}}}}hasValidMaterial(t,e){let s=!1;if("value"in t._category&&t._category.value==="IFCMATERIAL")this.evalValue(t,e)&&(s=!0);else for(const[i,r]of Object.entries(t))if(["ForLayerSet","MaterialLayers","Material","MaterialConstituents","Materials"].includes(i)&&Array.isArray(r)){for(const o of r)if("value"in o._category&&o._category.value==="IFCMATERIAL"){if(this.evalValue(o,e)){s=!0;break}}else if(this.hasValidMaterial(o)){s=!0;break}}return s}evalValue(t,e){if(!this.value)return e?.push({parameter:null,currentValue:t.Name&&"value"in t.Name?t.Name.value:null,pass:!0}),!0;if(!("value"in t._category&&t._category.value==="IFCMATERIAL"))return null;let s=!1;return t.Name&&"value"in t.Name&&(s=this.evalRequirement(t.Name.value,this.value,"Value",e)),s||(t.Category&&"value"in t.Category&&(s=this.evalRequirement(t.Category.value,this.value,"Value",e)),s)}},ZB=class extends sh{constructor(t,e){super(t),z(this,"facetType","PartOf"),z(this,"_entityFacet"),z(this,"_entity"),z(this,"relation"),z(this,"cardinality","required"),this._entity=e,this._entityFacet=new ay(t,e.name),this._entityFacet.predefinedType=e.predefinedType}set entity(t){this._entity=t;const{name:e,predefinedType:s}=t;this._entityFacet=new ay(this._components,e),this._entityFacet.predefinedType=s}get entity(){return this._entity}serialize(){return""}async getEntities(t,e){}async test(t){}},XB=class{constructor(t,e,s){z(this,"name"),z(this,"ifcVersion",new Set),z(this,"identifier",Ps.create()),z(this,"description"),z(this,"instructions"),z(this,"requirementsDescription"),z(this,"applicability",new fe),z(this,"requirements",new fe),z(this,"components"),this.components=t,this.name=e;for(const i of s)this.ifcVersion.add(i)}set(t){const e=t,s=this;for(const i in t){if(i==="identifier")continue;const r=e[i];i in this&&(s[i]=r)}return this.components.get(QB).list.set(this.identifier,this),this}async test(t){const e=new Yt;if(this.requirements.size===0)return e;const s={},i=[];for(const o of this.applicability)i.push(o.getEntities(t,s));await Promise.all(i);const r=[];for(const o of this.requirements)r.push(o.test(s,e));return await Promise.all(r),e}serialize(){const t=`name="${this.name}"`,e=this.identifier?`identifier="${this.identifier}"`:"",s=this.description?`description="${this.description}"`:"",i=this.instructions?`instructions="${this.instructions}"`:"";return`<specification ifcVersion="${[...this.ifcVersion].join(" ")}" ${t} ${e} ${s} ${i}>
      <applicability minOccurs="1" maxOccurs="unbounded">
        ${[...this.applicability].map(r=>r.serialize("applicability")).join(`
`)}
      </applicability>
      <requirements>
        ${[...this.requirements].map(r=>r.serialize("requirement")).join(`
`)}
      </requirements>
    </specification>`}};const an=n=>{if(!n)return;const t={};if("simpleValue"in n&&(t.type="simple",t.parameter=n.simpleValue),"restriction"in n){const e=n.restriction,s=Object.keys(e);if("pattern"in e&&(t.type="pattern",t.parameter=e.pattern.value),"enumeration"in e){t.type="enumeration";const i=e.enumeration.map(({value:r})=>r);t.parameter=i}if(s.some(i=>["minInclusive","minExclusive","maxInclusive","maxExclusive"].includes(i))){t.type="bounds";const i={},r=s.find(a=>a.includes("min")),o=s.find(a=>a.includes("max"));r&&(i.minInclusive=r==="minInclusive",i.min=e[r].value),o&&(i.maxInclusive=o==="maxInclusive",i.max=e[o].value),t.parameter=i}if(s.some(i=>["minLength","length","maxLength"].includes(i))){t.type="length";const i={};e.length!==void 0&&(i.length=e.length.value),e.minLength!==void 0&&(i.min=e.minLength.value),e.maxLength!==void 0&&(i.max=e.maxLength.value),t.parameter=i}}if(t.parameter!==void 0)return t},tx=(n,t)=>{const e=[];for(const s of t){const i=s.name,r=an(i);if(!r)continue;const o=new ay(n,r);s.cardinality&&(o.cardinality=s.cardinality),o.predefinedType=an(s.predefinedType),o.instructions=s.instructions,e.push(o)}return e},ex=(n,t)=>{const e=[];for(const s of t){const i=s.name,r=an(i);if(!r)continue;const o=new WB(n,r);s.cardinality&&(o.cardinality=s.cardinality),o.value=an(s.value),o.instructions=s.instructions,e.push(o)}return e},sx=(n,t)=>{const e=[];for(const s of t){const i=new qB(n);s.cardinality&&(i.cardinality=s.cardinality);const r=an(s.value);r?.type==="enumeration"&&Array.isArray(r.parameter)&&(r.parameter=r.parameter.map(String)),i.value=r,i.uri=s.uri,i.instructions=s.instructions,e.push(i)}return e},ix=(n,t)=>{const e=[];for(const s of t){const i=s.propertySet,r=s.baseName,o=an(i),a=an(r);if(!(a&&o))continue;const l=new GB(n,o,a);s.cardinality&&(l.cardinality=s.cardinality);const c=an(s.value);l.value=c,l.dataType=s.dataType,l.uri=s.uri,l.instructions=s.instructions,e.push(l)}return e},nx=(n,t)=>{const e=[];for(const s of t){const i=s.system,r=an(i);if(!r)continue;const o=new YB(n,r);s.cardinality&&(o.cardinality=s.cardinality);const a=an(s.value);a?.type==="simple"&&(a.parameter=String(a.parameter)),a?.type==="enumeration"&&Array.isArray(a.parameter)&&(a.parameter=a.parameter.map(String)),o.value=a,o.uri=s.uri,o.instructions=s.instructions,e.push(o)}return e},rx=(n,t)=>{const e=[];for(const s of t){const i=an(s.entity.name);if(!i)continue;const r=an(s.entity.predefinedType),o=new ZB(n,{name:i,predefinedType:r});o.relation=s.relation,s.cardinality&&(o.cardinality=s.cardinality),o.instructions=s.instructions,e.push(o)}return e},Av=class ly extends me{constructor(t){super(t),z(this,"enabled",!0),z(this,"list",new Sc),t.add(ly.uuid,this)}getModelIdMap(t){const e={},s={};for(const[i,r]of t){const o=[...r].filter(([,l])=>l.pass).map(([l])=>l);Qe.append(e,i,...o);const a=[...r].filter(([,l])=>!l.pass).map(([l])=>l);Qe.append(s,i,...a)}return{pass:e,fail:s}}create(t,e,s){const i=new XB(this.components,t,e);return s&&(i.identifier=s),this.list.set(i.identifier,i),i}load(t){const e=[],s=ly.xmlParser.parse(t).ids,{specifications:i}=s;if(i&&i.specification){const r=Array.isArray(i.specification)?i.specification:[i.specification];for(const o of r){const{name:a,ifcVersion:l,description:c,instructions:h,identifier:u}=o;if(!(a&&l))continue;const p=[],d=[],{applicability:g,requirements:m}=o;if(g){const{maxOccurs:_,...y}=g,v=Array.isArray(y)?y:[y];for(const w of v)for(const I in w){const C=Array.isArray(w[I])?w[I]:[w[I]];if(I==="entity"){const A=tx(this.components,C);p.push(...A)}if(I==="attribute"){const A=ex(this.components,C);p.push(...A)}if(I==="material"){const A=sx(this.components,C);p.push(...A)}if(I==="classification"){const A=nx(this.components,C);p.push(...A)}if(I==="property"){const A=ix(this.components,C);p.push(...A)}if(I==="partOf"){const A=rx(this.components,C);p.push(...A)}}}let b;if(m){const{maxOccurs:_,...y}=m;b=m.description;const v=Array.isArray(y)?y:[y];for(const w of v)for(const I in w){const C=Array.isArray(w[I])?w[I]:[w[I]];if(I==="entity"){const A=tx(this.components,C);d.push(...A)}if(I==="attribute"){const A=ex(this.components,C);d.push(...A)}if(I==="material"){const A=sx(this.components,C);d.push(...A)}if(I==="classification"){const A=nx(this.components,C);d.push(...A)}if(I==="property"){const A=ix(this.components,C);d.push(...A)}if(I==="partOf"){const A=rx(this.components,C);d.push(...A)}}}const f=this.create(a,l.split(/\s+/),u);f.description=c,f.instructions=h,f.requirementsDescription=b,f.applicability.add(...p),f.requirements.add(...d),e.push(f)}}return e}export(t,e=this.list.values()){const s=e??this.list;return`<ids xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://standards.buildingsmart.org/IDS http://standards.buildingsmart.org/IDS/1.0/ids.xsd" xmlns:ids="http://standards.buildingsmart.org/IDS">
  <!-- Made with That Open Engine ${HA.release} (https://github.com/thatopen/engine_components) -->
  <info>
    <title>${t.title}</title>
    ${t.copyright?`<copyright>${t.copyright}</copyright>`:""}
    ${t.version?`<version>${t.version}</version>`:""}
    ${t.description?`<description>${t.description}</description>`:""}
    ${t.author?`<author>${t.author}</author>`:""}
    ${t.date?`<date>${t.date.toISOString().split("T")[0]}</date>`:""}
    ${t.purpose?`<purpose>${t.purpose}</purpose>`:""}
    ${t.milestone?`<milestone>${t.milestone}</milestone>`:""}
  </info>
  <specifications>
    ${[...s].map(i=>i.serialize()).join(`
`)}
  </specifications>
</ids>`}};z(Av,"uuid","9f0b9f78-9b2e-481a-b766-2fbfd01f342c");z(Av,"xmlParser",new Og.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",ignoreAttributes:!1,ignoreDeclaration:!0,ignorePiTags:!0,numberParseOptions:{leadingZeros:!0,hex:!0},parseAttributeValue:!0,preserveOrder:!1,processEntities:!1,removeNSPrefix:!0,trimValues:!0}));let QB=Av;const KA=class JA extends me{constructor(t){super(t),z(this,"enabled",!0),t.add(JA.uuid,this)}static distanceFromPointToLine(t,e,s,i=!1){const r=new qt,o=new F;return r.set(e,s),r.closestPointToPoint(t,i,o),o.distanceTo(t)}round(t){t.x=Math.trunc(t.x*1e3)/1e3,t.y=Math.trunc(t.y*1e3)/1e3,t.z=Math.trunc(t.z*1e3)/1e3}async getVolumeFromFragments(t){return console.warn("getVolumeFromFragments is deprecated. Use getItemsVolume instead."),this.getItemsVolume(t)}async getItemsVolume(t){let e=0;const s=this.components.get(Mt);for(const[i,r]of Object.entries(t)){const o=s.list.get(i);o&&(e+=await o.getItemsVolume([...r]))}return e}static convertUnits(t,e,s,i=2){const r={m:1,cm:.01,mm:.001,km:1e3,m2:1,cm2:1e-4,mm2:1e-6,km2:1e6,m3:1,cm3:1e-6,mm3:1e-9,km3:1e9};if(!r[e]||!r[s])throw new Error("Invalid units provided for conversion.");if(!Number.isInteger(i)||i<0||i>5)throw new Error("Precision must be an integer between 0 and 5.");let o=r[e]/r[s];e.endsWith("2")&&s.endsWith("2")?o**=2:e.endsWith("3")&&s.endsWith("3")&&(o**=3);const a=t*o,l=10**i;return Math.round(a*l)/l}};z(KA,"uuid","267ca032-672f-4cb0-afa9-d24e904f39d6");let Oc=KA;const KB=class tS extends me{constructor(t){super(t),G(this,"enabled",!0),G(this,"inputs",["OBC","BUI"]),G(this,"_requestEventID","thatOpenCompanyComponentRequested"),G(this,"_createEventID","thatOpenCompanyComponentCreated"),t.add(tS.uuid,this)}async import(t){return new Promise(e=>{const s=document.createElement("script"),i=`
        function main() {
          const { ${this.inputs} } = window.ThatOpenCompany;
        
          ${t}
        
          const onComponentRequested = () => {
            window.removeEventListener("${this._requestEventID}", onComponentRequested);
            const event = new CustomEvent("${this._createEventID}", { detail: main });
            window.dispatchEvent(event);
          };
          
          window.addEventListener("${this._requestEventID}", onComponentRequested);
        }
        
        main();
      `,r=o=>{window.removeEventListener(this._createEventID,r);const a=o.detail,l=this.components.get(a);s.remove(),e(l)};s.addEventListener("load",()=>{window.addEventListener(this._createEventID,r),window.dispatchEvent(new Event(this._requestEventID))}),s.src=URL.createObjectURL(new File([i],"temp.js")),document.head.appendChild(s)})}};G(KB,"uuid","74c0c370-1af8-4ca9-900a-4a4196c0f2f5");let eS=class extends Oi{constructor(t=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=t,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new Ut(.5,.5),this.addEventListener("removed",function(){this.traverse(function(e){e.element instanceof e.element.ownerDocument.defaultView.Element&&e.element.parentNode!==null&&e.element.remove()})})}copy(t,e){return super.copy(t,e),this.element=t.element.cloneNode(!0),this.center=t.center,this}};const Gl=new F,ox=new xt,ax=new xt,lx=new F,cx=new F;let JB=class{constructor(t={}){const e=this;let s,i,r,o;const a={objects:new WeakMap},l=t.element!==void 0?t.element:document.createElement("div");l.style.overflow="hidden",this.domElement=l,this.getSize=function(){return{width:s,height:i}},this.render=function(g,m){g.matrixWorldAutoUpdate===!0&&g.updateMatrixWorld(),m.parent===null&&m.matrixWorldAutoUpdate===!0&&m.updateMatrixWorld(),ox.copy(m.matrixWorldInverse),ax.multiplyMatrices(m.projectionMatrix,ox),h(g,g,m),d(g)},this.setSize=function(g,m){s=g,i=m,r=s/2,o=i/2,l.style.width=g+"px",l.style.height=m+"px"};function c(g){g.isCSS2DObject&&(g.element.style.display="none");for(let m=0,b=g.children.length;m<b;m++)c(g.children[m])}function h(g,m,b){if(g.visible===!1){c(g);return}if(g.isCSS2DObject){Gl.setFromMatrixPosition(g.matrixWorld),Gl.applyMatrix4(ax);const f=Gl.z>=-1&&Gl.z<=1&&g.layers.test(b.layers)===!0,_=g.element;_.style.display=f===!0?"":"none",f===!0&&(g.onBeforeRender(e,m,b),_.style.transform="translate("+-100*g.center.x+"%,"+-100*g.center.y+"%)translate("+(Gl.x*r+r)+"px,"+(-Gl.y*o+o)+"px)",_.parentNode!==l&&l.appendChild(_),g.onAfterRender(e,m,b));const y={distanceToCameraSquared:u(b,g)};a.objects.set(g,y)}for(let f=0,_=g.children.length;f<_;f++)h(g.children[f],m,b)}function u(g,m){return lx.setFromMatrixPosition(g.matrixWorld),cx.setFromMatrixPosition(m.matrixWorld),lx.distanceToSquared(cx)}function p(g){const m=[];return g.traverseVisible(function(b){b.isCSS2DObject&&m.push(b)}),m}function d(g){const m=p(g).sort(function(f,_){if(f.renderOrder!==_.renderOrder)return _.renderOrder-f.renderOrder;const y=a.objects.get(f).distanceToCameraSquared,v=a.objects.get(_).distanceToCameraSquared;return y-v}),b=m.length;for(let f=0,_=m.length;f<_;f++)m[f].element.style.zIndex=b-f}}},ka=class{constructor(t,e,s){G(this,"three"),G(this,"world"),G(this,"onDisposed",new yt),this.world=t;let i;if(e)i=e;else{i=document.createElement("div");const r="6px";i.style.color="white",i.style.height=r,i.style.width=r,i.style.borderRadius="50%",i.style.border="2px solid rgb(122, 75, 209)",i.style.zIndex="-20"}this.three=new eS(i),(s||t.scene.three).add(this.three),this.visible=!0}set visible(t){this.three.visible=t}get visible(){return this.three.visible}toggleVisibility(){this.visible=!this.visible}notDisplay(){this.visible=!1}dispose(){this.three.removeFromParent(),this.three.element.remove(),this.onDisposed.trigger(),this.onDisposed.reset()}},tU=class extends dz{constructor(t,e,s){super(t,e,s),G(this,"three2D",new JB),this.onAfterUpdate.add(()=>{if(this.onBeforeUpdate.trigger(this),!this.enabled||!this.currentWorld)return;const i=this.currentWorld.scene.three,r=this.currentWorld.camera.three;i instanceof mC&&this.three2D.render(i,r)}),this.onDisposed.add(()=>{this.three2D.domElement.remove()}),this.onResize.add(({x:i,y:r})=>{this.three2D.setSize(i,r)}),this.setupHtmlRenderer(),this.resize()}setupHtmlRenderer(){this.three2D.domElement.style.position="absolute",this.three2D.domElement.style.top="0px",this.three2D.domElement.style.pointerEvents="none",this.container&&(this.container.appendChild(this.three2D.domElement),this.container.style.position="relative")}};const eU=class sS extends me{constructor(t){super(t),G(this,"onDisposed",new yt),G(this,"enabled",!0),G(this,"threshold",50),G(this,"autoCluster",!0),G(this,"list",new Map),G(this,"clusterLabels",new Set),G(this,"currentKeys",new Set),G(this,"_color","white"),G(this,"_markerKey",0),G(this,"_clusterKey",0),G(this,"_worldEvents",new Map),G(this,"_setupWorlds",new Set),t.add(sS.uuid,this)}get color(){return this._color}set color(t){this._color=t;for(const[e,s]of this.list)for(const[i,r]of s)r.label.three.element.style.color=t}create(t,e,s,i=!1){this.setupEvents(t,!0);const r=this._markerKey.toString(),o=this.getWorldMarkerList(t);if(o.has(r))return null;const a=document.createElement("span");a.append(e);const l=new ka(t,a);return l.three.position.copy(s),o.set(r,{key:r,label:l,merged:!1,static:i}),this._markerKey++,r}delete(t){for(const[e,s]of this.list){const i=s.get(t);i&&i.label.dispose(),s.delete(t)}}getWorldMarkerList(t){return this.list.has(t.uuid)||this.list.set(t.uuid,new Map),this.list.get(t.uuid)}dispose(t){for(const[e,s]of this.list){const i=[...s.keys()];for(const r of i){const o=s.get(r);t&&o.type!==t||(o.label.dispose(),s.delete(r))}}if(!t){this.list.clear(),this._markerKey=0;for(const e of this.clusterLabels)e.label.dispose();this.clusterLabels.clear(),this._clusterKey=0,this.currentKeys.clear()}this.onDisposed.trigger()}setupEvents(t,e){if(e&&this._setupWorlds.has(t.uuid)||!t.camera.hasCameraControls())return;const s=this.getWorldEvent(t);t.camera.controls.removeEventListener("sleep",s),t.camera.controls.removeEventListener("rest",s),e&&(t.camera.controls.addEventListener("sleep",s),t.camera.controls.addEventListener("rest",s))}cluster(t){if(!this.autoCluster)return;this.resetMarkers();const e=this.list.get(t.uuid);if(e){for(const[s,i]of e)if(!i.merged&&!i.static){this.currentKeys.clear();for(const[r,o]of e)o.static||i.key!==o.key&&!o.merged&&this.distance(i.label,o.label)<this.threshold&&(this.currentKeys.add(o.key),o.merged=!0);if(this.currentKeys.size>0){this.currentKeys.add(i.key),i.merged=!0;const r=Array.from(this.currentKeys),o=this.getAveragePositionFromLabels(r),a=new ka(i.label.world,this.createClusterElement(this._clusterKey.toString())),{element:l}=a.three;l.textContent=r.length.toString(),a.three.position.copy(o),this.clusterLabels.add({key:this._clusterKey.toString(),markerKeys:r,label:a}),this._clusterKey++}}this.removeMergeMarkers(t)}}getWorldEvent(t){if(!this._worldEvents.has(t.uuid)){const e=()=>{this.cluster(t)};this._worldEvents.set(t.uuid,e)}return this._worldEvents.get(t.uuid)}resetMarkers(){for(const[t,e]of this.list)for(const[s,i]of e)i.merged=!1;for(const t of this.clusterLabels)t.label.dispose();this.clusterLabels.clear(),this._clusterKey=0}removeMergeMarkers(t){const e=this.list.get(t.uuid);if(e){for(const[s,i]of e)i.merged?i.label.dispose():i.label.world.scene.three.add(i.label.three);for(const s of this.clusterLabels)if(s.markerKeys.length===1){for(const[i,r]of this.list){const o=r.get(s.markerKeys[0]);o&&(o.label.world.scene.three.add(o.label.three),o.merged=!1)}s.label.dispose(),this.clusterLabels.delete(s)}}}getAveragePositionFromLabels(t){const e=t.map(s=>{for(const[i,r]of this.list){const o=r.get(s);if(o)return o.label.three.position}return new F});return e.reduce((s,i)=>s.add(i),new F).divideScalar(e.length)}createClusterElement(t){const e=document.createElement("div");return e.textContent=t,e.style.color="#000000",e.style.background="#FFFFFF",e.style.fontSize="1.2rem",e.style.fontWeight="500",e.style.pointerEvents="auto",e.style.borderRadius="50%",e.style.padding="5px 11px",e.style.textAlign="center",e.style.cursor="pointer",e.addEventListener("pointerdown",()=>{this.navigateToCluster(t)}),e.addEventListener("pointerover",()=>{e.style.background="#BCF124"}),e.addEventListener("pointerout",()=>{e.style.background="#FFFFFF"}),e}getScreenPosition(t){const e=new F;if(!t.world.renderer)throw new Error("Renderer not found!");const s=t.three.position.clone();s.project(t.world.camera.three);const i=t.world.renderer.getSize();return e.x=s.x*i.x/2+i.x/2,e.y=-(s.y*i.y/2)+i.y/2,e}distance(t,e){const s=this.getScreenPosition(t),i=this.getScreenPosition(e),r=s.x-i.x,o=s.y-i.y,a=Math.sqrt(r*r+o*o)*.5;return a===0?this.threshold+1:a}navigateToCluster(t){const e=[],s=Array.from(this.clusterLabels).find(c=>c.key===t);if(!s)return;const i=s.label.world.camera;if(!i.hasCameraControls()){console.warn("Zoom to clusters only supported with Camera Controls!");return}for(const c of s.markerKeys)for(const[h,u]of this.list){const p=u.get(c);if(p){const{x:d,y:g,z:m}=p.label.three.position;e.push(d,g,m)}}s.label.dispose(),this.clusterLabels.delete(s);const r=new Ce,o=new Float32Array(e),a=new ze(o,3);r.setAttribute("position",a);const l=new ht(r);l.geometry.computeBoundingSphere(),l.geometry.boundingSphere&&i.controls.fitToSphere(l,!0),r.dispose(),l.clear(),e.length=0}};G(eU,"uuid","4079eb91-79b0-4ede-bcf2-15b837129236");new sl(-1,1,1,-1,0,1);let sU=class extends Ce{constructor(){super(),this.setAttribute("position",new Si([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Si([0,2,0,0,2,0],2))}};new sU;new Ut,new xt,new xt,new xt,new F(-1,-1,-1),new F(1,1,1);iU(16,2,1),new Ut,new xt;function iU(n,t,e){const s=nU(n,t,e);let i="vec3[SAMPLES](";for(let r=0;r<n;r++){const o=s[r];i+=`vec3(${o.x}, ${o.y}, ${o.z})${r<n-1?",":")"}`}return i}function nU(n,t,e){const s=[];for(let i=0;i<n;i++){const r=2*Math.PI*t*i/n,o=Math.pow(i/(n-1),e);s.push(new F(Math.cos(r),Math.sin(r),o))}return s}new Ut(1/1024,1/512);new Ut(1/1024,1/512);new Ut(1/1024,1/512);const hx=new Tt,zf=new F;let Sv=class extends jy{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const t=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],e=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],s=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(s),this.setAttribute("position",new Si(t,3)),this.setAttribute("uv",new Si(e,2))}applyMatrix4(t){const e=this.attributes.instanceStart,s=this.attributes.instanceEnd;return e!==void 0&&(e.applyMatrix4(t),s.applyMatrix4(t),e.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(t){let e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));const s=new ja(e,6,1);return this.setAttribute("instanceStart",new ri(s,3,0)),this.setAttribute("instanceEnd",new ri(s,3,3)),this.instanceCount=this.attributes.instanceStart.count,this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(t){let e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));const s=new ja(e,6,1);return this.setAttribute("instanceColorStart",new ri(s,3,0)),this.setAttribute("instanceColorEnd",new ri(s,3,3)),this}fromWireframeGeometry(t){return this.setPositions(t.attributes.position.array),this}fromEdgesGeometry(t){return this.setPositions(t.attributes.position.array),this}fromMesh(t){return this.fromWireframeGeometry(new aC(t.geometry)),this}fromLineSegments(t){const e=t.geometry;return this.setPositions(e.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Tt);const t=this.attributes.instanceStart,e=this.attributes.instanceEnd;t!==void 0&&e!==void 0&&(this.boundingBox.setFromBufferAttribute(t),hx.setFromBufferAttribute(e),this.boundingBox.union(hx))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Us),this.boundingBox===null&&this.computeBoundingBox();const t=this.attributes.instanceStart,e=this.attributes.instanceEnd;if(t!==void 0&&e!==void 0){const s=this.boundingSphere.center;this.boundingBox.getCenter(s);let i=0;for(let r=0,o=t.count;r<o;r++)zf.fromBufferAttribute(t,r),i=Math.max(i,s.distanceToSquared(zf)),zf.fromBufferAttribute(e,r),i=Math.max(i,s.distanceToSquared(zf));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}};Lr.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Ut(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};So.line={uniforms:Nd.merge([Lr.common,Lr.fog,Lr.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};let Ov=class extends Dd{constructor(t){super({type:"LineMaterial",uniforms:Nd.clone(So.line.uniforms),vertexShader:So.line.vertexShader,fragmentShader:So.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(t)}get color(){return this.uniforms.diffuse.value}set color(t){this.uniforms.diffuse.value=t}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(t){t===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(t){this.uniforms.linewidth&&(this.uniforms.linewidth.value=t)}get dashed(){return"USE_DASH"in this.defines}set dashed(t){t===!0!==this.dashed&&(this.needsUpdate=!0),t===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(t){this.uniforms.dashScale.value=t}get dashSize(){return this.uniforms.dashSize.value}set dashSize(t){this.uniforms.dashSize.value=t}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(t){this.uniforms.dashOffset.value=t}get gapSize(){return this.uniforms.gapSize.value}set gapSize(t){this.uniforms.gapSize.value=t}get opacity(){return this.uniforms.opacity.value}set opacity(t){this.uniforms&&(this.uniforms.opacity.value=t)}get resolution(){return this.uniforms.resolution.value}set resolution(t){this.uniforms.resolution.value.copy(t)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(t){this.defines&&(t===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),t===!0?this.defines.USE_ALPHA_TO_COVERAGE="":delete this.defines.USE_ALPHA_TO_COVERAGE)}};const P_=new un,ux=new F,dx=new F,xs=new un,Is=new un,Zn=new un,R_=new F,F_=new xt,As=new qt,px=new F,Bf=new Tt,Uf=new Us,Xn=new un;let hr,za;function fx(n,t,e){return Xn.set(0,0,-t,1).applyMatrix4(n.projectionMatrix),Xn.multiplyScalar(1/Xn.w),Xn.x=za/e.width,Xn.y=za/e.height,Xn.applyMatrix4(n.projectionMatrixInverse),Xn.multiplyScalar(1/Xn.w),Math.abs(Math.max(Xn.x,Xn.y))}function rU(n,t){const e=n.matrixWorld,s=n.geometry,i=s.attributes.instanceStart,r=s.attributes.instanceEnd,o=Math.min(s.instanceCount,i.count);for(let a=0,l=o;a<l;a++){As.start.fromBufferAttribute(i,a),As.end.fromBufferAttribute(r,a),As.applyMatrix4(e);const c=new F,h=new F;hr.distanceSqToSegment(As.start,As.end,h,c),h.distanceTo(c)<za*.5&&t.push({point:h,pointOnLine:c,distance:hr.origin.distanceTo(h),object:n,face:null,faceIndex:a,uv:null,uv1:null})}}function oU(n,t,e){const s=t.projectionMatrix,i=n.material.resolution,r=n.matrixWorld,o=n.geometry,a=o.attributes.instanceStart,l=o.attributes.instanceEnd,c=Math.min(o.instanceCount,a.count),h=-t.near;hr.at(1,Zn),Zn.w=1,Zn.applyMatrix4(t.matrixWorldInverse),Zn.applyMatrix4(s),Zn.multiplyScalar(1/Zn.w),Zn.x*=i.x/2,Zn.y*=i.y/2,Zn.z=0,R_.copy(Zn),F_.multiplyMatrices(t.matrixWorldInverse,r);for(let u=0,p=c;u<p;u++){if(xs.fromBufferAttribute(a,u),Is.fromBufferAttribute(l,u),xs.w=1,Is.w=1,xs.applyMatrix4(F_),Is.applyMatrix4(F_),xs.z>h&&Is.z>h)continue;if(xs.z>h){const f=xs.z-Is.z,_=(xs.z-h)/f;xs.lerp(Is,_)}else if(Is.z>h){const f=Is.z-xs.z,_=(Is.z-h)/f;Is.lerp(xs,_)}xs.applyMatrix4(s),Is.applyMatrix4(s),xs.multiplyScalar(1/xs.w),Is.multiplyScalar(1/Is.w),xs.x*=i.x/2,xs.y*=i.y/2,Is.x*=i.x/2,Is.y*=i.y/2,As.start.copy(xs),As.start.z=0,As.end.copy(Is),As.end.z=0;const d=As.closestPointToPointParameter(R_,!0);As.at(d,px);const g=kd.lerp(xs.z,Is.z,d),m=g>=-1&&g<=1,b=R_.distanceTo(px)<za*.5;if(m&&b){As.start.fromBufferAttribute(a,u),As.end.fromBufferAttribute(l,u),As.start.applyMatrix4(r),As.end.applyMatrix4(r);const f=new F,_=new F;hr.distanceSqToSegment(As.start,As.end,_,f),e.push({point:_,pointOnLine:f,distance:hr.origin.distanceTo(_),object:n,face:null,faceIndex:u,uv:null,uv1:null})}}}let iS=class extends ht{constructor(t=new Sv,e=new Ov({color:Math.random()*16777215})){super(t,e),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const t=this.geometry,e=t.attributes.instanceStart,s=t.attributes.instanceEnd,i=new Float32Array(2*e.count);for(let o=0,a=0,l=e.count;o<l;o++,a+=2)ux.fromBufferAttribute(e,o),dx.fromBufferAttribute(s,o),i[a]=a===0?0:i[a-1],i[a+1]=i[a]+ux.distanceTo(dx);const r=new ja(i,2,1);return t.setAttribute("instanceDistanceStart",new ri(r,1,0)),t.setAttribute("instanceDistanceEnd",new ri(r,1,1)),this}raycast(t,e){const s=this.material.worldUnits,i=t.camera;i===null&&!s&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const r=t.params.Line2!==void 0&&t.params.Line2.threshold||0;hr=t.ray;const o=this.matrixWorld,a=this.geometry,l=this.material;za=l.linewidth+r,a.boundingSphere===null&&a.computeBoundingSphere(),Uf.copy(a.boundingSphere).applyMatrix4(o);let c;if(s)c=za*.5;else{const u=Math.max(i.near,Uf.distanceToPoint(hr.origin));c=fx(i,u,l.resolution)}if(Uf.radius+=c,hr.intersectsSphere(Uf)===!1)return;a.boundingBox===null&&a.computeBoundingBox(),Bf.copy(a.boundingBox).applyMatrix4(o);let h;if(s)h=za*.5;else{const u=Math.max(i.near,Bf.distanceToPoint(hr.origin));h=fx(i,u,l.resolution)}Bf.expandByScalar(h),hr.intersectsBox(Bf)!==!1&&(s?rU(this,e):oU(this,i,e))}onBeforeRender(t){const e=this.material.uniforms;e&&e.resolution&&(t.getViewport(P_),this.material.uniforms.resolution.value.set(P_.z,P_.w))}},aU=class{constructor(t,e){G(this,"_components"),G(this,"_modelStyleGeometries",new Yt),G(this,"onDisposed",new yt),G(this,"three",new Fn),G(this,"plane"),G(this,"items",new Yt),G(this,"world",null),G(this,"_visible",!1),this._components=t,this.plane=e,this.setupEvents()}set visible(t){t?this.world&&(this.world.scene.three.add(this.three),this._visible=!0):(this.three.removeFromParent(),this._visible=!1)}get visible(){return this._visible}setupEvents(){const t=this._components.get(L_);this.items.guard=(e,{style:s})=>!!t.styles.get(s),this.items.onItemSet.add(({value:e})=>{const{style:s,data:i}=e;this.create(s,i)})}getStyleMeshes(t,e){const s=this._components.get(L_).styles.get(e);if(!s)throw new Error(`ClipStyler: "${e}" style not found.`);const i=this._components.get(Mt).list.get(t);if(!i)throw new Error(`ClipEdges: model with id "${t}" not found.`);const{linesMaterial:r,fillsMaterial:o}=s;let a=this._modelStyleGeometries.get(t);a||(a=new Yt,this._modelStyleGeometries.set(t,a));let l=a.get(e);if(!l){let c;r&&(c=new iS(new Sv,r),c.frustumCulled=!1,i&&c.applyMatrix4(i.object.matrixWorld),this.three.add(c));let h;o&&(h=new ht(new Ce,o),i&&h.applyMatrix4(i.object.matrixWorld),this.three.add(h)),l={edges:c,fills:h},a.set(e,l)}return l}async updateMeshes(t,e,s){const i=this._components.get(Mt).list.get(t);if(!i)return;const r=this._components.get(mr),o=this.plane.clone();o.constant-=.01;const a=await i.getSection(o,s),{buffer:l,index:c,fillsIndices:h}=a,u=this.getStyleMeshes(t,e),{edges:p,fills:d}=u,g=new ze(l,3,!1);if(p){g.setUsage(o3);const m=new Ce;m.setAttribute("position",g),m.setDrawRange(0,c);const b=new Gy(m);p.geometry.fromLineSegments(b),r.destroy(b)}d&&(d.geometry.attributes.position=g,d.geometry.setIndex(h))}async create(t,e){if(!this._components.get(L_).styles.get(t))throw new Error(`ClipEdges: "${t}" style not found.`);const s=this._components.get(cz);let i=null;e&&(i=await s.find(e));const r=this._components.get(Mt);if(i)for(const[o,a]of Object.entries(i))r.list.get(o)&&this.updateMeshes(o,t,[...a]);else for(const[o]of r.list)this.updateMeshes(o,t)}async update(t){for(const[e,{data:s,style:i}]of this.items)t&&!t.includes(e)||this.create(i,s)}dispose(){this._components.get(mr).destroy(this.three,!0,!0),this._modelStyleGeometries.clear()}};const nS=class cy extends me{constructor(t){super(t),G(this,"onDisposed",new yt),G(this,"enabled",!0),G(this,"world",null),G(this,"styles",new Yt),G(this,"list",new Yt),G(this,"_visible",!0),this.components.list.set(cy.uuid,this),this.setEvents()}get visible(){return this._visible}set visible(t){this._visible=t;for(const[,e]of this.list)e.visible=t}setEvents(){this.list.onBeforeDelete.add(({value:t})=>t.dispose())}setEdgesConfig(t,e){if(t.world=e?.world??this.world,e!=null&&e.items)for(const[i,r]of Object.entries(e.items))t.items.set(i,r);const s=e?.id??Ps.create();this.list.set(s,t)}create(t,e){const s=new aU(this.components,t);return e&&this.setEdgesConfig(s,e),s}createFromView(t,e){const s=this.create(t.plane,e);return(e?.link===void 0||e.link)&&(t.onDisposed.add(()=>s.dispose()),t.onUpdated.add(()=>s.update()),t.onStateChanged.add(()=>s.visible=t.open)),s}createFromClipping(t,e){const s=this.components.get(yo).list.get(t);if(!s)throw new Error(`ClipStyler: Clipping plane with ID ${t} not found.`);const i=this.create(s.three,e);return i.visible=!0,(e?.link===void 0||e.link)&&(s.onDraggingEnded.add(()=>i.update()),s.onDisposed.add(()=>i.dispose())),i}dispose(){this.styles.clear(),this.list.clear(),this.onDisposed.trigger(cy.uuid)}};G(nS,"uuid","24dfc306-a3c4-410f-8071-babc4afa5e4d");let L_=nS;const rS=class hy extends me{constructor(t){super(t),G(this,"onDisposed",new yt),G(this,"onBeforeUpdate",new yt),G(this,"onAfterUpdate",new yt),G(this,"onSetup",new yt),G(this,"isSetup",!1),G(this,"enabled",!0),G(this,"events",{}),G(this,"multiple","ctrlKey"),G(this,"zoomFactor",1.5),G(this,"zoomToSelection",!1),G(this,"backupColor",null),G(this,"selection",{}),G(this,"config",{selectName:"select",selectionColor:null,autoHighlightOnClick:!0,world:null,selectEnabled:!0,selectMaterialDefinition:{color:new Dt("#BCF124"),renderedFaces:il.ONE,opacity:1,transparent:!1}}),G(this,"styles",new Yt),G(this,"autoToggle",new Set),G(this,"mouseDownPosition",{x:0,y:0}),G(this,"mouseMoveThreshold",5),G(this,"selectable",{}),G(this,"eventManager",new iz),G(this,"_mouseState",{down:!1,moved:!1}),G(this,"_fromHighlight",!1),G(this,"restorePreviousColors",(e=this.selection.select)=>{for(const[s,i]of Object.entries(this.selection))if(!(s===this.config.selectName||!this.styles.get(s)))for(const[r,o]of Object.entries(e)){const a=i[r];if(!a)continue;const l=[...o].filter(c=>a.has(c));l.length!==0&&new Set(l)}}),G(this,"onMouseDown",e=>{this.enabled&&(this.debounceTimeout&&clearTimeout(this.debounceTimeout),this.mouseDownPosition={x:e.clientX,y:e.clientY},this._mouseState.down=!0)}),G(this,"debounceTimeout",null),G(this,"onMouseUp",async e=>{if(!this.enabled)return;const{world:s,autoHighlightOnClick:i,selectEnabled:r}=this.config;if(!s)throw new Error("No world found!");if(!s.renderer)throw new Error("This world doesn't have a renderer!");if(e.target===s.renderer.three.domElement){if(this._mouseState.down=!1,this._mouseState.moved||e.button!==0){this._mouseState.moved=!1;return}if(this._mouseState.moved=!1,i&&r){const o=this.multiple==="none"?!0:!e[this.multiple];await this.highlight(this.config.selectName,o,this.zoomToSelection)}}}),G(this,"onMouseMove",async e=>{if(!this.enabled)return;const s=e.clientX-this.mouseDownPosition.x,i=e.clientY-this.mouseDownPosition.y,r=Math.sqrt(s*s+i*i);this._mouseState.moved||r>this.mouseMoveThreshold&&(this._mouseState.moved=this._mouseState.down)}),this.components.add(hy.uuid,this),this.eventManager.list.add(this.onSetup),this.eventManager.list.add(this.onDisposed),this.setStyleEvents()}setStyleEvents(){this.styles.onBeforeDelete.add(async({key:t})=>{if(await this.clear(t),delete this.selection[t],!(t in this.events))return;const{onClear:e,onHighlight:s,onBeforeHighlight:i}=this.events[t];this.eventManager.list.delete(e),this.eventManager.list.delete(s),this.eventManager.list.delete(i),delete this.events[t]}),this.styles.onItemSet.add(({key:t})=>{this.selection[t]={};const e=new yt,s=new yt,i=new yt;this.events[t]={onHighlight:e,onClear:i,onBeforeHighlight:s},this.eventManager.add([i,e,s])})}async dispose(){this.setupEvents(!1),this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.selection={},this.styles.clear(),this.onDisposed.trigger(hy.uuid),this.eventManager.reset(),this.isSetup=!1}add(t){if(console.warn("highlighter.add() is deprecated, use highlighter.styles.set() instead"),typeof t=="string")this.styles.set(t,null);else{const{customId:e}=t;this.styles.set(e,t)}}async remove(t){console.warn("highlighter.remove() is deprecated, use highlighter.styles.delete() instead"),this.styles.delete(t)}async highlight(t,e=!0,s=this.zoomToSelection,i=null){if(!this.enabled)return;if(!this.config.world)throw new Error("No world found in config!");const r=this.config.world;if(!this.selection[t])throw new Error(`Selection ${t} does not exist.`);const o=await this.components.get(ln).get(r).castRay();if(!o||o.localId===void 0||o.localId===null){e&&this.clear(t);return}const{localId:a,fragments:{modelId:l}}=o,c={[l]:new Set([a])};await this.highlightByID(t,c,e,s,i,!0)}async highlightByID(t,e,s=!0,i=this.zoomToSelection,r=null,o=!1){var a;if(!this.enabled)return;this._fromHighlight=!0,this.events[t].onBeforeHighlight.trigger(this.selection[t]),s&&await this.clear(t);let l={};if(Object.keys(this.selectable).length!==0||r!==null)for(const c in e){const h=new Set(e[c]),u=(a=this.selectable)==null?void 0:a[t],p=u?u[c]:void 0,d=p?new Set(p):void 0,g=r?.[c],m=g?new Set(g):void 0;if(m||d)for(const b of h){if(m&&m.has(b)||d&&!d.has(b))continue;let f=l[c];f||(f=new Set,l[c]=f),f.add(b)}}else l=e;if(o&&this.autoToggle.has(t)){const c={};let h=!1;for(const u in l){const p=this.selection[t][u];if(!p)continue;const d=l[u];for(const g of d)if(p.has(g)){p.delete(g);let m=c[u];m||(m=new Set,c[u]=m),m.add(g),h=!0}else p.add(g);l[u]=p}h&&(this.events[t].onClear.trigger(c),t===this.config.selectName&&this.restorePreviousColors(c))}this.updateStyleMap(t,l),this.events[t].onHighlight.trigger(this.selection[t]),this._fromHighlight=!1,await this.updateColors(),i&&await this.zoomSelection(l)}async updateColors(){const t=this.components.get(Mt),e=[t.resetHighlight()];for(const[s,i]of Object.entries(this.selection)){const r=this.styles.get(s);if(!r)continue;const o=s==="select"||!this.styles.get(this.config.selectName)?i:this.getMapWithoutSelection(s);o&&e.push(t.highlight({...r,customId:s},o))}e.push(t.core.update(!0)),await Promise.allSettled(e)}updateStyleMap(t,e){const s=this.selection[t];for(const i in e){let r=s[i];r||(r=new Set,s[i]=r);const o=e[i];for(const a of o)r.add(a)}if(t!==this.config.selectName)for(const[i,r]of Object.entries(this.selection)){if(i===this.config.selectName||i===t)continue;const o=r;for(const[a,l]of Object.entries(s)){const c=o[a];if(c)for(const h of l)c.delete(h)}}}getMapWithoutSelection(t,e){const s=this.selection[t];if(!s)throw new Error(`Style ${t} does not exist.`);const i=this.selection[this.config.selectName]??{},r={};for(const o in s){const a=s[o],l=t===this.config.selectName?new Set:i[o]??new Set,c=Array.from(a).filter(h=>{var u;return!l.has(h)&&(!e||((u=e[o])==null?void 0:u.has(h)))});c.length>0&&(r[o]=new Set(c))}return Object.keys(r).length>0?r:null}async clear(t,e){const s=t?[t]:Object.keys(this.selection),i=e??void 0;for(const r of s){const o=this.selection[r]??{},a=i??o;r===this.config.selectName&&this.restorePreviousColors();const l={};for(const[c,h]of Object.entries(a)){const u=o[c];if(u)for(const p of h){if(!u.delete(p))continue;let d=l[c];d||(d=new Set,l[c]=d),d.add(p)}}Object.keys(l).length>0&&this.events[r].onClear.trigger(l)}this._fromHighlight||await this.updateColors()}setup(t){if(this.isSetup)return;this.config={...this.config,...t};const{selectName:e,selectionColor:s,selectMaterialDefinition:i}=this.config;i?(s&&(console.warn("highlighter.config.selectionColor is deprecated, use selectMaterialDefinition instead"),i.color=s),this.styles.set(e,i)):this.styles.set(e,null),this.autoToggle.add(this.config.selectName),this.setupEvents(!0),this.enabled=!0,this.isSetup=!0,this.onSetup.trigger(this)}async zoomSelection(t){if(!this.config.world)throw new Error("No world found in config!");const e=this.config.world;let s=!1;for(const m in t)if(t[m].size>0){s=!0;break}if(!s||!e.camera.hasCameraControls())return;const i=await this.components.get(Mt).getBBoxes(t),r=new Us,o=new Tt;for(const m of i)o.union(m);o.getBoundingSphere(r);const a=1/0,l=-1/0,{x:c,y:h,z:u}=r.center,p=r.radius===a||c===a||h===a||u===a,d=r.radius===l||c===l||h===l||u===l,g=r.radius===0;p||d||g||(r.radius*=this.zoomFactor,await e.camera.controls.fitToSphere(r,!0))}setupEvents(t){if(!this.config.world){console.log("No world found while setting up events!");return}if(this.config.world.isDisposing)return;if(!this.config.world.renderer)throw new Error("The given world doesn't have a renderer!");const e=this.config.world.renderer.three.domElement;e.removeEventListener("mousedown",this.onMouseDown),e.removeEventListener("mouseup",this.onMouseUp),e.removeEventListener("pointermove",this.onMouseMove),t&&(e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("mouseup",this.onMouseUp),e.addEventListener("pointermove",this.onMouseMove))}};G(rS,"uuid","cb8a76f2-654a-4b50-80c6-66fd83cafd77");let Gu=rS;const oS=class aS extends me{constructor(){super(...arguments),G(this,"enabled",!0),G(this,"geometries",new Yt),G(this,"onDisposed",new yt)}async get(t,e){const{material:s,applyTransformation:i}={applyTransformation:!0,...e},r=this.components.get(Mt),o=new Yt;for(const[a,l]of Object.entries(t)){const c=r.list.get(a);if(!c)continue;const h=this.getModelMeshes(a);for(const u of l){let p=o.get(a);p||(p=new Yt,o.set(a,p));let d=h.get(u);if(d&&d.length>0){const b=[];for(const[f,{geometry:_,transform:y}]of d.entries()){const v=await this.createMesh(c,_,y,{material:s,applyTransformation:i});b.push(v)}p.set(u,b);continue}else d=[],h.set(u,d);const[g]=await c.getItemsGeometry([u]);if(!g)continue;const m=[];for(const b of g){const f=this.createGeometry(b);if(!f)continue;const{geometry:_,transform:y}=f;d.push(f);const v=await this.createMesh(c,_,y,{material:s,applyTransformation:i});m.push(v)}p.set(u,m)}}return o}getModelMeshes(t){let e=this.geometries.get(t);return e||(e=new Yt,this.geometries.set(t,e)),e}remove(t=[...this.geometries.keys()]){for(const e of t){const s=this.geometries.get(e);if(s){for(const[i,r]of s)for(const{geometry:o}of r)o.dispose();this.geometries.delete(e)}}}dispose(t=!0){this.remove(),t&&this.geometries.dispose(),this.onDisposed.trigger(aS.uuid)}getMeshesFromResult(t){const e=[];for(const s of t.values())for(const i of s.values())e.push(...i);return e}createGeometry(t){const{positions:e,indices:s,normals:i,transform:r}=t;if(!(e&&s&&i))return null;const o=new Ce;return o.setAttribute("position",new ze(e,3)),o.setAttribute("normal",new ze(i,3,!0)),o.setIndex(new ze(s,1)),{geometry:o,transform:r}}async createMesh(t,e,s,i){const{material:r,applyTransformation:o}={applyTransformation:!0,...i},a=new ht(e,r);return a.applyMatrix4(s),a.applyMatrix4(t.object.matrixWorld),o||(a.position.set(0,0,0),a.rotation.set(0,0,0)),a}};G(oS,"uuid","ab45d0a7-feea-4afc-927c-80832dae76dd");let zm=oS;const lU=class uy extends me{constructor(t){super(t),G(this,"_world"),G(this,"styles",new fe),G(this,"outlinePositions",!1),G(this,"_mesh",null),G(this,"onDisposed",new yt),G(this,"_meshes",[]),G(this,"_map",{}),G(this,"_activeStyles",new Set),G(this,"_styleCallbacks",{}),t.add(uy.uuid,this),this.setupEvents()}set world(t){this._world=t,t&&this.getRenderer().postproduction.excludedObjectsPass.addExcludedMaterial(this._points.material)}get world(){return this._world}get _points(){return this._mesh||(this._mesh=new oC(new Ce,new Z_({size:10,sizeAttenuation:!1,depthTest:!1}))),this._mesh}get enabled(){return!this.world||this.world.isDisposing?!1:this.getRenderer().postproduction.outlinesEnabled}set enabled(t){if(!this.world||this.world.isDisposing)return;const e=this.getRenderer();e.postproduction.outlinesEnabled=t,this.outlinePositions&&(this._points.material.color=this.color,this.world.scene.three.add(this._points))}get color(){return this.getRenderer().postproduction.outlinePass.outlineColor}set color(t){this.getRenderer().postproduction.outlinePass.outlineColor.copy(t),this._points.material.color.copy(t)}get thickness(){return this.getRenderer().postproduction.outlinePass.thickness}set thickness(t){this.getRenderer().postproduction.outlinePass.thickness=t}get fillColor(){return this.getRenderer().postproduction.outlinePass.fillColor}set fillColor(t){this.getRenderer().postproduction.outlinePass.fillColor.copy(t)}get fillOpacity(){return this.getRenderer().postproduction.outlinePass.fillOpacity}set fillOpacity(t){const e=this.getRenderer().postproduction;e.outlinePass.fillOpacity=t}setupEvents(){const t=this.components.get(Gu);this.styles.guard=e=>t.styles.has(e),this.styles.onItemAdded.add(e=>{const s=this.components.get(Gu),i=()=>{this._activeStyles.add(e),this.updateFromStyles()},r=()=>{this._activeStyles.delete(e),this.updateFromStyles()};this._styleCallbacks[e]={onHighlight:i,onClear:r},s.events[e].onHighlight.add(i),s.events[e].onClear.add(r)}),this.styles.onBeforeDelete.add(e=>{const{onHighlight:s,onClear:i}=this._styleCallbacks[e];t.events[e].onHighlight.remove(s),t.events[e].onClear.remove(i),this._activeStyles.delete(e),delete this._styleCallbacks[e]}),t.styles.onItemDeleted.add(e=>this.styles.delete(e))}async updateFromStyles(){const t=this.components.get(Gu),e=[];for(const i of this._activeStyles){const r=t.selection[i];r&&e.push(r)}const s=Qe.join(e);this._map=s,await this.update()}async update(t=this._map){if(t===this._map&&this.cleanMeshes(),this.outlinePositions&&this.updatePoints(),Object.keys(t).length===0)return;const e=this.components.get(Mt),s=this.getRenderer().postproduction.outlinePass,i=await this.components.get(zm).get(t);for(const r of Object.keys(t))if(e.list.get(r))for(const[o,a]of i.entries()){const l=[...a.values()].flat();for(const c of l)this._meshes.push(c),s.scene.add(c)}}async addItems(t){Qe.add(this._map,t),await this.update(t)}async removeItems(t){Qe.remove(this._map,t),await this.update()}clean(){this._map={},this._activeStyles.clear(),this.cleanMeshes(),this._mesh&&this.components.get(mr).destroy(this._mesh,!0,!0),this._mesh=null}dispose(){this.styles.clear(),this.clean(),this.onDisposed.trigger(uy.uuid)}cleanMeshes(){for(const t of this._meshes)t.removeFromParent();this._meshes=[]}async updatePoints(){let t=0;for(const[s,i]of Object.entries(this._map))t+=i.size;this._points.geometry.setAttribute("position",new Si(new Float32Array(t*3),3));const e=await this.components.get(Mt).getPositions(this._map);for(let s=0;s<e.length;s++){const{x:i,y:r,z:o}=e[s];this._points.geometry.attributes.position.array[s*3]=i,this._points.geometry.attributes.position.array[s*3+1]=r,this._points.geometry.attributes.position.array[s*3+2]=o}this._points.geometry.attributes.position.needsUpdate=!0}getRenderer(){if(!this.world)throw new Error("You must set a world to use the outliner!");const t=this.world.renderer;if(!t.postproduction)throw new Error("The world given to the outliner must use the postproduction renderer.");return t}};G(lU,"uuid","2fd3bcc5-b3b6-4ded-9f64-f47a02854a10");const lS=class cS extends me{constructor(t){super(t),G(this,"HOVERER_OPACITY_KEY","_maxHoverOpacity"),G(this,"_hoverTimeout",null),G(this,"_meshes",new fe),G(this,"_localId",null),G(this,"_fadeAnimation",null),G(this,"_world",null),G(this,"_enabled",!1),G(this,"_material",new qr({color:16777215,transparent:!0,opacity:.5,depthTest:!1,userData:{[this.HOVERER_OPACITY_KEY]:.5}})),G(this,"onDisposed",new yt),G(this,"duration",200),G(this,"animation",!0),G(this,"mouseStopTimeout",null),G(this,"onMouseMove",()=>{this.mouseStopTimeout!==null&&clearTimeout(this.mouseStopTimeout),this.mouseStopTimeout=window.setTimeout(()=>this.hover(),50)}),G(this,"onMouseLeave",()=>{this._meshes.clear()}),G(this,"animate",()=>{if(!(this._fadeAnimation&&this.animation&&this.material.transparent))return;const{startTime:e,duration:s,fadeIn:i}=this._fadeAnimation,r=Date.now()-e,o=Math.min(r/s,1),a=i?o:1-o,l=this.material.userData[this.HOVERER_OPACITY_KEY],c=a*(l!==void 0?l:1);this.material.opacity=c,o<1?requestAnimationFrame(this.animate):(i||this._meshes.clear(),this._fadeAnimation=null)}),t.add(cS.uuid,this),this._meshes.onBeforeDelete.add(e=>{e.removeFromParent(),e.geometry.dispose()}),this._meshes.onItemAdded.add(e=>{this.world&&this.world.scene.three.add(e)}),this._meshes.onCleared.add(()=>{this._localId=null,this._hoverTimeout&&(clearTimeout(this._hoverTimeout),this._hoverTimeout=null)})}set world(t){if(t){this.components.get(ln).get(t),this._world=t,this.setupEvents(!0);for(const e of this._meshes)t.scene.three.add(e)}else{this.setupEvents(!1),this._world=null;for(const e of this._meshes)e.removeFromParent()}}get world(){return this._world}set enabled(t){this.setupEvents(t),this._enabled=t}get enabled(){return this._enabled}set material(t){t.userData[this.HOVERER_OPACITY_KEY]=t.opacity;for(const e of this._meshes)e.material=t;this._material.dispose(),this._material=t}get material(){return this._material}setupEvents(t){if(!this.world||this.world.isDisposing)return;if(!this.world.renderer)throw new Error("The given world doesn't have a renderer!");const e=this.world.renderer.three.domElement;e.removeEventListener("mousemove",this.onMouseMove),e.removeEventListener("mouseleave",this.onMouseMove),t&&(e.addEventListener("mousemove",this.onMouseMove),e.addEventListener("mouseleave",this.onMouseLeave))}async hover(){if(!this.enabled||!this.world)return;const t=await this.components.get(ln).get(this.world).castRay();if(!t){this._meshes.clear();return}const{fragments:e,localId:s}=t;this._localId!==s&&(this._meshes.clear(),this._localId=s,this._hoverTimeout=window.setTimeout(async()=>{const i={[e.modelId]:new Set([s])},r=await this.components.get(zm).get(i);for(const[o,a]of r.entries()){const l=[...a.values()].flat();for(const c of l)c.material=this.material,this._meshes.add(c)}this._fadeAnimation={startTime:Date.now(),duration:this.duration,fadeIn:!0},this.animate()},100))}clear(){this._meshes.clear()}dispose(){this._enabled=!1,this._meshes.clear(),this._fadeAnimation=null,this._hoverTimeout=null,this.onDisposed.trigger()}};G(lS,"uuid","26fbd870-b1b2-4b71-b747-4063d484de1b");let cU=lS,hU=class{constructor(t){G(this,"alignments",[]),G(this,"enabled",!0),G(this,"world",null),G(this,"_raycastable",[]),G(this,"_components"),this._components=t}update(){this.dispose();for(const t of this.alignments)for(const e of t.children){const s=e;s.updateWorldMatrix(!0,!0);for(const i of s.children){const r=i;if(r.isLine2&&r.userData.points){const o=new Ce,a=new fs;a.geometry.setIndex(r.geometry.index);const l=new Float32Array(r.userData.points),c=new ze(l,3);o.setAttribute("position",c),a.geometry=o,a.userData.curve=r,a.applyMatrix4(r.matrixWorld),a.updateMatrixWorld(),this._raycastable.push(a)}}}}dispose(){for(const t of this._raycastable)t.geometry.dispose(),t.geometry=void 0;this._raycastable=[]}castRay(){if(!this.enabled||!this.world)return null;const t=this._components.get(ln).get(this.world).castRayToObjects(this._raycastable);if(!t)return null;const e=t.object,s=e.geometry,i=t.index,r=s.attributes.position.array[i*3],o=s.attributes.position.array[i*3+1],a=s.attributes.position.array[i*3+2],l=s.attributes.position.array[i*3+3],c=s.attributes.position.array[i*3+4],h=s.attributes.position.array[i*3+5],u=new F(l-r,c-o,h-a).normalize();return{point:t.point,normal:u,curve:e.userData.curve,alignment:e.userData.curve.parent}}},$_=class{static alignmentPercentageToPoint(t,e){const s=new F,i=new F,r=this.alignmentLength(t),o=e*r;let a=0;if(t.updateWorldMatrix(!0,!0),e===1)for(let l=t.children.length-1;l>=0;l--){const c=t.children[l],h=c.userData.points;if(!h)continue;const u=new F(h[h.length-3],h[h.length-2],h[h.length-1]);return u.applyMatrix4(c.matrixWorld),{normal:new F,point:u,curve:c,alignment:t}}for(const l of t.children){const c=l.userData.points;if(c)for(let h=0;h<c.length-3;h+=3){const u=s.set(c[h],c[h+1],c[h+2]),p=i.set(c[h+3],c[h+4],c[h+5]),d=u.distanceTo(p);if(a+d>=o){const g=o-a,m=p.clone().sub(u).normalize(),b=m.clone().multiplyScalar(g);return u.add(b),u.applyMatrix4(l.matrixWorld),{normal:m,point:u,curve:l,alignment:t}}a+=d}}return null}static curvePercentageToPoint(t,e,s){const i=new F,r=new F,o=this.curveLength(e),a=s*o;let l=0;const c=e.userData.points;if(!c)throw new Error("No points found in curve");for(let h=0;h<c.length-3;h+=3){const u=i.set(c[h],c[h+1],c[h+2]),p=r.set(c[h+3],c[h+4],c[h+5]),d=u.distanceTo(p);if(l+d>=a){const g=a-l,m=p.clone().sub(u).normalize(),b=m.clone().multiplyScalar(g);return u.add(b),{normal:m,point:u,curve:e,alignment:t}}l+=d}return null}static alignmentLength(t){let e=0;if(t.userData.length!==void 0)return t.userData.length;for(const s of t.children)"isLine2"in s&&(e+=this.curveLength(s));return t.userData.length=e,e}static curveLength(t){let e=0;if(t.userData.length!==void 0)return t.userData.length;const s=new F,i=new F,r=t.userData.points;if(!r)throw new Error("No points found in curve");for(let o=0;o<r.length-2-3;o+=3){const a=s.set(r[o],r[o+1],r[o+2]),l=i.set(r[o+3],r[o+4],r[o+5]);e+=a.distanceTo(l)}return t.userData.length=e,e}static curvePointToAlignmentPercentage(t,e,s){const i=new F,r=new F,o=this.alignmentLength(t);let a=0;t.updateWorldMatrix(!0,!0);for(const l of t.children){const c=l.userData.points;if(c)for(let h=0;h<c.length-3;h+=3){const u=i.set(c[h],c[h+1],c[h+2]),p=r.set(c[h+3],c[h+4],c[h+5]);u.applyMatrix4(l.matrixWorld),p.applyMatrix4(l.matrixWorld);const d=u.distanceTo(p),g=u.distanceTo(e)<.001,m=p.distanceTo(e)<.001,b=this.isPointbetweenTwoOthers(u,p,e);if(l===s&&(g||m||b)){const f=u.distanceTo(e);return(a+f)/o}a+=d}}return null}static isPointbetweenTwoOthers(t,e,s){const i=new F;i.subVectors(e,t).normalize();const r=new F;r.subVectors(s,t).normalize();const o=new F;o.subVectors(s,e).normalize();const a=1-.0016;return i.dot(r)>a&&i.dot(o)<-a}},uU=class{constructor(t,e){G(this,"onDisposed",new yt),G(this,"alignments",[]),G(this,"components"),G(this,"onMarkerChange",new yt),G(this,"enabled",!0),G(this,"highlightMaterial"),G(this,"increments",20),G(this,"screenDistanceLimit",.1),G(this,"fadeInTime",500),G(this,"_mouseMarkers"),G(this,"_highlighted",new Set),G(this,"_stationPoints",new Map),G(this,"_originalHighlightMaterialId","originalHighlightMaterial"),G(this,"_world",null),G(this,"_raycaster"),G(this,"_stationLabelColor",new Dt(16777215)),G(this,"_stationLabelBackgroundColor",new Dt(8014801)),G(this,"_stationPointerColor",new Dt(16777215)),G(this,"_stationPointerBackgroundColor",new Dt(4803766)),G(this,"_pointerDown",performance.now()),G(this,"_pointerDownTime",150),G(this,"onPointerDown",()=>{this._pointerDown=performance.now()}),G(this,"onPointerUp",()=>{if(performance.now()-this._pointerDown>this._pointerDownTime)return;const s=this.setMarkerToMouse("select");s&&this.onMarkerChange.trigger(s)}),G(this,"onMouseMove",()=>{this.setMarkerToMouse("hover")}),this.components=t,this.highlightMaterial=e,this._raycaster=new hU(t),this._raycaster.alignments=this.alignments}get world(){return this._world}set world(t){var e,s,i,r;if(t===this._world||(this._world&&this.setupEvents(!1),this._world=t,(e=this._mouseMarkers)==null||e.hover.removeFromParent(),(s=this._mouseMarkers)==null||s.select.removeFromParent(),(i=this._mouseMarkers)==null||i.hover.element.remove(),(r=this._mouseMarkers)==null||r.select.element.remove(),!t))return;this._raycaster.world=t;const o=this.newCivilLabel(0,"stationPointer");t.scene.three.add(o),o.visible=!1,o.element.style.transition="";const a=this.newCivilLabel(0,"stationPointer");a.element.style.transition="",a.element.style.opacity="0.5",t.scene.three.add(a),a.visible=!1,this._mouseMarkers={select:o,hover:a},this.setupEvents(!0)}get stationLabelColor(){return this._stationLabelColor}set stationLabelColor(t){this._stationLabelColor=t;const e=`#${t.getHexString()}`;for(const[,{labels:s}]of this._stationPoints){const i=[...s.children];for(const r of i){const o=this.getLabel(r);o.style.color=e;const a=this.getPoint(r);a.style.backgroundColor=e}}}get stationLabelBackgroundColor(){return this._stationLabelBackgroundColor}set stationLabelBackgroundColor(t){this._stationLabelBackgroundColor=t;const e=`#${t.getHexString()}`;for(const[,{labels:s}]of this._stationPoints){const i=[...s.children];for(const r of i){const o=this.getLabel(r);o.style.backgroundColor=e;const a=this.getPoint(r);a.style.border=`2px solid ${e}`}}}get stationPointerColor(){return this._stationPointerColor}set stationPointerColor(t){this._stationPointerColor=t;const e=`#${t.getHexString()}`;if(this._mouseMarkers){const s=this._mouseMarkers.select,i=this.getLabel(s);i.style.color=e;const r=this.getPoint(s);r.style.backgroundColor=e}}get stationPointerBackgroundColor(){return this._stationPointerBackgroundColor}set stationPointerBackgroundColor(t){this._stationPointerBackgroundColor=t;const e=`#${t.getHexString()}`;if(this._mouseMarkers){const s=this._mouseMarkers.select,i=this.getLabel(s);i.style.backgroundColor=e;const r=this.getPoint(s);r.style.border=`2px solid ${e}`}}dispose(){var t,e,s,i;this.clearHighlight(),this.clearStations(),this.alignments=[],(t=this._mouseMarkers)==null||t.hover.removeFromParent(),(e=this._mouseMarkers)==null||e.select.removeFromParent(),(s=this._mouseMarkers)==null||s.hover.element.remove(),(i=this._mouseMarkers)==null||i.select.element.remove(),this._raycaster.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}updateAlignments(){this._raycaster.update()}setMarkerAtPoint(t,e){if(!this._mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");this.updateMarkerValue(t,e),this._mouseMarkers[e].visible=!0,this._mouseMarkers[e].position.copy(t.point)}highlight(t,e=!0){e&&this.clearHighlight(this._highlighted);for(const s of t.children)"isLineSegments2"in s&&"material"in s&&(s.userData[this._originalHighlightMaterialId]=s.material,s.material=this.highlightMaterial);this._highlighted.add(t)}clearHighlight(t=this._highlighted){for(const e of t)for(const s of e.children)"isLineSegments2"in s&&"material"in s&&(s.material=s.userData[this._originalHighlightMaterialId],delete s.userData[this._originalHighlightMaterialId]);this._highlighted.clear()}createStations(t){if(!this.world||this._stationPoints.has(t.uuid))return;const e=new Fn;this.world.scene.three.add(e),this._stationPoints.set(t.uuid,{alignment:t,labels:e})}clearStations(t=this._stationPoints.keys()){for(const e of t){const s=this._stationPoints.get(e);s&&(this.clearLabels(s.labels),this._stationPoints.delete(e))}}updateStations(){if(!this.world)throw new Error("No world found!");if(!this.world.renderer)throw new Error("No renderer found!");const t=this.world.camera.three,e=this.world.renderer.three,s=new No,i=e.clippingPlanes,r=new F,o=new F;let a=!0;const l=new F;for(const[,{alignment:c,labels:h}]of this._stationPoints){this.clearLabels(h),c.updateWorldMatrix(!0,!0);const u=c.userData.initialStation;let p=u||0;const d=p%this.increments;let g=u+this.increments-d;for(const m of c.children){if(!("isLine2"in m))continue;const b=m;if(b.geometry.boundingBox||b.geometry.computeBoundingBox(),s.setFromProjectionMatrix(new xt().multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse)),!s.intersectsBox(b.geometry.boundingBox)){const P=$_.curveLength(m);p+=P;const M=p%this.increments;g=p+this.increments-M;continue}const f=m.userData.points,_=f[0],y=f[1],v=f[2];if(l.set(_,y,v),l.applyMatrix4(m.matrixWorld),!this.isLabelClipped(i,l)){if(a){a=!1,r.set(l.x,l.y,l.z),r.project(t),r.z=0;const P=this.newCivilLabel(p,"stationLabel");P.position.set(l.x,l.y,l.z),h.children.push(P)}else if(o.set(l.x,l.y,l.z),o.project(t),o.z=0,r.distanceTo(o)>this.screenDistanceLimit){const P=this.newCivilLabel(p,"stationLabel");P.position.set(l.x,l.y,l.z),h.children.push(P),r.copy(o)}}const w=new F,I=new F;for(let P=0;P<f.length-3;P+=3){w.set(f[P],f[P+1],f[P+2]),I.set(f[P+3],f[P+4],f[P+5]);const M=w.distanceTo(I),T=p+M,L=I.clone().sub(w).normalize();for(;T>g;){const E=g-p,N=L.clone();N.multiplyScalar(E);const{x:W,y:V,z:et}=w.clone().add(N);if(l.set(W,V,et),l.applyMatrix4(m.matrixWorld),!this.isLabelClipped(i,l)&&s.containsPoint(l)&&(o.set(l.x,l.y,l.z),o.project(t),o.z=0,r.distanceTo(o)>this.screenDistanceLimit)){const j=this.newCivilLabel(g,"stationLabel");j.position.set(l.x,l.y,l.z),h.children.push(j),r.copy(o)}g+=this.increments}p+=M}const C=f[f.length-3],A=f[f.length-2],S=f[f.length-1];if(l.set(C,A,S),l.applyMatrix4(m.matrixWorld),!(this.isLabelClipped(i,l)||!s.containsPoint(l))&&(o.set(l.x,l.y,l.z),o.project(t),o.z=0,r.distanceTo(o)>this.screenDistanceLimit)){const P=this.newCivilLabel(p,"stationLabel");P.position.set(l.x,l.y,l.z),h.children.push(P),r.copy(o)}}}}getCursorValue(){if(!this._mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");return this._mouseMarkers.select.element.children[0].children[0].innerText}setCursorValue(t,e){if(!this._mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");const s=this._mouseMarkers[e].element.children[0].children[0];s.innerText=t}isLabelClipped(t,e){for(const s of t)if(!(s.distanceToPoint(e)>0))return!0;return!1}clearLabels(t){const e=[...t.children];for(const s of e)s.element.style.opacity="0";setTimeout(()=>{for(const s of e)s.removeFromParent(),s.element.remove(),s.visible=!1},this.fadeInTime)}newCivilLabel(t,e){const s=document.createElement("div"),i=e==="stationLabel"?this.stationLabelColor:this.stationPointerColor,r=e==="stationLabel"?this.stationLabelBackgroundColor:this.stationPointerBackgroundColor,o=document.createElement("div");o.style.width="4px",o.style.height="4px",o.style.borderRadius="50%",o.style.backgroundColor=`#${i.getHexString()}`,o.style.border=`2px solid #${r.getHexString()}`,o.style.display="flex",o.style.justifyContent="center";const a=this.getFormattedStation(t),l=document.createElement("div");l.innerText=a,l.style.backgroundColor=`#${r.getHexString()}`,l.style.color=`#${i.getHexString()}`,l.style.padding="0.3rem",l.style.position="absolute",l.style.bottom="1rem",l.style.borderRadius="6px",l.style.boxShadow="rgba(0, 0, 0, 0.6) 0px 4px 6px",o.appendChild(l);const c=new eS(s);return s.appendChild(o),e==="stationLabel"&&(s.style.transition=`opacity ${this.fadeInTime}ms ease-in-out`,s.style.opacity="0",setTimeout(()=>{s.style.opacity="1"})),c}setupEvents(t){if(!this.world)throw new Error("No world found!");if(this.world.isDisposing||!this.world.renderer)return;const e=this.world.renderer.three.domElement,s=this.components.get(ln).get(this.world);s.three.params.Line||(s.three.params.Line={threshold:10}),e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointerup",this.onPointerUp),e.removeEventListener("pointermove",this.onMouseMove),t&&(e.addEventListener("pointerdown",this.onPointerDown),e.addEventListener("pointerup",this.onPointerUp),e.addEventListener("pointermove",this.onMouseMove))}setMarkerToMouse(t){if(!this.enabled||!this._mouseMarkers)return null;if(!this.world)throw new Error("No world found!");const e=this._raycaster.castRay();if(!e)return this._mouseMarkers[t].visible=!1,null;this._mouseMarkers[t].visible=!0;const s=e.point;return this._mouseMarkers[t].position.copy(s),this.updateMarkerValue(e,t),e}updateMarkerValue(t,e){if(!this._mouseMarkers)return;const{alignment:s,curve:i,point:r}=t,o=$_.curvePointToAlignmentPercentage(s,r,i);if(o===null)throw new Error("Point is not on the curve");const a=o*$_.alignmentLength(s)+s.userData.initialStation,l=this.getFormattedStation(a);this.setCursorValue(l,e)}getFormattedStation(t){const e=Math.floor(t/1e3),s=Math.round(t-e*1e3);return`${e}+${s}`}getLabel(t){return t.element.children[0].children[0]}getPoint(t){return t.element.children[0]}};const dU=class hS extends me{constructor(t){super(t),G(this,"onDisposed",new yt),G(this,"list",new Map),G(this,"enabled",!0),G(this,"highlightMaterial",new Ov({color:8014801,linewidth:5,depthTest:!1})),G(this,"_increments",20),G(this,"_screenDistanceLimit",.1),G(this,"_fadeInTime",500),G(this,"_stationLabelColor",new Dt(16777215)),G(this,"_stationLabelBackgroundColor",new Dt(8014801)),G(this,"_stationPointerColor",new Dt(16777215)),G(this,"_stationPointerBackgroundColor",new Dt(4803766)),this.components.add(hS.uuid,this)}get increments(){return this._increments}set increments(t){this._increments=t;for(const[,e]of this.list)e.increments=t}get screenDistanceLimit(){return this._screenDistanceLimit}set screenDistanceLimit(t){this._screenDistanceLimit=t;for(const[,e]of this.list)e.screenDistanceLimit=t}get fadeInTime(){return this._fadeInTime}set fadeInTime(t){this._fadeInTime=t;for(const[,e]of this.list)e.fadeInTime=t}get stationLabelColor(){return this._stationLabelColor}set stationLabelColor(t){this._stationLabelColor=t;for(const[,e]of this.list)e.stationLabelColor=t}get stationLabelBackgroundColor(){return this._stationLabelBackgroundColor}set stationLabelBackgroundColor(t){this._stationLabelBackgroundColor=t;for(const[,e]of this.list)e.stationLabelBackgroundColor=t}get stationPointerColor(){return this._stationPointerColor}set stationPointerColor(t){this._stationPointerColor=t;for(const[,e]of this.list)e.stationPointerColor=t}get stationPointerBackgroundColor(){return this._stationPointerBackgroundColor}set stationPointerBackgroundColor(t){this._stationPointerBackgroundColor=t;for(const[,e]of this.list)e.stationPointerBackgroundColor=t}create(t){const e=new uU(this.components,this.highlightMaterial);return this.list.set(t,e),e}delete(t){const e=this.list.get(t);e&&(e.dispose(),this.list.delete(t))}dispose(){for(const[,t]of this.list)t.dispose();this.onDisposed.trigger(),this.onDisposed.reset()}updateAlignments(){for(const[,t]of this.list)t.updateAlignments()}};G(dU,"uuid","0a59c09e-2b49-474a-9320-99f51f40f182");const pU=class uS extends me{constructor(t){super(t),G(this,"enabled",!0),G(this,"onDisposed",new yt),G(this,"_world",null),G(this,"_flip",!1),G(this,"_plane"),G(this,"_point",new F),G(this,"_edgeMeshes",[]),G(this,"_sectionVisible",!1),G(this,"_sectionOffset",.1),G(this,"edgeMaterial",new Ov({color:0,linewidth:5,depthTest:!1})),this.components.add(uS.uuid,this)}get plane(){if(!this._plane)throw new Error("Plane is not set. You must give a world.");return this._plane}set plane(t){this._plane=t}get sectionVisible(){return this._sectionVisible}set sectionVisible(t){this._sectionVisible=t;for(const e of this._edgeMeshes)e.visible=t}get world(){return this._world}set world(t){var e;if(this._world=t,(e=this._plane)==null||e.dispose(),!t)return;const s=this.components.get(yo),i=s.createFromNormalAndCoplanarPoint(t,new F(1,0,0),new F);this.plane=s.list.get(i),this.plane.visible=!1,this.plane.enabled=!1}get flip(){return this._flip}set flip(t){var e;if(t===this._flip)return;this._flip=t;const s=(e=this.plane)==null?void 0:e.normal.clone().multiplyScalar(-1);for(const i of this._edgeMeshes)i.position.add(s.clone().multiplyScalar(this._sectionOffset));this.plane.setFromNormalAndCoplanarPoint(s,this._point),this.plane.update()}dispose(){var t;this.clearMeshes(),(t=this.plane)==null||t.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}async set(t,e){this.flip&&e.multiplyScalar(-1),this.plane.setFromNormalAndCoplanarPoint(e,t),this._point.copy(t)}async update(){this.clearMeshes();const t=this.components.get(Mt);this.plane.update();const e=[];for(const[,s]of t.list)e.push(this.generateModelSection(s));await Promise.all(e)}async generateModelSection(t){if(!this.world)return;const e=this.plane.three.clone();e.constant-=.01;const{buffer:s}=await t.getSection(e),i=new Ce,r=new ze(s,3,!1);i.setAttribute("position",r);const o=new Gy(i),a=new Sv;a.fromLineSegments(o);const l=new iS(a,this.edgeMaterial);l.frustumCulled=!1,this.world.scene.three.add(l),this._edgeMeshes.push(l),l.renderOrder=3,o.geometry.dispose()}clearMeshes(){for(const t of this._edgeMeshes)t.removeFromParent(),t.geometry.dispose(),t.material=void 0;this._edgeMeshes=[]}};G(pU,"uuid","96b2c87e-d90b-4639-8257-8f01136fe324");const rc=class mm{constructor(t){G(this,"onDisposed",new yt),G(this,"marker",null),G(this,"world",null),G(this,"_enabled",!1),G(this,"_components"),this._components=t}set enabled(t){this._enabled=t,this.marker&&(this.marker.visible=t),t&&this.get()}get enabled(){return this._enabled}dispose(){this.marker&&this.marker.dispose()}async get(t){const e=t?.world??this.world;if(!e)throw new Error("GraphicVertexPicker: a world is need to get a casting result.");const s=await this._components.get(ln).get(e).castRay({snappingClasses:t?.snappingClasses});if(s){const{point:i}=s;if(!this.marker){const r=document.createElement("div");this.marker=new ka(e,r)}if(this.marker.world!==e&&(this.marker.world=e,this.marker.three.removeFromParent(),e.scene.three.add(this.marker.three)),this.marker.visible=!0,this.marker.three.position.copy(i),"snappingClass"in s&&typeof s.snappingClass=="number"&&(s.snappingClass===0||s.snappingClass===1||s.snappingClass===2)){const r=mm.snappingStyles[s.snappingClass]??mm.baseSnappingStyle;Object.assign(this.marker.three.element.style,r)}else Object.assign(this.marker.three.element.style,mm.baseSnappingStyle)}else this.marker&&(this.marker.visible=!1);return s}};G(rc,"baseSnappingStyle",{height:"6px",width:"6px",borderRadius:"100%",borderWidth:"2px",borderColor:"rgb(122, 75, 209)",borderStyle:"solid",zIndex:"-20"}),G(rc,"snappingStyles",{[Ws.FACE]:{...rc.baseSnappingStyle},[Ws.POINT]:{...rc.baseSnappingStyle,borderColor:"#e25959",borderRadius:"0"},[Ws.LINE]:{...rc.baseSnappingStyle,borderColor:"#2d2d2d",borderRadius:"0"}});let fU=rc;function dS(){const n=document.createElement("div");return n.style.backgroundColor="blue",n.style.color="white",n.style.padding="6px",n.style.borderRadius="6px",n.style.boxShadow="0px 4px 6px rgba(0, 0, 0, 0.6)",n.style.zIndex="-10",n}function mU(n={}){const{color:t="white",size:e="4px",border:s="2px solid blue",background:i="white"}=n,r=document.createElement("div");return r.style.backgroundColor=i,r.style.color=t,r.style.height=e,r.style.width=e,r.style.borderRadius="50%",r.style.border=s,r.style.zIndex="-20",r}let Lo=class extends qt{constructor(){super(...arguments),G(this,"id",Ps.create()),G(this,"_units","m"),G(this,"_rounding",2)}set units(t){this._units=t}get units(){return this._units}set rounding(t){this._rounding=t}get rounding(){return this._rounding}get value(){const t=this.distance();return Oc.convertUnits(t,"m",this.units,this.rounding)}},gU=class dy{constructor(t,e,s,i=2,r="m"){G(this,"label"),G(this,"boundingBox",new ht),G(this,"world"),G(this,"_components"),G(this,"_units","m"),G(this,"_rounding",2),G(this,"startNormal",null),G(this,"line"),G(this,"rectangleComponentLines",[]),G(this,"projectionComponentLines",[]),G(this,"_visible",!0),G(this,"_root",new Fn),G(this,"_endpoints",new fe),G(this,"lineElement"),G(this,"rectangleDimensions",new fe),G(this,"projectionDimensions",new fe),G(this,"isSelected",!1),G(this,"_latestRectangularInversion",!1),G(this,"_endpointElement",mU()),G(this,"_material"),G(this,"_componentsMaterial",new l3({depthTest:!1,gapSize:.2,dashSize:.2,transparent:!0,opacity:.5,color:3026478})),this._components=t,this.world=e,this._material=s.lineMaterial,this._rounding=i,this._units=r,this.line=s.line,this.startNormal=s.startNormal??null,this.rectangleComponentLines=[new Lo,new Lo],this.updateRectangleComponents(),this.updateProjectionComponents(),this.lineElement=this.createLine(s),this._endpoints.onItemAdded.add(o=>{this._root.add(o.three);const a=this._endpoints.size===1?this.line.start:this.line.end;o.three.position.copy(a)}),this._endpoints.onBeforeDelete.add(o=>o.dispose()),this.createEndpoints();for(const o of this._endpoints)o.three.element.style.borderColor=`#${s.lineMaterial.color.getHexString()}`;this.label=this.newText(),this.label.three.element.style.backgroundColor=`#${s.lineMaterial.color.getHexString()}`,this.label.three.renderOrder=1,this._root.renderOrder=2,this.world.scene.three.add(this._root),this.setupEvents()}set units(t){for(const e of this.rectangleDimensions)e.units=t;for(const e of this.projectionDimensions)e.units=t;this._units=t,this.updateLabel()}get units(){return this._units}set rounding(t){for(const e of this.rectangleDimensions)e.rounding=t;for(const e of this.projectionDimensions)e.rounding=t;this._rounding=t,this.updateLabel()}get rounding(){return this._rounding}get visible(){return this._visible}set visible(t){for(const a of this.rectangleDimensions)a.visible=t;for(const a of this.projectionDimensions)a.visible=t;this._visible=t,this.label.visible=t;for(const a of this._endpoints)a.visible=t;const[e,s]=this._endpoints,i=e.three,r=s.three,o=this.label.three;t?(this.world.scene.three.add(this._root),this._root.add(o,i,r)):(o.removeFromParent(),i.removeFromParent(),r.removeFromParent(),this._root.removeFromParent())}set end(t){this.line.end=t;const e=this.lineElement.geometry.attributes.position;e.setXYZ(1,t.x,t.y,t.z),e.needsUpdate=!0,this.update()}set start(t){this.line.start=t;const e=this.lineElement.geometry.attributes.position;e.setXYZ(0,t.x,t.y,t.z),e.needsUpdate=!0,this.update()}setupEvents(){this.rectangleDimensions.onBeforeDelete.add(t=>t.dispose()),this.projectionDimensions.onBeforeDelete.add(t=>t.dispose())}dispose(){this.visible=!1;const t=this._components.get(mr);t.destroy(this._root),t.destroy(this.lineElement),this._endpoints.clear(),this.label.dispose(),this.boundingBox&&t.destroy(this.boundingBox),this.rectangleDimensions.clear(),this.projectionDimensions.clear(),this._components=null}createBoundingBox(){const t=new F;this.line.getCenter(t);const e=this.line.distance();this.boundingBox.geometry=new ee(1,1,e),this.boundingBox.position.copy(t),this.boundingBox.lookAt(this.line.end),this.boundingBox.visible=!1,this._root.add(this.boundingBox)}invertRectangularDimensions(){this.rectangleDimensions.size!==0&&(this.rectangleDimensions.clear(),this._latestRectangularInversion=!this._latestRectangularInversion,this.updateRectangleComponents(this._latestRectangularInversion),this.displayRectangularDimensions())}displayRectangularDimensions(){this.rectangleDimensions.clear();for(const t of this.rectangleComponentLines){const e=new dy(this._components,this.world,{line:t,lineMaterial:this._componentsMaterial,endpointElement:this.endpointElement});e.lineElement.computeLineDistances(),this.rectangleDimensions.add(e)}}displayProjectionDimensions(){this.projectionDimensions.clear();for(const t of this.projectionComponentLines){const e=new dy(this._components,this.world,{line:t,lineMaterial:this._componentsMaterial,endpointElement:this.endpointElement});e.lineElement.computeLineDistances(),this.projectionDimensions.add(e)}}set endpointElement(t){for(const e of this.rectangleDimensions)e.endpointElement=t;for(const e of this.projectionDimensions)e.endpointElement=t;this._endpointElement=t,this.createEndpoints()}get endpointElement(){return this._endpointElement}createEndpoints(){this._endpoints.clear();const t=new ka(this.world,this._endpointElement),e=new ka(this.world,this._endpointElement.cloneNode(!0));this._endpoints.add(t,e)}updateProjectionComponents(){if(!this.startNormal)return;const t=new Wt().setFromNormalAndCoplanarPoint(this.startNormal,this.line.start),e=new F;t.projectPoint(this.line.end,e);let[s]=this.projectionComponentLines;s||(s=new Lo,this.projectionComponentLines.push(s)),s.set(this.line.end,e),s.distance()<.01&&this.projectionComponentLines.shift();for(const i of this.projectionDimensions)i&&i.update()}updateRectangleComponents(t=!1){const e=t?this.line.end:this.line.start,s=t?this.line.start:this.line.end,i=new F;i.subVectors(s,e),Math.abs(s.y-e.y)>=.1?i.y=0:i.x=0;const r=e.clone().add(i),[o,a]=this.rectangleComponentLines;o.set(r,e),a.set(r,s);for(const l of this.rectangleDimensions)l.update()}updateLabel(){this.label.three.element.textContent=this.getTextContent();const t=new F;this.line.getCenter(t),this.label.three.position.copy(t)}updateGeometry(){this.updateRectangleComponents(),this.updateProjectionComponents(),[...this._endpoints][0].three.position.copy(this.line.start),[...this._endpoints][1].three.position.copy(this.line.end),this.lineElement.geometry.computeBoundingSphere()}update(){this.updateGeometry(),this.updateLabel()}set material(t){this._material.dispose(),this._material=t,this.lineElement.material=t}get material(){return this._material}createLine(t){const e=new Ce;e.setFromPoints([t.line.start,t.line.end]);const s=new fs(e,t.lineMaterial);return this._root.add(s),s}newText(){const t=dS();t.textContent=this.getTextContent();const e=new ka(this.world,t),s=new F;return this.line.getCenter(s),e.three.position.copy(s),this._root.add(e.three),e}getTextContent(t=this.line.distance()){return`${Oc.convertUnits(t,"m",this._units,this.rounding)} ${this._units}`}set color(t){const e=`#${t.getHexString()}`;this.label.three.element.style.backgroundColor=e;for(const s of this._endpoints)s.three.element.style.borderColor=e;this._material.color.set(t)}},Bm=class pS{constructor(t){G(this,"id",Ps.create()),G(this,"points",new fe),G(this,"tolerance",.005),G(this,"_plane",null),G(this,"_rounding",2),G(this,"_units","m2"),this.points.guard=e=>{const s=[...this.points].some(r=>r.equals(e)),i=this.isPointInPlane(e);return!s&&i},this.points.onItemAdded.add(e=>{if(this.plane){const s=new F;this.plane.projectPoint(e,s),e.copy(s)}this.points.size<3||this.points.size===3&&this.computePlane()}),this.points.onItemDeleted.add(()=>{this.points.size>=3||(this._plane=null)}),this.points.onCleared.add(()=>{this._plane=null}),t&&this.points.add(...t)}get plane(){return this._plane}get _coordinateSystem(){if(!this.plane)return null;const t=this.plane.normal,e=new F,s=new F;return Math.abs(t.x)>Math.abs(t.z)?e.set(-t.y,t.x,0).normalize():e.set(0,-t.z,t.y).normalize(),s.crossVectors(t,e).normalize(),{normal:t.clone(),x:e.clone(),y:s.clone()}}get points2D(){if(!this.plane)if(this.points.size>=3)this.computePlane();else return null;return[...this.points].map(t=>this.convertPointTo2D(t)).filter(t=>t!==null)}get center(){if(!this.plane||this.points.size<3)return null;const t=this.points2D;if(!t||t.length===0)return null;const e=t.reduce((s,i)=>s.add(i),new Ut).divideScalar(t.length);return this.convertPointTo3D(e)}get value(){const t=this.points2D;if(!t)return 0;const e=Math.abs(a3.area(t));return Oc.convertUnits(e,"m2",this.units,this.rounding)}get boundingBox(){if(this.points.size===0)return null;const t=new Tt;for(const e of this.points)t.expandByPoint(e);return t}get perimeter(){const t=this.points2D;if(!t||t.length<2)return 0;let e=0;for(let s=0;s<t.length;s++){const i=t[s],r=t[(s+1)%t.length];e+=i.distanceTo(r)}return e}set rounding(t){this._rounding=t}get rounding(){return this._rounding}set units(t){this._units=t}get units(){return this._units}isPointInPlane(t){if(!this.plane)return!0;const e=this.plane.distanceToPoint(t);return Math.abs(e)<this.tolerance}clone(){return new pS([...this.points])}computePlane(){const[t,e,s]=this.points;if(!(t&&e&&s))return null;const i=new F().subVectors(e,t),r=new F().subVectors(s,t),o=new F().crossVectors(i,r).normalize();return this._plane=new Wt().setFromNormalAndCoplanarPoint(o,t),this.plane}convertPointTo2D(t){if(!this.isPointInPlane(t)||!this.plane)return null;const e=this._coordinateSystem;if(!e)return null;const s=new F;this.plane.projectPoint(t,s);const i=s.dot(e.x),r=s.dot(e.y);return new Ut(i,r)}convertPointTo3D(t){if(!this.plane)return null;const e=this._coordinateSystem;if(!e)return null;const{x:s,y:i,normal:r}=e;return new F().addScaledVector(s,t.x).addScaledVector(i,t.y).addScaledVector(r,-this.plane.constant)}},fS=class mS{constructor(t){G(this,"_components"),G(this,"id",Ps.create()),G(this,"onItemsChanged",new yt),G(this,"_items",{}),G(this,"_units","m3"),G(this,"_rounding",2),this._components=t}set items(t){this._items=t,this.onItemsChanged.trigger()}get items(){return this._items}set units(t){this._units=t}get units(){return this._units}set rounding(t){this._rounding=t}get rounding(){return this._rounding}async getValue(){const t=await this._components.get(Oc).getItemsVolume(this.items);return Oc.convertUnits(t,"m3",this.units,this.rounding)}async getCenter(){return await this._components.get(Dm).getCenter(this.items)}async getBox(){const t=this._components.get(Dm);t.list.clear(),await t.addFromModelIdMap(this.items);const e=t.get();return t.list.clear(),e}clone(){const t=new mS(this._components);return t.items=Qe.clone(this.items),t}},gS=class extends ka{constructor(t){const e=document.createElement("div");e.style.backgroundColor="blue",e.style.color="white",e.style.padding="6px",e.style.borderRadius="6px",e.style.boxShadow="0px 4px 6px rgba(0, 0, 0, 0.6)",e.style.zIndex="-10",super(t,e),G(this,"_value",0),G(this,"_units","m2"),G(this,"_worldUnits","m2"),G(this,"_color",new Dt),G(this,"_textColor",new Dt),G(this,"_rounding",2),this.three.renderOrder=1,e.textContent=this.formattedValue}set value(t){this._value=t,this.three.element.textContent=this.formattedValue}get value(){return this._value}set units(t){this._units=t,this.three.element.textContent=this.formattedValue}get units(){return this._units}set worldUnits(t){this._worldUnits=t,this.three.element.textContent=this.formattedValue}get worldUnits(){return this._worldUnits}set color(t){this._color=t;const e=`#${t.getHexString()}`;this.three.element.style.backgroundColor=e}get color(){return this._color}set textColor(t){this._textColor=t;const e=`#${t.getHexString()}`;this.three.element.style.color=e}get textColor(){return this._textColor}set rounding(t){this._rounding=t,this.three.element.textContent=this.formattedValue}get rounding(){return this._rounding}get formattedValue(){return`${Oc.convertUnits(this.value,this.worldUnits,this.units,this.rounding)} ${this.units}`}},bU=class{constructor(t,e,s=new Bm){G(this,"_root",new Fn),G(this,"_components"),G(this,"_material",new nd({color:"red",transparent:!0,opacity:.5,side:Pi,depthTest:!1})),G(this,"_visible",!0),G(this,"_color",new Dt),G(this,"label"),G(this,"three",new ht),G(this,"world"),G(this,"area"),G(this,"_triggerUpdate",()=>this.update()),this._components=t,this.world=e,this.area=s,this.world.scene.three.add(this.three),this.label=new gS(e),this._root.renderOrder=2,this.visible=!0,this.update(),s.points.onItemAdded.add(this._triggerUpdate),s.points.onItemDeleted.add(this._triggerUpdate),s.points.onCleared.add(this._triggerUpdate)}set material(t){this._material.dispose(),this._material=t,this.three.material=t}get material(){return this._material}set visible(t){this._visible=t,this.label.visible=t;const e=this.label.three;t?(this._root.add(e,this.three),this.world.scene.three.add(this._root)):(e.removeFromParent(),this._root.removeFromParent())}get visible(){return this._visible}set rounding(t){this.label.rounding=t}get rounding(){return this.label.rounding}set units(t){this.label.units=t}get units(){return this.label.units}set color(t){this._color=t,this.label.color=t,this._material.color.set(t)}get color(){return this._color}updateMesh(){if(this.area.points.size<3)return;const t=[...this.area.points],e=t.flatMap(r=>[r.x,r.y,r.z]),s=[];for(let r=1;r<t.length-1;r++)s.push(0,r,r+1);this.three.geometry.dispose();const i=new Ce;i.setAttribute("position",new Si(e,3)),i.setIndex(s),this.three.geometry=i,this.three.material=this.material}update(){if(this.updateMesh(),this.area.value===0)this.label.visible=!1;else{this.label.value=this.area.value,this.label.visible=!0;const t=this.area.center;t&&this.label.three.position.copy(t)}}dispose(){this.label.dispose(),this._components.get(mr).destroy(this._root,!0,!0),this.area.points.clear()}};const _U={length:"m",area:"m2",volume:"m3"};let bS=class{constructor(t,e,s=new fS(t)){G(this,"_root",new Fn),G(this,"_components"),G(this,"_material",new nd({color:"red",transparent:!0,opacity:.75,side:Pi,depthTest:!1})),G(this,"_visible",!0),G(this,"_color",new Dt),G(this,"label"),G(this,"world"),G(this,"volume"),G(this,"meshes",[]),this._components=t,this.world=e,this.volume=s,this.label=new gS(e),this._root.renderOrder=2,this.visible=!0,this.update(),this.volume.onItemsChanged.add(()=>this.update())}set material(t){this._material.dispose(),this._material=t;for(const e of this.meshes)e.material=t}get material(){return this._material}set visible(t){this._visible=t,this.label.visible=t;for(const e of this.meshes)t?this.world.scene.three.add(e):e.removeFromParent()}get visible(){return this._visible}set rounding(t){this.label.rounding=t}get rounding(){return this.label.rounding}set units(t){this.label.units=t}get units(){return this.label.units}set color(t){this._color=t,this.label.color=t,this._material.color.set(t)}get color(){return this._color}async updateMesh(){this.cleanMeshes();const t=this._components.get(zm),e=await t.get(this.volume.items,{material:this.material});this.meshes=t.getMeshesFromResult(e);for(const s of this.meshes)this.world.scene.three.add(s)}async update(){this.updateMesh();const t=await this.volume.getValue();this.label.visible=t!==0,this.label.value=t;const e=await this.volume.getCenter();e&&this.label.three.position.copy(e)}cleanMeshes(){const t=this._components.get(mr);for(const e of this.meshes)t.destroy(e,!0,!0);this._components.get(zm).remove(),this.meshes=[]}dispose(){this.label.dispose(),this.cleanMeshes(),this.volume.items={}}},Pv=class extends me{constructor(t,e){super(t),G(this,"list",new fe),G(this,"onDisposed",new yt),G(this,"snappings",[Ws.LINE,Ws.POINT,Ws.FACE]),G(this,"lines",new fe),G(this,"fills",new fe),G(this,"labels",new fe),G(this,"volumes",new fe),G(this,"_world",null),G(this,"measureType"),G(this,"onPointerStop",new yt),G(this,"onPointerMove",new yt),G(this,"onStateChanged",new yt),G(this,"pointerStopTimeout",null),G(this,"onMove",()=>{this.enabled&&(this.pointerStopTimeout!==null&&clearTimeout(this.pointerStopTimeout),this.pointerStopTimeout=window.setTimeout(()=>{this.onPointerStop.trigger()},50),this.onPointerMove.trigger())}),G(this,"onKeydown",s=>{this.enabled&&s.key==="Escape"&&this.cancelCreation()}),G(this,"onEnabledChange",new yt),G(this,"_enabled",!1),G(this,"onVisibilityChange",new yt),G(this,"_visible",!0),G(this,"_units"),G(this,"_rounding",2),G(this,"_linesEndpointElement",dS()),G(this,"_linesMaterial",new dg({color:"#0000FF",depthTest:!1})),G(this,"_fillsMaterial",new nd({color:2392594,side:Pi,transparent:!0,opacity:.3,depthTest:!1})),G(this,"_volumesMaterial",new nd({color:2392594,side:Pi,transparent:!0,opacity:.3,depthTest:!1})),G(this,"_color",new Dt),G(this,"_vertexPicker",new fU(this.components)),G(this,"create",s=>{}),G(this,"endCreation",s=>{}),G(this,"cancelCreation",()=>{}),G(this,"delete",s=>{}),this.measureType=e,this._units=_U[this.measureType],this.lines.onBeforeDelete.add(s=>s.dispose()),this.fills.onBeforeDelete.add(s=>s.dispose()),this.labels.onBeforeDelete.add(s=>s.dispose()),this.volumes.onBeforeDelete.add(s=>s.dispose()),this.list.onCleared.add(()=>{this.lines.clear(),this.fills.clear(),this.labels.clear(),this.volumes.clear()})}set world(t){this._world=t,this._vertexPicker.world=t}get world(){return this._world}get unitsList(){let t=[];return this.measureType==="length"?t=["mm","cm","m","km"]:this.measureType==="area"?t=["mm2","cm2","m2","km2"]:t=["mm3","cm3","m3","km3"],t}setEvents(t){if(!this.world)throw new Error("Measurement: you must specify a world first!");if(this.world.isDisposing)return;if(!this.world.renderer)throw new Error("Measurement: the world needs a renderer!");const e=this.world.renderer.three.domElement.parentElement;e&&(e.removeEventListener("pointermove",this.onMove),window.removeEventListener("keydown",this.onKeydown),t&&(e.addEventListener("pointermove",this.onMove),window.addEventListener("keydown",this.onKeydown)))}set enabled(t){this._enabled=t,this._vertexPicker.enabled=t,this.setEvents(t),this.cancelCreation(),this.onEnabledChange.trigger(t),this.onStateChanged.trigger(["enabled"])}get enabled(){return this._enabled}set visible(t){this._visible=t;for(const e of this.lines)e.visible=t;for(const e of this.fills)e.visible=t;for(const e of this.volumes)e.visible=t;this.onVisibilityChange.trigger(t),this.onStateChanged.trigger(["visibility"])}get visible(){return this._visible}set units(t){this._units=t;let e;t.endsWith("2")?e="area":t.endsWith("3")?e="volume":e="length";for(const s of this.list)(s instanceof Lo||s instanceof Bm||s instanceof fS)&&(s.units=t);if(e==="length")for(const s of this.lines)s.units=t;else if(e==="area")for(const s of this.fills)s.units=t;else if(e==="volume")for(const s of this.volumes)s.units=t;this.onStateChanged.trigger(["units"])}get units(){return this._units}set rounding(t){this._rounding=t;for(const e of this.list)(e instanceof Lo||e instanceof Bm)&&(e.rounding=t);for(const e of this.lines)e.rounding=t;for(const e of this.fills)e.rounding=t;for(const e of this.volumes)e.rounding=t;this.onStateChanged.trigger(["rounding"])}get rounding(){return this._rounding}set linesEndpointElement(t){this._linesEndpointElement=t;for(const e of this.lines)e.endpointElement=t}get linesEndpointElement(){return this._linesEndpointElement}set linesMaterial(t){this._linesMaterial.dispose(),this._linesMaterial=t;for(const e of this.lines)e.material=t}get linesMaterial(){return this._linesMaterial}set fillsMaterial(t){this._fillsMaterial.dispose(),this._fillsMaterial=t;for(const e of this.fills)e.material=t}get fillsMaterial(){return this._fillsMaterial}set volumesMaterial(t){this._volumesMaterial.dispose(),this._volumesMaterial=t;for(const e of this.volumes)e.material=t}get volumesMaterial(){return this._volumesMaterial}set color(t){this._color=t,this._linesMaterial.color.set(t),this._fillsMaterial.color.set(t),this._volumesMaterial.color.set(t);for(const e of this.lines)e.color=t;for(const e of this.fills)e.color=t;for(const e of this.volumes)e.color=t;this.onStateChanged.trigger(["color"])}get color(){return this._color}dispose(){this._vertexPicker.dispose(),this.list.clear(),this.linesMaterial.dispose(),this.fillsMaterial.dispose(),this.volumesMaterial.dispose(),this.onDisposed.trigger()}createLineElement(t,e=null){if(!this.world)throw new Error("Measurement: world is need!");return new gU(this.components,this.world,{line:t,startNormal:e??void 0,lineMaterial:this.linesMaterial,endpointElement:this.linesEndpointElement},this.rounding,this.units)}createFillElement(t){if(!this.world)throw new Error("Measurement: world is need!");const e=new bU(this.components,this.world,t);return e.rounding=this.rounding,(this.units.endsWith("2")?"area":void 0)==="area"&&(e.units=this.units),e}createVolumeElement(t){if(!this.world)throw new Error("Measurement: world is need!");const e=new bS(this.components,this.world,t);return e.rounding=this.rounding,(this.units.endsWith("3")?"volume":void 0)==="volume"&&(e.units=this.units),e}addLineElementsFromPoints(t){for(let e=0;e<t.length;e++){const s=t[e],i=t[(e+1)%t.length],r=new Lo(s,i),o=this.createLineElement(r);o.label.visible=!1,this.lines.add(o)}}getLineBoxes(){const t=[];for(const e of this.lines)t.push(e.boundingBox);return t}getFillBoxes(){const t=[];for(const e of this.fills)t.push(e.three);return t}async getVolumeBoxes(){const t=[];for(const e of this.volumes)t.push(e.meshes);return t}};const yU=class _S extends Pv{constructor(t){super(t,"area"),G(this,"pickTolerance",.1),G(this,"tolerance",.005),G(this,"modes",["free","square"]),G(this,"_mode","free"),G(this,"_temp",{isDragging:!1,area:new Bm,lines:new fe,point:new F}),G(this,"computeLineElements",()=>{this._temp.lines.clear();const e=[...this._temp.area.points];if(this._temp.area.isPointInPlane(this._temp.point)&&e.push(this._temp.point),!(e.length<2||!this.world))for(let s=0;s<e.length;s++){const i=e[s],r=e[(s+1)%e.length],o=new Lo(i,r),a=this.createLineElement(o);this._temp.lines.add(a)}}),G(this,"create",async()=>{if(!this.enabled)return;if(!this.world)throw new Error("Area Measurement: world is not defined!");const e=await this._vertexPicker.get({snappingClasses:this.snappings});if(!(e&&e.point))return;const{area:s,point:i}=this._temp;if(this._temp.isDragging||(s.tolerance=this.tolerance,s.points.clear(),this._temp.isDragging=!0),s.points.size===0&&i.copy(e.point),s.points.add(i.clone()),this.mode==="square"&&s.points.size===2&&e.normal){const[r,o]=s.points,a=new F().subVectors(o,r),l=a.clone(),c=a.clone().negate();Math.abs(a.y)>=.1?(l.y=0,c.y=0):(l.x=0,c.x=0);const h=r.clone().add(l),u=o.clone().add(c);s.points.clear(),s.points.add(r,h,o,u),this.endCreation()}}),G(this,"endCreation",()=>{this.enabled&&(this._temp.isDragging=!1,this._temp.area.points.size>=3&&this.list.add(this._temp.area.clone()),this._temp.area.points.clear(),this._temp.lines.clear())}),G(this,"cancelCreation",()=>{this.enabled&&(this._temp.isDragging=!1,this._temp.area.points.clear(),this._temp.lines.clear())}),G(this,"delete",()=>{if(!this.enabled||this.list.size===0||!this.world)return;const e=this.getFillBoxes(),s=this.components.get(ln).get(this.world).castRayToObjects(e),i=this.components.get(mr);for(const o of e)i.destroy(o);if(!s)return;const r=[...this.fills].find(o=>o.three===s.object);r&&(this.list.delete(r.area),this.lines.clear())}),t.add(_S.uuid,this),this.initHandlers(),this.color=new Dt("#6528d7")}get mode(){return this._mode}set mode(t){this._mode=t,this.cancelCreation(),this.onStateChanged.trigger(["mode"])}initHandlers(){this.onVisibilityChange.add(()=>{for(const t of this.lines)t.label.visible=!1}),this.list.onItemAdded.add(t=>{if(!this.world)return;const e=this.createFillElement(t);e.color=this.color,this.fills.add(e),this.addLineElementsFromPoints([...t.points])}),this.list.onBeforeDelete.add(t=>{const e=[...this.fills].find(s=>s.area===t);e&&this.fills.delete(e)}),this.onPointerStop.add(()=>this.updatePreview()),this._temp.lines.onItemAdded.add(t=>t.label.visible=!1),this._temp.lines.onBeforeDelete.add(t=>t.dispose()),this._temp.area.points.onItemAdded.add(()=>{this.computeLineElements()}),this._temp.area.points.onItemDeleted.add(()=>{this._temp.lines.clear()})}async updatePreview(){if(!this.enabled||!this.world)throw new Error("Measurement is not enabled or world is not defined!");const t=await this._vertexPicker.get({snappingClasses:this.snappings});if(!(t&&t.point&&this._temp.isDragging))return;const e=t.point.clone(),{plane:s}=this._temp.area;if(s){const i=s.distanceToPoint(e);if(Math.abs(i)<.1){const r=new F;s.projectPoint(e,r),e.copy(r)}}this._temp.point.copy(e),this.computeLineElements()}};G(yU,"uuid","09b78c1f-0ff1-4630-a818-ceda3d878c75");const yS=class vS extends Pv{constructor(t){super(t,"length"),G(this,"_temp",{isDragging:!1,line:new Lo}),G(this,"modes",["free","edge"]),G(this,"_mode","free"),G(this,"create",()=>{if(this.enabled){if(!this._temp.isDragging){this.initPreview();return}this.endCreation()}}),G(this,"endCreation",()=>{this.enabled&&this._temp.dimension&&(this.list.add(this._temp.line.clone()),this.mode==="free"&&(this._temp.dimension.dispose(),this._temp.dimension=void 0,this._temp.isDragging=!1,this._temp.startNormal=void 0))}),G(this,"cancelCreation",()=>{var e;this.enabled&&(this._temp.isDragging=!1,this._temp.dimension&&((e=this._temp.dimension)==null||e.dispose(),this._temp.dimension=void 0))}),G(this,"delete",()=>{if(!this.enabled||this.list.size===0||!this.world)return;const e=this.getLineBoxes(),s=this.components.get(ln).get(this.world).castRayToObjects(e);if(!s)return;const i=[...this.lines].find(r=>r.boundingBox===s.object);i&&this.list.delete(i.line)}),t.add(vS.uuid,this),this.initHandlers()}get mode(){return this._mode}set mode(t){this._mode=t,this.cancelCreation(),t==="edge"&&this.initPreview(),this.onStateChanged.trigger(["mode"])}initHandlers(){this.list.onItemAdded.add(t=>{const e=this.createLineElement(t,this._temp.startNormal);e.createBoundingBox(),this.lines.add(e)}),this.list.onBeforeDelete.add(t=>{const e=[...this.lines].find(s=>s.line===t);e&&this.lines.delete(e)}),this.onPointerStop.add(()=>this.updatePreviewLine()),this.onEnabledChange.add(t=>{t&&this.mode==="edge"&&this.initPreview()})}async initPreview(){if(!this.world)throw new Error("Measurement: world is need!");const t=await this._vertexPicker.get({snappingClasses:this.snappings});if(this.mode==="free"){if(!(t!=null&&t.point))return;const e=t.point;this._temp.line.set(e,e.clone()),this._temp.isDragging=!0,this._temp.dimension=this.createLineElement(this._temp.line),this._temp.startNormal=t.normal??void 0}else if(this.mode==="edge"){const e=t?.snappedEdgeP1,s=t?.snappedEdgeP2,i=e||new F,r=i||s;this._temp.line.set(i,r),this._temp.isDragging=!0,this._temp.dimension=this.createLineElement(this._temp.line),this._temp.dimension.visible=!!(e&&s)}}async updatePreviewLine(){if(!this.world)throw new Error("Measurement: world is need!");const t=await this._vertexPicker.get({snappingClasses:this.snappings});if(this.mode==="free"){if(!(t!=null&&t.point)||(this._temp.line.end.copy(t.point),!this._temp.dimension))return;this._temp.dimension.end=this._temp.line.end}else if(this.mode==="edge"){const e=t?.snappedEdgeP1,s=t?.snappedEdgeP2;if(this._temp.dimension&&(this._temp.dimension.visible=!!(e&&s)),!(e&&s)||(this._temp.line.start.copy(e),this._temp.line.end.copy(s),!this._temp.dimension))return;this._temp.dimension.start=this._temp.line.start,this._temp.dimension.end=this._temp.line.end}}};G(yS,"uuid","2f9bcacf-18a9-4be6-a293-e898eae64ea1");let GZ=yS;const vU=class wS extends Pv{constructor(t){super(t,"volume"),G(this,"_temp",{}),G(this,"modes",["free"]),G(this,"_mode","free"),G(this,"_previousHovererState",!1),G(this,"create",async()=>{if(!this.enabled)return;const e=await this._vertexPicker.get();e&&(this._temp.preview||this.initPreview(),this._temp.preview.volume.items=Qe.join([this._temp.preview.volume.items,{[e.fragments.modelId]:new Set([e.localId])}]))}),G(this,"endCreation",()=>{if(!this._temp.preview||Qe.isEmpty(this._temp.preview.volume.items))return;const e=this._temp.preview.volume.clone();this.list.add(e),this._temp.preview.dispose(),delete this._temp.preview}),G(this,"cancelCreation",()=>{var e;(e=this._temp.preview)==null||e.dispose(),delete this._temp.preview}),G(this,"delete",async()=>{if(this.list.size===0||!this.world)return;const e=await this.getVolumeBoxes(),s=this.components.get(ln).get(this.world);for(const i of e){const r=s.castRayToObjects(i);if(!r)continue;const o=[...this.volumes].find(a=>a.meshes.some(l=>l===r.object));if(!o)return;this.list.delete(o.volume)}}),t.add(wS.uuid,this),this.initHandlers()}get mode(){return this._mode}set mode(t){this._mode=t,this.cancelCreation(),this.onStateChanged.trigger(["mode"])}initHandlers(){this.list.onItemAdded.add(t=>{const e=this.createVolumeElement(t);e.color=this.color,e.rounding=this.rounding,e.units=this.units,this.volumes.add(e)}),this.list.onBeforeDelete.add(t=>{const e=[...this.volumes].find(s=>s.volume===t);e&&this.volumes.delete(e)}),this.onStateChanged.add(t=>{if(t.includes("color")){if(!this._temp.preview)return;this._temp.preview.color=this.color}if(t.includes("enabled")){const e=this.components.get(cU);e.world=this.world,this.enabled?(this._previousHovererState=e.enabled,e.enabled=!0):(e.clear(),e.enabled=this._previousHovererState),e.hover()}})}async initPreview(){if(this.enabled){if(!this.world)throw new Error("Measurement: world is need!");this._temp.preview=new bS(this.components,this.world),this._temp.preview.color=this.color,this._temp.preview.rounding=this.rounding,this._temp.preview.units=this.units}}};G(vU,"uuid","01f885ab-ec4e-4e6c-a853-9dfc0d6766ed");var wU=Object.defineProperty,EU=(n,t,e)=>t in n?wU(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,ua=(n,t,e)=>(EU(n,typeof t!="symbol"?t+"":t,e),e);const Pc=Math.min,zr=Math.max,Um=Math.round,Vo=n=>({x:n,y:n}),xU={left:"right",right:"left",bottom:"top",top:"bottom"},IU={start:"end",end:"start"};function mx(n,t,e){return zr(n,Pc(t,e))}function Hd(n,t){return typeof n=="function"?n(t):n}function jr(n){return n.split("-")[0]}function $g(n){return n.split("-")[1]}function ES(n){return n==="x"?"y":"x"}function xS(n){return n==="y"?"height":"width"}const CU=new Set(["top","bottom"]);function Mr(n){return CU.has(jr(n))?"y":"x"}function IS(n){return ES(Mr(n))}function TU(n,t,e){e===void 0&&(e=!1);const s=$g(n),i=IS(n),r=xS(i);let o=i==="x"?s===(e?"end":"start")?"right":"left":s==="start"?"bottom":"top";return t.reference[r]>t.floating[r]&&(o=Vm(o)),[o,Vm(o)]}function AU(n){const t=Vm(n);return[py(n),t,py(t)]}function py(n){return n.replace(/start|end/g,t=>IU[t])}const gx=["left","right"],bx=["right","left"],SU=["top","bottom"],OU=["bottom","top"];function PU(n,t,e){switch(n){case"top":case"bottom":return e?t?bx:gx:t?gx:bx;case"left":case"right":return t?SU:OU;default:return[]}}function RU(n,t,e,s){const i=$g(n);let r=PU(jr(n),e==="start",s);return i&&(r=r.map(o=>o+"-"+i),t&&(r=r.concat(r.map(py)))),r}function Vm(n){return n.replace(/left|right|bottom|top/g,t=>xU[t])}function FU(n){return{top:0,right:0,bottom:0,left:0,...n}}function CS(n){return typeof n!="number"?FU(n):{top:n,right:n,bottom:n,left:n}}function Rc(n){const{x:t,y:e,width:s,height:i}=n;return{width:s,height:i,top:e,left:t,right:t+s,bottom:e+i,x:t,y:e}}function _x(n,t,e){let{reference:s,floating:i}=n;const r=Mr(t),o=IS(t),a=xS(o),l=jr(t),c=r==="y",h=s.x+s.width/2-i.width/2,u=s.y+s.height/2-i.height/2,p=s[a]/2-i[a]/2;let d;switch(l){case"top":d={x:h,y:s.y-i.height};break;case"bottom":d={x:h,y:s.y+s.height};break;case"right":d={x:s.x+s.width,y:u};break;case"left":d={x:s.x-i.width,y:u};break;default:d={x:s.x,y:s.y}}switch($g(t)){case"start":d[o]-=p*(e&&c?-1:1);break;case"end":d[o]+=p*(e&&c?-1:1);break}return d}const LU=async(n,t,e)=>{const{placement:s="bottom",strategy:i="absolute",middleware:r=[],platform:o}=e,a=r.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(t));let c=await o.getElementRects({reference:n,floating:t,strategy:i}),{x:h,y:u}=_x(c,s,l),p=s,d={},g=0;for(let m=0;m<a.length;m++){const{name:b,fn:f}=a[m],{x:_,y,data:v,reset:w}=await f({x:h,y:u,initialPlacement:s,placement:p,strategy:i,middlewareData:d,rects:c,platform:o,elements:{reference:n,floating:t}});h=_??h,u=y??u,d={...d,[b]:{...d[b],...v}},w&&g<=50&&(g++,typeof w=="object"&&(w.placement&&(p=w.placement),w.rects&&(c=w.rects===!0?await o.getElementRects({reference:n,floating:t,strategy:i}):w.rects),{x:h,y:u}=_x(c,p,l)),m=-1)}return{x:h,y:u,placement:p,strategy:i,middlewareData:d}};async function TS(n,t){var e;t===void 0&&(t={});const{x:s,y:i,platform:r,rects:o,elements:a,strategy:l}=n,{boundary:c="clippingAncestors",rootBoundary:h="viewport",elementContext:u="floating",altBoundary:p=!1,padding:d=0}=Hd(t,n),g=CS(d),m=a[p?u==="floating"?"reference":"floating":u],b=Rc(await r.getClippingRect({element:(e=await(r.isElement==null?void 0:r.isElement(m)))==null||e?m:m.contextElement||await(r.getDocumentElement==null?void 0:r.getDocumentElement(a.floating)),boundary:c,rootBoundary:h,strategy:l})),f=u==="floating"?{x:s,y:i,width:o.floating.width,height:o.floating.height}:o.reference,_=await(r.getOffsetParent==null?void 0:r.getOffsetParent(a.floating)),y=await(r.isElement==null?void 0:r.isElement(_))?await(r.getScale==null?void 0:r.getScale(_))||{x:1,y:1}:{x:1,y:1},v=Rc(r.convertOffsetParentRelativeRectToViewportRelativeRect?await r.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:f,offsetParent:_,strategy:l}):f);return{top:(b.top-v.top+g.top)/y.y,bottom:(v.bottom-b.bottom+g.bottom)/y.y,left:(b.left-v.left+g.left)/y.x,right:(v.right-b.right+g.right)/y.x}}const $U=function(n){return n===void 0&&(n={}),{name:"flip",options:n,async fn(t){var e,s;const{placement:i,middlewareData:r,rects:o,initialPlacement:a,platform:l,elements:c}=t,{mainAxis:h=!0,crossAxis:u=!0,fallbackPlacements:p,fallbackStrategy:d="bestFit",fallbackAxisSideDirection:g="none",flipAlignment:m=!0,...b}=Hd(n,t);if((e=r.arrow)!=null&&e.alignmentOffset)return{};const f=jr(i),_=Mr(a),y=jr(a)===a,v=await(l.isRTL==null?void 0:l.isRTL(c.floating)),w=p||(y||!m?[Vm(a)]:AU(a)),I=g!=="none";!p&&I&&w.push(...RU(a,m,g,v));const C=[a,...w],A=await TS(t,b),S=[];let P=((s=r.flip)==null?void 0:s.overflows)||[];if(h&&S.push(A[f]),u){const E=TU(i,o,v);S.push(A[E[0]],A[E[1]])}if(P=[...P,{placement:i,overflows:S}],!S.every(E=>E<=0)){var M,T;const E=(((M=r.flip)==null?void 0:M.index)||0)+1,N=C[E];if(N&&(!(u==="alignment"&&_!==Mr(N))||P.every(V=>V.overflows[0]>0&&Mr(V.placement)===_)))return{data:{index:E,overflows:P},reset:{placement:N}};let W=(T=P.filter(V=>V.overflows[0]<=0).sort((V,et)=>V.overflows[1]-et.overflows[1])[0])==null?void 0:T.placement;if(!W)switch(d){case"bestFit":{var L;const V=(L=P.filter(et=>{if(I){const j=Mr(et.placement);return j===_||j==="y"}return!0}).map(et=>[et.placement,et.overflows.filter(j=>j>0).reduce((j,nt)=>j+nt,0)]).sort((et,j)=>et[1]-j[1])[0])==null?void 0:L[0];V&&(W=V);break}case"initialPlacement":W=a;break}if(i!==W)return{reset:{placement:W}}}return{}}}};function AS(n){const t=Pc(...n.map(r=>r.left)),e=Pc(...n.map(r=>r.top)),s=zr(...n.map(r=>r.right)),i=zr(...n.map(r=>r.bottom));return{x:t,y:e,width:s-t,height:i-e}}function NU(n){const t=n.slice().sort((i,r)=>i.y-r.y),e=[];let s=null;for(let i=0;i<t.length;i++){const r=t[i];!s||r.y-s.y>s.height/2?e.push([r]):e[e.length-1].push(r),s=r}return e.map(i=>Rc(AS(i)))}const MU=function(n){return n===void 0&&(n={}),{name:"inline",options:n,async fn(t){const{placement:e,elements:s,rects:i,platform:r,strategy:o}=t,{padding:a=2,x:l,y:c}=Hd(n,t),h=Array.from(await(r.getClientRects==null?void 0:r.getClientRects(s.reference))||[]),u=NU(h),p=Rc(AS(h)),d=CS(a);function g(){if(u.length===2&&u[0].left>u[1].right&&l!=null&&c!=null)return u.find(b=>l>b.left-d.left&&l<b.right+d.right&&c>b.top-d.top&&c<b.bottom+d.bottom)||p;if(u.length>=2){if(Mr(e)==="y"){const P=u[0],M=u[u.length-1],T=jr(e)==="top",L=P.top,E=M.bottom,N=T?P.left:M.left,W=T?P.right:M.right,V=W-N,et=E-L;return{top:L,bottom:E,left:N,right:W,width:V,height:et,x:N,y:L}}const b=jr(e)==="left",f=zr(...u.map(P=>P.right)),_=Pc(...u.map(P=>P.left)),y=u.filter(P=>b?P.left===_:P.right===f),v=y[0].top,w=y[y.length-1].bottom,I=_,C=f,A=C-I,S=w-v;return{top:v,bottom:w,left:I,right:C,width:A,height:S,x:I,y:v}}return p}const m=await r.getElementRects({reference:{getBoundingClientRect:g},floating:s.floating,strategy:o});return i.reference.x!==m.reference.x||i.reference.y!==m.reference.y||i.reference.width!==m.reference.width||i.reference.height!==m.reference.height?{reset:{rects:m}}:{}}}},DU=new Set(["left","top"]);async function kU(n,t){const{placement:e,platform:s,elements:i}=n,r=await(s.isRTL==null?void 0:s.isRTL(i.floating)),o=jr(e),a=$g(e),l=Mr(e)==="y",c=DU.has(o)?-1:1,h=r&&l?-1:1,u=Hd(t,n);let{mainAxis:p,crossAxis:d,alignmentAxis:g}=typeof u=="number"?{mainAxis:u,crossAxis:0,alignmentAxis:null}:{mainAxis:u.mainAxis||0,crossAxis:u.crossAxis||0,alignmentAxis:u.alignmentAxis};return a&&typeof g=="number"&&(d=a==="end"?g*-1:g),l?{x:d*h,y:p*c}:{x:p*c,y:d*h}}const SS=function(n){return{name:"offset",options:n,async fn(t){var e,s;const{x:i,y:r,placement:o,middlewareData:a}=t,l=await kU(t,n);return o===((e=a.offset)==null?void 0:e.placement)&&(s=a.arrow)!=null&&s.alignmentOffset?{}:{x:i+l.x,y:r+l.y,data:{...l,placement:o}}}}},zU=function(n){return n===void 0&&(n={}),{name:"shift",options:n,async fn(t){const{x:e,y:s,placement:i}=t,{mainAxis:r=!0,crossAxis:o=!1,limiter:a={fn:b=>{let{x:f,y:_}=b;return{x:f,y:_}}},...l}=Hd(n,t),c={x:e,y:s},h=await TS(t,l),u=Mr(jr(i)),p=ES(u);let d=c[p],g=c[u];if(r){const b=p==="y"?"top":"left",f=p==="y"?"bottom":"right",_=d+h[b],y=d-h[f];d=mx(_,d,y)}if(o){const b=u==="y"?"top":"left",f=u==="y"?"bottom":"right",_=g+h[b],y=g-h[f];g=mx(_,g,y)}const m=a.fn({...t,[p]:d,[u]:g});return{...m,data:{x:m.x-e,y:m.y-s,enabled:{[p]:r,[u]:o}}}}}};function Ng(){return typeof window<"u"}function Ho(n){return OS(n)?(n.nodeName||"").toLowerCase():"#document"}function Ti(n){var t;return(n==null||(t=n.ownerDocument)==null?void 0:t.defaultView)||window}function Xo(n){var t;return(t=(OS(n)?n.ownerDocument:n.document)||window.document)==null?void 0:t.documentElement}function OS(n){return Ng()?n instanceof Node||n instanceof Ti(n).Node:!1}function gr(n){return Ng()?n instanceof Element||n instanceof Ti(n).Element:!1}function br(n){return Ng()?n instanceof HTMLElement||n instanceof Ti(n).HTMLElement:!1}function yx(n){return!Ng()||typeof ShadowRoot>"u"?!1:n instanceof ShadowRoot||n instanceof Ti(n).ShadowRoot}const BU=new Set(["inline","contents"]);function jd(n){const{overflow:t,overflowX:e,overflowY:s,display:i}=cn(n);return/auto|scroll|overlay|hidden|clip/.test(t+s+e)&&!BU.has(i)}const UU=new Set(["table","td","th"]);function VU(n){return UU.has(Ho(n))}const HU=[":popover-open",":modal"];function jU(n){return HU.some(t=>{try{return n.matches(t)}catch{return!1}})}const WU=["transform","translate","scale","rotate","perspective"],YU=["transform","translate","scale","rotate","perspective","filter"],GU=["paint","layout","strict","content"];function Rv(n){const t=Fv(),e=gr(n)?cn(n):n;return WU.some(s=>e[s]?e[s]!=="none":!1)||(e.containerType?e.containerType!=="normal":!1)||!t&&(e.backdropFilter?e.backdropFilter!=="none":!1)||!t&&(e.filter?e.filter!=="none":!1)||YU.some(s=>(e.willChange||"").includes(s))||GU.some(s=>(e.contain||"").includes(s))}function qU(n){let t=Fc(n);for(;br(t)&&!Mg(t);){if(Rv(t))return t;if(jU(t))return null;t=Fc(t)}return null}function Fv(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const ZU=new Set(["html","body","#document"]);function Mg(n){return ZU.has(Ho(n))}function cn(n){return Ti(n).getComputedStyle(n)}function Dg(n){return gr(n)?{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}:{scrollLeft:n.scrollX,scrollTop:n.scrollY}}function Fc(n){if(Ho(n)==="html")return n;const t=n.assignedSlot||n.parentNode||yx(n)&&n.host||Xo(n);return yx(t)?t.host:t}function PS(n){const t=Fc(n);return Mg(t)?n.ownerDocument?n.ownerDocument.body:n.body:br(t)&&jd(t)?t:PS(t)}function RS(n,t,e){var s;t===void 0&&(t=[]);const i=PS(n),r=i===((s=n.ownerDocument)==null?void 0:s.body),o=Ti(i);return r?(XU(o),t.concat(o,o.visualViewport||[],jd(i)?i:[],[])):t.concat(i,RS(i,[]))}function XU(n){return n.parent&&Object.getPrototypeOf(n.parent)?n.frameElement:null}function FS(n){const t=cn(n);let e=parseFloat(t.width)||0,s=parseFloat(t.height)||0;const i=br(n),r=i?n.offsetWidth:e,o=i?n.offsetHeight:s,a=Um(e)!==r||Um(s)!==o;return a&&(e=r,s=o),{width:e,height:s,$:a}}function LS(n){return gr(n)?n:n.contextElement}function vc(n){const t=LS(n);if(!br(t))return Vo(1);const e=t.getBoundingClientRect(),{width:s,height:i,$:r}=FS(t);let o=(r?Um(e.width):e.width)/s,a=(r?Um(e.height):e.height)/i;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const QU=Vo(0);function $S(n){const t=Ti(n);return!Fv()||!t.visualViewport?QU:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function KU(n,t,e){return t===void 0&&(t=!1),!e||t&&e!==Ti(n)?!1:t}function gd(n,t,e,s){t===void 0&&(t=!1),e===void 0&&(e=!1);const i=n.getBoundingClientRect(),r=LS(n);let o=Vo(1);t&&(s?gr(s)&&(o=vc(s)):o=vc(n));const a=KU(r,e,s)?$S(r):Vo(0);let l=(i.left+a.x)/o.x,c=(i.top+a.y)/o.y,h=i.width/o.x,u=i.height/o.y;if(r){const p=Ti(r),d=s&&gr(s)?Ti(s):s;let g=p,m=g.frameElement;for(;m&&s&&d!==g;){const b=vc(m),f=m.getBoundingClientRect(),_=cn(m),y=f.left+(m.clientLeft+parseFloat(_.paddingLeft))*b.x,v=f.top+(m.clientTop+parseFloat(_.paddingTop))*b.y;l*=b.x,c*=b.y,h*=b.x,u*=b.y,l+=y,c+=v,g=Ti(m),m=g.frameElement}}return Rc({width:h,height:u,x:l,y:c})}const JU=[":popover-open",":modal"];function NS(n){return JU.some(t=>{try{return n.matches(t)}catch{return!1}})}function t8(n){let{elements:t,rect:e,offsetParent:s,strategy:i}=n;const r=i==="fixed",o=Xo(s),a=t?NS(t.floating):!1;if(s===o||a&&r)return e;let l={scrollLeft:0,scrollTop:0},c=Vo(1);const h=Vo(0),u=br(s);if((u||!u&&!r)&&((Ho(s)!=="body"||jd(o))&&(l=Dg(s)),br(s))){const p=gd(s);c=vc(s),h.x=p.x+s.clientLeft,h.y=p.y+s.clientTop}return{width:e.width*c.x,height:e.height*c.y,x:e.x*c.x-l.scrollLeft*c.x+h.x,y:e.y*c.y-l.scrollTop*c.y+h.y}}function e8(n){return Array.from(n.getClientRects())}function MS(n){return gd(Xo(n)).left+Dg(n).scrollLeft}function s8(n){const t=Xo(n),e=Dg(n),s=n.ownerDocument.body,i=zr(t.scrollWidth,t.clientWidth,s.scrollWidth,s.clientWidth),r=zr(t.scrollHeight,t.clientHeight,s.scrollHeight,s.clientHeight);let o=-e.scrollLeft+MS(n);const a=-e.scrollTop;return cn(s).direction==="rtl"&&(o+=zr(t.clientWidth,s.clientWidth)-i),{width:i,height:r,x:o,y:a}}function i8(n,t){const e=Ti(n),s=Xo(n),i=e.visualViewport;let r=s.clientWidth,o=s.clientHeight,a=0,l=0;if(i){r=i.width,o=i.height;const c=Fv();(!c||c&&t==="fixed")&&(a=i.offsetLeft,l=i.offsetTop)}return{width:r,height:o,x:a,y:l}}function n8(n,t){const e=gd(n,!0,t==="fixed"),s=e.top+n.clientTop,i=e.left+n.clientLeft,r=br(n)?vc(n):Vo(1),o=n.clientWidth*r.x,a=n.clientHeight*r.y,l=i*r.x,c=s*r.y;return{width:o,height:a,x:l,y:c}}function vx(n,t,e){let s;if(t==="viewport")s=i8(n,e);else if(t==="document")s=s8(Xo(n));else if(gr(t))s=n8(t,e);else{const i=$S(n);s={...t,x:t.x-i.x,y:t.y-i.y}}return Rc(s)}function DS(n,t){const e=Fc(n);return e===t||!gr(e)||Mg(e)?!1:cn(e).position==="fixed"||DS(e,t)}function r8(n,t){const e=t.get(n);if(e)return e;let s=RS(n,[]).filter(a=>gr(a)&&Ho(a)!=="body"),i=null;const r=cn(n).position==="fixed";let o=r?Fc(n):n;for(;gr(o)&&!Mg(o);){const a=cn(o),l=Rv(o);!l&&a.position==="fixed"&&(i=null),(r?!l&&!i:!l&&a.position==="static"&&i&&["absolute","fixed"].includes(i.position)||jd(o)&&!l&&DS(n,o))?s=s.filter(c=>c!==o):i=a,o=Fc(o)}return t.set(n,s),s}function o8(n){let{element:t,boundary:e,rootBoundary:s,strategy:i}=n;const r=[...e==="clippingAncestors"?r8(t,this._c):[].concat(e),s],o=r[0],a=r.reduce((l,c)=>{const h=vx(t,c,i);return l.top=zr(h.top,l.top),l.right=Pc(h.right,l.right),l.bottom=Pc(h.bottom,l.bottom),l.left=zr(h.left,l.left),l},vx(t,o,i));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}}function a8(n){const{width:t,height:e}=FS(n);return{width:t,height:e}}function l8(n,t,e){const s=br(t),i=Xo(t),r=e==="fixed",o=gd(n,!0,r,t);let a={scrollLeft:0,scrollTop:0};const l=Vo(0);if(s||!s&&!r)if((Ho(t)!=="body"||jd(i))&&(a=Dg(t)),s){const u=gd(t,!0,r,t);l.x=u.x+t.clientLeft,l.y=u.y+t.clientTop}else i&&(l.x=MS(i));const c=o.left+a.scrollLeft-l.x,h=o.top+a.scrollTop-l.y;return{x:c,y:h,width:o.width,height:o.height}}function wx(n,t){return!br(n)||cn(n).position==="fixed"?null:t?t(n):n.offsetParent}function kS(n,t){const e=Ti(n);if(!br(n)||NS(n))return e;let s=wx(n,t);for(;s&&VU(s)&&cn(s).position==="static";)s=wx(s,t);return s&&(Ho(s)==="html"||Ho(s)==="body"&&cn(s).position==="static"&&!Rv(s))?e:s||qU(n)||e}const c8=async function(n){const t=this.getOffsetParent||kS,e=this.getDimensions;return{reference:l8(n.reference,await t(n.floating),n.strategy),floating:{x:0,y:0,...await e(n.floating)}}};function h8(n){return cn(n).direction==="rtl"}const u8={convertOffsetParentRelativeRectToViewportRelativeRect:t8,getDocumentElement:Xo,getClippingRect:o8,getOffsetParent:kS,getElementRects:c8,getClientRects:e8,getDimensions:a8,getScale:vc,isElement:gr,isRTL:h8},zS=zU,BS=$U,US=MU,VS=(n,t,e)=>{const s=new Map,i={platform:u8,...e},r={...i.platform,_c:s};return LU(n,t,{...i,platform:r})};/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const gm=globalThis,Lv=gm.ShadowRoot&&(gm.ShadyCSS===void 0||gm.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,$v=Symbol(),Ex=new WeakMap;let HS=class{constructor(t,e,s){if(this._$cssResult$=!0,s!==$v)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=e}get styleSheet(){let t=this.o;const e=this.t;if(Lv&&t===void 0){const s=e!==void 0&&e.length===1;s&&(t=Ex.get(e)),t===void 0&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),s&&Ex.set(e,t))}return t}toString(){return this.cssText}};const d8=n=>new HS(typeof n=="string"?n:n+"",void 0,$v),ce=(n,...t)=>{const e=n.length===1?n[0]:t.reduce((s,i,r)=>s+(o=>{if(o._$cssResult$===!0)return o.cssText;if(typeof o=="number")return o;throw Error("Value passed to 'css' function must be a 'css' function result: "+o+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+n[r+1],n[0]);return new HS(e,n,$v)},p8=(n,t)=>{if(Lv)n.adoptedStyleSheets=t.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(const e of t){const s=document.createElement("style"),i=gm.litNonce;i!==void 0&&s.setAttribute("nonce",i),s.textContent=e.cssText,n.appendChild(s)}},xx=Lv?n=>n:n=>n instanceof CSSStyleSheet?(t=>{let e="";for(const s of t.cssRules)e+=s.cssText;return d8(e)})(n):n;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:f8,defineProperty:m8,getOwnPropertyDescriptor:g8,getOwnPropertyNames:b8,getOwnPropertySymbols:_8,getPrototypeOf:y8}=Object,Lc=globalThis,Ix=Lc.trustedTypes,v8=Ix?Ix.emptyScript:"",Cx=Lc.reactiveElementPolyfillSupport,qu=(n,t)=>n,Hm={toAttribute(n,t){switch(t){case Boolean:n=n?v8:null;break;case Object:case Array:n=n==null?n:JSON.stringify(n)}return n},fromAttribute(n,t){let e=n;switch(t){case Boolean:e=n!==null;break;case Number:e=n===null?null:Number(n);break;case Object:case Array:try{e=JSON.parse(n)}catch{e=null}}return e}},Nv=(n,t)=>!f8(n,t),Tx={attribute:!0,type:String,converter:Hm,reflect:!1,useDefault:!1,hasChanged:Nv};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),Lc.litPropertyMetadata??(Lc.litPropertyMetadata=new WeakMap);let oc=class extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??(this.l=[])).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,e=Tx){if(e.state&&(e.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(t)&&((e=Object.create(e)).wrapped=!0),this.elementProperties.set(t,e),!e.noAccessor){const s=Symbol(),i=this.getPropertyDescriptor(t,s,e);i!==void 0&&m8(this.prototype,t,i)}}static getPropertyDescriptor(t,e,s){const{get:i,set:r}=g8(this.prototype,t)??{get(){return this[e]},set(o){this[e]=o}};return{get:i,set(o){const a=i?.call(this);r?.call(this,o),this.requestUpdate(t,a,s)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??Tx}static _$Ei(){if(this.hasOwnProperty(qu("elementProperties")))return;const t=y8(this);t.finalize(),t.l!==void 0&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(qu("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(qu("properties"))){const e=this.properties,s=[...b8(e),..._8(e)];for(const i of s)this.createProperty(i,e[i])}const t=this[Symbol.metadata];if(t!==null){const e=litPropertyMetadata.get(t);if(e!==void 0)for(const[s,i]of e)this.elementProperties.set(s,i)}this._$Eh=new Map;for(const[e,s]of this.elementProperties){const i=this._$Eu(e,s);i!==void 0&&this._$Eh.set(i,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){const e=[];if(Array.isArray(t)){const s=new Set(t.flat(1/0).reverse());for(const i of s)e.unshift(xx(i))}else t!==void 0&&e.push(xx(t));return e}static _$Eu(t,e){const s=e.attribute;return s===!1?void 0:typeof s=="string"?s:typeof t=="string"?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var t;this._$ES=new Promise(e=>this.enableUpdating=e),this._$AL=new Map,this._$E_(),this.requestUpdate(),(t=this.constructor.l)==null||t.forEach(e=>e(this))}addController(t){var e;(this._$EO??(this._$EO=new Set)).add(t),this.renderRoot!==void 0&&this.isConnected&&((e=t.hostConnected)==null||e.call(t))}removeController(t){var e;(e=this._$EO)==null||e.delete(t)}_$E_(){const t=new Map,e=this.constructor.elementProperties;for(const s of e.keys())this.hasOwnProperty(s)&&(t.set(s,this[s]),delete this[s]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return p8(t,this.constructor.elementStyles),t}connectedCallback(){var t;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(t=this._$EO)==null||t.forEach(e=>{var s;return(s=e.hostConnected)==null?void 0:s.call(e)})}enableUpdating(t){}disconnectedCallback(){var t;(t=this._$EO)==null||t.forEach(e=>{var s;return(s=e.hostDisconnected)==null?void 0:s.call(e)})}attributeChangedCallback(t,e,s){this._$AK(t,s)}_$ET(t,e){var s;const i=this.constructor.elementProperties.get(t),r=this.constructor._$Eu(t,i);if(r!==void 0&&i.reflect===!0){const o=(((s=i.converter)==null?void 0:s.toAttribute)!==void 0?i.converter:Hm).toAttribute(e,i.type);this._$Em=t,o==null?this.removeAttribute(r):this.setAttribute(r,o),this._$Em=null}}_$AK(t,e){var s,i;const r=this.constructor,o=r._$Eh.get(t);if(o!==void 0&&this._$Em!==o){const a=r.getPropertyOptions(o),l=typeof a.converter=="function"?{fromAttribute:a.converter}:((s=a.converter)==null?void 0:s.fromAttribute)!==void 0?a.converter:Hm;this._$Em=o,this[o]=l.fromAttribute(e,a.type)??((i=this._$Ej)==null?void 0:i.get(o))??null,this._$Em=null}}requestUpdate(t,e,s){var i;if(t!==void 0){const r=this.constructor,o=this[t];if(s??(s=r.getPropertyOptions(t)),!((s.hasChanged??Nv)(o,e)||s.useDefault&&s.reflect&&o===((i=this._$Ej)==null?void 0:i.get(t))&&!this.hasAttribute(r._$Eu(t,s))))return;this.C(t,e,s)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(t,e,{useDefault:s,reflect:i,wrapped:r},o){s&&!(this._$Ej??(this._$Ej=new Map)).has(t)&&(this._$Ej.set(t,o??e??this[t]),r!==!0||o!==void 0)||(this._$AL.has(t)||(this.hasUpdated||s||(e=void 0),this._$AL.set(t,e)),i===!0&&this._$Em!==t&&(this._$Eq??(this._$Eq=new Set)).add(t))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}const t=this.scheduleUpdate();return t!=null&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var t;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[r,o]of this._$Ep)this[r]=o;this._$Ep=void 0}const i=this.constructor.elementProperties;if(i.size>0)for(const[r,o]of i){const{wrapped:a}=o,l=this[r];a!==!0||this._$AL.has(r)||l===void 0||this.C(r,void 0,o,l)}}let e=!1;const s=this._$AL;try{e=this.shouldUpdate(s),e?(this.willUpdate(s),(t=this._$EO)==null||t.forEach(i=>{var r;return(r=i.hostUpdate)==null?void 0:r.call(i)}),this.update(s)):this._$EM()}catch(i){throw e=!1,this._$EM(),i}e&&this._$AE(s)}willUpdate(t){}_$AE(t){var e;(e=this._$EO)==null||e.forEach(s=>{var i;return(i=s.hostUpdated)==null?void 0:i.call(s)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Eq&&(this._$Eq=this._$Eq.forEach(e=>this._$ET(e,this[e]))),this._$EM()}updated(t){}firstUpdated(t){}};oc.elementStyles=[],oc.shadowRootOptions={mode:"open"},oc[qu("elementProperties")]=new Map,oc[qu("finalized")]=new Map,Cx?.({ReactiveElement:oc}),(Lc.reactiveElementVersions??(Lc.reactiveElementVersions=[])).push("2.1.0");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const jm=globalThis,Wm=jm.trustedTypes,Ax=Wm?Wm.createPolicy("lit-html",{createHTML:n=>n}):void 0,jS="$lit$",vo=`lit$${Math.random().toFixed(9).slice(2)}$`,WS="?"+vo,w8=`<${WS}>`,Qa=document,bd=()=>Qa.createComment(""),_d=n=>n===null||typeof n!="object"&&typeof n!="function",Mv=Array.isArray,E8=n=>Mv(n)||typeof n?.[Symbol.iterator]=="function",N_=`[ 	
\f\r]`,iu=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Sx=/-->/g,Ox=/>/g,da=RegExp(`>|${N_}(?:([^\\s"'>=/]+)(${N_}*=${N_}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Px=/'/g,Rx=/"/g,YS=/^(?:script|style|textarea|title)$/i,x8=n=>(t,...e)=>({_$litType$:n,strings:t,values:e}),At=x8(1),$c=Symbol.for("lit-noChange"),Ze=Symbol.for("lit-nothing"),Fx=new WeakMap,Fa=Qa.createTreeWalker(Qa,129);function GS(n,t){if(!Mv(n)||!n.hasOwnProperty("raw"))throw Error("invalid template strings array");return Ax!==void 0?Ax.createHTML(t):t}const I8=(n,t)=>{const e=n.length-1,s=[];let i,r=t===2?"<svg>":t===3?"<math>":"",o=iu;for(let a=0;a<e;a++){const l=n[a];let c,h,u=-1,p=0;for(;p<l.length&&(o.lastIndex=p,h=o.exec(l),h!==null);)p=o.lastIndex,o===iu?h[1]==="!--"?o=Sx:h[1]!==void 0?o=Ox:h[2]!==void 0?(YS.test(h[2])&&(i=RegExp("</"+h[2],"g")),o=da):h[3]!==void 0&&(o=da):o===da?h[0]===">"?(o=i??iu,u=-1):h[1]===void 0?u=-2:(u=o.lastIndex-h[2].length,c=h[1],o=h[3]===void 0?da:h[3]==='"'?Rx:Px):o===Rx||o===Px?o=da:o===Sx||o===Ox?o=iu:(o=da,i=void 0);const d=o===da&&n[a+1].startsWith("/>")?" ":"";r+=o===iu?l+w8:u>=0?(s.push(c),l.slice(0,u)+jS+l.slice(u)+vo+d):l+vo+(u===-2?a:d)}return[GS(n,r+(n[e]||"<?>")+(t===2?"</svg>":t===3?"</math>":"")),s]};let fy=class qS{constructor({strings:t,_$litType$:e},s){let i;this.parts=[];let r=0,o=0;const a=t.length-1,l=this.parts,[c,h]=I8(t,e);if(this.el=qS.createElement(c,s),Fa.currentNode=this.el.content,e===2||e===3){const u=this.el.content.firstChild;u.replaceWith(...u.childNodes)}for(;(i=Fa.nextNode())!==null&&l.length<a;){if(i.nodeType===1){if(i.hasAttributes())for(const u of i.getAttributeNames())if(u.endsWith(jS)){const p=h[o++],d=i.getAttribute(u).split(vo),g=/([.?@])?(.*)/.exec(p);l.push({type:1,index:r,name:g[2],strings:d,ctor:g[1]==="."?T8:g[1]==="?"?A8:g[1]==="@"?S8:kg}),i.removeAttribute(u)}else u.startsWith(vo)&&(l.push({type:6,index:r}),i.removeAttribute(u));if(YS.test(i.tagName)){const u=i.textContent.split(vo),p=u.length-1;if(p>0){i.textContent=Wm?Wm.emptyScript:"";for(let d=0;d<p;d++)i.append(u[d],bd()),Fa.nextNode(),l.push({type:2,index:++r});i.append(u[p],bd())}}}else if(i.nodeType===8)if(i.data===WS)l.push({type:2,index:r});else{let u=-1;for(;(u=i.data.indexOf(vo,u+1))!==-1;)l.push({type:7,index:r}),u+=vo.length-1}r++}}static createElement(t,e){const s=Qa.createElement("template");return s.innerHTML=t,s}};function Nc(n,t,e=n,s){var i,r;if(t===$c)return t;let o=s!==void 0?(i=e._$Co)==null?void 0:i[s]:e._$Cl;const a=_d(t)?void 0:t._$litDirective$;return o?.constructor!==a&&((r=o?._$AO)==null||r.call(o,!1),a===void 0?o=void 0:(o=new a(n),o._$AT(n,e,s)),s!==void 0?(e._$Co??(e._$Co=[]))[s]=o:e._$Cl=o),o!==void 0&&(t=Nc(n,o._$AS(n,t.values),o,s)),t}let C8=class{constructor(t,e){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:e},parts:s}=this._$AD,i=(t?.creationScope??Qa).importNode(e,!0);Fa.currentNode=i;let r=Fa.nextNode(),o=0,a=0,l=s[0];for(;l!==void 0;){if(o===l.index){let c;l.type===2?c=new Dv(r,r.nextSibling,this,t):l.type===1?c=new l.ctor(r,l.name,l.strings,this,t):l.type===6&&(c=new O8(r,this,t)),this._$AV.push(c),l=s[++a]}o!==l?.index&&(r=Fa.nextNode(),o++)}return Fa.currentNode=Qa,i}p(t){let e=0;for(const s of this._$AV)s!==void 0&&(s.strings!==void 0?(s._$AI(t,s,e),e+=s.strings.length-2):s._$AI(t[e])),e++}},Dv=class ZS{get _$AU(){var t;return((t=this._$AM)==null?void 0:t._$AU)??this._$Cv}constructor(t,e,s,i){this.type=2,this._$AH=Ze,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=s,this.options=i,this._$Cv=i?.isConnected??!0}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return e!==void 0&&t?.nodeType===11&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=Nc(this,t,e),_d(t)?t===Ze||t==null||t===""?(this._$AH!==Ze&&this._$AR(),this._$AH=Ze):t!==this._$AH&&t!==$c&&this._(t):t._$litType$!==void 0?this.$(t):t.nodeType!==void 0?this.T(t):E8(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==Ze&&_d(this._$AH)?this._$AA.nextSibling.data=t:this.T(Qa.createTextNode(t)),this._$AH=t}$(t){var e;const{values:s,_$litType$:i}=t,r=typeof i=="number"?this._$AC(t):(i.el===void 0&&(i.el=fy.createElement(GS(i.h,i.h[0]),this.options)),i);if(((e=this._$AH)==null?void 0:e._$AD)===r)this._$AH.p(s);else{const o=new C8(r,this),a=o.u(this.options);o.p(s),this.T(a),this._$AH=o}}_$AC(t){let e=Fx.get(t.strings);return e===void 0&&Fx.set(t.strings,e=new fy(t)),e}k(t){Mv(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let s,i=0;for(const r of t)i===e.length?e.push(s=new ZS(this.O(bd()),this.O(bd()),this,this.options)):s=e[i],s._$AI(r),i++;i<e.length&&(this._$AR(s&&s._$AB.nextSibling,i),e.length=i)}_$AR(t=this._$AA.nextSibling,e){var s;for((s=this._$AP)==null?void 0:s.call(this,!1,!0,e);t&&t!==this._$AB;){const i=t.nextSibling;t.remove(),t=i}}setConnected(t){var e;this._$AM===void 0&&(this._$Cv=t,(e=this._$AP)==null||e.call(this,t))}},kg=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,e,s,i,r){this.type=1,this._$AH=Ze,this._$AN=void 0,this.element=t,this.name=e,this._$AM=i,this.options=r,s.length>2||s[0]!==""||s[1]!==""?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=Ze}_$AI(t,e=this,s,i){const r=this.strings;let o=!1;if(r===void 0)t=Nc(this,t,e,0),o=!_d(t)||t!==this._$AH&&t!==$c,o&&(this._$AH=t);else{const a=t;let l,c;for(t=r[0],l=0;l<r.length-1;l++)c=Nc(this,a[s+l],e,l),c===$c&&(c=this._$AH[l]),o||(o=!_d(c)||c!==this._$AH[l]),c===Ze?t=Ze:t!==Ze&&(t+=(c??"")+r[l+1]),this._$AH[l]=c}o&&!i&&this.j(t)}j(t){t===Ze?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}},T8=class extends kg{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===Ze?void 0:t}},A8=class extends kg{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==Ze)}},S8=class extends kg{constructor(t,e,s,i,r){super(t,e,s,i,r),this.type=5}_$AI(t,e=this){if((t=Nc(this,t,e,0)??Ze)===$c)return;const s=this._$AH,i=t===Ze&&s!==Ze||t.capture!==s.capture||t.once!==s.once||t.passive!==s.passive,r=t!==Ze&&(s===Ze||i);i&&this.element.removeEventListener(this.name,this,s),r&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var e;typeof this._$AH=="function"?this._$AH.call(((e=this.options)==null?void 0:e.host)??this.element,t):this._$AH.handleEvent(t)}},O8=class{constructor(t,e,s){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(t){Nc(this,t)}};const Lx=jm.litHtmlPolyfillSupport;Lx?.(fy,Dv),(jm.litHtmlVersions??(jm.litHtmlVersions=[])).push("3.3.0");const Mc=(n,t,e)=>{const s=e?.renderBefore??t;let i=s._$litPart$;if(i===void 0){const r=e?.renderBefore??null;s._$litPart$=i=new Dv(t.insertBefore(bd(),r),r,void 0,e??{})}return i._$AI(n),i};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const yd=globalThis;let oe=class extends oc{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var n;const t=super.createRenderRoot();return(n=this.renderOptions).renderBefore??(n.renderBefore=t.firstChild),t}update(n){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(n),this._$Do=Mc(t,this.renderRoot,this.renderOptions)}connectedCallback(){var n;super.connectedCallback(),(n=this._$Do)==null||n.setConnected(!0)}disconnectedCallback(){var n;super.disconnectedCallback(),(n=this._$Do)==null||n.setConnected(!1)}render(){return $c}};var $x;oe._$litElement$=!0,oe.finalized=!0,($x=yd.litElementHydrateSupport)==null||$x.call(yd,{LitElement:oe});const Nx=yd.litElementPolyfillSupport;Nx?.({LitElement:oe});(yd.litElementVersions??(yd.litElementVersions=[])).push("4.2.0");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const P8={attribute:!0,type:String,converter:Hm,reflect:!1,hasChanged:Nv},R8=(n=P8,t,e)=>{const{kind:s,metadata:i}=e;let r=globalThis.litPropertyMetadata.get(i);if(r===void 0&&globalThis.litPropertyMetadata.set(i,r=new Map),s==="setter"&&((n=Object.create(n)).wrapped=!0),r.set(e.name,n),s==="accessor"){const{name:o}=e;return{set(a){const l=t.get.call(this);t.set.call(this,a),this.requestUpdate(o,l,n)},init(a){return a!==void 0&&this.C(o,void 0,n,a),a}}}if(s==="setter"){const{name:o}=e;return function(a){const l=this[o];t.call(this,a),this.requestUpdate(o,l,n)}}throw Error("Unsupported decorator location: "+s)};function ft(n){return(t,e)=>typeof e=="object"?R8(n,t,e):((s,i,r)=>{const o=i.hasOwnProperty(r);return i.constructor.createProperty(r,s),o?Object.getOwnPropertyDescriptor(i,r):void 0})(n,t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function ih(n){return ft({...n,state:!0,attribute:!1})}/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const F8=n=>n.strings===void 0;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const L8={CHILD:2},$8=n=>(...t)=>({_$litDirective$:n,values:t});let N8=class{constructor(t){}get _$AU(){return this._$AM._$AU}_$AT(t,e,s){this._$Ct=t,this._$AM=e,this._$Ci=s}_$AS(t,e){return this.update(t,e)}update(t,e){return this.render(...e)}};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Zu=(n,t)=>{var e;const s=n._$AN;if(s===void 0)return!1;for(const i of s)(e=i._$AO)==null||e.call(i,t,!1),Zu(i,t);return!0},Ym=n=>{let t,e;do{if((t=n._$AM)===void 0)break;e=t._$AN,e.delete(n),n=t}while(e?.size===0)},XS=n=>{for(let t;t=n._$AM;n=t){let e=t._$AN;if(e===void 0)t._$AN=e=new Set;else if(e.has(n))break;e.add(n),k8(t)}};function M8(n){this._$AN!==void 0?(Ym(this),this._$AM=n,XS(this)):this._$AM=n}function D8(n,t=!1,e=0){const s=this._$AH,i=this._$AN;if(i!==void 0&&i.size!==0)if(t)if(Array.isArray(s))for(let r=e;r<s.length;r++)Zu(s[r],!1),Ym(s[r]);else s!=null&&(Zu(s,!1),Ym(s));else Zu(this,n)}const k8=n=>{n.type==L8.CHILD&&(n._$AP??(n._$AP=D8),n._$AQ??(n._$AQ=M8))};let z8=class extends N8{constructor(){super(...arguments),this._$AN=void 0}_$AT(t,e,s){super._$AT(t,e,s),XS(this),this.isConnected=t._$AU}_$AO(t,e=!0){var s,i;t!==this.isConnected&&(this.isConnected=t,t?(s=this.reconnected)==null||s.call(this):(i=this.disconnected)==null||i.call(this)),e&&(Zu(this,t),Ym(this))}setValue(t){if(F8(this._$Ct))this._$Ct._$AI(t,this);else{const e=[...this._$Ct._$AH];e[this._$Ci]=t,this._$Ct._$AI(e,this,0)}}disconnected(){}reconnected(){}};/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Dc=()=>new B8;let B8=class{};const M_=new WeakMap,kc=$8(class extends z8{render(n){return Ze}update(n,[t]){var e;const s=t!==this.G;return s&&this.G!==void 0&&this.rt(void 0),(s||this.lt!==this.ct)&&(this.G=t,this.ht=(e=n.options)==null?void 0:e.host,this.rt(this.ct=n.element)),Ze}rt(n){if(this.isConnected||(n=void 0),typeof this.G=="function"){const t=this.ht??globalThis;let e=M_.get(t);e===void 0&&(e=new WeakMap,M_.set(t,e)),e.get(this.G)!==void 0&&this.G.call(this.ht,void 0),e.set(this.G,n),n!==void 0&&this.G.call(this.ht,n)}else this.G.value=n}get lt(){var n,t;return typeof this.G=="function"?(n=M_.get(this.ht??globalThis))==null?void 0:n.get(this.G):(t=this.G)==null?void 0:t.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}});/**
* (c) Iconify
*
* For the full copyright and license information, please view the license.txt
* files at https://github.com/iconify/iconify
*
* Licensed under MIT.
*
* @license MIT
* @version 2.0.0
*/const QS=Object.freeze({left:0,top:0,width:16,height:16}),Gm=Object.freeze({rotate:0,vFlip:!1,hFlip:!1}),Wd=Object.freeze({...QS,...Gm}),my=Object.freeze({...Wd,body:"",hidden:!1}),U8=Object.freeze({width:null,height:null}),KS=Object.freeze({...U8,...Gm});function V8(n,t=0){const e=n.replace(/^-?[0-9.]*/,"");function s(i){for(;i<0;)i+=4;return i%4}if(e===""){const i=parseInt(n);return isNaN(i)?0:s(i)}else if(e!==n){let i=0;switch(e){case"%":i=25;break;case"deg":i=90}if(i){let r=parseFloat(n.slice(0,n.length-e.length));return isNaN(r)?0:(r=r/i,r%1===0?s(r):0)}}return t}const H8=/[\s,]+/;function j8(n,t){t.split(H8).forEach(e=>{switch(e.trim()){case"horizontal":n.hFlip=!0;break;case"vertical":n.vFlip=!0;break}})}const JS={...KS,preserveAspectRatio:""};function Mx(n){const t={...JS},e=(s,i)=>n.getAttribute(s)||i;return t.width=e("width",null),t.height=e("height",null),t.rotate=V8(e("rotate","")),j8(t,e("flip","")),t.preserveAspectRatio=e("preserveAspectRatio",e("preserveaspectratio","")),t}function W8(n,t){for(const e in JS)if(n[e]!==t[e])return!0;return!1}const Xu=/^[a-z0-9]+(-[a-z0-9]+)*$/,Yd=(n,t,e,s="")=>{const i=n.split(":");if(n.slice(0,1)==="@"){if(i.length<2||i.length>3)return null;s=i.shift().slice(1)}if(i.length>3||!i.length)return null;if(i.length>1){const a=i.pop(),l=i.pop(),c={provider:i.length>0?i[0]:s,prefix:l,name:a};return t&&!bm(c)?null:c}const r=i[0],o=r.split("-");if(o.length>1){const a={provider:s,prefix:o.shift(),name:o.join("-")};return t&&!bm(a)?null:a}if(e&&s===""){const a={provider:s,prefix:"",name:r};return t&&!bm(a,e)?null:a}return null},bm=(n,t)=>n?!!((n.provider===""||n.provider.match(Xu))&&(t&&n.prefix===""||n.prefix.match(Xu))&&n.name.match(Xu)):!1;function Y8(n,t){const e={};!n.hFlip!=!t.hFlip&&(e.hFlip=!0),!n.vFlip!=!t.vFlip&&(e.vFlip=!0);const s=((n.rotate||0)+(t.rotate||0))%4;return s&&(e.rotate=s),e}function Dx(n,t){const e=Y8(n,t);for(const s in my)s in Gm?s in n&&!(s in e)&&(e[s]=Gm[s]):s in t?e[s]=t[s]:s in n&&(e[s]=n[s]);return e}function G8(n,t){const e=n.icons,s=n.aliases||Object.create(null),i=Object.create(null);function r(o){if(e[o])return i[o]=[];if(!(o in i)){i[o]=null;const a=s[o]&&s[o].parent,l=a&&r(a);l&&(i[o]=[a].concat(l))}return i[o]}return Object.keys(e).concat(Object.keys(s)).forEach(r),i}function q8(n,t,e){const s=n.icons,i=n.aliases||Object.create(null);let r={};function o(a){r=Dx(s[a]||i[a],r)}return o(t),e.forEach(o),Dx(n,r)}function t2(n,t){const e=[];if(typeof n!="object"||typeof n.icons!="object")return e;n.not_found instanceof Array&&n.not_found.forEach(i=>{t(i,null),e.push(i)});const s=G8(n);for(const i in s){const r=s[i];r&&(t(i,q8(n,i,r)),e.push(i))}return e}const Z8={provider:"",aliases:{},not_found:{},...QS};function D_(n,t){for(const e in t)if(e in n&&typeof n[e]!=typeof t[e])return!1;return!0}function e2(n){if(typeof n!="object"||n===null)return null;const t=n;if(typeof t.prefix!="string"||!n.icons||typeof n.icons!="object"||!D_(n,Z8))return null;const e=t.icons;for(const i in e){const r=e[i];if(!i.match(Xu)||typeof r.body!="string"||!D_(r,my))return null}const s=t.aliases||Object.create(null);for(const i in s){const r=s[i],o=r.parent;if(!i.match(Xu)||typeof o!="string"||!e[o]&&!s[o]||!D_(r,my))return null}return t}const qm=Object.create(null);function X8(n,t){return{provider:n,prefix:t,icons:Object.create(null),missing:new Set}}function jo(n,t){const e=qm[n]||(qm[n]=Object.create(null));return e[t]||(e[t]=X8(n,t))}function kv(n,t){return e2(t)?t2(t,(e,s)=>{s?n.icons[e]=s:n.missing.add(e)}):[]}function Q8(n,t,e){try{if(typeof e.body=="string")return n.icons[t]={...e},!0}catch{}return!1}function K8(n,t){let e=[];return(typeof n=="string"?[n]:Object.keys(qm)).forEach(s=>{(typeof s=="string"&&typeof t=="string"?[t]:Object.keys(qm[s]||{})).forEach(i=>{const r=jo(s,i);e=e.concat(Object.keys(r.icons).map(o=>(s!==""?"@"+s+":":"")+i+":"+o))})}),e}let vd=!1;function s2(n){return typeof n=="boolean"&&(vd=n),vd}function wd(n){const t=typeof n=="string"?Yd(n,!0,vd):n;if(t){const e=jo(t.provider,t.prefix),s=t.name;return e.icons[s]||(e.missing.has(s)?null:void 0)}}function i2(n,t){const e=Yd(n,!0,vd);if(!e)return!1;const s=jo(e.provider,e.prefix);return Q8(s,e.name,t)}function kx(n,t){if(typeof n!="object")return!1;if(typeof t!="string"&&(t=n.provider||""),vd&&!t&&!n.prefix){let i=!1;return e2(n)&&(n.prefix="",t2(n,(r,o)=>{o&&i2(r,o)&&(i=!0)})),i}const e=n.prefix;if(!bm({provider:t,prefix:e,name:"a"}))return!1;const s=jo(t,e);return!!kv(s,n)}function zx(n){return!!wd(n)}function J8(n){const t=wd(n);return t?{...Wd,...t}:null}function tV(n){const t={loaded:[],missing:[],pending:[]},e=Object.create(null);n.sort((i,r)=>i.provider!==r.provider?i.provider.localeCompare(r.provider):i.prefix!==r.prefix?i.prefix.localeCompare(r.prefix):i.name.localeCompare(r.name));let s={provider:"",prefix:"",name:""};return n.forEach(i=>{if(s.name===i.name&&s.prefix===i.prefix&&s.provider===i.provider)return;s=i;const r=i.provider,o=i.prefix,a=i.name,l=e[r]||(e[r]=Object.create(null)),c=l[o]||(l[o]=jo(r,o));let h;a in c.icons?h=t.loaded:o===""||c.missing.has(a)?h=t.missing:h=t.pending;const u={provider:r,prefix:o,name:a};h.push(u)}),t}function n2(n,t){n.forEach(e=>{const s=e.loaderCallbacks;s&&(e.loaderCallbacks=s.filter(i=>i.id!==t))})}function eV(n){n.pendingCallbacksFlag||(n.pendingCallbacksFlag=!0,setTimeout(()=>{n.pendingCallbacksFlag=!1;const t=n.loaderCallbacks?n.loaderCallbacks.slice(0):[];if(!t.length)return;let e=!1;const s=n.provider,i=n.prefix;t.forEach(r=>{const o=r.icons,a=o.pending.length;o.pending=o.pending.filter(l=>{if(l.prefix!==i)return!0;const c=l.name;if(n.icons[c])o.loaded.push({provider:s,prefix:i,name:c});else if(n.missing.has(c))o.missing.push({provider:s,prefix:i,name:c});else return e=!0,!0;return!1}),o.pending.length!==a&&(e||n2([n],r.id),r.callback(o.loaded.slice(0),o.missing.slice(0),o.pending.slice(0),r.abort))})}))}let sV=0;function iV(n,t,e){const s=sV++,i=n2.bind(null,e,s);if(!t.pending.length)return i;const r={id:s,icons:t,callback:n,abort:i};return e.forEach(o=>{(o.loaderCallbacks||(o.loaderCallbacks=[])).push(r)}),i}const gy=Object.create(null);function Bx(n,t){gy[n]=t}function by(n){return gy[n]||gy[""]}function nV(n,t=!0,e=!1){const s=[];return n.forEach(i=>{const r=typeof i=="string"?Yd(i,t,e):i;r&&s.push(r)}),s}var rV={resources:[],index:0,timeout:2e3,rotate:750,random:!1,dataAfterTimeout:!1};function oV(n,t,e,s){const i=n.resources.length,r=n.random?Math.floor(Math.random()*i):n.index;let o;if(n.random){let I=n.resources.slice(0);for(o=[];I.length>1;){const C=Math.floor(Math.random()*I.length);o.push(I[C]),I=I.slice(0,C).concat(I.slice(C+1))}o=o.concat(I)}else o=n.resources.slice(r).concat(n.resources.slice(0,r));const a=Date.now();let l="pending",c=0,h,u=null,p=[],d=[];typeof s=="function"&&d.push(s);function g(){u&&(clearTimeout(u),u=null)}function m(){l==="pending"&&(l="aborted"),g(),p.forEach(I=>{I.status==="pending"&&(I.status="aborted")}),p=[]}function b(I,C){C&&(d=[]),typeof I=="function"&&d.push(I)}function f(){return{startTime:a,payload:t,status:l,queriesSent:c,queriesPending:p.length,subscribe:b,abort:m}}function _(){l="failed",d.forEach(I=>{I(void 0,h)})}function y(){p.forEach(I=>{I.status==="pending"&&(I.status="aborted")}),p=[]}function v(I,C,A){const S=C!=="success";switch(p=p.filter(P=>P!==I),l){case"pending":break;case"failed":if(S||!n.dataAfterTimeout)return;break;default:return}if(C==="abort"){h=A,_();return}if(S){h=A,p.length||(o.length?w():_());return}if(g(),y(),!n.random){const P=n.resources.indexOf(I.resource);P!==-1&&P!==n.index&&(n.index=P)}l="completed",d.forEach(P=>{P(A)})}function w(){if(l!=="pending")return;g();const I=o.shift();if(I===void 0){if(p.length){u=setTimeout(()=>{g(),l==="pending"&&(y(),_())},n.timeout);return}_();return}const C={status:"pending",resource:I,callback:(A,S)=>{v(C,A,S)}};p.push(C),c++,u=setTimeout(w,n.rotate),e(I,t,C.callback)}return setTimeout(w),f}function r2(n){const t={...rV,...n};let e=[];function s(){e=e.filter(o=>o().status==="pending")}function i(o,a,l){const c=oV(t,o,a,(h,u)=>{s(),l&&l(h,u)});return e.push(c),c}function r(o){return e.find(a=>o(a))||null}return{query:i,find:r,setIndex:o=>{t.index=o},getIndex:()=>t.index,cleanup:s}}function zv(n){let t;if(typeof n.resources=="string")t=[n.resources];else if(t=n.resources,!(t instanceof Array)||!t.length)return null;return{resources:t,path:n.path||"/",maxURL:n.maxURL||500,rotate:n.rotate||750,timeout:n.timeout||5e3,random:n.random===!0,index:n.index||0,dataAfterTimeout:n.dataAfterTimeout!==!1}}const zg=Object.create(null),Vf=["https://api.simplesvg.com","https://api.unisvg.com"],_y=[];for(;Vf.length>0;)Vf.length===1||Math.random()>.5?_y.push(Vf.shift()):_y.push(Vf.pop());zg[""]=zv({resources:["https://api.iconify.design"].concat(_y)});function Ux(n,t){const e=zv(t);return e===null?!1:(zg[n]=e,!0)}function Bg(n){return zg[n]}function aV(){return Object.keys(zg)}function Vx(){}const k_=Object.create(null);function lV(n){if(!k_[n]){const t=Bg(n);if(!t)return;const e=r2(t),s={config:t,redundancy:e};k_[n]=s}return k_[n]}function o2(n,t,e){let s,i;if(typeof n=="string"){const r=by(n);if(!r)return e(void 0,424),Vx;i=r.send;const o=lV(n);o&&(s=o.redundancy)}else{const r=zv(n);if(r){s=r2(r);const o=n.resources?n.resources[0]:"",a=by(o);a&&(i=a.send)}}return!s||!i?(e(void 0,424),Vx):s.query(t,i,e)().abort}const Hx="iconify2",Ed="iconify",a2=Ed+"-count",jx=Ed+"-version",l2=36e5,cV=168,hV=50;function yy(n,t){try{return n.getItem(t)}catch{}}function Bv(n,t,e){try{return n.setItem(t,e),!0}catch{}}function Wx(n,t){try{n.removeItem(t)}catch{}}function vy(n,t){return Bv(n,a2,t.toString())}function wy(n){return parseInt(yy(n,a2))||0}const Ba={local:!0,session:!0},c2={local:new Set,session:new Set};let Uv=!1;function uV(n){Uv=n}let Hf=typeof window>"u"?{}:window;function h2(n){const t=n+"Storage";try{if(Hf&&Hf[t]&&typeof Hf[t].length=="number")return Hf[t]}catch{}Ba[n]=!1}function u2(n,t){const e=h2(n);if(!e)return;const s=yy(e,jx);if(s!==Hx){if(s){const a=wy(e);for(let l=0;l<a;l++)Wx(e,Ed+l.toString())}Bv(e,jx,Hx),vy(e,0);return}const i=Math.floor(Date.now()/l2)-cV,r=a=>{const l=Ed+a.toString(),c=yy(e,l);if(typeof c=="string"){try{const h=JSON.parse(c);if(typeof h=="object"&&typeof h.cached=="number"&&h.cached>i&&typeof h.provider=="string"&&typeof h.data=="object"&&typeof h.data.prefix=="string"&&t(h,a))return!0}catch{}Wx(e,l)}};let o=wy(e);for(let a=o-1;a>=0;a--)r(a)||(a===o-1?(o--,vy(e,o)):c2[n].add(a))}function d2(){if(!Uv){uV(!0);for(const n in Ba)u2(n,t=>{const e=t.data,s=t.provider,i=e.prefix,r=jo(s,i);if(!kv(r,e).length)return!1;const o=e.lastModified||-1;return r.lastModifiedCached=r.lastModifiedCached?Math.min(r.lastModifiedCached,o):o,!0})}}function dV(n,t){const e=n.lastModifiedCached;if(e&&e>=t)return e===t;if(n.lastModifiedCached=t,e)for(const s in Ba)u2(s,i=>{const r=i.data;return i.provider!==n.provider||r.prefix!==n.prefix||r.lastModified===t});return!0}function pV(n,t){Uv||d2();function e(s){let i;if(!Ba[s]||!(i=h2(s)))return;const r=c2[s];let o;if(r.size)r.delete(o=Array.from(r).shift());else if(o=wy(i),o>=hV||!vy(i,o+1))return;const a={cached:Math.floor(Date.now()/l2),provider:n.provider,data:t};return Bv(i,Ed+o.toString(),JSON.stringify(a))}t.lastModified&&!dV(n,t.lastModified)||Object.keys(t.icons).length&&(t.not_found&&(t=Object.assign({},t),delete t.not_found),e("local")||e("session"))}function Yx(){}function fV(n){n.iconsLoaderFlag||(n.iconsLoaderFlag=!0,setTimeout(()=>{n.iconsLoaderFlag=!1,eV(n)}))}function mV(n,t){n.iconsToLoad?n.iconsToLoad=n.iconsToLoad.concat(t).sort():n.iconsToLoad=t,n.iconsQueueFlag||(n.iconsQueueFlag=!0,setTimeout(()=>{n.iconsQueueFlag=!1;const{provider:e,prefix:s}=n,i=n.iconsToLoad;delete n.iconsToLoad;let r;!i||!(r=by(e))||r.prepare(e,s,i).forEach(o=>{o2(e,o,a=>{if(typeof a!="object")o.icons.forEach(l=>{n.missing.add(l)});else try{const l=kv(n,a);if(!l.length)return;const c=n.pendingIcons;c&&l.forEach(h=>{c.delete(h)}),pV(n,a)}catch(l){console.error(l)}fV(n)})})}))}const Vv=(n,t)=>{const e=nV(n,!0,s2()),s=tV(e);if(!s.pending.length){let l=!0;return t&&setTimeout(()=>{l&&t(s.loaded,s.missing,s.pending,Yx)}),()=>{l=!1}}const i=Object.create(null),r=[];let o,a;return s.pending.forEach(l=>{const{provider:c,prefix:h}=l;if(h===a&&c===o)return;o=c,a=h,r.push(jo(c,h));const u=i[c]||(i[c]=Object.create(null));u[h]||(u[h]=[])}),s.pending.forEach(l=>{const{provider:c,prefix:h,name:u}=l,p=jo(c,h),d=p.pendingIcons||(p.pendingIcons=new Set);d.has(u)||(d.add(u),i[c][h].push(u))}),r.forEach(l=>{const{provider:c,prefix:h}=l;i[c][h].length&&mV(l,i[c][h])}),t?iV(t,s,r):Yx},gV=n=>new Promise((t,e)=>{const s=typeof n=="string"?Yd(n,!0):n;if(!s){e(n);return}Vv([s||n],i=>{if(i.length&&s){const r=wd(s);if(r){t({...Wd,...r});return}}e(n)})});function bV(n){try{const t=typeof n=="string"?JSON.parse(n):n;if(typeof t.body=="string")return{...t}}catch{}}function _V(n,t){const e=typeof n=="string"?Yd(n,!0,!0):null;if(!e){const r=bV(n);return{value:n,data:r}}const s=wd(e);if(s!==void 0||!e.prefix)return{value:n,name:e,data:s};const i=Vv([e],()=>t(n,e,wd(e)));return{value:n,name:e,loading:i}}function z_(n){return n.hasAttribute("inline")}let p2=!1;try{p2=navigator.vendor.indexOf("Apple")===0}catch{}function yV(n,t){switch(t){case"svg":case"bg":case"mask":return t}return t!=="style"&&(p2||n.indexOf("<a")===-1)?"svg":n.indexOf("currentColor")===-1?"bg":"mask"}const vV=/(-?[0-9.]*[0-9]+[0-9.]*)/g,wV=/^-?[0-9.]*[0-9]+[0-9.]*$/g;function Ey(n,t,e){if(t===1)return n;if(e=e||100,typeof n=="number")return Math.ceil(n*t*e)/e;if(typeof n!="string")return n;const s=n.split(vV);if(s===null||!s.length)return n;const i=[];let r=s.shift(),o=wV.test(r);for(;;){if(o){const a=parseFloat(r);isNaN(a)?i.push(r):i.push(Math.ceil(a*t*e)/e)}else i.push(r);if(r=s.shift(),r===void 0)return i.join("");o=!o}}function EV(n,t="defs"){let e="";const s=n.indexOf("<"+t);for(;s>=0;){const i=n.indexOf(">",s),r=n.indexOf("</"+t);if(i===-1||r===-1)break;const o=n.indexOf(">",r);if(o===-1)break;e+=n.slice(i+1,r).trim(),n=n.slice(0,s).trim()+n.slice(o+1)}return{defs:e,content:n}}function xV(n,t){return n?"<defs>"+n+"</defs>"+t:t}function IV(n,t,e){const s=EV(n);return xV(s.defs,t+s.content+e)}const CV=n=>n==="unset"||n==="undefined"||n==="none";function f2(n,t){const e={...Wd,...n},s={...KS,...t},i={left:e.left,top:e.top,width:e.width,height:e.height};let r=e.body;[e,s].forEach(m=>{const b=[],f=m.hFlip,_=m.vFlip;let y=m.rotate;f?_?y+=2:(b.push("translate("+(i.width+i.left).toString()+" "+(0-i.top).toString()+")"),b.push("scale(-1 1)"),i.top=i.left=0):_&&(b.push("translate("+(0-i.left).toString()+" "+(i.height+i.top).toString()+")"),b.push("scale(1 -1)"),i.top=i.left=0);let v;switch(y<0&&(y-=Math.floor(y/4)*4),y=y%4,y){case 1:v=i.height/2+i.top,b.unshift("rotate(90 "+v.toString()+" "+v.toString()+")");break;case 2:b.unshift("rotate(180 "+(i.width/2+i.left).toString()+" "+(i.height/2+i.top).toString()+")");break;case 3:v=i.width/2+i.left,b.unshift("rotate(-90 "+v.toString()+" "+v.toString()+")");break}y%2===1&&(i.left!==i.top&&(v=i.left,i.left=i.top,i.top=v),i.width!==i.height&&(v=i.width,i.width=i.height,i.height=v)),b.length&&(r=IV(r,'<g transform="'+b.join(" ")+'">',"</g>"))});const o=s.width,a=s.height,l=i.width,c=i.height;let h,u;o===null?(u=a===null?"1em":a==="auto"?c:a,h=Ey(u,l/c)):(h=o==="auto"?l:o,u=a===null?Ey(h,c/l):a==="auto"?c:a);const p={},d=(m,b)=>{CV(b)||(p[m]=b.toString())};d("width",h),d("height",u);const g=[i.left,i.top,l,c];return p.viewBox=g.join(" "),{attributes:p,viewBox:g,body:r}}function Hv(n,t){let e=n.indexOf("xlink:")===-1?"":' xmlns:xlink="http://www.w3.org/1999/xlink"';for(const s in t)e+=" "+s+'="'+t[s]+'"';return'<svg xmlns="http://www.w3.org/2000/svg"'+e+">"+n+"</svg>"}function TV(n){return n.replace(/"/g,"'").replace(/%/g,"%25").replace(/#/g,"%23").replace(/</g,"%3C").replace(/>/g,"%3E").replace(/\s+/g," ")}function AV(n){return"data:image/svg+xml,"+TV(n)}function m2(n){return'url("'+AV(n)+'")'}const SV=()=>{let n;try{if(n=fetch,typeof n=="function")return n}catch{}};let Zm=SV();function OV(n){Zm=n}function PV(){return Zm}function RV(n,t){const e=Bg(n);if(!e)return 0;let s;if(!e.maxURL)s=0;else{let i=0;e.resources.forEach(o=>{i=Math.max(i,o.length)});const r=t+".json?icons=";s=e.maxURL-i-e.path.length-r.length}return s}function FV(n){return n===404}const LV=(n,t,e)=>{const s=[],i=RV(n,t),r="icons";let o={type:r,provider:n,prefix:t,icons:[]},a=0;return e.forEach((l,c)=>{a+=l.length+1,a>=i&&c>0&&(s.push(o),o={type:r,provider:n,prefix:t,icons:[]},a=l.length),o.icons.push(l)}),s.push(o),s};function $V(n){if(typeof n=="string"){const t=Bg(n);if(t)return t.path}return"/"}const NV=(n,t,e)=>{if(!Zm){e("abort",424);return}let s=$V(t.provider);switch(t.type){case"icons":{const r=t.prefix,o=t.icons.join(","),a=new URLSearchParams({icons:o});s+=r+".json?"+a.toString();break}case"custom":{const r=t.uri;s+=r.slice(0,1)==="/"?r.slice(1):r;break}default:e("abort",400);return}let i=503;Zm(n+s).then(r=>{const o=r.status;if(o!==200){setTimeout(()=>{e(FV(o)?"abort":"next",o)});return}return i=501,r.json()}).then(r=>{if(typeof r!="object"||r===null){setTimeout(()=>{r===404?e("abort",r):e("next",i)});return}setTimeout(()=>{e("success",r)})}).catch(()=>{e("next",i)})},MV={prepare:LV,send:NV};function Gx(n,t){switch(n){case"local":case"session":Ba[n]=t;break;case"all":for(const e in Ba)Ba[e]=t;break}}const B_="data-style";let g2="";function DV(n){g2=n}function qx(n,t){let e=Array.from(n.childNodes).find(s=>s.hasAttribute&&s.hasAttribute(B_));e||(e=document.createElement("style"),e.setAttribute(B_,B_),n.appendChild(e)),e.textContent=":host{display:inline-block;vertical-align:"+(t?"-0.125em":"0")+"}span,svg{display:block}"+g2}function b2(){Bx("",MV),s2(!0);let n;try{n=window}catch{}if(n){if(d2(),n.IconifyPreload!==void 0){const t=n.IconifyPreload,e="Invalid IconifyPreload syntax.";typeof t=="object"&&t!==null&&(t instanceof Array?t:[t]).forEach(s=>{try{(typeof s!="object"||s===null||s instanceof Array||typeof s.icons!="object"||typeof s.prefix!="string"||!kx(s))&&console.error(e)}catch{console.error(e)}})}if(n.IconifyProviders!==void 0){const t=n.IconifyProviders;if(typeof t=="object"&&t!==null)for(const e in t){const s="IconifyProviders["+e+"] is invalid.";try{const i=t[e];if(typeof i!="object"||!i||i.resources===void 0)continue;Ux(e,i)||console.error(s)}catch{console.error(s)}}}}return{enableCache:t=>Gx(t,!0),disableCache:t=>Gx(t,!1),iconLoaded:zx,iconExists:zx,getIcon:J8,listIcons:K8,addIcon:i2,addCollection:kx,calculateSize:Ey,buildIcon:f2,iconToHTML:Hv,svgToURL:m2,loadIcons:Vv,loadIcon:gV,addAPIProvider:Ux,appendCustomStyle:DV,_api:{getAPIConfig:Bg,setAPIModule:Bx,sendAPIQuery:o2,setFetch:OV,getFetch:PV,listAPIProviders:aV}}}const xy={"background-color":"currentColor"},_2={"background-color":"transparent"},Zx={image:"var(--svg)",repeat:"no-repeat",size:"100% 100%"},Xx={"-webkit-mask":xy,mask:xy,background:_2};for(const n in Xx){const t=Xx[n];for(const e in Zx)t[n+"-"+e]=Zx[e]}function Qx(n){return n?n+(n.match(/^[-0-9.]+$/)?"px":""):"inherit"}function kV(n,t,e){const s=document.createElement("span");let i=n.body;i.indexOf("<a")!==-1&&(i+="<!-- "+Date.now()+" -->");const r=n.attributes,o=Hv(i,{...r,width:t.width+"",height:t.height+""}),a=m2(o),l=s.style,c={"--svg":a,width:Qx(r.width),height:Qx(r.height),...e?xy:_2};for(const h in c)l.setProperty(h,c[h]);return s}let Qu;function zV(){try{Qu=window.trustedTypes.createPolicy("iconify",{createHTML:n=>n})}catch{Qu=null}}function BV(n){return Qu===void 0&&zV(),Qu?Qu.createHTML(n):n}function UV(n){const t=document.createElement("span"),e=n.attributes;let s="";e.width||(s="width: inherit;"),e.height||(s+="height: inherit;"),s&&(e.style=s);const i=Hv(n.body,e);return t.innerHTML=BV(i),t.firstChild}function Iy(n){return Array.from(n.childNodes).find(t=>{const e=t.tagName&&t.tagName.toUpperCase();return e==="SPAN"||e==="SVG"})}function Kx(n,t){const e=t.icon.data,s=t.customisations,i=f2(e,s);s.preserveAspectRatio&&(i.attributes.preserveAspectRatio=s.preserveAspectRatio);const r=t.renderedMode;let o;switch(r){case"svg":o=UV(i);break;default:o=kV(i,{...Wd,...e},r==="mask")}const a=Iy(n);a?o.tagName==="SPAN"&&a.tagName===o.tagName?a.setAttribute("style",o.getAttribute("style")):n.replaceChild(o,a):n.appendChild(o)}function Jx(n,t,e){const s=e&&(e.rendered?e:e.lastRender);return{rendered:!1,inline:t,icon:n,lastRender:s}}function VV(n="iconify-icon"){let t,e;try{t=window.customElements,e=window.HTMLElement}catch{return}if(!t||!e)return;const s=t.get(n);if(s)return s;const i=["icon","mode","inline","observe","width","height","rotate","flip"],r=class extends e{constructor(){super(),ua(this,"_shadowRoot"),ua(this,"_initialised",!1),ua(this,"_state"),ua(this,"_checkQueued",!1),ua(this,"_connected",!1),ua(this,"_observer",null),ua(this,"_visible",!0);const a=this._shadowRoot=this.attachShadow({mode:"open"}),l=z_(this);qx(a,l),this._state=Jx({value:""},l),this._queueCheck()}connectedCallback(){this._connected=!0,this.startObserver()}disconnectedCallback(){this._connected=!1,this.stopObserver()}static get observedAttributes(){return i.slice(0)}attributeChangedCallback(a){switch(a){case"inline":{const l=z_(this),c=this._state;l!==c.inline&&(c.inline=l,qx(this._shadowRoot,l));break}case"observer":{this.observer?this.startObserver():this.stopObserver();break}default:this._queueCheck()}}get icon(){const a=this.getAttribute("icon");if(a&&a.slice(0,1)==="{")try{return JSON.parse(a)}catch{}return a}set icon(a){typeof a=="object"&&(a=JSON.stringify(a)),this.setAttribute("icon",a)}get inline(){return z_(this)}set inline(a){a?this.setAttribute("inline","true"):this.removeAttribute("inline")}get observer(){return this.hasAttribute("observer")}set observer(a){a?this.setAttribute("observer","true"):this.removeAttribute("observer")}restartAnimation(){const a=this._state;if(a.rendered){const l=this._shadowRoot;if(a.renderedMode==="svg")try{l.lastChild.setCurrentTime(0);return}catch{}Kx(l,a)}}get status(){const a=this._state;return a.rendered?"rendered":a.icon.data===null?"failed":"loading"}_queueCheck(){this._checkQueued||(this._checkQueued=!0,setTimeout(()=>{this._check()}))}_check(){if(!this._checkQueued)return;this._checkQueued=!1;const a=this._state,l=this.getAttribute("icon");if(l!==a.icon.value){this._iconChanged(l);return}if(!a.rendered||!this._visible)return;const c=this.getAttribute("mode"),h=Mx(this);(a.attrMode!==c||W8(a.customisations,h)||!Iy(this._shadowRoot))&&this._renderIcon(a.icon,h,c)}_iconChanged(a){const l=_V(a,(c,h,u)=>{const p=this._state;if(p.rendered||this.getAttribute("icon")!==c)return;const d={value:c,name:h,data:u};d.data?this._gotIconData(d):p.icon=d});l.data?this._gotIconData(l):this._state=Jx(l,this._state.inline,this._state)}_forceRender(){if(!this._visible){const a=Iy(this._shadowRoot);a&&this._shadowRoot.removeChild(a);return}this._queueCheck()}_gotIconData(a){this._checkQueued=!1,this._renderIcon(a,Mx(this),this.getAttribute("mode"))}_renderIcon(a,l,c){const h=yV(a.data.body,c),u=this._state.inline;Kx(this._shadowRoot,this._state={rendered:!0,icon:a,inline:u,customisations:l,attrMode:c,renderedMode:h})}startObserver(){if(!this._observer)try{this._observer=new IntersectionObserver(a=>{const l=a.some(c=>c.isIntersecting);l!==this._visible&&(this._visible=l,this._forceRender())}),this._observer.observe(this)}catch{if(this._observer){try{this._observer.disconnect()}catch{}this._observer=null}}}stopObserver(){this._observer&&(this._observer.disconnect(),this._observer=null,this._visible=!0,this._connected&&this._forceRender())}};i.forEach(a=>{a in r.prototype||Object.defineProperty(r.prototype,a,{get:function(){return this.getAttribute(a)},set:function(l){l!==null?this.setAttribute(a,l):this.removeAttribute(a)}})});const o=b2();for(const a in o)r[a]=r.prototype[a]=o[a];return t.define(n,r),r}const HV=VV()||b2(),{enableCache:rX,disableCache:oX,iconLoaded:aX,iconExists:lX,getIcon:cX,listIcons:hX,addIcon:uX,addCollection:dX,calculateSize:pX,buildIcon:fX,iconToHTML:mX,svgToURL:gX,loadIcons:bX,loadIcon:_X,addAPIProvider:yX,_api:vX}=HV,jV=ce`
  ::-webkit-scrollbar {
    width: 0.4rem;
    height: 0.4rem;
    overflow: hidden;
  }

  ::-webkit-scrollbar-thumb {
    border-radius: 0.25rem;
    background-color: var(
      --bim-scrollbar--c,
      color-mix(in lab, var(--bim-ui_main-base), white 15%)
    );
  }

  ::-webkit-scrollbar-track {
    background-color: var(--bim-scrollbar--bgc, var(--bim-ui_bg-base));
  }
`,WV=ce`
  :root {
    /* Grayscale Colors */
    --bim-ui_gray-0: hsl(210 10% 5%);
    --bim-ui_gray-1: hsl(210 10% 10%);
    --bim-ui_gray-2: hsl(210 10% 20%);
    --bim-ui_gray-3: hsl(210 10% 30%);
    --bim-ui_gray-4: hsl(210 10% 40%);
    --bim-ui_gray-6: hsl(210 10% 60%);
    --bim-ui_gray-7: hsl(210 10% 70%);
    --bim-ui_gray-8: hsl(210 10% 80%);
    --bim-ui_gray-9: hsl(210 10% 90%);
    --bim-ui_gray-10: hsl(210 10% 95%);

    /* Brand Colors */
    --bim-ui_main-base: #6528d7;
    --bim-ui_accent-base: #bcf124;

    /* Brand Colors Contrasts */
    --bim-ui_main-contrast: var(--bim-ui_gray-10);
    --bim-ui_accent-contrast: var(--bim-ui_gray-0);

    /* Sizes */
    --bim-ui_size-4xs: 0.375rem;
    --bim-ui_size-3xs: 0.5rem;
    --bim-ui_size-2xs: 0.625rem;
    --bim-ui_size-xs: 0.75rem;
    --bim-ui_size-sm: 0.875rem;
    --bim-ui_size-base: 1rem;
    --bim-ui_size-lg: 1.125rem;
    --bim-ui_size-xl: 1.25rem;
    --bim-ui_size-2xl: 1.375rem;
    --bim-ui_size-3xl: 1.5rem;
    --bim-ui_size-4xl: 1.625rem;
    --bim-ui_size-5xl: 1.75rem;
    --bim-ui_size-6xl: 1.875rem;
    --bim-ui_size-7xl: 2rem;
    --bim-ui_size-8xl: 2.125rem;
    --bim-ui_size-9xl: 2.25rem;
  }

  /* Background Colors */
  @media (prefers-color-scheme: dark) {
    :root {
      --bim-ui_bg-base: var(--bim-ui_gray-0);
      --bim-ui_bg-contrast-10: var(--bim-ui_gray-1);
      --bim-ui_bg-contrast-20: var(--bim-ui_gray-2);
      --bim-ui_bg-contrast-30: var(--bim-ui_gray-3);
      --bim-ui_bg-contrast-40: var(--bim-ui_gray-4);
      --bim-ui_bg-contrast-60: var(--bim-ui_gray-6);
      --bim-ui_bg-contrast-80: var(--bim-ui_gray-8);
      --bim-ui_bg-contrast-100: var(--bim-ui_gray-10);
    }
  }

  @media (prefers-color-scheme: light) {
    :root {
      --bim-ui_bg-base: var(--bim-ui_gray-10);
      --bim-ui_bg-contrast-10: var(--bim-ui_gray-9);
      --bim-ui_bg-contrast-20: var(--bim-ui_gray-8);
      --bim-ui_bg-contrast-30: var(--bim-ui_gray-7);
      --bim-ui_bg-contrast-40: var(--bim-ui_gray-6);
      --bim-ui_bg-contrast-60: var(--bim-ui_gray-4);
      --bim-ui_bg-contrast-80: var(--bim-ui_gray-2);
      --bim-ui_bg-contrast-100: var(--bim-ui_gray-0);
      --bim-ui_accent-base: #6528d7;
    }
  }

  .theme-transition-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    filter: drop-shadow(0 0 10px var(--bim-ui_bg-base));
    z-index: 9999;
  }

  .theme-transition-overlay > div {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: var(--bim-ui_bg-base);
  }

  html.bim-ui-dark {
    --bim-ui_bg-base: var(--bim-ui_gray-0);
    --bim-ui_bg-contrast-10: var(--bim-ui_gray-1);
    --bim-ui_bg-contrast-20: var(--bim-ui_gray-2);
    --bim-ui_bg-contrast-30: var(--bim-ui_gray-3);
    --bim-ui_bg-contrast-40: var(--bim-ui_gray-4);
    --bim-ui_bg-contrast-60: var(--bim-ui_gray-6);
    --bim-ui_bg-contrast-80: var(--bim-ui_gray-8);
    --bim-ui_bg-contrast-100: var(--bim-ui_gray-10);
  }

  html.bim-ui-light {
    --bim-ui_bg-base: var(--bim-ui_gray-10);
    --bim-ui_bg-contrast-10: var(--bim-ui_gray-9);
    --bim-ui_bg-contrast-20: var(--bim-ui_gray-8);
    --bim-ui_bg-contrast-30: var(--bim-ui_gray-7);
    --bim-ui_bg-contrast-40: var(--bim-ui_gray-6);
    --bim-ui_bg-contrast-60: var(--bim-ui_gray-4);
    --bim-ui_bg-contrast-80: var(--bim-ui_gray-2);
    --bim-ui_bg-contrast-100: var(--bim-ui_gray-0);
    --bim-ui_accent-base: #6528d7;
  }

  @keyframes toggleOverlay {
    0%,
    99% {
      display: block;
    }

    100% {
      display: none;
    }
  }

  @keyframes toggleThemeAnimation {
    0% {
      clip-path: circle(0% at center top);
    }
    45%,
    55% {
      clip-path: circle(150% at center center);
    }
    100% {
      clip-path: circle(0% at center bottom);
    }
  }

  [data-context-dialog]::backdrop {
    background-color: transparent;
  }
`,Qo={scrollbar:jV,globalStyles:WV},y2=class Jt{static set config(t){this._config={...Jt._config,...t}}static get config(){return Jt._config}static addGlobalStyles(){let t=document.querySelector("style[id='bim-ui']");if(t)return;t=document.createElement("style"),t.id="bim-ui",t.textContent=Qo.globalStyles.cssText;const e=document.head.firstChild;e?document.head.insertBefore(t,e):document.head.append(t)}static defineCustomElement(t,e){customElements.get(t)||customElements.define(t,e)}static registerComponents(){Jt.init()}static init(t="",e=!0){Jt.addGlobalStyles(),Jt.defineCustomElement("bim-button",QV),Jt.defineCustomElement("bim-checkbox",nh),Jt.defineCustomElement("bim-color-input",Ko),Jt.defineCustomElement("bim-context-menu",Ty),Jt.defineCustomElement("bim-dropdown",vr),Jt.defineCustomElement("bim-grid",Yv),Jt.defineCustomElement("bim-icon",r7),Jt.defineCustomElement("bim-input",qd),Jt.defineCustomElement("bim-label",rh),Jt.defineCustomElement("bim-number-input",Ri),Jt.defineCustomElement("bim-option",bs),Jt.defineCustomElement("bim-panel",rl),Jt.defineCustomElement("bim-panel-section",oh),Jt.defineCustomElement("bim-selector",ah),Jt.defineCustomElement("bim-table",Fi),Jt.defineCustomElement("bim-tabs",Wr),Jt.defineCustomElement("bim-tab",di),Jt.defineCustomElement("bim-table-cell",$2),Jt.defineCustomElement("bim-table-children",_7),Jt.defineCustomElement("bim-table-group",D2),Jt.defineCustomElement("bim-table-row",lh),Jt.defineCustomElement("bim-text-input",mn),Jt.defineCustomElement("bim-toolbar",Yg),Jt.defineCustomElement("bim-toolbar-group",jg),Jt.defineCustomElement("bim-toolbar-section",hh),Jt.defineCustomElement("bim-viewport",q2),e&&this.animateOnLoad(t)}static newRandomId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let e="";for(let s=0;s<10;s++){const i=Math.floor(Math.random()*t.length);e+=t.charAt(i)}return e}static animateOnLoad(t=""){const e=`
      bim-input,
      bim-button,
      bim-checkbox,
      bim-selector,
      bim-label,
      bim-table-row,
      bim-panel-section,
      bim-table-children .branch-vertical,
      .switchers
    `,s=[];function i(r,o=document,a=new Set){const l=[];return Array.from(o.querySelectorAll(r)).forEach(c=>{a.has(c)||(a.add(c),l.push(c))}),Array.from(o.querySelectorAll("*")).filter(c=>c.shadowRoot).forEach(c=>{a.has(c)||(a.add(c),l.push(...i(r,c.shadowRoot,a)))}),l}requestAnimationFrame(()=>{i(t||e).forEach(o=>{const a=o;let l="auto";l=window.getComputedStyle(a).getPropertyValue("transition"),a.style.setProperty("opacity","0"),a.style.setProperty("transition","none"),requestAnimationFrame(()=>{a.style.setProperty("transition",l)}),s.push(a)});const r=()=>{s.forEach(o=>{const a=o,l=(a.getBoundingClientRect().x+a.getBoundingClientRect().y)/(window.innerWidth+window.innerHeight),c=window.getComputedStyle(a).getPropertyValue("transform"),h=400,u=200+l*1e3;a.animate([{transform:"translateY(-20px)",opacity:"0"},{transform:"translateY(0)",opacity:"1"}],{duration:h,easing:"ease-in-out",delay:u}),setTimeout(()=>{a.style.removeProperty("opacity"),c!=="none"?a.style.setProperty("transform",c):a.style.removeProperty("transform")},u+h)})};document.readyState==="complete"?r():window.addEventListener("load",r)})}static toggleTheme(t=!0){const e=document.querySelector("html");if(!e)return;const s=()=>{e.classList.contains("bim-ui-dark")?e.classList.replace("bim-ui-dark","bim-ui-light"):e.classList.contains("bim-ui-light")?e.classList.replace("bim-ui-light","bim-ui-dark"):e.classList.add("bim-ui-light")};if(t){const i=document.createElement("div");i.classList.add("theme-transition-overlay");const r=document.createElement("div");i.appendChild(r),r.style.setProperty("transition",`background-color ${1e3/3200}s`),document.body.appendChild(i),i.style.setProperty("animation",`toggleOverlay ${1e3/1e3}s ease-in forwards`),r.style.setProperty("animation",`toggleThemeAnimation ${1e3/1e3}s ease forwards`),setTimeout(()=>{s()},1e3/4),setTimeout(()=>{document.body.querySelectorAll(".theme-transition-overlay").forEach(o=>{document.body.removeChild(o)})},1e3)}else s()}};y2._config={sectionLabelOnVerticalToolbar:!1};let jv=y2,Xm=class extends oe{constructor(){super(...arguments),this._lazyLoadObserver=null,this._visibleElements=[],this.ELEMENTS_BEFORE_OBSERVER=20,this.useObserver=!1,this.elements=new Set,this.observe=t=>{if(!this.useObserver)return;for(const s of t)this.elements.add(s);const e=t.slice(this.ELEMENTS_BEFORE_OBSERVER);for(const s of e)s.remove();this.observeLastElement()}}set visibleElements(t){this._visibleElements=this.useObserver?t:[],this.requestUpdate()}get visibleElements(){return this._visibleElements}getLazyObserver(){if(!this.useObserver)return null;if(this._lazyLoadObserver)return this._lazyLoadObserver;const t=new IntersectionObserver(e=>{const s=e[0];if(!s.isIntersecting)return;const i=s.target;t.unobserve(i);const r=this.ELEMENTS_BEFORE_OBSERVER+this.visibleElements.length,o=[...this.elements][r];o&&(this.visibleElements=[...this.visibleElements,o],t.observe(o))},{threshold:.5});return t}observeLastElement(){const t=this.getLazyObserver();if(!t)return;const e=this.ELEMENTS_BEFORE_OBSERVER+this.visibleElements.length-1,s=[...this.elements][e];s&&t.observe(s)}resetVisibleElements(){const t=this.getLazyObserver();if(t){for(const e of this.elements)t.unobserve(e);this.visibleElements=[],this.observeLastElement()}}static create(t,e){const s=document.createDocumentFragment();if(t.length===0)return Mc(t(),s),s.firstElementChild;if(!e)throw new Error("UIComponent: Initial state is required for statefull components.");let i=e;const r=t,o=l=>(i={...i,...l},Mc(r(i,o),s),i);o(e);const a=()=>i;return[s.firstElementChild,o,a]}};const Qm=(n,t={},e=!0)=>{let s={};for(const i of n.children){const r=i,o=r.getAttribute("name")||r.getAttribute("label"),a=o?t[o]:void 0;if(o){if("value"in r&&typeof r.value<"u"&&r.value!==null){const l=r.value;if(typeof l=="object"&&!Array.isArray(l)&&Object.keys(l).length===0)continue;s[o]=a?a(r.value):r.value}else if(e){const l=Qm(r,t);if(Object.keys(l).length===0)continue;s[o]=a?a(l):l}}else e&&(s={...s,...Qm(r,t)})}return s},Ug=n=>n==="true"||n==="false"?n==="true":n&&!isNaN(Number(n))&&n.trim()!==""?Number(n):n,YV=[">=","<=","=",">","<","?","/","#"];function tI(n){const t=YV.find(o=>n.split(o).length===2),e=n.split(t).map(o=>o.trim()),[s,i]=e,r=i.startsWith("'")&&i.endsWith("'")?i.replace(/'/g,""):Ug(i);return{key:s,condition:t,value:r}}const Cy=n=>{try{const t=[],e=n.split(/&(?![^()]*\))/).map(s=>s.trim());for(const s of e){const i=!s.startsWith("(")&&!s.endsWith(")"),r=s.startsWith("(")&&s.endsWith(")");if(i){const o=tI(s);t.push(o)}if(r){const o={operator:"&",queries:s.replace(/^(\()|(\))$/g,"").split("&").map(a=>a.trim()).map((a,l)=>{const c=tI(a);return l>0&&(c.operator="&"),c})};t.push(o)}}return t}catch{return null}},eI=(n,t,e)=>{let s=!1;switch(t){case"=":s=n===e;break;case"?":s=String(n).includes(String(e));break;case"<":(typeof n=="number"||typeof e=="number")&&(s=n<e);break;case"<=":(typeof n=="number"||typeof e=="number")&&(s=n<=e);break;case">":(typeof n=="number"||typeof e=="number")&&(s=n>e);break;case">=":(typeof n=="number"||typeof e=="number")&&(s=n>=e);break;case"/":s=String(n).startsWith(String(e));break}return s};var GV=Object.defineProperty,qV=Object.getOwnPropertyDescriptor,v2=(n,t,e,s)=>{for(var i=qV(t,e),r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=o(t,e,i)||i);return i&&GV(t,e,i),i},os;const Wv=(os=class extends oe{constructor(){super(...arguments),this._previousContainer=null,this._visible=!1}get placement(){return this._placement}set placement(n){this._placement=n,this.updatePosition()}static removeMenus(){for(const n of os.menus)n instanceof os&&(n.visible=!1);setTimeout(()=>{os.dialog.close(),os.dialog.remove()},310)}get visible(){return this._visible}set visible(n){this._visible=n,n?(os.dialog.parentElement||document.body.append(os.dialog),this._previousContainer=this.parentElement,os.dialog.style.top=`${window.scrollY||document.documentElement.scrollTop}px`,this.style.setProperty("display","flex"),os.dialog.append(this),os.dialog.showModal(),this.updatePosition(),this.dispatchEvent(new Event("visible"))):setTimeout(()=>{var t;(t=this._previousContainer)==null||t.append(this),this._previousContainer=null,this.style.setProperty("display","none"),this.dispatchEvent(new Event("hidden"))},310)}async updatePosition(){if(!(this.visible&&this._previousContainer))return;const n=this.placement??"right",t=await VS(this._previousContainer,this,{placement:n,middleware:[SS(10),US(),BS(),zS({padding:5})]}),{x:e,y:s}=t;this.style.left=`${e}px`,this.style.top=`${s}px`}connectedCallback(){super.connectedCallback(),os.menus.push(this),this.visible?(this.style.setProperty("width","auto"),this.style.setProperty("height","auto")):(this.style.setProperty("display","none"),this.style.setProperty("width","0"),this.style.setProperty("height","0"))}render(){return At` <slot></slot> `}},os.styles=[Qo.scrollbar,ce`
      :host {
        pointer-events: auto;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 999;
        overflow: auto;
        max-height: 20rem;
        min-width: 3rem;
        flex-direction: column;
        box-shadow: 1px 2px 8px 2px rgba(0, 0, 0, 0.15);
        padding: 0.5rem;
        border-radius: var(--bim-ui_size-4xs);
        display: flex;
        transform-origin: top left;
        transform: scale(1);
        clip-path: circle(150% at top left);
        background-color: var(--bim-ui_bg-contrast-20);
        transition:
          clip-path 0.2s cubic-bezier(0.72, 0.1, 0.43, 0.93),
          transform 0.3s cubic-bezier(0.72, 0.1, 0.45, 2.35);
      }

      :host(:not([visible])) {
        transform: scale(0.8);
        clip-path: circle(0 at top left);
      }
    `],os.dialog=Xm.create(()=>At` <dialog
      @click=${n=>{n.target===os.dialog&&os.removeMenus()}}
      @cancel=${()=>os.removeMenus()}
      data-context-dialog
      style="
      width: 0;
      height: 0;
      position: relative;
      padding: 0;
      border: none;
      outline: none;
      margin: none;
      overflow: visible;
      background-color: transparent;
    "
    ></dialog>`),os.menus=[],os);v2([ft({type:String,reflect:!0})],Wv.prototype,"placement");v2([ft({type:Boolean,reflect:!0})],Wv.prototype,"visible");let Ty=Wv;var ZV=Object.defineProperty,XV=Object.getOwnPropertyDescriptor,Nn=(n,t,e,s)=>{for(var i=s>1?void 0:s?XV(t,e):t,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(t,e,i):o(i))||i);return s&&i&&ZV(t,e,i),i},nu;const dn=(nu=class extends oe{constructor(){super(),this.labelHidden=!1,this.active=!1,this.disabled=!1,this.vertical=!1,this.tooltipVisible=!1,this._stateBeforeLoading={disabled:!1,icon:""},this._loading=!1,this._parent=Dc(),this._tooltip=Dc(),this._mouseLeave=!1,this.onClick=n=>{n.stopPropagation(),this.disabled||this.dispatchEvent(new Event("click"))},this.showContextMenu=()=>{const n=this._contextMenu;if(n){const t=this.getAttribute("data-context-group");t&&n.setAttribute("data-context-group",t),this.closeNestedContexts();const e=jv.newRandomId();for(const s of n.children)s instanceof nu&&s.setAttribute("data-context-group",e);n.visible=!0}},this.mouseLeave=!0}set loading(n){if(this._loading=n,n)this._stateBeforeLoading={disabled:this.disabled,icon:this.icon},this.disabled=n,this.icon="eos-icons:loading";else{const{disabled:t,icon:e}=this._stateBeforeLoading;this.disabled=t,this.icon=e}}get loading(){return this._loading}set mouseLeave(n){this._mouseLeave=n,n&&(this.tooltipVisible=!1,clearTimeout(this.timeoutID))}get mouseLeave(){return this._mouseLeave}computeTooltipPosition(){const{value:n}=this._parent,{value:t}=this._tooltip;n&&t&&VS(n,t,{placement:"bottom",middleware:[SS(10),US(),BS(),zS({padding:5})]}).then(e=>{const{x:s,y:i}=e;Object.assign(t.style,{left:`${s}px`,top:`${i}px`})})}onMouseEnter(){if(!(this.tooltipTitle||this.tooltipText))return;this.mouseLeave=!1;const n=this.tooltipTime??700;this.timeoutID=setTimeout(()=>{this.mouseLeave||(this.computeTooltipPosition(),this.tooltipVisible=!0)},n)}closeNestedContexts(){const n=this.getAttribute("data-context-group");if(n)for(const t of Ty.dialog.children){const e=t.getAttribute("data-context-group");if(t instanceof Ty&&e===n){t.visible=!1,t.removeAttribute("data-context-group");for(const s of t.children)s instanceof nu&&(s.closeNestedContexts(),s.removeAttribute("data-context-group"))}}}click(){this.disabled||super.click()}get _contextMenu(){return this.querySelector("bim-context-menu")}connectedCallback(){super.connectedCallback(),this.addEventListener("click",this.showContextMenu)}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("click",this.showContextMenu)}render(){const n=At`
      <div ${kc(this._tooltip)} class="tooltip">
        ${this.tooltipTitle?At`<p style="text-wrap: nowrap;">
              <strong>${this.tooltipTitle}</strong>
            </p>`:null}
        ${this.tooltipText?At`<p style="width: 9rem;">${this.tooltipText}</p>`:null}
      </div>
    `,t=At`<svg
      xmlns="http://www.w3.org/2000/svg"
      height="1.125rem"
      viewBox="0 0 24 24"
      width="1.125rem"
      style="fill: var(--bim-label--c)"
    >
      <path d="M0 0h24v24H0V0z" fill="none" />
      <path d="M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z" />
    </svg>`;return At`
      <div ${kc(this._parent)} class="parent" @click=${this.onClick}>
        ${this.label||this.icon?At`
              <div
                class="button"
                @mouseenter=${this.onMouseEnter}
                @mouseleave=${()=>this.mouseLeave=!0}
              >
                <bim-label
                  .icon=${this.icon}
                  .vertical=${this.vertical}
                  .labelHidden=${this.labelHidden}
                  >${this.label}${this.label&&this._contextMenu?t:null}</bim-label
                >
              </div>
            `:null}
        ${this.tooltipTitle||this.tooltipText?n:null}
      </div>
      <slot></slot>
    `}},nu.styles=ce`
    :host {
      --bim-label--c: var(--bim-ui_bg-contrast-100, white);
      position: relative;
      display: block;
      flex: 1;
      pointer-events: none;
      background-color: var(--bim-button--bgc, var(--bim-ui_bg-contrast-20));
      border-radius: var(--bim-ui_size-4xs);
      transition: all 0.15s;
    }

    :host(:not([disabled]))::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: inherit;
      background-color: var(--bim-ui_main-base);
      clip-path: circle(0 at center center);
      box-sizing: border-box;
      transition:
        clip-path 0.3s cubic-bezier(0.65, 0.05, 0.36, 1),
        transform 0.15s;
    }

    :host(:not([disabled]):hover) {
      cursor: pointer;
    }

    bim-label {
      pointer-events: none;
    }

    .parent {
      --bim-icon--c: var(--bim-label--c);
      position: relative;
      display: flex;
      height: 100%;
      user-select: none;
      row-gap: 0.125rem;
      min-height: var(--bim-ui_size-5xl);
      min-width: var(--bim-ui_size-5xl);
    }

    .button,
    .children {
      box-sizing: border-box;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: auto;
    }

    .children {
      padding: 0 0.375rem;
      position: absolute;
      height: 100%;
      right: 0;
    }

    :host(:not([label-hidden])[icon][vertical]) .parent {
      min-height: 2.5rem;
    }

    .button {
      flex-grow: 1;
      transition: transform 0.15s;
    }

    :host(:not([label-hidden])[label]) .button {
      justify-content: var(--bim-button--jc, center);
    }

    :host(:hover)::before {
      clip-path: circle(120% at center center);
    }

    :host(:hover) {
      --bim-label--c: var(--bim-ui_main-contrast);
      z-index: 2;
    }

    :host([active]) {
      background-color: var(--bim-ui_main-base);
    }

    :host(:not([disabled]):active) {
      background: transparent;
    }

    :host(:not([disabled]):active) .button,
    :host(:not([disabled]):active)::before {
      transform: scale(0.98);
    }

    :host(:not([label]):not([icon])) .children {
      flex: 1;
    }

    :host([vertical]) .parent {
      justify-content: center;
    }

    :host(:not([label-hidden])[label]) .button {
      padding: 0 0.5rem;
    }

    :host([disabled]) {
      --bim-label--c: var(--bim-ui_bg-contrast-80) !important;
      background-color: gray !important;
    }

    ::slotted(bim-button) {
      --bim-icon--fz: var(--bim-ui_size-base);
      --bim-button--bdrs: var(--bim-ui_size-4xs);
      --bim-button--olw: 0;
      --bim-button--olc: transparent;
    }

    .tooltip {
      position: absolute;
      padding: 0.75rem;
      z-index: 99;
      display: flex;
      flex-flow: column;
      row-gap: 0.375rem;
      box-shadow: 0 0 10px 3px rgba(0 0 0 / 20%);
      outline: 1px solid var(--bim-ui_bg-contrast-40);
      font-size: var(--bim-ui_size-xs);
      border-radius: var(--bim-ui_size-4xs);
      background-color: var(--bim-ui_bg-contrast-20);
      color: var(--bim-ui_bg-contrast-100);
      animation: openTooltips 0.15s ease-out forwards;
      transition: visibility 0.2s;
    }

    .tooltip p {
      margin: 0;
      padding: 0;
    }

    :host(:not([tooltip-visible])) .tooltip {
      animation: closeTooltips 0.15s ease-in forwards;
      visibility: hidden;
      display: none;
    }

    @keyframes closeTooltips {
      0% {
        display: flex;
        padding: 0.75rem;
        transform: translateY(0);
        opacity: 1;
      }
      90% {
        padding: 0.75rem;
      }
      100% {
        display: none;
        padding: 0;
        transform: translateY(-10px);
        opacity: 0;
      }
    }

    @keyframes openTooltips {
      0% {
        display: flex;
        transform: translateY(-10px);
        opacity: 0;
      }
      100% {
        transform: translateY(0);
        opacity: 1;
      }
    }
  `,nu);Nn([ft({type:String,reflect:!0})],dn.prototype,"label",2);Nn([ft({type:Boolean,attribute:"label-hidden",reflect:!0})],dn.prototype,"labelHidden",2);Nn([ft({type:Boolean,reflect:!0})],dn.prototype,"active",2);Nn([ft({type:Boolean,reflect:!0,attribute:"disabled"})],dn.prototype,"disabled",2);Nn([ft({type:String,reflect:!0})],dn.prototype,"icon",2);Nn([ft({type:Boolean,reflect:!0})],dn.prototype,"vertical",2);Nn([ft({type:Number,attribute:"tooltip-time",reflect:!0})],dn.prototype,"tooltipTime",2);Nn([ft({type:Boolean,attribute:"tooltip-visible",reflect:!0})],dn.prototype,"tooltipVisible",2);Nn([ft({type:String,attribute:"tooltip-title",reflect:!0})],dn.prototype,"tooltipTitle",2);Nn([ft({type:String,attribute:"tooltip-text",reflect:!0})],dn.prototype,"tooltipText",2);Nn([ft({type:Boolean,reflect:!0})],dn.prototype,"loading",1);let QV=dn;var KV=Object.defineProperty,Gd=(n,t,e,s)=>{for(var i=void 0,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=o(t,e,i)||i);return i&&KV(t,e,i),i};const w2=class extends oe{constructor(){super(...arguments),this.checked=!1,this.inverted=!1,this.onValueChange=new Event("change")}get value(){return this.checked}onChange(t){t.stopPropagation(),this.checked=t.target.checked,this.dispatchEvent(this.onValueChange)}render(){const t=At`
      <svg viewBox="0 0 21 21">
        <polyline points="5 10.75 8.5 14.25 16 6"></polyline>
      </svg>
    `;return At`
      <div class="parent">
        <label class="parent-label">
          ${this.label?At`<bim-label .icon="${this.icon}">${this.label}</bim-label> `:null}
          <div class="input-container">
            <input
              type="checkbox"
              aria-label=${this.label||this.name||"Checkbox Input"}
              @change="${this.onChange}"
              .checked="${this.checked}"
            />
            ${t}
          </div>
        </label>
      </div>
    `}};w2.styles=ce`
    :host {
      display: block;
    }

    .parent-label {
      --background: #fff;
      --border: #dfdfe6;
      --stroke: #fff;
      --border-hover: var(--bim-ui_main-base);
      --border-active: var(--bim-ui_main-base);
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      width: 100%;
      height: 1.75rem;
      column-gap: 0.25rem;
      position: relative;
      cursor: pointer;
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }

    :host([inverted]) .parent-label {
      flex-direction: row-reverse;
      justify-content: start;
    }

    input,
    svg {
      width: 1rem;
      height: 1rem;
      display: block;
    }

    input {
      -webkit-appearance: none;
      -moz-appearance: none;
      position: relative;
      outline: none;
      background: var(--background);
      border: none;
      margin: 0;
      padding: 0;
      cursor: pointer;
      border-radius: 4px;
      transition: box-shadow 0.3s;
      box-shadow: inset 0 0 0 var(--s, 1px) var(--b, var(--border));
    }

    svg {
      pointer-events: none;
      fill: none;
      stroke-width: 2.2px;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke: var(--stroke, var(--border-active));
      transform: translateY(-100%) scale(0);
      position: absolute;
      width: 1rem;
      height: 1rem;
    }

    input:hover {
      --s: 2px;
      --b: var(--border-hover);
    }

    input:checked {
      --b: var(--border-active);
      --s: 11px;
    }

    input:checked + svg {
      -webkit-animation: bounce 0.4s linear forwards 0.2s;
      animation: bounce 0.4s linear forwards 0.2s;
    }

    @keyframes bounce {
      0% {
        transform: translateY(-100%) scale(0);
      }
      50% {
        transform: translateY(-100%) scale(1.2);
      }
      75% {
        transform: translateY(-100%) scale(0.9);
      }
      100% {
        transform: translateY(-100%) scale(1);
      }
    }
  `;let nh=w2;Gd([ft({type:String,reflect:!0})],nh.prototype,"icon");Gd([ft({type:String,reflect:!0})],nh.prototype,"name");Gd([ft({type:String,reflect:!0})],nh.prototype,"label");Gd([ft({type:Boolean,reflect:!0})],nh.prototype,"checked");Gd([ft({type:Boolean,reflect:!0})],nh.prototype,"inverted");var JV=Object.defineProperty,nl=(n,t,e,s)=>{for(var i=void 0,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=o(t,e,i)||i);return i&&JV(t,e,i),i};const E2=class extends oe{constructor(){super(...arguments),this.vertical=!1,this.color="#bcf124",this.disabled=!1,this._colorInput=Dc(),this._textInput=Dc(),this.onValueChange=new Event("input"),this.onOpacityInput=t=>{const e=t.target;this.opacity=e.value,this.dispatchEvent(this.onValueChange)}}set value(t){const{color:e,opacity:s}=t;this.color=e,s&&(this.opacity=s)}get value(){const t={color:this.color};return this.opacity&&(t.opacity=this.opacity),t}onColorInput(t){t.stopPropagation();const{value:e}=this._colorInput;e&&(this.color=e.value,this.dispatchEvent(this.onValueChange))}onTextInput(t){t.stopPropagation();const{value:e}=this._textInput;if(!e)return;const{value:s}=e;let i=s.replace(/[^a-fA-F0-9]/g,"");i.startsWith("#")||(i=`#${i}`),e.value=i.slice(0,7),e.value.length===7&&(this.color=e.value,this.dispatchEvent(this.onValueChange))}focus(){const{value:t}=this._colorInput;t&&t.click()}render(){return At`
      <div class="parent">
        <bim-input
          .label=${this.label}
          .icon=${this.icon}
          .vertical="${this.vertical}"
        >
          <div class="color-container">
            <div
              style="display: flex; align-items: center; gap: .375rem; height: 100%; flex: 1; padding: 0 0.5rem;"
            >
              <input
                ${kc(this._colorInput)}
                @input="${this.onColorInput}"
                type="color"
                aria-label=${this.label||this.name||"Color Input"}
                value="${this.color}"
                ?disabled=${this.disabled}
              />
              <div
                @click=${this.focus}
                class="sample"
                style="background-color: ${this.color}"
              ></div>
              <input
                ${kc(this._textInput)}
                @input="${this.onTextInput}"
                value="${this.color}"
                type="text"
                aria-label=${this.label||this.name||"Text Color Input"}
                ?disabled=${this.disabled}
              />
            </div>
            ${this.opacity!==void 0?At`<bim-number-input
                  @change=${this.onOpacityInput}
                  slider
                  suffix="%"
                  min="0"
                  value=${this.opacity}
                  max="100"
                ></bim-number-input>`:null}
          </div>
        </bim-input>
      </div>
    `}};E2.styles=ce`
    :host {
      --bim-input--bgc: var(--bim-ui_bg-contrast-20);
      flex: 1;
      display: block;
    }

    :host(:focus) {
      --bim-input--olw: var(--bim-number-input--olw, 2px);
      --bim-input--olc: var(--bim-ui_accent-base);
    }

    .parent {
      display: flex;
      gap: 0.375rem;
    }

    .color-container {
      position: relative;
      outline: none;
      display: flex;
      height: 100%;
      gap: 0.5rem;
      justify-content: flex-start;
      align-items: center;
      flex: 1;
      border-radius: var(--bim-color-input--bdrs, var(--bim-ui_size-4xs));
    }

    .color-container input[type="color"] {
      position: absolute;
      bottom: -0.25rem;
      visibility: hidden;
      width: 0;
      height: 0;
    }

    .color-container .sample {
      width: 1rem;
      height: 1rem;
      border-radius: 0.125rem;
      background-color: #fff;
    }

    .color-container input[type="text"] {
      height: 100%;
      flex: 1;
      width: 3.25rem;
      text-transform: uppercase;
      font-size: 0.75rem;
      background-color: transparent;
      padding: 0%;
      outline: none;
      border: none;
      color: var(--bim-color-input--c, var(--bim-ui_bg-contrast-100));
    }

    :host([disabled]) .color-container input[type="text"] {
      color: var(--bim-ui_bg-contrast-60);
    }

    bim-number-input {
      flex-grow: 0;
    }
  `;let Ko=E2;nl([ft({type:String,reflect:!0})],Ko.prototype,"name");nl([ft({type:String,reflect:!0})],Ko.prototype,"label");nl([ft({type:String,reflect:!0})],Ko.prototype,"icon");nl([ft({type:Boolean,reflect:!0})],Ko.prototype,"vertical");nl([ft({type:Number,reflect:!0})],Ko.prototype,"opacity");nl([ft({type:String,reflect:!0})],Ko.prototype,"color");nl([ft({type:Boolean,reflect:!0})],Ko.prototype,"disabled");var t7=Object.defineProperty,e7=Object.getOwnPropertyDescriptor,Jo=(n,t,e,s)=>{for(var i=s>1?void 0:s?e7(t,e):t,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(t,e,i):o(i))||i);return s&&i&&t7(t,e,i),i};const x2=class extends oe{constructor(){super(...arguments),this.checked=!1,this.checkbox=!1,this.noMark=!1,this.vertical=!1}get value(){return this._value!==void 0?this._value:this.label?Ug(this.label):this.label}set value(t){this._value=t}render(){return At`
      <div class="parent" .title=${this.label??""}>
        ${this.img||this.icon||this.label?At` <div style="display: flex; column-gap: 0.375rem">
              ${this.checkbox&&!this.noMark?At`<bim-checkbox
                    style="pointer-events: none"
                    .checked=${this.checked}
                  ></bim-checkbox>`:null}
              <bim-label
                .vertical=${this.vertical}
                .icon=${this.icon}
                .img=${this.img}
                >${this.label}</bim-label
              >
            </div>`:null}
        ${!this.checkbox&&!this.noMark&&this.checked?At`<svg
              xmlns="http://www.w3.org/2000/svg"
              height="1.125rem"
              viewBox="0 0 24 24"
              width="1.125rem"
              fill="#FFFFFF"
            >
              <path d="M0 0h24v24H0z" fill="none" />
              <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
            </svg>`:null}
        <slot></slot>
      </div>
    `}};x2.styles=ce`
    :host {
      --bim-label--c: var(--bim-ui_bg-contrast-100);
      display: block;
      box-sizing: border-box;
      flex: 1;
      padding: 0rem 0.5rem;
      border-radius: var(--bim-ui_size-4xs);
      transition: all 0.15s;
    }

    :host(:hover) {
      cursor: pointer;
    }

    :host([checked]) {
      --bim-label--c: color-mix(in lab, var(--bim-ui_main-base), white 30%);
    }

    :host([checked]) svg {
      fill: color-mix(in lab, var(--bim-ui_main-base), white 30%);
    }

    .parent {
      box-sizing: border-box;
      display: flex;
      justify-content: var(--bim-option--jc, space-between);
      column-gap: 0.5rem;
      align-items: center;
      min-height: 1.75rem;
      height: 100%;
    }

    input {
      height: 1rem;
      width: 1rem;
      cursor: pointer;
      border: none;
      outline: none;
      accent-color: var(--bim-checkbox--c, var(--bim-ui_main-base));
    }

    input:focus {
      outline: var(--bim-checkbox--olw, 2px) solid
        var(--bim-checkbox--olc, var(--bim-ui_accent-base));
    }

    bim-label {
      pointer-events: none;
      z-index: 1;
    }
  `;let bs=x2;Jo([ft({type:String,reflect:!0})],bs.prototype,"img",2);Jo([ft({type:String,reflect:!0})],bs.prototype,"label",2);Jo([ft({type:String,reflect:!0})],bs.prototype,"icon",2);Jo([ft({type:Boolean,reflect:!0})],bs.prototype,"checked",2);Jo([ft({type:Boolean,reflect:!0})],bs.prototype,"checkbox",2);Jo([ft({type:Boolean,attribute:"no-mark",reflect:!0})],bs.prototype,"noMark",2);Jo([ft({converter:{fromAttribute(n){return n&&Ug(n)}}})],bs.prototype,"value",1);Jo([ft({type:Boolean,reflect:!0})],bs.prototype,"vertical",2);var s7=Object.defineProperty,i7=Object.getOwnPropertyDescriptor,Zr=(n,t,e,s)=>{for(var i=s>1?void 0:s?i7(t,e):t,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(t,e,i):o(i))||i);return s&&i&&s7(t,e,i),i};const I2=class extends Xm{constructor(){super(),this.multiple=!1,this.required=!1,this.vertical=!1,this._visible=!1,this._value=new Set,this.onValueChange=new Event("change"),this._contextMenu=Dc(),this.onOptionClick=t=>{const e=t.target,s=this._value.has(e);if(!this.multiple&&!this.required&&!s)this._value=new Set([e]);else if(!this.multiple&&!this.required&&s)this._value=new Set([]);else if(!this.multiple&&this.required&&!s)this._value=new Set([e]);else if(this.multiple&&!this.required&&!s)this._value=new Set([...this._value,e]);else if(this.multiple&&!this.required&&s){const i=[...this._value].filter(r=>r!==e);this._value=new Set(i)}else if(this.multiple&&this.required&&!s)this._value=new Set([...this._value,e]);else if(this.multiple&&this.required&&s){const i=[...this._value].filter(o=>o!==e),r=new Set(i);r.size!==0&&(this._value=r)}this.updateOptionsState(),this.dispatchEvent(this.onValueChange)},this.useObserver=!0}set visible(t){if(t){const{value:e}=this._contextMenu;if(!e)return;for(const s of this.elements)e.append(s);this._visible=!0}else{for(const e of this.elements)this.append(e);this._visible=!1,this.resetVisibleElements()}}get visible(){return this._visible}set value(t){if(this.required&&Object.keys(t).length===0)return;const e=new Set;for(const s of t){const i=this.findOption(s);if(i&&(e.add(i),!this.multiple&&Object.keys(t).length===1))break}this._value=e,this.updateOptionsState(),this.dispatchEvent(this.onValueChange)}get value(){return[...this._value].filter(t=>t instanceof bs&&t.checked).map(t=>t.value)}get _options(){const t=new Set([...this.elements]);for(const e of this.children)e instanceof bs&&t.add(e);return[...t]}onSlotChange(t){const e=t.target.assignedElements();this.observe(e);const s=new Set;for(const i of this.elements){if(!(i instanceof bs)){i.remove();continue}i.checked&&s.add(i),i.removeEventListener("click",this.onOptionClick),i.addEventListener("click",this.onOptionClick)}this._value=s}updateOptionsState(){for(const t of this._options)t instanceof bs&&(t.checked=this._value.has(t))}findOption(t){return this._options.find(e=>e instanceof bs?e.label===t||e.value===t:!1)}render(){let t,e,s;if(this._value.size===0)t=this.placeholder??"Select an option...";else if(this._value.size===1){const i=[...this._value][0];t=i?.label||i?.value,e=i?.img,s=i?.icon}else t=`Multiple (${this._value.size})`;return At`
      <bim-input
        title=${this.label??""}
        .label=${this.label}
        .icon=${this.icon}
        .vertical=${this.vertical}
      >
        <div class="input" @click=${()=>this.visible=!this.visible}>
          <bim-label
            .img=${e}
            .icon=${s}
            style="overflow: hidden;"
            >${t}</bim-label
          >
          <svg
            style="flex-shrink: 0; fill: var(--bim-dropdown--c, var(--bim-ui_bg-contrast-100))"
            xmlns="http://www.w3.org/2000/svg"
            height="1.125rem"
            viewBox="0 0 24 24"
            width="1.125rem"
            fill="#9ca3af"
          >
            <path d="M0 0h24v24H0V0z" fill="none" />
            <path d="M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z" />
          </svg>
          <bim-context-menu
            ${kc(this._contextMenu)}
            .visible=${this.visible}
            @hidden=${()=>{this.visible&&(this.visible=!1)}}
          >
            <slot @slotchange=${this.onSlotChange}></slot>
          </bim-context-menu>
        </div>
      </bim-input>
    `}};I2.styles=[Qo.scrollbar,ce`
      :host {
        --bim-input--bgc: var(
          --bim-dropdown--bgc,
          var(--bim-ui_bg-contrast-20)
        );
        --bim-input--olw: 2px;
        --bim-input--olc: transparent;
        --bim-input--bdrs: var(--bim-ui_size-4xs);
        flex: 1;
        display: block;
      }

      :host([visible]) {
        --bim-input--olc: var(--bim-ui_accent-base);
      }

      .input {
        --bim-label--fz: var(--bim-drodown--fz, var(--bim-ui_size-xs));
        --bim-label--c: var(--bim-dropdown--c, var(--bim-ui_bg-contrast-100));
        height: 100%;
        display: flex;
        flex: 1;
        overflow: hidden;
        column-gap: 0.25rem;
        outline: none;
        cursor: pointer;
        align-items: center;
        justify-content: space-between;
        padding: 0 0.5rem;
      }

      bim-label {
        pointer-events: none;
      }
    `];let vr=I2;Zr([ft({type:String,reflect:!0})],vr.prototype,"name",2);Zr([ft({type:String,reflect:!0})],vr.prototype,"icon",2);Zr([ft({type:String,reflect:!0})],vr.prototype,"label",2);Zr([ft({type:Boolean,reflect:!0})],vr.prototype,"multiple",2);Zr([ft({type:Boolean,reflect:!0})],vr.prototype,"required",2);Zr([ft({type:Boolean,reflect:!0})],vr.prototype,"vertical",2);Zr([ft({type:String,reflect:!0})],vr.prototype,"placeholder",2);Zr([ft({type:Boolean,reflect:!0})],vr.prototype,"visible",1);Zr([ih()],vr.prototype,"_value",2);var n7=Object.defineProperty,C2=(n,t,e,s)=>{for(var i=void 0,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=o(t,e,i)||i);return i&&n7(t,e,i),i};const T2=class extends oe{constructor(){super(...arguments),this.floating=!1,this._layouts={},this._elements={},this._templateIds=new Map,this._updateFunctions={},this.updateComponent={}}set layouts(t){this._layouts=t,this._templateIds.clear()}get layouts(){return this._layouts}set elements(t){this._elements=t;const e={};for(const[s,i]of Object.entries(this.elements))"template"in i&&(e[s]=r=>{const o=this._updateFunctions[s];o&&o(r)});this.updateComponent=e}get elements(){return this._elements}getLayoutAreas(t){const{template:e}=t,s=e.split(`
`).map(i=>i.trim()).map(i=>i.split('"')[1]).filter(i=>i!==void 0).flatMap(i=>i.split(/\s+/));return[...new Set(s)].filter(i=>i!=="")}firstUpdated(){this._onLayoutChange=new Event("layoutchange")}getTemplateId(t){let e=this._templateIds.get(t);return e||(e=jv.newRandomId(),this._templateIds.set(t,e)),e}cleanUpdateFunctions(){if(!this.layout){this._updateFunctions={};return}const t=this.layouts[this.layout],e=this.getLayoutAreas(t);for(const s in this.elements)e.includes(s)||delete this._updateFunctions[s]}emitElementCreation(t){this.dispatchEvent(new CustomEvent("elementcreated",{detail:t}))}render(){if(this.layout){if(this.layouts[this.layout]){const t=this.layouts[this.layout],e=this.getLayoutAreas(t).map(s=>{var i;const r=((i=t.elements)==null?void 0:i[s])||this.elements[s];if(!r)return null;if(r instanceof HTMLElement)return r.style.gridArea=s,r;if("template"in r){const{template:c,initialState:h}=r,u=this.getTemplateId(c),p=this.querySelector(`[data-grid-template-id="${u}"]`);if(p)return p;const[d,g]=Xm.create(c,h);return this.emitElementCreation({name:s,element:d}),d.setAttribute("data-grid-template-id",u),d.style.gridArea=s,this._updateFunctions[s]=g,d}const o=this.getTemplateId(r),a=this.querySelector(`[data-grid-template-id="${o}"]`);if(a)return a;const l=Xm.create(r);return this.emitElementCreation({name:s,element:l}),l.setAttribute("data-grid-template-id",this.getTemplateId(r)),l.style.gridArea=s,l}).filter(s=>s!==null);this.innerHTML="",this.style.gridTemplate=t.template,this.append(...e),this._onLayoutChange&&this.dispatchEvent(this._onLayoutChange)}}else this.innerHTML="",this.style.gridTemplate="",this._onLayoutChange&&this.dispatchEvent(this._onLayoutChange);return this.cleanUpdateFunctions(),At`<slot></slot>`}};T2.styles=ce`
    :host {
      display: grid;
      height: 100%;
      width: 100%;
      overflow: hidden;
      box-sizing: border-box;
    }

    /* :host(:not([layout])) {
      display: none;
    } */

    :host([floating]) {
      --bim-panel--bdrs: var(--bim-ui_size-4xs);
      background-color: transparent;
      padding: 1rem;
      gap: 1rem;
      position: absolute;
      pointer-events: none;
      top: 0px;
      left: 0px;
    }

    :host(:not([floating])) {
      --bim-panel--bdrs: 0;
      background-color: var(--bim-ui_bg-contrast-20);
      gap: 1px;
    }
  `;let Yv=T2;C2([ft({type:Boolean,reflect:!0})],Yv.prototype,"floating");C2([ft({type:String,reflect:!0})],Yv.prototype,"layout");const Ay=class extends oe{render(){return At`
      <iconify-icon .icon=${this.icon} height="none"></iconify-icon>
    `}};Ay.styles=ce`
    :host {
      height: var(--bim-icon--fz, var(--bim-ui_size-sm));
      width: var(--bim-icon--fz, var(--bim-ui_size-sm));
    }

    iconify-icon {
      height: var(--bim-icon--fz, var(--bim-ui_size-sm));
      width: var(--bim-icon--fz, var(--bim-ui_size-sm));
      color: var(--bim-icon--c);
      transition: all 0.15s;
      display: flex;
    }
  `,Ay.properties={icon:{type:String}};let r7=Ay;var o7=Object.defineProperty,Vg=(n,t,e,s)=>{for(var i=void 0,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=o(t,e,i)||i);return i&&o7(t,e,i),i};const A2=class extends oe{constructor(){super(...arguments),this.vertical=!1,this.onValueChange=new Event("change")}get value(){const t={};for(const e of this.children){const s=e;"value"in s?t[s.name||s.label]=s.value:"checked"in s&&(t[s.name||s.label]=s.checked)}return t}set value(t){const e=[...this.children];for(const s in t){const i=e.find(a=>{const l=a;return l.name===s||l.label===s});if(!i)continue;const r=i,o=t[s];typeof o=="boolean"?r.checked=o:r.value=o}}render(){return At`
      <div class="parent">
        ${this.label||this.icon?At`<bim-label .icon=${this.icon}>${this.label}</bim-label>`:null}
        <div class="input">
          <slot></slot>
        </div>
      </div>
    `}};A2.styles=ce`
    :host {
      flex: 1;
      display: block;
    }

    .parent {
      display: flex;
      flex-wrap: wrap;
      column-gap: 1rem;
      row-gap: 0.375rem;
      user-select: none;
      flex: 1;
    }

    :host(:not([vertical])) .parent {
      justify-content: space-between;
    }

    :host([vertical]) .parent {
      flex-direction: column;
    }

    .input {
      position: relative;
      overflow: hidden;
      box-sizing: border-box;
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      min-height: 1.75rem;
      min-width: 3rem;
      gap: var(--bim-input--g, var(--bim-ui_size-4xs));
      padding: var(--bim-input--p, 0);
      background-color: var(--bim-input--bgc, transparent);
      border: var(--bim-input--olw, 2px) solid
        var(--bim-input--olc, transparent);
      border-radius: var(--bim-input--bdrs, var(--bim-ui_size-4xs));
      transition: all 0.15s;
    }

    :host(:not([vertical])) .input {
      flex: 1;
      justify-content: flex-end;
    }

    :host(:not([vertical])[label]) .input {
      max-width: fit-content;
    }
  `;let qd=A2;Vg([ft({type:String,reflect:!0})],qd.prototype,"name");Vg([ft({type:String,reflect:!0})],qd.prototype,"label");Vg([ft({type:String,reflect:!0})],qd.prototype,"icon");Vg([ft({type:Boolean,reflect:!0})],qd.prototype,"vertical");var a7=Object.defineProperty,Zd=(n,t,e,s)=>{for(var i=void 0,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=o(t,e,i)||i);return i&&a7(t,e,i),i};const S2=class extends oe{constructor(){super(...arguments),this.labelHidden=!1,this.iconHidden=!1,this.vertical=!1}get value(){return this.textContent?Ug(this.textContent):this.textContent}render(){return At`
      <div class="parent" .title=${this.textContent??""}>
        ${this.img?At`<img .src=${this.img} .alt=${this.textContent||""} />`:null}
        ${!this.iconHidden&&this.icon?At`<bim-icon .icon=${this.icon}></bim-icon>`:null}
        <p><slot></slot></p>
      </div>
    `}};S2.styles=ce`
    :host {
      --bim-icon--c: var(--bim-label--ic);
      overflow: auto;
      color: var(--bim-label--c, var(--bim-ui_bg-contrast-60));
      font-size: var(--bim-label--fz, var(--bim-ui_size-xs));
      display: block;
      white-space: nowrap;
      transition: all 0.15s;
    }

    :host([icon]) {
      line-height: 1.1rem;
    }

    .parent {
      display: flex;
      align-items: center;
      column-gap: 0.25rem;
      row-gap: 0.125rem;
      user-select: none;
      height: 100%;
    }

    :host([vertical]) .parent {
      flex-direction: column;
    }

    .parent p {
      display: flex;
      margin: 0;
      text-overflow: ellipsis;
      overflow: hidden;
      align-items: center;
      gap: 0.125rem;
    }

    :host([label-hidden]) .parent p,
    :host(:empty) .parent p {
      display: none;
    }

    img {
      height: 100%;
      aspect-ratio: 1;
      border-radius: 100%;
      margin-right: 0.125rem;
    }

    :host(:not([vertical])) img {
      max-height: var(
        --bim-label_icon--sz,
        calc(var(--bim-label--fz, var(--bim-ui_size-xs)) * 1.8)
      );
    }

    :host([vertical]) img {
      max-height: var(
        --bim-label_icon--sz,
        calc(var(--bim-label--fz, var(--bim-ui_size-xs)) * 4)
      );
    }
  `;let rh=S2;Zd([ft({type:String,reflect:!0})],rh.prototype,"img");Zd([ft({type:Boolean,attribute:"label-hidden",reflect:!0})],rh.prototype,"labelHidden");Zd([ft({type:String,reflect:!0})],rh.prototype,"icon");Zd([ft({type:Boolean,attribute:"icon-hidden",reflect:!0})],rh.prototype,"iconHidden");Zd([ft({type:Boolean,reflect:!0})],rh.prototype,"vertical");var l7=Object.defineProperty,c7=Object.getOwnPropertyDescriptor,pn=(n,t,e,s)=>{for(var i=s>1?void 0:s?c7(t,e):t,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(t,e,i):o(i))||i);return s&&i&&l7(t,e,i),i};const O2=class extends oe{constructor(){super(...arguments),this._value=0,this.vertical=!1,this.slider=!1,this._input=Dc(),this.onValueChange=new Event("change")}set value(t){this.setValue(t.toString())}get value(){return this._value}onChange(t){t.stopPropagation();const{value:e}=this._input;e&&this.setValue(e.value)}setValue(t){const{value:e}=this._input;let s=t;if(s=s.replace(/[^0-9.-]/g,""),s=s.replace(/(\..*)\./g,"$1"),s.endsWith(".")||(s.lastIndexOf("-")>0&&(s=s[0]+s.substring(1).replace(/-/g,"")),s==="-"||s==="-0"))return;let i=Number(s);Number.isNaN(i)||(i=this.min!==void 0?Math.max(i,this.min):i,i=this.max!==void 0?Math.min(i,this.max):i,this.value!==i&&(this._value=i,e&&(e.value=this.value.toString()),this.requestUpdate(),this.dispatchEvent(this.onValueChange)))}onBlur(){const{value:t}=this._input;t&&Number.isNaN(Number(t.value))&&(t.value=this.value.toString())}onSliderMouseDown(t){document.body.style.cursor="w-resize";const{clientX:e}=t,s=this.value;let i=!1;const r=l=>{var c;i=!0;const{clientX:h}=l,u=this.step??1,p=((c=u.toString().split(".")[1])==null?void 0:c.length)||0,d=1/(this.sensitivity??1),g=(h-e)/d;if(Math.floor(Math.abs(g))!==Math.abs(g))return;const m=s+g*u;this.setValue(m.toFixed(p))},o=()=>{this.slider=!0,this.removeEventListener("blur",o)},a=()=>{document.removeEventListener("mousemove",r),document.body.style.cursor="default",i?i=!1:(this.addEventListener("blur",o),this.slider=!1,requestAnimationFrame(()=>this.focus())),document.removeEventListener("mouseup",a)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",a)}onFocus(t){t.stopPropagation();const e=s=>{s.key==="Escape"&&(this.blur(),window.removeEventListener("keydown",e))};window.addEventListener("keydown",e)}connectedCallback(){super.connectedCallback(),this.min&&this.min>this.value&&(this._value=this.min),this.max&&this.max<this.value&&(this._value=this.max)}focus(){const{value:t}=this._input;t&&t.focus()}render(){const t=At`
      ${this.pref||this.icon?At`<bim-label
            style="pointer-events: auto"
            @mousedown=${this.onSliderMouseDown}
            .icon=${this.icon}
            >${this.pref}</bim-label
          >`:null}
      <input
        ${kc(this._input)}
        type="text"
        aria-label=${this.label||this.name||"Number Input"}
        size="1"
        @input=${a=>a.stopPropagation()}
        @change=${this.onChange}
        @blur=${this.onBlur}
        @focus=${this.onFocus}
        .value=${this.value.toString()}
      />
      ${this.suffix?At`<bim-label
            style="pointer-events: auto"
            @mousedown=${this.onSliderMouseDown}
            >${this.suffix}</bim-label
          >`:null}
    `,e=this.min??-1/0,s=this.max??1/0,i=100*(this.value-e)/(s-e),r=At`
      <style>
        .slider-indicator {
          width: ${`${i}%`};
        }
      </style>
      <div class="slider" @mousedown=${this.onSliderMouseDown}>
        <div class="slider-indicator"></div>
        ${this.pref||this.icon?At`<bim-label
              style="z-index: 1; margin-right: 0.125rem"
              .icon=${this.icon}
              >${`${this.pref}: `}</bim-label
            >`:null}
        <bim-label style="z-index: 1;">${this.value}</bim-label>
        ${this.suffix?At`<bim-label style="z-index: 1;">${this.suffix}</bim-label>`:null}
      </div>
    `,o=`${this.label||this.name||this.pref?`${this.label||this.name||this.pref}: `:""}${this.value}${this.suffix??""}`;return At`
      <bim-input
        title=${o}
        .label=${this.label}
        .icon=${this.icon}
        .vertical=${this.vertical}
      >
        ${this.slider?r:t}
      </bim-input>
    `}};O2.styles=ce`
    :host {
      --bim-input--bgc: var(
        --bim-number-input--bgc,
        var(--bim-ui_bg-contrast-20)
      );
      --bim-input--olw: var(--bim-number-input--olw, 2px);
      --bim-input--olc: var(--bim-number-input--olc, transparent);
      --bim-input--bdrs: var(--bim-number-input--bdrs, var(--bim-ui_size-4xs));
      --bim-input--p: 0 0.375rem;
      flex: 1;
      display: block;
    }

    :host(:focus) {
      --bim-input--olw: var(--bim-number-input--olw, 2px);
      --bim-input--olc: var(
        --bim-number-input¡focus--c,
        var(--bim-ui_accent-base)
      );
    }

    :host(:not([slider])) bim-label {
      --bim-label--c: var(
        --bim-number-input_affixes--c,
        var(--bim-ui_bg-contrast-60)
      );
      --bim-label--fz: var(
        --bim-number-input_affixes--fz,
        var(--bim-ui_size-xs)
      );
    }

    p {
      margin: 0;
      padding: 0;
    }

    input {
      background-color: transparent;
      outline: none;
      border: none;
      padding: 0;
      flex-grow: 1;
      text-align: right;
      font-family: inherit;
      font-feature-settings: inherit;
      font-variation-settings: inherit;
      font-size: var(--bim-number-input--fz, var(--bim-ui_size-xs));
      color: var(--bim-number-input--c, var(--bim-ui_bg-contrast-100));
    }

    :host([suffix]:not([pref])) input {
      text-align: left;
    }

    :host([slider]) {
      --bim-input--p: 0;
    }

    :host([slider]) .slider {
      --bim-label--c: var(--bim-ui_bg-contrast-100);
    }

    .slider {
      position: relative;
      display: flex;
      justify-content: center;
      width: 100%;
      height: 100%;
      padding: 0 0.5rem;
    }

    .slider-indicator {
      height: 100%;
      background-color: var(--bim-ui_main-base);
      position: absolute;
      top: 0;
      left: 0;
      border-radius: var(--bim-input--bdrs, var(--bim-ui_size-4xs));
    }

    bim-input {
      display: flex;
    }

    bim-label {
      pointer-events: none;
    }
  `;let Ri=O2;pn([ft({type:String,reflect:!0})],Ri.prototype,"name",2);pn([ft({type:String,reflect:!0})],Ri.prototype,"icon",2);pn([ft({type:String,reflect:!0})],Ri.prototype,"label",2);pn([ft({type:String,reflect:!0})],Ri.prototype,"pref",2);pn([ft({type:Number,reflect:!0})],Ri.prototype,"min",2);pn([ft({type:Number,reflect:!0})],Ri.prototype,"value",1);pn([ft({type:Number,reflect:!0})],Ri.prototype,"step",2);pn([ft({type:Number,reflect:!0})],Ri.prototype,"sensitivity",2);pn([ft({type:Number,reflect:!0})],Ri.prototype,"max",2);pn([ft({type:String,reflect:!0})],Ri.prototype,"suffix",2);pn([ft({type:Boolean,reflect:!0})],Ri.prototype,"vertical",2);pn([ft({type:Boolean,reflect:!0})],Ri.prototype,"slider",2);var h7=Object.defineProperty,u7=Object.getOwnPropertyDescriptor,Xd=(n,t,e,s)=>{for(var i=s>1?void 0:s?u7(t,e):t,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(t,e,i):o(i))||i);return s&&i&&h7(t,e,i),i};const P2=class extends oe{constructor(){super(...arguments),this.onValueChange=new Event("change"),this._hidden=!1,this.headerHidden=!1,this.valueTransform={},this.activationButton=document.createElement("bim-button")}set hidden(t){this._hidden=t,this.activationButton.active=!t,this.dispatchEvent(new Event("hiddenchange"))}get hidden(){return this._hidden}get value(){return Qm(this,this.valueTransform)}set value(t){const e=[...this.children];for(const s in t){const i=e.find(o=>{const a=o;return a.name===s||a.label===s});if(!i)continue;const r=i;r.value=t[s]}}animatePanles(){const t=[{maxHeight:"100vh",maxWidth:"100vw",opacity:1},{maxHeight:"100vh",maxWidth:"100vw",opacity:0},{maxHeight:0,maxWidth:0,opacity:0}];this.animate(t,{duration:300,easing:"cubic-bezier(0.65, 0.05, 0.36, 1)",direction:this.hidden?"normal":"reverse",fill:"forwards"})}connectedCallback(){super.connectedCallback(),this.activationButton.active=!this.hidden,this.activationButton.onclick=()=>{this.hidden=!this.hidden,this.animatePanles()}}disconnectedCallback(){super.disconnectedCallback(),this.activationButton.remove()}collapseSections(){const t=this.querySelectorAll("bim-panel-section");for(const e of t)e.collapsed=!0}expandSections(){const t=this.querySelectorAll("bim-panel-section");for(const e of t)e.collapsed=!1}render(){return this.activationButton.icon=this.icon,this.activationButton.label=this.label||this.name,this.activationButton.tooltipTitle=this.label||this.name,At`
      <div class="parent">
        ${this.label||this.name||this.icon?At`<bim-label .icon=${this.icon}>${this.label}</bim-label>`:null}
        <div class="sections">
          <slot></slot>
        </div>
      </div>
    `}};P2.styles=[Qo.scrollbar,ce`
      :host {
        display: flex;
        border-radius: var(--bim-ui_size-base);
        background-color: var(--bim-ui_bg-base);
        overflow: auto;
      }

      :host([hidden]) {
        max-height: 0;
        max-width: 0;
        opacity: 0;
      }

      .parent {
        display: flex;
        flex: 1;
        flex-direction: column;
        pointer-events: auto;
        overflow: auto;
      }

      .parent bim-label {
        --bim-label--c: var(--bim-panel--c, var(--bim-ui_bg-contrast-80));
        --bim-label--fz: var(--bim-panel--fz, var(--bim-ui_size-sm));
        font-weight: 600;
        padding: 1rem;
        flex-shrink: 0;
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([header-hidden]) .parent bim-label {
        display: none;
      }

      .sections {
        height: 100%;
        display: flex;
        flex-direction: column;
        overflow: auto;
        flex: 1;
      }

      ::slotted(bim-panel-section:not(:last-child)) {
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      }
    `];let rl=P2;Xd([ft({type:String,reflect:!0})],rl.prototype,"icon",2);Xd([ft({type:String,reflect:!0})],rl.prototype,"name",2);Xd([ft({type:String,reflect:!0})],rl.prototype,"label",2);Xd([ft({type:Boolean,reflect:!0})],rl.prototype,"hidden",1);Xd([ft({type:Boolean,attribute:"header-hidden",reflect:!0})],rl.prototype,"headerHidden",2);var d7=Object.defineProperty,Qd=(n,t,e,s)=>{for(var i=void 0,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=o(t,e,i)||i);return i&&d7(t,e,i),i};const R2=class extends oe{constructor(){super(...arguments),this.onValueChange=new Event("change"),this.valueTransform={},this.componentHeight=-1}get value(){const t=this.parentElement;let e;return t instanceof rl&&(e=t.valueTransform),Object.values(this.valueTransform).length!==0&&(e=this.valueTransform),Qm(this,e)}set value(t){const e=[...this.children];for(const s in t){const i=e.find(o=>{const a=o;return a.name===s||a.label===s});if(!i)continue;const r=i;r.value=t[s]}}setFlexAfterTransition(){var t;const e=(t=this.shadowRoot)==null?void 0:t.querySelector(".components");e&&setTimeout(()=>{this.collapsed?e.style.removeProperty("flex"):e.style.setProperty("flex","1")},150)}animateHeader(){var t;const e=(t=this.shadowRoot)==null?void 0:t.querySelector(".components");this.componentHeight<0&&(this.collapsed?this.componentHeight=e.clientHeight:(e.style.setProperty("transition","none"),e.style.setProperty("height","auto"),e.style.setProperty("padding","0.125rem 1rem 1rem"),this.componentHeight=e.clientHeight,requestAnimationFrame(()=>{e.style.setProperty("height","0px"),e.style.setProperty("padding","0 1rem 0"),e.style.setProperty("transition","height 0.25s cubic-bezier(0.65, 0.05, 0.36, 1), padding 0.25s cubic-bezier(0.65, 0.05, 0.36, 1)")}))),this.collapsed?(e.style.setProperty("height",`${this.componentHeight}px`),requestAnimationFrame(()=>{e.style.setProperty("height","0px"),e.style.setProperty("padding","0 1rem 0")})):(e.style.setProperty("height","0px"),e.style.setProperty("padding","0 1rem 0"),requestAnimationFrame(()=>{e.style.setProperty("height",`${this.componentHeight}px`),e.style.setProperty("padding","0.125rem 1rem 1rem")})),this.setFlexAfterTransition()}onHeaderClick(){this.fixed||(this.collapsed=!this.collapsed,this.animateHeader())}handelSlotChange(t){t.target.assignedElements({flatten:!0}).forEach((e,s)=>{const i=s*.05;e.style.setProperty("transition-delay",`${i}s`)})}handlePointerEnter(){const t=this.renderRoot.querySelector(".expand-icon");this.collapsed?t?.style.setProperty("animation","collapseAnim 0.5s"):t?.style.setProperty("animation","expandAnim 0.5s")}handlePointerLeave(){const t=this.renderRoot.querySelector(".expand-icon");t?.style.setProperty("animation","none")}render(){const t=this.label||this.icon||this.name||this.fixed,e=At`<svg
      xmlns="http://www.w3.org/2000/svg"
      height="1.125rem"
      viewBox="0 0 24 24"
      width="1.125rem"
      class="expand-icon"
    >
      <path d="M0 0h24v24H0z" fill="none" />
      <path d="M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z" />
    </svg>`,s=At`
      <div
        class="header"
        title=${this.label??""}
        @pointerenter=${this.handlePointerEnter}
        @pointerleave=${this.handlePointerLeave}
        @click=${this.onHeaderClick}
      >
        ${this.label||this.icon||this.name?At`<bim-label .icon=${this.icon}>${this.label}</bim-label>`:null}
        ${this.fixed?null:e}
      </div>
    `;return At`
      <div class="parent">
        ${t?s:null}
        <div class="components" style="flex: 1;">
          <div>
            <slot @slotchange=${this.handelSlotChange}></slot>
          </div>
        </div>
      </div>
    `}};R2.styles=[Qo.scrollbar,ce`
      :host {
        display: block;
        pointer-events: auto;
      }

      :host .parent {
        display: flex;
        flex-direction: column;
        height: 100%;
      }

      :host(:not([fixed])) .header:hover {
        --bim-label--c: var(--bim-ui_accent-base);
        color: var(--bim-ui_accent-base);
        cursor: pointer;
      }

      :host(:not([fixed])) .header:hover .expand-icon {
        fill: var(--bim-ui_accent-base);
      }

      .header {
        --bim-label--fz: var(--bim-ui_size-sm);
        --bim-label--c: var(
          --bim-panel-section_hc,
          var(--bim-ui_bg-contrast-80)
        );
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: 600;
        height: 1.5rem;
        padding: 0.75rem 1rem;
      }

      .expand-icon {
        fill: var(--bim-ui_bg-contrast-80);
        transition: transform 0.2s;
      }

      :host([collapsed]) .expand-icon {
        transform: rotateZ(-180deg);
      }

      .title {
        display: flex;
        align-items: center;
        column-gap: 0.5rem;
      }

      .title p {
        font-size: var(--bim-ui_size-sm);
      }

      .components {
        display: flex;
        flex-direction: column;
        overflow: hidden;
        row-gap: 0.75rem;
        padding: 0 1rem 1rem;
        box-sizing: border-box;
        transition:
          height 0.25s cubic-bezier(0.65, 0.05, 0.36, 1),
          padding 0.25s cubic-bezier(0.65, 0.05, 0.36, 1);
      }

      .components > div {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        flex: 1;
        overflow: auto;
      }

      :host(:not([icon]):not([label])) .components {
        padding: 1rem;
      }

      :host(:not([fixed])[collapsed]) .components {
        padding: 0 1rem 0;
        height: 0px;
      }

      bim-label {
        pointer-events: none;
      }

      ::slotted(*) {
        transition:
          transform 0.25s cubic-bezier(0.65, 0.05, 0.36, 1),
          opacity 0.25s cubic-bezier(0.65, 0.05, 0.36, 1);
      }

      :host(:not([fixed])[collapsed]) ::slotted(*) {
        transform: translateX(-20%);
        opacity: 0;
      }

      @keyframes expandAnim {
        0%,
        100% {
          transform: translateY(0%);
        }
        25% {
          transform: translateY(-30%);
        }
        50% {
          transform: translateY(10%);
        }
        75% {
          transform: translateY(-30%);
        }
      }

      @keyframes collapseAnim {
        0%,
        100% {
          transform: translateY(0%) rotateZ(-180deg);
        }
        25% {
          transform: translateY(30%) rotateZ(-180deg);
        }
        50% {
          transform: translateY(-10%) rotateZ(-180deg);
        }
        75% {
          transform: translateY(30%) rotateZ(-180deg);
        }
      }
    `];let oh=R2;Qd([ft({type:String,reflect:!0})],oh.prototype,"icon");Qd([ft({type:String,reflect:!0})],oh.prototype,"label");Qd([ft({type:String,reflect:!0})],oh.prototype,"name");Qd([ft({type:Boolean,reflect:!0})],oh.prototype,"fixed");Qd([ft({type:Boolean,reflect:!0})],oh.prototype,"collapsed");var p7=Object.defineProperty,Kd=(n,t,e,s)=>{for(var i=void 0,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=o(t,e,i)||i);return i&&p7(t,e,i),i};const F2=class extends oe{constructor(){super(...arguments),this.vertical=!1,this.onValueChange=new Event("change"),this._canEmitEvents=!1,this._value=document.createElement("bim-option"),this.onOptionClick=t=>{this._value=t.target,this.setAnimatedBackgound(),this.dispatchEvent(this.onValueChange);for(const e of this.children)e instanceof bs&&(e.checked=e===t.target)}}get _options(){return[...this.querySelectorAll("bim-option")]}set value(t){const e=this.findOption(t);if(e){for(const s of this._options)s.checked=s===e;this._value=e,this.setAnimatedBackgound(),this._canEmitEvents&&this.dispatchEvent(this.onValueChange)}}get value(){return this._value.value}onSlotChange(t){const e=t.target.assignedElements();for(const s of e)s instanceof bs&&(s.noMark=!0,s.removeEventListener("click",this.onOptionClick),s.addEventListener("click",this.onOptionClick))}findOption(t){return this._options.find(e=>e instanceof bs?e.label===t||e.value===t:!1)}doubleRequestAnimationFrames(t){requestAnimationFrame(()=>requestAnimationFrame(t))}setAnimatedBackgound(t=!1){const e=this.renderRoot.querySelector(".animated-background"),s=this._value;requestAnimationFrame(()=>{var i,r,o,a;const l=(a=(o=(r=(i=s?.parentElement)==null?void 0:i.shadowRoot)==null?void 0:r.querySelector("bim-input"))==null?void 0:o.shadowRoot)==null?void 0:a.querySelector(".input"),c={width:s?.clientWidth,height:s?.clientHeight,top:(s?.offsetTop??0)-(l?.offsetTop??0),left:(s?.offsetLeft??0)-(l?.offsetLeft??0)};e?.style.setProperty("width",`${c.width}px`),e?.style.setProperty("height",`${c.height}px`),e?.style.setProperty("top",`${c.top}px`),e?.style.setProperty("left",`${c.left}px`)}),t&&this.doubleRequestAnimationFrames(()=>{const i="ease";e?.style.setProperty("transition",`width ${.3}s ${i}, height ${.3}s ${i}, top ${.3}s ${i}, left ${.3}s ${i}`)})}firstUpdated(){const t=[...this.children].find(e=>e instanceof bs&&e.checked);t&&(this._value=t),window.addEventListener("load",()=>{this.setAnimatedBackgound(!0)}),new ResizeObserver(()=>{this.setAnimatedBackgound()}).observe(this)}render(){return At`
      <bim-input
        .vertical=${this.vertical}
        .label=${this.label}
        .icon=${this.icon}
      >
        <div class="animated-background"></div>
        <slot @slotchange=${this.onSlotChange}></slot>
      </bim-input>
    `}};F2.styles=ce`
    :host {
      --bim-input--bgc: var(--bim-ui_bg-contrast-20);
      --bim-input--g: 0;
      --bim-option--jc: center;
      flex: 1;
      display: block;
    }

    ::slotted(bim-option) {
      position: relative;
      border-radius: 0;
      overflow: hidden;
      min-width: min-content;
      min-height: min-content;
      transition: background-color 0.2s;
    }

    .animated-background {
      position: absolute;
      background: var(--bim-ui_main-base);
      width: 0;
      height: 0;
      top: 0;
      left: 0;
    }

    ::slotted(bim-option[checked]) {
      --bim-label--c: var(--bim-ui_main-contrast);
    }

    ::slotted(bim-option:not([checked]):hover) {
      background-color: #0003;
    }
  `;let ah=F2;Kd([ft({type:String,reflect:!0})],ah.prototype,"name");Kd([ft({type:String,reflect:!0})],ah.prototype,"icon");Kd([ft({type:String,reflect:!0})],ah.prototype,"label");Kd([ft({type:Boolean,reflect:!0})],ah.prototype,"vertical");Kd([ih()],ah.prototype,"_value");const f7=()=>At`
    <style>
      div {
        display: flex;
        gap: 0.375rem;
        border-radius: 0.25rem;
        min-height: 1.25rem;
      }

      [data-type="row"] {
        background-color: var(--bim-ui_bg-contrast-10);
        animation: row-loading 1s linear infinite alternate;
        padding: 0.5rem;
      }

      [data-type="cell"] {
        background-color: var(--bim-ui_bg-contrast-20);
        flex: 0.25;
      }

      @keyframes row-loading {
        0% {
          background-color: var(--bim-ui_bg-contrast-10);
        }
        100% {
          background-color: var(--bim-ui_bg-contrast-20);
        }
      }
    </style>
    <div style="display: flex; flex-direction: column;">
      <div data-type="row" style="gap: 2rem">
        <div data-type="cell" style="flex: 1"></div>
        <div data-type="cell" style="flex: 2"></div>
        <div data-type="cell" style="flex: 1"></div>
        <div data-type="cell" style="flex: 0.5"></div>
      </div>
      <div style="display: flex;">
        <div data-type="row" style="flex: 1">
          <div data-type="cell" style="flex: 0.5"></div>
        </div>
        <div data-type="row" style="flex: 2">
          <div data-type="cell" style="flex: 0.75"></div>
        </div>
        <div data-type="row" style="flex: 1">
          <div data-type="cell"></div>
        </div>
        <div data-type="row" style="flex: 0.5">
          <div data-type="cell" style="flex: 0.75"></div>
        </div>
      </div>
      <div style="display: flex;">
        <div data-type="row" style="flex: 1">
          <div data-type="cell" style="flex: 0.75"></div>
        </div>
        <div data-type="row" style="flex: 2">
          <div data-type="cell"></div>
        </div>
        <div data-type="row" style="flex: 1">
          <div data-type="cell" style="flex: 0.5"></div>
        </div>
        <div data-type="row" style="flex: 0.5">
          <div data-type="cell" style="flex: 0.5"></div>
        </div>
      </div>
      <div style="display: flex;">
        <div data-type="row" style="flex: 1">
          <div data-type="cell"></div>
        </div>
        <div data-type="row" style="flex: 2">
          <div data-type="cell" style="flex: 0.5"></div>
        </div>
        <div data-type="row" style="flex: 1">
          <div data-type="cell" style="flex: 0.75"></div>
        </div>
        <div data-type="row" style="flex: 0.5">
          <div data-type="cell" style="flex: 0.7s5"></div>
        </div>
      </div>
    </div>
  `,m7=()=>At`
    <style>
      .loader {
        grid-area: Processing;
        position: relative;
        padding: 0.125rem;
      }
      .loader:before {
        content: "";
        position: absolute;
      }
      .loader .loaderBar {
        position: absolute;
        top: 0;
        right: 100%;
        bottom: 0;
        left: 0;
        background: var(--bim-ui_main-base);
        /* width: 25%; */
        width: 0;
        animation: borealisBar 2s linear infinite;
      }

      @keyframes borealisBar {
        0% {
          left: 0%;
          right: 100%;
          width: 0%;
        }
        10% {
          left: 0%;
          right: 75%;
          width: 25%;
        }
        90% {
          right: 0%;
          left: 75%;
          width: 25%;
        }
        100% {
          left: 100%;
          right: 0%;
          width: 0%;
        }
      }
    </style>
    <div class="loader">
      <div class="loaderBar"></div>
    </div>
  `;var g7=Object.defineProperty,b7=(n,t,e,s)=>{for(var i=void 0,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=o(t,e,i)||i);return i&&g7(t,e,i),i};const L2=class extends oe{constructor(){super(...arguments),this.column="",this.columnIndex=0,this.rowData={}}get data(){return this.column?this.rowData[this.column]:null}render(){return At`
      <style>
        :host {
          grid-area: ${this.column??"unset"};
        }
      </style>
      <slot></slot>
    `}};L2.styles=ce`
    :host {
      padding: 0.375rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    :host([data-column-index="0"]) {
      justify-content: normal;
    }

    :host([data-column-index="0"]:not([data-cell-header]))
      ::slotted(bim-label) {
      text-align: left;
    }

    ::slotted(*) {
      --bim-input--bgc: transparent;
      --bim-input--olc: var(--bim-ui_bg-contrast-20);
      --bim-input--olw: 1px;
    }

    ::slotted(bim-input) {
      --bim-input--olw: 0;
    }

    ::slotted(bim-label) {
      white-space: normal;
      text-align: center;
    }
  `;let $2=L2;b7([ft({type:String,reflect:!0})],$2.prototype,"column");const N2=class extends oe{constructor(){super(...arguments),this._groups=[],this.group=this.closest("bim-table-group"),this._data=[],this.table=this.closest("bim-table")}get data(){var t;return((t=this.group)==null?void 0:t.data.children)??this._data}set data(t){this._data=t}render(){return this._groups=[],At`
      <slot></slot>
      ${this.data.map(t=>{const e=document.createElement("bim-table-group");return this._groups.push(e),e.table=this.table,e.data=t,e})}
    `}};N2.styles=ce`
    :host {
      --bim-button--bgc: transparent;
      position: relative;
      display: block;
      overflow: hidden;
      grid-area: Children;
    }

    :host([hidden]) {
      height: 0;
      opacity: 0;
    }

    ::slotted(.branch.branch-vertical) {
      top: 0;
      bottom: 1.125rem;
    }
  `;let _7=N2;var y7=Object.defineProperty,v7=(n,t,e,s)=>{for(var i=void 0,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=o(t,e,i)||i);return i&&y7(t,e,i),i};const M2=class extends oe{constructor(){super(...arguments),this.childrenHidden=!0,this.table=this.closest("bim-table"),this.data={data:{}}}get rowElement(){const t=this.shadowRoot;return t?t.querySelector("bim-table-row"):null}get childrenElement(){const t=this.shadowRoot;return t?t.querySelector("bim-table-children"):null}get _isChildrenEmpty(){return!(this.data.children&&this.data.children.length!==0)}connectedCallback(){super.connectedCallback(),this.table&&this.table.expanded?this.childrenHidden=!1:this.childrenHidden=!0}toggleChildren(t){this.childrenHidden=typeof t>"u"?!this.childrenHidden:!t,this.animateTableChildren(!0)}animateTableChildren(t=!0){if(!t){requestAnimationFrame(()=>{var o;const a=this.renderRoot.querySelector(".caret"),l=this.renderRoot.querySelector(".branch-vertical"),c=(o=this.renderRoot.querySelector("bim-table-children"))==null?void 0:o.querySelector(".branch-vertical");a.style.setProperty("transform",`translateY(-50%) rotate(${this.childrenHidden?"0":"90"}deg)`),l.style.setProperty("transform",`scaleY(${this.childrenHidden?"0":"1"})`),c?.style.setProperty("transform",`scaleY(${this.childrenHidden?"0":"1"})`)});return}const e=500,s=0,i=200,r=350;requestAnimationFrame(()=>{var o;const a=this.renderRoot.querySelector("bim-table-children"),l=this.renderRoot.querySelector(".caret"),c=this.renderRoot.querySelector(".branch-vertical"),h=(o=this.renderRoot.querySelector("bim-table-children"))==null?void 0:o.querySelector(".branch-vertical"),u=()=>{const b=a?.renderRoot.querySelectorAll("bim-table-group");b?.forEach((f,_)=>{f.style.setProperty("opacity","0"),f.style.setProperty("left","-30px");const y=[{opacity:"0",left:"-30px"},{opacity:"1",left:"0"}];f.animate(y,{duration:e/2,delay:50+_*s,easing:"cubic-bezier(0.65, 0.05, 0.36, 1)",fill:"forwards"})})},p=()=>{const b=[{transform:"translateY(-50%) rotate(90deg)"},{transform:"translateY(-50%) rotate(0deg)"}];l?.animate(b,{duration:r,easing:"cubic-bezier(0.68, -0.55, 0.27, 1.55)",fill:"forwards",direction:this.childrenHidden?"normal":"reverse"})},d=()=>{const b=[{transform:"scaleY(1)"},{transform:"scaleY(0)"}];c?.animate(b,{duration:i,easing:"cubic-bezier(0.4, 0, 0.2, 1)",delay:s,fill:"forwards",direction:this.childrenHidden?"normal":"reverse"})},g=()=>{var b;const f=(b=this.renderRoot.querySelector("bim-table-row"))==null?void 0:b.querySelector(".branch-horizontal");if(f){f.style.setProperty("transform-origin","center right");const _=[{transform:"scaleX(0)"},{transform:"scaleX(1)"}];f.animate(_,{duration:i,easing:"cubic-bezier(0.4, 0, 0.2, 1)",fill:"forwards",direction:this.childrenHidden?"normal":"reverse"})}},m=()=>{const b=[{transform:"scaleY(0)"},{transform:"scaleY(1)"}];h?.animate(b,{duration:i*1.2,easing:"cubic-bezier(0.4, 0, 0.2, 1)",fill:"forwards",delay:(s+i)*.7})};u(),p(),d(),g(),m()})}firstUpdated(){this.renderRoot.querySelectorAll(".caret").forEach(t=>{var e,s,i;if(!this.childrenHidden){t.style.setProperty("transform","translateY(-50%) rotate(90deg)");const r=(e=t.parentElement)==null?void 0:e.querySelector(".branch-horizontal");r&&r.style.setProperty("transform","scaleX(0)");const o=(i=(s=t.parentElement)==null?void 0:s.parentElement)==null?void 0:i.querySelectorAll(".branch-vertical");o?.forEach(a=>{a.style.setProperty("transform","scaleY(1)")})}})}render(){if(!this.table)throw new Error("TableGroup: parent table wasn't found!");const t=this.table.getGroupIndentation(this.data)??0,e=At`
      ${this.table.noIndentation?null:At`
            <style>
              .branch-vertical {
                left: ${t+(this.table.selectableRows?1.9375:.5625)}rem;
              }
            </style>
            <div class="branch branch-vertical"></div>
          `}
    `;let s=null;this.table.noIndentation||(s=document.createElement("div"),s.classList.add("branch","branch-horizontal"),s.style.left=`${t-1+(this.table.selectableRows?2.05:.5625)}rem`);let i=null;if(!this.table.noIndentation){i=document.createElement("div");const a=document.createElementNS("http://www.w3.org/2000/svg","svg");if(a.setAttribute("height","9.9"),a.setAttribute("width","7.5"),a.setAttribute("viewBox","0 0 4.6666672 7.7"),this.table.noCarets){const l=document.createElementNS("http://www.w3.org/2000/svg","circle");l.setAttribute("cx","2.3333336"),l.setAttribute("cy","3.85"),l.setAttribute("r","2.5"),a.append(l)}else{const l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d","m 1.7470835,6.9583848 2.5899999,-2.59 c 0.39,-0.39 0.39,-1.02 0,-1.41 L 1.7470835,0.36838483 c -0.63,-0.62000003 -1.71000005,-0.18 -1.71000005,0.70999997 v 5.17 c 0,0.9 1.08000005,1.34 1.71000005,0.71 z"),a.append(l),i.style.cursor="pointer",i.addEventListener("click",c=>{c.stopPropagation(),this.toggleChildren()})}i.classList.add("caret"),i.style.left=`${(this.table.selectableRows?1.5:.125)+t}rem`,i.append(a)}const r=document.createElement("bim-table-row");if(!this._isChildrenEmpty){const a=document.createDocumentFragment();Mc(e,a),r.append(a)}r.table=this.table,r.group=this,this.table.dispatchEvent(new CustomEvent("rowcreated",{detail:{row:r}})),i&&!this._isChildrenEmpty&&r.append(i),t!==0&&s&&r.append(s);let o;if(!this._isChildrenEmpty&&!this.childrenHidden){o=document.createElement("bim-table-children"),o.table=this.table,o.group=this;const a=document.createDocumentFragment();Mc(e,a),o.append(a),this.animateTableChildren()}return At`<div class="parent">${r} ${o}</div>`}};M2.styles=ce`
    :host {
      position: relative;
    }

    .parent {
      display: grid;
      grid-template-areas: "Data" "Children";
    }

    .branch {
      position: absolute;
      z-index: 1;
    }

    .branch-vertical {
      border-left: 1px dotted var(--bim-ui_bg-contrast-40);
      transform-origin: top center;
      transform: scaleY(0);
    }

    .branch-horizontal {
      top: 50%;
      width: 1rem;
      border-bottom: 1px dotted var(--bim-ui_bg-contrast-40);
    }

    .branch-horizontal {
      transform-origin: center left;
    }

    .caret {
      position: absolute;
      z-index: 2;
      transform: translateY(-50%) rotate(0deg);
      top: 50%;
      display: flex;
      width: 0.95rem;
      height: 0.95rem;
      justify-content: center;
      align-items: center;
    }

    .caret svg {
      fill: var(--bim-ui_bg-contrast-60);
    }
  `;let D2=M2;v7([ft({type:Boolean,attribute:"children-hidden",reflect:!0})],D2.prototype,"childrenHidden");var w7=Object.defineProperty,Jd=(n,t,e,s)=>{for(var i=void 0,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=o(t,e,i)||i);return i&&w7(t,e,i),i};const k2=class extends oe{constructor(){super(...arguments),this.selected=!1,this.columns=[],this.hiddenColumns=[],this.group=this.closest("bim-table-group"),this._data={},this.isHeader=!1,this.table=this.closest("bim-table"),this.onTableColumnsChange=()=>{this.table&&(this.columns=this.table.columns)},this.onTableColumnsHidden=()=>{this.table&&(this.hiddenColumns=this.table.hiddenColumns)},this._observer=new IntersectionObserver(t=>{this._intersecting=t[0].isIntersecting},{rootMargin:"36px"})}get groupData(){var t;return(t=this.group)==null?void 0:t.data}get data(){var t;return((t=this.group)==null?void 0:t.data.data)??this._data}set data(t){this._data=t}get _columnNames(){return this.columns.filter(t=>!this.hiddenColumns.includes(t.name)).map(t=>t.name)}get _columnWidths(){return this.columns.filter(t=>!this.hiddenColumns.includes(t.name)).map(t=>t.width)}get _isSelected(){var t;return(t=this.table)==null?void 0:t.selection.has(this.data)}onSelectionChange(t){if(!this.table)return;const e=t.target;this.selected=e.value,e.value?(this.table.selection.add(this.data),this.table.dispatchEvent(new CustomEvent("rowselected",{detail:{data:this.data}}))):(this.table.selection.delete(this.data),this.table.dispatchEvent(new CustomEvent("rowdeselected",{detail:{data:this.data}})))}connectedCallback(){super.connectedCallback(),this._observer.observe(this),this.table&&(this.columns=this.table.columns,this.hiddenColumns=this.table.hiddenColumns,this.table.addEventListener("columnschange",this.onTableColumnsChange),this.table.addEventListener("columnshidden",this.onTableColumnsHidden),this.toggleAttribute("selected",this._isSelected))}disconnectedCallback(){super.disconnectedCallback(),this._observer.unobserve(this),this.table&&(this.columns=[],this.hiddenColumns=[],this.table.removeEventListener("columnschange",this.onTableColumnsChange),this.table.removeEventListener("columnshidden",this.onTableColumnsHidden),this.toggleAttribute("selected",!1))}compute(){if(!this.table)throw new Error("TableRow: parent table wasn't found!");const t=this.table.getRowIndentation(this.data)??0,e=this.isHeader?this.data:this.table.applyDataTransform(this.group)??this.data,s=[];for(const i in e){if(this.hiddenColumns.includes(i))continue;const r=e[i];let o;if(typeof r=="string"||typeof r=="boolean"||typeof r=="number"?(o=document.createElement("bim-label"),o.textContent=String(r)):Array.isArray(r)?(o=document.createElement("bim-label"),o.textContent=r.join(", ")):r instanceof HTMLElement?o=r:(o=document.createDocumentFragment(),Mc(r,o)),!o)continue;const a=document.createElement("bim-table-cell");a.append(o),a.column=i,this._columnNames.indexOf(i)===0&&(a.style.marginLeft=`${this.table.noIndentation?0:t+.75}rem`);const l=this._columnNames.indexOf(i);a.setAttribute("data-column-index",String(l)),a.toggleAttribute("data-no-indentation",l===0&&this.table.noIndentation),a.toggleAttribute("data-cell-header",this.isHeader),a.rowData=this.data,this.table.dispatchEvent(new CustomEvent("cellcreated",{detail:{cell:a}})),s.push(a)}return this.style.gridTemplateAreas=`"${this.table.selectableRows?"Selection":""} ${this._columnNames.join(" ")}"`,this.style.gridTemplateColumns=`${this.table.selectableRows?"1.6rem":""} ${this._columnWidths.join(" ")}`,At`
      ${!this.isHeader&&this.table.selectableRows?At`<bim-checkbox
            @change=${this.onSelectionChange}
            .checked=${this._isSelected}
            style="align-self: center; justify-self: center"
          ></bim-checkbox>`:null}
      ${s}
      <slot></slot>
    `}render(){return At`${this._intersecting?this.compute():At``}`}};k2.styles=ce`
    :host {
      position: relative;
      grid-area: Data;
      display: grid;
      min-height: 2.25rem;
      transition: all 0.15s;
    }

    ::slotted(.branch.branch-vertical) {
      top: 50%;
      bottom: 0;
    }

    :host([selected]) {
      background-color: color-mix(
        in lab,
        var(--bim-ui_bg-contrast-20) 30%,
        var(--bim-ui_main-base) 10%
      );
    }
  `;let lh=k2;Jd([ft({type:Boolean,reflect:!0})],lh.prototype,"selected");Jd([ft({attribute:!1})],lh.prototype,"columns");Jd([ft({attribute:!1})],lh.prototype,"hiddenColumns");Jd([ft({type:Boolean,attribute:"is-header",reflect:!0})],lh.prototype,"isHeader");Jd([ih()],lh.prototype,"_intersecting");var E7=Object.defineProperty,x7=Object.getOwnPropertyDescriptor,fn=(n,t,e,s)=>{for(var i=s>1?void 0:s?x7(t,e):t,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(t,e,i):o(i))||i);return s&&i&&E7(t,e,i),i};const z2=class extends oe{constructor(){super(...arguments),this._filteredData=[],this.headersHidden=!1,this.minColWidth="4rem",this._columns=[],this._textDelimiters={comma:",",tab:"	"},this._queryString=null,this._data=[],this.expanded=!1,this.preserveStructureOnFilter=!1,this.indentationInText=!1,this.dataTransform={},this.selectableRows=!1,this.selection=new Set,this.noIndentation=!1,this.noCarets=!1,this.loading=!1,this._errorLoading=!1,this._onColumnsHidden=new Event("columnshidden"),this._hiddenColumns=[],this._stringFilterFunction=(t,e)=>Object.values(e.data).some(s=>String(s).toLowerCase().includes(t.toLowerCase())),this._queryFilterFunction=(t,e)=>{let s=!1;const i=Cy(t)??[];for(const r of i){if("queries"in r){s=!1;break}const{condition:o,value:a}=r;let{key:l}=r;if(l.startsWith("[")&&l.endsWith("]")){const c=l.replace("[","").replace("]","");l=c,s=Object.keys(e.data).filter(h=>h.includes(c)).map(h=>eI(e.data[h],o,a)).some(h=>h)}else s=eI(e.data[l],o,a);if(!s)break}return s}}set columns(t){const e=[];for(const s of t){const i=typeof s=="string"?{name:s,width:`minmax(${this.minColWidth}, 1fr)`}:s;e.push(i)}this._columns=e,this.computeMissingColumns(this.data),this.dispatchEvent(new Event("columnschange"))}get columns(){return this._columns}get _headerRowData(){const t={};for(const e of this.columns){const{name:s}=e;t[s]=String(s)}return t}get value(){return this._filteredData}set queryString(t){this.toggleAttribute("data-processing",!0),this._queryString=t&&t.trim()!==""?t.trim():null,this.updateFilteredData(),this.toggleAttribute("data-processing",!1)}get queryString(){return this._queryString}set data(t){this._data=t,this.updateFilteredData(),this.computeMissingColumns(t)&&(this.columns=this._columns)}get data(){return this._data}get dataAsync(){return new Promise(t=>{setTimeout(()=>{t(this.data)})})}set hiddenColumns(t){this._hiddenColumns=t,setTimeout(()=>{this.dispatchEvent(this._onColumnsHidden)})}get hiddenColumns(){return this._hiddenColumns}updateFilteredData(){this.queryString?(Cy(this.queryString)?(this.filterFunction=this._queryFilterFunction,this._filteredData=this.filter(this.queryString)):(this.filterFunction=this._stringFilterFunction,this._filteredData=this.filter(this.queryString)),this.preserveStructureOnFilter&&(this._expandedBeforeFilter===void 0&&(this._expandedBeforeFilter=this.expanded),this.expanded=!0)):(this.preserveStructureOnFilter&&this._expandedBeforeFilter!==void 0&&(this.expanded=this._expandedBeforeFilter,this._expandedBeforeFilter=void 0),this._filteredData=this.data)}computeMissingColumns(t){let e=!1;for(const s of t){const{children:i,data:r}=s;for(const o in r)this._columns.map(a=>typeof a=="string"?a:a.name).includes(o)||(this._columns.push({name:o,width:`minmax(${this.minColWidth}, 1fr)`}),e=!0);if(i){const o=this.computeMissingColumns(i);o&&!e&&(e=o)}}return e}generateText(t="comma",e=this.value,s="",i=!0){const r=this._textDelimiters[t];let o="";const a=this.columns.map(l=>l.name);if(i){this.indentationInText&&(o+=`Indentation${r}`);const l=`${a.join(r)}
`;o+=l}for(const[l,c]of e.entries()){const{data:h,children:u}=c,p=this.indentationInText?`${s}${l+1}${r}`:"",d=a.map(m=>h[m]??""),g=`${p}${d.join(r)}
`;o+=g,u&&(o+=this.generateText(t,c.children,`${s}${l+1}.`,!1))}return o}get csv(){return this.generateText("comma")}get tsv(){return this.generateText("tab")}applyDataTransform(t){const e={};if(!t)return e;const{data:s}=t.data;for(const r of Object.keys(this.dataTransform)){const o=this.columns.find(a=>a.name===r);o&&o.forceDataTransform&&(r in s||(s[r]=""))}const i=s;for(const r in i){const o=this.dataTransform[r];o?e[r]=o(i[r],s,t):e[r]=s[r]}return e}downloadData(t="BIM Table Data",e="json"){let s=null;if(e==="json"&&(s=new File([JSON.stringify(this.value,void 0,2)],`${t}.json`)),e==="csv"&&(s=new File([this.csv],`${t}.csv`)),e==="tsv"&&(s=new File([this.tsv],`${t}.tsv`)),!s)return;const i=document.createElement("a");i.href=URL.createObjectURL(s),i.download=s.name,i.click(),URL.revokeObjectURL(i.href)}getRowIndentation(t,e=this.value,s=0){for(const i of e){if(i.data===t)return s;if(i.children){const r=this.getRowIndentation(t,i.children,s+1);if(r!==null)return r}}return null}getGroupIndentation(t,e=this.value,s=0){for(const i of e){if(i===t)return s;if(i.children){const r=this.getGroupIndentation(t,i.children,s+1);if(r!==null)return r}}return null}connectedCallback(){super.connectedCallback(),this.dispatchEvent(new Event("connected"))}disconnectedCallback(){super.disconnectedCallback(),this.dispatchEvent(new Event("disconnected"))}async loadData(t=!1){if(this._filteredData.length!==0&&!t||!this.loadFunction)return!1;this.loading=!0;try{const e=await this.loadFunction();return this.data=e,this.loading=!1,this._errorLoading=!1,!0}catch(e){if(this.loading=!1,this._filteredData.length!==0)return!1;const s=this.querySelector("[slot='error-loading']"),i=s?.querySelector("[data-table-element='error-message']");return e instanceof Error&&i&&e.message.trim()!==""&&(i.textContent=e.message),this._errorLoading=!0,!1}}filter(t,e=this.filterFunction??this._stringFilterFunction,s=this.data){const i=[];for(const r of s)if(e(t,r)){if(this.preserveStructureOnFilter){const o={data:r.data};if(r.children){const a=this.filter(t,e,r.children);a.length&&(o.children=a)}i.push(o)}else if(i.push({data:r.data}),r.children){const o=this.filter(t,e,r.children);i.push(...o)}}else if(r.children){const o=this.filter(t,e,r.children);this.preserveStructureOnFilter&&o.length?i.push({data:r.data,children:o}):i.push(...o)}return i}get _missingDataElement(){return this.querySelector("[slot='missing-data']")}render(){if(this.loading)return f7();if(this._errorLoading)return At`<slot name="error-loading"></slot>`;if(this._filteredData.length===0&&this._missingDataElement)return At`<slot name="missing-data"></slot>`;const t=document.createElement("bim-table-row");t.table=this,t.isHeader=!0,t.data=this._headerRowData,t.style.gridArea="Header",t.style.position="sticky",t.style.top="0",t.style.zIndex="5";const e=document.createElement("bim-table-children");return e.table=this,e.data=this.value,e.style.gridArea="Body",e.style.backgroundColor="transparent",At`
      <div class="parent">
        ${this.headersHidden?null:t} ${m7()}
        <div style="overflow-x: hidden; grid-area: Body">${e}</div>
      </div>
    `}};z2.styles=[Qo.scrollbar,ce`
      :host {
        position: relative;
        overflow: auto;
        display: block;
        pointer-events: auto;
      }

      :host(:not([data-processing])) .loader {
        display: none;
      }

      .parent {
        display: grid;
        grid-template:
          "Header" auto
          "Processing" auto
          "Body" 1fr
          "Footer" auto;
        overflow: auto;
        height: 100%;
      }

      .parent > bim-table-row[is-header] {
        color: var(--bim-table_header--c, var(--bim-ui_bg-contrast-100));
        background-color: var(
          --bim-table_header--bgc,
          var(--bim-ui_bg-contrast-20)
        );
      }

      .controls {
        display: flex;
        gap: 0.375rem;
        flex-wrap: wrap;
        margin-bottom: 0.5rem;
      }
    `];let Fi=z2;fn([ih()],Fi.prototype,"_filteredData",2);fn([ft({type:Boolean,attribute:"headers-hidden",reflect:!0})],Fi.prototype,"headersHidden",2);fn([ft({type:String,attribute:"min-col-width",reflect:!0})],Fi.prototype,"minColWidth",2);fn([ft({type:Array,attribute:!1})],Fi.prototype,"columns",1);fn([ft({type:Array,attribute:!1})],Fi.prototype,"data",1);fn([ft({type:Boolean,reflect:!0})],Fi.prototype,"expanded",2);fn([ft({type:Boolean,reflect:!0,attribute:"selectable-rows"})],Fi.prototype,"selectableRows",2);fn([ft({attribute:!1})],Fi.prototype,"selection",2);fn([ft({type:Boolean,attribute:"no-indentation",reflect:!0})],Fi.prototype,"noIndentation",2);fn([ft({type:Boolean,attribute:"no-carets",reflect:!0})],Fi.prototype,"noCarets",2);fn([ft({type:Boolean,reflect:!0})],Fi.prototype,"loading",2);fn([ih()],Fi.prototype,"_errorLoading",2);var I7=Object.defineProperty,C7=Object.getOwnPropertyDescriptor,ch=(n,t,e,s)=>{for(var i=s>1?void 0:s?C7(t,e):t,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(t,e,i):o(i))||i);return s&&i&&I7(t,e,i),i};const B2=class extends oe{constructor(){super(...arguments),this._switchers=[],this.bottom=!1,this.switchersHidden=!1,this.floating=!1,this.switchersFull=!1,this.onTabHiddenChange=t=>{const e=t.target;e instanceof di&&!e.hidden&&(e.removeEventListener("hiddenchange",this.onTabHiddenChange),this.tab=e.name,e.addEventListener("hiddenchange",this.onTabHiddenChange))}}set tab(t){this._tab=t;const e=[...this.children],s=e.find(i=>i instanceof di&&i.name===t);for(const i of e){if(!(i instanceof di))continue;i.hidden=s!==i;const r=this.getTabSwitcher(i.name);r&&r.toggleAttribute("data-active",!i.hidden)}s||(this._tab="hidden",this.setAttribute("tab","hidden"))}get tab(){return this._tab}getTabSwitcher(t){return this._switchers.find(e=>e.getAttribute("data-name")===t)}createSwitchers(){this._switchers=[];for(const t of this.children){if(!(t instanceof di))continue;const e=document.createElement("div");e.addEventListener("click",()=>{this.tab===t.name?this.toggleAttribute("tab",!1):this.tab=t.name,this.setAnimatedBackgound()}),e.setAttribute("data-name",t.name),e.className="switcher";const s=document.createElement("bim-label");s.textContent=t.label??null,s.icon=t.icon,e.append(s),this._switchers.push(e)}}updateSwitchers(){for(const t of this.children){if(!(t instanceof di))continue;const e=this._switchers.find(i=>i.getAttribute("data-name")===t.name);if(!e)continue;const s=e.querySelector("bim-label");s&&(s.textContent=t.label??null,s.icon=t.icon)}}onSlotChange(t){this.createSwitchers();const e=t.target.assignedElements(),s=e.find(i=>i instanceof di?this.tab?i.name===this.tab:!i.hidden:!1);s&&s instanceof di&&(this.tab=s.name);for(const i of e){if(!(i instanceof di)){i.remove();continue}i.removeEventListener("hiddenchange",this.onTabHiddenChange),s!==i&&(i.hidden=!0),i.addEventListener("hiddenchange",this.onTabHiddenChange)}}doubleRequestAnimationFrames(t){requestAnimationFrame(()=>requestAnimationFrame(t))}setAnimatedBackgound(t=!1){var e;const s=this.renderRoot.querySelector(".animated-background"),i=[...((e=this.renderRoot.querySelector(".switchers"))==null?void 0:e.querySelectorAll(".switcher"))||[]].filter(r=>r.hasAttribute("data-active"))[0];requestAnimationFrame(()=>{var r,o,a,l;const c=(l=(a=(o=(r=i?.parentElement)==null?void 0:r.shadowRoot)==null?void 0:o.querySelector("bim-input"))==null?void 0:a.shadowRoot)==null?void 0:l.querySelector(".input"),h={width:i?.clientWidth,height:i?.clientHeight,top:(i?.offsetTop??0)-(c?.offsetTop??0),left:(i?.offsetLeft??0)-(c?.offsetLeft??0)};i?(s?.style.setProperty("width",`${h.width}px`),s?.style.setProperty("height",`${h.height}px`),s?.style.setProperty("left",`${h.left}px`)):s?.style.setProperty("width","0"),this.bottom?(s?.style.setProperty("top","100%"),s?.style.setProperty("transform","translateY(-100%)")):s?.style.setProperty("top",`${h.top}px`)}),t&&this.doubleRequestAnimationFrames(()=>{const r="ease";s?.style.setProperty("transition",`width ${.3}s ${r}, height ${.3}s ${r}, top ${.3}s ${r}, left ${.3}s ${r}`)})}firstUpdated(){requestAnimationFrame(()=>{this.setAnimatedBackgound(!0)}),new ResizeObserver(()=>{this.setAnimatedBackgound()}).observe(this)}render(){return At`
      <div class="parent">
        <div class="switchers">
          <div class="animated-background"></div>
          ${this._switchers}
        </div>
        <div class="content">
          <slot @slotchange=${this.onSlotChange}></slot>
        </div>
      </div>
    `}};B2.styles=[Qo.scrollbar,ce`
      * {
        box-sizing: border-box;
      }

      :host {
        background-color: var(--bim-ui_bg-base);
        display: block;
        overflow: auto;
      }

      .parent {
        display: grid;
        overflow: hidden;
        position: relative;
        grid-template: "switchers" auto "content" 1fr;
        height: 100%;
      }

      :host([bottom]) .parent {
        grid-template: "content" 1fr "switchers" auto;
      }

      .switchers {
        position: relative;
        display: flex;
        height: 2.25rem;
        font-weight: 600;
        grid-area: switchers;
      }

      .switcher {
        --bim-label--c: var(--bim-ui_bg-contrast-80);
        background-color: transparent;
        position: relative;
        cursor: pointer;
        pointer-events: auto;
        padding: 0rem 0.75rem;
        display: flex;
        justify-content: center;
        z-index: 2;
        transition: all 0.15s;
      }

      .switcher:not([data-active]):hover {
        filter: brightness(150%);
      }

      :host([switchers-full]) .switcher {
        flex: 1;
      }

      .switcher[data-active] {
        --bim-label--c: var(--bim-ui_main-contrast);
      }

      .switchers bim-label {
        pointer-events: none;
      }

      :host([switchers-hidden]) .switchers {
        display: none;
      }

      .content {
        position: relative;
        display: grid;
        grid-template-columns: 1fr;
        grid-area: content;
        max-height: 100vh;
        overflow: auto;
        transition: max-height 0.2s;
      }

      :host([tab="hidden"]) .content {
        max-height: 0;
      }

      .animated-background {
        position: absolute;
        background: var(--bim-ui_main-base);
        width: 0;
        height: 0;
        top: 0;
        left: 0;
      }

      :host(:not([bottom])) .content {
        border-top: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([bottom]) .content {
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating]) {
        background-color: transparent;
      }

      :host([floating]) .switchers {
        justify-self: center;
        overflow: hidden;
        background-color: var(--bim-ui_bg-base);
      }

      :host([floating]:not([bottom])) .switchers {
        border-radius: var(--bim-ui_size-2xs) var(--bim-ui_size-2xs) 0 0;
        border-top: 1px solid var(--bim-ui_bg-contrast-20);
        border-left: 1px solid var(--bim-ui_bg-contrast-20);
        border-right: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating][bottom]) .switchers {
        border-radius: 0 0 var(--bim-ui_size-2xs) var(--bim-ui_size-2xs);
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
        border-left: 1px solid var(--bim-ui_bg-contrast-20);
        border-right: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating][tab="hidden"]) .switchers {
        border-radius: var(--bim-ui_size-2xs);
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating][bottom][tab="hidden"]) .switchers {
        border-top: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating]) .content {
        border: 1px solid var(--bim-ui_bg-contrast-20);
        border-radius: var(--bim-ui_size-2xs);
        background-color: var(--bim-ui_bg-base);
      }
    `];let Wr=B2;ch([ih()],Wr.prototype,"_switchers",2);ch([ft({type:Boolean,reflect:!0})],Wr.prototype,"bottom",2);ch([ft({type:Boolean,attribute:"switchers-hidden",reflect:!0})],Wr.prototype,"switchersHidden",2);ch([ft({type:Boolean,reflect:!0})],Wr.prototype,"floating",2);ch([ft({type:String,reflect:!0})],Wr.prototype,"tab",1);ch([ft({type:Boolean,attribute:"switchers-full",reflect:!0})],Wr.prototype,"switchersFull",2);var T7=Object.defineProperty,A7=Object.getOwnPropertyDescriptor,Hg=(n,t,e,s)=>{for(var i=s>1?void 0:s?A7(t,e):t,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(t,e,i):o(i))||i);return s&&i&&T7(t,e,i),i};const U2=class extends oe{constructor(){super(...arguments),this._defaultName="__unnamed__",this.name=this._defaultName,this._hidden=!1}set label(t){this._label=t;const e=this.parentElement;e instanceof Wr&&e.updateSwitchers()}get label(){return this._label}set icon(t){this._icon=t;const e=this.parentElement;e instanceof Wr&&e.updateSwitchers()}get icon(){return this._icon}set hidden(t){this._hidden=t,this.dispatchEvent(new Event("hiddenchange"))}get hidden(){return this._hidden}connectedCallback(){super.connectedCallback();const{parentElement:t}=this;if(t&&this.name===this._defaultName){const e=[...t.children].indexOf(this);this.name=`${this._defaultName}${e}`}}render(){return At` <slot></slot> `}};U2.styles=ce`
    :host {
      display: block;
      height: 100%;
      grid-row-start: 1;
      grid-column-start: 1;
      animation: openAnim 3s forwards;
      transform: translateY(0);
      max-height: 100vh;
      transition:
        opacity 0.3s ease,
        max-height 0.6s ease,
        transform 0.3s ease;
    }

    :host([hidden]) {
      transform: translateY(-20px);
      max-height: 0;
      opacity: 0;
      overflow: hidden;
      visibility: hidden;
    }
  `;let di=U2;Hg([ft({type:String,reflect:!0})],di.prototype,"name",2);Hg([ft({type:String,reflect:!0})],di.prototype,"label",1);Hg([ft({type:String,reflect:!0})],di.prototype,"icon",1);Hg([ft({type:Boolean,reflect:!0})],di.prototype,"hidden",1);/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const sI=n=>n??Ze;var S7=Object.defineProperty,O7=Object.getOwnPropertyDescriptor,Mn=(n,t,e,s)=>{for(var i=s>1?void 0:s?O7(t,e):t,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(t,e,i):o(i))||i);return s&&i&&S7(t,e,i),i};const V2=class extends oe{constructor(){super(...arguments),this._inputTypes=["date","datetime-local","email","month","password","search","tel","text","time","url","week","area"],this.value="",this.vertical=!1,this.disabled=!1,this.resize="vertical",this._type="text",this.onValueChange=new Event("input")}set type(t){this._inputTypes.includes(t)&&(this._type=t)}get type(){return this._type}get query(){return Cy(this.value)}onInputChange(t){t.stopPropagation();const e=t.target;clearTimeout(this._debounceTimeoutID),this._debounceTimeoutID=setTimeout(()=>{this.value=e.value,this.dispatchEvent(this.onValueChange)},this.debounce)}focus(){setTimeout(()=>{var t;const e=(t=this.shadowRoot)==null?void 0:t.querySelector("input");e?.focus()})}render(){return At`
      <bim-input
        .name=${this.name}
        .icon=${this.icon}
        .label=${this.label}
        .vertical=${this.vertical}
      >
        ${this.type==="area"?At` <textarea
              aria-label=${this.label||this.name||"Text Input"}
              .value=${this.value}
              .rows=${this.rows??5}
              ?disabled=${this.disabled}
              placeholder=${sI(this.placeholder)}
              @input=${this.onInputChange}
              style="resize: ${this.resize};"
            ></textarea>`:At` <input
              aria-label=${this.label||this.name||"Text Input"}
              .type=${this.type}
              .value=${this.value}
              ?disabled=${this.disabled}
              placeholder=${sI(this.placeholder)}
              @input=${this.onInputChange}
            />`}
      </bim-input>
    `}};V2.styles=[Qo.scrollbar,ce`
      :host {
        --bim-input--bgc: var(--bim-ui_bg-contrast-20);
        flex: 1;
        display: block;
      }

      input,
      textarea {
        font-family: inherit;
        background-color: transparent;
        border: none;
        width: 100%;
        padding: var(--bim-ui_size-3xs);
        color: var(--bim-text-input--c, var(--bim-ui_bg-contrast-100));
      }

      input {
        outline: none;
        height: 100%;
        padding: 0 var(--bim-ui_size-3xs); /* Override padding */
        border-radius: var(--bim-text-input--bdrs, var(--bim-ui_size-4xs));
      }

      :host([disabled]) input,
      :host([disabled]) textarea {
        color: var(--bim-ui_bg-contrast-60);
      }

      textarea {
        line-height: 1.1rem;
        outline: none;
      }

      :host(:focus) {
        --bim-input--olc: var(--bim-ui_accent-base);
      }

      /* :host([disabled]) {
      --bim-input--bgc: var(--bim-ui_bg-contrast-20);
    } */
    `];let mn=V2;Mn([ft({type:String,reflect:!0})],mn.prototype,"icon",2);Mn([ft({type:String,reflect:!0})],mn.prototype,"label",2);Mn([ft({type:String,reflect:!0})],mn.prototype,"name",2);Mn([ft({type:String,reflect:!0})],mn.prototype,"placeholder",2);Mn([ft({type:String,reflect:!0})],mn.prototype,"value",2);Mn([ft({type:Boolean,reflect:!0})],mn.prototype,"vertical",2);Mn([ft({type:Number,reflect:!0})],mn.prototype,"debounce",2);Mn([ft({type:Number,reflect:!0})],mn.prototype,"rows",2);Mn([ft({type:Boolean,reflect:!0})],mn.prototype,"disabled",2);Mn([ft({type:String,reflect:!0})],mn.prototype,"resize",2);Mn([ft({type:String,reflect:!0})],mn.prototype,"type",1);var P7=Object.defineProperty,R7=Object.getOwnPropertyDescriptor,H2=(n,t,e,s)=>{for(var i=s>1?void 0:s?R7(t,e):t,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(t,e,i):o(i))||i);return s&&i&&P7(t,e,i),i};const j2=class extends oe{constructor(){super(...arguments),this.rows=2,this._vertical=!1}set vertical(t){this._vertical=t,this.updateChildren()}get vertical(){return this._vertical}updateChildren(){const t=this.children;for(const e of t)this.vertical?e.setAttribute("label-hidden",""):e.removeAttribute("label-hidden")}render(){return At`
      <style>
        .parent {
          grid-auto-flow: ${this.vertical?"row":"column"};
          grid-template-rows: repeat(${this.rows}, 1fr);
        }
      </style>
      <div class="parent">
        <slot @slotchange=${this.updateChildren}></slot>
      </div>
    `}};j2.styles=ce`
    .parent {
      display: grid;
      gap: 0.25rem;
    }

    ::slotted(bim-button[label]:not([vertical])) {
      --bim-button--jc: flex-start;
    }

    ::slotted(bim-button) {
      --bim-label--c: var(--bim-ui_bg-contrast-80);
    }
  `;let jg=j2;H2([ft({type:Number,reflect:!0})],jg.prototype,"rows",2);H2([ft({type:Boolean,reflect:!0})],jg.prototype,"vertical",1);var F7=Object.defineProperty,L7=Object.getOwnPropertyDescriptor,Wg=(n,t,e,s)=>{for(var i=s>1?void 0:s?L7(t,e):t,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(t,e,i):o(i))||i);return s&&i&&F7(t,e,i),i};const W2=class extends oe{constructor(){super(...arguments),this._vertical=!1,this._labelHidden=!1}set vertical(t){this._vertical=t,this.updateChildren()}get vertical(){return this._vertical}set labelHidden(t){this._labelHidden=t,this.updateChildren()}get labelHidden(){return this._labelHidden}updateChildren(){const t=this.children;for(const e of t)e instanceof jg&&(e.vertical=this.vertical),e.toggleAttribute("label-hidden",this.vertical)}render(){return At`
      <div class="parent">
        <div class="children">
          <slot @slotchange=${this.updateChildren}></slot>
        </div>
        ${!this.labelHidden&&(this.label||this.icon)?At`<bim-label .icon=${this.icon}>${this.label}</bim-label>`:null}
      </div>
    `}};W2.styles=ce`
    :host {
      --bim-label--fz: var(--bim-ui_size-xs);
      --bim-label--c: var(--bim-ui_bg-contrast-60);
      display: block;
      flex: 1;
    }

    :host(:not([vertical])) ::slotted(bim-button[vertical]) {
      --bim-icon--fz: var(--bim-ui_size-5xl);
      min-height: 3.75rem;
    }

    .parent {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      align-items: center;
      padding: 0.5rem;
      height: 100%;
      box-sizing: border-box;
      justify-content: space-between;
    }

    :host([vertical]) .parent {
      flex-direction: row-reverse;
    }

    :host([vertical]) .parent > bim-label {
      writing-mode: tb;
    }

    .children {
      display: flex;
      gap: 0.25rem;
    }

    :host([vertical]) .children {
      flex-direction: column;
    }
  `;let hh=W2;Wg([ft({type:String,reflect:!0})],hh.prototype,"label",2);Wg([ft({type:String,reflect:!0})],hh.prototype,"icon",2);Wg([ft({type:Boolean,reflect:!0})],hh.prototype,"vertical",1);Wg([ft({type:Boolean,attribute:"label-hidden",reflect:!0})],hh.prototype,"labelHidden",1);var $7=Object.defineProperty,N7=Object.getOwnPropertyDescriptor,Gv=(n,t,e,s)=>{for(var i=s>1?void 0:s?N7(t,e):t,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(t,e,i):o(i))||i);return s&&i&&$7(t,e,i),i};const Y2=class extends oe{constructor(){super(...arguments),this.labelsHidden=!1,this._vertical=!1,this._hidden=!1}set vertical(t){this._vertical=t,this.updateSections()}get vertical(){return this._vertical}set hidden(t){this._hidden=t,this.dispatchEvent(new Event("hiddenchange"))}get hidden(){return this._hidden}updateSections(){const t=this.children;for(const e of t)e instanceof hh&&(e.labelHidden=this.vertical&&!jv.config.sectionLabelOnVerticalToolbar,e.vertical=this.vertical)}render(){return At`
      <div class="parent">
        <slot @slotchange=${this.updateSections}></slot>
      </div>
    `}};Y2.styles=ce`
    :host {
      --bim-button--bgc: transparent;
      background-color: var(--bim-ui_bg-base);
      border-radius: var(--bim-ui_size-2xs);
      display: block;
    }

    :host([hidden]) {
      display: none;
    }

    .parent {
      display: flex;
      width: max-content;
      pointer-events: auto;
    }

    :host([vertical]) .parent {
      flex-direction: column;
    }

    :host([vertical]) {
      width: min-content;
      border-radius: var(--bim-ui_size-2xs);
      border: 1px solid var(--bim-ui_bg-contrast-20);
    }

    ::slotted(bim-toolbar-section:not(:last-child)) {
      border-right: 1px solid var(--bim-ui_bg-contrast-20);
      border-bottom: none;
    }

    :host([vertical]) ::slotted(bim-toolbar-section:not(:last-child)) {
      border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      border-right: none;
    }
  `;let Yg=Y2;Gv([ft({type:String,reflect:!0})],Yg.prototype,"icon",2);Gv([ft({type:Boolean,attribute:"labels-hidden",reflect:!0})],Yg.prototype,"labelsHidden",2);Gv([ft({type:Boolean,reflect:!0})],Yg.prototype,"vertical",1);var M7=Object.defineProperty,D7=(n,t,e,s)=>{for(var i=void 0,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=o(t,e,i)||i);return i&&M7(t,e,i),i};const G2=class extends oe{constructor(){super(),this._onResize=new Event("resize"),new ResizeObserver(()=>{setTimeout(()=>{this.dispatchEvent(this._onResize)})}).observe(this)}render(){return At`
      <div class="parent">
        <slot></slot>
      </div>
    `}};G2.styles=ce`
    :host {
      display: grid;
      min-width: 0;
      min-height: 0;
      height: 100%;
    }

    .parent {
      overflow: hidden;
      position: relative;
    }
  `;let q2=G2;D7([ft({type:String,reflect:!0})],q2.prototype,"name");/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const _m=globalThis,qv=_m.ShadowRoot&&(_m.ShadyCSS===void 0||_m.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Zv=Symbol(),iI=new WeakMap;let Z2=class{constructor(n,t,e){if(this._$cssResult$=!0,e!==Zv)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=n,this.t=t}get styleSheet(){let n=this.o;const t=this.t;if(qv&&n===void 0){const e=t!==void 0&&t.length===1;e&&(n=iI.get(t)),n===void 0&&((this.o=n=new CSSStyleSheet).replaceSync(this.cssText),e&&iI.set(t,n))}return n}toString(){return this.cssText}};const k7=n=>new Z2(typeof n=="string"?n:n+"",void 0,Zv),Xv=(n,...t)=>{const e=n.length===1?n[0]:t.reduce((s,i,r)=>s+(o=>{if(o._$cssResult$===!0)return o.cssText;if(typeof o=="number")return o;throw Error("Value passed to 'css' function must be a 'css' function result: "+o+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+n[r+1],n[0]);return new Z2(e,n,Zv)},z7=(n,t)=>{if(qv)n.adoptedStyleSheets=t.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(const e of t){const s=document.createElement("style"),i=_m.litNonce;i!==void 0&&s.setAttribute("nonce",i),s.textContent=e.cssText,n.appendChild(s)}},nI=qv?n=>n:n=>n instanceof CSSStyleSheet?(t=>{let e="";for(const s of t.cssRules)e+=s.cssText;return k7(e)})(n):n;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:B7,defineProperty:U7,getOwnPropertyDescriptor:V7,getOwnPropertyNames:H7,getOwnPropertySymbols:j7,getPrototypeOf:W7}=Object,zc=globalThis,rI=zc.trustedTypes,Y7=rI?rI.emptyScript:"",oI=zc.reactiveElementPolyfillSupport,Ku=(n,t)=>n,Km={toAttribute(n,t){switch(t){case Boolean:n=n?Y7:null;break;case Object:case Array:n=n==null?n:JSON.stringify(n)}return n},fromAttribute(n,t){let e=n;switch(t){case Boolean:e=n!==null;break;case Number:e=n===null?null:Number(n);break;case Object:case Array:try{e=JSON.parse(n)}catch{e=null}}return e}},Qv=(n,t)=>!B7(n,t),aI={attribute:!0,type:String,converter:Km,reflect:!1,useDefault:!1,hasChanged:Qv};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),zc.litPropertyMetadata??(zc.litPropertyMetadata=new WeakMap);let ac=class extends HTMLElement{static addInitializer(n){this._$Ei(),(this.l??(this.l=[])).push(n)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(n,t=aI){if(t.state&&(t.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(n)&&((t=Object.create(t)).wrapped=!0),this.elementProperties.set(n,t),!t.noAccessor){const e=Symbol(),s=this.getPropertyDescriptor(n,e,t);s!==void 0&&U7(this.prototype,n,s)}}static getPropertyDescriptor(n,t,e){const{get:s,set:i}=V7(this.prototype,n)??{get(){return this[t]},set(r){this[t]=r}};return{get:s,set(r){const o=s?.call(this);i?.call(this,r),this.requestUpdate(n,o,e)},configurable:!0,enumerable:!0}}static getPropertyOptions(n){return this.elementProperties.get(n)??aI}static _$Ei(){if(this.hasOwnProperty(Ku("elementProperties")))return;const n=W7(this);n.finalize(),n.l!==void 0&&(this.l=[...n.l]),this.elementProperties=new Map(n.elementProperties)}static finalize(){if(this.hasOwnProperty(Ku("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(Ku("properties"))){const t=this.properties,e=[...H7(t),...j7(t)];for(const s of e)this.createProperty(s,t[s])}const n=this[Symbol.metadata];if(n!==null){const t=litPropertyMetadata.get(n);if(t!==void 0)for(const[e,s]of t)this.elementProperties.set(e,s)}this._$Eh=new Map;for(const[t,e]of this.elementProperties){const s=this._$Eu(t,e);s!==void 0&&this._$Eh.set(s,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(n){const t=[];if(Array.isArray(n)){const e=new Set(n.flat(1/0).reverse());for(const s of e)t.unshift(nI(s))}else n!==void 0&&t.push(nI(n));return t}static _$Eu(n,t){const e=t.attribute;return e===!1?void 0:typeof e=="string"?e:typeof n=="string"?n.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var n;this._$ES=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),(n=this.constructor.l)==null||n.forEach(t=>t(this))}addController(n){var t;(this._$EO??(this._$EO=new Set)).add(n),this.renderRoot!==void 0&&this.isConnected&&((t=n.hostConnected)==null||t.call(n))}removeController(n){var t;(t=this._$EO)==null||t.delete(n)}_$E_(){const n=new Map,t=this.constructor.elementProperties;for(const e of t.keys())this.hasOwnProperty(e)&&(n.set(e,this[e]),delete this[e]);n.size>0&&(this._$Ep=n)}createRenderRoot(){const n=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return z7(n,this.constructor.elementStyles),n}connectedCallback(){var n;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(n=this._$EO)==null||n.forEach(t=>{var e;return(e=t.hostConnected)==null?void 0:e.call(t)})}enableUpdating(n){}disconnectedCallback(){var n;(n=this._$EO)==null||n.forEach(t=>{var e;return(e=t.hostDisconnected)==null?void 0:e.call(t)})}attributeChangedCallback(n,t,e){this._$AK(n,e)}_$ET(n,t){var e;const s=this.constructor.elementProperties.get(n),i=this.constructor._$Eu(n,s);if(i!==void 0&&s.reflect===!0){const r=(((e=s.converter)==null?void 0:e.toAttribute)!==void 0?s.converter:Km).toAttribute(t,s.type);this._$Em=n,r==null?this.removeAttribute(i):this.setAttribute(i,r),this._$Em=null}}_$AK(n,t){var e,s;const i=this.constructor,r=i._$Eh.get(n);if(r!==void 0&&this._$Em!==r){const o=i.getPropertyOptions(r),a=typeof o.converter=="function"?{fromAttribute:o.converter}:((e=o.converter)==null?void 0:e.fromAttribute)!==void 0?o.converter:Km;this._$Em=r,this[r]=a.fromAttribute(t,o.type)??((s=this._$Ej)==null?void 0:s.get(r))??null,this._$Em=null}}requestUpdate(n,t,e){var s;if(n!==void 0){const i=this.constructor,r=this[n];if(e??(e=i.getPropertyOptions(n)),!((e.hasChanged??Qv)(r,t)||e.useDefault&&e.reflect&&r===((s=this._$Ej)==null?void 0:s.get(n))&&!this.hasAttribute(i._$Eu(n,e))))return;this.C(n,t,e)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(n,t,{useDefault:e,reflect:s,wrapped:i},r){e&&!(this._$Ej??(this._$Ej=new Map)).has(n)&&(this._$Ej.set(n,r??t??this[n]),i!==!0||r!==void 0)||(this._$AL.has(n)||(this.hasUpdated||e||(t=void 0),this._$AL.set(n,t)),s===!0&&this._$Em!==n&&(this._$Eq??(this._$Eq=new Set)).add(n))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(t){Promise.reject(t)}const n=this.scheduleUpdate();return n!=null&&await n,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var n;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[i,r]of this._$Ep)this[i]=r;this._$Ep=void 0}const s=this.constructor.elementProperties;if(s.size>0)for(const[i,r]of s){const{wrapped:o}=r,a=this[i];o!==!0||this._$AL.has(i)||a===void 0||this.C(i,void 0,r,a)}}let t=!1;const e=this._$AL;try{t=this.shouldUpdate(e),t?(this.willUpdate(e),(n=this._$EO)==null||n.forEach(s=>{var i;return(i=s.hostUpdate)==null?void 0:i.call(s)}),this.update(e)):this._$EM()}catch(s){throw t=!1,this._$EM(),s}t&&this._$AE(e)}willUpdate(n){}_$AE(n){var t;(t=this._$EO)==null||t.forEach(e=>{var s;return(s=e.hostUpdated)==null?void 0:s.call(e)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(n)),this.updated(n)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(n){return!0}update(n){this._$Eq&&(this._$Eq=this._$Eq.forEach(t=>this._$ET(t,this[t]))),this._$EM()}updated(n){}firstUpdated(n){}};ac.elementStyles=[],ac.shadowRootOptions={mode:"open"},ac[Ku("elementProperties")]=new Map,ac[Ku("finalized")]=new Map,oI?.({ReactiveElement:ac}),(zc.reactiveElementVersions??(zc.reactiveElementVersions=[])).push("2.1.0");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Jm=globalThis,tg=Jm.trustedTypes,lI=tg?tg.createPolicy("lit-html",{createHTML:n=>n}):void 0,X2="$lit$",wo=`lit$${Math.random().toFixed(9).slice(2)}$`,Q2="?"+wo,G7=`<${Q2}>`,Ka=document,xd=()=>Ka.createComment(""),Id=n=>n===null||typeof n!="object"&&typeof n!="function",Kv=Array.isArray,q7=n=>Kv(n)||typeof n?.[Symbol.iterator]=="function",U_=`[ 	
\f\r]`,ru=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,cI=/-->/g,hI=/>/g,pa=RegExp(`>|${U_}(?:([^\\s"'>=/]+)(${U_}*=${U_}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),uI=/'/g,dI=/"/g,K2=/^(?:script|style|textarea|title)$/i,Z7=n=>(t,...e)=>({_$litType$:n,strings:t,values:e}),Jv=Z7(1),Bc=Symbol.for("lit-noChange"),Ke=Symbol.for("lit-nothing"),pI=new WeakMap,La=Ka.createTreeWalker(Ka,129);function J2(n,t){if(!Kv(n)||!n.hasOwnProperty("raw"))throw Error("invalid template strings array");return lI!==void 0?lI.createHTML(t):t}const X7=(n,t)=>{const e=n.length-1,s=[];let i,r=t===2?"<svg>":t===3?"<math>":"",o=ru;for(let a=0;a<e;a++){const l=n[a];let c,h,u=-1,p=0;for(;p<l.length&&(o.lastIndex=p,h=o.exec(l),h!==null);)p=o.lastIndex,o===ru?h[1]==="!--"?o=cI:h[1]!==void 0?o=hI:h[2]!==void 0?(K2.test(h[2])&&(i=RegExp("</"+h[2],"g")),o=pa):h[3]!==void 0&&(o=pa):o===pa?h[0]===">"?(o=i??ru,u=-1):h[1]===void 0?u=-2:(u=o.lastIndex-h[2].length,c=h[1],o=h[3]===void 0?pa:h[3]==='"'?dI:uI):o===dI||o===uI?o=pa:o===cI||o===hI?o=ru:(o=pa,i=void 0);const d=o===pa&&n[a+1].startsWith("/>")?" ":"";r+=o===ru?l+G7:u>=0?(s.push(c),l.slice(0,u)+X2+l.slice(u)+wo+d):l+wo+(u===-2?a:d)}return[J2(n,r+(n[e]||"<?>")+(t===2?"</svg>":t===3?"</math>":"")),s]};let Sy=class tO{constructor({strings:t,_$litType$:e},s){let i;this.parts=[];let r=0,o=0;const a=t.length-1,l=this.parts,[c,h]=X7(t,e);if(this.el=tO.createElement(c,s),La.currentNode=this.el.content,e===2||e===3){const u=this.el.content.firstChild;u.replaceWith(...u.childNodes)}for(;(i=La.nextNode())!==null&&l.length<a;){if(i.nodeType===1){if(i.hasAttributes())for(const u of i.getAttributeNames())if(u.endsWith(X2)){const p=h[o++],d=i.getAttribute(u).split(wo),g=/([.?@])?(.*)/.exec(p);l.push({type:1,index:r,name:g[2],strings:d,ctor:g[1]==="."?K7:g[1]==="?"?J7:g[1]==="@"?t9:Gg}),i.removeAttribute(u)}else u.startsWith(wo)&&(l.push({type:6,index:r}),i.removeAttribute(u));if(K2.test(i.tagName)){const u=i.textContent.split(wo),p=u.length-1;if(p>0){i.textContent=tg?tg.emptyScript:"";for(let d=0;d<p;d++)i.append(u[d],xd()),La.nextNode(),l.push({type:2,index:++r});i.append(u[p],xd())}}}else if(i.nodeType===8)if(i.data===Q2)l.push({type:2,index:r});else{let u=-1;for(;(u=i.data.indexOf(wo,u+1))!==-1;)l.push({type:7,index:r}),u+=wo.length-1}r++}}static createElement(t,e){const s=Ka.createElement("template");return s.innerHTML=t,s}};function Uc(n,t,e=n,s){var i,r;if(t===Bc)return t;let o=s!==void 0?(i=e._$Co)==null?void 0:i[s]:e._$Cl;const a=Id(t)?void 0:t._$litDirective$;return o?.constructor!==a&&((r=o?._$AO)==null||r.call(o,!1),a===void 0?o=void 0:(o=new a(n),o._$AT(n,e,s)),s!==void 0?(e._$Co??(e._$Co=[]))[s]=o:e._$Cl=o),o!==void 0&&(t=Uc(n,o._$AS(n,t.values),o,s)),t}class Q7{constructor(t,e){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:e},parts:s}=this._$AD,i=(t?.creationScope??Ka).importNode(e,!0);La.currentNode=i;let r=La.nextNode(),o=0,a=0,l=s[0];for(;l!==void 0;){if(o===l.index){let c;l.type===2?c=new tw(r,r.nextSibling,this,t):l.type===1?c=new l.ctor(r,l.name,l.strings,this,t):l.type===6&&(c=new e9(r,this,t)),this._$AV.push(c),l=s[++a]}o!==l?.index&&(r=La.nextNode(),o++)}return La.currentNode=Ka,i}p(t){let e=0;for(const s of this._$AV)s!==void 0&&(s.strings!==void 0?(s._$AI(t,s,e),e+=s.strings.length-2):s._$AI(t[e])),e++}}let tw=class eO{get _$AU(){var t;return((t=this._$AM)==null?void 0:t._$AU)??this._$Cv}constructor(t,e,s,i){this.type=2,this._$AH=Ke,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=s,this.options=i,this._$Cv=i?.isConnected??!0}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return e!==void 0&&t?.nodeType===11&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=Uc(this,t,e),Id(t)?t===Ke||t==null||t===""?(this._$AH!==Ke&&this._$AR(),this._$AH=Ke):t!==this._$AH&&t!==Bc&&this._(t):t._$litType$!==void 0?this.$(t):t.nodeType!==void 0?this.T(t):q7(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==Ke&&Id(this._$AH)?this._$AA.nextSibling.data=t:this.T(Ka.createTextNode(t)),this._$AH=t}$(t){var e;const{values:s,_$litType$:i}=t,r=typeof i=="number"?this._$AC(t):(i.el===void 0&&(i.el=Sy.createElement(J2(i.h,i.h[0]),this.options)),i);if(((e=this._$AH)==null?void 0:e._$AD)===r)this._$AH.p(s);else{const o=new Q7(r,this),a=o.u(this.options);o.p(s),this.T(a),this._$AH=o}}_$AC(t){let e=pI.get(t.strings);return e===void 0&&pI.set(t.strings,e=new Sy(t)),e}k(t){Kv(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let s,i=0;for(const r of t)i===e.length?e.push(s=new eO(this.O(xd()),this.O(xd()),this,this.options)):s=e[i],s._$AI(r),i++;i<e.length&&(this._$AR(s&&s._$AB.nextSibling,i),e.length=i)}_$AR(t=this._$AA.nextSibling,e){var s;for((s=this._$AP)==null?void 0:s.call(this,!1,!0,e);t&&t!==this._$AB;){const i=t.nextSibling;t.remove(),t=i}}setConnected(t){var e;this._$AM===void 0&&(this._$Cv=t,(e=this._$AP)==null||e.call(this,t))}};class Gg{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,e,s,i,r){this.type=1,this._$AH=Ke,this._$AN=void 0,this.element=t,this.name=e,this._$AM=i,this.options=r,s.length>2||s[0]!==""||s[1]!==""?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=Ke}_$AI(t,e=this,s,i){const r=this.strings;let o=!1;if(r===void 0)t=Uc(this,t,e,0),o=!Id(t)||t!==this._$AH&&t!==Bc,o&&(this._$AH=t);else{const a=t;let l,c;for(t=r[0],l=0;l<r.length-1;l++)c=Uc(this,a[s+l],e,l),c===Bc&&(c=this._$AH[l]),o||(o=!Id(c)||c!==this._$AH[l]),c===Ke?t=Ke:t!==Ke&&(t+=(c??"")+r[l+1]),this._$AH[l]=c}o&&!i&&this.j(t)}j(t){t===Ke?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}let K7=class extends Gg{constructor(){super(...arguments),this.type=3}j(n){this.element[this.name]=n===Ke?void 0:n}};class J7 extends Gg{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==Ke)}}let t9=class extends Gg{constructor(n,t,e,s,i){super(n,t,e,s,i),this.type=5}_$AI(n,t=this){if((n=Uc(this,n,t,0)??Ke)===Bc)return;const e=this._$AH,s=n===Ke&&e!==Ke||n.capture!==e.capture||n.once!==e.once||n.passive!==e.passive,i=n!==Ke&&(e===Ke||s);s&&this.element.removeEventListener(this.name,this,e),i&&this.element.addEventListener(this.name,this,n),this._$AH=n}handleEvent(n){var t;typeof this._$AH=="function"?this._$AH.call(((t=this.options)==null?void 0:t.host)??this.element,n):this._$AH.handleEvent(n)}},e9=class{constructor(n,t,e){this.element=n,this.type=6,this._$AN=void 0,this._$AM=t,this.options=e}get _$AU(){return this._$AM._$AU}_$AI(n){Uc(this,n)}};const fI=Jm.litHtmlPolyfillSupport;fI?.(Sy,tw),(Jm.litHtmlVersions??(Jm.litHtmlVersions=[])).push("3.3.0");const s9=(n,t,e)=>{const s=e?.renderBefore??t;let i=s._$litPart$;if(i===void 0){const r=e?.renderBefore??null;s._$litPart$=i=new tw(t.insertBefore(xd(),r),r,void 0,e??{})}return i._$AI(n),i};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Cd=globalThis;let Ua=class extends ac{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var n;const t=super.createRenderRoot();return(n=this.renderOptions).renderBefore??(n.renderBefore=t.firstChild),t}update(n){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(n),this._$Do=s9(t,this.renderRoot,this.renderOptions)}connectedCallback(){var n;super.connectedCallback(),(n=this._$Do)==null||n.setConnected(!0)}disconnectedCallback(){var n;super.disconnectedCallback(),(n=this._$Do)==null||n.setConnected(!1)}render(){return Bc}};var mI;Ua._$litElement$=!0,Ua.finalized=!0,(mI=Cd.litElementHydrateSupport)==null||mI.call(Cd,{LitElement:Ua});const gI=Cd.litElementPolyfillSupport;gI?.({LitElement:Ua});(Cd.litElementVersions??(Cd.litElementVersions=[])).push("4.2.0");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const i9={attribute:!0,type:String,converter:Km,reflect:!1,hasChanged:Qv},n9=(n=i9,t,e)=>{const{kind:s,metadata:i}=e;let r=globalThis.litPropertyMetadata.get(i);if(r===void 0&&globalThis.litPropertyMetadata.set(i,r=new Map),s==="setter"&&((n=Object.create(n)).wrapped=!0),r.set(e.name,n),s==="accessor"){const{name:o}=e;return{set(a){const l=t.get.call(this);t.set.call(this,a),this.requestUpdate(o,l,n)},init(a){return a!==void 0&&this.C(o,void 0,n,a),a}}}if(s==="setter"){const{name:o}=e;return function(a){const l=this[o];t.call(this,a),this.requestUpdate(o,l,n)}}throw Error("Unsupported decorator location: "+s)};function ai(n){return(t,e)=>typeof e=="object"?n9(n,t,e):((s,i,r)=>{const o=i.hasOwnProperty(r);return i.constructor.createProperty(r,s),o?Object.getOwnPropertyDescriptor(i,r):void 0})(n,t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function r9(n){return ai({...n,state:!0,attribute:!1})}class o9 extends Oi{constructor(t=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=t,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new Ut(.5,.5),this.addEventListener("removed",function(){this.traverse(function(e){e.element instanceof e.element.ownerDocument.defaultView.Element&&e.element.parentNode!==null&&e.element.remove()})})}copy(t,e){return super.copy(t,e),this.element=t.element.cloneNode(!0),this.center=t.center,this}}new F;new xt;new xt;new F;new F;class a9{constructor(t,e){this._group=new Fn,this._frustum=new No,this._frustumMat=new xt,this._regenerateDelay=200,this._regenerateCounter=0,this.material=new dg({color:"#2e3338"}),this.numbers=new Fn,this.maxRegenerateRetrys=4,this.gridsFactor=5,this._scaleX=1,this._scaleY=1,this._offsetX=0,this._offsetY=0,this._camera=t,this._container=e;const s=this.newGrid(-1),i=this.newGrid(-2);this.grids={main:s,secondary:i},this._group.add(i,s,this.numbers)}set scaleX(t){this._scaleX=t,this.regenerate()}get scaleX(){return this._scaleX}set scaleY(t){this._scaleY=t,this.regenerate()}get scaleY(){return this._scaleY}set offsetX(t){this._offsetX=t,this.regenerate()}get offsetX(){return this._offsetX}set offsetY(t){this._offsetY=t,this.regenerate()}get offsetY(){return this._offsetY}get(){return this._group}dispose(){const{main:t,secondary:e}=this.grids;t.removeFromParent(),e.removeFromParent(),t.geometry.dispose(),t.material.dispose(),e.geometry.dispose(),e.material.dispose()}regenerate(){if(!this.isGridReady()){if(this._regenerateCounter++,this._regenerateCounter>this.maxRegenerateRetrys)throw new Error("Grid could not be regenerated");setTimeout(()=>this.regenerate,this._regenerateDelay);return}this._regenerateCounter=0,this._camera.updateMatrix(),this._camera.updateMatrixWorld();const t=this._frustumMat.multiplyMatrices(this._camera.projectionMatrix,this._camera.matrixWorldInverse);this._frustum.setFromProjectionMatrix(t);const{planes:e}=this._frustum,s=e[0].constant*-e[0].normal.x,i=e[1].constant*-e[1].normal.x,r=e[2].constant*-e[2].normal.y,o=e[3].constant*-e[3].normal.y,a=Math.abs(s-i),l=Math.abs(o-r),{clientWidth:c,clientHeight:h}=this._container,u=Math.max(c,h),p=Math.max(a,l)/u,d=Math.ceil(Math.log10(a/this.scaleX)),g=Math.ceil(Math.log10(l/this.scaleY)),m=10**(d-2)*this.scaleX,b=10**(g-2)*this.scaleY,f=m*this.gridsFactor,_=b*this.gridsFactor,y=Math.ceil(l/_),v=Math.ceil(a/f),w=Math.ceil(l/b),I=Math.ceil(a/m),C=m*Math.ceil(i/m),A=b*Math.ceil(r/b),S=f*Math.ceil(i/f),P=_*Math.ceil(r/_),M=[...this.numbers.children];for(const ct of M)ct.removeFromParent();this.numbers.children=[];const T=[],L=9*p,E=1e4,N=S+this._offsetX,W=Math.round(Math.abs(N/this.scaleX)*E)/E,V=(v-1)*f,et=Math.round(Math.abs((N+V)/this.scaleX)*E)/E,j=Math.max(W,et).toString().length*L;let nt=Math.ceil(j/f)*f;for(let ct=0;ct<v;ct++){let _t=S+ct*f;T.push(_t,o,0,_t,r,0),_t=Math.round(_t*E)/E,nt=Math.round(nt*E)/E;const ut=_t%nt;if(!(f<1||_<1)&&Math.abs(ut)>.01)continue;const pt=this.newNumber((_t+this._offsetX)/this.scaleX),bt=12*p;pt.position.set(_t,r+bt,0)}for(let ct=0;ct<y;ct++){const _t=P+ct*_;T.push(i,_t,0,s,_t,0);const ut=this.newNumber(_t/this.scaleY);let pt=12;ut.element.textContent&&(pt+=4*ut.element.textContent.length);const bt=pt*p;ut.position.set(i+bt,_t,0)}const H=[];for(let ct=0;ct<I;ct++){const _t=C+ct*m;H.push(_t,o,0,_t,r,0)}for(let ct=0;ct<w;ct++){const _t=A+ct*b;H.push(i,_t,0,s,_t,0)}const B=new ze(new Float32Array(T),3),rt=new ze(new Float32Array(H),3),{main:Q,secondary:st}=this.grids;Q.geometry.setAttribute("position",B),st.geometry.setAttribute("position",rt)}newNumber(t){const e=document.createElement("bim-label");e.textContent=String(Math.round(t*100)/100);const s=new o9(e);return this.numbers.add(s),s}newGrid(t){const e=new Ce,s=new Gy(e,this.material);return s.frustumCulled=!1,s.renderOrder=t,s}isGridReady(){const t=this._camera.projectionMatrix.elements;for(let e=0;e<t.length;e++){const s=t[e];if(Number.isNaN(s))return!1}return!0}}var l9=Object.defineProperty,c9=Object.getOwnPropertyDescriptor,tp=(n,t,e,s)=>{for(var i=c9(t,e),r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=o(t,e,i)||i);return i&&l9(t,e,i),i};const sO=class extends Ua{constructor(){super(...arguments),this._grid=null,this._world=null,this.resize=()=>{this._world&&this._grid&&this._grid.regenerate()}}set gridColor(t){if(this._gridColor=t,!(t&&this._grid))return;const e=Number(t.replace("#","0x"));Number.isNaN(e)||this._grid.material.color.setHex(e)}get gridColor(){return this._gridColor}set gridScaleX(t){this._gridScaleX=t,t&&this._grid&&(this._grid.scaleX=t)}get gridScaleX(){return this._gridScaleX}set gridScaleY(t){this._gridScaleY=t,t&&this._grid&&(this._grid.scaleY=t)}get gridScaleY(){return this._gridScaleY}get gridOffsetX(){var t;return((t=this._grid)==null?void 0:t.offsetX)||0}set gridOffsetX(t){this._grid&&(this._grid.offsetX=t)}get gridOffsetY(){var t;return((t=this._grid)==null?void 0:t.offsetY)||0}set gridOffsetY(t){this._grid&&(this._grid.offsetY=t)}set components(t){this.dispose();const e=t.get(Vd).create();this._world=e,e.scene=new VT(t),e.scene.setup(),e.renderer=new tU(t,this);const s=new Ag(t);e.camera=s;const i=new a9(s.threeOrtho,this);this._grid=i,e.scene.three.add(i.get()),s.controls.addEventListener("update",()=>i.regenerate()),setTimeout(async()=>{e.camera.updateAspect(),s.set("Plan"),await s.controls.setLookAt(0,0,100,0,0,0),await s.projection.set("Orthographic"),s.controls.dollySpeed=3,s.controls.draggingSmoothTime=.085,s.controls.maxZoom=1e3,s.controls.zoom(4)})}get world(){return this._world}dispose(){var t;(t=this.world)==null||t.dispose(),this._world=null,this._grid=null}connectedCallback(){super.connectedCallback(),new ResizeObserver(this.resize).observe(this)}disconnectedCallback(){super.disconnectedCallback(),this.dispose()}render(){return Jv`<slot></slot>`}};sO.styles=Xv`
    :host {
      position: relative;
      display: flex;
      min-width: 0px;
      height: 100%;
      background-color: var(--bim-ui_bg-base);
    }
  `;let uh=sO;tp([ai({type:String,attribute:"grid-color",reflect:!0})],uh.prototype,"gridColor");tp([ai({type:Number,attribute:"grid-scale-x",reflect:!0})],uh.prototype,"gridScaleX");tp([ai({type:Number,attribute:"grid-scale-y",reflect:!0})],uh.prototype,"gridScaleY");tp([ai({type:Number,attribute:"grid-offset-x",reflect:!0})],uh.prototype,"gridOffsetX");tp([ai({type:Number,attribute:"grid-offset-y",reflect:!0})],uh.prototype,"gridOffsetY");var h9=Object.defineProperty,ta=(n,t,e,s)=>{for(var i=void 0,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=o(t,e,i)||i);return i&&h9(t,e,i),i};const iO=class extends Ua{constructor(){super(...arguments),this._defaults={size:60},this._cssMatrix3D="",this._matrix=new xt,this._onRightClick=new Event("rightclick"),this._onLeftClick=new Event("leftclick"),this._onTopClick=new Event("topclick"),this._onBottomClick=new Event("bottomclick"),this._onFrontClick=new Event("frontclick"),this._onBackClick=new Event("backclick"),this._camera=null,this._epsilon=t=>Math.abs(t)<1e-10?0:t}set camera(t){this._camera=t,this.updateOrientation()}get camera(){return this._camera}updateOrientation(){if(!this.camera)return;this._matrix.extractRotation(this.camera.matrixWorldInverse);const{elements:t}=this._matrix;this._cssMatrix3D=`matrix3d(
      ${this._epsilon(t[0])},
      ${this._epsilon(-t[1])},
      ${this._epsilon(t[2])},
      ${this._epsilon(t[3])},
      ${this._epsilon(t[4])},
      ${this._epsilon(-t[5])},
      ${this._epsilon(t[6])},
      ${this._epsilon(t[7])},
      ${this._epsilon(t[8])},
      ${this._epsilon(-t[9])},
      ${this._epsilon(t[10])},
      ${this._epsilon(t[11])},
      ${this._epsilon(t[12])},
      ${this._epsilon(-t[13])},
      ${this._epsilon(t[14])},
      ${this._epsilon(t[15])})
    `}render(){const t=this.size??this._defaults.size;return Jv`
      <style>
        .face,
        .cube {
          width: ${t}px;
          height: ${t}px;
          transform: translateZ(-300px) ${this._cssMatrix3D};
        }

        .face-right {
          translate: ${t/2}px 0 0;
        }

        .face-left {
          translate: ${-t/2}px 0 0;
        }

        .face-top {
          translate: 0 ${t/2}px 0;
        }

        .face-bottom {
          translate: 0 ${-t/2}px 0;
        }

        .face-front {
          translate: 0 0 ${t/2}px;
        }

        .face-back {
          translate: 0 0 ${-t/2}px;
        }
      </style>
      <div class="parent">
        <div class="cube">
          <div
            class="face x-direction face-right"
            @click=${()=>this.dispatchEvent(this._onRightClick)}
          >
            ${this.rightText}
          </div>
          <div
            class="face x-direction face-left"
            @click=${()=>this.dispatchEvent(this._onLeftClick)}
          >
            ${this.leftText}
          </div>
          <div
            class="face y-direction face-top"
            @click=${()=>this.dispatchEvent(this._onTopClick)}
          >
            ${this.topText}
          </div>
          <div
            class="face y-direction face-bottom"
            @click=${()=>this.dispatchEvent(this._onBottomClick)}
          >
            ${this.bottomText}
          </div>
          <div
            class="face z-direction face-front"
            @click=${()=>this.dispatchEvent(this._onFrontClick)}
          >
            ${this.frontText}
          </div>
          <div
            class="face z-direction face-back"
            @click=${()=>this.dispatchEvent(this._onBackClick)}
          >
            ${this.backText}
          </div>
        </div>
      </div>
    `}};iO.styles=Xv`
    :host {
      position: absolute;
      z-index: 999;
      bottom: 1rem;
      right: 1rem;
    }

    .parent {
      perspective: 400px;
    }

    .cube {
      position: relative;
      transform-style: preserve-3d;
    }

    .face {
      position: absolute;
      display: flex;
      justify-content: center;
      user-select: none;
      align-items: center;
      cursor: pointer;
      text-align: center;
      transition: all 0.2s;
      color: var(--bim-view-cube--c, white);
      font-size: var(--bim-view-cube--fz, --bim-ui_size-2xl);
    }

    .x-direction {
      // background-color: var(--bim-view-cube_x--bgc, #c93830DD);
      background-color: var(--bim-view-cube_x--bgc, #01a6bcde);
    }

    .x-direction:hover {
      background-color: var(--bim-ui_accent-base, white);
    }

    .y-direction {
      // background-color: var(--bim-view-cube_y--bgc, #54ff19DD);
      background-color: var(--bim-view-cube_y--bgc, #8d0ec8de);
    }

    .y-direction:hover {
      background-color: var(--bim-ui_accent-base, white);
    }

    .z-direction {
      // background-color: var(--bim-view-cube_z--bgc, #3041c9DD);
      background-color: var(--bim-view-cube_z--bgc, #2718afde);
    }

    .z-direction:hover {
      background-color: var(--bim-ui_accent-base, white);
    }

    .face-front {
      transform: rotateX(180deg);
    }

    .face-back {
      transform: rotateZ(180deg);
    }

    .face-top {
      transform: rotateX(90deg);
    }

    .face-bottom {
      transform: rotateX(270deg);
    }

    .face-right {
      transform: rotateY(-270deg) rotateX(180deg);
    }

    .face-left {
      transform: rotateY(-90deg) rotateX(180deg);
    }
  `;let Xr=iO;ta([ai({type:Number,reflect:!0})],Xr.prototype,"size");ta([ai({type:String,attribute:"right-text",reflect:!0})],Xr.prototype,"rightText");ta([ai({type:String,attribute:"left-text",reflect:!0})],Xr.prototype,"leftText");ta([ai({type:String,attribute:"top-text",reflect:!0})],Xr.prototype,"topText");ta([ai({type:String,attribute:"bottom-text",reflect:!0})],Xr.prototype,"bottomText");ta([ai({type:String,attribute:"front-text",reflect:!0})],Xr.prototype,"frontText");ta([ai({type:String,attribute:"back-text",reflect:!0})],Xr.prototype,"backText");ta([r9()],Xr.prototype,"_cssMatrix3D");/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const u9=n=>n.strings===void 0;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const d9={CHILD:2},p9=n=>(...t)=>({_$litDirective$:n,values:t});class f9{constructor(t){}get _$AU(){return this._$AM._$AU}_$AT(t,e,s){this._$Ct=t,this._$AM=e,this._$Ci=s}_$AS(t,e){return this.update(t,e)}update(t,e){return this.render(...e)}}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Ju=(n,t)=>{var e;const s=n._$AN;if(s===void 0)return!1;for(const i of s)(e=i._$AO)==null||e.call(i,t,!1),Ju(i,t);return!0},eg=n=>{let t,e;do{if((t=n._$AM)===void 0)break;e=t._$AN,e.delete(n),n=t}while(e?.size===0)},nO=n=>{for(let t;t=n._$AM;n=t){let e=t._$AN;if(e===void 0)t._$AN=e=new Set;else if(e.has(n))break;e.add(n),b9(t)}};function m9(n){this._$AN!==void 0?(eg(this),this._$AM=n,nO(this)):this._$AM=n}function g9(n,t=!1,e=0){const s=this._$AH,i=this._$AN;if(i!==void 0&&i.size!==0)if(t)if(Array.isArray(s))for(let r=e;r<s.length;r++)Ju(s[r],!1),eg(s[r]);else s!=null&&(Ju(s,!1),eg(s));else Ju(this,n)}const b9=n=>{n.type==d9.CHILD&&(n._$AP??(n._$AP=g9),n._$AQ??(n._$AQ=m9))};class _9 extends f9{constructor(){super(...arguments),this._$AN=void 0}_$AT(t,e,s){super._$AT(t,e,s),nO(this),this.isConnected=t._$AU}_$AO(t,e=!0){var s,i;t!==this.isConnected&&(this.isConnected=t,t?(s=this.reconnected)==null||s.call(this):(i=this.disconnected)==null||i.call(this)),e&&(Ju(this,t),eg(this))}setValue(t){if(u9(this._$Ct))this._$Ct._$AI(t,this);else{const e=[...this._$Ct._$AH];e[this._$Ci]=t,this._$Ct._$AI(e,this,0)}}disconnected(){}reconnected(){}}/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Oy=()=>new y9;class y9{}const V_=new WeakMap,v9=p9(class extends _9{render(n){return Ke}update(n,[t]){var e;const s=t!==this.G;return s&&this.G!==void 0&&this.rt(void 0),(s||this.lt!==this.ct)&&(this.G=t,this.ht=(e=n.options)==null?void 0:e.host,this.rt(this.ct=n.element)),Ke}rt(n){if(this.isConnected||(n=void 0),typeof this.G=="function"){const t=this.ht??globalThis;let e=V_.get(t);e===void 0&&(e=new WeakMap,V_.set(t,e)),e.get(this.G)!==void 0&&this.G.call(this.ht,void 0),e.set(this.G,n),n!==void 0&&this.G.call(this.ht,n)}else this.G.value=n}get lt(){var n,t;return typeof this.G=="function"?(n=V_.get(this.ht??globalThis))==null?void 0:n.get(this.G):(t=this.G)==null?void 0:t.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}});var w9=Object.defineProperty,E9=(n,t,e,s)=>{for(var i=void 0,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=o(t,e,i)||i);return i&&w9(t,e,i),i};const rO=class extends Ua{constructor(){super(...arguments),this.world=null,this._components=null,this._viewport=Oy()}set components(t){var e;if(this._components=t,this.components){const s=this.components.get(Vd);this.world=s.create(),this.world.name=this.name}else(e=this.world)==null||e.dispose(),this.world=null}get components(){return this._components}connectedCallback(){super.connectedCallback(),this.world&&(this.world.enabled=!0)}disconnectedCallback(){super.disconnectedCallback(),this.world&&(this.world.enabled=!1)}dispose(){this.components=null,this.remove()}firstUpdated(){const{value:t}=this._viewport;if(!(this.components&&t&&this.world))return;const e=new VT(this.components);this.world.scene=e,e.setup(),e.three.background=null;const s=new Q4(this.components,t);this.world.renderer=s;const i=new Ag(this.components);this.world.camera=i;const r=this.components.get(iD).create(this.world);r.material.uniforms.uColor.value=new Dt(4342338),r.material.uniforms.uSize1.value=2,r.material.uniforms.uSize2.value=8}onSlotChange(){const t=new Event("slotchange");this.dispatchEvent(t)}render(){return Jv` <bim-viewport ${v9(this._viewport)}>
      <slot @slotchange=${this.onSlotChange}></slot>
    </bim-viewport>`}};rO.styles=Xv``;let oO=rO;E9([ai({type:String,reflect:!0})],oO.prototype,"name");var x9=Object.defineProperty,I9=(n,t,e)=>t in n?x9(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,fa=(n,t,e)=>(I9(n,typeof t!="symbol"?t+"":t,e),e);const Vc=Math.min,Br=Math.max,sg=Math.round,Wo=n=>({x:n,y:n}),C9={left:"right",right:"left",bottom:"top",top:"bottom"},T9={start:"end",end:"start"};function bI(n,t,e){return Br(n,Vc(t,e))}function ep(n,t){return typeof n=="function"?n(t):n}function Yr(n){return n.split("-")[0]}function qg(n){return n.split("-")[1]}function aO(n){return n==="x"?"y":"x"}function lO(n){return n==="y"?"height":"width"}const A9=new Set(["top","bottom"]);function Dr(n){return A9.has(Yr(n))?"y":"x"}function cO(n){return aO(Dr(n))}function S9(n,t,e){e===void 0&&(e=!1);const s=qg(n),i=cO(n),r=lO(i);let o=i==="x"?s===(e?"end":"start")?"right":"left":s==="start"?"bottom":"top";return t.reference[r]>t.floating[r]&&(o=ig(o)),[o,ig(o)]}function O9(n){const t=ig(n);return[Py(n),t,Py(t)]}function Py(n){return n.replace(/start|end/g,t=>T9[t])}const _I=["left","right"],yI=["right","left"],P9=["top","bottom"],R9=["bottom","top"];function F9(n,t,e){switch(n){case"top":case"bottom":return e?t?yI:_I:t?_I:yI;case"left":case"right":return t?P9:R9;default:return[]}}function L9(n,t,e,s){const i=qg(n);let r=F9(Yr(n),e==="start",s);return i&&(r=r.map(o=>o+"-"+i),t&&(r=r.concat(r.map(Py)))),r}function ig(n){return n.replace(/left|right|bottom|top/g,t=>C9[t])}function $9(n){return{top:0,right:0,bottom:0,left:0,...n}}function hO(n){return typeof n!="number"?$9(n):{top:n,right:n,bottom:n,left:n}}function Hc(n){const{x:t,y:e,width:s,height:i}=n;return{width:s,height:i,top:e,left:t,right:t+s,bottom:e+i,x:t,y:e}}function vI(n,t,e){let{reference:s,floating:i}=n;const r=Dr(t),o=cO(t),a=lO(o),l=Yr(t),c=r==="y",h=s.x+s.width/2-i.width/2,u=s.y+s.height/2-i.height/2,p=s[a]/2-i[a]/2;let d;switch(l){case"top":d={x:h,y:s.y-i.height};break;case"bottom":d={x:h,y:s.y+s.height};break;case"right":d={x:s.x+s.width,y:u};break;case"left":d={x:s.x-i.width,y:u};break;default:d={x:s.x,y:s.y}}switch(qg(t)){case"start":d[o]-=p*(e&&c?-1:1);break;case"end":d[o]+=p*(e&&c?-1:1);break}return d}const N9=async(n,t,e)=>{const{placement:s="bottom",strategy:i="absolute",middleware:r=[],platform:o}=e,a=r.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(t));let c=await o.getElementRects({reference:n,floating:t,strategy:i}),{x:h,y:u}=vI(c,s,l),p=s,d={},g=0;for(let m=0;m<a.length;m++){const{name:b,fn:f}=a[m],{x:_,y,data:v,reset:w}=await f({x:h,y:u,initialPlacement:s,placement:p,strategy:i,middlewareData:d,rects:c,platform:o,elements:{reference:n,floating:t}});h=_??h,u=y??u,d={...d,[b]:{...d[b],...v}},w&&g<=50&&(g++,typeof w=="object"&&(w.placement&&(p=w.placement),w.rects&&(c=w.rects===!0?await o.getElementRects({reference:n,floating:t,strategy:i}):w.rects),{x:h,y:u}=vI(c,p,l)),m=-1)}return{x:h,y:u,placement:p,strategy:i,middlewareData:d}};async function uO(n,t){var e;t===void 0&&(t={});const{x:s,y:i,platform:r,rects:o,elements:a,strategy:l}=n,{boundary:c="clippingAncestors",rootBoundary:h="viewport",elementContext:u="floating",altBoundary:p=!1,padding:d=0}=ep(t,n),g=hO(d),m=a[p?u==="floating"?"reference":"floating":u],b=Hc(await r.getClippingRect({element:(e=await(r.isElement==null?void 0:r.isElement(m)))==null||e?m:m.contextElement||await(r.getDocumentElement==null?void 0:r.getDocumentElement(a.floating)),boundary:c,rootBoundary:h,strategy:l})),f=u==="floating"?{x:s,y:i,width:o.floating.width,height:o.floating.height}:o.reference,_=await(r.getOffsetParent==null?void 0:r.getOffsetParent(a.floating)),y=await(r.isElement==null?void 0:r.isElement(_))?await(r.getScale==null?void 0:r.getScale(_))||{x:1,y:1}:{x:1,y:1},v=Hc(r.convertOffsetParentRelativeRectToViewportRelativeRect?await r.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:f,offsetParent:_,strategy:l}):f);return{top:(b.top-v.top+g.top)/y.y,bottom:(v.bottom-b.bottom+g.bottom)/y.y,left:(b.left-v.left+g.left)/y.x,right:(v.right-b.right+g.right)/y.x}}const M9=function(n){return n===void 0&&(n={}),{name:"flip",options:n,async fn(t){var e,s;const{placement:i,middlewareData:r,rects:o,initialPlacement:a,platform:l,elements:c}=t,{mainAxis:h=!0,crossAxis:u=!0,fallbackPlacements:p,fallbackStrategy:d="bestFit",fallbackAxisSideDirection:g="none",flipAlignment:m=!0,...b}=ep(n,t);if((e=r.arrow)!=null&&e.alignmentOffset)return{};const f=Yr(i),_=Dr(a),y=Yr(a)===a,v=await(l.isRTL==null?void 0:l.isRTL(c.floating)),w=p||(y||!m?[ig(a)]:O9(a)),I=g!=="none";!p&&I&&w.push(...L9(a,m,g,v));const C=[a,...w],A=await uO(t,b),S=[];let P=((s=r.flip)==null?void 0:s.overflows)||[];if(h&&S.push(A[f]),u){const E=S9(i,o,v);S.push(A[E[0]],A[E[1]])}if(P=[...P,{placement:i,overflows:S}],!S.every(E=>E<=0)){var M,T;const E=(((M=r.flip)==null?void 0:M.index)||0)+1,N=C[E];if(N&&(!(u==="alignment"&&_!==Dr(N))||P.every(V=>V.overflows[0]>0&&Dr(V.placement)===_)))return{data:{index:E,overflows:P},reset:{placement:N}};let W=(T=P.filter(V=>V.overflows[0]<=0).sort((V,et)=>V.overflows[1]-et.overflows[1])[0])==null?void 0:T.placement;if(!W)switch(d){case"bestFit":{var L;const V=(L=P.filter(et=>{if(I){const j=Dr(et.placement);return j===_||j==="y"}return!0}).map(et=>[et.placement,et.overflows.filter(j=>j>0).reduce((j,nt)=>j+nt,0)]).sort((et,j)=>et[1]-j[1])[0])==null?void 0:L[0];V&&(W=V);break}case"initialPlacement":W=a;break}if(i!==W)return{reset:{placement:W}}}return{}}}};function dO(n){const t=Vc(...n.map(r=>r.left)),e=Vc(...n.map(r=>r.top)),s=Br(...n.map(r=>r.right)),i=Br(...n.map(r=>r.bottom));return{x:t,y:e,width:s-t,height:i-e}}function D9(n){const t=n.slice().sort((i,r)=>i.y-r.y),e=[];let s=null;for(let i=0;i<t.length;i++){const r=t[i];!s||r.y-s.y>s.height/2?e.push([r]):e[e.length-1].push(r),s=r}return e.map(i=>Hc(dO(i)))}const k9=function(n){return n===void 0&&(n={}),{name:"inline",options:n,async fn(t){const{placement:e,elements:s,rects:i,platform:r,strategy:o}=t,{padding:a=2,x:l,y:c}=ep(n,t),h=Array.from(await(r.getClientRects==null?void 0:r.getClientRects(s.reference))||[]),u=D9(h),p=Hc(dO(h)),d=hO(a);function g(){if(u.length===2&&u[0].left>u[1].right&&l!=null&&c!=null)return u.find(b=>l>b.left-d.left&&l<b.right+d.right&&c>b.top-d.top&&c<b.bottom+d.bottom)||p;if(u.length>=2){if(Dr(e)==="y"){const P=u[0],M=u[u.length-1],T=Yr(e)==="top",L=P.top,E=M.bottom,N=T?P.left:M.left,W=T?P.right:M.right,V=W-N,et=E-L;return{top:L,bottom:E,left:N,right:W,width:V,height:et,x:N,y:L}}const b=Yr(e)==="left",f=Br(...u.map(P=>P.right)),_=Vc(...u.map(P=>P.left)),y=u.filter(P=>b?P.left===_:P.right===f),v=y[0].top,w=y[y.length-1].bottom,I=_,C=f,A=C-I,S=w-v;return{top:v,bottom:w,left:I,right:C,width:A,height:S,x:I,y:v}}return p}const m=await r.getElementRects({reference:{getBoundingClientRect:g},floating:s.floating,strategy:o});return i.reference.x!==m.reference.x||i.reference.y!==m.reference.y||i.reference.width!==m.reference.width||i.reference.height!==m.reference.height?{reset:{rects:m}}:{}}}},z9=new Set(["left","top"]);async function B9(n,t){const{placement:e,platform:s,elements:i}=n,r=await(s.isRTL==null?void 0:s.isRTL(i.floating)),o=Yr(e),a=qg(e),l=Dr(e)==="y",c=z9.has(o)?-1:1,h=r&&l?-1:1,u=ep(t,n);let{mainAxis:p,crossAxis:d,alignmentAxis:g}=typeof u=="number"?{mainAxis:u,crossAxis:0,alignmentAxis:null}:{mainAxis:u.mainAxis||0,crossAxis:u.crossAxis||0,alignmentAxis:u.alignmentAxis};return a&&typeof g=="number"&&(d=a==="end"?g*-1:g),l?{x:d*h,y:p*c}:{x:p*c,y:d*h}}const pO=function(n){return{name:"offset",options:n,async fn(t){var e,s;const{x:i,y:r,placement:o,middlewareData:a}=t,l=await B9(t,n);return o===((e=a.offset)==null?void 0:e.placement)&&(s=a.arrow)!=null&&s.alignmentOffset?{}:{x:i+l.x,y:r+l.y,data:{...l,placement:o}}}}},U9=function(n){return n===void 0&&(n={}),{name:"shift",options:n,async fn(t){const{x:e,y:s,placement:i}=t,{mainAxis:r=!0,crossAxis:o=!1,limiter:a={fn:b=>{let{x:f,y:_}=b;return{x:f,y:_}}},...l}=ep(n,t),c={x:e,y:s},h=await uO(t,l),u=Dr(Yr(i)),p=aO(u);let d=c[p],g=c[u];if(r){const b=p==="y"?"top":"left",f=p==="y"?"bottom":"right",_=d+h[b],y=d-h[f];d=bI(_,d,y)}if(o){const b=u==="y"?"top":"left",f=u==="y"?"bottom":"right",_=g+h[b],y=g-h[f];g=bI(_,g,y)}const m=a.fn({...t,[p]:d,[u]:g});return{...m,data:{x:m.x-e,y:m.y-s,enabled:{[p]:r,[u]:o}}}}}};function Zg(){return typeof window<"u"}function Yo(n){return fO(n)?(n.nodeName||"").toLowerCase():"#document"}function Ai(n){var t;return(n==null||(t=n.ownerDocument)==null?void 0:t.defaultView)||window}function ea(n){var t;return(t=(fO(n)?n.ownerDocument:n.document)||window.document)==null?void 0:t.documentElement}function fO(n){return Zg()?n instanceof Node||n instanceof Ai(n).Node:!1}function _r(n){return Zg()?n instanceof Element||n instanceof Ai(n).Element:!1}function yr(n){return Zg()?n instanceof HTMLElement||n instanceof Ai(n).HTMLElement:!1}function wI(n){return!Zg()||typeof ShadowRoot>"u"?!1:n instanceof ShadowRoot||n instanceof Ai(n).ShadowRoot}const V9=new Set(["inline","contents"]);function sp(n){const{overflow:t,overflowX:e,overflowY:s,display:i}=hn(n);return/auto|scroll|overlay|hidden|clip/.test(t+s+e)&&!V9.has(i)}const H9=new Set(["table","td","th"]);function j9(n){return H9.has(Yo(n))}const W9=[":popover-open",":modal"];function Y9(n){return W9.some(t=>{try{return n.matches(t)}catch{return!1}})}const G9=["transform","translate","scale","rotate","perspective"],q9=["transform","translate","scale","rotate","perspective","filter"],Z9=["paint","layout","strict","content"];function ew(n){const t=sw(),e=_r(n)?hn(n):n;return G9.some(s=>e[s]?e[s]!=="none":!1)||(e.containerType?e.containerType!=="normal":!1)||!t&&(e.backdropFilter?e.backdropFilter!=="none":!1)||!t&&(e.filter?e.filter!=="none":!1)||q9.some(s=>(e.willChange||"").includes(s))||Z9.some(s=>(e.contain||"").includes(s))}function X9(n){let t=jc(n);for(;yr(t)&&!Xg(t);){if(ew(t))return t;if(Y9(t))return null;t=jc(t)}return null}function sw(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const Q9=new Set(["html","body","#document"]);function Xg(n){return Q9.has(Yo(n))}function hn(n){return Ai(n).getComputedStyle(n)}function Qg(n){return _r(n)?{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}:{scrollLeft:n.scrollX,scrollTop:n.scrollY}}function jc(n){if(Yo(n)==="html")return n;const t=n.assignedSlot||n.parentNode||wI(n)&&n.host||ea(n);return wI(t)?t.host:t}function mO(n){const t=jc(n);return Xg(t)?n.ownerDocument?n.ownerDocument.body:n.body:yr(t)&&sp(t)?t:mO(t)}function gO(n,t,e){var s;t===void 0&&(t=[]);const i=mO(n),r=i===((s=n.ownerDocument)==null?void 0:s.body),o=Ai(i);return r?(K9(o),t.concat(o,o.visualViewport||[],sp(i)?i:[],[])):t.concat(i,gO(i,[]))}function K9(n){return n.parent&&Object.getPrototypeOf(n.parent)?n.frameElement:null}function bO(n){const t=hn(n);let e=parseFloat(t.width)||0,s=parseFloat(t.height)||0;const i=yr(n),r=i?n.offsetWidth:e,o=i?n.offsetHeight:s,a=sg(e)!==r||sg(s)!==o;return a&&(e=r,s=o),{width:e,height:s,$:a}}function _O(n){return _r(n)?n:n.contextElement}function wc(n){const t=_O(n);if(!yr(t))return Wo(1);const e=t.getBoundingClientRect(),{width:s,height:i,$:r}=bO(t);let o=(r?sg(e.width):e.width)/s,a=(r?sg(e.height):e.height)/i;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const J9=Wo(0);function yO(n){const t=Ai(n);return!sw()||!t.visualViewport?J9:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function tH(n,t,e){return t===void 0&&(t=!1),!e||t&&e!==Ai(n)?!1:t}function Td(n,t,e,s){t===void 0&&(t=!1),e===void 0&&(e=!1);const i=n.getBoundingClientRect(),r=_O(n);let o=Wo(1);t&&(s?_r(s)&&(o=wc(s)):o=wc(n));const a=tH(r,e,s)?yO(r):Wo(0);let l=(i.left+a.x)/o.x,c=(i.top+a.y)/o.y,h=i.width/o.x,u=i.height/o.y;if(r){const p=Ai(r),d=s&&_r(s)?Ai(s):s;let g=p,m=g.frameElement;for(;m&&s&&d!==g;){const b=wc(m),f=m.getBoundingClientRect(),_=hn(m),y=f.left+(m.clientLeft+parseFloat(_.paddingLeft))*b.x,v=f.top+(m.clientTop+parseFloat(_.paddingTop))*b.y;l*=b.x,c*=b.y,h*=b.x,u*=b.y,l+=y,c+=v,g=Ai(m),m=g.frameElement}}return Hc({width:h,height:u,x:l,y:c})}const eH=[":popover-open",":modal"];function vO(n){return eH.some(t=>{try{return n.matches(t)}catch{return!1}})}function sH(n){let{elements:t,rect:e,offsetParent:s,strategy:i}=n;const r=i==="fixed",o=ea(s),a=t?vO(t.floating):!1;if(s===o||a&&r)return e;let l={scrollLeft:0,scrollTop:0},c=Wo(1);const h=Wo(0),u=yr(s);if((u||!u&&!r)&&((Yo(s)!=="body"||sp(o))&&(l=Qg(s)),yr(s))){const p=Td(s);c=wc(s),h.x=p.x+s.clientLeft,h.y=p.y+s.clientTop}return{width:e.width*c.x,height:e.height*c.y,x:e.x*c.x-l.scrollLeft*c.x+h.x,y:e.y*c.y-l.scrollTop*c.y+h.y}}function iH(n){return Array.from(n.getClientRects())}function wO(n){return Td(ea(n)).left+Qg(n).scrollLeft}function nH(n){const t=ea(n),e=Qg(n),s=n.ownerDocument.body,i=Br(t.scrollWidth,t.clientWidth,s.scrollWidth,s.clientWidth),r=Br(t.scrollHeight,t.clientHeight,s.scrollHeight,s.clientHeight);let o=-e.scrollLeft+wO(n);const a=-e.scrollTop;return hn(s).direction==="rtl"&&(o+=Br(t.clientWidth,s.clientWidth)-i),{width:i,height:r,x:o,y:a}}function rH(n,t){const e=Ai(n),s=ea(n),i=e.visualViewport;let r=s.clientWidth,o=s.clientHeight,a=0,l=0;if(i){r=i.width,o=i.height;const c=sw();(!c||c&&t==="fixed")&&(a=i.offsetLeft,l=i.offsetTop)}return{width:r,height:o,x:a,y:l}}function oH(n,t){const e=Td(n,!0,t==="fixed"),s=e.top+n.clientTop,i=e.left+n.clientLeft,r=yr(n)?wc(n):Wo(1),o=n.clientWidth*r.x,a=n.clientHeight*r.y,l=i*r.x,c=s*r.y;return{width:o,height:a,x:l,y:c}}function EI(n,t,e){let s;if(t==="viewport")s=rH(n,e);else if(t==="document")s=nH(ea(n));else if(_r(t))s=oH(t,e);else{const i=yO(n);s={...t,x:t.x-i.x,y:t.y-i.y}}return Hc(s)}function EO(n,t){const e=jc(n);return e===t||!_r(e)||Xg(e)?!1:hn(e).position==="fixed"||EO(e,t)}function aH(n,t){const e=t.get(n);if(e)return e;let s=gO(n,[]).filter(a=>_r(a)&&Yo(a)!=="body"),i=null;const r=hn(n).position==="fixed";let o=r?jc(n):n;for(;_r(o)&&!Xg(o);){const a=hn(o),l=ew(o);!l&&a.position==="fixed"&&(i=null),(r?!l&&!i:!l&&a.position==="static"&&i&&["absolute","fixed"].includes(i.position)||sp(o)&&!l&&EO(n,o))?s=s.filter(c=>c!==o):i=a,o=jc(o)}return t.set(n,s),s}function lH(n){let{element:t,boundary:e,rootBoundary:s,strategy:i}=n;const r=[...e==="clippingAncestors"?aH(t,this._c):[].concat(e),s],o=r[0],a=r.reduce((l,c)=>{const h=EI(t,c,i);return l.top=Br(h.top,l.top),l.right=Vc(h.right,l.right),l.bottom=Vc(h.bottom,l.bottom),l.left=Br(h.left,l.left),l},EI(t,o,i));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}}function cH(n){const{width:t,height:e}=bO(n);return{width:t,height:e}}function hH(n,t,e){const s=yr(t),i=ea(t),r=e==="fixed",o=Td(n,!0,r,t);let a={scrollLeft:0,scrollTop:0};const l=Wo(0);if(s||!s&&!r)if((Yo(t)!=="body"||sp(i))&&(a=Qg(t)),s){const u=Td(t,!0,r,t);l.x=u.x+t.clientLeft,l.y=u.y+t.clientTop}else i&&(l.x=wO(i));const c=o.left+a.scrollLeft-l.x,h=o.top+a.scrollTop-l.y;return{x:c,y:h,width:o.width,height:o.height}}function xI(n,t){return!yr(n)||hn(n).position==="fixed"?null:t?t(n):n.offsetParent}function xO(n,t){const e=Ai(n);if(!yr(n)||vO(n))return e;let s=xI(n,t);for(;s&&j9(s)&&hn(s).position==="static";)s=xI(s,t);return s&&(Yo(s)==="html"||Yo(s)==="body"&&hn(s).position==="static"&&!ew(s))?e:s||X9(n)||e}const uH=async function(n){const t=this.getOffsetParent||xO,e=this.getDimensions;return{reference:hH(n.reference,await t(n.floating),n.strategy),floating:{x:0,y:0,...await e(n.floating)}}};function dH(n){return hn(n).direction==="rtl"}const pH={convertOffsetParentRelativeRectToViewportRelativeRect:sH,getDocumentElement:ea,getClippingRect:lH,getOffsetParent:xO,getElementRects:uH,getClientRects:iH,getDimensions:cH,getScale:wc,isElement:_r,isRTL:dH},IO=U9,CO=M9,TO=k9,AO=(n,t,e)=>{const s=new Map,i={platform:pH,...e},r={...i.platform,_c:s};return N9(n,t,{...i,platform:r})};/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ym=globalThis,iw=ym.ShadowRoot&&(ym.ShadyCSS===void 0||ym.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,nw=Symbol(),II=new WeakMap;let SO=class{constructor(n,t,e){if(this._$cssResult$=!0,e!==nw)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=n,this.t=t}get styleSheet(){let n=this.o;const t=this.t;if(iw&&n===void 0){const e=t!==void 0&&t.length===1;e&&(n=II.get(t)),n===void 0&&((this.o=n=new CSSStyleSheet).replaceSync(this.cssText),e&&II.set(t,n))}return n}toString(){return this.cssText}};const fH=n=>new SO(typeof n=="string"?n:n+"",void 0,nw),he=(n,...t)=>{const e=n.length===1?n[0]:t.reduce((s,i,r)=>s+(o=>{if(o._$cssResult$===!0)return o.cssText;if(typeof o=="number")return o;throw Error("Value passed to 'css' function must be a 'css' function result: "+o+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+n[r+1],n[0]);return new SO(e,n,nw)},mH=(n,t)=>{if(iw)n.adoptedStyleSheets=t.map(e=>e instanceof CSSStyleSheet?e:e.styleSheet);else for(const e of t){const s=document.createElement("style"),i=ym.litNonce;i!==void 0&&s.setAttribute("nonce",i),s.textContent=e.cssText,n.appendChild(s)}},CI=iw?n=>n:n=>n instanceof CSSStyleSheet?(t=>{let e="";for(const s of t.cssRules)e+=s.cssText;return fH(e)})(n):n;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:gH,defineProperty:bH,getOwnPropertyDescriptor:_H,getOwnPropertyNames:yH,getOwnPropertySymbols:vH,getPrototypeOf:wH}=Object,Wc=globalThis,TI=Wc.trustedTypes,EH=TI?TI.emptyScript:"",AI=Wc.reactiveElementPolyfillSupport,td=(n,t)=>n,ng={toAttribute(n,t){switch(t){case Boolean:n=n?EH:null;break;case Object:case Array:n=n==null?n:JSON.stringify(n)}return n},fromAttribute(n,t){let e=n;switch(t){case Boolean:e=n!==null;break;case Number:e=n===null?null:Number(n);break;case Object:case Array:try{e=JSON.parse(n)}catch{e=null}}return e}},rw=(n,t)=>!gH(n,t),SI={attribute:!0,type:String,converter:ng,reflect:!1,useDefault:!1,hasChanged:rw};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),Wc.litPropertyMetadata??(Wc.litPropertyMetadata=new WeakMap);let lc=class extends HTMLElement{static addInitializer(n){this._$Ei(),(this.l??(this.l=[])).push(n)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(n,t=SI){if(t.state&&(t.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(n)&&((t=Object.create(t)).wrapped=!0),this.elementProperties.set(n,t),!t.noAccessor){const e=Symbol(),s=this.getPropertyDescriptor(n,e,t);s!==void 0&&bH(this.prototype,n,s)}}static getPropertyDescriptor(n,t,e){const{get:s,set:i}=_H(this.prototype,n)??{get(){return this[t]},set(r){this[t]=r}};return{get:s,set(r){const o=s?.call(this);i?.call(this,r),this.requestUpdate(n,o,e)},configurable:!0,enumerable:!0}}static getPropertyOptions(n){return this.elementProperties.get(n)??SI}static _$Ei(){if(this.hasOwnProperty(td("elementProperties")))return;const n=wH(this);n.finalize(),n.l!==void 0&&(this.l=[...n.l]),this.elementProperties=new Map(n.elementProperties)}static finalize(){if(this.hasOwnProperty(td("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(td("properties"))){const t=this.properties,e=[...yH(t),...vH(t)];for(const s of e)this.createProperty(s,t[s])}const n=this[Symbol.metadata];if(n!==null){const t=litPropertyMetadata.get(n);if(t!==void 0)for(const[e,s]of t)this.elementProperties.set(e,s)}this._$Eh=new Map;for(const[t,e]of this.elementProperties){const s=this._$Eu(t,e);s!==void 0&&this._$Eh.set(s,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(n){const t=[];if(Array.isArray(n)){const e=new Set(n.flat(1/0).reverse());for(const s of e)t.unshift(CI(s))}else n!==void 0&&t.push(CI(n));return t}static _$Eu(n,t){const e=t.attribute;return e===!1?void 0:typeof e=="string"?e:typeof n=="string"?n.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var n;this._$ES=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),(n=this.constructor.l)==null||n.forEach(t=>t(this))}addController(n){var t;(this._$EO??(this._$EO=new Set)).add(n),this.renderRoot!==void 0&&this.isConnected&&((t=n.hostConnected)==null||t.call(n))}removeController(n){var t;(t=this._$EO)==null||t.delete(n)}_$E_(){const n=new Map,t=this.constructor.elementProperties;for(const e of t.keys())this.hasOwnProperty(e)&&(n.set(e,this[e]),delete this[e]);n.size>0&&(this._$Ep=n)}createRenderRoot(){const n=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return mH(n,this.constructor.elementStyles),n}connectedCallback(){var n;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(n=this._$EO)==null||n.forEach(t=>{var e;return(e=t.hostConnected)==null?void 0:e.call(t)})}enableUpdating(n){}disconnectedCallback(){var n;(n=this._$EO)==null||n.forEach(t=>{var e;return(e=t.hostDisconnected)==null?void 0:e.call(t)})}attributeChangedCallback(n,t,e){this._$AK(n,e)}_$ET(n,t){var e;const s=this.constructor.elementProperties.get(n),i=this.constructor._$Eu(n,s);if(i!==void 0&&s.reflect===!0){const r=(((e=s.converter)==null?void 0:e.toAttribute)!==void 0?s.converter:ng).toAttribute(t,s.type);this._$Em=n,r==null?this.removeAttribute(i):this.setAttribute(i,r),this._$Em=null}}_$AK(n,t){var e,s;const i=this.constructor,r=i._$Eh.get(n);if(r!==void 0&&this._$Em!==r){const o=i.getPropertyOptions(r),a=typeof o.converter=="function"?{fromAttribute:o.converter}:((e=o.converter)==null?void 0:e.fromAttribute)!==void 0?o.converter:ng;this._$Em=r,this[r]=a.fromAttribute(t,o.type)??((s=this._$Ej)==null?void 0:s.get(r))??null,this._$Em=null}}requestUpdate(n,t,e){var s;if(n!==void 0){const i=this.constructor,r=this[n];if(e??(e=i.getPropertyOptions(n)),!((e.hasChanged??rw)(r,t)||e.useDefault&&e.reflect&&r===((s=this._$Ej)==null?void 0:s.get(n))&&!this.hasAttribute(i._$Eu(n,e))))return;this.C(n,t,e)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(n,t,{useDefault:e,reflect:s,wrapped:i},r){e&&!(this._$Ej??(this._$Ej=new Map)).has(n)&&(this._$Ej.set(n,r??t??this[n]),i!==!0||r!==void 0)||(this._$AL.has(n)||(this.hasUpdated||e||(t=void 0),this._$AL.set(n,t)),s===!0&&this._$Em!==n&&(this._$Eq??(this._$Eq=new Set)).add(n))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(t){Promise.reject(t)}const n=this.scheduleUpdate();return n!=null&&await n,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var n;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[i,r]of this._$Ep)this[i]=r;this._$Ep=void 0}const s=this.constructor.elementProperties;if(s.size>0)for(const[i,r]of s){const{wrapped:o}=r,a=this[i];o!==!0||this._$AL.has(i)||a===void 0||this.C(i,void 0,r,a)}}let t=!1;const e=this._$AL;try{t=this.shouldUpdate(e),t?(this.willUpdate(e),(n=this._$EO)==null||n.forEach(s=>{var i;return(i=s.hostUpdate)==null?void 0:i.call(s)}),this.update(e)):this._$EM()}catch(s){throw t=!1,this._$EM(),s}t&&this._$AE(e)}willUpdate(n){}_$AE(n){var t;(t=this._$EO)==null||t.forEach(e=>{var s;return(s=e.hostUpdated)==null?void 0:s.call(e)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(n)),this.updated(n)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(n){return!0}update(n){this._$Eq&&(this._$Eq=this._$Eq.forEach(t=>this._$ET(t,this[t]))),this._$EM()}updated(n){}firstUpdated(n){}};lc.elementStyles=[],lc.shadowRootOptions={mode:"open"},lc[td("elementProperties")]=new Map,lc[td("finalized")]=new Map,AI?.({ReactiveElement:lc}),(Wc.reactiveElementVersions??(Wc.reactiveElementVersions=[])).push("2.1.0");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const rg=globalThis,og=rg.trustedTypes,OI=og?og.createPolicy("lit-html",{createHTML:n=>n}):void 0,OO="$lit$",Eo=`lit$${Math.random().toFixed(9).slice(2)}$`,PO="?"+Eo,xH=`<${PO}>`,Ja=document,Ad=()=>Ja.createComment(""),Sd=n=>n===null||typeof n!="object"&&typeof n!="function",ow=Array.isArray,IH=n=>ow(n)||typeof n?.[Symbol.iterator]=="function",H_=`[ 	
\f\r]`,ou=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,PI=/-->/g,RI=/>/g,ma=RegExp(`>|${H_}(?:([^\\s"'>=/]+)(${H_}*=${H_}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),FI=/'/g,LI=/"/g,RO=/^(?:script|style|textarea|title)$/i,CH=n=>(t,...e)=>({_$litType$:n,strings:t,values:e}),dt=CH(1),tl=Symbol.for("lit-noChange"),Xe=Symbol.for("lit-nothing"),$I=new WeakMap,$a=Ja.createTreeWalker(Ja,129);function FO(n,t){if(!ow(n)||!n.hasOwnProperty("raw"))throw Error("invalid template strings array");return OI!==void 0?OI.createHTML(t):t}const TH=(n,t)=>{const e=n.length-1,s=[];let i,r=t===2?"<svg>":t===3?"<math>":"",o=ou;for(let a=0;a<e;a++){const l=n[a];let c,h,u=-1,p=0;for(;p<l.length&&(o.lastIndex=p,h=o.exec(l),h!==null);)p=o.lastIndex,o===ou?h[1]==="!--"?o=PI:h[1]!==void 0?o=RI:h[2]!==void 0?(RO.test(h[2])&&(i=RegExp("</"+h[2],"g")),o=ma):h[3]!==void 0&&(o=ma):o===ma?h[0]===">"?(o=i??ou,u=-1):h[1]===void 0?u=-2:(u=o.lastIndex-h[2].length,c=h[1],o=h[3]===void 0?ma:h[3]==='"'?LI:FI):o===LI||o===FI?o=ma:o===PI||o===RI?o=ou:(o=ma,i=void 0);const d=o===ma&&n[a+1].startsWith("/>")?" ":"";r+=o===ou?l+xH:u>=0?(s.push(c),l.slice(0,u)+OO+l.slice(u)+Eo+d):l+Eo+(u===-2?a:d)}return[FO(n,r+(n[e]||"<?>")+(t===2?"</svg>":t===3?"</math>":"")),s]};class Od{constructor({strings:t,_$litType$:e},s){let i;this.parts=[];let r=0,o=0;const a=t.length-1,l=this.parts,[c,h]=TH(t,e);if(this.el=Od.createElement(c,s),$a.currentNode=this.el.content,e===2||e===3){const u=this.el.content.firstChild;u.replaceWith(...u.childNodes)}for(;(i=$a.nextNode())!==null&&l.length<a;){if(i.nodeType===1){if(i.hasAttributes())for(const u of i.getAttributeNames())if(u.endsWith(OO)){const p=h[o++],d=i.getAttribute(u).split(Eo),g=/([.?@])?(.*)/.exec(p);l.push({type:1,index:r,name:g[2],strings:d,ctor:g[1]==="."?SH:g[1]==="?"?OH:g[1]==="@"?PH:Kg}),i.removeAttribute(u)}else u.startsWith(Eo)&&(l.push({type:6,index:r}),i.removeAttribute(u));if(RO.test(i.tagName)){const u=i.textContent.split(Eo),p=u.length-1;if(p>0){i.textContent=og?og.emptyScript:"";for(let d=0;d<p;d++)i.append(u[d],Ad()),$a.nextNode(),l.push({type:2,index:++r});i.append(u[p],Ad())}}}else if(i.nodeType===8)if(i.data===PO)l.push({type:2,index:r});else{let u=-1;for(;(u=i.data.indexOf(Eo,u+1))!==-1;)l.push({type:7,index:r}),u+=Eo.length-1}r++}}static createElement(t,e){const s=Ja.createElement("template");return s.innerHTML=t,s}}function Yc(n,t,e=n,s){var i,r;if(t===tl)return t;let o=s!==void 0?(i=e._$Co)==null?void 0:i[s]:e._$Cl;const a=Sd(t)?void 0:t._$litDirective$;return o?.constructor!==a&&((r=o?._$AO)==null||r.call(o,!1),a===void 0?o=void 0:(o=new a(n),o._$AT(n,e,s)),s!==void 0?(e._$Co??(e._$Co=[]))[s]=o:e._$Cl=o),o!==void 0&&(t=Yc(n,o._$AS(n,t.values),o,s)),t}class AH{constructor(t,e){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:e},parts:s}=this._$AD,i=(t?.creationScope??Ja).importNode(e,!0);$a.currentNode=i;let r=$a.nextNode(),o=0,a=0,l=s[0];for(;l!==void 0;){if(o===l.index){let c;l.type===2?c=new ip(r,r.nextSibling,this,t):l.type===1?c=new l.ctor(r,l.name,l.strings,this,t):l.type===6&&(c=new RH(r,this,t)),this._$AV.push(c),l=s[++a]}o!==l?.index&&(r=$a.nextNode(),o++)}return $a.currentNode=Ja,i}p(t){let e=0;for(const s of this._$AV)s!==void 0&&(s.strings!==void 0?(s._$AI(t,s,e),e+=s.strings.length-2):s._$AI(t[e])),e++}}class ip{get _$AU(){var t;return((t=this._$AM)==null?void 0:t._$AU)??this._$Cv}constructor(t,e,s,i){this.type=2,this._$AH=Xe,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=s,this.options=i,this._$Cv=i?.isConnected??!0}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return e!==void 0&&t?.nodeType===11&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=Yc(this,t,e),Sd(t)?t===Xe||t==null||t===""?(this._$AH!==Xe&&this._$AR(),this._$AH=Xe):t!==this._$AH&&t!==tl&&this._(t):t._$litType$!==void 0?this.$(t):t.nodeType!==void 0?this.T(t):IH(t)?this.k(t):this._(t)}O(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.O(t))}_(t){this._$AH!==Xe&&Sd(this._$AH)?this._$AA.nextSibling.data=t:this.T(Ja.createTextNode(t)),this._$AH=t}$(t){var e;const{values:s,_$litType$:i}=t,r=typeof i=="number"?this._$AC(t):(i.el===void 0&&(i.el=Od.createElement(FO(i.h,i.h[0]),this.options)),i);if(((e=this._$AH)==null?void 0:e._$AD)===r)this._$AH.p(s);else{const o=new AH(r,this),a=o.u(this.options);o.p(s),this.T(a),this._$AH=o}}_$AC(t){let e=$I.get(t.strings);return e===void 0&&$I.set(t.strings,e=new Od(t)),e}k(t){ow(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let s,i=0;for(const r of t)i===e.length?e.push(s=new ip(this.O(Ad()),this.O(Ad()),this,this.options)):s=e[i],s._$AI(r),i++;i<e.length&&(this._$AR(s&&s._$AB.nextSibling,i),e.length=i)}_$AR(t=this._$AA.nextSibling,e){var s;for((s=this._$AP)==null?void 0:s.call(this,!1,!0,e);t&&t!==this._$AB;){const i=t.nextSibling;t.remove(),t=i}}setConnected(t){var e;this._$AM===void 0&&(this._$Cv=t,(e=this._$AP)==null||e.call(this,t))}}class Kg{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,e,s,i,r){this.type=1,this._$AH=Xe,this._$AN=void 0,this.element=t,this.name=e,this._$AM=i,this.options=r,s.length>2||s[0]!==""||s[1]!==""?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=Xe}_$AI(t,e=this,s,i){const r=this.strings;let o=!1;if(r===void 0)t=Yc(this,t,e,0),o=!Sd(t)||t!==this._$AH&&t!==tl,o&&(this._$AH=t);else{const a=t;let l,c;for(t=r[0],l=0;l<r.length-1;l++)c=Yc(this,a[s+l],e,l),c===tl&&(c=this._$AH[l]),o||(o=!Sd(c)||c!==this._$AH[l]),c===Xe?t=Xe:t!==Xe&&(t+=(c??"")+r[l+1]),this._$AH[l]=c}o&&!i&&this.j(t)}j(t){t===Xe?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class SH extends Kg{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===Xe?void 0:t}}class OH extends Kg{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==Xe)}}class PH extends Kg{constructor(t,e,s,i,r){super(t,e,s,i,r),this.type=5}_$AI(t,e=this){if((t=Yc(this,t,e,0)??Xe)===tl)return;const s=this._$AH,i=t===Xe&&s!==Xe||t.capture!==s.capture||t.once!==s.once||t.passive!==s.passive,r=t!==Xe&&(s===Xe||i);i&&this.element.removeEventListener(this.name,this,s),r&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var e;typeof this._$AH=="function"?this._$AH.call(((e=this.options)==null?void 0:e.host)??this.element,t):this._$AH.handleEvent(t)}}class RH{constructor(t,e,s){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(t){Yc(this,t)}}const NI=rg.litHtmlPolyfillSupport;NI?.(Od,ip),(rg.litHtmlVersions??(rg.litHtmlVersions=[])).push("3.3.0");const Gc=(n,t,e)=>{const s=e?.renderBefore??t;let i=s._$litPart$;if(i===void 0){const r=e?.renderBefore??null;s._$litPart$=i=new ip(t.insertBefore(Ad(),r),r,void 0,e??{})}return i._$AI(n),i};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Pd=globalThis;let ae=class extends lc{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var n;const t=super.createRenderRoot();return(n=this.renderOptions).renderBefore??(n.renderBefore=t.firstChild),t}update(n){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(n),this._$Do=Gc(t,this.renderRoot,this.renderOptions)}connectedCallback(){var n;super.connectedCallback(),(n=this._$Do)==null||n.setConnected(!0)}disconnectedCallback(){var n;super.disconnectedCallback(),(n=this._$Do)==null||n.setConnected(!1)}render(){return tl}};var MI;ae._$litElement$=!0,ae.finalized=!0,(MI=Pd.litElementHydrateSupport)==null||MI.call(Pd,{LitElement:ae});const DI=Pd.litElementPolyfillSupport;DI?.({LitElement:ae});(Pd.litElementVersions??(Pd.litElementVersions=[])).push("4.2.0");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const FH={attribute:!0,type:String,converter:ng,reflect:!1,hasChanged:rw},LH=(n=FH,t,e)=>{const{kind:s,metadata:i}=e;let r=globalThis.litPropertyMetadata.get(i);if(r===void 0&&globalThis.litPropertyMetadata.set(i,r=new Map),s==="setter"&&((n=Object.create(n)).wrapped=!0),r.set(e.name,n),s==="accessor"){const{name:o}=e;return{set(a){const l=t.get.call(this);t.set.call(this,a),this.requestUpdate(o,l,n)},init(a){return a!==void 0&&this.C(o,void 0,n,a),a}}}if(s==="setter"){const{name:o}=e;return function(a){const l=this[o];t.call(this,a),this.requestUpdate(o,l,n)}}throw Error("Unsupported decorator location: "+s)};function mt(n){return(t,e)=>typeof e=="object"?LH(n,t,e):((s,i,r)=>{const o=i.hasOwnProperty(r);return i.constructor.createProperty(r,s),o?Object.getOwnPropertyDescriptor(i,r):void 0})(n,t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function dh(n){return mt({...n,state:!0,attribute:!1})}/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const $H=n=>n.strings===void 0;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const LO={ATTRIBUTE:1,CHILD:2},$O=n=>(...t)=>({_$litDirective$:n,values:t});let NO=class{constructor(n){}get _$AU(){return this._$AM._$AU}_$AT(n,t,e){this._$Ct=n,this._$AM=t,this._$Ci=e}_$AS(n,t){return this.update(n,t)}update(n,t){return this.render(...t)}};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ed=(n,t)=>{var e;const s=n._$AN;if(s===void 0)return!1;for(const i of s)(e=i._$AO)==null||e.call(i,t,!1),ed(i,t);return!0},ag=n=>{let t,e;do{if((t=n._$AM)===void 0)break;e=t._$AN,e.delete(n),n=t}while(e?.size===0)},MO=n=>{for(let t;t=n._$AM;n=t){let e=t._$AN;if(e===void 0)t._$AN=e=new Set;else if(e.has(n))break;e.add(n),DH(t)}};function NH(n){this._$AN!==void 0?(ag(this),this._$AM=n,MO(this)):this._$AM=n}function MH(n,t=!1,e=0){const s=this._$AH,i=this._$AN;if(i!==void 0&&i.size!==0)if(t)if(Array.isArray(s))for(let r=e;r<s.length;r++)ed(s[r],!1),ag(s[r]);else s!=null&&(ed(s,!1),ag(s));else ed(this,n)}const DH=n=>{n.type==LO.CHILD&&(n._$AP??(n._$AP=MH),n._$AQ??(n._$AQ=NH))};class kH extends NO{constructor(){super(...arguments),this._$AN=void 0}_$AT(t,e,s){super._$AT(t,e,s),MO(this),this.isConnected=t._$AU}_$AO(t,e=!0){var s,i;t!==this.isConnected&&(this.isConnected=t,t?(s=this.reconnected)==null||s.call(this):(i=this.disconnected)==null||i.call(this)),e&&(ed(this,t),ag(this))}setValue(t){if($H(this._$Ct))this._$Ct._$AI(t,this);else{const e=[...this._$Ct._$AH];e[this._$Ci]=t,this._$Ct._$AI(e,this,0)}}disconnected(){}reconnected(){}}/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const qc=()=>new zH;class zH{}const j_=new WeakMap,oi=$O(class extends kH{render(n){return Xe}update(n,[t]){var e;const s=t!==this.G;return s&&this.G!==void 0&&this.rt(void 0),(s||this.lt!==this.ct)&&(this.G=t,this.ht=(e=n.options)==null?void 0:e.host,this.rt(this.ct=n.element)),Xe}rt(n){if(this.isConnected||(n=void 0),typeof this.G=="function"){const t=this.ht??globalThis;let e=j_.get(t);e===void 0&&(e=new WeakMap,j_.set(t,e)),e.get(this.G)!==void 0&&this.G.call(this.ht,void 0),e.set(this.G,n),n!==void 0&&this.G.call(this.ht,n)}else this.G.value=n}get lt(){var n,t;return typeof this.G=="function"?(n=j_.get(this.ht??globalThis))==null?void 0:n.get(this.G):(t=this.G)==null?void 0:t.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}});/**
* (c) Iconify
*
* For the full copyright and license information, please view the license.txt
* files at https://github.com/iconify/iconify
*
* Licensed under MIT.
*
* @license MIT
* @version 2.0.0
*/const DO=Object.freeze({left:0,top:0,width:16,height:16}),lg=Object.freeze({rotate:0,vFlip:!1,hFlip:!1}),np=Object.freeze({...DO,...lg}),Ry=Object.freeze({...np,body:"",hidden:!1}),BH=Object.freeze({width:null,height:null}),kO=Object.freeze({...BH,...lg});function UH(n,t=0){const e=n.replace(/^-?[0-9.]*/,"");function s(i){for(;i<0;)i+=4;return i%4}if(e===""){const i=parseInt(n);return isNaN(i)?0:s(i)}else if(e!==n){let i=0;switch(e){case"%":i=25;break;case"deg":i=90}if(i){let r=parseFloat(n.slice(0,n.length-e.length));return isNaN(r)?0:(r=r/i,r%1===0?s(r):0)}}return t}const VH=/[\s,]+/;function HH(n,t){t.split(VH).forEach(e=>{switch(e.trim()){case"horizontal":n.hFlip=!0;break;case"vertical":n.vFlip=!0;break}})}const zO={...kO,preserveAspectRatio:""};function kI(n){const t={...zO},e=(s,i)=>n.getAttribute(s)||i;return t.width=e("width",null),t.height=e("height",null),t.rotate=UH(e("rotate","")),HH(t,e("flip","")),t.preserveAspectRatio=e("preserveAspectRatio",e("preserveaspectratio","")),t}function jH(n,t){for(const e in zO)if(n[e]!==t[e])return!0;return!1}const sd=/^[a-z0-9]+(-[a-z0-9]+)*$/,rp=(n,t,e,s="")=>{const i=n.split(":");if(n.slice(0,1)==="@"){if(i.length<2||i.length>3)return null;s=i.shift().slice(1)}if(i.length>3||!i.length)return null;if(i.length>1){const a=i.pop(),l=i.pop(),c={provider:i.length>0?i[0]:s,prefix:l,name:a};return t&&!vm(c)?null:c}const r=i[0],o=r.split("-");if(o.length>1){const a={provider:s,prefix:o.shift(),name:o.join("-")};return t&&!vm(a)?null:a}if(e&&s===""){const a={provider:s,prefix:"",name:r};return t&&!vm(a,e)?null:a}return null},vm=(n,t)=>n?!!((n.provider===""||n.provider.match(sd))&&(t&&n.prefix===""||n.prefix.match(sd))&&n.name.match(sd)):!1;function WH(n,t){const e={};!n.hFlip!=!t.hFlip&&(e.hFlip=!0),!n.vFlip!=!t.vFlip&&(e.vFlip=!0);const s=((n.rotate||0)+(t.rotate||0))%4;return s&&(e.rotate=s),e}function zI(n,t){const e=WH(n,t);for(const s in Ry)s in lg?s in n&&!(s in e)&&(e[s]=lg[s]):s in t?e[s]=t[s]:s in n&&(e[s]=n[s]);return e}function YH(n,t){const e=n.icons,s=n.aliases||Object.create(null),i=Object.create(null);function r(o){if(e[o])return i[o]=[];if(!(o in i)){i[o]=null;const a=s[o]&&s[o].parent,l=a&&r(a);l&&(i[o]=[a].concat(l))}return i[o]}return Object.keys(e).concat(Object.keys(s)).forEach(r),i}function GH(n,t,e){const s=n.icons,i=n.aliases||Object.create(null);let r={};function o(a){r=zI(s[a]||i[a],r)}return o(t),e.forEach(o),zI(n,r)}function BO(n,t){const e=[];if(typeof n!="object"||typeof n.icons!="object")return e;n.not_found instanceof Array&&n.not_found.forEach(i=>{t(i,null),e.push(i)});const s=YH(n);for(const i in s){const r=s[i];r&&(t(i,GH(n,i,r)),e.push(i))}return e}const qH={provider:"",aliases:{},not_found:{},...DO};function W_(n,t){for(const e in t)if(e in n&&typeof n[e]!=typeof t[e])return!1;return!0}function UO(n){if(typeof n!="object"||n===null)return null;const t=n;if(typeof t.prefix!="string"||!n.icons||typeof n.icons!="object"||!W_(n,qH))return null;const e=t.icons;for(const i in e){const r=e[i];if(!i.match(sd)||typeof r.body!="string"||!W_(r,Ry))return null}const s=t.aliases||Object.create(null);for(const i in s){const r=s[i],o=r.parent;if(!i.match(sd)||typeof o!="string"||!e[o]&&!s[o]||!W_(r,Ry))return null}return t}const cg=Object.create(null);function ZH(n,t){return{provider:n,prefix:t,icons:Object.create(null),missing:new Set}}function Go(n,t){const e=cg[n]||(cg[n]=Object.create(null));return e[t]||(e[t]=ZH(n,t))}function aw(n,t){return UO(t)?BO(t,(e,s)=>{s?n.icons[e]=s:n.missing.add(e)}):[]}function XH(n,t,e){try{if(typeof e.body=="string")return n.icons[t]={...e},!0}catch{}return!1}function QH(n,t){let e=[];return(typeof n=="string"?[n]:Object.keys(cg)).forEach(s=>{(typeof s=="string"&&typeof t=="string"?[t]:Object.keys(cg[s]||{})).forEach(i=>{const r=Go(s,i);e=e.concat(Object.keys(r.icons).map(o=>(s!==""?"@"+s+":":"")+i+":"+o))})}),e}let Rd=!1;function VO(n){return typeof n=="boolean"&&(Rd=n),Rd}function Fd(n){const t=typeof n=="string"?rp(n,!0,Rd):n;if(t){const e=Go(t.provider,t.prefix),s=t.name;return e.icons[s]||(e.missing.has(s)?null:void 0)}}function HO(n,t){const e=rp(n,!0,Rd);if(!e)return!1;const s=Go(e.provider,e.prefix);return XH(s,e.name,t)}function BI(n,t){if(typeof n!="object")return!1;if(typeof t!="string"&&(t=n.provider||""),Rd&&!t&&!n.prefix){let i=!1;return UO(n)&&(n.prefix="",BO(n,(r,o)=>{o&&HO(r,o)&&(i=!0)})),i}const e=n.prefix;if(!vm({provider:t,prefix:e,name:"a"}))return!1;const s=Go(t,e);return!!aw(s,n)}function UI(n){return!!Fd(n)}function KH(n){const t=Fd(n);return t?{...np,...t}:null}function JH(n){const t={loaded:[],missing:[],pending:[]},e=Object.create(null);n.sort((i,r)=>i.provider!==r.provider?i.provider.localeCompare(r.provider):i.prefix!==r.prefix?i.prefix.localeCompare(r.prefix):i.name.localeCompare(r.name));let s={provider:"",prefix:"",name:""};return n.forEach(i=>{if(s.name===i.name&&s.prefix===i.prefix&&s.provider===i.provider)return;s=i;const r=i.provider,o=i.prefix,a=i.name,l=e[r]||(e[r]=Object.create(null)),c=l[o]||(l[o]=Go(r,o));let h;a in c.icons?h=t.loaded:o===""||c.missing.has(a)?h=t.missing:h=t.pending;const u={provider:r,prefix:o,name:a};h.push(u)}),t}function jO(n,t){n.forEach(e=>{const s=e.loaderCallbacks;s&&(e.loaderCallbacks=s.filter(i=>i.id!==t))})}function tj(n){n.pendingCallbacksFlag||(n.pendingCallbacksFlag=!0,setTimeout(()=>{n.pendingCallbacksFlag=!1;const t=n.loaderCallbacks?n.loaderCallbacks.slice(0):[];if(!t.length)return;let e=!1;const s=n.provider,i=n.prefix;t.forEach(r=>{const o=r.icons,a=o.pending.length;o.pending=o.pending.filter(l=>{if(l.prefix!==i)return!0;const c=l.name;if(n.icons[c])o.loaded.push({provider:s,prefix:i,name:c});else if(n.missing.has(c))o.missing.push({provider:s,prefix:i,name:c});else return e=!0,!0;return!1}),o.pending.length!==a&&(e||jO([n],r.id),r.callback(o.loaded.slice(0),o.missing.slice(0),o.pending.slice(0),r.abort))})}))}let ej=0;function sj(n,t,e){const s=ej++,i=jO.bind(null,e,s);if(!t.pending.length)return i;const r={id:s,icons:t,callback:n,abort:i};return e.forEach(o=>{(o.loaderCallbacks||(o.loaderCallbacks=[])).push(r)}),i}const Fy=Object.create(null);function VI(n,t){Fy[n]=t}function Ly(n){return Fy[n]||Fy[""]}function ij(n,t=!0,e=!1){const s=[];return n.forEach(i=>{const r=typeof i=="string"?rp(i,t,e):i;r&&s.push(r)}),s}var nj={resources:[],index:0,timeout:2e3,rotate:750,random:!1,dataAfterTimeout:!1};function rj(n,t,e,s){const i=n.resources.length,r=n.random?Math.floor(Math.random()*i):n.index;let o;if(n.random){let I=n.resources.slice(0);for(o=[];I.length>1;){const C=Math.floor(Math.random()*I.length);o.push(I[C]),I=I.slice(0,C).concat(I.slice(C+1))}o=o.concat(I)}else o=n.resources.slice(r).concat(n.resources.slice(0,r));const a=Date.now();let l="pending",c=0,h,u=null,p=[],d=[];typeof s=="function"&&d.push(s);function g(){u&&(clearTimeout(u),u=null)}function m(){l==="pending"&&(l="aborted"),g(),p.forEach(I=>{I.status==="pending"&&(I.status="aborted")}),p=[]}function b(I,C){C&&(d=[]),typeof I=="function"&&d.push(I)}function f(){return{startTime:a,payload:t,status:l,queriesSent:c,queriesPending:p.length,subscribe:b,abort:m}}function _(){l="failed",d.forEach(I=>{I(void 0,h)})}function y(){p.forEach(I=>{I.status==="pending"&&(I.status="aborted")}),p=[]}function v(I,C,A){const S=C!=="success";switch(p=p.filter(P=>P!==I),l){case"pending":break;case"failed":if(S||!n.dataAfterTimeout)return;break;default:return}if(C==="abort"){h=A,_();return}if(S){h=A,p.length||(o.length?w():_());return}if(g(),y(),!n.random){const P=n.resources.indexOf(I.resource);P!==-1&&P!==n.index&&(n.index=P)}l="completed",d.forEach(P=>{P(A)})}function w(){if(l!=="pending")return;g();const I=o.shift();if(I===void 0){if(p.length){u=setTimeout(()=>{g(),l==="pending"&&(y(),_())},n.timeout);return}_();return}const C={status:"pending",resource:I,callback:(A,S)=>{v(C,A,S)}};p.push(C),c++,u=setTimeout(w,n.rotate),e(I,t,C.callback)}return setTimeout(w),f}function WO(n){const t={...nj,...n};let e=[];function s(){e=e.filter(o=>o().status==="pending")}function i(o,a,l){const c=rj(t,o,a,(h,u)=>{s(),l&&l(h,u)});return e.push(c),c}function r(o){return e.find(a=>o(a))||null}return{query:i,find:r,setIndex:o=>{t.index=o},getIndex:()=>t.index,cleanup:s}}function lw(n){let t;if(typeof n.resources=="string")t=[n.resources];else if(t=n.resources,!(t instanceof Array)||!t.length)return null;return{resources:t,path:n.path||"/",maxURL:n.maxURL||500,rotate:n.rotate||750,timeout:n.timeout||5e3,random:n.random===!0,index:n.index||0,dataAfterTimeout:n.dataAfterTimeout!==!1}}const Jg=Object.create(null),jf=["https://api.simplesvg.com","https://api.unisvg.com"],$y=[];for(;jf.length>0;)jf.length===1||Math.random()>.5?$y.push(jf.shift()):$y.push(jf.pop());Jg[""]=lw({resources:["https://api.iconify.design"].concat($y)});function HI(n,t){const e=lw(t);return e===null?!1:(Jg[n]=e,!0)}function tb(n){return Jg[n]}function oj(){return Object.keys(Jg)}function jI(){}const Y_=Object.create(null);function aj(n){if(!Y_[n]){const t=tb(n);if(!t)return;const e=WO(t),s={config:t,redundancy:e};Y_[n]=s}return Y_[n]}function YO(n,t,e){let s,i;if(typeof n=="string"){const r=Ly(n);if(!r)return e(void 0,424),jI;i=r.send;const o=aj(n);o&&(s=o.redundancy)}else{const r=lw(n);if(r){s=WO(r);const o=n.resources?n.resources[0]:"",a=Ly(o);a&&(i=a.send)}}return!s||!i?(e(void 0,424),jI):s.query(t,i,e)().abort}const WI="iconify2",Ld="iconify",GO=Ld+"-count",YI=Ld+"-version",qO=36e5,lj=168,cj=50;function Ny(n,t){try{return n.getItem(t)}catch{}}function cw(n,t,e){try{return n.setItem(t,e),!0}catch{}}function GI(n,t){try{n.removeItem(t)}catch{}}function My(n,t){return cw(n,GO,t.toString())}function Dy(n){return parseInt(Ny(n,GO))||0}const Va={local:!0,session:!0},ZO={local:new Set,session:new Set};let hw=!1;function hj(n){hw=n}let Wf=typeof window>"u"?{}:window;function XO(n){const t=n+"Storage";try{if(Wf&&Wf[t]&&typeof Wf[t].length=="number")return Wf[t]}catch{}Va[n]=!1}function QO(n,t){const e=XO(n);if(!e)return;const s=Ny(e,YI);if(s!==WI){if(s){const a=Dy(e);for(let l=0;l<a;l++)GI(e,Ld+l.toString())}cw(e,YI,WI),My(e,0);return}const i=Math.floor(Date.now()/qO)-lj,r=a=>{const l=Ld+a.toString(),c=Ny(e,l);if(typeof c=="string"){try{const h=JSON.parse(c);if(typeof h=="object"&&typeof h.cached=="number"&&h.cached>i&&typeof h.provider=="string"&&typeof h.data=="object"&&typeof h.data.prefix=="string"&&t(h,a))return!0}catch{}GI(e,l)}};let o=Dy(e);for(let a=o-1;a>=0;a--)r(a)||(a===o-1?(o--,My(e,o)):ZO[n].add(a))}function KO(){if(!hw){hj(!0);for(const n in Va)QO(n,t=>{const e=t.data,s=t.provider,i=e.prefix,r=Go(s,i);if(!aw(r,e).length)return!1;const o=e.lastModified||-1;return r.lastModifiedCached=r.lastModifiedCached?Math.min(r.lastModifiedCached,o):o,!0})}}function uj(n,t){const e=n.lastModifiedCached;if(e&&e>=t)return e===t;if(n.lastModifiedCached=t,e)for(const s in Va)QO(s,i=>{const r=i.data;return i.provider!==n.provider||r.prefix!==n.prefix||r.lastModified===t});return!0}function dj(n,t){hw||KO();function e(s){let i;if(!Va[s]||!(i=XO(s)))return;const r=ZO[s];let o;if(r.size)r.delete(o=Array.from(r).shift());else if(o=Dy(i),o>=cj||!My(i,o+1))return;const a={cached:Math.floor(Date.now()/qO),provider:n.provider,data:t};return cw(i,Ld+o.toString(),JSON.stringify(a))}t.lastModified&&!uj(n,t.lastModified)||Object.keys(t.icons).length&&(t.not_found&&(t=Object.assign({},t),delete t.not_found),e("local")||e("session"))}function qI(){}function pj(n){n.iconsLoaderFlag||(n.iconsLoaderFlag=!0,setTimeout(()=>{n.iconsLoaderFlag=!1,tj(n)}))}function fj(n,t){n.iconsToLoad?n.iconsToLoad=n.iconsToLoad.concat(t).sort():n.iconsToLoad=t,n.iconsQueueFlag||(n.iconsQueueFlag=!0,setTimeout(()=>{n.iconsQueueFlag=!1;const{provider:e,prefix:s}=n,i=n.iconsToLoad;delete n.iconsToLoad;let r;!i||!(r=Ly(e))||r.prepare(e,s,i).forEach(o=>{YO(e,o,a=>{if(typeof a!="object")o.icons.forEach(l=>{n.missing.add(l)});else try{const l=aw(n,a);if(!l.length)return;const c=n.pendingIcons;c&&l.forEach(h=>{c.delete(h)}),dj(n,a)}catch(l){console.error(l)}pj(n)})})}))}const uw=(n,t)=>{const e=ij(n,!0,VO()),s=JH(e);if(!s.pending.length){let l=!0;return t&&setTimeout(()=>{l&&t(s.loaded,s.missing,s.pending,qI)}),()=>{l=!1}}const i=Object.create(null),r=[];let o,a;return s.pending.forEach(l=>{const{provider:c,prefix:h}=l;if(h===a&&c===o)return;o=c,a=h,r.push(Go(c,h));const u=i[c]||(i[c]=Object.create(null));u[h]||(u[h]=[])}),s.pending.forEach(l=>{const{provider:c,prefix:h,name:u}=l,p=Go(c,h),d=p.pendingIcons||(p.pendingIcons=new Set);d.has(u)||(d.add(u),i[c][h].push(u))}),r.forEach(l=>{const{provider:c,prefix:h}=l;i[c][h].length&&fj(l,i[c][h])}),t?sj(t,s,r):qI},mj=n=>new Promise((t,e)=>{const s=typeof n=="string"?rp(n,!0):n;if(!s){e(n);return}uw([s||n],i=>{if(i.length&&s){const r=Fd(s);if(r){t({...np,...r});return}}e(n)})});function gj(n){try{const t=typeof n=="string"?JSON.parse(n):n;if(typeof t.body=="string")return{...t}}catch{}}function bj(n,t){const e=typeof n=="string"?rp(n,!0,!0):null;if(!e){const r=gj(n);return{value:n,data:r}}const s=Fd(e);if(s!==void 0||!e.prefix)return{value:n,name:e,data:s};const i=uw([e],()=>t(n,e,Fd(e)));return{value:n,name:e,loading:i}}function G_(n){return n.hasAttribute("inline")}let JO=!1;try{JO=navigator.vendor.indexOf("Apple")===0}catch{}function _j(n,t){switch(t){case"svg":case"bg":case"mask":return t}return t!=="style"&&(JO||n.indexOf("<a")===-1)?"svg":n.indexOf("currentColor")===-1?"bg":"mask"}const yj=/(-?[0-9.]*[0-9]+[0-9.]*)/g,vj=/^-?[0-9.]*[0-9]+[0-9.]*$/g;function ky(n,t,e){if(t===1)return n;if(e=e||100,typeof n=="number")return Math.ceil(n*t*e)/e;if(typeof n!="string")return n;const s=n.split(yj);if(s===null||!s.length)return n;const i=[];let r=s.shift(),o=vj.test(r);for(;;){if(o){const a=parseFloat(r);isNaN(a)?i.push(r):i.push(Math.ceil(a*t*e)/e)}else i.push(r);if(r=s.shift(),r===void 0)return i.join("");o=!o}}function wj(n,t="defs"){let e="";const s=n.indexOf("<"+t);for(;s>=0;){const i=n.indexOf(">",s),r=n.indexOf("</"+t);if(i===-1||r===-1)break;const o=n.indexOf(">",r);if(o===-1)break;e+=n.slice(i+1,r).trim(),n=n.slice(0,s).trim()+n.slice(o+1)}return{defs:e,content:n}}function Ej(n,t){return n?"<defs>"+n+"</defs>"+t:t}function xj(n,t,e){const s=wj(n);return Ej(s.defs,t+s.content+e)}const Ij=n=>n==="unset"||n==="undefined"||n==="none";function tP(n,t){const e={...np,...n},s={...kO,...t},i={left:e.left,top:e.top,width:e.width,height:e.height};let r=e.body;[e,s].forEach(m=>{const b=[],f=m.hFlip,_=m.vFlip;let y=m.rotate;f?_?y+=2:(b.push("translate("+(i.width+i.left).toString()+" "+(0-i.top).toString()+")"),b.push("scale(-1 1)"),i.top=i.left=0):_&&(b.push("translate("+(0-i.left).toString()+" "+(i.height+i.top).toString()+")"),b.push("scale(1 -1)"),i.top=i.left=0);let v;switch(y<0&&(y-=Math.floor(y/4)*4),y=y%4,y){case 1:v=i.height/2+i.top,b.unshift("rotate(90 "+v.toString()+" "+v.toString()+")");break;case 2:b.unshift("rotate(180 "+(i.width/2+i.left).toString()+" "+(i.height/2+i.top).toString()+")");break;case 3:v=i.width/2+i.left,b.unshift("rotate(-90 "+v.toString()+" "+v.toString()+")");break}y%2===1&&(i.left!==i.top&&(v=i.left,i.left=i.top,i.top=v),i.width!==i.height&&(v=i.width,i.width=i.height,i.height=v)),b.length&&(r=xj(r,'<g transform="'+b.join(" ")+'">',"</g>"))});const o=s.width,a=s.height,l=i.width,c=i.height;let h,u;o===null?(u=a===null?"1em":a==="auto"?c:a,h=ky(u,l/c)):(h=o==="auto"?l:o,u=a===null?ky(h,c/l):a==="auto"?c:a);const p={},d=(m,b)=>{Ij(b)||(p[m]=b.toString())};d("width",h),d("height",u);const g=[i.left,i.top,l,c];return p.viewBox=g.join(" "),{attributes:p,viewBox:g,body:r}}function dw(n,t){let e=n.indexOf("xlink:")===-1?"":' xmlns:xlink="http://www.w3.org/1999/xlink"';for(const s in t)e+=" "+s+'="'+t[s]+'"';return'<svg xmlns="http://www.w3.org/2000/svg"'+e+">"+n+"</svg>"}function Cj(n){return n.replace(/"/g,"'").replace(/%/g,"%25").replace(/#/g,"%23").replace(/</g,"%3C").replace(/>/g,"%3E").replace(/\s+/g," ")}function Tj(n){return"data:image/svg+xml,"+Cj(n)}function eP(n){return'url("'+Tj(n)+'")'}const Aj=()=>{let n;try{if(n=fetch,typeof n=="function")return n}catch{}};let hg=Aj();function Sj(n){hg=n}function Oj(){return hg}function Pj(n,t){const e=tb(n);if(!e)return 0;let s;if(!e.maxURL)s=0;else{let i=0;e.resources.forEach(o=>{i=Math.max(i,o.length)});const r=t+".json?icons=";s=e.maxURL-i-e.path.length-r.length}return s}function Rj(n){return n===404}const Fj=(n,t,e)=>{const s=[],i=Pj(n,t),r="icons";let o={type:r,provider:n,prefix:t,icons:[]},a=0;return e.forEach((l,c)=>{a+=l.length+1,a>=i&&c>0&&(s.push(o),o={type:r,provider:n,prefix:t,icons:[]},a=l.length),o.icons.push(l)}),s.push(o),s};function Lj(n){if(typeof n=="string"){const t=tb(n);if(t)return t.path}return"/"}const $j=(n,t,e)=>{if(!hg){e("abort",424);return}let s=Lj(t.provider);switch(t.type){case"icons":{const r=t.prefix,o=t.icons.join(","),a=new URLSearchParams({icons:o});s+=r+".json?"+a.toString();break}case"custom":{const r=t.uri;s+=r.slice(0,1)==="/"?r.slice(1):r;break}default:e("abort",400);return}let i=503;hg(n+s).then(r=>{const o=r.status;if(o!==200){setTimeout(()=>{e(Rj(o)?"abort":"next",o)});return}return i=501,r.json()}).then(r=>{if(typeof r!="object"||r===null){setTimeout(()=>{r===404?e("abort",r):e("next",i)});return}setTimeout(()=>{e("success",r)})}).catch(()=>{e("next",i)})},Nj={prepare:Fj,send:$j};function ZI(n,t){switch(n){case"local":case"session":Va[n]=t;break;case"all":for(const e in Va)Va[e]=t;break}}const q_="data-style";let sP="";function Mj(n){sP=n}function XI(n,t){let e=Array.from(n.childNodes).find(s=>s.hasAttribute&&s.hasAttribute(q_));e||(e=document.createElement("style"),e.setAttribute(q_,q_),n.appendChild(e)),e.textContent=":host{display:inline-block;vertical-align:"+(t?"-0.125em":"0")+"}span,svg{display:block}"+sP}function iP(){VI("",Nj),VO(!0);let n;try{n=window}catch{}if(n){if(KO(),n.IconifyPreload!==void 0){const t=n.IconifyPreload,e="Invalid IconifyPreload syntax.";typeof t=="object"&&t!==null&&(t instanceof Array?t:[t]).forEach(s=>{try{(typeof s!="object"||s===null||s instanceof Array||typeof s.icons!="object"||typeof s.prefix!="string"||!BI(s))&&console.error(e)}catch{console.error(e)}})}if(n.IconifyProviders!==void 0){const t=n.IconifyProviders;if(typeof t=="object"&&t!==null)for(const e in t){const s="IconifyProviders["+e+"] is invalid.";try{const i=t[e];if(typeof i!="object"||!i||i.resources===void 0)continue;HI(e,i)||console.error(s)}catch{console.error(s)}}}}return{enableCache:t=>ZI(t,!0),disableCache:t=>ZI(t,!1),iconLoaded:UI,iconExists:UI,getIcon:KH,listIcons:QH,addIcon:HO,addCollection:BI,calculateSize:ky,buildIcon:tP,iconToHTML:dw,svgToURL:eP,loadIcons:uw,loadIcon:mj,addAPIProvider:HI,appendCustomStyle:Mj,_api:{getAPIConfig:tb,setAPIModule:VI,sendAPIQuery:YO,setFetch:Sj,getFetch:Oj,listAPIProviders:oj}}}const zy={"background-color":"currentColor"},nP={"background-color":"transparent"},QI={image:"var(--svg)",repeat:"no-repeat",size:"100% 100%"},KI={"-webkit-mask":zy,mask:zy,background:nP};for(const n in KI){const t=KI[n];for(const e in QI)t[n+"-"+e]=QI[e]}function JI(n){return n?n+(n.match(/^[-0-9.]+$/)?"px":""):"inherit"}function Dj(n,t,e){const s=document.createElement("span");let i=n.body;i.indexOf("<a")!==-1&&(i+="<!-- "+Date.now()+" -->");const r=n.attributes,o=dw(i,{...r,width:t.width+"",height:t.height+""}),a=eP(o),l=s.style,c={"--svg":a,width:JI(r.width),height:JI(r.height),...e?zy:nP};for(const h in c)l.setProperty(h,c[h]);return s}let id;function kj(){try{id=window.trustedTypes.createPolicy("iconify",{createHTML:n=>n})}catch{id=null}}function zj(n){return id===void 0&&kj(),id?id.createHTML(n):n}function Bj(n){const t=document.createElement("span"),e=n.attributes;let s="";e.width||(s="width: inherit;"),e.height||(s+="height: inherit;"),s&&(e.style=s);const i=dw(n.body,e);return t.innerHTML=zj(i),t.firstChild}function By(n){return Array.from(n.childNodes).find(t=>{const e=t.tagName&&t.tagName.toUpperCase();return e==="SPAN"||e==="SVG"})}function tC(n,t){const e=t.icon.data,s=t.customisations,i=tP(e,s);s.preserveAspectRatio&&(i.attributes.preserveAspectRatio=s.preserveAspectRatio);const r=t.renderedMode;let o;switch(r){case"svg":o=Bj(i);break;default:o=Dj(i,{...np,...e},r==="mask")}const a=By(n);a?o.tagName==="SPAN"&&a.tagName===o.tagName?a.setAttribute("style",o.getAttribute("style")):n.replaceChild(o,a):n.appendChild(o)}function eC(n,t,e){const s=e&&(e.rendered?e:e.lastRender);return{rendered:!1,inline:t,icon:n,lastRender:s}}function Uj(n="iconify-icon"){let t,e;try{t=window.customElements,e=window.HTMLElement}catch{return}if(!t||!e)return;const s=t.get(n);if(s)return s;const i=["icon","mode","inline","observe","width","height","rotate","flip"],r=class extends e{constructor(){super(),fa(this,"_shadowRoot"),fa(this,"_initialised",!1),fa(this,"_state"),fa(this,"_checkQueued",!1),fa(this,"_connected",!1),fa(this,"_observer",null),fa(this,"_visible",!0);const a=this._shadowRoot=this.attachShadow({mode:"open"}),l=G_(this);XI(a,l),this._state=eC({value:""},l),this._queueCheck()}connectedCallback(){this._connected=!0,this.startObserver()}disconnectedCallback(){this._connected=!1,this.stopObserver()}static get observedAttributes(){return i.slice(0)}attributeChangedCallback(a){switch(a){case"inline":{const l=G_(this),c=this._state;l!==c.inline&&(c.inline=l,XI(this._shadowRoot,l));break}case"observer":{this.observer?this.startObserver():this.stopObserver();break}default:this._queueCheck()}}get icon(){const a=this.getAttribute("icon");if(a&&a.slice(0,1)==="{")try{return JSON.parse(a)}catch{}return a}set icon(a){typeof a=="object"&&(a=JSON.stringify(a)),this.setAttribute("icon",a)}get inline(){return G_(this)}set inline(a){a?this.setAttribute("inline","true"):this.removeAttribute("inline")}get observer(){return this.hasAttribute("observer")}set observer(a){a?this.setAttribute("observer","true"):this.removeAttribute("observer")}restartAnimation(){const a=this._state;if(a.rendered){const l=this._shadowRoot;if(a.renderedMode==="svg")try{l.lastChild.setCurrentTime(0);return}catch{}tC(l,a)}}get status(){const a=this._state;return a.rendered?"rendered":a.icon.data===null?"failed":"loading"}_queueCheck(){this._checkQueued||(this._checkQueued=!0,setTimeout(()=>{this._check()}))}_check(){if(!this._checkQueued)return;this._checkQueued=!1;const a=this._state,l=this.getAttribute("icon");if(l!==a.icon.value){this._iconChanged(l);return}if(!a.rendered||!this._visible)return;const c=this.getAttribute("mode"),h=kI(this);(a.attrMode!==c||jH(a.customisations,h)||!By(this._shadowRoot))&&this._renderIcon(a.icon,h,c)}_iconChanged(a){const l=bj(a,(c,h,u)=>{const p=this._state;if(p.rendered||this.getAttribute("icon")!==c)return;const d={value:c,name:h,data:u};d.data?this._gotIconData(d):p.icon=d});l.data?this._gotIconData(l):this._state=eC(l,this._state.inline,this._state)}_forceRender(){if(!this._visible){const a=By(this._shadowRoot);a&&this._shadowRoot.removeChild(a);return}this._queueCheck()}_gotIconData(a){this._checkQueued=!1,this._renderIcon(a,kI(this),this.getAttribute("mode"))}_renderIcon(a,l,c){const h=_j(a.data.body,c),u=this._state.inline;tC(this._shadowRoot,this._state={rendered:!0,icon:a,inline:u,customisations:l,attrMode:c,renderedMode:h})}startObserver(){if(!this._observer)try{this._observer=new IntersectionObserver(a=>{const l=a.some(c=>c.isIntersecting);l!==this._visible&&(this._visible=l,this._forceRender())}),this._observer.observe(this)}catch{if(this._observer){try{this._observer.disconnect()}catch{}this._observer=null}}}stopObserver(){this._observer&&(this._observer.disconnect(),this._observer=null,this._visible=!0,this._connected&&this._forceRender())}};i.forEach(a=>{a in r.prototype||Object.defineProperty(r.prototype,a,{get:function(){return this.getAttribute(a)},set:function(l){l!==null?this.setAttribute(a,l):this.removeAttribute(a)}})});const o=iP();for(const a in o)r[a]=r.prototype[a]=o[a];return t.define(n,r),r}const Vj=Uj()||iP(),{enableCache:ZX,disableCache:XX,iconLoaded:QX,iconExists:KX,getIcon:JX,listIcons:tQ,addIcon:eQ,addCollection:sQ,calculateSize:iQ,buildIcon:nQ,iconToHTML:rQ,svgToURL:oQ,loadIcons:aQ,loadIcon:lQ,addAPIProvider:cQ,_api:hQ}=Vj,Hj=he`
  ::-webkit-scrollbar {
    width: 0.4rem;
    height: 0.4rem;
    overflow: hidden;
  }

  ::-webkit-scrollbar-thumb {
    border-radius: 0.25rem;
    background-color: var(
      --bim-scrollbar--c,
      color-mix(in lab, var(--bim-ui_main-base), white 15%)
    );
  }

  ::-webkit-scrollbar-track {
    background-color: var(--bim-scrollbar--bgc, var(--bim-ui_bg-base));
  }
`,jj=he`
  :root {
    /* Grayscale Colors */
    --bim-ui_gray-0: hsl(210 10% 5%);
    --bim-ui_gray-1: hsl(210 10% 10%);
    --bim-ui_gray-2: hsl(210 10% 20%);
    --bim-ui_gray-3: hsl(210 10% 30%);
    --bim-ui_gray-4: hsl(210 10% 40%);
    --bim-ui_gray-6: hsl(210 10% 60%);
    --bim-ui_gray-7: hsl(210 10% 70%);
    --bim-ui_gray-8: hsl(210 10% 80%);
    --bim-ui_gray-9: hsl(210 10% 90%);
    --bim-ui_gray-10: hsl(210 10% 95%);

    /* Brand Colors */
    --bim-ui_main-base: #6528d7;
    --bim-ui_accent-base: #bcf124;

    /* Brand Colors Contrasts */
    --bim-ui_main-contrast: var(--bim-ui_gray-10);
    --bim-ui_accent-contrast: var(--bim-ui_gray-0);

    /* Sizes */
    --bim-ui_size-4xs: 0.375rem;
    --bim-ui_size-3xs: 0.5rem;
    --bim-ui_size-2xs: 0.625rem;
    --bim-ui_size-xs: 0.75rem;
    --bim-ui_size-sm: 0.875rem;
    --bim-ui_size-base: 1rem;
    --bim-ui_size-lg: 1.125rem;
    --bim-ui_size-xl: 1.25rem;
    --bim-ui_size-2xl: 1.375rem;
    --bim-ui_size-3xl: 1.5rem;
    --bim-ui_size-4xl: 1.625rem;
    --bim-ui_size-5xl: 1.75rem;
    --bim-ui_size-6xl: 1.875rem;
    --bim-ui_size-7xl: 2rem;
    --bim-ui_size-8xl: 2.125rem;
    --bim-ui_size-9xl: 2.25rem;
  }

  /* Background Colors */
  @media (prefers-color-scheme: dark) {
    :root {
      --bim-ui_bg-base: var(--bim-ui_gray-0);
      --bim-ui_bg-contrast-10: var(--bim-ui_gray-1);
      --bim-ui_bg-contrast-20: var(--bim-ui_gray-2);
      --bim-ui_bg-contrast-30: var(--bim-ui_gray-3);
      --bim-ui_bg-contrast-40: var(--bim-ui_gray-4);
      --bim-ui_bg-contrast-60: var(--bim-ui_gray-6);
      --bim-ui_bg-contrast-80: var(--bim-ui_gray-8);
      --bim-ui_bg-contrast-100: var(--bim-ui_gray-10);
    }
  }

  @media (prefers-color-scheme: light) {
    :root {
      --bim-ui_bg-base: var(--bim-ui_gray-10);
      --bim-ui_bg-contrast-10: var(--bim-ui_gray-9);
      --bim-ui_bg-contrast-20: var(--bim-ui_gray-8);
      --bim-ui_bg-contrast-30: var(--bim-ui_gray-7);
      --bim-ui_bg-contrast-40: var(--bim-ui_gray-6);
      --bim-ui_bg-contrast-60: var(--bim-ui_gray-4);
      --bim-ui_bg-contrast-80: var(--bim-ui_gray-2);
      --bim-ui_bg-contrast-100: var(--bim-ui_gray-0);
      --bim-ui_accent-base: #6528d7;
    }
  }

  .theme-transition-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    filter: drop-shadow(0 0 10px var(--bim-ui_bg-base));
    z-index: 9999;
  }

  .theme-transition-overlay > div {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: var(--bim-ui_bg-base);
  }

  html.bim-ui-dark {
    --bim-ui_bg-base: var(--bim-ui_gray-0);
    --bim-ui_bg-contrast-10: var(--bim-ui_gray-1);
    --bim-ui_bg-contrast-20: var(--bim-ui_gray-2);
    --bim-ui_bg-contrast-30: var(--bim-ui_gray-3);
    --bim-ui_bg-contrast-40: var(--bim-ui_gray-4);
    --bim-ui_bg-contrast-60: var(--bim-ui_gray-6);
    --bim-ui_bg-contrast-80: var(--bim-ui_gray-8);
    --bim-ui_bg-contrast-100: var(--bim-ui_gray-10);
  }

  html.bim-ui-light {
    --bim-ui_bg-base: var(--bim-ui_gray-10);
    --bim-ui_bg-contrast-10: var(--bim-ui_gray-9);
    --bim-ui_bg-contrast-20: var(--bim-ui_gray-8);
    --bim-ui_bg-contrast-30: var(--bim-ui_gray-7);
    --bim-ui_bg-contrast-40: var(--bim-ui_gray-6);
    --bim-ui_bg-contrast-60: var(--bim-ui_gray-4);
    --bim-ui_bg-contrast-80: var(--bim-ui_gray-2);
    --bim-ui_bg-contrast-100: var(--bim-ui_gray-0);
    --bim-ui_accent-base: #6528d7;
  }

  @keyframes toggleOverlay {
    0%,
    99% {
      display: block;
    }

    100% {
      display: none;
    }
  }

  @keyframes toggleThemeAnimation {
    0% {
      clip-path: circle(0% at center top);
    }
    45%,
    55% {
      clip-path: circle(150% at center center);
    }
    100% {
      clip-path: circle(0% at center bottom);
    }
  }

  [data-context-dialog]::backdrop {
    background-color: transparent;
  }
`,sa={scrollbar:Hj,globalStyles:jj},rP=class te{static set config(t){this._config={...te._config,...t}}static get config(){return te._config}static addGlobalStyles(){let t=document.querySelector("style[id='bim-ui']");if(t)return;t=document.createElement("style"),t.id="bim-ui",t.textContent=sa.globalStyles.cssText;const e=document.head.firstChild;e?document.head.insertBefore(t,e):document.head.append(t)}static defineCustomElement(t,e){customElements.get(t)||customElements.define(t,e)}static registerComponents(){te.init()}static init(t="",e=!0){te.addGlobalStyles(),te.defineCustomElement("bim-button",Xj),te.defineCustomElement("bim-checkbox",ph),te.defineCustomElement("bim-color-input",ia),te.defineCustomElement("bim-context-menu",ug),te.defineCustomElement("bim-dropdown",wr),te.defineCustomElement("bim-grid",fw),te.defineCustomElement("bim-icon",nW),te.defineCustomElement("bim-input",ap),te.defineCustomElement("bim-label",fh),te.defineCustomElement("bim-number-input",Li),te.defineCustomElement("bim-option",_s),te.defineCustomElement("bim-panel",al),te.defineCustomElement("bim-panel-section",mh),te.defineCustomElement("bim-selector",gh),te.defineCustomElement("bim-table",$i),te.defineCustomElement("bim-tabs",Gr),te.defineCustomElement("bim-tab",pi),te.defineCustomElement("bim-table-cell",vP),te.defineCustomElement("bim-table-children",bW),te.defineCustomElement("bim-table-group",xP),te.defineCustomElement("bim-table-row",bh),te.defineCustomElement("bim-text-input",li),te.defineCustomElement("bim-toolbar",ob),te.defineCustomElement("bim-toolbar-group",nb),te.defineCustomElement("bim-toolbar-section",yh),te.defineCustomElement("bim-viewport",$P),e&&this.animateOnLoad(t)}static newRandomId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let e="";for(let s=0;s<10;s++){const i=Math.floor(Math.random()*t.length);e+=t.charAt(i)}return e}static animateOnLoad(t=""){const e=`
      bim-input,
      bim-button,
      bim-checkbox,
      bim-selector,
      bim-label,
      bim-table-row,
      bim-panel-section,
      bim-table-children .branch-vertical,
      .switchers
    `,s=[];function i(r,o=document,a=new Set){const l=[];return Array.from(o.querySelectorAll(r)).forEach(c=>{a.has(c)||(a.add(c),l.push(c))}),Array.from(o.querySelectorAll("*")).filter(c=>c.shadowRoot).forEach(c=>{a.has(c)||(a.add(c),l.push(...i(r,c.shadowRoot,a)))}),l}requestAnimationFrame(()=>{i(t||e).forEach(o=>{const a=o;let l="auto";l=window.getComputedStyle(a).getPropertyValue("transition"),a.style.setProperty("opacity","0"),a.style.setProperty("transition","none"),requestAnimationFrame(()=>{a.style.setProperty("transition",l)}),s.push(a)});const r=()=>{s.forEach(o=>{const a=o,l=(a.getBoundingClientRect().x+a.getBoundingClientRect().y)/(window.innerWidth+window.innerHeight),c=window.getComputedStyle(a).getPropertyValue("transform"),h=400,u=200+l*1e3;a.animate([{transform:"translateY(-20px)",opacity:"0"},{transform:"translateY(0)",opacity:"1"}],{duration:h,easing:"ease-in-out",delay:u}),setTimeout(()=>{a.style.removeProperty("opacity"),c!=="none"?a.style.setProperty("transform",c):a.style.removeProperty("transform")},u+h)})};document.readyState==="complete"?r():window.addEventListener("load",r)})}static toggleTheme(t=!0){const e=document.querySelector("html");if(!e)return;const s=()=>{e.classList.contains("bim-ui-dark")?e.classList.replace("bim-ui-dark","bim-ui-light"):e.classList.contains("bim-ui-light")?e.classList.replace("bim-ui-light","bim-ui-dark"):e.classList.add("bim-ui-light")};if(t){const i=document.createElement("div");i.classList.add("theme-transition-overlay");const r=document.createElement("div");i.appendChild(r),r.style.setProperty("transition",`background-color ${1e3/3200}s`),document.body.appendChild(i),i.style.setProperty("animation",`toggleOverlay ${1e3/1e3}s ease-in forwards`),r.style.setProperty("animation",`toggleThemeAnimation ${1e3/1e3}s ease forwards`),setTimeout(()=>{s()},1e3/4),setTimeout(()=>{document.body.querySelectorAll(".theme-transition-overlay").forEach(o=>{document.body.removeChild(o)})},1e3)}else s()}};rP._config={sectionLabelOnVerticalToolbar:!1};let Bs=rP;class Rs extends ae{constructor(){super(...arguments),this._lazyLoadObserver=null,this._visibleElements=[],this.ELEMENTS_BEFORE_OBSERVER=20,this.useObserver=!1,this.elements=new Set,this.observe=t=>{if(!this.useObserver)return;for(const s of t)this.elements.add(s);const e=t.slice(this.ELEMENTS_BEFORE_OBSERVER);for(const s of e)s.remove();this.observeLastElement()}}set visibleElements(t){this._visibleElements=this.useObserver?t:[],this.requestUpdate()}get visibleElements(){return this._visibleElements}getLazyObserver(){if(!this.useObserver)return null;if(this._lazyLoadObserver)return this._lazyLoadObserver;const t=new IntersectionObserver(e=>{const s=e[0];if(!s.isIntersecting)return;const i=s.target;t.unobserve(i);const r=this.ELEMENTS_BEFORE_OBSERVER+this.visibleElements.length,o=[...this.elements][r];o&&(this.visibleElements=[...this.visibleElements,o],t.observe(o))},{threshold:.5});return t}observeLastElement(){const t=this.getLazyObserver();if(!t)return;const e=this.ELEMENTS_BEFORE_OBSERVER+this.visibleElements.length-1,s=[...this.elements][e];s&&t.observe(s)}resetVisibleElements(){const t=this.getLazyObserver();if(t){for(const e of this.elements)t.unobserve(e);this.visibleElements=[],this.observeLastElement()}}static create(t,e){const s=document.createDocumentFragment();if(t.length===0)return Gc(t(),s),s.firstElementChild;if(!e)throw new Error("UIComponent: Initial state is required for statefull components.");let i=e;const r=t,o=l=>(i={...i,...l},Gc(r(i,o),s),i);o(e);const a=()=>i;return[s.firstElementChild,o,a]}}const $d=(n,t={},e=!0)=>{let s={};for(const i of n.children){const r=i,o=r.getAttribute("name")||r.getAttribute("label"),a=o?t[o]:void 0;if(o){if("value"in r&&typeof r.value<"u"&&r.value!==null){const l=r.value;if(typeof l=="object"&&!Array.isArray(l)&&Object.keys(l).length===0)continue;s[o]=a?a(r.value):r.value}else if(e){const l=$d(r,t);if(Object.keys(l).length===0)continue;s[o]=a?a(l):l}}else e&&(s={...s,...$d(r,t)})}return s},eb=n=>n==="true"||n==="false"?n==="true":n&&!isNaN(Number(n))&&n.trim()!==""?Number(n):n,Wj=[">=","<=","=",">","<","?","/","#"];function sC(n){const t=Wj.find(o=>n.split(o).length===2),e=n.split(t).map(o=>o.trim()),[s,i]=e,r=i.startsWith("'")&&i.endsWith("'")?i.replace(/'/g,""):eb(i);return{key:s,condition:t,value:r}}const Uy=n=>{try{const t=[],e=n.split(/&(?![^()]*\))/).map(s=>s.trim());for(const s of e){const i=!s.startsWith("(")&&!s.endsWith(")"),r=s.startsWith("(")&&s.endsWith(")");if(i){const o=sC(s);t.push(o)}if(r){const o={operator:"&",queries:s.replace(/^(\()|(\))$/g,"").split("&").map(a=>a.trim()).map((a,l)=>{const c=sC(a);return l>0&&(c.operator="&"),c})};t.push(o)}}return t}catch{return null}},iC=(n,t,e)=>{let s=!1;switch(t){case"=":s=n===e;break;case"?":s=String(n).includes(String(e));break;case"<":(typeof n=="number"||typeof e=="number")&&(s=n<e);break;case"<=":(typeof n=="number"||typeof e=="number")&&(s=n<=e);break;case">":(typeof n=="number"||typeof e=="number")&&(s=n>e);break;case">=":(typeof n=="number"||typeof e=="number")&&(s=n>=e);break;case"/":s=String(n).startsWith(String(e));break}return s};var Yj=Object.defineProperty,Gj=Object.getOwnPropertyDescriptor,oP=(n,t,e,s)=>{for(var i=Gj(t,e),r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=o(t,e,i)||i);return i&&Yj(t,e,i),i},as;const pw=(as=class extends ae{constructor(){super(...arguments),this._previousContainer=null,this._visible=!1}get placement(){return this._placement}set placement(n){this._placement=n,this.updatePosition()}static removeMenus(){for(const n of as.menus)n instanceof as&&(n.visible=!1);setTimeout(()=>{as.dialog.close(),as.dialog.remove()},310)}get visible(){return this._visible}set visible(n){this._visible=n,n?(as.dialog.parentElement||document.body.append(as.dialog),this._previousContainer=this.parentElement,as.dialog.style.top=`${window.scrollY||document.documentElement.scrollTop}px`,this.style.setProperty("display","flex"),as.dialog.append(this),as.dialog.showModal(),this.updatePosition(),this.dispatchEvent(new Event("visible"))):setTimeout(()=>{var t;(t=this._previousContainer)==null||t.append(this),this._previousContainer=null,this.style.setProperty("display","none"),this.dispatchEvent(new Event("hidden"))},310)}async updatePosition(){if(!(this.visible&&this._previousContainer))return;const n=this.placement??"right",t=await AO(this._previousContainer,this,{placement:n,middleware:[pO(10),TO(),CO(),IO({padding:5})]}),{x:e,y:s}=t;this.style.left=`${e}px`,this.style.top=`${s}px`}connectedCallback(){super.connectedCallback(),as.menus.push(this),this.visible?(this.style.setProperty("width","auto"),this.style.setProperty("height","auto")):(this.style.setProperty("display","none"),this.style.setProperty("width","0"),this.style.setProperty("height","0"))}render(){return dt` <slot></slot> `}},as.styles=[sa.scrollbar,he`
      :host {
        pointer-events: auto;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 999;
        overflow: auto;
        max-height: 20rem;
        min-width: 3rem;
        flex-direction: column;
        box-shadow: 1px 2px 8px 2px rgba(0, 0, 0, 0.15);
        padding: 0.5rem;
        border-radius: var(--bim-ui_size-4xs);
        display: flex;
        transform-origin: top left;
        transform: scale(1);
        clip-path: circle(150% at top left);
        background-color: var(--bim-ui_bg-contrast-20);
        transition:
          clip-path 0.2s cubic-bezier(0.72, 0.1, 0.43, 0.93),
          transform 0.3s cubic-bezier(0.72, 0.1, 0.45, 2.35);
      }

      :host(:not([visible])) {
        transform: scale(0.8);
        clip-path: circle(0 at top left);
      }
    `],as.dialog=Rs.create(()=>dt` <dialog
      @click=${n=>{n.target===as.dialog&&as.removeMenus()}}
      @cancel=${()=>as.removeMenus()}
      data-context-dialog
      style="
      width: 0;
      height: 0;
      position: relative;
      padding: 0;
      border: none;
      outline: none;
      margin: none;
      overflow: visible;
      background-color: transparent;
    "
    ></dialog>`),as.menus=[],as);oP([mt({type:String,reflect:!0})],pw.prototype,"placement");oP([mt({type:Boolean,reflect:!0})],pw.prototype,"visible");let ug=pw;var qj=Object.defineProperty,Zj=Object.getOwnPropertyDescriptor,Dn=(n,t,e,s)=>{for(var i=s>1?void 0:s?Zj(t,e):t,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(t,e,i):o(i))||i);return s&&i&&qj(t,e,i),i},au;const gn=(au=class extends ae{constructor(){super(),this.labelHidden=!1,this.active=!1,this.disabled=!1,this.vertical=!1,this.tooltipVisible=!1,this._stateBeforeLoading={disabled:!1,icon:""},this._loading=!1,this._parent=qc(),this._tooltip=qc(),this._mouseLeave=!1,this.onClick=n=>{n.stopPropagation(),this.disabled||this.dispatchEvent(new Event("click"))},this.showContextMenu=()=>{const n=this._contextMenu;if(n){const t=this.getAttribute("data-context-group");t&&n.setAttribute("data-context-group",t),this.closeNestedContexts();const e=Bs.newRandomId();for(const s of n.children)s instanceof au&&s.setAttribute("data-context-group",e);n.visible=!0}},this.mouseLeave=!0}set loading(n){if(this._loading=n,n)this._stateBeforeLoading={disabled:this.disabled,icon:this.icon},this.disabled=n,this.icon="eos-icons:loading";else{const{disabled:t,icon:e}=this._stateBeforeLoading;this.disabled=t,this.icon=e}}get loading(){return this._loading}set mouseLeave(n){this._mouseLeave=n,n&&(this.tooltipVisible=!1,clearTimeout(this.timeoutID))}get mouseLeave(){return this._mouseLeave}computeTooltipPosition(){const{value:n}=this._parent,{value:t}=this._tooltip;n&&t&&AO(n,t,{placement:"bottom",middleware:[pO(10),TO(),CO(),IO({padding:5})]}).then(e=>{const{x:s,y:i}=e;Object.assign(t.style,{left:`${s}px`,top:`${i}px`})})}onMouseEnter(){if(!(this.tooltipTitle||this.tooltipText))return;this.mouseLeave=!1;const n=this.tooltipTime??700;this.timeoutID=setTimeout(()=>{this.mouseLeave||(this.computeTooltipPosition(),this.tooltipVisible=!0)},n)}closeNestedContexts(){const n=this.getAttribute("data-context-group");if(n)for(const t of ug.dialog.children){const e=t.getAttribute("data-context-group");if(t instanceof ug&&e===n){t.visible=!1,t.removeAttribute("data-context-group");for(const s of t.children)s instanceof au&&(s.closeNestedContexts(),s.removeAttribute("data-context-group"))}}}click(){this.disabled||super.click()}get _contextMenu(){return this.querySelector("bim-context-menu")}connectedCallback(){super.connectedCallback(),this.addEventListener("click",this.showContextMenu)}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("click",this.showContextMenu)}render(){const n=dt`
      <div ${oi(this._tooltip)} class="tooltip">
        ${this.tooltipTitle?dt`<p style="text-wrap: nowrap;">
              <strong>${this.tooltipTitle}</strong>
            </p>`:null}
        ${this.tooltipText?dt`<p style="width: 9rem;">${this.tooltipText}</p>`:null}
      </div>
    `,t=dt`<svg
      xmlns="http://www.w3.org/2000/svg"
      height="1.125rem"
      viewBox="0 0 24 24"
      width="1.125rem"
      style="fill: var(--bim-label--c)"
    >
      <path d="M0 0h24v24H0V0z" fill="none" />
      <path d="M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z" />
    </svg>`;return dt`
      <div ${oi(this._parent)} class="parent" @click=${this.onClick}>
        ${this.label||this.icon?dt`
              <div
                class="button"
                @mouseenter=${this.onMouseEnter}
                @mouseleave=${()=>this.mouseLeave=!0}
              >
                <bim-label
                  .icon=${this.icon}
                  .vertical=${this.vertical}
                  .labelHidden=${this.labelHidden}
                  >${this.label}${this.label&&this._contextMenu?t:null}</bim-label
                >
              </div>
            `:null}
        ${this.tooltipTitle||this.tooltipText?n:null}
      </div>
      <slot></slot>
    `}},au.styles=he`
    :host {
      --bim-label--c: var(--bim-ui_bg-contrast-100, white);
      position: relative;
      display: block;
      flex: 1;
      pointer-events: none;
      background-color: var(--bim-button--bgc, var(--bim-ui_bg-contrast-20));
      border-radius: var(--bim-ui_size-4xs);
      transition: all 0.15s;
    }

    :host(:not([disabled]))::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: inherit;
      background-color: var(--bim-ui_main-base);
      clip-path: circle(0 at center center);
      box-sizing: border-box;
      transition:
        clip-path 0.3s cubic-bezier(0.65, 0.05, 0.36, 1),
        transform 0.15s;
    }

    :host(:not([disabled]):hover) {
      cursor: pointer;
    }

    bim-label {
      pointer-events: none;
    }

    .parent {
      --bim-icon--c: var(--bim-label--c);
      position: relative;
      display: flex;
      height: 100%;
      user-select: none;
      row-gap: 0.125rem;
      min-height: var(--bim-ui_size-5xl);
      min-width: var(--bim-ui_size-5xl);
    }

    .button,
    .children {
      box-sizing: border-box;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: auto;
    }

    .children {
      padding: 0 0.375rem;
      position: absolute;
      height: 100%;
      right: 0;
    }

    :host(:not([label-hidden])[icon][vertical]) .parent {
      min-height: 2.5rem;
    }

    .button {
      flex-grow: 1;
      transition: transform 0.15s;
    }

    :host(:not([label-hidden])[label]) .button {
      justify-content: var(--bim-button--jc, center);
    }

    :host(:hover)::before {
      clip-path: circle(120% at center center);
    }

    :host(:hover) {
      --bim-label--c: var(--bim-ui_main-contrast);
      z-index: 2;
    }

    :host([active]) {
      background-color: var(--bim-ui_main-base);
    }

    :host(:not([disabled]):active) {
      background: transparent;
    }

    :host(:not([disabled]):active) .button,
    :host(:not([disabled]):active)::before {
      transform: scale(0.98);
    }

    :host(:not([label]):not([icon])) .children {
      flex: 1;
    }

    :host([vertical]) .parent {
      justify-content: center;
    }

    :host(:not([label-hidden])[label]) .button {
      padding: 0 0.5rem;
    }

    :host([disabled]) {
      --bim-label--c: var(--bim-ui_bg-contrast-80) !important;
      background-color: gray !important;
    }

    ::slotted(bim-button) {
      --bim-icon--fz: var(--bim-ui_size-base);
      --bim-button--bdrs: var(--bim-ui_size-4xs);
      --bim-button--olw: 0;
      --bim-button--olc: transparent;
    }

    .tooltip {
      position: absolute;
      padding: 0.75rem;
      z-index: 99;
      display: flex;
      flex-flow: column;
      row-gap: 0.375rem;
      box-shadow: 0 0 10px 3px rgba(0 0 0 / 20%);
      outline: 1px solid var(--bim-ui_bg-contrast-40);
      font-size: var(--bim-ui_size-xs);
      border-radius: var(--bim-ui_size-4xs);
      background-color: var(--bim-ui_bg-contrast-20);
      color: var(--bim-ui_bg-contrast-100);
      animation: openTooltips 0.15s ease-out forwards;
      transition: visibility 0.2s;
    }

    .tooltip p {
      margin: 0;
      padding: 0;
    }

    :host(:not([tooltip-visible])) .tooltip {
      animation: closeTooltips 0.15s ease-in forwards;
      visibility: hidden;
      display: none;
    }

    @keyframes closeTooltips {
      0% {
        display: flex;
        padding: 0.75rem;
        transform: translateY(0);
        opacity: 1;
      }
      90% {
        padding: 0.75rem;
      }
      100% {
        display: none;
        padding: 0;
        transform: translateY(-10px);
        opacity: 0;
      }
    }

    @keyframes openTooltips {
      0% {
        display: flex;
        transform: translateY(-10px);
        opacity: 0;
      }
      100% {
        transform: translateY(0);
        opacity: 1;
      }
    }
  `,au);Dn([mt({type:String,reflect:!0})],gn.prototype,"label",2);Dn([mt({type:Boolean,attribute:"label-hidden",reflect:!0})],gn.prototype,"labelHidden",2);Dn([mt({type:Boolean,reflect:!0})],gn.prototype,"active",2);Dn([mt({type:Boolean,reflect:!0,attribute:"disabled"})],gn.prototype,"disabled",2);Dn([mt({type:String,reflect:!0})],gn.prototype,"icon",2);Dn([mt({type:Boolean,reflect:!0})],gn.prototype,"vertical",2);Dn([mt({type:Number,attribute:"tooltip-time",reflect:!0})],gn.prototype,"tooltipTime",2);Dn([mt({type:Boolean,attribute:"tooltip-visible",reflect:!0})],gn.prototype,"tooltipVisible",2);Dn([mt({type:String,attribute:"tooltip-title",reflect:!0})],gn.prototype,"tooltipTitle",2);Dn([mt({type:String,attribute:"tooltip-text",reflect:!0})],gn.prototype,"tooltipText",2);Dn([mt({type:Boolean,reflect:!0})],gn.prototype,"loading",1);let Xj=gn;var Qj=Object.defineProperty,op=(n,t,e,s)=>{for(var i=void 0,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=o(t,e,i)||i);return i&&Qj(t,e,i),i};const aP=class extends ae{constructor(){super(...arguments),this.checked=!1,this.inverted=!1,this.onValueChange=new Event("change")}get value(){return this.checked}onChange(n){n.stopPropagation(),this.checked=n.target.checked,this.dispatchEvent(this.onValueChange)}render(){const n=dt`
      <svg viewBox="0 0 21 21">
        <polyline points="5 10.75 8.5 14.25 16 6"></polyline>
      </svg>
    `;return dt`
      <div class="parent">
        <label class="parent-label">
          ${this.label?dt`<bim-label .icon="${this.icon}">${this.label}</bim-label> `:null}
          <div class="input-container">
            <input
              type="checkbox"
              aria-label=${this.label||this.name||"Checkbox Input"}
              @change="${this.onChange}"
              .checked="${this.checked}"
            />
            ${n}
          </div>
        </label>
      </div>
    `}};aP.styles=he`
    :host {
      display: block;
    }

    .parent-label {
      --background: #fff;
      --border: #dfdfe6;
      --stroke: #fff;
      --border-hover: var(--bim-ui_main-base);
      --border-active: var(--bim-ui_main-base);
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      width: 100%;
      height: 1.75rem;
      column-gap: 0.25rem;
      position: relative;
      cursor: pointer;
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }

    :host([inverted]) .parent-label {
      flex-direction: row-reverse;
      justify-content: start;
    }

    input,
    svg {
      width: 1rem;
      height: 1rem;
      display: block;
    }

    input {
      -webkit-appearance: none;
      -moz-appearance: none;
      position: relative;
      outline: none;
      background: var(--background);
      border: none;
      margin: 0;
      padding: 0;
      cursor: pointer;
      border-radius: 4px;
      transition: box-shadow 0.3s;
      box-shadow: inset 0 0 0 var(--s, 1px) var(--b, var(--border));
    }

    svg {
      pointer-events: none;
      fill: none;
      stroke-width: 2.2px;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke: var(--stroke, var(--border-active));
      transform: translateY(-100%) scale(0);
      position: absolute;
      width: 1rem;
      height: 1rem;
    }

    input:hover {
      --s: 2px;
      --b: var(--border-hover);
    }

    input:checked {
      --b: var(--border-active);
      --s: 11px;
    }

    input:checked + svg {
      -webkit-animation: bounce 0.4s linear forwards 0.2s;
      animation: bounce 0.4s linear forwards 0.2s;
    }

    @keyframes bounce {
      0% {
        transform: translateY(-100%) scale(0);
      }
      50% {
        transform: translateY(-100%) scale(1.2);
      }
      75% {
        transform: translateY(-100%) scale(0.9);
      }
      100% {
        transform: translateY(-100%) scale(1);
      }
    }
  `;let ph=aP;op([mt({type:String,reflect:!0})],ph.prototype,"icon");op([mt({type:String,reflect:!0})],ph.prototype,"name");op([mt({type:String,reflect:!0})],ph.prototype,"label");op([mt({type:Boolean,reflect:!0})],ph.prototype,"checked");op([mt({type:Boolean,reflect:!0})],ph.prototype,"inverted");var Kj=Object.defineProperty,ol=(n,t,e,s)=>{for(var i=void 0,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=o(t,e,i)||i);return i&&Kj(t,e,i),i};const lP=class extends ae{constructor(){super(...arguments),this.vertical=!1,this.color="#bcf124",this.disabled=!1,this._colorInput=qc(),this._textInput=qc(),this.onValueChange=new Event("input"),this.onOpacityInput=n=>{const t=n.target;this.opacity=t.value,this.dispatchEvent(this.onValueChange)}}set value(n){const{color:t,opacity:e}=n;this.color=t,e&&(this.opacity=e)}get value(){const n={color:this.color};return this.opacity&&(n.opacity=this.opacity),n}onColorInput(n){n.stopPropagation();const{value:t}=this._colorInput;t&&(this.color=t.value,this.dispatchEvent(this.onValueChange))}onTextInput(n){n.stopPropagation();const{value:t}=this._textInput;if(!t)return;const{value:e}=t;let s=e.replace(/[^a-fA-F0-9]/g,"");s.startsWith("#")||(s=`#${s}`),t.value=s.slice(0,7),t.value.length===7&&(this.color=t.value,this.dispatchEvent(this.onValueChange))}focus(){const{value:n}=this._colorInput;n&&n.click()}render(){return dt`
      <div class="parent">
        <bim-input
          .label=${this.label}
          .icon=${this.icon}
          .vertical="${this.vertical}"
        >
          <div class="color-container">
            <div
              style="display: flex; align-items: center; gap: .375rem; height: 100%; flex: 1; padding: 0 0.5rem;"
            >
              <input
                ${oi(this._colorInput)}
                @input="${this.onColorInput}"
                type="color"
                aria-label=${this.label||this.name||"Color Input"}
                value="${this.color}"
                ?disabled=${this.disabled}
              />
              <div
                @click=${this.focus}
                class="sample"
                style="background-color: ${this.color}"
              ></div>
              <input
                ${oi(this._textInput)}
                @input="${this.onTextInput}"
                value="${this.color}"
                type="text"
                aria-label=${this.label||this.name||"Text Color Input"}
                ?disabled=${this.disabled}
              />
            </div>
            ${this.opacity!==void 0?dt`<bim-number-input
                  @change=${this.onOpacityInput}
                  slider
                  suffix="%"
                  min="0"
                  value=${this.opacity}
                  max="100"
                ></bim-number-input>`:null}
          </div>
        </bim-input>
      </div>
    `}};lP.styles=he`
    :host {
      --bim-input--bgc: var(--bim-ui_bg-contrast-20);
      flex: 1;
      display: block;
    }

    :host(:focus) {
      --bim-input--olw: var(--bim-number-input--olw, 2px);
      --bim-input--olc: var(--bim-ui_accent-base);
    }

    .parent {
      display: flex;
      gap: 0.375rem;
    }

    .color-container {
      position: relative;
      outline: none;
      display: flex;
      height: 100%;
      gap: 0.5rem;
      justify-content: flex-start;
      align-items: center;
      flex: 1;
      border-radius: var(--bim-color-input--bdrs, var(--bim-ui_size-4xs));
    }

    .color-container input[type="color"] {
      position: absolute;
      bottom: -0.25rem;
      visibility: hidden;
      width: 0;
      height: 0;
    }

    .color-container .sample {
      width: 1rem;
      height: 1rem;
      border-radius: 0.125rem;
      background-color: #fff;
    }

    .color-container input[type="text"] {
      height: 100%;
      flex: 1;
      width: 3.25rem;
      text-transform: uppercase;
      font-size: 0.75rem;
      background-color: transparent;
      padding: 0%;
      outline: none;
      border: none;
      color: var(--bim-color-input--c, var(--bim-ui_bg-contrast-100));
    }

    :host([disabled]) .color-container input[type="text"] {
      color: var(--bim-ui_bg-contrast-60);
    }

    bim-number-input {
      flex-grow: 0;
    }
  `;let ia=lP;ol([mt({type:String,reflect:!0})],ia.prototype,"name");ol([mt({type:String,reflect:!0})],ia.prototype,"label");ol([mt({type:String,reflect:!0})],ia.prototype,"icon");ol([mt({type:Boolean,reflect:!0})],ia.prototype,"vertical");ol([mt({type:Number,reflect:!0})],ia.prototype,"opacity");ol([mt({type:String,reflect:!0})],ia.prototype,"color");ol([mt({type:Boolean,reflect:!0})],ia.prototype,"disabled");var Jj=Object.defineProperty,tW=Object.getOwnPropertyDescriptor,na=(n,t,e,s)=>{for(var i=s>1?void 0:s?tW(t,e):t,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(t,e,i):o(i))||i);return s&&i&&Jj(t,e,i),i};const cP=class extends ae{constructor(){super(...arguments),this.checked=!1,this.checkbox=!1,this.noMark=!1,this.vertical=!1}get value(){return this._value!==void 0?this._value:this.label?eb(this.label):this.label}set value(n){this._value=n}render(){return dt`
      <div class="parent" .title=${this.label??""}>
        ${this.img||this.icon||this.label?dt` <div style="display: flex; column-gap: 0.375rem">
              ${this.checkbox&&!this.noMark?dt`<bim-checkbox
                    style="pointer-events: none"
                    .checked=${this.checked}
                  ></bim-checkbox>`:null}
              <bim-label
                .vertical=${this.vertical}
                .icon=${this.icon}
                .img=${this.img}
                >${this.label}</bim-label
              >
            </div>`:null}
        ${!this.checkbox&&!this.noMark&&this.checked?dt`<svg
              xmlns="http://www.w3.org/2000/svg"
              height="1.125rem"
              viewBox="0 0 24 24"
              width="1.125rem"
              fill="#FFFFFF"
            >
              <path d="M0 0h24v24H0z" fill="none" />
              <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
            </svg>`:null}
        <slot></slot>
      </div>
    `}};cP.styles=he`
    :host {
      --bim-label--c: var(--bim-ui_bg-contrast-100);
      display: block;
      box-sizing: border-box;
      flex: 1;
      padding: 0rem 0.5rem;
      border-radius: var(--bim-ui_size-4xs);
      transition: all 0.15s;
    }

    :host(:hover) {
      cursor: pointer;
    }

    :host([checked]) {
      --bim-label--c: color-mix(in lab, var(--bim-ui_main-base), white 30%);
    }

    :host([checked]) svg {
      fill: color-mix(in lab, var(--bim-ui_main-base), white 30%);
    }

    .parent {
      box-sizing: border-box;
      display: flex;
      justify-content: var(--bim-option--jc, space-between);
      column-gap: 0.5rem;
      align-items: center;
      min-height: 1.75rem;
      height: 100%;
    }

    input {
      height: 1rem;
      width: 1rem;
      cursor: pointer;
      border: none;
      outline: none;
      accent-color: var(--bim-checkbox--c, var(--bim-ui_main-base));
    }

    input:focus {
      outline: var(--bim-checkbox--olw, 2px) solid
        var(--bim-checkbox--olc, var(--bim-ui_accent-base));
    }

    bim-label {
      pointer-events: none;
      z-index: 1;
    }
  `;let _s=cP;na([mt({type:String,reflect:!0})],_s.prototype,"img",2);na([mt({type:String,reflect:!0})],_s.prototype,"label",2);na([mt({type:String,reflect:!0})],_s.prototype,"icon",2);na([mt({type:Boolean,reflect:!0})],_s.prototype,"checked",2);na([mt({type:Boolean,reflect:!0})],_s.prototype,"checkbox",2);na([mt({type:Boolean,attribute:"no-mark",reflect:!0})],_s.prototype,"noMark",2);na([mt({converter:{fromAttribute(n){return n&&eb(n)}}})],_s.prototype,"value",1);na([mt({type:Boolean,reflect:!0})],_s.prototype,"vertical",2);var eW=Object.defineProperty,sW=Object.getOwnPropertyDescriptor,Qr=(n,t,e,s)=>{for(var i=s>1?void 0:s?sW(t,e):t,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(t,e,i):o(i))||i);return s&&i&&eW(t,e,i),i};const hP=class extends Rs{constructor(){super(),this.multiple=!1,this.required=!1,this.vertical=!1,this._visible=!1,this._value=new Set,this.onValueChange=new Event("change"),this._contextMenu=qc(),this.onOptionClick=n=>{const t=n.target,e=this._value.has(t);if(!this.multiple&&!this.required&&!e)this._value=new Set([t]);else if(!this.multiple&&!this.required&&e)this._value=new Set([]);else if(!this.multiple&&this.required&&!e)this._value=new Set([t]);else if(this.multiple&&!this.required&&!e)this._value=new Set([...this._value,t]);else if(this.multiple&&!this.required&&e){const s=[...this._value].filter(i=>i!==t);this._value=new Set(s)}else if(this.multiple&&this.required&&!e)this._value=new Set([...this._value,t]);else if(this.multiple&&this.required&&e){const s=[...this._value].filter(r=>r!==t),i=new Set(s);i.size!==0&&(this._value=i)}this.updateOptionsState(),this.dispatchEvent(this.onValueChange)},this.useObserver=!0}set visible(n){if(n){const{value:t}=this._contextMenu;if(!t)return;for(const e of this.elements)t.append(e);this._visible=!0}else{for(const t of this.elements)this.append(t);this._visible=!1,this.resetVisibleElements()}}get visible(){return this._visible}set value(n){if(this.required&&Object.keys(n).length===0)return;const t=new Set;for(const e of n){const s=this.findOption(e);if(s&&(t.add(s),!this.multiple&&Object.keys(n).length===1))break}this._value=t,this.updateOptionsState(),this.dispatchEvent(this.onValueChange)}get value(){return[...this._value].filter(n=>n instanceof _s&&n.checked).map(n=>n.value)}get _options(){const n=new Set([...this.elements]);for(const t of this.children)t instanceof _s&&n.add(t);return[...n]}onSlotChange(n){const t=n.target.assignedElements();this.observe(t);const e=new Set;for(const s of this.elements){if(!(s instanceof _s)){s.remove();continue}s.checked&&e.add(s),s.removeEventListener("click",this.onOptionClick),s.addEventListener("click",this.onOptionClick)}this._value=e}updateOptionsState(){for(const n of this._options)n instanceof _s&&(n.checked=this._value.has(n))}findOption(n){return this._options.find(t=>t instanceof _s?t.label===n||t.value===n:!1)}render(){let n,t,e;if(this._value.size===0)n=this.placeholder??"Select an option...";else if(this._value.size===1){const s=[...this._value][0];n=s?.label||s?.value,t=s?.img,e=s?.icon}else n=`Multiple (${this._value.size})`;return dt`
      <bim-input
        title=${this.label??""}
        .label=${this.label}
        .icon=${this.icon}
        .vertical=${this.vertical}
      >
        <div class="input" @click=${()=>this.visible=!this.visible}>
          <bim-label
            .img=${t}
            .icon=${e}
            style="overflow: hidden;"
            >${n}</bim-label
          >
          <svg
            style="flex-shrink: 0; fill: var(--bim-dropdown--c, var(--bim-ui_bg-contrast-100))"
            xmlns="http://www.w3.org/2000/svg"
            height="1.125rem"
            viewBox="0 0 24 24"
            width="1.125rem"
            fill="#9ca3af"
          >
            <path d="M0 0h24v24H0V0z" fill="none" />
            <path d="M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z" />
          </svg>
          <bim-context-menu
            ${oi(this._contextMenu)}
            .visible=${this.visible}
            @hidden=${()=>{this.visible&&(this.visible=!1)}}
          >
            <slot @slotchange=${this.onSlotChange}></slot>
          </bim-context-menu>
        </div>
      </bim-input>
    `}};hP.styles=[sa.scrollbar,he`
      :host {
        --bim-input--bgc: var(
          --bim-dropdown--bgc,
          var(--bim-ui_bg-contrast-20)
        );
        --bim-input--olw: 2px;
        --bim-input--olc: transparent;
        --bim-input--bdrs: var(--bim-ui_size-4xs);
        flex: 1;
        display: block;
      }

      :host([visible]) {
        --bim-input--olc: var(--bim-ui_accent-base);
      }

      .input {
        --bim-label--fz: var(--bim-drodown--fz, var(--bim-ui_size-xs));
        --bim-label--c: var(--bim-dropdown--c, var(--bim-ui_bg-contrast-100));
        height: 100%;
        display: flex;
        flex: 1;
        overflow: hidden;
        column-gap: 0.25rem;
        outline: none;
        cursor: pointer;
        align-items: center;
        justify-content: space-between;
        padding: 0 0.5rem;
      }

      bim-label {
        pointer-events: none;
      }
    `];let wr=hP;Qr([mt({type:String,reflect:!0})],wr.prototype,"name",2);Qr([mt({type:String,reflect:!0})],wr.prototype,"icon",2);Qr([mt({type:String,reflect:!0})],wr.prototype,"label",2);Qr([mt({type:Boolean,reflect:!0})],wr.prototype,"multiple",2);Qr([mt({type:Boolean,reflect:!0})],wr.prototype,"required",2);Qr([mt({type:Boolean,reflect:!0})],wr.prototype,"vertical",2);Qr([mt({type:String,reflect:!0})],wr.prototype,"placeholder",2);Qr([mt({type:Boolean,reflect:!0})],wr.prototype,"visible",1);Qr([dh()],wr.prototype,"_value",2);var iW=Object.defineProperty,uP=(n,t,e,s)=>{for(var i=void 0,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=o(t,e,i)||i);return i&&iW(t,e,i),i};const dP=class extends ae{constructor(){super(...arguments),this.floating=!1,this._layouts={},this._elements={},this._templateIds=new Map,this._updateFunctions={},this.updateComponent={}}set layouts(n){this._layouts=n,this._templateIds.clear()}get layouts(){return this._layouts}set elements(n){this._elements=n;const t={};for(const[e,s]of Object.entries(this.elements))"template"in s&&(t[e]=i=>{const r=this._updateFunctions[e];r&&r(i)});this.updateComponent=t}get elements(){return this._elements}getLayoutAreas(n){const{template:t}=n,e=t.split(`
`).map(s=>s.trim()).map(s=>s.split('"')[1]).filter(s=>s!==void 0).flatMap(s=>s.split(/\s+/));return[...new Set(e)].filter(s=>s!=="")}firstUpdated(){this._onLayoutChange=new Event("layoutchange")}getTemplateId(n){let t=this._templateIds.get(n);return t||(t=Bs.newRandomId(),this._templateIds.set(n,t)),t}cleanUpdateFunctions(){if(!this.layout){this._updateFunctions={};return}const n=this.layouts[this.layout],t=this.getLayoutAreas(n);for(const e in this.elements)t.includes(e)||delete this._updateFunctions[e]}emitElementCreation(n){this.dispatchEvent(new CustomEvent("elementcreated",{detail:n}))}render(){if(this.layout){if(this.layouts[this.layout]){const n=this.layouts[this.layout],t=this.getLayoutAreas(n).map(e=>{var s;const i=((s=n.elements)==null?void 0:s[e])||this.elements[e];if(!i)return null;if(i instanceof HTMLElement)return i.style.gridArea=e,i;if("template"in i){const{template:l,initialState:c}=i,h=this.getTemplateId(l),u=this.querySelector(`[data-grid-template-id="${h}"]`);if(u)return u;const[p,d]=Rs.create(l,c);return this.emitElementCreation({name:e,element:p}),p.setAttribute("data-grid-template-id",h),p.style.gridArea=e,this._updateFunctions[e]=d,p}const r=this.getTemplateId(i),o=this.querySelector(`[data-grid-template-id="${r}"]`);if(o)return o;const a=Rs.create(i);return this.emitElementCreation({name:e,element:a}),a.setAttribute("data-grid-template-id",this.getTemplateId(i)),a.style.gridArea=e,a}).filter(e=>e!==null);this.innerHTML="",this.style.gridTemplate=n.template,this.append(...t),this._onLayoutChange&&this.dispatchEvent(this._onLayoutChange)}}else this.innerHTML="",this.style.gridTemplate="",this._onLayoutChange&&this.dispatchEvent(this._onLayoutChange);return this.cleanUpdateFunctions(),dt`<slot></slot>`}};dP.styles=he`
    :host {
      display: grid;
      height: 100%;
      width: 100%;
      overflow: hidden;
      box-sizing: border-box;
    }

    /* :host(:not([layout])) {
      display: none;
    } */

    :host([floating]) {
      --bim-panel--bdrs: var(--bim-ui_size-4xs);
      background-color: transparent;
      padding: 1rem;
      gap: 1rem;
      position: absolute;
      pointer-events: none;
      top: 0px;
      left: 0px;
    }

    :host(:not([floating])) {
      --bim-panel--bdrs: 0;
      background-color: var(--bim-ui_bg-contrast-20);
      gap: 1px;
    }
  `;let fw=dP;uP([mt({type:Boolean,reflect:!0})],fw.prototype,"floating");uP([mt({type:String,reflect:!0})],fw.prototype,"layout");const Vy=class extends ae{render(){return dt`
      <iconify-icon .icon=${this.icon} height="none"></iconify-icon>
    `}};Vy.styles=he`
    :host {
      height: var(--bim-icon--fz, var(--bim-ui_size-sm));
      width: var(--bim-icon--fz, var(--bim-ui_size-sm));
    }

    iconify-icon {
      height: var(--bim-icon--fz, var(--bim-ui_size-sm));
      width: var(--bim-icon--fz, var(--bim-ui_size-sm));
      color: var(--bim-icon--c);
      transition: all 0.15s;
      display: flex;
    }
  `,Vy.properties={icon:{type:String}};let nW=Vy;var rW=Object.defineProperty,sb=(n,t,e,s)=>{for(var i=void 0,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=o(t,e,i)||i);return i&&rW(t,e,i),i};const pP=class extends ae{constructor(){super(...arguments),this.vertical=!1,this.onValueChange=new Event("change")}get value(){const n={};for(const t of this.children){const e=t;"value"in e?n[e.name||e.label]=e.value:"checked"in e&&(n[e.name||e.label]=e.checked)}return n}set value(n){const t=[...this.children];for(const e in n){const s=t.find(o=>{const a=o;return a.name===e||a.label===e});if(!s)continue;const i=s,r=n[e];typeof r=="boolean"?i.checked=r:i.value=r}}render(){return dt`
      <div class="parent">
        ${this.label||this.icon?dt`<bim-label .icon=${this.icon}>${this.label}</bim-label>`:null}
        <div class="input">
          <slot></slot>
        </div>
      </div>
    `}};pP.styles=he`
    :host {
      flex: 1;
      display: block;
    }

    .parent {
      display: flex;
      flex-wrap: wrap;
      column-gap: 1rem;
      row-gap: 0.375rem;
      user-select: none;
      flex: 1;
    }

    :host(:not([vertical])) .parent {
      justify-content: space-between;
    }

    :host([vertical]) .parent {
      flex-direction: column;
    }

    .input {
      position: relative;
      overflow: hidden;
      box-sizing: border-box;
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      min-height: 1.75rem;
      min-width: 3rem;
      gap: var(--bim-input--g, var(--bim-ui_size-4xs));
      padding: var(--bim-input--p, 0);
      background-color: var(--bim-input--bgc, transparent);
      border: var(--bim-input--olw, 2px) solid
        var(--bim-input--olc, transparent);
      border-radius: var(--bim-input--bdrs, var(--bim-ui_size-4xs));
      transition: all 0.15s;
    }

    :host(:not([vertical])) .input {
      flex: 1;
      justify-content: flex-end;
    }

    :host(:not([vertical])[label]) .input {
      max-width: fit-content;
    }
  `;let ap=pP;sb([mt({type:String,reflect:!0})],ap.prototype,"name");sb([mt({type:String,reflect:!0})],ap.prototype,"label");sb([mt({type:String,reflect:!0})],ap.prototype,"icon");sb([mt({type:Boolean,reflect:!0})],ap.prototype,"vertical");var oW=Object.defineProperty,lp=(n,t,e,s)=>{for(var i=void 0,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=o(t,e,i)||i);return i&&oW(t,e,i),i};const fP=class extends ae{constructor(){super(...arguments),this.labelHidden=!1,this.iconHidden=!1,this.vertical=!1}get value(){return this.textContent?eb(this.textContent):this.textContent}render(){return dt`
      <div class="parent" .title=${this.textContent??""}>
        ${this.img?dt`<img .src=${this.img} .alt=${this.textContent||""} />`:null}
        ${!this.iconHidden&&this.icon?dt`<bim-icon .icon=${this.icon}></bim-icon>`:null}
        <p><slot></slot></p>
      </div>
    `}};fP.styles=he`
    :host {
      --bim-icon--c: var(--bim-label--ic);
      overflow: auto;
      color: var(--bim-label--c, var(--bim-ui_bg-contrast-60));
      font-size: var(--bim-label--fz, var(--bim-ui_size-xs));
      display: block;
      white-space: nowrap;
      transition: all 0.15s;
    }

    :host([icon]) {
      line-height: 1.1rem;
    }

    .parent {
      display: flex;
      align-items: center;
      column-gap: 0.25rem;
      row-gap: 0.125rem;
      user-select: none;
      height: 100%;
    }

    :host([vertical]) .parent {
      flex-direction: column;
    }

    .parent p {
      display: flex;
      margin: 0;
      text-overflow: ellipsis;
      overflow: hidden;
      align-items: center;
      gap: 0.125rem;
    }

    :host([label-hidden]) .parent p,
    :host(:empty) .parent p {
      display: none;
    }

    img {
      height: 100%;
      aspect-ratio: 1;
      border-radius: 100%;
      margin-right: 0.125rem;
    }

    :host(:not([vertical])) img {
      max-height: var(
        --bim-label_icon--sz,
        calc(var(--bim-label--fz, var(--bim-ui_size-xs)) * 1.8)
      );
    }

    :host([vertical]) img {
      max-height: var(
        --bim-label_icon--sz,
        calc(var(--bim-label--fz, var(--bim-ui_size-xs)) * 4)
      );
    }
  `;let fh=fP;lp([mt({type:String,reflect:!0})],fh.prototype,"img");lp([mt({type:Boolean,attribute:"label-hidden",reflect:!0})],fh.prototype,"labelHidden");lp([mt({type:String,reflect:!0})],fh.prototype,"icon");lp([mt({type:Boolean,attribute:"icon-hidden",reflect:!0})],fh.prototype,"iconHidden");lp([mt({type:Boolean,reflect:!0})],fh.prototype,"vertical");var aW=Object.defineProperty,lW=Object.getOwnPropertyDescriptor,bn=(n,t,e,s)=>{for(var i=s>1?void 0:s?lW(t,e):t,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(t,e,i):o(i))||i);return s&&i&&aW(t,e,i),i};const mP=class extends ae{constructor(){super(...arguments),this._value=0,this.vertical=!1,this.slider=!1,this._input=qc(),this.onValueChange=new Event("change")}set value(n){this.setValue(n.toString())}get value(){return this._value}onChange(n){n.stopPropagation();const{value:t}=this._input;t&&this.setValue(t.value)}setValue(n){const{value:t}=this._input;let e=n;if(e=e.replace(/[^0-9.-]/g,""),e=e.replace(/(\..*)\./g,"$1"),e.endsWith(".")||(e.lastIndexOf("-")>0&&(e=e[0]+e.substring(1).replace(/-/g,"")),e==="-"||e==="-0"))return;let s=Number(e);Number.isNaN(s)||(s=this.min!==void 0?Math.max(s,this.min):s,s=this.max!==void 0?Math.min(s,this.max):s,this.value!==s&&(this._value=s,t&&(t.value=this.value.toString()),this.requestUpdate(),this.dispatchEvent(this.onValueChange)))}onBlur(){const{value:n}=this._input;n&&Number.isNaN(Number(n.value))&&(n.value=this.value.toString())}onSliderMouseDown(n){document.body.style.cursor="w-resize";const{clientX:t}=n,e=this.value;let s=!1;const i=a=>{var l;s=!0;const{clientX:c}=a,h=this.step??1,u=((l=h.toString().split(".")[1])==null?void 0:l.length)||0,p=1/(this.sensitivity??1),d=(c-t)/p;if(Math.floor(Math.abs(d))!==Math.abs(d))return;const g=e+d*h;this.setValue(g.toFixed(u))},r=()=>{this.slider=!0,this.removeEventListener("blur",r)},o=()=>{document.removeEventListener("mousemove",i),document.body.style.cursor="default",s?s=!1:(this.addEventListener("blur",r),this.slider=!1,requestAnimationFrame(()=>this.focus())),document.removeEventListener("mouseup",o)};document.addEventListener("mousemove",i),document.addEventListener("mouseup",o)}onFocus(n){n.stopPropagation();const t=e=>{e.key==="Escape"&&(this.blur(),window.removeEventListener("keydown",t))};window.addEventListener("keydown",t)}connectedCallback(){super.connectedCallback(),this.min&&this.min>this.value&&(this._value=this.min),this.max&&this.max<this.value&&(this._value=this.max)}focus(){const{value:n}=this._input;n&&n.focus()}render(){const n=dt`
      ${this.pref||this.icon?dt`<bim-label
            style="pointer-events: auto"
            @mousedown=${this.onSliderMouseDown}
            .icon=${this.icon}
            >${this.pref}</bim-label
          >`:null}
      <input
        ${oi(this._input)}
        type="text"
        aria-label=${this.label||this.name||"Number Input"}
        size="1"
        @input=${o=>o.stopPropagation()}
        @change=${this.onChange}
        @blur=${this.onBlur}
        @focus=${this.onFocus}
        .value=${this.value.toString()}
      />
      ${this.suffix?dt`<bim-label
            style="pointer-events: auto"
            @mousedown=${this.onSliderMouseDown}
            >${this.suffix}</bim-label
          >`:null}
    `,t=this.min??-1/0,e=this.max??1/0,s=100*(this.value-t)/(e-t),i=dt`
      <style>
        .slider-indicator {
          width: ${`${s}%`};
        }
      </style>
      <div class="slider" @mousedown=${this.onSliderMouseDown}>
        <div class="slider-indicator"></div>
        ${this.pref||this.icon?dt`<bim-label
              style="z-index: 1; margin-right: 0.125rem"
              .icon=${this.icon}
              >${`${this.pref}: `}</bim-label
            >`:null}
        <bim-label style="z-index: 1;">${this.value}</bim-label>
        ${this.suffix?dt`<bim-label style="z-index: 1;">${this.suffix}</bim-label>`:null}
      </div>
    `,r=`${this.label||this.name||this.pref?`${this.label||this.name||this.pref}: `:""}${this.value}${this.suffix??""}`;return dt`
      <bim-input
        title=${r}
        .label=${this.label}
        .icon=${this.icon}
        .vertical=${this.vertical}
      >
        ${this.slider?i:n}
      </bim-input>
    `}};mP.styles=he`
    :host {
      --bim-input--bgc: var(
        --bim-number-input--bgc,
        var(--bim-ui_bg-contrast-20)
      );
      --bim-input--olw: var(--bim-number-input--olw, 2px);
      --bim-input--olc: var(--bim-number-input--olc, transparent);
      --bim-input--bdrs: var(--bim-number-input--bdrs, var(--bim-ui_size-4xs));
      --bim-input--p: 0 0.375rem;
      flex: 1;
      display: block;
    }

    :host(:focus) {
      --bim-input--olw: var(--bim-number-input--olw, 2px);
      --bim-input--olc: var(
        --bim-number-input¡focus--c,
        var(--bim-ui_accent-base)
      );
    }

    :host(:not([slider])) bim-label {
      --bim-label--c: var(
        --bim-number-input_affixes--c,
        var(--bim-ui_bg-contrast-60)
      );
      --bim-label--fz: var(
        --bim-number-input_affixes--fz,
        var(--bim-ui_size-xs)
      );
    }

    p {
      margin: 0;
      padding: 0;
    }

    input {
      background-color: transparent;
      outline: none;
      border: none;
      padding: 0;
      flex-grow: 1;
      text-align: right;
      font-family: inherit;
      font-feature-settings: inherit;
      font-variation-settings: inherit;
      font-size: var(--bim-number-input--fz, var(--bim-ui_size-xs));
      color: var(--bim-number-input--c, var(--bim-ui_bg-contrast-100));
    }

    :host([suffix]:not([pref])) input {
      text-align: left;
    }

    :host([slider]) {
      --bim-input--p: 0;
    }

    :host([slider]) .slider {
      --bim-label--c: var(--bim-ui_bg-contrast-100);
    }

    .slider {
      position: relative;
      display: flex;
      justify-content: center;
      width: 100%;
      height: 100%;
      padding: 0 0.5rem;
    }

    .slider-indicator {
      height: 100%;
      background-color: var(--bim-ui_main-base);
      position: absolute;
      top: 0;
      left: 0;
      border-radius: var(--bim-input--bdrs, var(--bim-ui_size-4xs));
    }

    bim-input {
      display: flex;
    }

    bim-label {
      pointer-events: none;
    }
  `;let Li=mP;bn([mt({type:String,reflect:!0})],Li.prototype,"name",2);bn([mt({type:String,reflect:!0})],Li.prototype,"icon",2);bn([mt({type:String,reflect:!0})],Li.prototype,"label",2);bn([mt({type:String,reflect:!0})],Li.prototype,"pref",2);bn([mt({type:Number,reflect:!0})],Li.prototype,"min",2);bn([mt({type:Number,reflect:!0})],Li.prototype,"value",1);bn([mt({type:Number,reflect:!0})],Li.prototype,"step",2);bn([mt({type:Number,reflect:!0})],Li.prototype,"sensitivity",2);bn([mt({type:Number,reflect:!0})],Li.prototype,"max",2);bn([mt({type:String,reflect:!0})],Li.prototype,"suffix",2);bn([mt({type:Boolean,reflect:!0})],Li.prototype,"vertical",2);bn([mt({type:Boolean,reflect:!0})],Li.prototype,"slider",2);var cW=Object.defineProperty,hW=Object.getOwnPropertyDescriptor,cp=(n,t,e,s)=>{for(var i=s>1?void 0:s?hW(t,e):t,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(t,e,i):o(i))||i);return s&&i&&cW(t,e,i),i};const gP=class extends ae{constructor(){super(...arguments),this.onValueChange=new Event("change"),this._hidden=!1,this.headerHidden=!1,this.valueTransform={},this.activationButton=document.createElement("bim-button")}set hidden(n){this._hidden=n,this.activationButton.active=!n,this.dispatchEvent(new Event("hiddenchange"))}get hidden(){return this._hidden}get value(){return $d(this,this.valueTransform)}set value(n){const t=[...this.children];for(const e in n){const s=t.find(r=>{const o=r;return o.name===e||o.label===e});if(!s)continue;const i=s;i.value=n[e]}}animatePanles(){const n=[{maxHeight:"100vh",maxWidth:"100vw",opacity:1},{maxHeight:"100vh",maxWidth:"100vw",opacity:0},{maxHeight:0,maxWidth:0,opacity:0}];this.animate(n,{duration:300,easing:"cubic-bezier(0.65, 0.05, 0.36, 1)",direction:this.hidden?"normal":"reverse",fill:"forwards"})}connectedCallback(){super.connectedCallback(),this.activationButton.active=!this.hidden,this.activationButton.onclick=()=>{this.hidden=!this.hidden,this.animatePanles()}}disconnectedCallback(){super.disconnectedCallback(),this.activationButton.remove()}collapseSections(){const n=this.querySelectorAll("bim-panel-section");for(const t of n)t.collapsed=!0}expandSections(){const n=this.querySelectorAll("bim-panel-section");for(const t of n)t.collapsed=!1}render(){return this.activationButton.icon=this.icon,this.activationButton.label=this.label||this.name,this.activationButton.tooltipTitle=this.label||this.name,dt`
      <div class="parent">
        ${this.label||this.name||this.icon?dt`<bim-label .icon=${this.icon}>${this.label}</bim-label>`:null}
        <div class="sections">
          <slot></slot>
        </div>
      </div>
    `}};gP.styles=[sa.scrollbar,he`
      :host {
        display: flex;
        border-radius: var(--bim-ui_size-base);
        background-color: var(--bim-ui_bg-base);
        overflow: auto;
      }

      :host([hidden]) {
        max-height: 0;
        max-width: 0;
        opacity: 0;
      }

      .parent {
        display: flex;
        flex: 1;
        flex-direction: column;
        pointer-events: auto;
        overflow: auto;
      }

      .parent bim-label {
        --bim-label--c: var(--bim-panel--c, var(--bim-ui_bg-contrast-80));
        --bim-label--fz: var(--bim-panel--fz, var(--bim-ui_size-sm));
        font-weight: 600;
        padding: 1rem;
        flex-shrink: 0;
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([header-hidden]) .parent bim-label {
        display: none;
      }

      .sections {
        height: 100%;
        display: flex;
        flex-direction: column;
        overflow: auto;
        flex: 1;
      }

      ::slotted(bim-panel-section:not(:last-child)) {
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      }
    `];let al=gP;cp([mt({type:String,reflect:!0})],al.prototype,"icon",2);cp([mt({type:String,reflect:!0})],al.prototype,"name",2);cp([mt({type:String,reflect:!0})],al.prototype,"label",2);cp([mt({type:Boolean,reflect:!0})],al.prototype,"hidden",1);cp([mt({type:Boolean,attribute:"header-hidden",reflect:!0})],al.prototype,"headerHidden",2);var uW=Object.defineProperty,hp=(n,t,e,s)=>{for(var i=void 0,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=o(t,e,i)||i);return i&&uW(t,e,i),i};const bP=class extends ae{constructor(){super(...arguments),this.onValueChange=new Event("change"),this.valueTransform={},this.componentHeight=-1}get value(){const n=this.parentElement;let t;return n instanceof al&&(t=n.valueTransform),Object.values(this.valueTransform).length!==0&&(t=this.valueTransform),$d(this,t)}set value(n){const t=[...this.children];for(const e in n){const s=t.find(r=>{const o=r;return o.name===e||o.label===e});if(!s)continue;const i=s;i.value=n[e]}}setFlexAfterTransition(){var n;const t=(n=this.shadowRoot)==null?void 0:n.querySelector(".components");t&&setTimeout(()=>{this.collapsed?t.style.removeProperty("flex"):t.style.setProperty("flex","1")},150)}animateHeader(){var n;const t=(n=this.shadowRoot)==null?void 0:n.querySelector(".components");this.componentHeight<0&&(this.collapsed?this.componentHeight=t.clientHeight:(t.style.setProperty("transition","none"),t.style.setProperty("height","auto"),t.style.setProperty("padding","0.125rem 1rem 1rem"),this.componentHeight=t.clientHeight,requestAnimationFrame(()=>{t.style.setProperty("height","0px"),t.style.setProperty("padding","0 1rem 0"),t.style.setProperty("transition","height 0.25s cubic-bezier(0.65, 0.05, 0.36, 1), padding 0.25s cubic-bezier(0.65, 0.05, 0.36, 1)")}))),this.collapsed?(t.style.setProperty("height",`${this.componentHeight}px`),requestAnimationFrame(()=>{t.style.setProperty("height","0px"),t.style.setProperty("padding","0 1rem 0")})):(t.style.setProperty("height","0px"),t.style.setProperty("padding","0 1rem 0"),requestAnimationFrame(()=>{t.style.setProperty("height",`${this.componentHeight}px`),t.style.setProperty("padding","0.125rem 1rem 1rem")})),this.setFlexAfterTransition()}onHeaderClick(){this.fixed||(this.collapsed=!this.collapsed,this.animateHeader())}handelSlotChange(n){n.target.assignedElements({flatten:!0}).forEach((t,e)=>{const s=e*.05;t.style.setProperty("transition-delay",`${s}s`)})}handlePointerEnter(){const n=this.renderRoot.querySelector(".expand-icon");this.collapsed?n?.style.setProperty("animation","collapseAnim 0.5s"):n?.style.setProperty("animation","expandAnim 0.5s")}handlePointerLeave(){const n=this.renderRoot.querySelector(".expand-icon");n?.style.setProperty("animation","none")}render(){const n=this.label||this.icon||this.name||this.fixed,t=dt`<svg
      xmlns="http://www.w3.org/2000/svg"
      height="1.125rem"
      viewBox="0 0 24 24"
      width="1.125rem"
      class="expand-icon"
    >
      <path d="M0 0h24v24H0z" fill="none" />
      <path d="M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z" />
    </svg>`,e=dt`
      <div
        class="header"
        title=${this.label??""}
        @pointerenter=${this.handlePointerEnter}
        @pointerleave=${this.handlePointerLeave}
        @click=${this.onHeaderClick}
      >
        ${this.label||this.icon||this.name?dt`<bim-label .icon=${this.icon}>${this.label}</bim-label>`:null}
        ${this.fixed?null:t}
      </div>
    `;return dt`
      <div class="parent">
        ${n?e:null}
        <div class="components" style="flex: 1;">
          <div>
            <slot @slotchange=${this.handelSlotChange}></slot>
          </div>
        </div>
      </div>
    `}};bP.styles=[sa.scrollbar,he`
      :host {
        display: block;
        pointer-events: auto;
      }

      :host .parent {
        display: flex;
        flex-direction: column;
        height: 100%;
      }

      :host(:not([fixed])) .header:hover {
        --bim-label--c: var(--bim-ui_accent-base);
        color: var(--bim-ui_accent-base);
        cursor: pointer;
      }

      :host(:not([fixed])) .header:hover .expand-icon {
        fill: var(--bim-ui_accent-base);
      }

      .header {
        --bim-label--fz: var(--bim-ui_size-sm);
        --bim-label--c: var(
          --bim-panel-section_hc,
          var(--bim-ui_bg-contrast-80)
        );
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: 600;
        height: 1.5rem;
        padding: 0.75rem 1rem;
      }

      .expand-icon {
        fill: var(--bim-ui_bg-contrast-80);
        transition: transform 0.2s;
      }

      :host([collapsed]) .expand-icon {
        transform: rotateZ(-180deg);
      }

      .title {
        display: flex;
        align-items: center;
        column-gap: 0.5rem;
      }

      .title p {
        font-size: var(--bim-ui_size-sm);
      }

      .components {
        display: flex;
        flex-direction: column;
        overflow: hidden;
        row-gap: 0.75rem;
        padding: 0 1rem 1rem;
        box-sizing: border-box;
        transition:
          height 0.25s cubic-bezier(0.65, 0.05, 0.36, 1),
          padding 0.25s cubic-bezier(0.65, 0.05, 0.36, 1);
      }

      .components > div {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        flex: 1;
        overflow: auto;
      }

      :host(:not([icon]):not([label])) .components {
        padding: 1rem;
      }

      :host(:not([fixed])[collapsed]) .components {
        padding: 0 1rem 0;
        height: 0px;
      }

      bim-label {
        pointer-events: none;
      }

      ::slotted(*) {
        transition:
          transform 0.25s cubic-bezier(0.65, 0.05, 0.36, 1),
          opacity 0.25s cubic-bezier(0.65, 0.05, 0.36, 1);
      }

      :host(:not([fixed])[collapsed]) ::slotted(*) {
        transform: translateX(-20%);
        opacity: 0;
      }

      @keyframes expandAnim {
        0%,
        100% {
          transform: translateY(0%);
        }
        25% {
          transform: translateY(-30%);
        }
        50% {
          transform: translateY(10%);
        }
        75% {
          transform: translateY(-30%);
        }
      }

      @keyframes collapseAnim {
        0%,
        100% {
          transform: translateY(0%) rotateZ(-180deg);
        }
        25% {
          transform: translateY(30%) rotateZ(-180deg);
        }
        50% {
          transform: translateY(-10%) rotateZ(-180deg);
        }
        75% {
          transform: translateY(30%) rotateZ(-180deg);
        }
      }
    `];let mh=bP;hp([mt({type:String,reflect:!0})],mh.prototype,"icon");hp([mt({type:String,reflect:!0})],mh.prototype,"label");hp([mt({type:String,reflect:!0})],mh.prototype,"name");hp([mt({type:Boolean,reflect:!0})],mh.prototype,"fixed");hp([mt({type:Boolean,reflect:!0})],mh.prototype,"collapsed");var dW=Object.defineProperty,up=(n,t,e,s)=>{for(var i=void 0,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=o(t,e,i)||i);return i&&dW(t,e,i),i};const _P=class extends ae{constructor(){super(...arguments),this.vertical=!1,this.onValueChange=new Event("change"),this._canEmitEvents=!1,this._value=document.createElement("bim-option"),this.onOptionClick=n=>{this._value=n.target,this.setAnimatedBackgound(),this.dispatchEvent(this.onValueChange);for(const t of this.children)t instanceof _s&&(t.checked=t===n.target)}}get _options(){return[...this.querySelectorAll("bim-option")]}set value(n){const t=this.findOption(n);if(t){for(const e of this._options)e.checked=e===t;this._value=t,this.setAnimatedBackgound(),this._canEmitEvents&&this.dispatchEvent(this.onValueChange)}}get value(){return this._value.value}onSlotChange(n){const t=n.target.assignedElements();for(const e of t)e instanceof _s&&(e.noMark=!0,e.removeEventListener("click",this.onOptionClick),e.addEventListener("click",this.onOptionClick))}findOption(n){return this._options.find(t=>t instanceof _s?t.label===n||t.value===n:!1)}doubleRequestAnimationFrames(n){requestAnimationFrame(()=>requestAnimationFrame(n))}setAnimatedBackgound(n=!1){const t=this.renderRoot.querySelector(".animated-background"),e=this._value;requestAnimationFrame(()=>{var s,i,r,o;const a=(o=(r=(i=(s=e?.parentElement)==null?void 0:s.shadowRoot)==null?void 0:i.querySelector("bim-input"))==null?void 0:r.shadowRoot)==null?void 0:o.querySelector(".input"),l={width:e?.clientWidth,height:e?.clientHeight,top:(e?.offsetTop??0)-(a?.offsetTop??0),left:(e?.offsetLeft??0)-(a?.offsetLeft??0)};t?.style.setProperty("width",`${l.width}px`),t?.style.setProperty("height",`${l.height}px`),t?.style.setProperty("top",`${l.top}px`),t?.style.setProperty("left",`${l.left}px`)}),n&&this.doubleRequestAnimationFrames(()=>{const s="ease";t?.style.setProperty("transition",`width ${.3}s ${s}, height ${.3}s ${s}, top ${.3}s ${s}, left ${.3}s ${s}`)})}firstUpdated(){const n=[...this.children].find(t=>t instanceof _s&&t.checked);n&&(this._value=n),window.addEventListener("load",()=>{this.setAnimatedBackgound(!0)}),new ResizeObserver(()=>{this.setAnimatedBackgound()}).observe(this)}render(){return dt`
      <bim-input
        .vertical=${this.vertical}
        .label=${this.label}
        .icon=${this.icon}
      >
        <div class="animated-background"></div>
        <slot @slotchange=${this.onSlotChange}></slot>
      </bim-input>
    `}};_P.styles=he`
    :host {
      --bim-input--bgc: var(--bim-ui_bg-contrast-20);
      --bim-input--g: 0;
      --bim-option--jc: center;
      flex: 1;
      display: block;
    }

    ::slotted(bim-option) {
      position: relative;
      border-radius: 0;
      overflow: hidden;
      min-width: min-content;
      min-height: min-content;
      transition: background-color 0.2s;
    }

    .animated-background {
      position: absolute;
      background: var(--bim-ui_main-base);
      width: 0;
      height: 0;
      top: 0;
      left: 0;
    }

    ::slotted(bim-option[checked]) {
      --bim-label--c: var(--bim-ui_main-contrast);
    }

    ::slotted(bim-option:not([checked]):hover) {
      background-color: #0003;
    }
  `;let gh=_P;up([mt({type:String,reflect:!0})],gh.prototype,"name");up([mt({type:String,reflect:!0})],gh.prototype,"icon");up([mt({type:String,reflect:!0})],gh.prototype,"label");up([mt({type:Boolean,reflect:!0})],gh.prototype,"vertical");up([dh()],gh.prototype,"_value");const pW=()=>dt`
    <style>
      div {
        display: flex;
        gap: 0.375rem;
        border-radius: 0.25rem;
        min-height: 1.25rem;
      }

      [data-type="row"] {
        background-color: var(--bim-ui_bg-contrast-10);
        animation: row-loading 1s linear infinite alternate;
        padding: 0.5rem;
      }

      [data-type="cell"] {
        background-color: var(--bim-ui_bg-contrast-20);
        flex: 0.25;
      }

      @keyframes row-loading {
        0% {
          background-color: var(--bim-ui_bg-contrast-10);
        }
        100% {
          background-color: var(--bim-ui_bg-contrast-20);
        }
      }
    </style>
    <div style="display: flex; flex-direction: column;">
      <div data-type="row" style="gap: 2rem">
        <div data-type="cell" style="flex: 1"></div>
        <div data-type="cell" style="flex: 2"></div>
        <div data-type="cell" style="flex: 1"></div>
        <div data-type="cell" style="flex: 0.5"></div>
      </div>
      <div style="display: flex;">
        <div data-type="row" style="flex: 1">
          <div data-type="cell" style="flex: 0.5"></div>
        </div>
        <div data-type="row" style="flex: 2">
          <div data-type="cell" style="flex: 0.75"></div>
        </div>
        <div data-type="row" style="flex: 1">
          <div data-type="cell"></div>
        </div>
        <div data-type="row" style="flex: 0.5">
          <div data-type="cell" style="flex: 0.75"></div>
        </div>
      </div>
      <div style="display: flex;">
        <div data-type="row" style="flex: 1">
          <div data-type="cell" style="flex: 0.75"></div>
        </div>
        <div data-type="row" style="flex: 2">
          <div data-type="cell"></div>
        </div>
        <div data-type="row" style="flex: 1">
          <div data-type="cell" style="flex: 0.5"></div>
        </div>
        <div data-type="row" style="flex: 0.5">
          <div data-type="cell" style="flex: 0.5"></div>
        </div>
      </div>
      <div style="display: flex;">
        <div data-type="row" style="flex: 1">
          <div data-type="cell"></div>
        </div>
        <div data-type="row" style="flex: 2">
          <div data-type="cell" style="flex: 0.5"></div>
        </div>
        <div data-type="row" style="flex: 1">
          <div data-type="cell" style="flex: 0.75"></div>
        </div>
        <div data-type="row" style="flex: 0.5">
          <div data-type="cell" style="flex: 0.7s5"></div>
        </div>
      </div>
    </div>
  `,fW=()=>dt`
    <style>
      .loader {
        grid-area: Processing;
        position: relative;
        padding: 0.125rem;
      }
      .loader:before {
        content: "";
        position: absolute;
      }
      .loader .loaderBar {
        position: absolute;
        top: 0;
        right: 100%;
        bottom: 0;
        left: 0;
        background: var(--bim-ui_main-base);
        /* width: 25%; */
        width: 0;
        animation: borealisBar 2s linear infinite;
      }

      @keyframes borealisBar {
        0% {
          left: 0%;
          right: 100%;
          width: 0%;
        }
        10% {
          left: 0%;
          right: 75%;
          width: 25%;
        }
        90% {
          right: 0%;
          left: 75%;
          width: 25%;
        }
        100% {
          left: 100%;
          right: 0%;
          width: 0%;
        }
      }
    </style>
    <div class="loader">
      <div class="loaderBar"></div>
    </div>
  `;var mW=Object.defineProperty,gW=(n,t,e,s)=>{for(var i=void 0,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=o(t,e,i)||i);return i&&mW(t,e,i),i};const yP=class extends ae{constructor(){super(...arguments),this.column="",this.columnIndex=0,this.rowData={}}get data(){return this.column?this.rowData[this.column]:null}render(){return dt`
      <style>
        :host {
          grid-area: ${this.column??"unset"};
        }
      </style>
      <slot></slot>
    `}};yP.styles=he`
    :host {
      padding: 0.375rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    :host([data-column-index="0"]) {
      justify-content: normal;
    }

    :host([data-column-index="0"]:not([data-cell-header]))
      ::slotted(bim-label) {
      text-align: left;
    }

    ::slotted(*) {
      --bim-input--bgc: transparent;
      --bim-input--olc: var(--bim-ui_bg-contrast-20);
      --bim-input--olw: 1px;
    }

    ::slotted(bim-input) {
      --bim-input--olw: 0;
    }

    ::slotted(bim-label) {
      white-space: normal;
      text-align: center;
    }
  `;let vP=yP;gW([mt({type:String,reflect:!0})],vP.prototype,"column");const wP=class extends ae{constructor(){super(...arguments),this._groups=[],this.group=this.closest("bim-table-group"),this._data=[],this.table=this.closest("bim-table")}get data(){var n;return((n=this.group)==null?void 0:n.data.children)??this._data}set data(n){this._data=n}render(){return this._groups=[],dt`
      <slot></slot>
      ${this.data.map(n=>{const t=document.createElement("bim-table-group");return this._groups.push(t),t.table=this.table,t.data=n,t})}
    `}};wP.styles=he`
    :host {
      --bim-button--bgc: transparent;
      position: relative;
      display: block;
      overflow: hidden;
      grid-area: Children;
    }

    :host([hidden]) {
      height: 0;
      opacity: 0;
    }

    ::slotted(.branch.branch-vertical) {
      top: 0;
      bottom: 1.125rem;
    }
  `;let bW=wP;var _W=Object.defineProperty,yW=(n,t,e,s)=>{for(var i=void 0,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=o(t,e,i)||i);return i&&_W(t,e,i),i};const EP=class extends ae{constructor(){super(...arguments),this.childrenHidden=!0,this.table=this.closest("bim-table"),this.data={data:{}}}get rowElement(){const n=this.shadowRoot;return n?n.querySelector("bim-table-row"):null}get childrenElement(){const n=this.shadowRoot;return n?n.querySelector("bim-table-children"):null}get _isChildrenEmpty(){return!(this.data.children&&this.data.children.length!==0)}connectedCallback(){super.connectedCallback(),this.table&&this.table.expanded?this.childrenHidden=!1:this.childrenHidden=!0}toggleChildren(n){this.childrenHidden=typeof n>"u"?!this.childrenHidden:!n,this.animateTableChildren(!0)}animateTableChildren(n=!0){if(!n){requestAnimationFrame(()=>{var r;const o=this.renderRoot.querySelector(".caret"),a=this.renderRoot.querySelector(".branch-vertical"),l=(r=this.renderRoot.querySelector("bim-table-children"))==null?void 0:r.querySelector(".branch-vertical");o.style.setProperty("transform",`translateY(-50%) rotate(${this.childrenHidden?"0":"90"}deg)`),a.style.setProperty("transform",`scaleY(${this.childrenHidden?"0":"1"})`),l?.style.setProperty("transform",`scaleY(${this.childrenHidden?"0":"1"})`)});return}const t=500,e=0,s=200,i=350;requestAnimationFrame(()=>{var r;const o=this.renderRoot.querySelector("bim-table-children"),a=this.renderRoot.querySelector(".caret"),l=this.renderRoot.querySelector(".branch-vertical"),c=(r=this.renderRoot.querySelector("bim-table-children"))==null?void 0:r.querySelector(".branch-vertical"),h=()=>{const m=o?.renderRoot.querySelectorAll("bim-table-group");m?.forEach((b,f)=>{b.style.setProperty("opacity","0"),b.style.setProperty("left","-30px");const _=[{opacity:"0",left:"-30px"},{opacity:"1",left:"0"}];b.animate(_,{duration:t/2,delay:50+f*e,easing:"cubic-bezier(0.65, 0.05, 0.36, 1)",fill:"forwards"})})},u=()=>{const m=[{transform:"translateY(-50%) rotate(90deg)"},{transform:"translateY(-50%) rotate(0deg)"}];a?.animate(m,{duration:i,easing:"cubic-bezier(0.68, -0.55, 0.27, 1.55)",fill:"forwards",direction:this.childrenHidden?"normal":"reverse"})},p=()=>{const m=[{transform:"scaleY(1)"},{transform:"scaleY(0)"}];l?.animate(m,{duration:s,easing:"cubic-bezier(0.4, 0, 0.2, 1)",delay:e,fill:"forwards",direction:this.childrenHidden?"normal":"reverse"})},d=()=>{var m;const b=(m=this.renderRoot.querySelector("bim-table-row"))==null?void 0:m.querySelector(".branch-horizontal");if(b){b.style.setProperty("transform-origin","center right");const f=[{transform:"scaleX(0)"},{transform:"scaleX(1)"}];b.animate(f,{duration:s,easing:"cubic-bezier(0.4, 0, 0.2, 1)",fill:"forwards",direction:this.childrenHidden?"normal":"reverse"})}},g=()=>{const m=[{transform:"scaleY(0)"},{transform:"scaleY(1)"}];c?.animate(m,{duration:s*1.2,easing:"cubic-bezier(0.4, 0, 0.2, 1)",fill:"forwards",delay:(e+s)*.7})};h(),u(),p(),d(),g()})}firstUpdated(){this.renderRoot.querySelectorAll(".caret").forEach(n=>{var t,e,s;if(!this.childrenHidden){n.style.setProperty("transform","translateY(-50%) rotate(90deg)");const i=(t=n.parentElement)==null?void 0:t.querySelector(".branch-horizontal");i&&i.style.setProperty("transform","scaleX(0)");const r=(s=(e=n.parentElement)==null?void 0:e.parentElement)==null?void 0:s.querySelectorAll(".branch-vertical");r?.forEach(o=>{o.style.setProperty("transform","scaleY(1)")})}})}render(){if(!this.table)throw new Error("TableGroup: parent table wasn't found!");const n=this.table.getGroupIndentation(this.data)??0,t=dt`
      ${this.table.noIndentation?null:dt`
            <style>
              .branch-vertical {
                left: ${n+(this.table.selectableRows?1.9375:.5625)}rem;
              }
            </style>
            <div class="branch branch-vertical"></div>
          `}
    `;let e=null;this.table.noIndentation||(e=document.createElement("div"),e.classList.add("branch","branch-horizontal"),e.style.left=`${n-1+(this.table.selectableRows?2.05:.5625)}rem`);let s=null;if(!this.table.noIndentation){s=document.createElement("div");const o=document.createElementNS("http://www.w3.org/2000/svg","svg");if(o.setAttribute("height","9.9"),o.setAttribute("width","7.5"),o.setAttribute("viewBox","0 0 4.6666672 7.7"),this.table.noCarets){const a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttribute("cx","2.3333336"),a.setAttribute("cy","3.85"),a.setAttribute("r","2.5"),o.append(a)}else{const a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d","m 1.7470835,6.9583848 2.5899999,-2.59 c 0.39,-0.39 0.39,-1.02 0,-1.41 L 1.7470835,0.36838483 c -0.63,-0.62000003 -1.71000005,-0.18 -1.71000005,0.70999997 v 5.17 c 0,0.9 1.08000005,1.34 1.71000005,0.71 z"),o.append(a),s.style.cursor="pointer",s.addEventListener("click",l=>{l.stopPropagation(),this.toggleChildren()})}s.classList.add("caret"),s.style.left=`${(this.table.selectableRows?1.5:.125)+n}rem`,s.append(o)}const i=document.createElement("bim-table-row");if(!this._isChildrenEmpty){const o=document.createDocumentFragment();Gc(t,o),i.append(o)}i.table=this.table,i.group=this,this.table.dispatchEvent(new CustomEvent("rowcreated",{detail:{row:i}})),s&&!this._isChildrenEmpty&&i.append(s),n!==0&&e&&i.append(e);let r;if(!this._isChildrenEmpty&&!this.childrenHidden){r=document.createElement("bim-table-children"),r.table=this.table,r.group=this;const o=document.createDocumentFragment();Gc(t,o),r.append(o),this.animateTableChildren()}return dt`<div class="parent">${i} ${r}</div>`}};EP.styles=he`
    :host {
      position: relative;
    }

    .parent {
      display: grid;
      grid-template-areas: "Data" "Children";
    }

    .branch {
      position: absolute;
      z-index: 1;
    }

    .branch-vertical {
      border-left: 1px dotted var(--bim-ui_bg-contrast-40);
      transform-origin: top center;
      transform: scaleY(0);
    }

    .branch-horizontal {
      top: 50%;
      width: 1rem;
      border-bottom: 1px dotted var(--bim-ui_bg-contrast-40);
    }

    .branch-horizontal {
      transform-origin: center left;
    }

    .caret {
      position: absolute;
      z-index: 2;
      transform: translateY(-50%) rotate(0deg);
      top: 50%;
      display: flex;
      width: 0.95rem;
      height: 0.95rem;
      justify-content: center;
      align-items: center;
    }

    .caret svg {
      fill: var(--bim-ui_bg-contrast-60);
    }
  `;let xP=EP;yW([mt({type:Boolean,attribute:"children-hidden",reflect:!0})],xP.prototype,"childrenHidden");var vW=Object.defineProperty,dp=(n,t,e,s)=>{for(var i=void 0,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=o(t,e,i)||i);return i&&vW(t,e,i),i};const IP=class extends ae{constructor(){super(...arguments),this.selected=!1,this.columns=[],this.hiddenColumns=[],this.group=this.closest("bim-table-group"),this._data={},this.isHeader=!1,this.table=this.closest("bim-table"),this.onTableColumnsChange=()=>{this.table&&(this.columns=this.table.columns)},this.onTableColumnsHidden=()=>{this.table&&(this.hiddenColumns=this.table.hiddenColumns)},this._observer=new IntersectionObserver(n=>{this._intersecting=n[0].isIntersecting},{rootMargin:"36px"})}get groupData(){var n;return(n=this.group)==null?void 0:n.data}get data(){var n;return((n=this.group)==null?void 0:n.data.data)??this._data}set data(n){this._data=n}get _columnNames(){return this.columns.filter(n=>!this.hiddenColumns.includes(n.name)).map(n=>n.name)}get _columnWidths(){return this.columns.filter(n=>!this.hiddenColumns.includes(n.name)).map(n=>n.width)}get _isSelected(){var n;return(n=this.table)==null?void 0:n.selection.has(this.data)}onSelectionChange(n){if(!this.table)return;const t=n.target;this.selected=t.value,t.value?(this.table.selection.add(this.data),this.table.dispatchEvent(new CustomEvent("rowselected",{detail:{data:this.data}}))):(this.table.selection.delete(this.data),this.table.dispatchEvent(new CustomEvent("rowdeselected",{detail:{data:this.data}})))}connectedCallback(){super.connectedCallback(),this._observer.observe(this),this.table&&(this.columns=this.table.columns,this.hiddenColumns=this.table.hiddenColumns,this.table.addEventListener("columnschange",this.onTableColumnsChange),this.table.addEventListener("columnshidden",this.onTableColumnsHidden),this.toggleAttribute("selected",this._isSelected))}disconnectedCallback(){super.disconnectedCallback(),this._observer.unobserve(this),this.table&&(this.columns=[],this.hiddenColumns=[],this.table.removeEventListener("columnschange",this.onTableColumnsChange),this.table.removeEventListener("columnshidden",this.onTableColumnsHidden),this.toggleAttribute("selected",!1))}compute(){if(!this.table)throw new Error("TableRow: parent table wasn't found!");const n=this.table.getRowIndentation(this.data)??0,t=this.isHeader?this.data:this.table.applyDataTransform(this.group)??this.data,e=[];for(const s in t){if(this.hiddenColumns.includes(s))continue;const i=t[s];let r;if(typeof i=="string"||typeof i=="boolean"||typeof i=="number"?(r=document.createElement("bim-label"),r.textContent=String(i)):Array.isArray(i)?(r=document.createElement("bim-label"),r.textContent=i.join(", ")):i instanceof HTMLElement?r=i:(r=document.createDocumentFragment(),Gc(i,r)),!r)continue;const o=document.createElement("bim-table-cell");o.append(r),o.column=s,this._columnNames.indexOf(s)===0&&(o.style.marginLeft=`${this.table.noIndentation?0:n+.75}rem`);const a=this._columnNames.indexOf(s);o.setAttribute("data-column-index",String(a)),o.toggleAttribute("data-no-indentation",a===0&&this.table.noIndentation),o.toggleAttribute("data-cell-header",this.isHeader),o.rowData=this.data,this.table.dispatchEvent(new CustomEvent("cellcreated",{detail:{cell:o}})),e.push(o)}return this.style.gridTemplateAreas=`"${this.table.selectableRows?"Selection":""} ${this._columnNames.join(" ")}"`,this.style.gridTemplateColumns=`${this.table.selectableRows?"1.6rem":""} ${this._columnWidths.join(" ")}`,dt`
      ${!this.isHeader&&this.table.selectableRows?dt`<bim-checkbox
            @change=${this.onSelectionChange}
            .checked=${this._isSelected}
            style="align-self: center; justify-self: center"
          ></bim-checkbox>`:null}
      ${e}
      <slot></slot>
    `}render(){return dt`${this._intersecting?this.compute():dt``}`}};IP.styles=he`
    :host {
      position: relative;
      grid-area: Data;
      display: grid;
      min-height: 2.25rem;
      transition: all 0.15s;
    }

    ::slotted(.branch.branch-vertical) {
      top: 50%;
      bottom: 0;
    }

    :host([selected]) {
      background-color: color-mix(
        in lab,
        var(--bim-ui_bg-contrast-20) 30%,
        var(--bim-ui_main-base) 10%
      );
    }
  `;let bh=IP;dp([mt({type:Boolean,reflect:!0})],bh.prototype,"selected");dp([mt({attribute:!1})],bh.prototype,"columns");dp([mt({attribute:!1})],bh.prototype,"hiddenColumns");dp([mt({type:Boolean,attribute:"is-header",reflect:!0})],bh.prototype,"isHeader");dp([dh()],bh.prototype,"_intersecting");var wW=Object.defineProperty,EW=Object.getOwnPropertyDescriptor,_n=(n,t,e,s)=>{for(var i=s>1?void 0:s?EW(t,e):t,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(t,e,i):o(i))||i);return s&&i&&wW(t,e,i),i};const CP=class extends ae{constructor(){super(...arguments),this._filteredData=[],this.headersHidden=!1,this.minColWidth="4rem",this._columns=[],this._textDelimiters={comma:",",tab:"	"},this._queryString=null,this._data=[],this.expanded=!1,this.preserveStructureOnFilter=!1,this.indentationInText=!1,this.dataTransform={},this.selectableRows=!1,this.selection=new Set,this.noIndentation=!1,this.noCarets=!1,this.loading=!1,this._errorLoading=!1,this._onColumnsHidden=new Event("columnshidden"),this._hiddenColumns=[],this._stringFilterFunction=(n,t)=>Object.values(t.data).some(e=>String(e).toLowerCase().includes(n.toLowerCase())),this._queryFilterFunction=(n,t)=>{let e=!1;const s=Uy(n)??[];for(const i of s){if("queries"in i){e=!1;break}const{condition:r,value:o}=i;let{key:a}=i;if(a.startsWith("[")&&a.endsWith("]")){const l=a.replace("[","").replace("]","");a=l,e=Object.keys(t.data).filter(c=>c.includes(l)).map(c=>iC(t.data[c],r,o)).some(c=>c)}else e=iC(t.data[a],r,o);if(!e)break}return e}}set columns(n){const t=[];for(const e of n){const s=typeof e=="string"?{name:e,width:`minmax(${this.minColWidth}, 1fr)`}:e;t.push(s)}this._columns=t,this.computeMissingColumns(this.data),this.dispatchEvent(new Event("columnschange"))}get columns(){return this._columns}get _headerRowData(){const n={};for(const t of this.columns){const{name:e}=t;n[e]=String(e)}return n}get value(){return this._filteredData}set queryString(n){this.toggleAttribute("data-processing",!0),this._queryString=n&&n.trim()!==""?n.trim():null,this.updateFilteredData(),this.toggleAttribute("data-processing",!1)}get queryString(){return this._queryString}set data(n){this._data=n,this.updateFilteredData(),this.computeMissingColumns(n)&&(this.columns=this._columns)}get data(){return this._data}get dataAsync(){return new Promise(n=>{setTimeout(()=>{n(this.data)})})}set hiddenColumns(n){this._hiddenColumns=n,setTimeout(()=>{this.dispatchEvent(this._onColumnsHidden)})}get hiddenColumns(){return this._hiddenColumns}updateFilteredData(){this.queryString?(Uy(this.queryString)?(this.filterFunction=this._queryFilterFunction,this._filteredData=this.filter(this.queryString)):(this.filterFunction=this._stringFilterFunction,this._filteredData=this.filter(this.queryString)),this.preserveStructureOnFilter&&(this._expandedBeforeFilter===void 0&&(this._expandedBeforeFilter=this.expanded),this.expanded=!0)):(this.preserveStructureOnFilter&&this._expandedBeforeFilter!==void 0&&(this.expanded=this._expandedBeforeFilter,this._expandedBeforeFilter=void 0),this._filteredData=this.data)}computeMissingColumns(n){let t=!1;for(const e of n){const{children:s,data:i}=e;for(const r in i)this._columns.map(o=>typeof o=="string"?o:o.name).includes(r)||(this._columns.push({name:r,width:`minmax(${this.minColWidth}, 1fr)`}),t=!0);if(s){const r=this.computeMissingColumns(s);r&&!t&&(t=r)}}return t}generateText(n="comma",t=this.value,e="",s=!0){const i=this._textDelimiters[n];let r="";const o=this.columns.map(a=>a.name);if(s){this.indentationInText&&(r+=`Indentation${i}`);const a=`${o.join(i)}
`;r+=a}for(const[a,l]of t.entries()){const{data:c,children:h}=l,u=this.indentationInText?`${e}${a+1}${i}`:"",p=o.map(g=>c[g]??""),d=`${u}${p.join(i)}
`;r+=d,h&&(r+=this.generateText(n,l.children,`${e}${a+1}.`,!1))}return r}get csv(){return this.generateText("comma")}get tsv(){return this.generateText("tab")}applyDataTransform(n){const t={};if(!n)return t;const{data:e}=n.data;for(const i of Object.keys(this.dataTransform)){const r=this.columns.find(o=>o.name===i);r&&r.forceDataTransform&&(i in e||(e[i]=""))}const s=e;for(const i in s){const r=this.dataTransform[i];r?t[i]=r(s[i],e,n):t[i]=e[i]}return t}downloadData(n="BIM Table Data",t="json"){let e=null;if(t==="json"&&(e=new File([JSON.stringify(this.value,void 0,2)],`${n}.json`)),t==="csv"&&(e=new File([this.csv],`${n}.csv`)),t==="tsv"&&(e=new File([this.tsv],`${n}.tsv`)),!e)return;const s=document.createElement("a");s.href=URL.createObjectURL(e),s.download=e.name,s.click(),URL.revokeObjectURL(s.href)}getRowIndentation(n,t=this.value,e=0){for(const s of t){if(s.data===n)return e;if(s.children){const i=this.getRowIndentation(n,s.children,e+1);if(i!==null)return i}}return null}getGroupIndentation(n,t=this.value,e=0){for(const s of t){if(s===n)return e;if(s.children){const i=this.getGroupIndentation(n,s.children,e+1);if(i!==null)return i}}return null}connectedCallback(){super.connectedCallback(),this.dispatchEvent(new Event("connected"))}disconnectedCallback(){super.disconnectedCallback(),this.dispatchEvent(new Event("disconnected"))}async loadData(n=!1){if(this._filteredData.length!==0&&!n||!this.loadFunction)return!1;this.loading=!0;try{const t=await this.loadFunction();return this.data=t,this.loading=!1,this._errorLoading=!1,!0}catch(t){if(this.loading=!1,this._filteredData.length!==0)return!1;const e=this.querySelector("[slot='error-loading']"),s=e?.querySelector("[data-table-element='error-message']");return t instanceof Error&&s&&t.message.trim()!==""&&(s.textContent=t.message),this._errorLoading=!0,!1}}filter(n,t=this.filterFunction??this._stringFilterFunction,e=this.data){const s=[];for(const i of e)if(t(n,i)){if(this.preserveStructureOnFilter){const r={data:i.data};if(i.children){const o=this.filter(n,t,i.children);o.length&&(r.children=o)}s.push(r)}else if(s.push({data:i.data}),i.children){const r=this.filter(n,t,i.children);s.push(...r)}}else if(i.children){const r=this.filter(n,t,i.children);this.preserveStructureOnFilter&&r.length?s.push({data:i.data,children:r}):s.push(...r)}return s}get _missingDataElement(){return this.querySelector("[slot='missing-data']")}render(){if(this.loading)return pW();if(this._errorLoading)return dt`<slot name="error-loading"></slot>`;if(this._filteredData.length===0&&this._missingDataElement)return dt`<slot name="missing-data"></slot>`;const n=document.createElement("bim-table-row");n.table=this,n.isHeader=!0,n.data=this._headerRowData,n.style.gridArea="Header",n.style.position="sticky",n.style.top="0",n.style.zIndex="5";const t=document.createElement("bim-table-children");return t.table=this,t.data=this.value,t.style.gridArea="Body",t.style.backgroundColor="transparent",dt`
      <div class="parent">
        ${this.headersHidden?null:n} ${fW()}
        <div style="overflow-x: hidden; grid-area: Body">${t}</div>
      </div>
    `}};CP.styles=[sa.scrollbar,he`
      :host {
        position: relative;
        overflow: auto;
        display: block;
        pointer-events: auto;
      }

      :host(:not([data-processing])) .loader {
        display: none;
      }

      .parent {
        display: grid;
        grid-template:
          "Header" auto
          "Processing" auto
          "Body" 1fr
          "Footer" auto;
        overflow: auto;
        height: 100%;
      }

      .parent > bim-table-row[is-header] {
        color: var(--bim-table_header--c, var(--bim-ui_bg-contrast-100));
        background-color: var(
          --bim-table_header--bgc,
          var(--bim-ui_bg-contrast-20)
        );
      }

      .controls {
        display: flex;
        gap: 0.375rem;
        flex-wrap: wrap;
        margin-bottom: 0.5rem;
      }
    `];let $i=CP;_n([dh()],$i.prototype,"_filteredData",2);_n([mt({type:Boolean,attribute:"headers-hidden",reflect:!0})],$i.prototype,"headersHidden",2);_n([mt({type:String,attribute:"min-col-width",reflect:!0})],$i.prototype,"minColWidth",2);_n([mt({type:Array,attribute:!1})],$i.prototype,"columns",1);_n([mt({type:Array,attribute:!1})],$i.prototype,"data",1);_n([mt({type:Boolean,reflect:!0})],$i.prototype,"expanded",2);_n([mt({type:Boolean,reflect:!0,attribute:"selectable-rows"})],$i.prototype,"selectableRows",2);_n([mt({attribute:!1})],$i.prototype,"selection",2);_n([mt({type:Boolean,attribute:"no-indentation",reflect:!0})],$i.prototype,"noIndentation",2);_n([mt({type:Boolean,attribute:"no-carets",reflect:!0})],$i.prototype,"noCarets",2);_n([mt({type:Boolean,reflect:!0})],$i.prototype,"loading",2);_n([dh()],$i.prototype,"_errorLoading",2);var xW=Object.defineProperty,IW=Object.getOwnPropertyDescriptor,_h=(n,t,e,s)=>{for(var i=s>1?void 0:s?IW(t,e):t,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(t,e,i):o(i))||i);return s&&i&&xW(t,e,i),i};const TP=class extends ae{constructor(){super(...arguments),this._switchers=[],this.bottom=!1,this.switchersHidden=!1,this.floating=!1,this.switchersFull=!1,this.onTabHiddenChange=n=>{const t=n.target;t instanceof pi&&!t.hidden&&(t.removeEventListener("hiddenchange",this.onTabHiddenChange),this.tab=t.name,t.addEventListener("hiddenchange",this.onTabHiddenChange))}}set tab(n){this._tab=n;const t=[...this.children],e=t.find(s=>s instanceof pi&&s.name===n);for(const s of t){if(!(s instanceof pi))continue;s.hidden=e!==s;const i=this.getTabSwitcher(s.name);i&&i.toggleAttribute("data-active",!s.hidden)}e||(this._tab="hidden",this.setAttribute("tab","hidden"))}get tab(){return this._tab}getTabSwitcher(n){return this._switchers.find(t=>t.getAttribute("data-name")===n)}createSwitchers(){this._switchers=[];for(const n of this.children){if(!(n instanceof pi))continue;const t=document.createElement("div");t.addEventListener("click",()=>{this.tab===n.name?this.toggleAttribute("tab",!1):this.tab=n.name,this.setAnimatedBackgound()}),t.setAttribute("data-name",n.name),t.className="switcher";const e=document.createElement("bim-label");e.textContent=n.label??null,e.icon=n.icon,t.append(e),this._switchers.push(t)}}updateSwitchers(){for(const n of this.children){if(!(n instanceof pi))continue;const t=this._switchers.find(s=>s.getAttribute("data-name")===n.name);if(!t)continue;const e=t.querySelector("bim-label");e&&(e.textContent=n.label??null,e.icon=n.icon)}}onSlotChange(n){this.createSwitchers();const t=n.target.assignedElements(),e=t.find(s=>s instanceof pi?this.tab?s.name===this.tab:!s.hidden:!1);e&&e instanceof pi&&(this.tab=e.name);for(const s of t){if(!(s instanceof pi)){s.remove();continue}s.removeEventListener("hiddenchange",this.onTabHiddenChange),e!==s&&(s.hidden=!0),s.addEventListener("hiddenchange",this.onTabHiddenChange)}}doubleRequestAnimationFrames(n){requestAnimationFrame(()=>requestAnimationFrame(n))}setAnimatedBackgound(n=!1){var t;const e=this.renderRoot.querySelector(".animated-background"),s=[...((t=this.renderRoot.querySelector(".switchers"))==null?void 0:t.querySelectorAll(".switcher"))||[]].filter(i=>i.hasAttribute("data-active"))[0];requestAnimationFrame(()=>{var i,r,o,a;const l=(a=(o=(r=(i=s?.parentElement)==null?void 0:i.shadowRoot)==null?void 0:r.querySelector("bim-input"))==null?void 0:o.shadowRoot)==null?void 0:a.querySelector(".input"),c={width:s?.clientWidth,height:s?.clientHeight,top:(s?.offsetTop??0)-(l?.offsetTop??0),left:(s?.offsetLeft??0)-(l?.offsetLeft??0)};s?(e?.style.setProperty("width",`${c.width}px`),e?.style.setProperty("height",`${c.height}px`),e?.style.setProperty("left",`${c.left}px`)):e?.style.setProperty("width","0"),this.bottom?(e?.style.setProperty("top","100%"),e?.style.setProperty("transform","translateY(-100%)")):e?.style.setProperty("top",`${c.top}px`)}),n&&this.doubleRequestAnimationFrames(()=>{const i="ease";e?.style.setProperty("transition",`width ${.3}s ${i}, height ${.3}s ${i}, top ${.3}s ${i}, left ${.3}s ${i}`)})}firstUpdated(){requestAnimationFrame(()=>{this.setAnimatedBackgound(!0)}),new ResizeObserver(()=>{this.setAnimatedBackgound()}).observe(this)}render(){return dt`
      <div class="parent">
        <div class="switchers">
          <div class="animated-background"></div>
          ${this._switchers}
        </div>
        <div class="content">
          <slot @slotchange=${this.onSlotChange}></slot>
        </div>
      </div>
    `}};TP.styles=[sa.scrollbar,he`
      * {
        box-sizing: border-box;
      }

      :host {
        background-color: var(--bim-ui_bg-base);
        display: block;
        overflow: auto;
      }

      .parent {
        display: grid;
        overflow: hidden;
        position: relative;
        grid-template: "switchers" auto "content" 1fr;
        height: 100%;
      }

      :host([bottom]) .parent {
        grid-template: "content" 1fr "switchers" auto;
      }

      .switchers {
        position: relative;
        display: flex;
        height: 2.25rem;
        font-weight: 600;
        grid-area: switchers;
      }

      .switcher {
        --bim-label--c: var(--bim-ui_bg-contrast-80);
        background-color: transparent;
        position: relative;
        cursor: pointer;
        pointer-events: auto;
        padding: 0rem 0.75rem;
        display: flex;
        justify-content: center;
        z-index: 2;
        transition: all 0.15s;
      }

      .switcher:not([data-active]):hover {
        filter: brightness(150%);
      }

      :host([switchers-full]) .switcher {
        flex: 1;
      }

      .switcher[data-active] {
        --bim-label--c: var(--bim-ui_main-contrast);
      }

      .switchers bim-label {
        pointer-events: none;
      }

      :host([switchers-hidden]) .switchers {
        display: none;
      }

      .content {
        position: relative;
        display: grid;
        grid-template-columns: 1fr;
        grid-area: content;
        max-height: 100vh;
        overflow: auto;
        transition: max-height 0.2s;
      }

      :host([tab="hidden"]) .content {
        max-height: 0;
      }

      .animated-background {
        position: absolute;
        background: var(--bim-ui_main-base);
        width: 0;
        height: 0;
        top: 0;
        left: 0;
      }

      :host(:not([bottom])) .content {
        border-top: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([bottom]) .content {
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating]) {
        background-color: transparent;
      }

      :host([floating]) .switchers {
        justify-self: center;
        overflow: hidden;
        background-color: var(--bim-ui_bg-base);
      }

      :host([floating]:not([bottom])) .switchers {
        border-radius: var(--bim-ui_size-2xs) var(--bim-ui_size-2xs) 0 0;
        border-top: 1px solid var(--bim-ui_bg-contrast-20);
        border-left: 1px solid var(--bim-ui_bg-contrast-20);
        border-right: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating][bottom]) .switchers {
        border-radius: 0 0 var(--bim-ui_size-2xs) var(--bim-ui_size-2xs);
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
        border-left: 1px solid var(--bim-ui_bg-contrast-20);
        border-right: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating][tab="hidden"]) .switchers {
        border-radius: var(--bim-ui_size-2xs);
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating][bottom][tab="hidden"]) .switchers {
        border-top: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating]) .content {
        border: 1px solid var(--bim-ui_bg-contrast-20);
        border-radius: var(--bim-ui_size-2xs);
        background-color: var(--bim-ui_bg-base);
      }
    `];let Gr=TP;_h([dh()],Gr.prototype,"_switchers",2);_h([mt({type:Boolean,reflect:!0})],Gr.prototype,"bottom",2);_h([mt({type:Boolean,attribute:"switchers-hidden",reflect:!0})],Gr.prototype,"switchersHidden",2);_h([mt({type:Boolean,reflect:!0})],Gr.prototype,"floating",2);_h([mt({type:String,reflect:!0})],Gr.prototype,"tab",1);_h([mt({type:Boolean,attribute:"switchers-full",reflect:!0})],Gr.prototype,"switchersFull",2);var CW=Object.defineProperty,TW=Object.getOwnPropertyDescriptor,ib=(n,t,e,s)=>{for(var i=s>1?void 0:s?TW(t,e):t,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(t,e,i):o(i))||i);return s&&i&&CW(t,e,i),i};const AP=class extends ae{constructor(){super(...arguments),this._defaultName="__unnamed__",this.name=this._defaultName,this._hidden=!1}set label(n){this._label=n;const t=this.parentElement;t instanceof Gr&&t.updateSwitchers()}get label(){return this._label}set icon(n){this._icon=n;const t=this.parentElement;t instanceof Gr&&t.updateSwitchers()}get icon(){return this._icon}set hidden(n){this._hidden=n,this.dispatchEvent(new Event("hiddenchange"))}get hidden(){return this._hidden}connectedCallback(){super.connectedCallback();const{parentElement:n}=this;if(n&&this.name===this._defaultName){const t=[...n.children].indexOf(this);this.name=`${this._defaultName}${t}`}}render(){return dt` <slot></slot> `}};AP.styles=he`
    :host {
      display: block;
      height: 100%;
      grid-row-start: 1;
      grid-column-start: 1;
      animation: openAnim 3s forwards;
      transform: translateY(0);
      max-height: 100vh;
      transition:
        opacity 0.3s ease,
        max-height 0.6s ease,
        transform 0.3s ease;
    }

    :host([hidden]) {
      transform: translateY(-20px);
      max-height: 0;
      opacity: 0;
      overflow: hidden;
      visibility: hidden;
    }
  `;let pi=AP;ib([mt({type:String,reflect:!0})],pi.prototype,"name",2);ib([mt({type:String,reflect:!0})],pi.prototype,"label",1);ib([mt({type:String,reflect:!0})],pi.prototype,"icon",1);ib([mt({type:Boolean,reflect:!0})],pi.prototype,"hidden",1);/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const nC=n=>n??Xe;var AW=Object.defineProperty,SW=Object.getOwnPropertyDescriptor,kn=(n,t,e,s)=>{for(var i=s>1?void 0:s?SW(t,e):t,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(t,e,i):o(i))||i);return s&&i&&AW(t,e,i),i};const SP=class extends ae{constructor(){super(...arguments),this._inputTypes=["date","datetime-local","email","month","password","search","tel","text","time","url","week","area"],this.value="",this.vertical=!1,this.disabled=!1,this.resize="vertical",this._type="text",this.onValueChange=new Event("input")}set type(n){this._inputTypes.includes(n)&&(this._type=n)}get type(){return this._type}get query(){return Uy(this.value)}onInputChange(n){n.stopPropagation();const t=n.target;clearTimeout(this._debounceTimeoutID),this._debounceTimeoutID=setTimeout(()=>{this.value=t.value,this.dispatchEvent(this.onValueChange)},this.debounce)}focus(){setTimeout(()=>{var n;const t=(n=this.shadowRoot)==null?void 0:n.querySelector("input");t?.focus()})}render(){return dt`
      <bim-input
        .name=${this.name}
        .icon=${this.icon}
        .label=${this.label}
        .vertical=${this.vertical}
      >
        ${this.type==="area"?dt` <textarea
              aria-label=${this.label||this.name||"Text Input"}
              .value=${this.value}
              .rows=${this.rows??5}
              ?disabled=${this.disabled}
              placeholder=${nC(this.placeholder)}
              @input=${this.onInputChange}
              style="resize: ${this.resize};"
            ></textarea>`:dt` <input
              aria-label=${this.label||this.name||"Text Input"}
              .type=${this.type}
              .value=${this.value}
              ?disabled=${this.disabled}
              placeholder=${nC(this.placeholder)}
              @input=${this.onInputChange}
            />`}
      </bim-input>
    `}};SP.styles=[sa.scrollbar,he`
      :host {
        --bim-input--bgc: var(--bim-ui_bg-contrast-20);
        flex: 1;
        display: block;
      }

      input,
      textarea {
        font-family: inherit;
        background-color: transparent;
        border: none;
        width: 100%;
        padding: var(--bim-ui_size-3xs);
        color: var(--bim-text-input--c, var(--bim-ui_bg-contrast-100));
      }

      input {
        outline: none;
        height: 100%;
        padding: 0 var(--bim-ui_size-3xs); /* Override padding */
        border-radius: var(--bim-text-input--bdrs, var(--bim-ui_size-4xs));
      }

      :host([disabled]) input,
      :host([disabled]) textarea {
        color: var(--bim-ui_bg-contrast-60);
      }

      textarea {
        line-height: 1.1rem;
        outline: none;
      }

      :host(:focus) {
        --bim-input--olc: var(--bim-ui_accent-base);
      }

      /* :host([disabled]) {
      --bim-input--bgc: var(--bim-ui_bg-contrast-20);
    } */
    `];let li=SP;kn([mt({type:String,reflect:!0})],li.prototype,"icon",2);kn([mt({type:String,reflect:!0})],li.prototype,"label",2);kn([mt({type:String,reflect:!0})],li.prototype,"name",2);kn([mt({type:String,reflect:!0})],li.prototype,"placeholder",2);kn([mt({type:String,reflect:!0})],li.prototype,"value",2);kn([mt({type:Boolean,reflect:!0})],li.prototype,"vertical",2);kn([mt({type:Number,reflect:!0})],li.prototype,"debounce",2);kn([mt({type:Number,reflect:!0})],li.prototype,"rows",2);kn([mt({type:Boolean,reflect:!0})],li.prototype,"disabled",2);kn([mt({type:String,reflect:!0})],li.prototype,"resize",2);kn([mt({type:String,reflect:!0})],li.prototype,"type",1);var OW=Object.defineProperty,PW=Object.getOwnPropertyDescriptor,OP=(n,t,e,s)=>{for(var i=s>1?void 0:s?PW(t,e):t,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(t,e,i):o(i))||i);return s&&i&&OW(t,e,i),i};const PP=class extends ae{constructor(){super(...arguments),this.rows=2,this._vertical=!1}set vertical(n){this._vertical=n,this.updateChildren()}get vertical(){return this._vertical}updateChildren(){const n=this.children;for(const t of n)this.vertical?t.setAttribute("label-hidden",""):t.removeAttribute("label-hidden")}render(){return dt`
      <style>
        .parent {
          grid-auto-flow: ${this.vertical?"row":"column"};
          grid-template-rows: repeat(${this.rows}, 1fr);
        }
      </style>
      <div class="parent">
        <slot @slotchange=${this.updateChildren}></slot>
      </div>
    `}};PP.styles=he`
    .parent {
      display: grid;
      gap: 0.25rem;
    }

    ::slotted(bim-button[label]:not([vertical])) {
      --bim-button--jc: flex-start;
    }

    ::slotted(bim-button) {
      --bim-label--c: var(--bim-ui_bg-contrast-80);
    }
  `;let nb=PP;OP([mt({type:Number,reflect:!0})],nb.prototype,"rows",2);OP([mt({type:Boolean,reflect:!0})],nb.prototype,"vertical",1);var RW=Object.defineProperty,FW=Object.getOwnPropertyDescriptor,rb=(n,t,e,s)=>{for(var i=s>1?void 0:s?FW(t,e):t,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(t,e,i):o(i))||i);return s&&i&&RW(t,e,i),i};const RP=class extends ae{constructor(){super(...arguments),this._vertical=!1,this._labelHidden=!1}set vertical(n){this._vertical=n,this.updateChildren()}get vertical(){return this._vertical}set labelHidden(n){this._labelHidden=n,this.updateChildren()}get labelHidden(){return this._labelHidden}updateChildren(){const n=this.children;for(const t of n)t instanceof nb&&(t.vertical=this.vertical),t.toggleAttribute("label-hidden",this.vertical)}render(){return dt`
      <div class="parent">
        <div class="children">
          <slot @slotchange=${this.updateChildren}></slot>
        </div>
        ${!this.labelHidden&&(this.label||this.icon)?dt`<bim-label .icon=${this.icon}>${this.label}</bim-label>`:null}
      </div>
    `}};RP.styles=he`
    :host {
      --bim-label--fz: var(--bim-ui_size-xs);
      --bim-label--c: var(--bim-ui_bg-contrast-60);
      display: block;
      flex: 1;
    }

    :host(:not([vertical])) ::slotted(bim-button[vertical]) {
      --bim-icon--fz: var(--bim-ui_size-5xl);
      min-height: 3.75rem;
    }

    .parent {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      align-items: center;
      padding: 0.5rem;
      height: 100%;
      box-sizing: border-box;
      justify-content: space-between;
    }

    :host([vertical]) .parent {
      flex-direction: row-reverse;
    }

    :host([vertical]) .parent > bim-label {
      writing-mode: tb;
    }

    .children {
      display: flex;
      gap: 0.25rem;
    }

    :host([vertical]) .children {
      flex-direction: column;
    }
  `;let yh=RP;rb([mt({type:String,reflect:!0})],yh.prototype,"label",2);rb([mt({type:String,reflect:!0})],yh.prototype,"icon",2);rb([mt({type:Boolean,reflect:!0})],yh.prototype,"vertical",1);rb([mt({type:Boolean,attribute:"label-hidden",reflect:!0})],yh.prototype,"labelHidden",1);var LW=Object.defineProperty,$W=Object.getOwnPropertyDescriptor,mw=(n,t,e,s)=>{for(var i=s>1?void 0:s?$W(t,e):t,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(t,e,i):o(i))||i);return s&&i&&LW(t,e,i),i};const FP=class extends ae{constructor(){super(...arguments),this.labelsHidden=!1,this._vertical=!1,this._hidden=!1}set vertical(n){this._vertical=n,this.updateSections()}get vertical(){return this._vertical}set hidden(n){this._hidden=n,this.dispatchEvent(new Event("hiddenchange"))}get hidden(){return this._hidden}updateSections(){const n=this.children;for(const t of n)t instanceof yh&&(t.labelHidden=this.vertical&&!Bs.config.sectionLabelOnVerticalToolbar,t.vertical=this.vertical)}render(){return dt`
      <div class="parent">
        <slot @slotchange=${this.updateSections}></slot>
      </div>
    `}};FP.styles=he`
    :host {
      --bim-button--bgc: transparent;
      background-color: var(--bim-ui_bg-base);
      border-radius: var(--bim-ui_size-2xs);
      display: block;
    }

    :host([hidden]) {
      display: none;
    }

    .parent {
      display: flex;
      width: max-content;
      pointer-events: auto;
    }

    :host([vertical]) .parent {
      flex-direction: column;
    }

    :host([vertical]) {
      width: min-content;
      border-radius: var(--bim-ui_size-2xs);
      border: 1px solid var(--bim-ui_bg-contrast-20);
    }

    ::slotted(bim-toolbar-section:not(:last-child)) {
      border-right: 1px solid var(--bim-ui_bg-contrast-20);
      border-bottom: none;
    }

    :host([vertical]) ::slotted(bim-toolbar-section:not(:last-child)) {
      border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      border-right: none;
    }
  `;let ob=FP;mw([mt({type:String,reflect:!0})],ob.prototype,"icon",2);mw([mt({type:Boolean,attribute:"labels-hidden",reflect:!0})],ob.prototype,"labelsHidden",2);mw([mt({type:Boolean,reflect:!0})],ob.prototype,"vertical",1);var NW=Object.defineProperty,MW=(n,t,e,s)=>{for(var i=void 0,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=o(t,e,i)||i);return i&&NW(t,e,i),i};const LP=class extends ae{constructor(){super(),this._onResize=new Event("resize"),new ResizeObserver(()=>{setTimeout(()=>{this.dispatchEvent(this._onResize)})}).observe(this)}render(){return dt`
      <div class="parent">
        <slot></slot>
      </div>
    `}};LP.styles=he`
    :host {
      display: grid;
      min-width: 0;
      min-height: 0;
      height: 100%;
    }

    .parent {
      overflow: hidden;
      position: relative;
    }
  `;let $P=LP;MW([mt({type:String,reflect:!0})],$P.prototype,"name");/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const NP="important",DW=" !"+NP,Ha=$O(class extends NO{constructor(n){var t;if(super(n),n.type!==LO.ATTRIBUTE||n.name!=="style"||((t=n.strings)==null?void 0:t.length)>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(n){return Object.keys(n).reduce((t,e)=>{const s=n[e];return s==null?t:t+`${e=e.includes("-")?e:e.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${s};`},"")}update(n,[t]){const{style:e}=n.element;if(this.ft===void 0)return this.ft=new Set(Object.keys(t)),this.render(t);for(const s of this.ft)t[s]==null&&(this.ft.delete(s),s.includes("-")?e.removeProperty(s):e[s]=null);for(const s in t){const i=t[s];if(i!=null){this.ft.add(s);const r=typeof i=="string"&&i.endsWith(DW);s.includes("-")||r?e.setProperty(s,r?i.slice(0,-11):i,r?NP:""):e[s]=i}}return tl}});class uQ{static init(){Bs.defineCustomElement("bim-view-cube",Xr),Bs.defineCustomElement("bim-world-2d",uh),Bs.defineCustomElement("bim-world",oO)}}const kW=n=>{const{components:t,modelUserData:e,worldName:s}=n;return dt`
    <bim-button
      data-ui-id="import-ifc"
      label="Load IFC"
      icon="mage:box-3d-fill"
      @click=${()=>{if(!(t&&s))return;const i=[...t.get(Vd).list.values()].find(o=>"name"in o&&o.name===s);if(!i)return;const r=document.createElement("input");r.type="file",r.accept=".ifc",r.onchange=async()=>{if(r.files===null||r.files.length===0)return;const o=r.files[0],a=await o.arrayBuffer(),l=new Uint8Array(a),c=o.name.replace(".ifc",""),h=t.get(Nt),u=t.get(V4);u.settings.autoSetWasm=!1,u.settings.wasm={path:"https://unpkg.com/web-ifc@0.0.70/",absolute:!1};const p=await u.load(l,!0,c,{userData:e});i.scene.three.add(p.object),p.useCamera(i.camera.three),h.core.update(!0)},r.click()}}
    ></bim-button>
  `},zW=n=>Rs.create(kW,n),BW=Object.freeze(Object.defineProperty({__proto__:null,loadIfc:zW},Symbol.toStringTag,{value:"Module"})),UW=n=>{const{components:t,world:e}=n;return dt`
    <bim-button @click=${()=>{const s=document.createElement("input");s.type="file",s.accept=".frag",s.onchange=async()=>{if(s.files===null||s.files.length===0)return;const i=s.files[0],r=await i.arrayBuffer(),o=new Uint8Array(r),a=i.name.replace(".frag",""),l=t.get(Nt),c=await l.core.load(o,{modelId:a});e&&(e.scene.three.add(c.object),c.useCamera(e.camera.three),l.core.update(!0))},s.click()}}></bim-button>
  `},VW=n=>{const t=Rs.create(UW,n),[e]=t;return e.label="Load FRAG",e.icon="mage:box-3d-fill",t},HW=Object.freeze(Object.defineProperty({__proto__:null,loadFrag:VW},Symbol.toStringTag,{value:"Module"}));({...BW,...HW});const Hy=async(n,t)=>{const{localId:e,category:s,children:i}=t;if(s&&i){const r={data:{Name:s,modelId:n.modelId,children:JSON.stringify(i.map(o=>o.localId))}};for(const o of i){const a=await Hy(n,o);a&&(r.children||(r.children=[]),r.children.push(a))}return r}if(e!==null){const r=await n.getItem(e).getAttributes();if(!r)return null;const o={data:{Name:String(r.getValue("Name")),modelId:n.modelId,localId:e}};for(const a of i??[]){const l=await Hy(n,a);l&&(o.children||(o.children=[]),o.children.push(l))}return o}return null},jW=async n=>{const t=[];for(const e of n){const s=await e.getSpatialStructure(),i=await Hy(e,s);if(!i)continue;const r={data:{Name:e.modelId,modelId:e.modelId},children:[i]};t.push(r)}return t},MP=n=>{const{components:t,models:e}=n,s=n.selectHighlighterName??"select";return dt`
    <bim-table @rowcreated=${i=>{i.stopImmediatePropagation();const{row:r}=i.detail,o=t.get(Gu),a=t.get(Nt);r.onclick=async()=>{if(!s)return;const{data:{modelId:l,localId:c,children:h}}=r;if(!(l&&(c!==void 0||h)))return;const u=a.list.get(l);if(u){if(c!==void 0){const p=await u.getItemsChildren([c]),d={[l]:p.length!==0?new Set(p):new Set([c])};o.highlightByID(s,d,!0,!0)}else if(h){const p=JSON.parse(h),d=await u.getItemsChildren(p),g={[l]:d.length!==0?d:p};o.highlightByID(s,g,!0,!0)}}}}} @cellcreated=${({detail:i})=>{const{cell:r}=i;r.column==="Name"&&!r.rowData.Name&&(r.style.gridColumn="1 / -1")}} ${oi(async i=>{if(!i)return;const r=i;r.loadFunction=async()=>new Promise(o=>{setTimeout(()=>{o(jW(e))})}),r.loadData(!0)})} headers-hidden>
      <bim-label slot="missing-data" style="--bim-icon--c: gold" icon="ic:round-warning">
        No models available to display the spatial structure!
      </bim-label>
    </bim-table>
  `},WW=(n,t=!0)=>{const e=Rs.create(MP,n),[s,i]=e;if(s.hiddenColumns=["modelId","localId","children"],s.columns=["Name"],s.headersHidden=!0,t){const{components:r}=n,o=r.get(Nt);o.list.onItemSet.add(()=>i({models:o.list.values()})),o.list.onItemDeleted.add(()=>i())}return e},YW=Object.freeze(Object.defineProperty({__proto__:null,spatialTree:WW,spatialTreeTemplate:MP},Symbol.toStringTag,{value:"Module"}));let Na={};const rC={_category:"Category",_localId:"LocalId",_guid:"Guid"},GW=(n,t,e)=>{const s={data:{Name:t in rC?rC[t]:t,Value:e}};n.children||(n.children=[]),n.children.push(s)},DP=(n,t,e)=>{var s;n in Na||(Na[n]=new Map);const i=Na[n],r=t._localId.value;if(i.has(r))return i.get(r);const o=(s=t[e.defaultItemNameKey])==null?void 0:s.value,a=t._category.value,l={data:{Name:o?.toString().length>0?o.toString():a??String(r)}};i.set(r,l);for(const c in t){const h=t[c];if(!Array.isArray(h))GW(l,c,h.value);else{const u={data:{Name:c}};l.children||(l.children=[]),l.children.push(u);for(const p of h){const d=DP(n,p,e);u.children||(u.children=[]),u.children.push(d)}}}return l},qW=async(n,t,e)=>{const s=n.get(Nt);Object.keys(t).length===0&&(Na={});const i=[];for(const r in t){const o=s.list.get(r);if(!o)continue;r in Na||(Na[r]=new Map);const a=Na[r],l=t[r];for(const c of l){let h=a.get(c);if(h){i.push(h);continue}const[u]=await o.getItemsData([c],e.itemsDataConfig);h=DP(r,u,e),i.push(h)}}return i},kP=n=>{const t={defaultItemNameKey:"Name",itemsDataConfig:{attributesDefault:!0,relationsDefault:{attributes:!1,relations:!1},relations:{IsDefinedBy:{attributes:!0,relations:!0},DefinesOcurrence:{attributes:!1,relations:!1},ContainedInStructure:{attributes:!0,relations:!0},ContainsElements:{attributes:!1,relations:!1},Decomposes:{attributes:!1,relations:!1}}},...n},{components:e,modelIdMap:s,emptySelectionWarning:i}=n;return dt`
    <bim-table @cellcreated=${({detail:r})=>{const{cell:o}=r;o.column==="Name"&&!("Value"in o.rowData)&&(o.style.gridColumn="1 / -1")}} ${oi(async r=>{if(!r)return;const o=r;o.loadFunction=async()=>qW(e,s,t),await o.loadData(!0)&&o.dispatchEvent(new Event("datacomputed"))})}>
      ${i?dt`
            <bim-label slot="missing-data" style="--bim-icon--c: gold" icon="ic:round-warning">
              Select some elements to display its properties
            </bim-label>
            `:null}
      <bim-label slot="error-loading" style="--bim-icon--c: #e72e2e" icon="bxs:error-alt">
        Something went wrong with the properties
      </bim-label>
    </bim-table>
  `},ZW=(n,t)=>{t.columns=[{name:"Name",width:"12rem"}],t.headersHidden=!0},XW=n=>{const t=Rs.create(kP,n),[e]=t;return ZW(n,e),t},QW=Object.freeze(Object.defineProperty({__proto__:null,itemsData:XW,itemsDataTemplate:kP},Symbol.toStringTag,{value:"Module"})),zP=n=>{const{components:t}=n,e=n.missingDataMessage??"No models has been loaded yet",s=t.get(Nt),i=({detail:r})=>{const{cell:o}=r;o.style.padding="0.25rem 0"};return dt`
    <bim-table ${oi(async r=>{if(!r)return;const o=r,a=[];for(const[,l]of s.list){if(!l)continue;const c=await l.getMetadata(),h={data:{Name:l.modelId,modelId:l.modelId,metadata:JSON.stringify(c)}};a.push(h)}o.data=a})} @cellcreated=${i}>
      <bim-label slot="missing-data" style="--bim-icon--c: gold" icon="ic:round-warning">
        ${e}
      </bim-label>
    </bim-table>
  `},KW=(n,t)=>{const{components:e,actions:s,metaDataTags:i}=n,r=e.get(Nt),o=s?.dispose??!0,a=s?.download??!0,l=s?.visibility??!0,c=i??[];t.hiddenColumns=["modelId","metadata"],t.headersHidden=!0,t.noIndentation=!0,t.dataTransform={Name:(h,u)=>{const{modelId:p,metadata:d}=u;if(!p)return h;const g=r.list.get(p);if(!g)return p;const m=[];if(d){const y=JSON.parse(d);for(const v of c){const w=y[v];if(!(typeof w=="string"||typeof w=="boolean"||typeof w=="number"))continue;const I=dt`
            <bim-label style="background-color: var(--bim-ui_main-base); padding: 0 0.25rem; color: var(--bim-ui_main-contrast); border-radius: 0.25rem;">${w}</bim-label>
            `;m.push(I)}}let b;o&&(b=dt`<bim-button @click=${()=>r.core.disposeModel(g.modelId)} icon="mdi:delete"></bim-button>`);let f;l&&(f=dt`<bim-button @click=${async({target:y})=>{y.loading=!0,await g.setVisible(void 0,y.hasAttribute("data-model-hidden")),await r.core.update(!0),y.toggleAttribute("data-model-hidden"),y.icon=y.hasAttribute("data-model-hidden")?"mdi:eye-off":"mdi:eye",y.loading=!1}} icon="mdi:eye"></bim-button>`);let _;return a&&(_=dt`<bim-button @click=${async()=>{const y=await g.getBuffer(!1),v=new File([y],`${g.modelId}.frag`),w=document.createElement("a");w.href=URL.createObjectURL(v),w.download=v.name,w.click(),URL.revokeObjectURL(w.href)}} icon="flowbite:download-solid"></bim-button>`),dt`
       <div style="display: flex; flex: 1; gap: var(--bim-ui_size-4xs); justify-content: space-between; overflow: auto;">
        <div style="display: flex; flex-wrap: wrap; align-items: center; gap: 0 var(--bim-ui_size-4xs); flex-grow: 1; overflow: auto;">
          <div style="min-height: 1.75rem; overflow: auto; display: flex;">
            <bim-label style="white-space: normal;">${h}</bim-label>
          </div>
          <div style="display: flex; flex-wrap: wrap; gap: var(--bim-ui_size-4xs); overflow: auto;">
            ${m}
          </div>
        </div>
        <div style="display: flex; align-self: flex-start; flex-shrink: 0;">
          ${_}
          ${f}
          ${b}
        </div>
       </div>
      `}}},JW=(n,t=!0)=>{const e=Rs.create(zP,n),[s,i]=e;if(KW(n,s),t){const{components:r}=n,o=r.get(Nt),a=()=>setTimeout(()=>i());o.list.onItemSet.add(a),o.list.onItemDeleted.add(a)}return e},tY=Object.freeze(Object.defineProperty({__proto__:null,modelsList:JW,modelsListTemplate:zP},Symbol.toStringTag,{value:"Module"})),BP=n=>{var t;const{components:e}=n,s=n.missingDataMessage??"No viewpoints to display",i=e.get(xi),r=((t=n.topic)==null?void 0:t.viewpoints)??i.list.keys(),o=[];for(const c of r){const h=i.list.get(c);h&&o.push(h)}const a=c=>{if(!c)return;const h=c;h.data=o.map((u,p)=>({data:{Guid:u.guid,Title:u.title??`Viewpoint ${n.topic?p+1:""}`,Actions:""}}))},l=({detail:c})=>{const{cell:h}=c;h.style.padding="0.25rem"};return dt`
    <bim-table ${oi(a)} @cellcreated=${l}>
      <bim-label slot="missing-data" icon="ph:warning-fill" style="--bim-icon--c: gold;">${s}</bim-label>
    </bim-table>
  `},eY=(n,t)=>{const{components:e,topic:s}=n;t.noIndentation=!0,t.headersHidden=!0,t.hiddenColumns=["Guid"],t.columns=["Title",{name:"Actions",width:"auto"}];const i={selectComponents:!0,colorizeComponent:!0,resetColors:!0,updateCamera:!0,delete:!0,unlink:!!s,...n.actions},r=e.get(xi);t.dataTransform={Actions:(o,a)=>{const{Guid:l}=a;if(!(l&&typeof l=="string"))return o;const c=r.list.get(l);if(!c)return o;const h=async({target:_})=>{_.loading=!0,await c.go(),_.loading=!1};let u;i.selectComponents&&(u=dt`
          <bim-button label="Select Components" @click=${async({target:_})=>{const y=e.get(Nt),v=e.get(Gu);if(!v.isSetup)return;_.loading=!0;const w=await y.guidsToModelIdMap([...c.selectionComponents]);await v.highlightByID("select",w),_.loading=!1}}></bim-button>
        `);let p;i.colorizeComponent&&(p=dt`
          <bim-button label="Colorize Components" @click=${async({target:_})=>{_.loading=!0,await c.setColorizationState(!0),_.loading=!1}}></bim-button>
        `);let d;i.resetColors&&(d=dt`
          <bim-button label="Reset Colors" @click=${async({target:_})=>{_.loading=!0,await c.setColorizationState(!1),_.loading=!1}}></bim-button>
        `);let g;i.updateCamera&&(g=dt`
          <bim-button label="Update Camera" @click=${()=>c.updateCamera()}></bim-button>
        `);let m;i.unlink&&(m=dt`
          <bim-button label="Unlink" @click=${()=>s?.viewpoints.delete(c.guid)}></bim-button>
        `);let b;i.delete&&(b=dt`
          <bim-button label="Delete" @click=${()=>{r.list.delete(c.guid),ug.removeMenus()}}></bim-button>
        `);let f;return Object.values(i).includes(!0)&&(f=dt`
          <bim-button icon="prime:ellipsis-v">
            <bim-context-menu>
              ${u}
              ${p}
              ${d}
              ${g}
              ${m}
              ${b}
            </bim-context-menu>
          </bim-button>
        `),dt`
        <bim-button icon="ph:eye-fill" @click=${h}></bim-button>
        ${f}
      `}}},UP=(n,t=!0)=>{const e=Rs.create(BP,n),[s,i]=e;if(eY(n,s),t){const{components:r,topic:o}=n,a=r.get(xi);a.list.onItemUpdated.add(()=>i()),a.list.onItemDeleted.add(()=>i()),a.list.onCleared.add(()=>i()),o?(o.viewpoints.onItemAdded.add(()=>i()),o.viewpoints.onItemDeleted.add(()=>i()),o.viewpoints.onCleared.add(()=>i())):a.list.onItemSet.add(()=>i())}return e},sY=Object.freeze(Object.defineProperty({__proto__:null,viewpointsList:UP,viewpointsListTemplate:BP},Symbol.toStringTag,{value:"Module"})),VP=n=>{const{components:t}=n,e=n.missingDataMessage??"No topics to display",s=t.get(We),i=n.topics??s.list.values();return dt`
    <bim-table no-indentation ${oi(r=>{if(!r)return;const o=r;o.data=[...i].map(a=>{var l;return{data:{Guid:a.guid,Title:a.title,Status:a.status,Description:a.description??"",Author:a.creationAuthor,Assignee:a.assignedTo??"",Date:a.creationDate.toDateString(),DueDate:((l=a.dueDate)==null?void 0:l.toDateString())??"",Type:a.type,Priority:a.priority??""}}})})}>
      <bim-label slot="missing-data" icon="ph:warning-fill" style="--bim-icon--c: gold;">${e}</bim-label>
    </bim-table>
  `},Ec=(n,t)=>{const e=t[n],s=e?.name??n,i=s.trim().split(/\s+/);let r,o;return i[0]&&i[0][0]&&(r=i[0][0].toUpperCase(),i[0][1]&&(o=i[0][1].toUpperCase())),i[1]&&i[1][0]&&(o=i[1][0].toUpperCase()),dt`
    <div style="display: flex; gap: 0.25rem; overflow: hidden;">
      ${!(e!=null&&e.picture)&&(r||o)?dt`
        <bim-label
          style=${Ha({borderRadius:"999px",padding:"0.375rem",backgroundColor:"var(--bim-ui_bg-contrast-20)",aspectRatio:"1",fontSize:"0.7rem"})}>${r}${o}</bim-label>
        `:null}
      <bim-label .img=${e?.picture}>${s}</bim-label>
    </div>
  `},mi={users:{"jhon.doe@example.com":{name:"Jhon Doe"}},priorities:{"On hold":{icon:"flowbite:circle-pause-outline",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#767676"}},Minor:{icon:"mingcute:arrows-down-fill",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#4CAF50"}},Normal:{icon:"fa6-solid:grip-lines",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FB8C00"}},Major:{icon:"mingcute:arrows-up-fill",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Critical:{icon:"ph:warning",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FB8C00"}}},statuses:{Active:{icon:"prime:circle-fill",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)"}},"In Progress":{icon:"prime:circle-fill",style:{backgroundColor:"#fa89004d","--bim-label--c":"#FB8C00","--bim-icon--c":"#FB8C00"}},"In Review":{icon:"prime:circle-fill",style:{backgroundColor:"#9c6bff4d","--bim-label--c":"#9D6BFF","--bim-icon--c":"#9D6BFF"}},Done:{icon:"prime:circle-fill",style:{backgroundColor:"#4CAF504D","--bim-label--c":"#4CAF50","--bim-icon--c":"#4CAF50"}},Closed:{icon:"prime:circle-fill",style:{backgroundColor:"#414141","--bim-label--c":"#727272","--bim-icon--c":"#727272"}}},types:{Clash:{icon:"gg:close-r",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FB8C00"}},Issue:{icon:"mdi:bug-outline",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Failure:{icon:"mdi:bug-outline",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Inquiry:{icon:"majesticons:comment-line",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Fault:{icon:"ph:warning",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Remark:{icon:"ph:note-blank-bold",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FB8C00"}},Request:{icon:"mynaui:edit-one",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#9D6BFF"}}}},xc={padding:"0.25rem 0.5rem",borderRadius:"999px","--bim-label--c":"var(--bim-ui_bg-contrast-100)"},iY={dueDate:n=>{if(typeof n=="string"&&n.trim()!=="")return new Date(n)},status:n=>{if(Array.isArray(n)&&n.length!==0)return n[0]},type:n=>{if(Array.isArray(n)&&n.length!==0)return n[0]},priority:n=>{if(Array.isArray(n)&&n.length!==0)return n[0]},stage:n=>{if(Array.isArray(n)&&n.length!==0)return n[0]},assignedTo:n=>{if(Array.isArray(n)&&n.length!==0)return n[0]},labels:n=>{if(Array.isArray(n))return new Set(n)}},HP=n=>{const{components:t,topic:e,value:s,onCancel:i,onSubmit:r,styles:o}=n,a=r??(()=>{}),l=t.get(We),c=s?.title??e?.title??Jn.default.title,h=s?.status??e?.status??Jn.default.status,u=s?.type??e?.type??Jn.default.type,p=s?.priority??e?.priority??Jn.default.priority,d=s?.assignedTo??e?.assignedTo??Jn.default.assignedTo,g=s?.labels??e?.labels??Jn.default.labels,m=s?.stage??e?.stage??Jn.default.stage,b=s?.description??e?.description??Jn.default.description,f=e!=null&&e.dueDate?e.dueDate.toISOString().split("T")[0]:null,_=new Set([...l.config.statuses]);h&&_.add(h);const y=new Set([...l.config.types]);u&&y.add(u);const v=new Set([...l.config.priorities]);p&&v.add(p);const w=new Set([...l.config.users]);d&&w.add(d);const I=new Set([...l.config.labels]);if(g)for(const E of g)I.add(E);const C=new Set([...l.config.stages]);m&&C.add(m);const A=Oy(),S=async()=>{const{value:E}=A;if(!E)return;const N=$d(E,iY);if(e)e.set(N),await a(e);else{const W=l.create(N);await a(W)}},P=Oy(),M=E=>{const{value:N}=P;if(!N)return;const W=E.target;N.disabled=W.value.trim()===""},T=`btn-${Bs.newRandomId()}`,L=`btn-${Bs.newRandomId()}`;return dt`
    <div ${oi(A)} style="display: flex; flex-direction: column; gap: 0.75rem;">
      <div style="display: flex; gap: 0.375rem">
        <bim-text-input @input=${M} vertical label="Title" name="title" .value=${c}></bim-text-input>
        ${e?dt`
            <bim-dropdown vertical label="Status" name="status" required>
              ${[..._].map(E=>dt`<bim-option label=${E} .checked=${h===E}></bim-option>`)}
            </bim-dropdown>`:dt``}
      </div>
      <div style="display: flex; gap: 0.375rem">
        <bim-dropdown vertical label="Type" name="type" required>
          ${[...y].map(E=>dt`<bim-option label=${E} .checked=${u===E}></bim-option>`)}
        </bim-dropdown>
        <bim-dropdown vertical label="Priority" name="priority">
          ${[...v].map(E=>dt`<bim-option label=${E} .checked=${p===E}></bim-option>`)}
        </bim-dropdown>
      </div>
      <div style="display: flex; gap: 0.375rem">
        <bim-dropdown vertical label="Labels" name="labels" multiple>
          ${[...I].map(E=>dt`<bim-option label=${E} .checked=${g?[...g].includes(E):!1}></bim-option>`)}
        </bim-dropdown>
        <bim-dropdown vertical label="Assignee" name="assignedTo">
          ${[...w].map(E=>{const N=o!=null&&o.users?o.users[E]:null,W=N?N.name:E,V=N?.picture;return dt`<bim-option label=${W} value=${E} .img=${V} .checked=${d===E}></bim-option>`})}
        </bim-dropdown>
      </div>
      <div style="display: flex; gap: 0.375rem">
        <bim-text-input vertical type="date" label="Due Date" name="dueDate" .value=${f}></bim-text-input> 
        <bim-dropdown vertical label="Stage" name="stage">
          ${[...C].map(E=>dt`<bim-option label=${E} .checked=${m===E}></bim-option>`)}
        </bim-dropdown>
      </div>
      <bim-text-input vertical label="Description" name="description" type="area" .value=${b??null}></bim-text-input>
      <div style="justify-content: right; display: flex; gap: 0.375rem">
        <style>
          #${L} {
            background-color: transparent;
          }

          #${L}:hover {
            --bim-label--c: #FF5252;
          }

          #${T}:hover {
            background-color: #329936;
          }
        </style>
        <bim-button id=${L} style="flex: 0" @click=${i} label="Cancel"></bim-button>
        <bim-button id=${T} style="flex: 0" @click=${S} ${oi(P)} label=${e?"Update Topic":"Add Topic"} icon=${e?"tabler:refresh":"mi:add"}></bim-button>
      </div>
    </div>
  `},nY=(n,t)=>{const{dataStyles:e}=n;t.hiddenColumns.length===0&&(t.hiddenColumns=["Guid"]),t.columns=["Title"],t.dataTransform={Priority:s=>{if(typeof s!="string")return s;const i=(e?.priorities??mi.priorities)[s];return dt`
            <bim-label
              .icon=${i?.icon}
              style=${Ha({...xc,...i?.style})}
            >${s}
            </bim-label>
          `},Status:s=>{if(typeof s!="string")return s;const i=(e?.statuses??mi.statuses)[s];return dt`
            <bim-label
              .icon=${i?.icon}
              style=${Ha({...xc,...i?.style})}
            >${s}
            </bim-label>
          `},Type:s=>{if(typeof s!="string")return s;const i=(e?.types??mi.types)[s];return dt`
            <bim-label
              .icon=${i?.icon}
              style=${Ha({...xc,...i?.style})}
            >${s}
            </bim-label>
          `},Author:s=>typeof s!="string"?s:Ec(s,e?.users??mi.users),Assignee:s=>typeof s!="string"?s:Ec(s,e?.users??mi.users)}},jP=(n,t=!0)=>{const e=Rs.create(VP,n),[s,i]=e;if(nY(n,s),t){const{components:r,topics:o}=n,a=r.get(We),l=()=>i();if(a.list.onItemUpdated.add(l),a.list.onItemDeleted.add(l),o)for(const c of o)c.relatedTopics.onItemAdded.add(l),c.relatedTopics.onItemDeleted.add(l),c.relatedTopics.onCleared.add(l);else a.list.onItemSet.add(l)}return e},rY=Object.freeze(Object.defineProperty({__proto__:null,topicsList:jP,topicsListTemplate:VP},Symbol.toStringTag,{value:"Module"})),WP=n=>{const{topic:t,styles:e,viewpoint:s}=n,i=n.missingDataMessage??"The topic has no comments";return dt`
    <bim-table no-indentation ${oi(r=>{if(!r)return;const o=r;let a=t.comments.values();s&&(a=[...t.comments.values()].filter(l=>l.viewpoint===s.guid)),o.data=[...a].map(l=>({data:{guid:l.guid,Comment:l.comment,author:(()=>{const c=e;if(!c)return l.author;const h=c[l.author];return h?.name??l.author})()}}))})}>
      <bim-label slot="missing-data" icon="ph:warning-fill" style="--bim-icon--c: gold;">${i}</bim-label>
    </bim-table>
  `},oY=(n,t)=>{const{topic:e,styles:s}=n,i={delete:!0,...n.actions};t.headersHidden=!0,t.hiddenColumns=["guid","author"],t.dataTransform={Comment:(r,o)=>{const{guid:a}=o;if(typeof a!="string")return r;const l=e.comments.get(a);if(!l)return r;const c=()=>{e.comments.delete(a)};let h;if(i.delete){const u=`btn-${Bs.newRandomId()}`;h=dt`
          <div>
            <style>
              #${u} {
                background-color: transparent;
                --bim-label--c: var(--bim-ui_bg-contrast-60)
              }
  
              #${u}:hover {
                --bim-label--c: #FF5252;
              }
            </style>
            <bim-button @click=${c} id=${u} icon="majesticons:delete-bin"></bim-button>
          </div>
        `}return dt`
        <div style="display: flex; flex-direction: column; gap: 0.25rem; flex: 1">
          <div style="display: flex; justify-content: space-between;">
            <div style="display: flex; gap: 0.375rem;">
              ${Ec(l.author,s??mi.users)}
              <bim-label style="color: var(--bim-ui_bg-contrast-40)">@ ${l.date.toDateString()}</bim-label>
            </div>
            ${h}
          </div>
          <bim-label style="margin-left: 1.7rem; white-space: normal">${l.comment}</bim-label>
        </div>
      `}}},YP=(n,t=!0)=>{const e=Rs.create(WP,n),[s,i]=e;if(oY(n,s),t){const{topic:r}=n,o=()=>i();r.comments.onItemSet.add(o),r.comments.onItemUpdated.add(o),r.comments.onItemDeleted.add(o),r.comments.onCleared.add(o)}return e},aY=Object.freeze(Object.defineProperty({__proto__:null,commentsList:YP,commentsListTemplate:WP},Symbol.toStringTag,{value:"Module"})),dQ={...YW,...QW,...tY,...sY,...rY,...aY},GP=(n,t)=>{const{showInput:e,topic:s,styles:i}=n,r={add:!0,delete:!0,...n.actions},o=`input-${Bs.newRandomId()}`,a=`btn-${Bs.newRandomId()}`,l=`btn-${Bs.newRandomId()}`,c=()=>document.getElementById(a),h=()=>document.getElementById(o),u=()=>{const y=h();return y?y.value.trim().length>0:!1},p=()=>{t({showInput:!0})},d=()=>{const y=h(),v=u();y&&v&&(s.createComment(y.value),t({showInput:!1}))},g=()=>{t({showInput:!1})},m=()=>{const y=c();if(y){if(!h()){y.disabled=!0;return}y.disabled=!u()}},b=dt`
    ${r.add?dt`<bim-button @click=${p} label="Add Comment" icon="majesticons:comment-line"></bim-button>`:null}
  `,f=dt`
    <bim-text-input id=${o} @input=${m} @keypress=${y=>{y.code==="Enter"&&y.ctrlKey&&d()}} type="area"></bim-text-input>

    <div style="justify-content: right; display: flex; gap: 0.375rem">
      <style>
        #${a} {
          background-color: #329936;
        }  

        #${l} {
          background-color: transparent;
        }

        #${l}:hover {
          --bim-label--c: #FF5252;
        }
      </style>

      <bim-button style="flex: 0" id=${l} @click=${g} label="Cancel"></bim-button>
      <bim-button style="flex: 0" id=${a} @click=${d} label="Accept" icon="material-symbols:check" disabled></bim-button>
    </div>
  `,[_]=YP({topic:s,actions:r,styles:i??mi.users});return dt`
    <div style="display: flex; flex-direction: column; gap: 0.5rem">
      ${_}
      ${e?f:b}
    </div>
  `},lY=n=>Rs.create(GP,n),cY=Object.freeze(Object.defineProperty({__proto__:null,topicComments:lY,topicCommentsSectionTemplate:GP},Symbol.toStringTag,{value:"Module"})),qP=(n,t)=>{const{components:e,editing:s,topic:i,styles:r}=n,o={update:!0,...n.actions},a=r?.priorities??mi.priorities,l=r?.statuses??mi.statuses,c=r?.types??mi.types;let h;i!=null&&i.priority&&(h=a[i.priority]);let u;i!=null&&i.type&&(u=c[i.type]);let p;i!=null&&i.type&&(p=l[i.status]);let d,g;return s?d=HP({components:e,topic:i,styles:r,onSubmit:()=>{t({editing:!1})},onCancel:()=>{t({editing:!1})}}):g=dt`
      <div>
        <bim-label>Title</bim-label>
        <bim-label style="--bim-label--c: var(--bim-ui_bg-contrast-100)">${i.title}</bim-label>
      </div>

      ${i.description?dt`
            <div>
              <bim-label>Description</bim-label>
              <bim-label style="--bim-label--c: var(--bim-ui_bg-contrast-100); white-space: normal">${i.description}</bim-label>
            </div>
          `:null}

      <div style="display: flex; gap: 0.375rem">
        <bim-label>Status</bim-label>
        <bim-label .icon=${p?.icon} style=${Ha({...xc,...p?.style})}
        >${i.status}
        </bim-label>
      </div>

      <div style="display: flex; gap: 0.375rem">
        <bim-label>Type</bim-label>
        <bim-label .icon=${u?.icon} style=${Ha({...xc,...u?.style})}
        >${i.type}
        </bim-label>
      </div>

      ${i.priority?dt`
            <div style="display: flex; gap: 0.375rem">
              <bim-label>Priority</bim-label>
              <bim-label .icon=${h?.icon} style=${Ha({...xc,...h?.style})}
              >${i.priority}
              </bim-label>
            </div>`:null}

      <div style="display: flex; gap: 0.375rem">
        <bim-label>Author</bim-label>
        ${Ec(i.creationAuthor,r?.users??mi.users)}
      </div>

      ${i.assignedTo?dt`
          <div style="display: flex; gap: 0.375rem">
            <bim-label>Assignee</bim-label>
            ${Ec(i.assignedTo,r?.users??mi.users)}
          </div>`:null}

      ${i.dueDate?dt`
          <div style="display: flex; gap: 0.375rem">
            <bim-label>Due Date</bim-label>
            <bim-label style="--bim-label--c: var(--bim-ui_bg-contrast-100)">${i.dueDate.toDateString()}</bim-label>
          </div>`:null}

      ${i.modifiedAuthor?dt`
          <div style="display: flex; gap: 0.375rem">
            <bim-label>Modified By</bim-label>
            ${Ec(i.modifiedAuthor,r?.users??mi.users)}
          </div>`:null}

      ${i.modifiedDate?dt`
            <div style="display: flex; gap: 0.375rem">
              <bim-label>Modified Date</bim-label>
              <bim-label style="--bim-label--c: var(--bim-ui_bg-contrast-100)">${i.modifiedDate.toDateString()}</bim-label>
            </div>`:null}

      ${i.labels.size!==0?dt`
          <div style="display: flex; gap: 0.375rem">
            <bim-label>Labels</bim-label>
            <bim-label style="white-space: normal; --bim-label--c: var(--bim-ui_bg-contrast-100)">${[...i.labels].join(", ")}</bim-label>
          </div>`:null}

      ${o.update?dt`
              <bim-button @click=${()=>t({editing:!0})} label="Update Information" icon="tabler:refresh"></bim-button> 
            `:null}
    `,dt`
    <div style="display: flex; flex-direction: column; gap: 0.75rem;">
      ${s?d:g}
    </div>
  `},hY=n=>Rs.create(qP,n),uY=Object.freeze(Object.defineProperty({__proto__:null,topicInformation:hY,topicInformationSectionTemplate:qP},Symbol.toStringTag,{value:"Module"})),ZP=(n,t)=>{const{components:e,topic:s,linking:i}=n,r=e.get(We),o={link:!0,...n.actions},[a,l]=jP({components:e,topics:[...s.relatedTopics].map(p=>r.list.get(p)).map(p=>p)});a.headersHidden=!0,a.hiddenColumns=["Guid","Status","Description","Author","Assignee","Date","DueDate","Type","Priority"];const c=()=>dt`
      <bim-text-input placeholder="Search..." debounce="100" @input=${p=>{const d=p.target;d instanceof li&&(a.queryString=d.value)}}></bim-text-input> 
    `;let h,u;if(i){a.selectableRows=!0,l({topics:void 0});const p=a.data.filter(f=>{const{Guid:_}=f.data;return typeof _!="string"?!1:s.relatedTopics.has(_)}).map(f=>f.data);a.selection=new Set(p);const d=()=>{const f=[...a.selection].map(({Guid:_})=>typeof _!="string"?null:r.list.has(_)?_:null).map(_=>_);s.relatedTopics.clear(),s.relatedTopics.add(...f),t({linking:!1})},g=()=>{t({linking:!1})},m=`btn-${Bs.newRandomId()}`,b=`btn-${Bs.newRandomId()}`;h=dt`
      <div style="display: flex; gap: 0.25rem">
        <style>
          #${m}:hover {
            background-color: #329936;
          }  

          #${b} {
            background-color: transparent;
          }

          #${b}:hover {
            --bim-label--c: #FF5252;
          }
        </style>
        ${c()}
        <div style="display: flex; justify-content: right; gap: 0.25rem">
          <bim-button id=${b} @click=${g} style="flex: 0" label="Cancel" icon="material-symbols:close"></bim-button>
          <bim-button id=${m} @click=${d} style="flex: 0" label="Accept" icon="material-symbols:check"></bim-button>
        </div>
      </div> 
    `}else{a.selectableRows=!1;const p=()=>{t({linking:!0})};u=dt`
      <div style="display: flex; justify-content: right; gap: 0.25rem">
        ${c()}
        ${o.link?dt`<bim-button style="flex: 0" @click=${p} icon="tabler:link"></bim-button>`:null}
      </div> 
    `}return dt`
    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
      ${u}
      ${h}
      ${a}
    </div> 
  `},dY=n=>Rs.create(ZP,n),pY=Object.freeze(Object.defineProperty({__proto__:null,topicRelations:dY,topicRelationsSectionTemplate:ZP},Symbol.toStringTag,{value:"Module"})),XP=(n,t)=>{const{components:e,topic:s,world:i,linking:r}=n,o={add:!0,link:!0,selectComponents:!0,colorizeComponent:!0,resetColors:!0,updateCamera:!0,delete:!0,unlink:!0,...n.actions},a=e.get(xi),[l,c]=UP({components:e,topic:s,actions:o}),h=()=>dt`
      <bim-text-input placeholder="Search..." debounce="100" @input=${d=>{const g=d.target;g instanceof li&&(l.queryString=g.value)}}></bim-text-input> 
    `;let u,p;if(r){l.selectableRows=!0,c({topic:void 0,actions:{delete:!1,updateCamera:!1,colorizeComponent:!1,resetColors:!1}});const d=l.data.filter(_=>{const{Guid:y}=_.data;return typeof y!="string"?!1:s.viewpoints.has(y)}).map(_=>_.data);l.selection=new Set(d);const g=()=>{const _=[...l.selection].map(({Guid:y})=>typeof y!="string"?null:a.list.has(y)?y:null).map(y=>y);s.viewpoints.clear(),s.viewpoints.add(..._),t({linking:!1})},m=()=>{t({linking:!1})},b=`btn-${Bs.newRandomId()}`,f=`btn-${Bs.newRandomId()}`;u=dt`
      <div style="display: flex; gap: 0.25rem">
        <style>
          #${b}:hover {
            background-color: #329936;
          }  

          #${f} {
            background-color: transparent;
          }

          #${f}:hover {
            --bim-label--c: #FF5252;
          }
        </style>
        ${h()}
        <div style="display: flex; justify-content: right; gap: 0.25rem">
          <bim-button id=${f} @click=${m} style="flex: 0" label="Cancel" icon="material-symbols:close"></bim-button>
          <bim-button id=${b} @click=${g} style="flex: 0" label="Accept" icon="material-symbols:check"></bim-button>
        </div>
      </div> 
    `}else{l.selectableRows=!1,c({topic:s,actions:o});const d=()=>{if(!(s&&o.add&&!r))return;const f=a.create();i&&(f.world=i),s.viewpoints.add(f.guid)},g=()=>{t({linking:!0})},m=dt`<bim-button style="flex: 0" @click=${d} .disabled=${!i} icon="mi:add"></bim-button>`,b=dt`<bim-button style="flex: 0" @click=${g} icon="tabler:link"></bim-button>`;p=dt`
      <div style="display: flex; justify-content: right; gap: 0.25rem">
        ${h()}
        <div style="display: flex; justify-content: right; gap: 0.25rem">
          ${o.add?m:null}
          ${o.link?b:null}
        </div>
      </div> 
    `}return dt`
    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
      ${p}
      ${u}
      ${l}
    </div> 
  `},fY=n=>Rs.create(XP,n),mY=Object.freeze(Object.defineProperty({__proto__:null,topicViewpoints:fY,topicViewpointsSectionTemplate:XP},Symbol.toStringTag,{value:"Module"}));({...cY,...uY,...pY,...mY});const gY=n=>dt`
    <bim-panel-section fixed label="New Topic" name="topic">
      ${HP(n)}
    </bim-panel-section>
  `,bY=n=>Rs.create(gY,n),_Y=Object.freeze(Object.defineProperty({__proto__:null,topic:bY},Symbol.toStringTag,{value:"Module"}));({..._Y});export{dQ as $,tA as C,Nt as F,iD as G,H4 as H,Ag as O,VT as S,Vd as W,GZ as Y,uQ as _,Q4 as a,Nq as i,jv as l,Gu as t};
