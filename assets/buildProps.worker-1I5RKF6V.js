(function(){"use strict";const N=self,G=new Set(["ID","IFC","BIM","MEP","HVAC","URL","CAD"]),V=e=>{if(!e)return"";let t=e.replace(/[_\-]+/g," ");return t=t.replace(/([a-z\d])([A-Z])/g,"$1 $2"),t=t.replace(/([A-Z]+)([A-Z][a-z])/g,"$1 $2"),t=t.replace(/\s+/g," ").trim(),t?t.split(" ").map(s=>{const f=s.toUpperCase();return G.has(f)||f.length<=3&&/^[A-Z]+$/.test(f)?f:/^\d+(\.\d+)?$/.test(s)||!s.length?s:s.charAt(0).toUpperCase()+s.slice(1)}).join(" "):""},I=e=>{if(e==null)return"";if(typeof e=="number")return Number.isFinite(e)?e.toString():"";if(typeof e=="boolean")return e?"true":"false";if(e instanceof Date)return e.toISOString();if(typeof e=="string")return e.trim();try{const t=JSON.stringify(e);return t?t.length>500?`${t.slice(0,500)}â€¦`:t:""}catch{return String(e)}},L=e=>!e||typeof e!="string"?e:e.replace(/[\u2013\u2014\u2212\u2010\u2011]/g,"-").replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"').replace(/[\u00A0\u2000-\u200B]/g," ").trim(),P=e=>{if(e==null)return"";if(typeof e!="object"){const o=I(e);return L(o)}if(e&&typeof e=="object"){const o=e;if("value"in o)return P(o.value);if("Value"in o)return P(o.Value)}if(Array.isArray(e))return e.map(o=>P(o)).filter(Boolean).join(", ");if(typeof e?.x=="number"&&typeof e?.y=="number"&&typeof e?.z=="number")return`${I(e.x)}, ${I(e.y)}, ${I(e.z)}`;const t=I(e);return L(t)},T=(e,t)=>{if(!e||typeof e!="object")return;const o=t.map(i=>i.toLowerCase()),s=new WeakSet,f=[e];for(;f.length;){const i=f.pop();if(!(!i||typeof i!="object")&&!s.has(i)){if(s.add(i),Array.isArray(i)){for(const y of i)y&&typeof y=="object"&&f.push(y);continue}for(const[y,m]of Object.entries(i)){const E=y.toLowerCase();if(o.some(b=>E.includes(b)))if(typeof m=="string"){const b=m.trim();if(b)return b}else{if(typeof m=="number"&&Number.isFinite(m))return m.toString();if(typeof m=="boolean")return m?"true":"false"}m&&typeof m=="object"&&f.push(m)}}}},M=e=>e.replace(/[^a-z0-9]+/gi,"-").replace(/-{2,}/g,"-").replace(/(^-|-$)/g,"").toLowerCase(),U=e=>e?e.trim().replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_.:-]+/g,"_").replace(/_{2,}/g,"_").replace(/^_+|_+$/g,""):"",_=["HasProperties","hasProperties","Properties","properties"],$=["IsDefinedBy","isDefinedBy","psets","Psets","propertySets","PropertySets","property_sets","Property_Sets"],k=new Set(["type","Type","id","ID","expressID","ExpressID","expressId","globalId","GlobalId","GlobalID","guid","Guid","GUID","_t","_type","_id","_guid"]),j=e=>{if(!e||typeof e!="object")return!1;const t=e,o=typeof t.type=="string"?t.type:typeof t.Type=="string"?t.Type:void 0;return o&&o.toUpperCase()==="IFCPROPERTYSET"?!0:_.some(s=>Array.isArray(t[s]))},D=e=>{if(!e||typeof e!="object")return!1;const t=e,o=typeof t.type=="string"?t.type:typeof t.Type=="string"?t.Type:void 0;return o&&o.toUpperCase()==="IFCPROPERTYSINGLEVALUE"?!0:"NominalValue"in t||"nominalValue"in t},x=e=>{if(!e||typeof e!="object")return I(e);const t=e,o=["NominalValue","nominalValue","Value","value","DataValue","dataValue","LengthValue","AreaValue","CountValue","VolumeValue","NumberValue","BooleanValue","LogicalValue","TextValue","IntegerValue","UpperBoundValue","LowerBoundValue","EnumerationValues","ListValues"];for(const s of o){if(!(s in t))continue;const f=t[s];if(f!=null)return P(f)}return"NominalValue"in t?P(t.NominalValue):"nominalValue"in t?P(t.nominalValue):"Value"in t?P(t.Value):"value"in t?P(t.value):I(e)},B=e=>{if(!e||typeof e!="object")return[];const t=[],o=new WeakSet,s=new Map,f=n=>{let r;if(typeof n=="string"){const p=n.trim();p.length&&(r=p)}if(!r&&n&&typeof n=="object"){const p=n,c=R(n)??(typeof p.Name=="string"?p.Name:void 0),g=typeof p.id=="string"?p.id:void 0;r=c??g}(!r||!r.length)&&(r="Property Set");const l=V(r)||r,u=M(r)||"property-set",a=(s.get(u)??0)+1;return s.set(u,a),{rawName:r,friendlyName:l,uniqueKey:`${u}-${a}`}},i=(n,r,l)=>{const u=`Property ${l+1}`,a=n&&n.trim().length?n.trim():u;if(D(r)){const c={...r};return c.Name==null&&c.PropertyName==null&&(c.Name=a),c.PropertyName==null&&(c.PropertyName=c.Name??a),c.__rawValue==null&&(c.__rawValue=r),c}if(r&&typeof r=="object"){const c={...r};return c.Name==null&&c.PropertyName==null&&(c.Name=a),c.PropertyName==null&&(c.PropertyName=c.Name??a),c.type==null&&c.Type==null&&(c.type="IFCPROPERTYSINGLEVALUE"),!("NominalValue"in c)&&!("nominalValue"in c)&&!("Value"in c)&&!("value"in c)&&(c.NominalValue=r),c.__rawValue==null&&(c.__rawValue=r),c}return{type:"IFCPROPERTYSINGLEVALUE",Name:a,PropertyName:a,NominalValue:r,__rawValue:r}},y=(n,r)=>{const l=[],u=(a,p)=>{const c=`Property ${l.length+1}`,g=a,d=(typeof a=="string"&&a.trim().length?a.trim():void 0)??R(a)??(typeof g?.Name=="string"?g.Name:void 0)??(typeof g?.PropertyName=="string"?g.PropertyName:void 0)??c;l.push(i(d,p,l.length))};if(r&&typeof r=="object"){const a=r;for(const p of _){const c=a[p];Array.isArray(c)&&c.length&&c.forEach(g=>u(g,g))}}if(!l.length)if(Array.isArray(r))r.forEach(a=>u(a,a));else if(r&&typeof r=="object")for(const[a,p]of Object.entries(r))p!=null&&(k.has(a)||_.includes(a)||$.includes(a)||u(a,p));else r!=null&&u(void 0,r);return{type:"IFCPROPERTYSET",Name:n,HasProperties:l}},m=(n,r)=>{if(!r||typeof r!="object")return;const l=y(n.rawName,r),u=Array.isArray(l.HasProperties)?l.HasProperties:[];if(!u.length)return;const a=n.friendlyName;u.forEach((p,c)=>{const g=p;let d;if(typeof g.Name=="string")d=g.Name;else if(g.Name&&typeof g.Name=="object"){const w=g.Name;typeof w.value=="string"&&(d=w.value)}!d&&typeof g.PropertyName=="string"&&(d=g.PropertyName),d||(d=`Property ${c+1}`);const H=V(d)||d,W=x(p);t.push({label:`Property Sets / ${a} / ${H}`,value:W||"",rawPsetName:n.rawName,rawPropertyName:d})})},E=n=>{if(!(!n||typeof n!="object")&&!o.has(n)){if(o.add(n),Array.isArray(n)){n.forEach(r=>{if(!r||typeof r!="object")return;const l=f(r),u=j(r)?r:y(l.rawName,r);m(l,u),o.add(r)});return}for(const[r,l]of Object.entries(n)){if(l==null)continue;const u=f(r),a=j(l)?l:y(u.rawName,l);m(u,a),l&&typeof l=="object"&&o.add(l)}}},b=n=>{if(!(!n||typeof n!="object")&&!o.has(n)){if(o.add(n),Array.isArray(n)){n.forEach(b);return}for(const r of $)if(Object.prototype.hasOwnProperty.call(n,r)){const l=n[r];E(l)}if(j(n)){const r=f(n);m(r,n)}Object.values(n).forEach(r=>{r&&typeof r=="object"&&b(r)})}};return b(e),t},R=e=>{if(!e||typeof e!="object")return;const t=e;let o;if(typeof t.Name=="string")o=t.Name;else if(t.Name&&typeof t.Name=="object"){const y=t.Name;typeof y.value=="string"&&(o=y.value)}const s=typeof t.name=="string"?t.name:void 0,f=o??s;if(!f)return;const i=f.trim();return i.length?i:void 0},Y=e=>{if(!e||typeof e!="object")return"IfcProduct";const t=e,o=new Set(["IFCIDENTIFIER","IFCLABEL","IFCTEXT","IFCBOOLEAN","IFCINTEGER","IFCREAL","IFCLENGTHMEASURE","IFCPOSITIVELENGTHMEASURE","IFCAREAMEASURE","IFCVOLUMEMEASURE","IFCPOSITIVERATIOMEASURE","IFCPLANEANGLEMEASURE","IFCPOSITIVEINTEGER","IFCLOGICAL"]);if(t.constructor&&typeof t.constructor=="function"&&t.constructor.name){const i=t.constructor.name.toUpperCase();if(i.startsWith("IFC")&&!o.has(i))return i}if(t._category&&typeof t._category=="object"){const i=t._category;if(i.value&&typeof i.value=="string"){const y=i.value.trim().toUpperCase();if(y.startsWith("IFC")&&!o.has(y))return y}}const s=[t.ifcClass,t.IfcClass,t.type,t.Type,t.expressType,t.ExpressType,t.entity,t.Entity,t.attributes?.ifcClass,t.Attributes?.IfcClass];for(const i of s)if(typeof i=="string"&&i.trim().length){const y=i.trim().toUpperCase();if(!o.has(y))return i.trim()}const f=T(e,["ifcclass","ifc type","type"]);if(f){const i=f.trim().toUpperCase();if(!o.has(i))return f}return"IfcProduct"},z=(e,t,o)=>{const s={},f={},i={};B(e).forEach(n=>{const r=n.label.split("/").map(g=>g.trim()),l=n.rawPsetName??r[1]??"",u=n.rawPropertyName??r[r.length-1]??"",a=U(l),p=U(u);if(!a||!p)return;f[a]||(f[a]={}),p in f[a]||(f[a][p]=n.value);const c=`${a}.${p}`;c in s||(s[c]=n.value)}),s.GlobalId=t,s.ifcClass=o,i.ifcClass=o,i.GlobalId=t,s["Attributes.GlobalId"]=t,s["Attributes.IfcClass"]=o,s["Attributes.ifcClass"]=o;const m=R(e);m&&(i.Name=m,s["Attributes.Name"]=m);const E=T(e,["category","ifccategory"]);E&&(i.Category=E,s["Attributes.Category"]=E);const b=T(e,["type","typename"]);if(b&&(i.Type=b,s["Attributes.Type"]=b),e&&typeof e=="object"&&!Array.isArray(e))for(const[n,r]of Object.entries(e)){if(r==null||typeof r!="object"||Array.isArray(r))continue;const l=P(r);if(!l)continue;const u=String(n).replace(/^_+/,""),a=`Attributes.${V(u)}`;if(a in s||(s[a]=l),u in i||(i[u]=l),/guid|globalid|_guid/i.test(n)){const p=l.trim();p&&!s.GlobalId&&(s.GlobalId=p,i.GlobalId=p,s["Attributes.GlobalId"]=p)}}return{flattened:s,psets:f,attributes:i}};let A=[],O=new Set,C=0,S=0,h=!1;const F=()=>{A=[],O=new Set,C=0,S=0,h=!1},K=e=>{if(e.reset&&F(),typeof e.total=="number"&&!Number.isNaN(e.total)&&(C=e.total),!h){if(Array.isArray(e.elements)&&e.elements.length){for(const o of e.elements){if(h)break;const s=o.globalId?.trim();if(!s||O.has(s))continue;const f=o.data;if(!f||typeof f!="object")continue;const i=o.ifcClass&&o.ifcClass.trim().length?o.ifcClass.trim():Y(f),{flattened:y}=z(f,s,i),m={GlobalId:s,ifcClass:i,properties:y};O.add(s),A.push(m)}S=Math.min(A.length,C||A.length);const t={type:"progress",done:S,total:C||Math.max(A.length,S)};N.postMessage(t)}if(e.final){if(h){const t={type:"error",message:"Build cancelled"};N.postMessage(t)}else{const t={type:"done",elements:A};N.postMessage(t)}F()}}};N.onmessage=e=>{const t=e.data;if(t)switch(t.type){case"build-props":K(t);break;case"cancel":h=!0,N.postMessage({type:"error",message:"Build cancelled"}),F();break;default:N.postMessage({type:"error",message:"Unknown message type"})}}})();
